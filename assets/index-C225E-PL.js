(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ys(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function lW(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Ab={exports:{}},_y={},Nb={exports:{}},gn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jp=Symbol.for("react.element"),uW=Symbol.for("react.portal"),fW=Symbol.for("react.fragment"),dW=Symbol.for("react.strict_mode"),hW=Symbol.for("react.profiler"),gW=Symbol.for("react.provider"),pW=Symbol.for("react.context"),mW=Symbol.for("react.forward_ref"),vW=Symbol.for("react.suspense"),yW=Symbol.for("react.memo"),wW=Symbol.for("react.lazy"),E8=Symbol.iterator;function xW(t){return t===null||typeof t!="object"?null:(t=E8&&t[E8]||t["@@iterator"],typeof t=="function"?t:null)}var kb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Vb=Object.assign,Fb={};function Hd(t,e,r){this.props=t,this.context=e,this.refs=Fb,this.updater=r||kb}Hd.prototype.isReactComponent={};Hd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Hd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Ub(){}Ub.prototype=Hd.prototype;function fS(t,e,r){this.props=t,this.context=e,this.refs=Fb,this.updater=r||kb}var dS=fS.prototype=new Ub;dS.constructor=fS;Vb(dS,Hd.prototype);dS.isPureReactComponent=!0;var D8=Array.isArray,Bb=Object.prototype.hasOwnProperty,hS={current:null},Gb={key:!0,ref:!0,__self:!0,__source:!0};function Wb(t,e,r){var n,i={},o=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)Bb.call(e,n)&&!Gb.hasOwnProperty(n)&&(i[n]=e[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(n in s=t.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:jp,type:t,key:o,ref:a,props:i,_owner:hS.current}}function CW(t,e){return{$$typeof:jp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function gS(t){return typeof t=="object"&&t!==null&&t.$$typeof===jp}function SW(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var b8=/\/+/g;function Z5(t,e){return typeof t=="object"&&t!==null&&t.key!=null?SW(""+t.key):e.toString(36)}function jm(t,e,r,n,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case jp:case uW:a=!0}}if(a)return a=t,i=i(a),t=n===""?"."+Z5(a,0):n,D8(i)?(r="",t!=null&&(r=t.replace(b8,"$&/")+"/"),jm(i,e,r,"",function(l){return l})):i!=null&&(gS(i)&&(i=CW(i,r+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(b8,"$&/")+"/")+t)),e.push(i)),1;if(a=0,n=n===""?".":n+":",D8(t))for(var s=0;s<t.length;s++){o=t[s];var c=n+Z5(o,s);a+=jm(o,e,r,c,i)}else if(c=xW(t),typeof c=="function")for(t=c.call(t),s=0;!(o=t.next()).done;)o=o.value,c=n+Z5(o,s++),a+=jm(o,e,r,c,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function D1(t,e,r){if(t==null)return t;var n=[],i=0;return jm(t,n,"","",function(o){return e.call(r,o,i++)}),n}function TW(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var go={current:null},Hm={transition:null},_W={ReactCurrentDispatcher:go,ReactCurrentBatchConfig:Hm,ReactCurrentOwner:hS};function zb(){throw Error("act(...) is not supported in production builds of React.")}gn.Children={map:D1,forEach:function(t,e,r){D1(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return D1(t,function(){e++}),e},toArray:function(t){return D1(t,function(e){return e})||[]},only:function(t){if(!gS(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};gn.Component=Hd;gn.Fragment=fW;gn.Profiler=hW;gn.PureComponent=fS;gn.StrictMode=dW;gn.Suspense=vW;gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_W;gn.act=zb;gn.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Vb({},t.props),i=t.key,o=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=hS.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(c in e)Bb.call(e,c)&&!Gb.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&s!==void 0?s[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:jp,type:t.type,key:i,ref:o,props:n,_owner:a}};gn.createContext=function(t){return t={$$typeof:pW,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:gW,_context:t},t.Consumer=t};gn.createElement=Wb;gn.createFactory=function(t){var e=Wb.bind(null,t);return e.type=t,e};gn.createRef=function(){return{current:null}};gn.forwardRef=function(t){return{$$typeof:mW,render:t}};gn.isValidElement=gS;gn.lazy=function(t){return{$$typeof:wW,_payload:{_status:-1,_result:t},_init:TW}};gn.memo=function(t,e){return{$$typeof:yW,type:t,compare:e===void 0?null:e}};gn.startTransition=function(t){var e=Hm.transition;Hm.transition={};try{t()}finally{Hm.transition=e}};gn.unstable_act=zb;gn.useCallback=function(t,e){return go.current.useCallback(t,e)};gn.useContext=function(t){return go.current.useContext(t)};gn.useDebugValue=function(){};gn.useDeferredValue=function(t){return go.current.useDeferredValue(t)};gn.useEffect=function(t,e){return go.current.useEffect(t,e)};gn.useId=function(){return go.current.useId()};gn.useImperativeHandle=function(t,e,r){return go.current.useImperativeHandle(t,e,r)};gn.useInsertionEffect=function(t,e){return go.current.useInsertionEffect(t,e)};gn.useLayoutEffect=function(t,e){return go.current.useLayoutEffect(t,e)};gn.useMemo=function(t,e){return go.current.useMemo(t,e)};gn.useReducer=function(t,e,r){return go.current.useReducer(t,e,r)};gn.useRef=function(t){return go.current.useRef(t)};gn.useState=function(t){return go.current.useState(t)};gn.useSyncExternalStore=function(t,e,r){return go.current.useSyncExternalStore(t,e,r)};gn.useTransition=function(){return go.current.useTransition()};gn.version="18.3.1";Nb.exports=gn;var ua=Nb.exports;const EW=Ys(ua);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DW=ua,bW=Symbol.for("react.element"),IW=Symbol.for("react.fragment"),OW=Object.prototype.hasOwnProperty,MW=DW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,RW={key:!0,ref:!0,__self:!0,__source:!0};function $b(t,e,r){var n,i={},o=null,a=null;r!==void 0&&(o=""+r),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)OW.call(e,n)&&!RW.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:bW,type:t,key:o,ref:a,props:i,_owner:MW.current}}_y.Fragment=IW;_y.jsx=$b;_y.jsxs=$b;Ab.exports=_y;var za=Ab.exports,z3={},jb={exports:{}},Xo={},Hb={exports:{}},Kb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(A,L){var N=A.length;A.push(L);e:for(;0<N;){var H=N-1>>>1,ee=A[H];if(0<i(ee,L))A[H]=L,A[N]=ee,N=H;else break e}}function r(A){return A.length===0?null:A[0]}function n(A){if(A.length===0)return null;var L=A[0],N=A.pop();if(N!==L){A[0]=N;e:for(var H=0,ee=A.length,oe=ee>>>1;H<oe;){var de=2*(H+1)-1,ue=A[de],me=de+1,Ee=A[me];if(0>i(ue,N))me<ee&&0>i(Ee,ue)?(A[H]=Ee,A[me]=N,H=me):(A[H]=ue,A[de]=N,H=de);else if(me<ee&&0>i(Ee,N))A[H]=Ee,A[me]=N,H=me;else break e}}return L}function i(A,L){var N=A.sortIndex-L.sortIndex;return N!==0?N:A.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();t.unstable_now=function(){return a.now()-s}}var c=[],l=[],f=1,u=null,d=3,h=!1,g=!1,p=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(A){for(var L=r(l);L!==null;){if(L.callback===null)n(l);else if(L.startTime<=A)n(l),L.sortIndex=L.expirationTime,e(c,L);else break;L=r(l)}}function x(A){if(p=!1,y(A),!g)if(r(c)!==null)g=!0,k(C);else{var L=r(l);L!==null&&z(x,L.startTime-A)}}function C(A,L){g=!1,p&&(p=!1,w(_),_=-1),h=!0;var N=d;try{for(y(L),u=r(c);u!==null&&(!(u.expirationTime>L)||A&&!b());){var H=u.callback;if(typeof H=="function"){u.callback=null,d=u.priorityLevel;var ee=H(u.expirationTime<=L);L=t.unstable_now(),typeof ee=="function"?u.callback=ee:u===r(c)&&n(c),y(L)}else n(c);u=r(c)}if(u!==null)var oe=!0;else{var de=r(l);de!==null&&z(x,de.startTime-L),oe=!1}return oe}finally{u=null,d=N,h=!1}}var S=!1,T=null,_=-1,E=5,D=-1;function b(){return!(t.unstable_now()-D<E)}function I(){if(T!==null){var A=t.unstable_now();D=A;var L=!0;try{L=T(!0,A)}finally{L?R():(S=!1,T=null)}}else S=!1}var R;if(typeof m=="function")R=function(){m(I)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,P=M.port2;M.port1.onmessage=I,R=function(){P.postMessage(null)}}else R=function(){v(I,0)};function k(A){T=A,S||(S=!0,R())}function z(A,L){_=v(function(){A(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(A){A.callback=null},t.unstable_continueExecution=function(){g||h||(g=!0,k(C))},t.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<A?Math.floor(1e3/A):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(A){switch(d){case 1:case 2:case 3:var L=3;break;default:L=d}var N=d;d=L;try{return A()}finally{d=N}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(A,L){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var N=d;d=A;try{return L()}finally{d=N}},t.unstable_scheduleCallback=function(A,L,N){var H=t.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?H+N:H):N=H,A){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=N+ee,A={id:f++,callback:L,priorityLevel:A,startTime:N,expirationTime:ee,sortIndex:-1},N>H?(A.sortIndex=N,e(l,A),r(c)===null&&A===r(l)&&(p?(w(_),_=-1):p=!0,z(x,N-H))):(A.sortIndex=ee,e(c,A),g||h||(g=!0,k(C))),A},t.unstable_shouldYield=b,t.unstable_wrapCallback=function(A){var L=d;return function(){var N=d;d=L;try{return A.apply(this,arguments)}finally{d=N}}}})(Kb);Hb.exports=Kb;var PW=Hb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LW=ua,Ho=PW;function at(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qb=new Set,Kg={};function i0(t,e){Sd(t,e),Sd(t+"Capture",e)}function Sd(t,e){for(Kg[t]=e,t=0;t<e.length;t++)qb.add(e[t])}var Fc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$3=Object.prototype.hasOwnProperty,AW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I8={},O8={};function NW(t){return $3.call(O8,t)?!0:$3.call(I8,t)?!1:AW.test(t)?O8[t]=!0:(I8[t]=!0,!1)}function kW(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function VW(t,e,r,n){if(e===null||typeof e>"u"||kW(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function po(t,e,r,n,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var Pi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Pi[t]=new po(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Pi[e]=new po(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Pi[t]=new po(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Pi[t]=new po(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Pi[t]=new po(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Pi[t]=new po(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Pi[t]=new po(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Pi[t]=new po(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Pi[t]=new po(t,5,!1,t.toLowerCase(),null,!1,!1)});var pS=/[\-:]([a-z])/g;function mS(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pS,mS);Pi[e]=new po(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pS,mS);Pi[e]=new po(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pS,mS);Pi[e]=new po(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Pi[t]=new po(t,1,!1,t.toLowerCase(),null,!1,!1)});Pi.xlinkHref=new po("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Pi[t]=new po(t,1,!1,t.toLowerCase(),null,!0,!0)});function vS(t,e,r,n){var i=Pi.hasOwnProperty(e)?Pi[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(VW(e,r,i,n)&&(r=null),n||i===null?NW(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(e=i.attributeName,n=i.attributeNamespace,r===null?t.removeAttribute(e):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Hc=LW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b1=Symbol.for("react.element"),O0=Symbol.for("react.portal"),M0=Symbol.for("react.fragment"),yS=Symbol.for("react.strict_mode"),j3=Symbol.for("react.profiler"),Xb=Symbol.for("react.provider"),Yb=Symbol.for("react.context"),wS=Symbol.for("react.forward_ref"),H3=Symbol.for("react.suspense"),K3=Symbol.for("react.suspense_list"),xS=Symbol.for("react.memo"),Pl=Symbol.for("react.lazy"),Jb=Symbol.for("react.offscreen"),M8=Symbol.iterator;function Sh(t){return t===null||typeof t!="object"?null:(t=M8&&t[M8]||t["@@iterator"],typeof t=="function"?t:null)}var Mr=Object.assign,Q5;function Xh(t){if(Q5===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);Q5=e&&e[1]||""}return`
`+Q5+t}var ew=!1;function tw(t,e){if(!t||ew)return"";ew=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){n=l}t.call(e.prototype)}else{try{throw Error()}catch(l){n=l}t()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=n.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var c=`
`+i[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=s);break}}}finally{ew=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Xh(t):""}function FW(t){switch(t.tag){case 5:return Xh(t.type);case 16:return Xh("Lazy");case 13:return Xh("Suspense");case 19:return Xh("SuspenseList");case 0:case 2:case 15:return t=tw(t.type,!1),t;case 11:return t=tw(t.type.render,!1),t;case 1:return t=tw(t.type,!0),t;default:return""}}function q3(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case M0:return"Fragment";case O0:return"Portal";case j3:return"Profiler";case yS:return"StrictMode";case H3:return"Suspense";case K3:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Yb:return(t.displayName||"Context")+".Consumer";case Xb:return(t._context.displayName||"Context")+".Provider";case wS:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case xS:return e=t.displayName||null,e!==null?e:q3(t.type)||"Memo";case Pl:e=t._payload,t=t._init;try{return q3(t(e))}catch{}}return null}function UW(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return q3(e);case 8:return e===yS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function cu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Zb(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function BW(t){var e=Zb(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,o=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,o.call(this,a)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function I1(t){t._valueTracker||(t._valueTracker=BW(t))}function Qb(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=Zb(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function k2(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function X3(t,e){var r=e.checked;return Mr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function R8(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=cu(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function e7(t,e){e=e.checked,e!=null&&vS(t,"checked",e,!1)}function Y3(t,e){e7(t,e);var r=cu(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?J3(t,e.type,r):e.hasOwnProperty("defaultValue")&&J3(t,e.type,cu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function P8(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function J3(t,e,r){(e!=="number"||k2(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Yh=Array.isArray;function ed(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+cu(r),e=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Z3(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(at(91));return Mr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function L8(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(at(92));if(Yh(r)){if(1<r.length)throw Error(at(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:cu(r)}}function t7(t,e){var r=cu(e.value),n=cu(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function A8(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function n7(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Q3(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?n7(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var O1,r7=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(O1=O1||document.createElement("div"),O1.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=O1.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qg(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var hg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GW=["Webkit","ms","Moz","O"];Object.keys(hg).forEach(function(t){GW.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),hg[e]=hg[t]})});function i7(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||hg.hasOwnProperty(t)&&hg[t]?(""+e).trim():e+"px"}function o7(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=i7(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}var WW=Mr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ex(t,e){if(e){if(WW[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(at(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(at(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(at(61))}if(e.style!=null&&typeof e.style!="object")throw Error(at(62))}}function tx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nx=null;function CS(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var rx=null,td=null,nd=null;function N8(t){if(t=qp(t)){if(typeof rx!="function")throw Error(at(280));var e=t.stateNode;e&&(e=Oy(e),rx(t.stateNode,t.type,e))}}function a7(t){td?nd?nd.push(t):nd=[t]:td=t}function s7(){if(td){var t=td,e=nd;if(nd=td=null,N8(t),e)for(t=0;t<e.length;t++)N8(e[t])}}function c7(t,e){return t(e)}function l7(){}var nw=!1;function u7(t,e,r){if(nw)return t(e,r);nw=!0;try{return c7(t,e,r)}finally{nw=!1,(td!==null||nd!==null)&&(l7(),s7())}}function Xg(t,e){var r=t.stateNode;if(r===null)return null;var n=Oy(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(at(231,e,typeof r));return r}var ix=!1;if(Fc)try{var Th={};Object.defineProperty(Th,"passive",{get:function(){ix=!0}}),window.addEventListener("test",Th,Th),window.removeEventListener("test",Th,Th)}catch{ix=!1}function zW(t,e,r,n,i,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(r,l)}catch(f){this.onError(f)}}var gg=!1,V2=null,F2=!1,ox=null,$W={onError:function(t){gg=!0,V2=t}};function jW(t,e,r,n,i,o,a,s,c){gg=!1,V2=null,zW.apply($W,arguments)}function HW(t,e,r,n,i,o,a,s,c){if(jW.apply(this,arguments),gg){if(gg){var l=V2;gg=!1,V2=null}else throw Error(at(198));F2||(F2=!0,ox=l)}}function o0(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function f7(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function k8(t){if(o0(t)!==t)throw Error(at(188))}function KW(t){var e=t.alternate;if(!e){if(e=o0(t),e===null)throw Error(at(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(i===null)break;var o=i.alternate;if(o===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return k8(i),t;if(o===n)return k8(i),e;o=o.sibling}throw Error(at(188))}if(r.return!==n.return)r=i,n=o;else{for(var a=!1,s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a)throw Error(at(189))}}if(r.alternate!==n)throw Error(at(190))}if(r.tag!==3)throw Error(at(188));return r.stateNode.current===r?t:e}function d7(t){return t=KW(t),t!==null?h7(t):null}function h7(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=h7(t);if(e!==null)return e;t=t.sibling}return null}var g7=Ho.unstable_scheduleCallback,V8=Ho.unstable_cancelCallback,qW=Ho.unstable_shouldYield,XW=Ho.unstable_requestPaint,Wr=Ho.unstable_now,YW=Ho.unstable_getCurrentPriorityLevel,SS=Ho.unstable_ImmediatePriority,p7=Ho.unstable_UserBlockingPriority,U2=Ho.unstable_NormalPriority,JW=Ho.unstable_LowPriority,m7=Ho.unstable_IdlePriority,Ey=null,Vs=null;function ZW(t){if(Vs&&typeof Vs.onCommitFiberRoot=="function")try{Vs.onCommitFiberRoot(Ey,t,void 0,(t.current.flags&128)===128)}catch{}}var ns=Math.clz32?Math.clz32:tz,QW=Math.log,ez=Math.LN2;function tz(t){return t>>>=0,t===0?32:31-(QW(t)/ez|0)|0}var M1=64,R1=4194304;function Jh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function B2(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,i=t.suspendedLanes,o=t.pingedLanes,a=r&268435455;if(a!==0){var s=a&~i;s!==0?n=Jh(s):(o&=a,o!==0&&(n=Jh(o)))}else a=r&~i,a!==0?n=Jh(a):o!==0&&(n=Jh(o));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-ns(e),i=1<<r,n|=t[r],e&=~i;return n}function nz(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rz(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var a=31-ns(o),s=1<<a,c=i[a];c===-1?(!(s&r)||s&n)&&(i[a]=nz(s,e)):c<=e&&(t.expiredLanes|=s),o&=~s}}function ax(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function v7(){var t=M1;return M1<<=1,!(M1&4194240)&&(M1=64),t}function rw(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Hp(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ns(e),t[e]=r}function iz(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-ns(r),o=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~o}}function TS(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-ns(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var $n=0;function y7(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var w7,_S,x7,C7,S7,sx=!1,P1=[],Xl=null,Yl=null,Jl=null,Yg=new Map,Jg=new Map,kl=[],oz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function F8(t,e){switch(t){case"focusin":case"focusout":Xl=null;break;case"dragenter":case"dragleave":Yl=null;break;case"mouseover":case"mouseout":Jl=null;break;case"pointerover":case"pointerout":Yg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jg.delete(e.pointerId)}}function _h(t,e,r,n,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},e!==null&&(e=qp(e),e!==null&&_S(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function az(t,e,r,n,i){switch(e){case"focusin":return Xl=_h(Xl,t,e,r,n,i),!0;case"dragenter":return Yl=_h(Yl,t,e,r,n,i),!0;case"mouseover":return Jl=_h(Jl,t,e,r,n,i),!0;case"pointerover":var o=i.pointerId;return Yg.set(o,_h(Yg.get(o)||null,t,e,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Jg.set(o,_h(Jg.get(o)||null,t,e,r,n,i)),!0}return!1}function T7(t){var e=Sf(t.target);if(e!==null){var r=o0(e);if(r!==null){if(e=r.tag,e===13){if(e=f7(r),e!==null){t.blockedOn=e,S7(t.priority,function(){x7(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Km(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=cx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);nx=n,r.target.dispatchEvent(n),nx=null}else return e=qp(r),e!==null&&_S(e),t.blockedOn=r,!1;e.shift()}return!0}function U8(t,e,r){Km(t)&&r.delete(e)}function sz(){sx=!1,Xl!==null&&Km(Xl)&&(Xl=null),Yl!==null&&Km(Yl)&&(Yl=null),Jl!==null&&Km(Jl)&&(Jl=null),Yg.forEach(U8),Jg.forEach(U8)}function Eh(t,e){t.blockedOn===e&&(t.blockedOn=null,sx||(sx=!0,Ho.unstable_scheduleCallback(Ho.unstable_NormalPriority,sz)))}function Zg(t){function e(i){return Eh(i,t)}if(0<P1.length){Eh(P1[0],t);for(var r=1;r<P1.length;r++){var n=P1[r];n.blockedOn===t&&(n.blockedOn=null)}}for(Xl!==null&&Eh(Xl,t),Yl!==null&&Eh(Yl,t),Jl!==null&&Eh(Jl,t),Yg.forEach(e),Jg.forEach(e),r=0;r<kl.length;r++)n=kl[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<kl.length&&(r=kl[0],r.blockedOn===null);)T7(r),r.blockedOn===null&&kl.shift()}var rd=Hc.ReactCurrentBatchConfig,G2=!0;function cz(t,e,r,n){var i=$n,o=rd.transition;rd.transition=null;try{$n=1,ES(t,e,r,n)}finally{$n=i,rd.transition=o}}function lz(t,e,r,n){var i=$n,o=rd.transition;rd.transition=null;try{$n=4,ES(t,e,r,n)}finally{$n=i,rd.transition=o}}function ES(t,e,r,n){if(G2){var i=cx(t,e,r,n);if(i===null)hw(t,e,n,W2,r),F8(t,n);else if(az(i,t,e,r,n))n.stopPropagation();else if(F8(t,n),e&4&&-1<oz.indexOf(t)){for(;i!==null;){var o=qp(i);if(o!==null&&w7(o),o=cx(t,e,r,n),o===null&&hw(t,e,n,W2,r),o===i)break;i=o}i!==null&&n.stopPropagation()}else hw(t,e,n,null,r)}}var W2=null;function cx(t,e,r,n){if(W2=null,t=CS(n),t=Sf(t),t!==null)if(e=o0(t),e===null)t=null;else if(r=e.tag,r===13){if(t=f7(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return W2=t,null}function _7(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(YW()){case SS:return 1;case p7:return 4;case U2:case JW:return 16;case m7:return 536870912;default:return 16}default:return 16}}var Bl=null,DS=null,qm=null;function E7(){if(qm)return qm;var t,e=DS,r=e.length,n,i="value"in Bl?Bl.value:Bl.textContent,o=i.length;for(t=0;t<r&&e[t]===i[t];t++);var a=r-t;for(n=1;n<=a&&e[r-n]===i[o-n];n++);return qm=i.slice(t,1<n?1-n:void 0)}function Xm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function L1(){return!0}function B8(){return!1}function Yo(t){function e(r,n,i,o,a){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(r=t[s],this[s]=r?r(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?L1:B8,this.isPropagationStopped=B8,this}return Mr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=L1)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=L1)},persist:function(){},isPersistent:L1}),e}var Kd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bS=Yo(Kd),Kp=Mr({},Kd,{view:0,detail:0}),uz=Yo(Kp),iw,ow,Dh,Dy=Mr({},Kp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:IS,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Dh&&(Dh&&t.type==="mousemove"?(iw=t.screenX-Dh.screenX,ow=t.screenY-Dh.screenY):ow=iw=0,Dh=t),iw)},movementY:function(t){return"movementY"in t?t.movementY:ow}}),G8=Yo(Dy),fz=Mr({},Dy,{dataTransfer:0}),dz=Yo(fz),hz=Mr({},Kp,{relatedTarget:0}),aw=Yo(hz),gz=Mr({},Kd,{animationName:0,elapsedTime:0,pseudoElement:0}),pz=Yo(gz),mz=Mr({},Kd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),vz=Yo(mz),yz=Mr({},Kd,{data:0}),W8=Yo(yz),wz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sz(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Cz[t])?!!e[t]:!1}function IS(){return Sz}var Tz=Mr({},Kp,{key:function(t){if(t.key){var e=wz[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Xm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?xz[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:IS,charCode:function(t){return t.type==="keypress"?Xm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Xm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),_z=Yo(Tz),Ez=Mr({},Dy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),z8=Yo(Ez),Dz=Mr({},Kp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:IS}),bz=Yo(Dz),Iz=Mr({},Kd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Oz=Yo(Iz),Mz=Mr({},Dy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Rz=Yo(Mz),Pz=[9,13,27,32],OS=Fc&&"CompositionEvent"in window,pg=null;Fc&&"documentMode"in document&&(pg=document.documentMode);var Lz=Fc&&"TextEvent"in window&&!pg,D7=Fc&&(!OS||pg&&8<pg&&11>=pg),$8=" ",j8=!1;function b7(t,e){switch(t){case"keyup":return Pz.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function I7(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var R0=!1;function Az(t,e){switch(t){case"compositionend":return I7(e);case"keypress":return e.which!==32?null:(j8=!0,$8);case"textInput":return t=e.data,t===$8&&j8?null:t;default:return null}}function Nz(t,e){if(R0)return t==="compositionend"||!OS&&b7(t,e)?(t=E7(),qm=DS=Bl=null,R0=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return D7&&e.locale!=="ko"?null:e.data;default:return null}}var kz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function H8(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!kz[t.type]:e==="textarea"}function O7(t,e,r,n){a7(n),e=z2(e,"onChange"),0<e.length&&(r=new bS("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var mg=null,Qg=null;function Vz(t){B7(t,0)}function by(t){var e=A0(t);if(Qb(e))return t}function Fz(t,e){if(t==="change")return e}var M7=!1;if(Fc){var sw;if(Fc){var cw="oninput"in document;if(!cw){var K8=document.createElement("div");K8.setAttribute("oninput","return;"),cw=typeof K8.oninput=="function"}sw=cw}else sw=!1;M7=sw&&(!document.documentMode||9<document.documentMode)}function q8(){mg&&(mg.detachEvent("onpropertychange",R7),Qg=mg=null)}function R7(t){if(t.propertyName==="value"&&by(Qg)){var e=[];O7(e,Qg,t,CS(t)),u7(Vz,e)}}function Uz(t,e,r){t==="focusin"?(q8(),mg=e,Qg=r,mg.attachEvent("onpropertychange",R7)):t==="focusout"&&q8()}function Bz(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return by(Qg)}function Gz(t,e){if(t==="click")return by(e)}function Wz(t,e){if(t==="input"||t==="change")return by(e)}function zz(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ss=typeof Object.is=="function"?Object.is:zz;function ep(t,e){if(ss(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!$3.call(e,i)||!ss(t[i],e[i]))return!1}return!0}function X8(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Y8(t,e){var r=X8(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=X8(r)}}function P7(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?P7(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function L7(){for(var t=window,e=k2();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=k2(t.document)}return e}function MS(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function $z(t){var e=L7(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&P7(r.ownerDocument.documentElement,r)){if(n!==null&&MS(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=n.end===void 0?o:Math.min(n.end,i),!t.extend&&o>n&&(i=n,n=o,o=i),i=Y8(r,o);var a=Y8(r,n);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>n?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var jz=Fc&&"documentMode"in document&&11>=document.documentMode,P0=null,lx=null,vg=null,ux=!1;function J8(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;ux||P0==null||P0!==k2(n)||(n=P0,"selectionStart"in n&&MS(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),vg&&ep(vg,n)||(vg=n,n=z2(lx,"onSelect"),0<n.length&&(e=new bS("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=P0)))}function A1(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var L0={animationend:A1("Animation","AnimationEnd"),animationiteration:A1("Animation","AnimationIteration"),animationstart:A1("Animation","AnimationStart"),transitionend:A1("Transition","TransitionEnd")},lw={},A7={};Fc&&(A7=document.createElement("div").style,"AnimationEvent"in window||(delete L0.animationend.animation,delete L0.animationiteration.animation,delete L0.animationstart.animation),"TransitionEvent"in window||delete L0.transitionend.transition);function Iy(t){if(lw[t])return lw[t];if(!L0[t])return t;var e=L0[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in A7)return lw[t]=e[r];return t}var N7=Iy("animationend"),k7=Iy("animationiteration"),V7=Iy("animationstart"),F7=Iy("transitionend"),U7=new Map,Z8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yu(t,e){U7.set(t,e),i0(e,[t])}for(var uw=0;uw<Z8.length;uw++){var fw=Z8[uw],Hz=fw.toLowerCase(),Kz=fw[0].toUpperCase()+fw.slice(1);yu(Hz,"on"+Kz)}yu(N7,"onAnimationEnd");yu(k7,"onAnimationIteration");yu(V7,"onAnimationStart");yu("dblclick","onDoubleClick");yu("focusin","onFocus");yu("focusout","onBlur");yu(F7,"onTransitionEnd");Sd("onMouseEnter",["mouseout","mouseover"]);Sd("onMouseLeave",["mouseout","mouseover"]);Sd("onPointerEnter",["pointerout","pointerover"]);Sd("onPointerLeave",["pointerout","pointerover"]);i0("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));i0("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));i0("onBeforeInput",["compositionend","keypress","textInput","paste"]);i0("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));i0("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));i0("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qz=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zh));function Q8(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,HW(n,e,void 0,t),t.currentTarget=null}function B7(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;e:{var o=void 0;if(e)for(var a=n.length-1;0<=a;a--){var s=n[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;Q8(i,s,l),o=c}else for(a=0;a<n.length;a++){if(s=n[a],c=s.instance,l=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;Q8(i,s,l),o=c}}}if(F2)throw t=ox,F2=!1,ox=null,t}function ar(t,e){var r=e[px];r===void 0&&(r=e[px]=new Set);var n=t+"__bubble";r.has(n)||(G7(e,t,2,!1),r.add(n))}function dw(t,e,r){var n=0;e&&(n|=4),G7(r,t,n,e)}var N1="_reactListening"+Math.random().toString(36).slice(2);function tp(t){if(!t[N1]){t[N1]=!0,qb.forEach(function(r){r!=="selectionchange"&&(qz.has(r)||dw(r,!1,t),dw(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[N1]||(e[N1]=!0,dw("selectionchange",!1,e))}}function G7(t,e,r,n){switch(_7(e)){case 1:var i=cz;break;case 4:i=lz;break;default:i=ES}r=i.bind(null,e,r,t),i=void 0,!ix||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):i!==void 0?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function hw(t,e,r,n,i){var o=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;a=a.return}for(;s!==null;){if(a=Sf(s),a===null)return;if(c=a.tag,c===5||c===6){n=o=a;continue e}s=s.parentNode}}n=n.return}u7(function(){var l=o,f=CS(r),u=[];e:{var d=U7.get(t);if(d!==void 0){var h=bS,g=t;switch(t){case"keypress":if(Xm(r)===0)break e;case"keydown":case"keyup":h=_z;break;case"focusin":g="focus",h=aw;break;case"focusout":g="blur",h=aw;break;case"beforeblur":case"afterblur":h=aw;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=G8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=dz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=bz;break;case N7:case k7:case V7:h=pz;break;case F7:h=Oz;break;case"scroll":h=uz;break;case"wheel":h=Rz;break;case"copy":case"cut":case"paste":h=vz;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=z8}var p=(e&4)!==0,v=!p&&t==="scroll",w=p?d!==null?d+"Capture":null:d;p=[];for(var m=l,y;m!==null;){y=m;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,w!==null&&(x=Xg(m,w),x!=null&&p.push(np(m,x,y)))),v)break;m=m.return}0<p.length&&(d=new h(d,g,null,r,f),u.push({event:d,listeners:p}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",d&&r!==nx&&(g=r.relatedTarget||r.fromElement)&&(Sf(g)||g[Uc]))break e;if((h||d)&&(d=f.window===f?f:(d=f.ownerDocument)?d.defaultView||d.parentWindow:window,h?(g=r.relatedTarget||r.toElement,h=l,g=g?Sf(g):null,g!==null&&(v=o0(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(h=null,g=l),h!==g)){if(p=G8,x="onMouseLeave",w="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(p=z8,x="onPointerLeave",w="onPointerEnter",m="pointer"),v=h==null?d:A0(h),y=g==null?d:A0(g),d=new p(x,m+"leave",h,r,f),d.target=v,d.relatedTarget=y,x=null,Sf(f)===l&&(p=new p(w,m+"enter",g,r,f),p.target=y,p.relatedTarget=v,x=p),v=x,h&&g)t:{for(p=h,w=g,m=0,y=p;y;y=d0(y))m++;for(y=0,x=w;x;x=d0(x))y++;for(;0<m-y;)p=d0(p),m--;for(;0<y-m;)w=d0(w),y--;for(;m--;){if(p===w||w!==null&&p===w.alternate)break t;p=d0(p),w=d0(w)}p=null}else p=null;h!==null&&eE(u,d,h,p,!1),g!==null&&v!==null&&eE(u,v,g,p,!0)}}e:{if(d=l?A0(l):window,h=d.nodeName&&d.nodeName.toLowerCase(),h==="select"||h==="input"&&d.type==="file")var C=Fz;else if(H8(d))if(M7)C=Wz;else{C=Bz;var S=Uz}else(h=d.nodeName)&&h.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(C=Gz);if(C&&(C=C(t,l))){O7(u,C,r,f);break e}S&&S(t,d,l),t==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&J3(d,"number",d.value)}switch(S=l?A0(l):window,t){case"focusin":(H8(S)||S.contentEditable==="true")&&(P0=S,lx=l,vg=null);break;case"focusout":vg=lx=P0=null;break;case"mousedown":ux=!0;break;case"contextmenu":case"mouseup":case"dragend":ux=!1,J8(u,r,f);break;case"selectionchange":if(jz)break;case"keydown":case"keyup":J8(u,r,f)}var T;if(OS)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else R0?b7(t,r)&&(_="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(_="onCompositionStart");_&&(D7&&r.locale!=="ko"&&(R0||_!=="onCompositionStart"?_==="onCompositionEnd"&&R0&&(T=E7()):(Bl=f,DS="value"in Bl?Bl.value:Bl.textContent,R0=!0)),S=z2(l,_),0<S.length&&(_=new W8(_,t,null,r,f),u.push({event:_,listeners:S}),T?_.data=T:(T=I7(r),T!==null&&(_.data=T)))),(T=Lz?Az(t,r):Nz(t,r))&&(l=z2(l,"onBeforeInput"),0<l.length&&(f=new W8("onBeforeInput","beforeinput",null,r,f),u.push({event:f,listeners:l}),f.data=T))}B7(u,e)})}function np(t,e,r){return{instance:t,listener:e,currentTarget:r}}function z2(t,e){for(var r=e+"Capture",n=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Xg(t,r),o!=null&&n.unshift(np(t,o,i)),o=Xg(t,e),o!=null&&n.push(np(t,o,i))),t=t.return}return n}function d0(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function eE(t,e,r,n,i){for(var o=e._reactName,a=[];r!==null&&r!==n;){var s=r,c=s.alternate,l=s.stateNode;if(c!==null&&c===n)break;s.tag===5&&l!==null&&(s=l,i?(c=Xg(r,o),c!=null&&a.unshift(np(r,c,s))):i||(c=Xg(r,o),c!=null&&a.push(np(r,c,s)))),r=r.return}a.length!==0&&t.push({event:e,listeners:a})}var Xz=/\r\n?/g,Yz=/\u0000|\uFFFD/g;function tE(t){return(typeof t=="string"?t:""+t).replace(Xz,`
`).replace(Yz,"")}function k1(t,e,r){if(e=tE(e),tE(t)!==e&&r)throw Error(at(425))}function $2(){}var fx=null,dx=null;function hx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var gx=typeof setTimeout=="function"?setTimeout:void 0,Jz=typeof clearTimeout=="function"?clearTimeout:void 0,nE=typeof Promise=="function"?Promise:void 0,Zz=typeof queueMicrotask=="function"?queueMicrotask:typeof nE<"u"?function(t){return nE.resolve(null).then(t).catch(Qz)}:gx;function Qz(t){setTimeout(function(){throw t})}function gw(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){t.removeChild(i),Zg(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);Zg(e)}function Zl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function rE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var qd=Math.random().toString(36).slice(2),Ps="__reactFiber$"+qd,rp="__reactProps$"+qd,Uc="__reactContainer$"+qd,px="__reactEvents$"+qd,e$="__reactListeners$"+qd,t$="__reactHandles$"+qd;function Sf(t){var e=t[Ps];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Uc]||r[Ps]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=rE(t);t!==null;){if(r=t[Ps])return r;t=rE(t)}return e}t=r,r=t.parentNode}return null}function qp(t){return t=t[Ps]||t[Uc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function A0(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(at(33))}function Oy(t){return t[rp]||null}var mx=[],N0=-1;function wu(t){return{current:t}}function lr(t){0>N0||(t.current=mx[N0],mx[N0]=null,N0--)}function nr(t,e){N0++,mx[N0]=t.current,t.current=e}var lu={},Ji=wu(lu),Do=wu(!1),Ff=lu;function Td(t,e){var r=t.type.contextTypes;if(!r)return lu;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in r)i[o]=e[o];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function bo(t){return t=t.childContextTypes,t!=null}function j2(){lr(Do),lr(Ji)}function iE(t,e,r){if(Ji.current!==lu)throw Error(at(168));nr(Ji,e),nr(Do,r)}function W7(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(at(108,UW(t)||"Unknown",i));return Mr({},r,n)}function H2(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||lu,Ff=Ji.current,nr(Ji,t),nr(Do,Do.current),!0}function oE(t,e,r){var n=t.stateNode;if(!n)throw Error(at(169));r?(t=W7(t,e,Ff),n.__reactInternalMemoizedMergedChildContext=t,lr(Do),lr(Ji),nr(Ji,t)):lr(Do),nr(Do,r)}var Sc=null,My=!1,pw=!1;function z7(t){Sc===null?Sc=[t]:Sc.push(t)}function n$(t){My=!0,z7(t)}function xu(){if(!pw&&Sc!==null){pw=!0;var t=0,e=$n;try{var r=Sc;for($n=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Sc=null,My=!1}catch(i){throw Sc!==null&&(Sc=Sc.slice(t+1)),g7(SS,xu),i}finally{$n=e,pw=!1}}return null}var k0=[],V0=0,K2=null,q2=0,fa=[],da=0,Uf=null,bc=1,Ic="";function uf(t,e){k0[V0++]=q2,k0[V0++]=K2,K2=t,q2=e}function $7(t,e,r){fa[da++]=bc,fa[da++]=Ic,fa[da++]=Uf,Uf=t;var n=bc;t=Ic;var i=32-ns(n)-1;n&=~(1<<i),r+=1;var o=32-ns(e)+i;if(30<o){var a=i-i%5;o=(n&(1<<a)-1).toString(32),n>>=a,i-=a,bc=1<<32-ns(e)+i|r<<i|n,Ic=o+t}else bc=1<<o|r<<i|n,Ic=t}function RS(t){t.return!==null&&(uf(t,1),$7(t,1,0))}function PS(t){for(;t===K2;)K2=k0[--V0],k0[V0]=null,q2=k0[--V0],k0[V0]=null;for(;t===Uf;)Uf=fa[--da],fa[da]=null,Ic=fa[--da],fa[da]=null,bc=fa[--da],fa[da]=null}var $o=null,Wo=null,vr=!1,Ya=null;function j7(t,e){var r=ma(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function aE(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,$o=t,Wo=Zl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,$o=t,Wo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Uf!==null?{id:bc,overflow:Ic}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=ma(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,$o=t,Wo=null,!0):!1;default:return!1}}function vx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function yx(t){if(vr){var e=Wo;if(e){var r=e;if(!aE(t,e)){if(vx(t))throw Error(at(418));e=Zl(r.nextSibling);var n=$o;e&&aE(t,e)?j7(n,r):(t.flags=t.flags&-4097|2,vr=!1,$o=t)}}else{if(vx(t))throw Error(at(418));t.flags=t.flags&-4097|2,vr=!1,$o=t}}}function sE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;$o=t}function V1(t){if(t!==$o)return!1;if(!vr)return sE(t),vr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!hx(t.type,t.memoizedProps)),e&&(e=Wo)){if(vx(t))throw H7(),Error(at(418));for(;e;)j7(t,e),e=Zl(e.nextSibling)}if(sE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(at(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Wo=Zl(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Wo=null}}else Wo=$o?Zl(t.stateNode.nextSibling):null;return!0}function H7(){for(var t=Wo;t;)t=Zl(t.nextSibling)}function _d(){Wo=$o=null,vr=!1}function LS(t){Ya===null?Ya=[t]:Ya.push(t)}var r$=Hc.ReactCurrentBatchConfig;function bh(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(at(309));var n=r.stateNode}if(!n)throw Error(at(147,t));var i=n,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof t!="string")throw Error(at(284));if(!r._owner)throw Error(at(290,t))}return t}function F1(t,e){throw t=Object.prototype.toString.call(e),Error(at(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function cE(t){var e=t._init;return e(t._payload)}function K7(t){function e(w,m){if(t){var y=w.deletions;y===null?(w.deletions=[m],w.flags|=16):y.push(m)}}function r(w,m){if(!t)return null;for(;m!==null;)e(w,m),m=m.sibling;return null}function n(w,m){for(w=new Map;m!==null;)m.key!==null?w.set(m.key,m):w.set(m.index,m),m=m.sibling;return w}function i(w,m){return w=nu(w,m),w.index=0,w.sibling=null,w}function o(w,m,y){return w.index=y,t?(y=w.alternate,y!==null?(y=y.index,y<m?(w.flags|=2,m):y):(w.flags|=2,m)):(w.flags|=1048576,m)}function a(w){return t&&w.alternate===null&&(w.flags|=2),w}function s(w,m,y,x){return m===null||m.tag!==6?(m=Sw(y,w.mode,x),m.return=w,m):(m=i(m,y),m.return=w,m)}function c(w,m,y,x){var C=y.type;return C===M0?f(w,m,y.props.children,x,y.key):m!==null&&(m.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Pl&&cE(C)===m.type)?(x=i(m,y.props),x.ref=bh(w,m,y),x.return=w,x):(x=n2(y.type,y.key,y.props,null,w.mode,x),x.ref=bh(w,m,y),x.return=w,x)}function l(w,m,y,x){return m===null||m.tag!==4||m.stateNode.containerInfo!==y.containerInfo||m.stateNode.implementation!==y.implementation?(m=Tw(y,w.mode,x),m.return=w,m):(m=i(m,y.children||[]),m.return=w,m)}function f(w,m,y,x,C){return m===null||m.tag!==7?(m=Rf(y,w.mode,x,C),m.return=w,m):(m=i(m,y),m.return=w,m)}function u(w,m,y){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Sw(""+m,w.mode,y),m.return=w,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case b1:return y=n2(m.type,m.key,m.props,null,w.mode,y),y.ref=bh(w,null,m),y.return=w,y;case O0:return m=Tw(m,w.mode,y),m.return=w,m;case Pl:var x=m._init;return u(w,x(m._payload),y)}if(Yh(m)||Sh(m))return m=Rf(m,w.mode,y,null),m.return=w,m;F1(w,m)}return null}function d(w,m,y,x){var C=m!==null?m.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return C!==null?null:s(w,m,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case b1:return y.key===C?c(w,m,y,x):null;case O0:return y.key===C?l(w,m,y,x):null;case Pl:return C=y._init,d(w,m,C(y._payload),x)}if(Yh(y)||Sh(y))return C!==null?null:f(w,m,y,x,null);F1(w,y)}return null}function h(w,m,y,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return w=w.get(y)||null,s(m,w,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case b1:return w=w.get(x.key===null?y:x.key)||null,c(m,w,x,C);case O0:return w=w.get(x.key===null?y:x.key)||null,l(m,w,x,C);case Pl:var S=x._init;return h(w,m,y,S(x._payload),C)}if(Yh(x)||Sh(x))return w=w.get(y)||null,f(m,w,x,C,null);F1(m,x)}return null}function g(w,m,y,x){for(var C=null,S=null,T=m,_=m=0,E=null;T!==null&&_<y.length;_++){T.index>_?(E=T,T=null):E=T.sibling;var D=d(w,T,y[_],x);if(D===null){T===null&&(T=E);break}t&&T&&D.alternate===null&&e(w,T),m=o(D,m,_),S===null?C=D:S.sibling=D,S=D,T=E}if(_===y.length)return r(w,T),vr&&uf(w,_),C;if(T===null){for(;_<y.length;_++)T=u(w,y[_],x),T!==null&&(m=o(T,m,_),S===null?C=T:S.sibling=T,S=T);return vr&&uf(w,_),C}for(T=n(w,T);_<y.length;_++)E=h(T,w,_,y[_],x),E!==null&&(t&&E.alternate!==null&&T.delete(E.key===null?_:E.key),m=o(E,m,_),S===null?C=E:S.sibling=E,S=E);return t&&T.forEach(function(b){return e(w,b)}),vr&&uf(w,_),C}function p(w,m,y,x){var C=Sh(y);if(typeof C!="function")throw Error(at(150));if(y=C.call(y),y==null)throw Error(at(151));for(var S=C=null,T=m,_=m=0,E=null,D=y.next();T!==null&&!D.done;_++,D=y.next()){T.index>_?(E=T,T=null):E=T.sibling;var b=d(w,T,D.value,x);if(b===null){T===null&&(T=E);break}t&&T&&b.alternate===null&&e(w,T),m=o(b,m,_),S===null?C=b:S.sibling=b,S=b,T=E}if(D.done)return r(w,T),vr&&uf(w,_),C;if(T===null){for(;!D.done;_++,D=y.next())D=u(w,D.value,x),D!==null&&(m=o(D,m,_),S===null?C=D:S.sibling=D,S=D);return vr&&uf(w,_),C}for(T=n(w,T);!D.done;_++,D=y.next())D=h(T,w,_,D.value,x),D!==null&&(t&&D.alternate!==null&&T.delete(D.key===null?_:D.key),m=o(D,m,_),S===null?C=D:S.sibling=D,S=D);return t&&T.forEach(function(I){return e(w,I)}),vr&&uf(w,_),C}function v(w,m,y,x){if(typeof y=="object"&&y!==null&&y.type===M0&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case b1:e:{for(var C=y.key,S=m;S!==null;){if(S.key===C){if(C=y.type,C===M0){if(S.tag===7){r(w,S.sibling),m=i(S,y.props.children),m.return=w,w=m;break e}}else if(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Pl&&cE(C)===S.type){r(w,S.sibling),m=i(S,y.props),m.ref=bh(w,S,y),m.return=w,w=m;break e}r(w,S);break}else e(w,S);S=S.sibling}y.type===M0?(m=Rf(y.props.children,w.mode,x,y.key),m.return=w,w=m):(x=n2(y.type,y.key,y.props,null,w.mode,x),x.ref=bh(w,m,y),x.return=w,w=x)}return a(w);case O0:e:{for(S=y.key;m!==null;){if(m.key===S)if(m.tag===4&&m.stateNode.containerInfo===y.containerInfo&&m.stateNode.implementation===y.implementation){r(w,m.sibling),m=i(m,y.children||[]),m.return=w,w=m;break e}else{r(w,m);break}else e(w,m);m=m.sibling}m=Tw(y,w.mode,x),m.return=w,w=m}return a(w);case Pl:return S=y._init,v(w,m,S(y._payload),x)}if(Yh(y))return g(w,m,y,x);if(Sh(y))return p(w,m,y,x);F1(w,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,m!==null&&m.tag===6?(r(w,m.sibling),m=i(m,y),m.return=w,w=m):(r(w,m),m=Sw(y,w.mode,x),m.return=w,w=m),a(w)):r(w,m)}return v}var Ed=K7(!0),q7=K7(!1),X2=wu(null),Y2=null,F0=null,AS=null;function NS(){AS=F0=Y2=null}function kS(t){var e=X2.current;lr(X2),t._currentValue=e}function wx(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function id(t,e){Y2=t,AS=F0=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(To=!0),t.firstContext=null)}function Ca(t){var e=t._currentValue;if(AS!==t)if(t={context:t,memoizedValue:e,next:null},F0===null){if(Y2===null)throw Error(at(308));F0=t,Y2.dependencies={lanes:0,firstContext:t}}else F0=F0.next=t;return e}var Tf=null;function VS(t){Tf===null?Tf=[t]:Tf.push(t)}function X7(t,e,r,n){var i=e.interleaved;return i===null?(r.next=r,VS(e)):(r.next=i.next,i.next=r),e.interleaved=r,Bc(t,n)}function Bc(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Ll=!1;function FS(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Y7(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Pc(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ql(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,In&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Bc(t,r)}return i=n.interleaved,i===null?(e.next=e,VS(n)):(e.next=i.next,i.next=e),n.interleaved=e,Bc(t,r)}function Ym(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,TS(t,r)}}function lE(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?i=o=a:o=o.next=a,r=r.next}while(r!==null);o===null?i=o=e:o=o.next=e}else i=o=e;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function J2(t,e,r,n){var i=t.updateQueue;Ll=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,a===null?o=l:a.next=l,a=c;var f=t.alternate;f!==null&&(f=f.updateQueue,s=f.lastBaseUpdate,s!==a&&(s===null?f.firstBaseUpdate=l:s.next=l,f.lastBaseUpdate=c))}if(o!==null){var u=i.baseState;a=0,f=l=c=null,s=o;do{var d=s.lane,h=s.eventTime;if((n&d)===d){f!==null&&(f=f.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var g=t,p=s;switch(d=e,h=r,p.tag){case 1:if(g=p.payload,typeof g=="function"){u=g.call(h,u,d);break e}u=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=p.payload,d=typeof g=="function"?g.call(h,u,d):g,d==null)break e;u=Mr({},u,d);break e;case 2:Ll=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,d=i.effects,d===null?i.effects=[s]:d.push(s))}else h={eventTime:h,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},f===null?(l=f=h,c=u):f=f.next=h,a|=d;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;d=s,s=d.next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}while(!0);if(f===null&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=f,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Gf|=a,t.lanes=a,t.memoizedState=u}}function uE(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(at(191,i));i.call(n)}}}var Xp={},Fs=wu(Xp),ip=wu(Xp),op=wu(Xp);function _f(t){if(t===Xp)throw Error(at(174));return t}function US(t,e){switch(nr(op,e),nr(ip,t),nr(Fs,Xp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Q3(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Q3(e,t)}lr(Fs),nr(Fs,e)}function Dd(){lr(Fs),lr(ip),lr(op)}function J7(t){_f(op.current);var e=_f(Fs.current),r=Q3(e,t.type);e!==r&&(nr(ip,t),nr(Fs,r))}function BS(t){ip.current===t&&(lr(Fs),lr(ip))}var Dr=wu(0);function Z2(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mw=[];function GS(){for(var t=0;t<mw.length;t++)mw[t]._workInProgressVersionPrimary=null;mw.length=0}var Jm=Hc.ReactCurrentDispatcher,vw=Hc.ReactCurrentBatchConfig,Bf=0,Ir=null,oi=null,vi=null,Q2=!1,yg=!1,ap=0,i$=0;function zi(){throw Error(at(321))}function WS(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!ss(t[r],e[r]))return!1;return!0}function zS(t,e,r,n,i,o){if(Bf=o,Ir=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jm.current=t===null||t.memoizedState===null?c$:l$,t=r(n,i),yg){o=0;do{if(yg=!1,ap=0,25<=o)throw Error(at(301));o+=1,vi=oi=null,e.updateQueue=null,Jm.current=u$,t=r(n,i)}while(yg)}if(Jm.current=ev,e=oi!==null&&oi.next!==null,Bf=0,vi=oi=Ir=null,Q2=!1,e)throw Error(at(300));return t}function $S(){var t=ap!==0;return ap=0,t}function Is(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vi===null?Ir.memoizedState=vi=t:vi=vi.next=t,vi}function Sa(){if(oi===null){var t=Ir.alternate;t=t!==null?t.memoizedState:null}else t=oi.next;var e=vi===null?Ir.memoizedState:vi.next;if(e!==null)vi=e,oi=t;else{if(t===null)throw Error(at(310));oi=t,t={memoizedState:oi.memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},vi===null?Ir.memoizedState=vi=t:vi=vi.next=t}return vi}function sp(t,e){return typeof e=="function"?e(t):e}function yw(t){var e=Sa(),r=e.queue;if(r===null)throw Error(at(311));r.lastRenderedReducer=t;var n=oi,i=n.baseQueue,o=r.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}n.baseQueue=i=o,r.pending=null}if(i!==null){o=i.next,n=n.baseState;var s=a=null,c=null,l=o;do{var f=l.lane;if((Bf&f)===f)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:t(n,l.action);else{var u={lane:f,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=u,a=n):c=c.next=u,Ir.lanes|=f,Gf|=f}l=l.next}while(l!==null&&l!==o);c===null?a=n:c.next=s,ss(n,e.memoizedState)||(To=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=c,r.lastRenderedState=n}if(t=r.interleaved,t!==null){i=t;do o=i.lane,Ir.lanes|=o,Gf|=o,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function ww(t){var e=Sa(),r=e.queue;if(r===null)throw Error(at(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,o=e.memoizedState;if(i!==null){r.pending=null;var a=i=i.next;do o=t(o,a.action),a=a.next;while(a!==i);ss(o,e.memoizedState)||(To=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),r.lastRenderedState=o}return[o,n]}function Z7(){}function Q7(t,e){var r=Ir,n=Sa(),i=e(),o=!ss(n.memoizedState,i);if(o&&(n.memoizedState=i,To=!0),n=n.queue,jS(nI.bind(null,r,n,t),[t]),n.getSnapshot!==e||o||vi!==null&&vi.memoizedState.tag&1){if(r.flags|=2048,cp(9,tI.bind(null,r,n,i,e),void 0,null),xi===null)throw Error(at(349));Bf&30||eI(r,e,i)}return i}function eI(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Ir.updateQueue,e===null?(e={lastEffect:null,stores:null},Ir.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function tI(t,e,r,n){e.value=r,e.getSnapshot=n,rI(e)&&iI(t)}function nI(t,e,r){return r(function(){rI(e)&&iI(t)})}function rI(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!ss(t,r)}catch{return!0}}function iI(t){var e=Bc(t,1);e!==null&&rs(e,t,1,-1)}function fE(t){var e=Is();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sp,lastRenderedState:t},e.queue=t,t=t.dispatch=s$.bind(null,Ir,t),[e.memoizedState,t]}function cp(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Ir.updateQueue,e===null?(e={lastEffect:null,stores:null},Ir.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function oI(){return Sa().memoizedState}function Zm(t,e,r,n){var i=Is();Ir.flags|=t,i.memoizedState=cp(1|e,r,void 0,n===void 0?null:n)}function Ry(t,e,r,n){var i=Sa();n=n===void 0?null:n;var o=void 0;if(oi!==null){var a=oi.memoizedState;if(o=a.destroy,n!==null&&WS(n,a.deps)){i.memoizedState=cp(e,r,o,n);return}}Ir.flags|=t,i.memoizedState=cp(1|e,r,o,n)}function dE(t,e){return Zm(8390656,8,t,e)}function jS(t,e){return Ry(2048,8,t,e)}function aI(t,e){return Ry(4,2,t,e)}function sI(t,e){return Ry(4,4,t,e)}function cI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function lI(t,e,r){return r=r!=null?r.concat([t]):null,Ry(4,4,cI.bind(null,e,t),r)}function HS(){}function uI(t,e){var r=Sa();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&WS(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function fI(t,e){var r=Sa();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&WS(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function dI(t,e,r){return Bf&21?(ss(r,e)||(r=v7(),Ir.lanes|=r,Gf|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,To=!0),t.memoizedState=r)}function o$(t,e){var r=$n;$n=r!==0&&4>r?r:4,t(!0);var n=vw.transition;vw.transition={};try{t(!1),e()}finally{$n=r,vw.transition=n}}function hI(){return Sa().memoizedState}function a$(t,e,r){var n=tu(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},gI(t))pI(e,r);else if(r=X7(t,e,r,n),r!==null){var i=uo();rs(r,t,n,i),mI(r,e,n)}}function s$(t,e,r){var n=tu(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(gI(t))pI(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,r);if(i.hasEagerState=!0,i.eagerState=s,ss(s,a)){var c=e.interleaved;c===null?(i.next=i,VS(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}r=X7(t,e,i,n),r!==null&&(i=uo(),rs(r,t,n,i),mI(r,e,n))}}function gI(t){var e=t.alternate;return t===Ir||e!==null&&e===Ir}function pI(t,e){yg=Q2=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function mI(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,TS(t,r)}}var ev={readContext:Ca,useCallback:zi,useContext:zi,useEffect:zi,useImperativeHandle:zi,useInsertionEffect:zi,useLayoutEffect:zi,useMemo:zi,useReducer:zi,useRef:zi,useState:zi,useDebugValue:zi,useDeferredValue:zi,useTransition:zi,useMutableSource:zi,useSyncExternalStore:zi,useId:zi,unstable_isNewReconciler:!1},c$={readContext:Ca,useCallback:function(t,e){return Is().memoizedState=[t,e===void 0?null:e],t},useContext:Ca,useEffect:dE,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Zm(4194308,4,cI.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Zm(4194308,4,t,e)},useInsertionEffect:function(t,e){return Zm(4,2,t,e)},useMemo:function(t,e){var r=Is();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Is();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=a$.bind(null,Ir,t),[n.memoizedState,t]},useRef:function(t){var e=Is();return t={current:t},e.memoizedState=t},useState:fE,useDebugValue:HS,useDeferredValue:function(t){return Is().memoizedState=t},useTransition:function(){var t=fE(!1),e=t[0];return t=o$.bind(null,t[1]),Is().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Ir,i=Is();if(vr){if(r===void 0)throw Error(at(407));r=r()}else{if(r=e(),xi===null)throw Error(at(349));Bf&30||eI(n,e,r)}i.memoizedState=r;var o={value:r,getSnapshot:e};return i.queue=o,dE(nI.bind(null,n,o,t),[t]),n.flags|=2048,cp(9,tI.bind(null,n,o,r,e),void 0,null),r},useId:function(){var t=Is(),e=xi.identifierPrefix;if(vr){var r=Ic,n=bc;r=(n&~(1<<32-ns(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=ap++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=i$++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},l$={readContext:Ca,useCallback:uI,useContext:Ca,useEffect:jS,useImperativeHandle:lI,useInsertionEffect:aI,useLayoutEffect:sI,useMemo:fI,useReducer:yw,useRef:oI,useState:function(){return yw(sp)},useDebugValue:HS,useDeferredValue:function(t){var e=Sa();return dI(e,oi.memoizedState,t)},useTransition:function(){var t=yw(sp)[0],e=Sa().memoizedState;return[t,e]},useMutableSource:Z7,useSyncExternalStore:Q7,useId:hI,unstable_isNewReconciler:!1},u$={readContext:Ca,useCallback:uI,useContext:Ca,useEffect:jS,useImperativeHandle:lI,useInsertionEffect:aI,useLayoutEffect:sI,useMemo:fI,useReducer:ww,useRef:oI,useState:function(){return ww(sp)},useDebugValue:HS,useDeferredValue:function(t){var e=Sa();return oi===null?e.memoizedState=t:dI(e,oi.memoizedState,t)},useTransition:function(){var t=ww(sp)[0],e=Sa().memoizedState;return[t,e]},useMutableSource:Z7,useSyncExternalStore:Q7,useId:hI,unstable_isNewReconciler:!1};function Ha(t,e){if(t&&t.defaultProps){e=Mr({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function xx(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Mr({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var Py={isMounted:function(t){return(t=t._reactInternals)?o0(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=uo(),i=tu(t),o=Pc(n,i);o.payload=e,r!=null&&(o.callback=r),e=Ql(t,o,i),e!==null&&(rs(e,t,i,n),Ym(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=uo(),i=tu(t),o=Pc(n,i);o.tag=1,o.payload=e,r!=null&&(o.callback=r),e=Ql(t,o,i),e!==null&&(rs(e,t,i,n),Ym(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=uo(),n=tu(t),i=Pc(r,n);i.tag=2,e!=null&&(i.callback=e),e=Ql(t,i,n),e!==null&&(rs(e,t,n,r),Ym(e,t,n))}};function hE(t,e,r,n,i,o,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,o,a):e.prototype&&e.prototype.isPureReactComponent?!ep(r,n)||!ep(i,o):!0}function vI(t,e,r){var n=!1,i=lu,o=e.contextType;return typeof o=="object"&&o!==null?o=Ca(o):(i=bo(e)?Ff:Ji.current,n=e.contextTypes,o=(n=n!=null)?Td(t,i):lu),e=new e(r,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Py,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function gE(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&Py.enqueueReplaceState(e,e.state,null)}function Cx(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},FS(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Ca(o):(o=bo(e)?Ff:Ji.current,i.context=Td(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(xx(t,e,o,r),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Py.enqueueReplaceState(i,i.state,null),J2(t,r,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function bd(t,e){try{var r="",n=e;do r+=FW(n),n=n.return;while(n);var i=r}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function xw(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Sx(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var f$=typeof WeakMap=="function"?WeakMap:Map;function yI(t,e,r){r=Pc(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){nv||(nv=!0,Px=n),Sx(t,e)},r}function wI(t,e,r){r=Pc(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){Sx(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){Sx(t,e),typeof n!="function"&&(eu===null?eu=new Set([this]):eu.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),r}function pE(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new f$;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=E$.bind(null,t,e,r),e.then(t,t))}function mE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vE(t,e,r,n,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Pc(-1,1),e.tag=2,Ql(r,e,1))),r.lanes|=1),t)}var d$=Hc.ReactCurrentOwner,To=!1;function so(t,e,r,n){e.child=t===null?q7(e,null,r,n):Ed(e,t.child,r,n)}function yE(t,e,r,n,i){r=r.render;var o=e.ref;return id(e,i),n=zS(t,e,r,n,o,i),r=$S(),t!==null&&!To?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Gc(t,e,i)):(vr&&r&&RS(e),e.flags|=1,so(t,e,n,i),e.child)}function wE(t,e,r,n,i){if(t===null){var o=r.type;return typeof o=="function"&&!eT(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=o,xI(t,e,o,n,i)):(t=n2(r.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var a=o.memoizedProps;if(r=r.compare,r=r!==null?r:ep,r(a,n)&&t.ref===e.ref)return Gc(t,e,i)}return e.flags|=1,t=nu(o,n),t.ref=e.ref,t.return=e,e.child=t}function xI(t,e,r,n,i){if(t!==null){var o=t.memoizedProps;if(ep(o,n)&&t.ref===e.ref)if(To=!1,e.pendingProps=n=o,(t.lanes&i)!==0)t.flags&131072&&(To=!0);else return e.lanes=t.lanes,Gc(t,e,i)}return Tx(t,e,r,n,i)}function CI(t,e,r){var n=e.pendingProps,i=n.children,o=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nr(B0,Fo),Fo|=r;else{if(!(r&1073741824))return t=o!==null?o.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nr(B0,Fo),Fo|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,nr(B0,Fo),Fo|=n}else o!==null?(n=o.baseLanes|r,e.memoizedState=null):n=r,nr(B0,Fo),Fo|=n;return so(t,e,i,r),e.child}function SI(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Tx(t,e,r,n,i){var o=bo(r)?Ff:Ji.current;return o=Td(e,o),id(e,i),r=zS(t,e,r,n,o,i),n=$S(),t!==null&&!To?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Gc(t,e,i)):(vr&&n&&RS(e),e.flags|=1,so(t,e,r,i),e.child)}function xE(t,e,r,n,i){if(bo(r)){var o=!0;H2(e)}else o=!1;if(id(e,i),e.stateNode===null)Qm(t,e),vI(e,r,n),Cx(e,r,n,i),n=!0;else if(t===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var c=a.context,l=r.contextType;typeof l=="object"&&l!==null?l=Ca(l):(l=bo(r)?Ff:Ji.current,l=Td(e,l));var f=r.getDerivedStateFromProps,u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";u||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==n||c!==l)&&gE(e,a,n,l),Ll=!1;var d=e.memoizedState;a.state=d,J2(e,n,a,i),c=e.memoizedState,s!==n||d!==c||Do.current||Ll?(typeof f=="function"&&(xx(e,r,f,n),c=e.memoizedState),(s=Ll||hE(e,r,s,n,d,c,l))?(u||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),a.props=n,a.state=c,a.context=l,n=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,Y7(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:Ha(e.type,s),a.props=l,u=e.pendingProps,d=a.context,c=r.contextType,typeof c=="object"&&c!==null?c=Ca(c):(c=bo(r)?Ff:Ji.current,c=Td(e,c));var h=r.getDerivedStateFromProps;(f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==u||d!==c)&&gE(e,a,n,c),Ll=!1,d=e.memoizedState,a.state=d,J2(e,n,a,i);var g=e.memoizedState;s!==u||d!==g||Do.current||Ll?(typeof h=="function"&&(xx(e,r,h,n),g=e.memoizedState),(l=Ll||hE(e,r,l,n,d,g,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,g,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,g,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=g),a.props=n,a.state=g,a.context=c,n=l):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),n=!1)}return _x(t,e,r,n,o,i)}function _x(t,e,r,n,i,o){SI(t,e);var a=(e.flags&128)!==0;if(!n&&!a)return i&&oE(e,r,!1),Gc(t,e,o);n=e.stateNode,d$.current=e;var s=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&a?(e.child=Ed(e,t.child,null,o),e.child=Ed(e,null,s,o)):so(t,e,s,o),e.memoizedState=n.state,i&&oE(e,r,!0),e.child}function TI(t){var e=t.stateNode;e.pendingContext?iE(t,e.pendingContext,e.pendingContext!==e.context):e.context&&iE(t,e.context,!1),US(t,e.containerInfo)}function CE(t,e,r,n,i){return _d(),LS(i),e.flags|=256,so(t,e,r,n),e.child}var Ex={dehydrated:null,treeContext:null,retryLane:0};function Dx(t){return{baseLanes:t,cachePool:null,transitions:null}}function _I(t,e,r){var n=e.pendingProps,i=Dr.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),nr(Dr,i&1),t===null)return yx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,t=n.fallback,o?(n=e.mode,o=e.child,a={mode:"hidden",children:a},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=Ny(a,n,0,null),t=Rf(t,n,r,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Dx(r),e.memoizedState=Ex,t):KS(e,a));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return h$(t,e,a,n,s,i,r);if(o){o=n.fallback,a=e.mode,i=t.child,s=i.sibling;var c={mode:"hidden",children:n.children};return!(a&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=nu(i,c),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=nu(s,o):(o=Rf(o,a,r,null),o.flags|=2),o.return=e,n.return=e,n.sibling=o,e.child=n,n=o,o=e.child,a=t.child.memoizedState,a=a===null?Dx(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=t.childLanes&~r,e.memoizedState=Ex,n}return o=t.child,t=o.sibling,n=nu(o,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function KS(t,e){return e=Ny({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function U1(t,e,r,n){return n!==null&&LS(n),Ed(e,t.child,null,r),t=KS(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function h$(t,e,r,n,i,o,a){if(r)return e.flags&256?(e.flags&=-257,n=xw(Error(at(422))),U1(t,e,a,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=n.fallback,i=e.mode,n=Ny({mode:"visible",children:n.children},i,0,null),o=Rf(o,i,a,null),o.flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,e.mode&1&&Ed(e,t.child,null,a),e.child.memoizedState=Dx(a),e.memoizedState=Ex,o);if(!(e.mode&1))return U1(t,e,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,o=Error(at(419)),n=xw(o,n,void 0),U1(t,e,a,n)}if(s=(a&t.childLanes)!==0,To||s){if(n=xi,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Bc(t,i),rs(n,t,i,-1))}return QS(),n=xw(Error(at(421))),U1(t,e,a,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=D$.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Wo=Zl(i.nextSibling),$o=e,vr=!0,Ya=null,t!==null&&(fa[da++]=bc,fa[da++]=Ic,fa[da++]=Uf,bc=t.id,Ic=t.overflow,Uf=e),e=KS(e,n.children),e.flags|=4096,e)}function SE(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),wx(t.return,e,r)}function Cw(t,e,r,n,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function EI(t,e,r){var n=e.pendingProps,i=n.revealOrder,o=n.tail;if(so(t,e,n.children,r),n=Dr.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&SE(t,r,e);else if(t.tag===19)SE(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(nr(Dr,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;r!==null;)t=r.alternate,t!==null&&Z2(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),Cw(e,!1,i,r,o);break;case"backwards":for(r=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Z2(t)===null){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}Cw(e,!0,r,null,o);break;case"together":Cw(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Qm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gc(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Gf|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(at(153));if(e.child!==null){for(t=e.child,r=nu(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=nu(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function g$(t,e,r){switch(e.tag){case 3:TI(e),_d();break;case 5:J7(e);break;case 1:bo(e.type)&&H2(e);break;case 4:US(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;nr(X2,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(nr(Dr,Dr.current&1),e.flags|=128,null):r&e.child.childLanes?_I(t,e,r):(nr(Dr,Dr.current&1),t=Gc(t,e,r),t!==null?t.sibling:null);nr(Dr,Dr.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return EI(t,e,r);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),nr(Dr,Dr.current),n)break;return null;case 22:case 23:return e.lanes=0,CI(t,e,r)}return Gc(t,e,r)}var DI,bx,bI,II;DI=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};bx=function(){};bI=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,_f(Fs.current);var o=null;switch(r){case"input":i=X3(t,i),n=X3(t,n),o=[];break;case"select":i=Mr({},i,{value:void 0}),n=Mr({},n,{value:void 0}),o=[];break;case"textarea":i=Z3(t,i),n=Z3(t,n),o=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=$2)}ex(r,n);var a;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Kg.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in n){var c=n[l];if(s=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in c)c.hasOwnProperty(a)&&s[a]!==c[a]&&(r||(r={}),r[a]=c[a])}else r||(o||(o=[]),o.push(l,r)),r=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Kg.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&ar("scroll",t),o||s===c||(o=[])):(o=o||[]).push(l,c))}r&&(o=o||[]).push("style",r);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};II=function(t,e,r,n){r!==n&&(e.flags|=4)};function Ih(t,e){if(!vr)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function $i(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function p$(t,e,r){var n=e.pendingProps;switch(PS(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $i(e),null;case 1:return bo(e.type)&&j2(),$i(e),null;case 3:return n=e.stateNode,Dd(),lr(Do),lr(Ji),GS(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(V1(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ya!==null&&(Nx(Ya),Ya=null))),bx(t,e),$i(e),null;case 5:BS(e);var i=_f(op.current);if(r=e.type,t!==null&&e.stateNode!=null)bI(t,e,r,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(at(166));return $i(e),null}if(t=_f(Fs.current),V1(e)){n=e.stateNode,r=e.type;var o=e.memoizedProps;switch(n[Ps]=e,n[rp]=o,t=(e.mode&1)!==0,r){case"dialog":ar("cancel",n),ar("close",n);break;case"iframe":case"object":case"embed":ar("load",n);break;case"video":case"audio":for(i=0;i<Zh.length;i++)ar(Zh[i],n);break;case"source":ar("error",n);break;case"img":case"image":case"link":ar("error",n),ar("load",n);break;case"details":ar("toggle",n);break;case"input":R8(n,o),ar("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},ar("invalid",n);break;case"textarea":L8(n,o),ar("invalid",n)}ex(r,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?n.textContent!==s&&(o.suppressHydrationWarning!==!0&&k1(n.textContent,s,t),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&k1(n.textContent,s,t),i=["children",""+s]):Kg.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&ar("scroll",n)}switch(r){case"input":I1(n),P8(n,o,!0);break;case"textarea":I1(n),A8(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=$2)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=n7(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=a.createElement(r,{is:n.is}):(t=a.createElement(r),r==="select"&&(a=t,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):t=a.createElementNS(t,r),t[Ps]=e,t[rp]=n,DI(t,e,!1,!1),e.stateNode=t;e:{switch(a=tx(r,n),r){case"dialog":ar("cancel",t),ar("close",t),i=n;break;case"iframe":case"object":case"embed":ar("load",t),i=n;break;case"video":case"audio":for(i=0;i<Zh.length;i++)ar(Zh[i],t);i=n;break;case"source":ar("error",t),i=n;break;case"img":case"image":case"link":ar("error",t),ar("load",t),i=n;break;case"details":ar("toggle",t),i=n;break;case"input":R8(t,n),i=X3(t,n),ar("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=Mr({},n,{value:void 0}),ar("invalid",t);break;case"textarea":L8(t,n),i=Z3(t,n),ar("invalid",t);break;default:i=n}ex(r,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var c=s[o];o==="style"?o7(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&r7(t,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&qg(t,c):typeof c=="number"&&qg(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Kg.hasOwnProperty(o)?c!=null&&o==="onScroll"&&ar("scroll",t):c!=null&&vS(t,o,c,a))}switch(r){case"input":I1(t),P8(t,n,!1);break;case"textarea":I1(t),A8(t);break;case"option":n.value!=null&&t.setAttribute("value",""+cu(n.value));break;case"select":t.multiple=!!n.multiple,o=n.value,o!=null?ed(t,!!n.multiple,o,!1):n.defaultValue!=null&&ed(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=$2)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $i(e),null;case 6:if(t&&e.stateNode!=null)II(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(at(166));if(r=_f(op.current),_f(Fs.current),V1(e)){if(n=e.stateNode,r=e.memoizedProps,n[Ps]=e,(o=n.nodeValue!==r)&&(t=$o,t!==null))switch(t.tag){case 3:k1(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&k1(n.nodeValue,r,(t.mode&1)!==0)}o&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Ps]=e,e.stateNode=n}return $i(e),null;case 13:if(lr(Dr),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(vr&&Wo!==null&&e.mode&1&&!(e.flags&128))H7(),_d(),e.flags|=98560,o=!1;else if(o=V1(e),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(at(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(at(317));o[Ps]=e}else _d(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$i(e),o=!1}else Ya!==null&&(Nx(Ya),Ya=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Dr.current&1?si===0&&(si=3):QS())),e.updateQueue!==null&&(e.flags|=4),$i(e),null);case 4:return Dd(),bx(t,e),t===null&&tp(e.stateNode.containerInfo),$i(e),null;case 10:return kS(e.type._context),$i(e),null;case 17:return bo(e.type)&&j2(),$i(e),null;case 19:if(lr(Dr),o=e.memoizedState,o===null)return $i(e),null;if(n=(e.flags&128)!==0,a=o.rendering,a===null)if(n)Ih(o,!1);else{if(si!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Z2(t),a!==null){for(e.flags|=128,Ih(o,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)o=r,t=n,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,t=a.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return nr(Dr,Dr.current&1|2),e.child}t=t.sibling}o.tail!==null&&Wr()>Id&&(e.flags|=128,n=!0,Ih(o,!1),e.lanes=4194304)}else{if(!n)if(t=Z2(a),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Ih(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!vr)return $i(e),null}else 2*Wr()-o.renderingStartTime>Id&&r!==1073741824&&(e.flags|=128,n=!0,Ih(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(r=o.last,r!==null?r.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Wr(),e.sibling=null,r=Dr.current,nr(Dr,n?r&1|2:r&1),e):($i(e),null);case 22:case 23:return ZS(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Fo&1073741824&&($i(e),e.subtreeFlags&6&&(e.flags|=8192)):$i(e),null;case 24:return null;case 25:return null}throw Error(at(156,e.tag))}function m$(t,e){switch(PS(e),e.tag){case 1:return bo(e.type)&&j2(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Dd(),lr(Do),lr(Ji),GS(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return BS(e),null;case 13:if(lr(Dr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(at(340));_d()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return lr(Dr),null;case 4:return Dd(),null;case 10:return kS(e.type._context),null;case 22:case 23:return ZS(),null;case 24:return null;default:return null}}var B1=!1,qi=!1,v$=typeof WeakSet=="function"?WeakSet:Set,wt=null;function U0(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Nr(t,e,n)}else r.current=null}function Ix(t,e,r){try{r()}catch(n){Nr(t,e,n)}}var TE=!1;function y$(t,e){if(fx=G2,t=L7(),MS(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var a=0,s=-1,c=-1,l=0,f=0,u=t,d=null;t:for(;;){for(var h;u!==r||i!==0&&u.nodeType!==3||(s=a+i),u!==o||n!==0&&u.nodeType!==3||(c=a+n),u.nodeType===3&&(a+=u.nodeValue.length),(h=u.firstChild)!==null;)d=u,u=h;for(;;){if(u===t)break t;if(d===r&&++l===i&&(s=a),d===o&&++f===n&&(c=a),(h=u.nextSibling)!==null)break;u=d,d=u.parentNode}u=h}r=s===-1||c===-1?null:{start:s,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(dx={focusedElem:t,selectionRange:r},G2=!1,wt=e;wt!==null;)if(e=wt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,wt=t;else for(;wt!==null;){e=wt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var p=g.memoizedProps,v=g.memoizedState,w=e.stateNode,m=w.getSnapshotBeforeUpdate(e.elementType===e.type?p:Ha(e.type,p),v);w.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(at(163))}}catch(x){Nr(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,wt=t;break}wt=e.return}return g=TE,TE=!1,g}function wg(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&Ix(e,r,o)}i=i.next}while(i!==n)}}function Ly(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function Ox(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function OI(t){var e=t.alternate;e!==null&&(t.alternate=null,OI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ps],delete e[rp],delete e[px],delete e[e$],delete e[t$])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function MI(t){return t.tag===5||t.tag===3||t.tag===4}function _E(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||MI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Mx(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=$2));else if(n!==4&&(t=t.child,t!==null))for(Mx(t,e,r),t=t.sibling;t!==null;)Mx(t,e,r),t=t.sibling}function Rx(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Rx(t,e,r),t=t.sibling;t!==null;)Rx(t,e,r),t=t.sibling}var bi=null,qa=!1;function yl(t,e,r){for(r=r.child;r!==null;)RI(t,e,r),r=r.sibling}function RI(t,e,r){if(Vs&&typeof Vs.onCommitFiberUnmount=="function")try{Vs.onCommitFiberUnmount(Ey,r)}catch{}switch(r.tag){case 5:qi||U0(r,e);case 6:var n=bi,i=qa;bi=null,yl(t,e,r),bi=n,qa=i,bi!==null&&(qa?(t=bi,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):bi.removeChild(r.stateNode));break;case 18:bi!==null&&(qa?(t=bi,r=r.stateNode,t.nodeType===8?gw(t.parentNode,r):t.nodeType===1&&gw(t,r),Zg(t)):gw(bi,r.stateNode));break;case 4:n=bi,i=qa,bi=r.stateNode.containerInfo,qa=!0,yl(t,e,r),bi=n,qa=i;break;case 0:case 11:case 14:case 15:if(!qi&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&Ix(r,e,a),i=i.next}while(i!==n)}yl(t,e,r);break;case 1:if(!qi&&(U0(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){Nr(r,e,s)}yl(t,e,r);break;case 21:yl(t,e,r);break;case 22:r.mode&1?(qi=(n=qi)||r.memoizedState!==null,yl(t,e,r),qi=n):yl(t,e,r);break;default:yl(t,e,r)}}function EE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new v$),e.forEach(function(n){var i=b$.bind(null,t,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Ua(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var o=t,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:bi=s.stateNode,qa=!1;break e;case 3:bi=s.stateNode.containerInfo,qa=!0;break e;case 4:bi=s.stateNode.containerInfo,qa=!0;break e}s=s.return}if(bi===null)throw Error(at(160));RI(o,a,i),bi=null,qa=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){Nr(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)PI(e,t),e=e.sibling}function PI(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ua(e,t),Ts(t),n&4){try{wg(3,t,t.return),Ly(3,t)}catch(p){Nr(t,t.return,p)}try{wg(5,t,t.return)}catch(p){Nr(t,t.return,p)}}break;case 1:Ua(e,t),Ts(t),n&512&&r!==null&&U0(r,r.return);break;case 5:if(Ua(e,t),Ts(t),n&512&&r!==null&&U0(r,r.return),t.flags&32){var i=t.stateNode;try{qg(i,"")}catch(p){Nr(t,t.return,p)}}if(n&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,a=r!==null?r.memoizedProps:o,s=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&e7(i,o),tx(s,a);var l=tx(s,o);for(a=0;a<c.length;a+=2){var f=c[a],u=c[a+1];f==="style"?o7(i,u):f==="dangerouslySetInnerHTML"?r7(i,u):f==="children"?qg(i,u):vS(i,f,u,l)}switch(s){case"input":Y3(i,o);break;case"textarea":t7(i,o);break;case"select":var d=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var h=o.value;h!=null?ed(i,!!o.multiple,h,!1):d!==!!o.multiple&&(o.defaultValue!=null?ed(i,!!o.multiple,o.defaultValue,!0):ed(i,!!o.multiple,o.multiple?[]:"",!1))}i[rp]=o}catch(p){Nr(t,t.return,p)}}break;case 6:if(Ua(e,t),Ts(t),n&4){if(t.stateNode===null)throw Error(at(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(p){Nr(t,t.return,p)}}break;case 3:if(Ua(e,t),Ts(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Zg(e.containerInfo)}catch(p){Nr(t,t.return,p)}break;case 4:Ua(e,t),Ts(t);break;case 13:Ua(e,t),Ts(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(YS=Wr())),n&4&&EE(t);break;case 22:if(f=r!==null&&r.memoizedState!==null,t.mode&1?(qi=(l=qi)||f,Ua(e,t),qi=l):Ua(e,t),Ts(t),n&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!f&&t.mode&1)for(wt=t,f=t.child;f!==null;){for(u=wt=f;wt!==null;){switch(d=wt,h=d.child,d.tag){case 0:case 11:case 14:case 15:wg(4,d,d.return);break;case 1:U0(d,d.return);var g=d.stateNode;if(typeof g.componentWillUnmount=="function"){n=d,r=d.return;try{e=n,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(p){Nr(n,r,p)}}break;case 5:U0(d,d.return);break;case 22:if(d.memoizedState!==null){bE(u);continue}}h!==null?(h.return=d,wt=h):bE(u)}f=f.sibling}e:for(f=null,u=t;;){if(u.tag===5){if(f===null){f=u;try{i=u.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=u.stateNode,c=u.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=i7("display",a))}catch(p){Nr(t,t.return,p)}}}else if(u.tag===6){if(f===null)try{u.stateNode.nodeValue=l?"":u.memoizedProps}catch(p){Nr(t,t.return,p)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;f===u&&(f=null),u=u.return}f===u&&(f=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Ua(e,t),Ts(t),n&4&&EE(t);break;case 21:break;default:Ua(e,t),Ts(t)}}function Ts(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(MI(r)){var n=r;break e}r=r.return}throw Error(at(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(qg(i,""),n.flags&=-33);var o=_E(t);Rx(t,o,i);break;case 3:case 4:var a=n.stateNode.containerInfo,s=_E(t);Mx(t,s,a);break;default:throw Error(at(161))}}catch(c){Nr(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function w$(t,e,r){wt=t,LI(t)}function LI(t,e,r){for(var n=(t.mode&1)!==0;wt!==null;){var i=wt,o=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||B1;if(!a){var s=i.alternate,c=s!==null&&s.memoizedState!==null||qi;s=B1;var l=qi;if(B1=a,(qi=c)&&!l)for(wt=i;wt!==null;)a=wt,c=a.child,a.tag===22&&a.memoizedState!==null?IE(i):c!==null?(c.return=a,wt=c):IE(i);for(;o!==null;)wt=o,LI(o),o=o.sibling;wt=i,B1=s,qi=l}DE(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,wt=o):DE(t)}}function DE(t){for(;wt!==null;){var e=wt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qi||Ly(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!qi)if(r===null)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:Ha(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&uE(e,o,n);break;case 3:var a=e.updateQueue;if(a!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}uE(e,a,r)}break;case 5:var s=e.stateNode;if(r===null&&e.flags&4){r=s;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var f=l.memoizedState;if(f!==null){var u=f.dehydrated;u!==null&&Zg(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(at(163))}qi||e.flags&512&&Ox(e)}catch(d){Nr(e,e.return,d)}}if(e===t){wt=null;break}if(r=e.sibling,r!==null){r.return=e.return,wt=r;break}wt=e.return}}function bE(t){for(;wt!==null;){var e=wt;if(e===t){wt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,wt=r;break}wt=e.return}}function IE(t){for(;wt!==null;){var e=wt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Ly(4,e)}catch(c){Nr(e,r,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){Nr(e,i,c)}}var o=e.return;try{Ox(e)}catch(c){Nr(e,o,c)}break;case 5:var a=e.return;try{Ox(e)}catch(c){Nr(e,a,c)}}}catch(c){Nr(e,e.return,c)}if(e===t){wt=null;break}var s=e.sibling;if(s!==null){s.return=e.return,wt=s;break}wt=e.return}}var x$=Math.ceil,tv=Hc.ReactCurrentDispatcher,qS=Hc.ReactCurrentOwner,va=Hc.ReactCurrentBatchConfig,In=0,xi=null,Zr=null,Ri=0,Fo=0,B0=wu(0),si=0,lp=null,Gf=0,Ay=0,XS=0,xg=null,So=null,YS=0,Id=1/0,wc=null,nv=!1,Px=null,eu=null,G1=!1,Gl=null,rv=0,Cg=0,Lx=null,e2=-1,t2=0;function uo(){return In&6?Wr():e2!==-1?e2:e2=Wr()}function tu(t){return t.mode&1?In&2&&Ri!==0?Ri&-Ri:r$.transition!==null?(t2===0&&(t2=v7()),t2):(t=$n,t!==0||(t=window.event,t=t===void 0?16:_7(t.type)),t):1}function rs(t,e,r,n){if(50<Cg)throw Cg=0,Lx=null,Error(at(185));Hp(t,r,n),(!(In&2)||t!==xi)&&(t===xi&&(!(In&2)&&(Ay|=r),si===4&&Vl(t,Ri)),Io(t,n),r===1&&In===0&&!(e.mode&1)&&(Id=Wr()+500,My&&xu()))}function Io(t,e){var r=t.callbackNode;rz(t,e);var n=B2(t,t===xi?Ri:0);if(n===0)r!==null&&V8(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&V8(r),e===1)t.tag===0?n$(OE.bind(null,t)):z7(OE.bind(null,t)),Zz(function(){!(In&6)&&xu()}),r=null;else{switch(y7(n)){case 1:r=SS;break;case 4:r=p7;break;case 16:r=U2;break;case 536870912:r=m7;break;default:r=U2}r=GI(r,AI.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function AI(t,e){if(e2=-1,t2=0,In&6)throw Error(at(327));var r=t.callbackNode;if(od()&&t.callbackNode!==r)return null;var n=B2(t,t===xi?Ri:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=iv(t,n);else{e=n;var i=In;In|=2;var o=kI();(xi!==t||Ri!==e)&&(wc=null,Id=Wr()+500,Mf(t,e));do try{T$();break}catch(s){NI(t,s)}while(!0);NS(),tv.current=o,In=i,Zr!==null?e=0:(xi=null,Ri=0,e=si)}if(e!==0){if(e===2&&(i=ax(t),i!==0&&(n=i,e=Ax(t,i))),e===1)throw r=lp,Mf(t,0),Vl(t,n),Io(t,Wr()),r;if(e===6)Vl(t,n);else{if(i=t.current.alternate,!(n&30)&&!C$(i)&&(e=iv(t,n),e===2&&(o=ax(t),o!==0&&(n=o,e=Ax(t,o))),e===1))throw r=lp,Mf(t,0),Vl(t,n),Io(t,Wr()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(at(345));case 2:ff(t,So,wc);break;case 3:if(Vl(t,n),(n&130023424)===n&&(e=YS+500-Wr(),10<e)){if(B2(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){uo(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=gx(ff.bind(null,t,So,wc),e);break}ff(t,So,wc);break;case 4:if(Vl(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var a=31-ns(n);o=1<<a,a=e[a],a>i&&(i=a),n&=~o}if(n=i,n=Wr()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*x$(n/1960))-n,10<n){t.timeoutHandle=gx(ff.bind(null,t,So,wc),n);break}ff(t,So,wc);break;case 5:ff(t,So,wc);break;default:throw Error(at(329))}}}return Io(t,Wr()),t.callbackNode===r?AI.bind(null,t):null}function Ax(t,e){var r=xg;return t.current.memoizedState.isDehydrated&&(Mf(t,e).flags|=256),t=iv(t,e),t!==2&&(e=So,So=r,e!==null&&Nx(e)),t}function Nx(t){So===null?So=t:So.push.apply(So,t)}function C$(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!ss(o(),i))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vl(t,e){for(e&=~XS,e&=~Ay,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-ns(e),n=1<<r;t[r]=-1,e&=~n}}function OE(t){if(In&6)throw Error(at(327));od();var e=B2(t,0);if(!(e&1))return Io(t,Wr()),null;var r=iv(t,e);if(t.tag!==0&&r===2){var n=ax(t);n!==0&&(e=n,r=Ax(t,n))}if(r===1)throw r=lp,Mf(t,0),Vl(t,e),Io(t,Wr()),r;if(r===6)throw Error(at(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ff(t,So,wc),Io(t,Wr()),null}function JS(t,e){var r=In;In|=1;try{return t(e)}finally{In=r,In===0&&(Id=Wr()+500,My&&xu())}}function Wf(t){Gl!==null&&Gl.tag===0&&!(In&6)&&od();var e=In;In|=1;var r=va.transition,n=$n;try{if(va.transition=null,$n=1,t)return t()}finally{$n=n,va.transition=r,In=e,!(In&6)&&xu()}}function ZS(){Fo=B0.current,lr(B0)}function Mf(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Jz(r)),Zr!==null)for(r=Zr.return;r!==null;){var n=r;switch(PS(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&j2();break;case 3:Dd(),lr(Do),lr(Ji),GS();break;case 5:BS(n);break;case 4:Dd();break;case 13:lr(Dr);break;case 19:lr(Dr);break;case 10:kS(n.type._context);break;case 22:case 23:ZS()}r=r.return}if(xi=t,Zr=t=nu(t.current,null),Ri=Fo=e,si=0,lp=null,XS=Ay=Gf=0,So=xg=null,Tf!==null){for(e=0;e<Tf.length;e++)if(r=Tf[e],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,o=r.pending;if(o!==null){var a=o.next;o.next=i,n.next=a}r.pending=n}Tf=null}return t}function NI(t,e){do{var r=Zr;try{if(NS(),Jm.current=ev,Q2){for(var n=Ir.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Q2=!1}if(Bf=0,vi=oi=Ir=null,yg=!1,ap=0,qS.current=null,r===null||r.return===null){si=1,lp=e,Zr=null;break}e:{var o=t,a=r.return,s=r,c=e;if(e=Ri,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,f=s,u=f.tag;if(!(f.mode&1)&&(u===0||u===11||u===15)){var d=f.alternate;d?(f.updateQueue=d.updateQueue,f.memoizedState=d.memoizedState,f.lanes=d.lanes):(f.updateQueue=null,f.memoizedState=null)}var h=mE(a);if(h!==null){h.flags&=-257,vE(h,a,s,o,e),h.mode&1&&pE(o,l,e),e=h,c=l;var g=e.updateQueue;if(g===null){var p=new Set;p.add(c),e.updateQueue=p}else g.add(c);break e}else{if(!(e&1)){pE(o,l,e),QS();break e}c=Error(at(426))}}else if(vr&&s.mode&1){var v=mE(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),vE(v,a,s,o,e),LS(bd(c,s));break e}}o=c=bd(c,s),si!==4&&(si=2),xg===null?xg=[o]:xg.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var w=yI(o,c,e);lE(o,w);break e;case 1:s=c;var m=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof m.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(eu===null||!eu.has(y)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=wI(o,s,e);lE(o,x);break e}}o=o.return}while(o!==null)}FI(r)}catch(C){e=C,Zr===r&&r!==null&&(Zr=r=r.return);continue}break}while(!0)}function kI(){var t=tv.current;return tv.current=ev,t===null?ev:t}function QS(){(si===0||si===3||si===2)&&(si=4),xi===null||!(Gf&268435455)&&!(Ay&268435455)||Vl(xi,Ri)}function iv(t,e){var r=In;In|=2;var n=kI();(xi!==t||Ri!==e)&&(wc=null,Mf(t,e));do try{S$();break}catch(i){NI(t,i)}while(!0);if(NS(),In=r,tv.current=n,Zr!==null)throw Error(at(261));return xi=null,Ri=0,si}function S$(){for(;Zr!==null;)VI(Zr)}function T$(){for(;Zr!==null&&!qW();)VI(Zr)}function VI(t){var e=BI(t.alternate,t,Fo);t.memoizedProps=t.pendingProps,e===null?FI(t):Zr=e,qS.current=null}function FI(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=m$(r,e),r!==null){r.flags&=32767,Zr=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{si=6,Zr=null;return}}else if(r=p$(r,e,Fo),r!==null){Zr=r;return}if(e=e.sibling,e!==null){Zr=e;return}Zr=e=t}while(e!==null);si===0&&(si=5)}function ff(t,e,r){var n=$n,i=va.transition;try{va.transition=null,$n=1,_$(t,e,r,n)}finally{va.transition=i,$n=n}return null}function _$(t,e,r,n){do od();while(Gl!==null);if(In&6)throw Error(at(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(at(177));t.callbackNode=null,t.callbackPriority=0;var o=r.lanes|r.childLanes;if(iz(t,o),t===xi&&(Zr=xi=null,Ri=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||G1||(G1=!0,GI(U2,function(){return od(),null})),o=(r.flags&15990)!==0,r.subtreeFlags&15990||o){o=va.transition,va.transition=null;var a=$n;$n=1;var s=In;In|=4,qS.current=null,y$(t,r),PI(r,t),$z(dx),G2=!!fx,dx=fx=null,t.current=r,w$(r),XW(),In=s,$n=a,va.transition=o}else t.current=r;if(G1&&(G1=!1,Gl=t,rv=i),o=t.pendingLanes,o===0&&(eu=null),ZW(r.stateNode),Io(t,Wr()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(nv)throw nv=!1,t=Px,Px=null,t;return rv&1&&t.tag!==0&&od(),o=t.pendingLanes,o&1?t===Lx?Cg++:(Cg=0,Lx=t):Cg=0,xu(),null}function od(){if(Gl!==null){var t=y7(rv),e=va.transition,r=$n;try{if(va.transition=null,$n=16>t?16:t,Gl===null)var n=!1;else{if(t=Gl,Gl=null,rv=0,In&6)throw Error(at(331));var i=In;for(In|=4,wt=t.current;wt!==null;){var o=wt,a=o.child;if(wt.flags&16){var s=o.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for(wt=l;wt!==null;){var f=wt;switch(f.tag){case 0:case 11:case 15:wg(8,f,o)}var u=f.child;if(u!==null)u.return=f,wt=u;else for(;wt!==null;){f=wt;var d=f.sibling,h=f.return;if(OI(f),f===l){wt=null;break}if(d!==null){d.return=h,wt=d;break}wt=h}}}var g=o.alternate;if(g!==null){var p=g.child;if(p!==null){g.child=null;do{var v=p.sibling;p.sibling=null,p=v}while(p!==null)}}wt=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,wt=a;else e:for(;wt!==null;){if(o=wt,o.flags&2048)switch(o.tag){case 0:case 11:case 15:wg(9,o,o.return)}var w=o.sibling;if(w!==null){w.return=o.return,wt=w;break e}wt=o.return}}var m=t.current;for(wt=m;wt!==null;){a=wt;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,wt=y;else e:for(a=m;wt!==null;){if(s=wt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Ly(9,s)}}catch(C){Nr(s,s.return,C)}if(s===a){wt=null;break e}var x=s.sibling;if(x!==null){x.return=s.return,wt=x;break e}wt=s.return}}if(In=i,xu(),Vs&&typeof Vs.onPostCommitFiberRoot=="function")try{Vs.onPostCommitFiberRoot(Ey,t)}catch{}n=!0}return n}finally{$n=r,va.transition=e}}return!1}function ME(t,e,r){e=bd(r,e),e=yI(t,e,1),t=Ql(t,e,1),e=uo(),t!==null&&(Hp(t,1,e),Io(t,e))}function Nr(t,e,r){if(t.tag===3)ME(t,t,r);else for(;e!==null;){if(e.tag===3){ME(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(eu===null||!eu.has(n))){t=bd(r,t),t=wI(e,t,1),e=Ql(e,t,1),t=uo(),e!==null&&(Hp(e,1,t),Io(e,t));break}}e=e.return}}function E$(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=uo(),t.pingedLanes|=t.suspendedLanes&r,xi===t&&(Ri&r)===r&&(si===4||si===3&&(Ri&130023424)===Ri&&500>Wr()-YS?Mf(t,0):XS|=r),Io(t,e)}function UI(t,e){e===0&&(t.mode&1?(e=R1,R1<<=1,!(R1&130023424)&&(R1=4194304)):e=1);var r=uo();t=Bc(t,e),t!==null&&(Hp(t,e,r),Io(t,r))}function D$(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),UI(t,r)}function b$(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(at(314))}n!==null&&n.delete(e),UI(t,r)}var BI;BI=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Do.current)To=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return To=!1,g$(t,e,r);To=!!(t.flags&131072)}else To=!1,vr&&e.flags&1048576&&$7(e,q2,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Qm(t,e),t=e.pendingProps;var i=Td(e,Ji.current);id(e,r),i=zS(null,e,n,t,i,r);var o=$S();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,bo(n)?(o=!0,H2(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,FS(e),i.updater=Py,e.stateNode=i,i._reactInternals=e,Cx(e,n,t,r),e=_x(null,e,n,!0,o,r)):(e.tag=0,vr&&o&&RS(e),so(null,e,i,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Qm(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=O$(n),t=Ha(n,t),i){case 0:e=Tx(null,e,n,t,r);break e;case 1:e=xE(null,e,n,t,r);break e;case 11:e=yE(null,e,n,t,r);break e;case 14:e=wE(null,e,n,Ha(n.type,t),r);break e}throw Error(at(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Ha(n,i),Tx(t,e,n,i,r);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Ha(n,i),xE(t,e,n,i,r);case 3:e:{if(TI(e),t===null)throw Error(at(387));n=e.pendingProps,o=e.memoizedState,i=o.element,Y7(t,e),J2(e,n,null,r);var a=e.memoizedState;if(n=a.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=bd(Error(at(423)),e),e=CE(t,e,n,r,i);break e}else if(n!==i){i=bd(Error(at(424)),e),e=CE(t,e,n,r,i);break e}else for(Wo=Zl(e.stateNode.containerInfo.firstChild),$o=e,vr=!0,Ya=null,r=q7(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(_d(),n===i){e=Gc(t,e,r);break e}so(t,e,n,r)}e=e.child}return e;case 5:return J7(e),t===null&&yx(e),n=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,a=i.children,hx(n,i)?a=null:o!==null&&hx(n,o)&&(e.flags|=32),SI(t,e),so(t,e,a,r),e.child;case 6:return t===null&&yx(e),null;case 13:return _I(t,e,r);case 4:return US(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Ed(e,null,n,r):so(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Ha(n,i),yE(t,e,n,i,r);case 7:return so(t,e,e.pendingProps,r),e.child;case 8:return so(t,e,e.pendingProps.children,r),e.child;case 12:return so(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,nr(X2,n._currentValue),n._currentValue=a,o!==null)if(ss(o.value,a)){if(o.children===i.children&&!Do.current){e=Gc(t,e,r);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var c=s.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Pc(-1,r&-r),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var f=l.pending;f===null?c.next=c:(c.next=f.next,f.next=c),l.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),wx(o.return,r,e),s.lanes|=r;break}c=c.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(at(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),wx(a,r,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}so(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,id(e,r),i=Ca(i),n=n(i),e.flags|=1,so(t,e,n,r),e.child;case 14:return n=e.type,i=Ha(n,e.pendingProps),i=Ha(n.type,i),wE(t,e,n,i,r);case 15:return xI(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Ha(n,i),Qm(t,e),e.tag=1,bo(n)?(t=!0,H2(e)):t=!1,id(e,r),vI(e,n,i),Cx(e,n,i,r),_x(null,e,n,!0,t,r);case 19:return EI(t,e,r);case 22:return CI(t,e,r)}throw Error(at(156,e.tag))};function GI(t,e){return g7(t,e)}function I$(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ma(t,e,r,n){return new I$(t,e,r,n)}function eT(t){return t=t.prototype,!(!t||!t.isReactComponent)}function O$(t){if(typeof t=="function")return eT(t)?1:0;if(t!=null){if(t=t.$$typeof,t===wS)return 11;if(t===xS)return 14}return 2}function nu(t,e){var r=t.alternate;return r===null?(r=ma(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function n2(t,e,r,n,i,o){var a=2;if(n=t,typeof t=="function")eT(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case M0:return Rf(r.children,i,o,e);case yS:a=8,i|=8;break;case j3:return t=ma(12,r,e,i|2),t.elementType=j3,t.lanes=o,t;case H3:return t=ma(13,r,e,i),t.elementType=H3,t.lanes=o,t;case K3:return t=ma(19,r,e,i),t.elementType=K3,t.lanes=o,t;case Jb:return Ny(r,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Xb:a=10;break e;case Yb:a=9;break e;case wS:a=11;break e;case xS:a=14;break e;case Pl:a=16,n=null;break e}throw Error(at(130,t==null?t:typeof t,""))}return e=ma(a,r,e,i),e.elementType=t,e.type=n,e.lanes=o,e}function Rf(t,e,r,n){return t=ma(7,t,n,e),t.lanes=r,t}function Ny(t,e,r,n){return t=ma(22,t,n,e),t.elementType=Jb,t.lanes=r,t.stateNode={isHidden:!1},t}function Sw(t,e,r){return t=ma(6,t,null,e),t.lanes=r,t}function Tw(t,e,r){return e=ma(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function M$(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rw(0),this.expirationTimes=rw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rw(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tT(t,e,r,n,i,o,a,s,c){return t=new M$(t,e,r,s,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=ma(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},FS(o),t}function R$(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O0,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function WI(t){if(!t)return lu;t=t._reactInternals;e:{if(o0(t)!==t||t.tag!==1)throw Error(at(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(bo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(at(171))}if(t.tag===1){var r=t.type;if(bo(r))return W7(t,r,e)}return e}function zI(t,e,r,n,i,o,a,s,c){return t=tT(r,n,!0,t,i,o,a,s,c),t.context=WI(null),r=t.current,n=uo(),i=tu(r),o=Pc(n,i),o.callback=e??null,Ql(r,o,i),t.current.lanes=i,Hp(t,i,n),Io(t,n),t}function ky(t,e,r,n){var i=e.current,o=uo(),a=tu(i);return r=WI(r),e.context===null?e.context=r:e.pendingContext=r,e=Pc(o,a),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Ql(i,e,a),t!==null&&(rs(t,i,a,o),Ym(t,i,a)),a}function ov(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function RE(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function nT(t,e){RE(t,e),(t=t.alternate)&&RE(t,e)}var $I=typeof reportError=="function"?reportError:function(t){console.error(t)};function rT(t){this._internalRoot=t}Vy.prototype.render=rT.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(at(409));ky(t,e,null,null)};Vy.prototype.unmount=rT.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Wf(function(){ky(null,t,null,null)}),e[Uc]=null}};function Vy(t){this._internalRoot=t}Vy.prototype.unstable_scheduleHydration=function(t){if(t){var e=C7();t={blockedOn:null,target:t,priority:e};for(var r=0;r<kl.length&&e!==0&&e<kl[r].priority;r++);kl.splice(r,0,t),r===0&&T7(t)}};function iT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Fy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function PE(){}function P$(t,e,r,n,i){if(i){if(typeof n=="function"){var o=n;n=function(){var l=ov(a);o.call(l)}}var a=zI(e,n,t,0,null,!1,!1,"",PE);return t._reactRootContainer=a,t[Uc]=a.current,tp(t.nodeType===8?t.parentNode:t),Wf(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=ov(c);s.call(l)}}var c=tT(t,0,!1,null,null,!1,!1,"",PE);return t._reactRootContainer=c,t[Uc]=c.current,tp(t.nodeType===8?t.parentNode:t),Wf(function(){ky(e,c,r,n)}),c}function Uy(t,e,r,n,i){var o=r._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var c=ov(a);s.call(c)}}ky(e,a,t,i)}else a=P$(r,e,t,i,n);return ov(a)}w7=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Jh(e.pendingLanes);r!==0&&(TS(e,r|1),Io(e,Wr()),!(In&6)&&(Id=Wr()+500,xu()))}break;case 13:Wf(function(){var n=Bc(t,1);if(n!==null){var i=uo();rs(n,t,1,i)}}),nT(t,1)}};_S=function(t){if(t.tag===13){var e=Bc(t,134217728);if(e!==null){var r=uo();rs(e,t,134217728,r)}nT(t,134217728)}};x7=function(t){if(t.tag===13){var e=tu(t),r=Bc(t,e);if(r!==null){var n=uo();rs(r,t,e,n)}nT(t,e)}};C7=function(){return $n};S7=function(t,e){var r=$n;try{return $n=t,e()}finally{$n=r}};rx=function(t,e,r){switch(e){case"input":if(Y3(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=Oy(n);if(!i)throw Error(at(90));Qb(n),Y3(n,i)}}}break;case"textarea":t7(t,r);break;case"select":e=r.value,e!=null&&ed(t,!!r.multiple,e,!1)}};c7=JS;l7=Wf;var L$={usingClientEntryPoint:!1,Events:[qp,A0,Oy,a7,s7,JS]},Oh={findFiberByHostInstance:Sf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},A$={bundleType:Oh.bundleType,version:Oh.version,rendererPackageName:Oh.rendererPackageName,rendererConfig:Oh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=d7(t),t===null?null:t.stateNode},findFiberByHostInstance:Oh.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var W1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!W1.isDisabled&&W1.supportsFiber)try{Ey=W1.inject(A$),Vs=W1}catch{}}Xo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L$;Xo.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iT(e))throw Error(at(200));return R$(t,e,null,r)};Xo.createRoot=function(t,e){if(!iT(t))throw Error(at(299));var r=!1,n="",i=$I;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tT(t,1,!1,null,null,r,!1,n,i),t[Uc]=e.current,tp(t.nodeType===8?t.parentNode:t),new rT(e)};Xo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(at(188)):(t=Object.keys(t).join(","),Error(at(268,t)));return t=d7(e),t=t===null?null:t.stateNode,t};Xo.flushSync=function(t){return Wf(t)};Xo.hydrate=function(t,e,r){if(!Fy(e))throw Error(at(200));return Uy(null,t,e,!0,r)};Xo.hydrateRoot=function(t,e,r){if(!iT(t))throw Error(at(405));var n=r!=null&&r.hydratedSources||null,i=!1,o="",a=$I;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),e=zI(e,null,t,1,r??null,i,!1,o,a),t[Uc]=e.current,tp(t),n)for(t=0;t<n.length;t++)r=n[t],i=r._getVersion,i=i(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new Vy(e)};Xo.render=function(t,e,r){if(!Fy(e))throw Error(at(200));return Uy(null,t,e,!1,r)};Xo.unmountComponentAtNode=function(t){if(!Fy(t))throw Error(at(40));return t._reactRootContainer?(Wf(function(){Uy(null,null,t,!1,function(){t._reactRootContainer=null,t[Uc]=null})}),!0):!1};Xo.unstable_batchedUpdates=JS;Xo.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Fy(r))throw Error(at(200));if(t==null||t._reactInternals===void 0)throw Error(at(38));return Uy(t,e,r,!1,n)};Xo.version="18.3.1-next-f1338f8080-20240426";function jI(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jI)}catch(t){console.error(t)}}jI(),jb.exports=Xo;var N$=jb.exports,LE=N$;z3.createRoot=LE.createRoot,z3.hydrateRoot=LE.hydrateRoot;var $e;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})($e||($e={}));var Wt;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(Wt||(Wt={}));var Hn;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Hn||(Hn={}));var kx;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(kx||(kx={}));const Ef=kx,r2={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},k$={OFF:0,NORMALIZED:1,RAW:2};var HI={BlendMode:r2,FilterMode:k$};const{BlendMode:Mh}=HI;var Vx;(function(t){t[t.COMPOSITE=Mh.COMPOSITE_BLEND]="COMPOSITE",t[t.MAXIMUM_INTENSITY_BLEND=Mh.MAXIMUM_INTENSITY_BLEND]="MAXIMUM_INTENSITY_BLEND",t[t.MINIMUM_INTENSITY_BLEND=Mh.MINIMUM_INTENSITY_BLEND]="MINIMUM_INTENSITY_BLEND",t[t.AVERAGE_INTENSITY_BLEND=Mh.AVERAGE_INTENSITY_BLEND]="AVERAGE_INTENSITY_BLEND",t[t.LABELMAP_EDGE_PROJECTION_BLEND=Mh.LABELMAP_EDGE_PROJECTION_BLEND]="LABELMAP_EDGE_PROJECTION_BLEND"})(Vx||(Vx={}));const zf=Vx;var As;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(As||(As={}));var Fx;(function(t){t.CONTOUR="CONTOUR",t.SURFACE="SURFACE"})(Fx||(Fx={}));const $f=Fx;var Ux;(function(t){t.CLOSED_PLANAR="CLOSED_PLANAR",t.OPEN_PLANAR="OPEN_PLANAR"})(Ux||(Ux={}));const V$=Ux;var lo;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(lo||(lo={}));var Bx;(function(t){t.SUM="SUM",t.AVERAGE="AVERAGE",t.SUBTRACT="SUBTRACT"})(Bx||(Bx={}));const F$=Bx;var av;(function(t){t.NOT_APPLICABLE="",t.ERMF="ERMF",t.USER="User",t.PROJECTION="Proj",t.REGION="Region",t.ERROR="Error",t.UNCALIBRATED="Uncalibrated"})(av||(av={}));var Gx;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(Gx||(Gx={}));const Uo=Gx;var _o;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(_o||(_o={}));var up;(function(t){t.FRAME="f",t.SECOND="s"})(up||(up={}));const U$=Object.freeze(Object.defineProperty({__proto__:null,get SpeedUnit(){return up}},Symbol.toStringTag,{value:"Module"}));var Wx;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(Wx||(Wx={}));const Bo=Wx;var ad;(function(t){t.SUM="SUM",t.SUBTRACT="SUBTRACT",t.AVERAGE="AVERAGE"})(ad||(ad={}));var zx;(function(t){t.RLE="RLE",t.Volume="Volume"})(zx||(zx={}));const KI=zx,Da=Object.freeze(Object.defineProperty({__proto__:null,BlendModes:zf,CalibrationTypes:av,ContourType:V$,DynamicOperatorType:F$,Events:$e,get GenerateImageType(){return ad},GeometryType:$f,ImageQualityStatus:_o,InterpolationType:Ef,MetadataModules:Bo,OrientationAxis:As,RequestType:Wt,VOILUTFunctionType:lo,VideoEnums:U$,ViewportStatus:Uo,ViewportType:Hn,VoxelManagerEnum:KI},Symbol.toStringTag,{value:"Module"})),$x={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},_r={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(_r);const cs=.001;function qI(t){const e=Object.getOwnPropertyNames(t);for(const r of e){const n=t[r];n&&typeof n=="object"&&qI(n)}return Object.freeze(t)}const B$={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},Wl=qI(B$),XI=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],G$={slicer3D:[160/255,164/255,217/255]},Cu=Object.freeze(Object.defineProperty({__proto__:null,BACKGROUND_COLORS:G$,CPU_COLORMAPS:$x,EPSILON:cs,MPR_CAMERA_VALUES:Wl,RENDERING_DEFAULTS:_r,VIEWPORT_PRESETS:XI},Symbol.toStringTag,{value:"Module"})),Rh={},fp={get:t=>Rh[t],set:t=>{const e=t.id;Rh[e]=t},delete:t=>delete Rh[t],getAll:()=>{const e=Object.keys(Rh).map(r=>Rh[r]);return e.sort((r,n)=>r.id[0]==="_"&&n.id[0]!=="_"?1:r.id[0]!=="_"&&n.id[0]==="_"?-1:0),e}};class W${constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,r){const n=i=>{this.removeEventListener(e,n),r.call(this,i)};this.addEventListener(e,n)}addEventListener(e,r){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(r)===-1&&this.listeners[e].push(r)}addEventListenerDebounced(e,r,n){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[r]){const o=a=>{i[r]&&clearTimeout(i[r].timeoutId),i[r].timeoutId=setTimeout(()=>{r.call(this,a)},n)};i[r]={original:r,handle:o,timeoutId:null},this.addEventListener(e,o)}}removeEventListenerDebounced(e,r){var n;if((n=this.debouncedListeners[e])!=null&&n[r]){const i=this.debouncedListeners[e][r];this.removeEventListener(e,i.handle),clearTimeout(i.timeoutId),delete this.debouncedListeners[e][r]}}removeEventListener(e,r){if(!this.listeners[e])return;const n=this.listeners[e],i=n.length;for(let o=0;o<i;o++)if(n[o]===r){n.splice(o,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const r=this.listeners[e.type].slice(),n=r.length;for(let i=0;i<n;i++)try{r[i].call(this,e)}catch(o){console.error(`error in event listener of type:  ${e.type}`,o)}return!e.defaultPrevented}}const We=new W$;function Cn(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function Qe(t=We,e,r=null){if(!e)throw new Error("Event type was not defined");const n=new CustomEvent(e,{detail:r,cancelable:!0});return t==null?void 0:t.dispatchEvent(n)}var z$=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,i,o;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(i=n;i--!==0;)if(!t(e[i],r[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(r).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;i--!==0;){var a=o[i];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r};const YI=Ys(z$);var AE=Object.prototype.toString,JI=function(e){var r=AE.call(e),n=r==="[object Arguments]";return n||(n=r!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&AE.call(e.callee)==="[object Function]"),n},_w,NE;function $$(){if(NE)return _w;NE=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=JI,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),a=i.call(function(){},"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(d){var h=d.constructor;return h&&h.prototype===d},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var d in window)try{if(!l["$"+d]&&e.call(window,d)&&window[d]!==null&&typeof window[d]=="object")try{c(window[d])}catch{return!0}}catch{return!0}return!1}(),u=function(d){if(typeof window>"u"||!f)return c(d);try{return c(d)}catch{return!1}};t=function(h){var g=h!==null&&typeof h=="object",p=r.call(h)==="[object Function]",v=n(h),w=g&&r.call(h)==="[object String]",m=[];if(!g&&!p&&!v)throw new TypeError("Object.keys called on a non-object");var y=a&&p;if(w&&h.length>0&&!e.call(h,0))for(var x=0;x<h.length;++x)m.push(String(x));if(v&&h.length>0)for(var C=0;C<h.length;++C)m.push(String(C));else for(var S in h)!(y&&S==="prototype")&&e.call(h,S)&&m.push(String(S));if(o)for(var T=u(h),_=0;_<s.length;++_)!(T&&s[_]==="constructor")&&e.call(h,s[_])&&m.push(s[_]);return m}}return _w=t,_w}var j$=Array.prototype.slice,H$=JI,kE=Object.keys,i2=kE?function(e){return kE(e)}:$$(),VE=Object.keys;i2.shim=function(){if(Object.keys){var e=function(){var r=Object.keys(arguments);return r&&r.length===arguments.length}(1,2);e||(Object.keys=function(n){return H$(n)?VE(j$.call(n)):VE(n)})}else Object.keys=i2;return Object.keys||i2};var K$=i2,o2=Object.defineProperty||!1;if(o2)try{o2({},"a",{value:1})}catch{o2=!1}var ZI=o2,q$=SyntaxError,X$=TypeError,Y$=Object.getOwnPropertyDescriptor,a2=Y$;if(a2)try{a2([],"length")}catch{a2=null}var J$=a2,FE=ZI,Z$=q$,h0=X$,UE=J$,Q$=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new h0("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new h0("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new h0("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new h0("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new h0("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new h0("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,s=arguments.length>6?arguments[6]:!1,c=!!UE&&UE(e,r);if(FE)FE(e,r,{configurable:a===null&&c?c.configurable:!a,enumerable:i===null&&c?c.enumerable:!i,value:n,writable:o===null&&c?c.writable:!o});else if(s||!i&&!o&&!a)e[r]=n;else throw new Z$("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},jx=ZI,QI=function(){return!!jx};QI.hasArrayLengthDefineBug=function(){if(!jx)return null;try{return jx([],"length",{value:1}).length!==1}catch{return!0}};var ej=QI,tj=K$,nj=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",rj=Object.prototype.toString,ij=Array.prototype.concat,BE=Q$,oj=function(t){return typeof t=="function"&&rj.call(t)==="[object Function]"},eO=ej(),aj=function(t,e,r,n){if(e in t){if(n===!0){if(t[e]===r)return}else if(!oj(n)||!n())return}eO?BE(t,e,r,!0):BE(t,e,r)},tO=function(t,e){var r=arguments.length>2?arguments[2]:{},n=tj(e);nj&&(n=ij.call(n,Object.getOwnPropertySymbols(e)));for(var i=0;i<n.length;i+=1)aj(t,n[i],e[n[i]],r[n[i]])};tO.supportsDescriptors=!!eO;var nO=tO,s2={exports:{}};typeof self<"u"?s2.exports=self:typeof window<"u"?s2.exports=window:s2.exports=Function("return this")();var rO=s2.exports,sj=rO,iO=function(){return typeof yi!="object"||!yi||yi.Math!==Math||yi.Array!==Array?sj:yi},cj=nO,lj=iO,uj=function(){var e=lj();if(cj.supportsDescriptors){var r=Object.getOwnPropertyDescriptor(e,"globalThis");(!r||r.configurable&&(r.enumerable||!r.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},fj=nO,dj=rO,oO=iO,hj=uj,gj=oO(),aO=function(){return gj};fj(aO,{getPolyfill:oO,implementation:dj,shim:hj});var pj=aO;const mj=Ys(pj),Ja=mj(),sO={vtkObject:()=>null};function Qa(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Ja.console&&Ja.console.error&&Ja.console.error("Invalid VTK object"),null;const e=sO[t.vtkClass];if(!e)return Ja.console&&Ja.console.error&&Ja.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const r={...t};Object.keys(r).forEach(i=>{r[i]&&typeof r[i]=="object"&&r[i].vtkClass&&(r[i]=Qa(r[i]))});const n=e(r);return n&&n.modified&&n.modified(),n}function vj(t,e){sO[t]=e}Qa.register=vj;class Ew extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Hx=0;const cO=Symbol("void");function yj(){return Hx}const lO={};function pf(){}const wj=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];wj.forEach(t=>{lO[t]=pf});Ja.console=console.hasOwnProperty("log")?console:lO;const uu={debug:pf,error:Ja.console.error||pf,info:Ja.console.info||pf,log:Ja.console.log||pf,warn:Ja.console.warn||pf};function uO(t,e){uu[t]&&(uu[t]=e||pf)}function fO(){uu.log(...arguments)}function dO(){uu.info(...arguments)}function sv(){uu.debug(...arguments)}function nn(){uu.error(...arguments)}function By(){uu.warn(...arguments)}const GE={};function hO(t){GE[t]||(uu.error(t),GE[t]=!0)}const Zi=Object.create(null);Zi.Float32Array=Float32Array;Zi.Float64Array=Float64Array;Zi.Uint8Array=Uint8Array;Zi.Int8Array=Int8Array;Zi.Uint16Array=Uint16Array;Zi.Int16Array=Int16Array;Zi.Uint32Array=Uint32Array;Zi.Int32Array=Int32Array;Zi.Uint8ClampedArray=Uint8ClampedArray;try{Zi.BigInt64Array=BigInt64Array,Zi.BigUint64Array=BigUint64Array}catch{}function Xd(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(Zi[t]||Float64Array)(...r)}function Gy(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(Zi[t]||Float64Array).from(...r)}function Wy(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Vr(t){return Wy(t[0]==="_"?t.slice(1):t)}function gO(t){return t.charAt(0).toLowerCase()+t.slice(1)}function pO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const n=["TB","GB","MB","KB"];let i=Number(t),o="B";for(;i>r;)i/=r,o=n.pop();return`${i.toFixed(e)} ${o}`}function mO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const r=[];let n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function vO(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function xj(t){return Object.values(Zi).some(e=>t instanceof e)}function Cj(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Sj(t,e){return Object.keys(t).find(r=>t[r]===e)}function yO(t){return t&&t.isA?t.getState():t}function oT(t){setTimeout(t,0)}function wO(t,e){const r=performance.now();t.finally(()=>{const n=performance.now()-r;e(n)})}function Zn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};vO(e);const r=[];if(Number.isInteger(e.mtime)||(e.mtime=++Hx),!("classHierarchy"in e))e.classHierarchy=new Ew("vtkObject");else if(!(e.classHierarchy instanceof Ew)){const o=new Ew;for(let a=0;a<e.classHierarchy.length;a++)o.push(e.classHierarchy[a]);e.classHierarchy=o}function n(o){r[o]=null}function i(o){function a(){n(o)}return Object.freeze({unsubscribe:a})}return t.isDeleted=()=>!!e.deleted,t.modified=o=>{if(e.deleted){nn("instance deleted - cannot call any method");return}o&&o<t.getMTime()||(e.mtime=++Hx,r.forEach(a=>a&&a(t)))},t.onModified=o=>{if(e.deleted)return nn("instance deleted - cannot call any method"),null;const a=r.length;return r.push(o),i(a)},t.getMTime=()=>e.mtime,t.isA=o=>{let a=e.classHierarchy.length;for(;a--;)if(e.classHierarchy[a]===o)return!0;return!1},t.getClassName=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-o]},t.set=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(o).forEach(l=>{const f=s?null:t[`set${Wy(l)}`];f&&Array.isArray(o[l])&&f.length>1?c=f(...o[l])||c:f?c=f(o[l])||c:(["mtime"].indexOf(l)===-1&&!a&&By(`Warning: Set value to model directly ${l}, ${o[l]}`),c=e[l]!==o[l]||c,e[l]=o[l])}),c},t.get=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];if(!a.length)return e;const c={};return a.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=o=>e[o],t.delete=()=>{Object.keys(e).forEach(o=>delete e[o]),r.forEach((o,a)=>n(a)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const o={...e,vtkClass:t.getClassName()};Object.keys(o).forEach(s=>{o[s]===null||o[s]===void 0||s[0]==="_"?delete o[s]:o[s].isA?o[s]=o[s].getState():Array.isArray(o[s])?o[s]=o[s].map(yO):xj(o[s])&&(o[s]=Array.from(o[s]))});const a={};return Object.keys(o).sort().forEach(s=>{a[s]=o[s]}),a.mtime&&delete a.mtime,a},t.shallowCopy=function(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(o.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${o.getClassName()} into ${t.getClassName()}`);const s=o.get(),c=Object.keys(e).sort();Object.keys(s).sort().forEach(f=>{const u=c.indexOf(f);u===-1?a&&sv(`add ${f} in shallowCopy`):c.splice(u,1),e[f]=s[f]}),c.length&&a&&sv(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Tj={object(t,e,r){return function(){return{...e[r.name]}}}};function mo(t,e,r){r.forEach(n=>{if(typeof n=="object"){const i=Tj[n.type];i?t[`get${Vr(n.name)}`]=i(t,e,n):t[`get${Vr(n.name)}`]=()=>e[n.name]}else t[`get${Vr(n)}`]=()=>e[n]})}const xO={enum(t,e,r){const n=`_on${Vr(r.name)}Changed`;return i=>{var o;if(typeof i=="string"){if(r.enum[i]!==void 0)return e[r.name]!==r.enum[i]?(e[r.name]=r.enum[i],t.modified(),!0):!1;throw nn(`Set Enum with invalid argument ${r}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[r.name]!==i){if(Object.keys(r.enum).map(a=>r.enum[a]).indexOf(i)!==-1){const a=e[r.name];return e[r.name]=i,(o=e[n])==null||o.call(e,t,e,i,a),t.modified(),!0}throw nn(`Set Enum outside numeric range ${r}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw nn(`Set Enum with invalid argument (String/Number) ${r}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){var i;((i=r.params)==null?void 0:i.length)===1&&By('Setter of type "object" with a single "param" field is not supported');const n=`_on${Vr(r.name)}Changed`;return function(){var l,f;for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];let c;if(a.length>1&&((l=r.params)!=null&&l.length)?c=r.params.reduce((u,d,h)=>Object.assign(u,{[d]:a[h]}),{}):c=a[0],!YI(e[r.name],c)){const u=e[r.name];return e[r.name]=c,(f=e[n])==null||f.call(e,t,e,c,u),t.modified(),!0}return!1}}};function WE(t){if(typeof t=="object"){const e=xO[t.type];if(e)return(r,n)=>e(r,n,t);throw nn(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){const i=`_on${Vr(t)}Changed`;return function(a){var s;if(n.deleted)return nn("instance deleted - cannot call any method"),!1;if(n[t]!==a){const c=n[t.name];return n[t]=a,(s=n[i])==null||s.call(n,r,n,a,c),r.modified(),!0}return!1}}}function Yp(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${Vr(n.name)}`]=WE(n)(t,e):t[`set${Vr(n)}`]=WE(n)(t,e)})}function Fr(t,e,r){mo(t,e,r),Yp(t,e,r)}function Yd(t,e,r){r.forEach(n=>{t[`get${Vr(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${Vr(n)}ByReference`]=()=>e[n]})}function aT(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(o=>{if(e[o]&&n&&e[o].length!==n)throw new RangeError(`Invalid initial number of values for array (${o})`);const a=`_on${Vr(o)}Changed`;t[`set${Vr(o)}`]=function(){var h;if(e.deleted)return nn("instance deleted - cannot call any method"),!1;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];let f=c,u,d=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],d=!0),f==null)u=e[o]!==f;else{if(n&&f.length!==n)if(f.length<n&&i!==void 0)for(f=Array.from(f),d=!1;f.length<n;)f.push(i);else throw new RangeError(`Invalid number of values for array setter (${o})`);u=e[o]==null||e[o].length!==f.length;for(let g=0;!u&&g<f.length;++g)u=e[o][g]!==f[g];u&&d&&(f=Array.from(f))}if(u){const g=e[o.name];e[o]=f,(h=e[a])==null||h.call(e,t,e,f,g),t.modified()}return u},t[`set${Vr(o)}From`]=s=>{const c=e[o];s.forEach((l,f)=>{c[f]=l})}})}function sT(t,e,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Yd(t,e,r),aT(t,e,r,n,i)}function Jp(t,e,r){for(let n=0;n<r.length;n++){const i=r[n];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function cT(t,e,r,n){e.inputData?e.inputData=e.inputData.map(Qa):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Qa):e.inputConnection=[],e.output?e.output=e.output.map(Qa):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Qa):e.inputArrayToProcess=[],e.numberOfInputs=r;function i(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){nn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){nn(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[g]!==h||e.inputConnection[g])&&(e.inputData[g]=h,e.inputConnection[g]=null,t.modified&&t.modified())}function o(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]&&(e.inputData[h]=e.inputConnection[h]()),e.inputData[h]}function a(h){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){nn("instance deleted - cannot call any method");return}if(g>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",nn(p);return}e.inputData[g]=null,e.inputConnection[g]=h}function s(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]}function c(){let h=e.numberOfInputs;for(;h&&!e.inputData[h-1]&&!e.inputConnection[h-1];)h--;return h===e.numberOfInputs&&e.numberOfInputs++,h}function l(h){if(e.deleted){nn("instance deleted - cannot call any method");return}a(h,c())}function f(h){if(e.deleted){nn("instance deleted - cannot call any method");return}i(h,c())}function u(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(nn("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[h])}t.shouldUpdate=()=>{var v,w;const h=t.getMTime();let g=1/0,p=n;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const m=e.output[p].getMTime();if(m<h)return!0;m<g&&(g=m)}for(p=e.numberOfInputs;p--;)if((v=e.inputConnection[p])!=null&&v.filter.shouldUpdate()||((w=t.getInputData(p))==null?void 0:w.getMTime())>g)return!0;return!1};function d(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const g=()=>u(h);return g.filter=t,g}if(e.numberOfInputs){let h=e.numberOfInputs;for(;h--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=a,t.addInputData=f,t.addInputConnection=l,t.getInputData=o,t.getInputConnection=s}n&&(t.getOutputData=u,t.getOutputPort=d),t.update=()=>{const h=[];if(e.numberOfInputs){let g=0;for(;g<e.numberOfInputs;)h[g]=t.getInputData(g),g++}t.shouldUpdate()&&t.requestData&&t.requestData(h,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=h=>{const g=e.inputArrayToProcess[h],p=e.inputData[h];return g&&p?p[`get${g.fieldAssociation}`]().getArray(g.arrayName):null},t.setInputArrayToProcess=function(h,g,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<h;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[h]={arrayName:g,fieldAssociation:p,attributeType:v}}}const lT=Symbol("Event abort");function CO(t,e,r){const n=[],i=t.delete;let o=1;function a(l){for(let f=0;f<n.length;++f){const[u]=n[f];if(u===l){n.splice(f,1);return}}}function s(l){function f(){a(l)}return Object.freeze({unsubscribe:f})}function c(){if(e.deleted){nn("instance deleted - cannot call any method");return}const l=n.slice();for(let f=0;f<l.length;++f){const[,u,d]=l[f];if(u){if(d<0)setTimeout(()=>u.apply(t,arguments),1-d);else if(u.apply(t,arguments)===lT)break}}}t[`invoke${Vr(r)}`]=c,t[`on${Vr(r)}`]=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return nn("instance deleted - cannot call any method"),null;const u=o++;return n.push([u,l,f]),n.sort((d,h)=>h[2]-d[2]),s(u)},t.delete=()=>{i(),n.forEach(l=>{let[f]=l;return a(f)})}}function Sn(t,e){const r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},o={};return t(o,i,n),Object.freeze(o)};return e&&Qa.register(e,r),r}function Zp(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e.filter(a=>!!a).map(a=>a(...i))}}function uT(t){return t&&t.isA&&t.isA("vtkObject")}function cv(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(uT(t)){if(n.indexOf(t)>=0)return r;n.push(t);const i=e(t);i!==void 0&&r.push(i);const o=t.get();Object.keys(o).forEach(a=>{const s=o[a];Array.isArray(s)?s.forEach(c=>{cv(c,e,r,n)}):cv(s,e,r,n)})}return r}function SO(t,e,r){var n=this;let i;const o=function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];const l=n,f=()=>{i=null,r||t.apply(l,s)},u=r&&!i;clearTimeout(i),i=setTimeout(f,e),u&&t.apply(l,s)};return o.cancel=()=>clearTimeout(i),o}function TO(t,e){let r=!1,n=null;function i(){r=!1,n!==null&&(o(...n),n=null)}function o(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];if(r){n=s;return}r=!0,t(...s),setTimeout(i,e)}return o}function fT(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,i)=>{e.keystore[n]=i},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}let _j=1;const z1="__root__";function _O(t,e){fT(t,e);const r=t.delete;e.proxyId=`${_j++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),mo(t,e,["proxyId","proxyGroup","proxyName"]),Fr(t,e,["proxyManager"]);const n={},i={};function o(l,f){i[f]||(i[f]=[]);const u=i[f];for(let d=0;d<l.length;d++)u.push(l[d].name),n[l[d].name]=l[d],l[d].children&&l[d].children.length&&o(l[d].children,l[d].name)}o(e.ui,z1),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(n).forEach(f=>delete n[f]),Object.keys(i).forEach(f=>delete i[f]),o(e.ui,z1),t.modified()};function a(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z1;return i[l]}t.updateProxyProperty=(l,f)=>{const u=n[l];u?Object.assign(u,f):n[l]={...f}},t.activate=()=>{if(e.proxyManager){const l=`setActive${Vr(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,f)=>{f in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[f]=[]),e.propertyLinkSubscribers[f].push(l)},t.gcPropertyLinks=l=>{const f=e.propertyLinkSubscribers[l]||[];for(;f.length;)f.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let u=null;const d=[];let h=0,g=!1;function p(x){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(g)return null;const S=[];let T=null;for(h=d.length;h--;){const E=d[h];E.instance===x?T=E:S.push(E)}if(!T)return null;const _=T.instance[`get${Vr(T.propertyName)}`]();if(!Cj(_,u)||C){for(u=_,g=!0;S.length;){const E=S.pop();E.instance.set({[E.propertyName]:u})}g=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=_),_}function v(x,C){const S=[];for(h=d.length;h--;){const T=d[h];T.instance===x&&(T.propertyName===C||C===void 0)&&(T.subscription.unsubscribe(),S.push(h))}for(;S.length;)d.splice(S.pop(),1)}function w(x,C){let S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const T=x.onModified(p),_=d[0];return d.push({instance:x,propertyName:C,subscription:T}),S&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?x.set({[C]:e.propertyLinkMap[l].value}):_&&p(_.instance,!0)),{unsubscribe:()=>v(x,C)}}function m(){for(;d.length;)d.pop().subscription.unsubscribe()}const y={bind:w,unbind:v,unsubscribe:m,persistent:f};return e.propertyLinkMap[l]=y,y};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z1;const f=[],u=e.proxyId,d=a(l)||[];for(let h=0;h<d.length;h++){const g=d[h],p=t[`get${Vr(g)}`],v=p?p():void 0,w={id:u,name:g,value:v},m=s(g);m.length&&(w.children=m),f.push(w)}return f}t.listPropertyNames=()=>s().map(l=>l.name),t.getPropertyByName=l=>s().find(f=>f.name===l),t.getPropertyDomainByName=l=>(n[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:s()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let f=l.length;for(;f--;)e.propertyLinkMap[l[f]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:f,property:u,persistent:d,updateOnBind:h,type:g}=e.links[l];if(g==="application"){const p=e.proxyManager.getPropertyLink(f,d);t.registerPropertyLinkForGC(p,"application"),p.bind(t,u,h)}}}oT(c)}function EO(t,e,r){const n=t.delete,i=[],o=Object.keys(r);let a=o.length;for(;a--;){const s=o[a],{modelKey:c,property:l,modified:f=!0}=r[s],u=Vr(l),d=Vr(s);t[`get${d}`]=e[c][`get${u}`],t[`set${d}`]=e[c][`set${u}`],f&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();n()}}function DO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(s){const c=Object.keys(s);let l=c.length;for(;l--;){const f=c[l];e[f].set(s[f])}}const o=Object.keys(n);let a=o.length;for(;a--;){const s=o[a];e[s]=n[s];const c=r[s];t[`set${Vr(s)}`]=l=>{if(l!==e[s]){e[s]=l;const f=c[l];i(f),t.modified()}}}o.length&&mo(t,e,o)}const zE=10,$E=40,jE=800;function bO(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*zE,i=r*zE,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=$E,i*=$E):(n*=jE,i*=jE)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:i||n}}var K={algo:cT,capitalize:Wy,chain:Zp,debounce:SO,enumToString:Sj,event:CO,EVENT_ABORT:lT,formatBytesToProperUnit:pO,formatNumbersWithThousandSeparator:mO,get:mo,getArray:Yd,getCurrentGlobalMTime:yj,getStateArrayMapFunc:yO,isVtkObject:uT,keystore:fT,measurePromiseExecution:wO,moveToProtected:Jp,newInstance:Sn,newTypedArray:Xd,newTypedArrayFrom:Gy,normalizeWheel:bO,obj:Zn,proxy:_O,proxyPropertyMapping:EO,proxyPropertyState:DO,safeArrays:vO,set:Yp,setArray:aT,setGet:Fr,setGetArray:sT,setImmediate:oT,setLoggerFunction:uO,throttle:TO,traverseInstanceTree:cv,TYPED_ARRAYS:Zi,uncapitalize:gO,VOID:cO,vtkDebugMacro:sv,vtkErrorMacro:nn,vtkInfoMacro:dO,vtkLogMacro:fO,vtkOnceErrorMacro:hO,vtkWarningMacro:By,objectSetterMap:xO},Ni=Object.freeze({__proto__:null,VOID:cO,setLoggerFunction:uO,vtkLogMacro:fO,vtkInfoMacro:dO,vtkDebugMacro:sv,vtkErrorMacro:nn,vtkWarningMacro:By,vtkOnceErrorMacro:hO,TYPED_ARRAYS:Zi,newTypedArray:Xd,newTypedArrayFrom:Gy,capitalize:Wy,_capitalize:Vr,uncapitalize:gO,formatBytesToProperUnit:pO,formatNumbersWithThousandSeparator:mO,setImmediateVTK:oT,measurePromiseExecution:wO,obj:Zn,get:mo,set:Yp,setGet:Fr,getArray:Yd,setArray:aT,setGetArray:sT,moveToProtected:Jp,algo:cT,EVENT_ABORT:lT,event:CO,newInstance:Sn,chain:Zp,isVtkObject:uT,traverseInstanceTree:cv,debounce:SO,throttle:TO,keystore:fT,proxy:_O,proxyPropertyMapping:EO,proxyPropertyState:DO,normalizeWheel:bO,default:K});const IO={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ht={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Ej=Ht.FLOAT;var OO={DefaultDataType:Ej,DataTypeByteSize:IO,VtkDataTypes:Ht};const Dj="WebGL",lv=Object.create(null);function MO(t,e){lv[t]=e}function bj(){return Object.keys(lv)}function RO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lv[t]&&lv[t](e)}function Ij(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return RO(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{const r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{const i=n.getViewProps(),o=e._views[0].getViewNodeFor(n);i.forEach(a=>{if(a.getVisibility()){r.propCount+=1;const s=a.getMapper&&a.getMapper();if(s&&s.getPrimitiveCount){const c=o.getViewNodeFor(s);if(c){c.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const l=s.getPrimitiveCount();Object.keys(l).forEach(f=>{r[f]||(r[f]=0),r[f]+=l[f]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return K.setImmediate(t.render),e._views.map(i=>i.captureNextImage?i.captureNextImage(r,n):void 0).filter(i=>!!i)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{const n=e.childRenderWindows.findIndex(i=>i===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}const Oj={defaultViewAPI:Dj,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function PO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oj,r),K.obj(t,e),K.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),K.get(t,e,["neverRendered"]),K.getArray(t,e,["renderers","childRenderWindows"]),K.moveToProtected(t,e,["views"]),K.event(t,e,"completion"),Ij(t,e)}const Mj=K.newInstance(PO,"vtkRenderWindow");var Rj={newInstance:Mj,extend:PO,registerViewConstructor:MO,listViewAPIs:bj,newAPISpecificView:RO};const dp={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},_t={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var LO={Wrap:dp,Filter:_t};const AO=new Float32Array(1),Pj=new Int32Array(AO.buffer);function Lj(t){AO[0]=t;const e=Pj[0];let r=e>>16&32768,n=e>>12&2047;const i=e>>23&255;return i<103?r:i>142?(r|=31744,r|=(i===255?0:1)&&e&8388607,r):i<113?(n|=2048,r|=(n>>114-i)+(n>>113-i&1),r):(r|=i-112<<10|n>>1,r+=n&1,r)}function Aj(t){const e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var mf={fromHalf:Aj,toHalf:Lj},dT={exports:{}};dT.exports;(function(t){(function(e,r,n){function i(c){var l=this,f=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=f(" "),l.s1=f(" "),l.s2=f(" "),l.s0-=f(c),l.s0<0&&(l.s0+=1),l.s1-=f(c),l.s1<0&&(l.s1+=1),l.s2-=f(c),l.s2<0&&(l.s2+=1),f=null}function o(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function a(c,l){var f=new i(c),u=l&&l.state,d=f.next;return d.int32=function(){return f.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,f),d.state=function(){return o(f,{})}),d}function s(){var c=4022871197,l=function(f){f=String(f);for(var u=0;u<f.length;u++){c+=f.charCodeAt(u);var d=.02519603282416938*c;c=d>>>0,d-=c,d*=c,c=d>>>0,d-=c,c+=d*4294967296}return(c>>>0)*23283064365386963e-26};return l}r.exports?r.exports=a:this.alea=a})(yi,t)})(dT);var Nj=dT.exports,hT={exports:{}};hT.exports;(function(t){(function(e,r,n){function i(s){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var u=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^u^u>>>8},s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r.exports?r.exports=a:this.xor128=a})(yi,t)})(hT);var kj=hT.exports,gT={exports:{}};gT.exports;(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(u^u<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(s|0)?c.x=s:l+=s;for(var f=0;f<l.length+64;f++)c.x^=l.charCodeAt(f)|0,f==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r.exports?r.exports=a:this.xorwow=a})(yi,t)})(gT);var Vj=gT.exports,pT={exports:{}};pT.exports;(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var f=c.x,u=c.i,d,h;return d=f[u],d^=d>>>7,h=d^d<<24,d=f[u+1&7],h^=d^d>>>10,d=f[u+3&7],h^=d^d>>>3,d=f[u+4&7],h^=d^d<<7,d=f[u+7&7],d=d^d<<13,h^=d^d<<9,f[u]=h,c.i=u+1&7,h};function l(f,u){var d,h=[];if(u===(u|0))h[0]=u;else for(u=""+u,d=0;d<u.length;++d)h[d&7]=h[d&7]<<15^u.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],f.x=h,f.i=0,d=256;d>0;--d)f.next()}l(c,s)}function o(s,c){return c.x=s.x.slice(),c.i=s.i,c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(f.x&&o(f,l),u.state=function(){return o(l,{})}),u}r.exports?r.exports=a:this.xorshift7=a})(yi,t)})(pT);var Fj=pT.exports,mT={exports:{}};mT.exports;(function(t){(function(e,r,n){function i(s){var c=this;c.next=function(){var f=c.w,u=c.X,d=c.i,h,g;return c.w=f=f+1640531527|0,g=u[d+34&127],h=u[d=d+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=u[d]=g^h,c.i=d,g+(f^f>>>16)|0};function l(f,u){var d,h,g,p,v,w=[],m=128;for(u===(u|0)?(h=u,u=null):(u=u+"\0",h=0,m=Math.max(m,u.length)),g=0,p=-32;p<m;++p)u&&(h^=u.charCodeAt((p+32)%u.length)),p===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(v=v+1640531527|0,d=w[p&127]^=h+v,g=d==0?g+1:0);for(g>=128&&(w[(u&&u.length||0)&127]=-1),g=127,p=4*128;p>0;--p)h=w[g+34&127],d=w[g=g+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,w[g]=h^d;f.w=v,f.X=w,f.i=g}l(c,s)}function o(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function a(s,c){s==null&&(s=+new Date);var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(f.X&&o(f,l),u.state=function(){return o(l,{})}),u}r.exports?r.exports=a:this.xor4096=a})(yi,t)})(mT);var Uj=mT.exports,vT={exports:{}};vT.exports;(function(t){(function(e,r,n){function i(s){var c=this,l="";c.next=function(){var u=c.b,d=c.c,h=c.d,g=c.a;return u=u<<25^u>>>7^d,d=d-h|0,h=h<<24^h>>>8^g,g=g-u|0,c.b=u=u<<20^u>>>12^d,c.c=d=d-h|0,c.d=h<<16^d>>>16^g,c.a=g-u|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=s|0):l+=s;for(var f=0;f<l.length+20;f++)c.b^=l.charCodeAt(f)|0,c.next()}function o(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function a(s,c){var l=new i(s),f=c&&c.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,h=(l.next()>>>0)/4294967296,g=(d+h)/(1<<21);while(g===0);return g},u.int32=l.next,u.quick=u,f&&(typeof f=="object"&&o(f,l),u.state=function(){return o(l,{})}),u}r.exports?r.exports=a:this.tychei=a})(yi,t)})(vT);var Bj=vT.exports,NO={exports:{}};const Gj={},Wj=Object.freeze(Object.defineProperty({__proto__:null,default:Gj},Symbol.toStringTag,{value:"Module"})),zs=lW(Wj);(function(t){(function(e,r,n){var i=256,o=6,a=52,s="random",c=n.pow(i,o),l=n.pow(2,a),f=l*2,u=i-1,d;function h(x,C,S){var T=[];C=C==!0?{entropy:!0}:C||{};var _=w(v(C.entropy?[x,y(r)]:x??m(),3),T),E=new g(T),D=function(){for(var b=E.g(o),I=c,R=0;b<l;)b=(b+R)*i,I*=i,R=E.g(1);for(;b>=f;)b/=2,I/=2,R>>>=1;return(b+R)/I};return D.int32=function(){return E.g(4)|0},D.quick=function(){return E.g(4)/4294967296},D.double=D,w(y(E.S),r),(C.pass||S||function(b,I,R,M){return M&&(M.S&&p(M,E),b.state=function(){return p(E,{})}),R?(n[s]=b,I):b})(D,_,"global"in C?C.global:this==n,C.state)}function g(x){var C,S=x.length,T=this,_=0,E=T.i=T.j=0,D=T.S=[];for(S||(x=[S++]);_<i;)D[_]=_++;for(_=0;_<i;_++)D[_]=D[E=u&E+x[_%S]+(C=D[_])],D[E]=C;(T.g=function(b){for(var I,R=0,M=T.i,P=T.j,k=T.S;b--;)I=k[M=u&M+1],R=R*i+k[u&(k[M]=k[P=u&P+I])+(k[P]=I)];return T.i=M,T.j=P,R})(i)}function p(x,C){return C.i=x.i,C.j=x.j,C.S=x.S.slice(),C}function v(x,C){var S=[],T=typeof x,_;if(C&&T=="object")for(_ in x)try{S.push(v(x[_],C-1))}catch{}return S.length?S:T=="string"?x:x+"\0"}function w(x,C){for(var S=x+"",T,_=0;_<S.length;)C[u&_]=u&(T^=C[u&_]*19)+S.charCodeAt(_++);return y(C)}function m(){try{var x;return d&&(x=d.randomBytes)?x=x(i):(x=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(x)),y(x)}catch{var C=e.navigator,S=C&&C.plugins;return[+new Date,e,S,e.screen,y(r)]}}function y(x){return String.fromCharCode.apply(0,x)}if(w(n.random(),r),t.exports){t.exports=h;try{d=zs}catch{}}else n["seed"+s]=h})(typeof self<"u"?self:yi,[],Math)})(NO);var zj=NO.exports,$j=Nj,jj=kj,Hj=Vj,Kj=Fj,qj=Uj,Xj=Bj,a0=zj;a0.alea=$j;a0.xor128=jj;a0.xorwow=Hj;a0.xorshift7=Kj;a0.xor4096=qj;a0.tychei=Xj;var Yj=a0;const Jj=Ys(Yj),yT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Zj=[1,0,0,0,1,0,0,0,1],wT=1e-6,xT=1e-12,{vtkErrorMacro:kO,vtkWarningMacro:jf}=K;let VO=0;const HE=20;function Qp(t){return()=>kO(`vtkMath::${t} - NOT IMPLEMENTED`)}function Sg(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[r*e+o],t[r*e+o]=t[n*e+o],t[n*e+o]=i}function Qh(t,e,r,n){let i;for(let o=0;o<e;o++)i=t[o*e+r],t[o*e+r]=t[o*e+n],t[o*e+n]=i}function er(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}const Qj=()=>Math.PI;function Tr(t){return t/180*Math.PI}function uv(t){return t*180/Math.PI}const{round:eg,floor:CT,ceil:eH,min:tH,max:nH}=Math;function rH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0;for(let i=e,o=t.length;i<o;i+=r)t[i]<n&&(n=t[i]);return n}function iH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=-1/0;for(let i=e,o=t.length;i<o;i+=r)n<t[i]&&(n=t[i]);return n}function oH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=1/0,i=-1/0;for(let o=e,a=t.length;o<a;o+=r)t[o]<n&&(n=t[o]),i<t[o]&&(i=t[o]);return[n,i]}const aH=Qp("ceilLog2"),sH=Qp("factorial");function ha(t){let e=1;for(;e<t;)e*=2;return e}function tg(t){return t===ha(t)}function cH(t,e){let r=1;for(let n=1;n<=e;++n)r*=(t-n+1)/n;return Math.floor(r)}function lH(t,e){if(t<e)return 0;const r=er(e);for(let n=0;n<e;++n)r[n]=n;return r}function uH(t,e,r){let n=0;for(let i=e-1;i>=0;--i)if(r[i]<t-e+i){let o=r[i]+1;for(;i<e;)r[i++]=o++;n=1;break}return n}function fH(t){Jj(`${t}`,{global:!0}),VO=t}function dH(){return VO}function hH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+r*Math.random()}const gH=Qp("gaussian");function fv(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Lc(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function FO(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function UO(t,e){return t[0]*=e,t[1]*=e,t}function Kx(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function pH(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function qt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mH(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[0]*e[2],r[3]=t[1]*e[0],r[4]=t[1]*e[1],r[5]=t[1]*e[2],r[6]=t[2]*e[0],r[7]=t[2]*e[1],r[8]=t[2]*e[2]}function $s(t,e,r){const n=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],o=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=i,r[2]=o,r}function zl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function Hf(t){const e=zl(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function vH(t,e,r,n){const i=t[0]*t[0],o=t[1]*t[1],a=t[2]*t[2],s=Math.sqrt(i+o+a);let c,l,f;i>o&&i>a?(c=0,l=1,f=2):o>a?(c=1,l=2,f=0):(c=2,l=0,f=1);const u=t[c]/s,d=t[l]/s,h=t[f]/s,g=Math.sqrt(u*u+h*h);if(n!==0){const p=Math.sin(n),v=Math.cos(n);e&&(e[c]=(h*v-u*d*p)/g,e[l]=p*g,e[f]=(-(u*v)-d*h*p)/g),r&&(r[c]=(-(h*p)-u*d*v)/g,r[l]=v*g,r[f]=(u*p-d*h*v)/g)}else e&&(e[c]=h/g,e[l]=0,e[f]=-u/g),r&&(r[c]=-u*d/g,r[l]=g,r[f]=-d*h/g)}function yH(t,e,r){const n=qt(e,e);if(n===0)return r[0]=0,r[1]=0,r[2]=0,!1;const i=qt(t,e)/n;for(let o=0;o<3;o++)r[o]=e[o];return FO(r,i),!0}function qx(t,e){return t[0]*e[0]+t[1]*e[1]}function wH(t,e,r){const n=qx(e,e);if(n===0)return r[0]=0,r[1]=0,!1;const i=qx(t,e)/n;for(let o=0;o<2;o++)r[o]=e[o];return UO(r,i),!0}function Ms(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function xH(t,e){const r=[0,0,0];return $s(t,e,r),Math.atan2(zl(r),qt(t,e))}function CH(t,e,r){const n=Math.abs(t-r);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(n**2)/(2*e))}function SH(t,e,r){const n=Math.abs(t-r);return Math.exp(-(n**2)/(2*e))}function TH(t,e,r){r[0]=t[0]*e[0],r[1]=t[0]*e[1],r[2]=t[1]*e[0],r[3]=t[1]*e[1]}function BO(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function GO(t){const e=BO(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Er(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function _H(t,e){let r,n,i;const o=[0,0,0];for(let a=0;a<3;a++)i=Math.abs(t[a*3]),(n=Math.abs(t[a*3+1]))>i&&(i=n),(n=Math.abs(t[a*3+2]))>i&&(i=n),o[a]=1/i;i=o[0]*Math.abs(t[0]),r=0,(n=o[1]*Math.abs(t[3]))>=i&&(i=n,r=1),(n=o[2]*Math.abs(t[6]))>=i&&(r=2),r!==0&&(Sg(t,3,r,0),o[r]=o[0]),e[0]=r,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=o[1]*Math.abs(t[4]),r=1,(n=o[2]*Math.abs(t[7]))>=i&&(r=2,Sg(t,3,1,2),o[2]=o[1]),e[1]=r,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function EH(t,e,r){let n=r[e[0]];r[e[0]]=r[0],r[0]=n,n=r[e[1]],r[e[1]]=r[1],r[1]=n-t[3]*r[0],n=r[e[2]],r[e[2]]=r[2],r[2]=n-t[6]*r[0]-t[7]*r[1],r[2]/=t[8],r[1]=(r[1]-t[5]*r[2])/t[4],r[0]=(r[0]-t[1]*r[1]-t[2]*r[2])/t[0]}function DH(t,e,r){const n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],c=t[5],l=t[6],f=t[7],u=t[8],d=+Er(s,f,c,u),h=-Er(a,l,c,u),g=+Er(a,l,s,f),p=-Er(i,f,o,u),v=+Er(n,l,o,u),w=-Er(n,l,i,f),m=+Er(i,s,o,c),y=-Er(n,a,o,c),x=+Er(n,a,i,s),C=n*d+i*h+o*g,S=d*e[0]+p*e[1]+m*e[2],T=h*e[0]+v*e[1]+y*e[2],_=g*e[0]+w*e[1]+x*e[2];r[0]=S/C,r[1]=T/C,r[2]=_/C}function c2(t,e,r){const n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],o=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];r[0]=n,r[1]=i,r[2]=o}function Xx(t,e,r){const n=[...t],i=[...e];for(let o=0;o<3;o++)r[o]=n[0]*i[o]+n[1]*i[o+3]+n[2]*i[o+6],r[o+3]=n[3]*i[o]+n[4]*i[o+3]+n[5]*i[o+6],r[o+6]=n[6]*i[o]+n[7]*i[o+3]+n[8]*i[o+6]}function bH(t,e,r,n,i,o,a){n!==i&&kO("Number of columns of A must match number of rows of B.");const s=[...t],c=[...e];for(let l=0;l<r;l++)for(let f=0;f<o;f++){a[l*o+f]=0;for(let u=0;u<n;u++)a[l*o+f]+=s[l*n+u]*c[f+o*u]}}function sd(t,e){let r;r=t[3],e[3]=t[1],e[1]=r,r=t[6],e[6]=t[2],e[2]=r,r=t[7],e[7]=t[5],e[5]=r,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function IH(t,e){const r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=+Er(a,l,s,f),d=-Er(o,c,s,f),h=+Er(o,c,a,l),g=-Er(n,l,i,f),p=+Er(r,c,i,f),v=-Er(r,c,n,l),w=+Er(n,a,i,s),m=-Er(r,o,i,s),y=+Er(r,o,n,a),x=r*u+n*d+i*h;x===0&&jf("Matrix has 0 determinant"),e[0]=u/x,e[3]=d/x,e[6]=h/x,e[1]=g/x,e[4]=p/x,e[7]=v/x,e[2]=w/x,e[5]=m/x,e[8]=y/x}function zy(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function WO(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wT;if(t.length!==e.length)return!1;function n(i,o){return Math.abs(i-e[o])<=r}return t.every(n)}const e1=WO;function zO(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function $O(t,e){for(let r=0;r<t;r++){for(let n=0;n<t;n++)e[r*t+n]=0;e[r*t+r]=1}return e}function OH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wT;return e1(t,yT,e)}function MH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wT;return e1(t,Zj,e)}function jO(t,e){const r=t[0]*t[0],n=t[0]*t[1],i=t[0]*t[2],o=t[0]*t[3],a=t[1]*t[1],s=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],f=t[1]*t[3],u=t[2]*t[3],d=a+s+c;let h=1/(r+d);const g=(r-d)*h;h*=2,e[0]=a*h+g,e[3]=(l+o)*h,e[6]=(f-i)*h,e[1]=(l-o)*h,e[4]=s*h+g,e[7]=(u+n)*h,e[2]=(f+i)*h,e[5]=(u-n)*h,e[8]=c*h+g}function l2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const r=`${t}`.split("e");let n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function Yx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=l2(t[0],r),e[1]=l2(t[1],r),e[2]=l2(t[2],r),e}function t1(t,e,r,n){let i,o,a,s,c,l,f,u,d,h,g,p,v,w,m,y;const x=er(e),C=er(e),S=(_,E,D)=>{w=_[E],v=_[D],_[E]=w-p*(v+w*h),_[D]=v+p*(w-v*h)};for($O(e,n),c=0;c<e;c++)x[c]=r[c]=t[c+c*e],C[c]=0;for(i=0;i<HE;i++){for(g=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)g+=Math.abs(t[c*e+s]);if(g===0)break;for(i<3?f=.2*g/(e*e):f=0,c=0;c<e-1;c++)for(s=c+1;s<e;s++)if(w=100*Math.abs(t[c*e+s]),i>3&&Math.abs(r[c])+w===Math.abs(r[c])&&Math.abs(r[s])+w===Math.abs(r[s]))t[c*e+s]=0;else if(Math.abs(t[c*e+s])>f){for(v=r[s]-r[c],Math.abs(v)+w===Math.abs(v)?d=t[c*e+s]/v:(u=.5*v/t[c*e+s],d=1/(Math.abs(u)+Math.sqrt(1+u*u)),u<0&&(d=-d)),m=1/Math.sqrt(1+d*d),p=d*m,h=p/(1+m),v=d*t[c*e+s],C[c]-=v,C[s]+=v,r[c]-=v,r[s]+=v,t[c*e+s]=0,o=0;o<=c-1;o++)S(t,o*e+c,o*e+s);for(o=c+1;o<=s-1;o++)S(t,c*e+o,o*e+s);for(o=s+1;o<e;o++)S(t,c*e+o,s*e+o);for(o=0;o<e;o++)S(n,o*e+c,o*e+s)}for(c=0;c<e;c++)x[c]+=C[c],r[c]=x[c],C[c]=0}if(i>=HE)return jf("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(o=0;o<e-1;o++){for(a=o,y=r[a],i=o+1;i<e;i++)(r[i]>=y||Math.abs(r[i]-y)<xT)&&(a=i,y=r[a]);a!==o&&(r[a]=r[o],r[o]=y,Qh(n,e,o,a))}const T=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)n[i]>=0&&l++;if(l<T)for(i=0;i<e;i++)n[i*e+o]*=-1;return 1}function HO(t,e){const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r[0]=t[0]+t[4]+t[8],r[5]=t[0]-t[4]-t[8],r[10]=-t[0]+t[4]-t[8],r[15]=-t[0]-t[4]+t[8],r[1]=r[4]=t[7]-t[5],r[2]=r[8]=t[2]-t[6],r[3]=r[12]=t[3]-t[1],r[6]=r[9]=t[3]+t[1],r[7]=r[13]=t[2]+t[6],r[11]=r[14]=t[7]+t[5];const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],o=[...r];t1(o,4,i,n),e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12]}function RH(t,e,r){const n=t[0]*e[0],i=t[0]*e[1],o=t[0]*e[2],a=t[0]*e[3],s=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],f=t[1]*e[3],u=t[2]*e[0],d=t[2]*e[1],h=t[2]*e[2],g=t[2]*e[3],p=t[3]*e[0],v=t[3]*e[1],w=t[3]*e[2],m=t[3]*e[3];r[0]=n-c-h-m,r[1]=i+s+g-w,r[2]=o-f+u+v,r[3]=a+l-d+p}function KO(t,e){for(let d=0;d<9;d++)e[d]=t[d];const r=er(3),n=er(3);let i;for(let d=0;d<3;d++){const h=Math.abs(e[d*3]),g=Math.abs(e[d*3+1]),p=Math.abs(e[d*3+2]);i=g>h?g:h,i=p>i?p:i,r[d]=1,i!==0&&(r[d]/=i)}const o=Math.abs(e[0])*r[0],a=Math.abs(e[3])*r[1],s=Math.abs(e[6])*r[2];n[0]=0,i=o,a>=i&&(i=a,n[0]=1),s>=i&&(n[0]=2),n[0]!==0&&(Qh(e,3,n[0],0),r[n[0]]=r[0]);const c=Math.abs(e[4])*r[1],l=Math.abs(e[7])*r[2];n[1]=1,i=c,l>=i&&(n[1]=2,Qh(e,3,1,2)),n[2]=2;let f=0;if(zy(e)<0){f=1;for(let d=0;d<9;d++)e[d]=-e[d]}const u=er(4);if(HO(e,u),jO(u,e),f)for(let d=0;d<9;d++)e[d]=-e[d];n[1]!==1&&Qh(e,3,n[1],1),n[0]!==0&&Qh(e,3,n[0],0)}function qO(t,e,r){let n,i,o,a,s,c;const l=[...t];if(t1(l,3,e,r),e[0]===e[1]&&e[0]===e[2]){zO(r);return}for(sd(r,r),n=0;n<3;n++)if(e[(n+1)%3]===e[(n+2)%3]){for(c=Math.abs(r[n*3]),a=0,i=1;i<3;i++)c<(s=Math.abs(r[n*3+i]))&&(c=s,a=i);a!==n&&(s=e[a],e[a]=e[n],e[n]=s,Sg(r,3,n,a)),r[a*3+a]<0&&(r[a*3]=-r[a*3],r[a*3+1]=-r[a*3+1],r[a*3+2]=-r[a*3+2]),i=(a+1)%3,o=(a+2)%3,r[i*3]=0,r[i*3+1]=0,r[i*3+2]=0,r[i*3+i]=1;const f=$s([r[a*3],r[a*3+1],r[a*3+2]],[r[i*3],r[i*3+1],r[i*3+2]],[]);Hf(f);const u=$s(f,[r[a*3],r[a*3+1],r[a*3+2]],[]);for(let d=0;d<3;d++)r[o*3+d]=f[d],r[i*3+d]=u[d];sd(r,r);return}for(c=Math.abs(r[0]),a=0,n=1;n<3;n++)c<(s=Math.abs(r[n*3]))&&(c=s,a=n);if(a!==0){const f=e[a];e[a]=e[0],e[0]=f,Sg(r,3,a,0)}if(Math.abs(r[4])<Math.abs(r[7])){const f=e[2];e[2]=e[1],e[1]=f,Sg(r,3,1,2)}for(n=0;n<2;n++)r[n*3+n]<0&&(r[n*3]=-r[n*3],r[n*3+1]=-r[n*3+1],r[n*3+2]=-r[n*3+2]);zy(r)<0&&(r[6]=-r[6],r[7]=-r[7],r[8]=-r[8]),sd(r,r)}function PH(t,e,r,n){let i;const o=[...t],a=zy(o);if(a<0)for(i=0;i<9;i++)o[i]=-o[i];KO(o,e),sd(o,o),Xx(o,e,n),qO(n,r,n),Xx(e,n,e),sd(n,n),a<0&&(r[0]=-r[0],r[1]=-r[1],r[2]=-r[2])}function ST(t,e,r){let n,i,o,a,s=0,c,l,f;const u=er(r);for(n=0;n<r;n++){for(a=0,i=0;i<r;i++)(f=Math.abs(t[n*r+i]))>a&&(a=f);if(a===0)return jf("Unable to factor linear system"),0;u[n]=1/a}for(i=0;i<r;i++){for(n=0;n<i;n++){for(c=t[n*r+i],o=0;o<n;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c}for(a=0,n=i;n<r;n++){for(c=t[n*r+i],o=0;o<i;o++)c-=t[n*r+o]*t[o*r+i];t[n*r+i]=c,(l=u[n]*Math.abs(c))>=a&&(a=l,s=n)}if(i!==s){for(o=0;o<r;o++)l=t[s*r+o],t[s*r+o]=t[i*r+o],t[i*r+o]=l;u[s]=u[i]}if(e[i]=s,Math.abs(t[i*r+i])<=xT)return jf("Unable to factor linear system"),0;if(i!==r-1)for(l=1/t[i*r+i],n=i+1;n<r;n++)t[n*r+i]*=l}return 1}function TT(t,e,r,n){let i,o,a,s,c;for(a=-1,i=0;i<n;i++){if(s=e[i],c=r[s],r[s]=r[i],a>=0)for(o=a;o<=i-1;o++)c-=t[i*n+o]*r[o];else c!==0&&(a=i);r[i]=c}for(i=n-1;i>=0;i--){for(c=r[i],o=i+1;o<n;o++)c-=t[i*n+o]*r[o];r[i]=c/t[i*n+i]}}function XO(t,e,r){if(r===2){const i=er(2),o=Er(t[0],t[1],t[2],t[3]);return o===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/o,i[1]=(-(t[2]*e[0])+t[0]*e[1])/o,e[0]=i[0],e[1]=i[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);const n=er(r);return ST(t,n,r)===0?0:(TT(t,n,e,r),1)}function YO(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const o=n||er(r),a=i||er(r);if(ST(t,o,r)===0)return null;for(let s=0;s<r;s++){for(let c=0;c<r;c++)a[c]=0;a[s]=1,TT(t,o,a,r);for(let c=0;c<r;c++)e[c*r+s]=a[c]}return e}function LH(t,e){let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let o=i;o<e;o++)Math.abs(t[i*e+o])>n&&(n=Math.abs(t[i*e+o]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<r&&(r=Math.abs(t[i*e+i]));return r===0?Number.MAX_VALUE:n/r}function AH(t,e,r){return t1(t,3,e,r)}function Jx(t,e,r,n){if(t<r)return jf("Insufficient number of samples. Underdetermined."),0;let i,o,a;const s=er(r*r),c=er(r),l=er(r*r);for(a=0;a<t;a++)for(i=0;i<r;i++)for(o=i;o<r;o++)s[i*r+o]+=e[a*r+i]*e[a*r+o];for(i=0;i<r;i++)for(o=0;o<i;o++)s[i*r+o]=s[o*r+i];for(t1(s,r,c,l),i=0;i<r;i++)n[i]=l[i*r+r-1];return 1}function NH(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<r||t<i)return jf("Insufficient number of samples. Underdetermined."),0;const s=er(i);let c=1,l,f=0,u,d,h,g=0;if(a){for(d=0;d<i;d++)s[d]=1;for(u=0;u<t;u++)for(d=0;d<i;d++)Math.abs(n[u*i+d])>xT&&(c=0,s[d]=0);if(c&&i===1)return jf("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),Jx(t,e,r,o);if(c)g=1;else for(d=0;d<i;d++)s[d]&&(g=1)}g&&(l=er(r),f=Jx(t,e,r,l));const p=er(r*r),v=er(r*r),w=er(r*i);for(h=0;h<t;h++)for(u=0;u<r;u++){for(d=u;d<r;d++)p[u*r+d]+=e[h*r+u]*e[h*r+d];for(d=0;d<i;d++)w[u*i+d]+=e[h*r+u]*n[h*i+d]}for(u=0;u<r;u++)for(d=0;d<u;d++)p[u*r+d]=p[d*r+u];const m=YO(p,v,r);if(m)for(u=0;u<r;u++)for(d=0;d<i;d++)for(o[u*i+d]=0,h=0;h<r;h++)o[u*i+d]+=v[u*r+h]*w[h*i+d];if(g){for(d=0;d<i;d++)if(s[d])for(u=0;u<r;u++)o[u*i+d]=l[u*i]}return g?f&&m:m}function kH(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function ng(t,e){let r,n;const[i,o,a]=t,s=1/3,c=1/6,l=2/3;let f=i,u=i;o>f?f=o:o<u&&(u=o),a>f?f=a:a<u&&(u=a);const d=f;d>0?n=(f-u)/f:n=0,n>0?(i===f?r=c*(o-a)/(f-u):o===f?r=s+c*(a-i)/(f-u):r=l+c*(i-o)/(f-u),r<0&&(r+=1)):r=0,e[0]=r,e[1]=n,e[2]=d}function vf(t,e){const[r,n,i]=t,o=1/3,a=1/6,s=2/3,c=5/6;let l,f,u;r>a&&r<=o?(f=1,l=(o-r)/a,u=0):r>o&&r<=.5?(f=1,u=(r-o)/a,l=0):r>.5&&r<=s?(u=1,f=(s-r)/a,l=0):r>s&&r<=c?(u=1,l=(r-s)/a,f=0):r>c&&r<=1?(l=1,u=(1-r)/a,f=0):(l=1,f=r/a,u=0),l=n*l+(1-n),f=n*f+(1-n),u=n*u+(1-n),l*=i,f*=i,u*=i,e[0]=l,e[1]=f,e[2]=u}function JO(t,e){const[r,n,i]=t;let o=(r+16)/116,a=n/500+o,s=o-i/200;o**3>.008856?o**=3:o=(o-16/116)/7.787,a**3>.008856?a**=3:a=(a-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787;const c=.9505,l=1,f=1.089;e[0]=c*a,e[1]=l*o,e[2]=f*s}function ZO(t,e){const[r,n,i]=t,o=.9505,a=1,s=1.089;let c=r/o,l=n/a,f=i/s;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,f>.008856?f**=1/3:f=7.787*f+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-f)}function QO(t,e){const[r,n,i]=t;let o=r*3.2406+n*-1.5372+i*-.4986,a=r*-.9689+n*1.8758+i*.0415,s=r*.0557+n*-.204+i*1.057;o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92,a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92;let c=o;c<a&&(c=a),c<s&&(c=s),c>1&&(o/=c,a/=c,s/=c),o<0&&(o=0),a<0&&(a=0),s<0&&(s=0),e[0]=o,e[1]=a,e[2]=s}function eM(t,e){let[r,n,i]=t;r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=r*.4124+n*.3576+i*.1805,e[1]=r*.2126+n*.7152+i*.0722,e[2]=r*.0193+n*.1192+i*.9505}function Df(t,e){const r=[0,0,0];eM(t,r),ZO(r,e)}function dv(t,e){const r=[0,0,0];JO(t,r),QO(r,e)}function Jd(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function u2(t){return!(t[1]-t[0]<0)}function VH(t,e,r){return r[0]=Math.min(t[0],e[0]),r[1]=Math.max(t[0],e[0]),r[2]=Math.min(t[1],e[1]),r[3]=Math.max(t[1],e[1]),r[4]=Math.min(t[2],e[2]),r[5]=Math.max(t[2],e[2]),r}function es(t,e,r){return t<e?e:t>r?r:t}function Zx(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=es(t[0],e[0],r[0]),n[1]=es(t[1],e[1],r[1]),n[2]=es(t[2],e[2],r[2]),n}function FH(t,e){let r=0;return e[0]!==e[1]&&(t<e[0]?r=e[0]:t>e[1]?r=e[1]:r=t,r=(r-e[0])/(e[1]-e[0])),r}const UH=Qp("GetScalarTypeFittingRange"),BH=Qp("GetAdjustedScalarRange");function GH(t,e){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]<e[r]||t[r]>e[r+1]||t[r+1]<e[r]||t[r+1]>e[r+1])return 0;return 1}function WH(t,e,r){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]+r[n/2]<e[n]||t[n]-r[n/2]>e[n+1]||t[n+1]+r[n/2]<e[n]||t[n+1]-r[n/2]>e[n+1])return 0;return 1}function zH(t,e,r){if(!t||!e||!r)return 0;for(let n=0;n<3;n++)if(t[n]+r[n]<e[2*n]||t[n]-r[n]>e[2*n+1])return 0;return 1}function $H(t,e,r,n){const i=er(3),o=er(3),a=er(3),s=er(3),c=er(3),l=er(3);for(let x=0;x<3;++x)i[x]=t[x]-e[x],o[x]=e[x]-r[x],a[x]=r[x]-t[x],s[x]=-i[x],c[x]=-o[x],l[x]=-a[x];const f=zl(s),u=zl(c),d=zl(a),h=er(3);$s(i,o,h);const g=zl(h),p=f*u*d/(2*g),v=2*g*g,w=u*u*qt(i,l)/v,m=d*d*qt(s,o)/v,y=f*f*qt(a,c)/v;for(let x=0;x<3;++x)n[x]=w*t[x]+m*e[x]+y*r[x];return p}const jH=1/0,HH=-1/0,tM=t=>!Number.isFinite(t),{isFinite:KH,isNaN:Qx}=Number,hv=Qx;function fu(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function qH(t){let e=-1,r=-1;for(let n=0;n<t.length;n++){const i=Math.abs(t[n]);i>e&&(r=n,e=i)}return r}function nM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const r=new Array(e),n=new Array(e);for(let o=0;o<e;++o)r[o]=o,n[o]=o;for(let o=e-1;o>0;o--){let a=-1/0,s=0,c=0;for(let l=0;l<=o;++l){const f=r[l];for(let u=0;u<=o;++u){const d=n[u],h=Math.abs(t[f+e*d]);h>a&&(a=h,s=l,c=u)}}[r[o],r[s]]=[r[s],r[o]],[n[o],n[c]]=[n[c],n[o]]}const i=new Array(e*e).fill(0);for(let o=0;o<e;++o){const a=r[o]+e*n[o];i[a]=t[a]<0?-1:1}return i}function rM(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function XH(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(rM).join("")}`}function $1(t){return Math.round(t*255)}function YH(t){return t.length===3?`rgb(${t.map($1).join(", ")})`:`rgba(${$1(t[0]||0)}, ${$1(t[1]||0)}, ${$1(t[2]||0)}, ${t[3]||0})`}var kt={Pi:Qj,radiansFromDegrees:Tr,degreesFromRadians:uv,round:eg,floor:CT,ceil:eH,ceilLog2:aH,min:tH,max:nH,arrayMin:rH,arrayMax:iH,arrayRange:oH,isPowerOfTwo:tg,nearestPowerOfTwo:ha,factorial:sH,binomial:cH,beginCombination:lH,nextCombination:uH,randomSeed:fH,getSeed:dH,random:hH,gaussian:gH,add:fv,subtract:Lc,multiplyScalar:FO,multiplyScalar2D:UO,multiplyAccumulate:Kx,multiplyAccumulate2D:pH,dot:qt,outer:mH,cross:$s,norm:zl,normalize:Hf,perpendiculars:vH,projectVector:yH,projectVector2D:wH,distance2BetweenPoints:Ms,angleBetweenVectors:xH,gaussianAmplitude:CH,gaussianWeight:SH,dot2D:qx,outer2D:TH,norm2D:BO,normalize2D:GO,determinant2x2:Er,LUFactor3x3:_H,LUSolve3x3:EH,linearSolve3x3:DH,multiply3x3_vect3:c2,multiply3x3_mat3:Xx,multiplyMatrix:bH,transpose3x3:sd,invert3x3:IH,identity3x3:zO,identity:$O,isIdentity:OH,isIdentity3x3:MH,determinant3x3:zy,quaternionToMatrix3x3:jO,areEquals:WO,areMatricesEqual:e1,roundNumber:l2,roundVector:Yx,matrix3x3ToQuaternion:HO,multiplyQuaternion:RH,orthogonalize3x3:KO,diagonalize3x3:qO,singularValueDecomposition3x3:PH,solveLinearSystem:XO,invertMatrix:YO,luFactorLinearSystem:ST,luSolveLinearSystem:TT,estimateMatrixCondition:LH,jacobi:AH,jacobiN:t1,solveHomogeneousLeastSquares:Jx,solveLeastSquares:NH,hex2float:kH,rgb2hsv:ng,hsv2rgb:vf,lab2xyz:JO,xyz2lab:ZO,xyz2rgb:QO,rgb2xyz:eM,rgb2lab:Df,lab2rgb:dv,uninitializeBounds:Jd,areBoundsInitialized:u2,computeBoundsFromPoints:VH,clampValue:es,clampVector:Zx,clampAndNormalizeValue:FH,getScalarTypeFittingRange:UH,getAdjustedScalarRange:BH,extentIsWithinOtherExtent:GH,boundsIsWithinOtherBounds:WH,pointIsWithinBounds:zH,solve3PointCircle:$H,inf:jH,negInf:HH,isInf:tM,isNan:Qx,isNaN:Qx,isFinite:KH,createUninitializedBounds:fu,getMajorAxisIndex:qH,getSparseOrthogonalMatrix:nM,floatToHex2:rM,floatRGB2HexCode:XH,float2CssRGBA:YH};const{vtkErrorMacro:JH}=Ni,{DefaultDataType:ZH}=OO,QH=1e-6;function eC(t,e,r){const n=t.length;let i=Number.MAX_VALUE,o=-Number.MAX_VALUE,a,s;for(s=e;s<n;s+=r)if(!Number.isNaN(t[s])){i=t[s],o=i;break}for(;s<n;s+=r)a=t[s],a<i?i=a:a>o&&(o=a);return{min:i,max:o}}function eK(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(i){t>i&&(t=i),e<i&&(e=i),r++,n+=i},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function iM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){const i=t.length/r,o=new Float64Array(i);for(let a=0,s=0;a<i;++a){for(let c=s+r;s<c;++s)o[a]+=t[s]*t[s];o[a]**=.5}return eC(o,0,1)}return eC(t,e<0?0:e,r)}function KE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=t||[];for(;r.length<=e;)r.push(null);return r}function _T(t){return Object.prototype.toString.call(t).slice(8,-1)}function tK(t){const e=t.getNumberOfComponents();let r=0;const n=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,n);const o=zl(n,e);o>r&&(r=o)}return r}const nK={computeRange:iM,createRangeHelper:eK,fastComputeRange:eC,getDataType:_T,getMaxNorm:tK};function rK(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;const i=t.getNumberOfComponents(),o=e.values.length/(i>0?i:1);if(n===o)return!0;if(n>o){const a=e.values;return e.values=Xd(e.dataType,(n+o)*i),e.values.set(a),!0}return e.size>n*i&&(e.size=n*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=n=>{r(n);const i=n*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+i]},t.setComponent=(n,i,o)=>{o!==e.values[n*e.numberOfComponents+i]&&(e.values[n*e.numberOfComponents+i]=o,t.dataChange())},t.getValue=n=>{const i=n/e.numberOfComponents,o=n%e.numberOfComponents;return t.getComponent(i,o)},t.setValue=(n,i)=>{const o=n/e.numberOfComponents,a=n%e.numberOfComponents;t.setComponent(o,a,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=n;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let o=null;return e.ranges||(e.ranges=KE(e.ranges,e.numberOfComponents)),o=e.ranges[i],o?(e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple):(o=iM(t.getData(),n,e.numberOfComponents),e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple)},t.setRange=(n,i)=>{e.ranges||(e.ranges=KE(e.ranges,e.numberOfComponents));const o={min:n.min,max:n.max};return e.ranges[i]=o,e.rangeTuple[0]=o.min,e.rangeTuple[1]=o.max,e.rangeTuple},t.setTuple=(n,i)=>{const o=n*e.numberOfComponents;for(let a=0;a<e.numberOfComponents;a++)e.values[o+a]=i[a]},t.setTuples=(n,i)=>{let o=n*e.numberOfComponents;const a=Math.min(i.length,e.size-o);for(let s=0;s<a;)e.values[o++]=i[s++]},t.insertTuple=(n,i)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,i),n),t.insertTuples=(n,i)=>{const o=n+i.length/e.numberOfComponents;return e.size<o*e.numberOfComponents&&(e.size=o*e.numberOfComponents,r(o)),t.setTuples(n,i),o},t.insertNextTuple=n=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,n)},t.insertNextTuples=n=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,n)},t.findTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:QH;for(let o=0;o<e.size;o+=e.numberOfComponents)if(Math.abs(n[0]-e.values[o])<=i){let a=!0;for(let s=1;s<e.numberOfComponents;++s)if(Math.abs(n[s]-e.values[o+s])>i){a=!1;break}if(a)return o/e.numberOfComponents}return-1},t.getTuple=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=e.numberOfComponents||1,a=n*o;switch(o){case 4:i[3]=e.values[a+3];case 3:i[2]=e.values[a+2];case 2:i[1]=e.values[a+1];case 1:i[0]=e.values[a];break;default:for(let s=o-1;s>=0;--s)i[s]=e.values[a+s]}return i},t.getTuples=(n,i)=>{const o=(n??0)*e.numberOfComponents,a=(i??t.getNumberOfTuples())*e.numberOfComponents,s=t.getData().subarray(o,a);return s.length>0?s:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>aM({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,i)=>{e.values=n,e.size=n.length,e.dataType=_T(n),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(o=>{n[o]||delete n[o]});const i={};return Object.keys(n).sort().forEach(o=>{i[o]=n[o]}),i.mtime&&delete i.mtime,i},t.deepCopy=n=>{const i=t.getDataType(),o=e.values;t.shallowCopy(n),(o==null?void 0:o.length)>=n.getNumberOfValues()&&i===n.getDataType()?(o.set(n.getData()),e.values=o,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,i,o,a,s,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==a.getNumberOfComponents())&&JH("numberOfComponents must match");const f=i.getTuple(o),u=a.getTuple(s),d=[];switch(d.length=l,l){case 4:d[3]=f[3]+(u[3]-f[3])*c;case 3:d[2]=f[2]+(u[2]-f[2])*c;case 2:d[1]=f[1]+(u[1]-f[1])*c;case 1:d[0]=f[0]+(u[0]-f[0])*c;break;default:for(let h=0;h<l;h++)d[h]=f[h]+(u[h]-f[h])*c}return t.insertTuple(n,d)}}const iK={name:"",numberOfComponents:1,dataType:ZH,rangeTuple:[0,0]};function oM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,iK,r),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Gy(e.dataType,e.values)):e.values=Xd(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=_T(e.values)),Zn(t,e),Yp(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");rK(t,e)}const aM=Sn(oM,"vtkDataArray");var Lt={newInstance:aM,extend:oM,...nK,...OO};const{vtkErrorMacro:oK}=K,aK=["Build","Render"];function sK(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{const i=n.getTraverseOperation(),o=t[i];if(o){o(n);return}t.apply(n,!0);for(let a=0;a<e.children.length;a++)e.children[a].traverse(n);t.apply(n,!1)},t.apply=(n,i)=>{const o=t[n.getOperation()];o&&o(i,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let i=0;i<e.children.length;++i){const a=e.children[i].getViewNodeFor(n);if(a)return a}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(n);return i||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;const i=e._renderableChildMap.get(n);if(i!==void 0)return i.setVisited(!0),i;const o=t.createViewNode(n);if(o)return o.setParent(t),o.setVisited(!0),e._renderableChildMap.set(n,o),e.children.push(o),o},t.addMissingNodes=n=>{if(!(!n||!n.length))for(let i=0;i<n.length;++i){const o=n[i];t.addMissingNode(o)}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let i=0;i<n.length;++i){const o=n[i];if(e.children.indexOf(o)===-1){o.setParent(t),e.children.push(o);const s=o.getRenderable();s&&e._renderableChildMap.set(s,o)}o.setVisited(!0)}},t.removeNode=n=>{const i=e.children.findIndex(a=>a===n);if(i<0)return!1;const o=n.getRenderable();return o&&e._renderableChildMap.delete(o),n.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let i=0;i<e.children.length;++i){const o=e.children[i];if(o.getVisited())e.children[n++]=o,o.setVisited(!1);else{const s=o.getRenderable();s&&e._renderableChildMap.delete(s),o.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return oK("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(n);return i&&i.setRenderable(n),i};const r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}const cK={renderable:null,myFactory:null,children:[],visited:!1};function sM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cK,r),K.obj(t,e),K.event(t,e,"event"),e._renderableChildMap=new Map,K.get(t,e,["visited"]),K.setGet(t,e,["_parent","renderable","myFactory"]),K.getArray(t,e,["children"]),K.moveToProtected(t,e,["parent"]),sK(t,e)}const lK=K.newInstance(sM,"vtkViewNode");var Gn={newInstance:lK,extend:sM,PASS_TYPES:aK};function uK(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.indexOf(i)!==-1?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.overrides[i]();return s.setMyFactory(t),s}}const fK={};function cM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fK,r),K.obj(t,e),uK(t,e)}const dK=K.newInstance(cM,"vtkViewNodeFactory");var ET={newInstance:dK,extend:cM};const lM=Object.create(null);function Hr(t,e){lM[t]=e}function hK(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const gK={};function uM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gK,r),e.overrides=lM,ET.extend(t,e,r),hK(t,e)}const pK=K.newInstance(uM,"vtkOpenGLViewNodeFactory");var mK={newInstance:pK,extend:uM};const{Wrap:Tc,Filter:_i}=LO,{VtkDataTypes:_n}=Lt,{vtkDebugMacro:Dw,vtkErrorMacro:g0,vtkWarningMacro:qE}=Ni,{toHalf:vK}=mf;function yK(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(c?e._openGLRenderWindow=c:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(_i.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(_i.LINEAR),t.setMagnificationFilter(_i.LINEAR)):(t.setMinificationFilter(_i.NEAREST),t.setMagnificationFilter(_i.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Tc.REPEAT),t.setWrapS(Tc.REPEAT),t.setWrapT(Tc.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(_i.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(_i.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,_n.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(_i.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,_n.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const l=e.renderable.getInputData(0);if(l&&l.getPointData().getScalars()){const f=l.getExtent(),u=l.getPointData().getScalars(),d=[];for(let h=0;h<e.renderable.getNumberOfInputPorts();++h){const g=e.renderable.getInputData(h),p=g?g.getPointData().getScalars().getData():null;p&&d.push(p)}e.renderable.getInterpolate()&&u.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(_i.LINEAR_MIPMAP_LINEAR)),d.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),d):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,u.getNumberOfComponents(),u.getDataType(),u.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()},t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=c=>{c&&e.handle&&(c.activateTexture(t),c.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(c),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let c=!1;if(e.context&&e.handle){let l=0;switch(e.target){case e.context.TEXTURE_2D:l=e.context.TEXTURE_BINDING_2D;break;default:qE("impossible case");break}c=e.context.getIntegerv(l)===e.handle}return c},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(c,l)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(c,l)),e.internalFormat||Dw(`Unable to find suitable internal format for T=${c} NC= ${l}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&qE("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(c,l)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(c,l,e.oglNorm16Ext,t.useHalfFloat()),f||(f||(Dw("Unsupported internal texture type!"),Dw(`Unable to find suitable internal format for T=${c} NC= ${l}`)),f)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=c=>{e._forceInternalFormat=!0,c!==e.internalFormat&&(e.internalFormat=c,t.modified())},t.getFormat=(c,l)=>(e.format=t.getDefaultFormat(c,l),e.format),t.getDefaultFormat=(c,l)=>{if(e._openGLRenderWindow.getWebgl2())switch(l){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=c=>{const l=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(c){case _n.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(e.oglNorm16Ext&&!l&&_n.SHORT):return e.context.SHORT;case(e.oglNorm16Ext&&!l&&_n.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(l&&_n.SHORT):return e.context.HALF_FLOAT;case(l&&_n.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case _n.FLOAT:case _n.VOID:default:return e.context.FLOAT}switch(c){case _n.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case _n.FLOAT:case _n.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||l)&&(e.openGLDataType=t.getDefaultDataType(c)),e.openGLDataType},t.getShiftAndScale=()=>{let c=0,l=1;switch(e.openGLDataType){case e.context.BYTE:l=127.5,c=l-128;break;case e.context.UNSIGNED_BYTE:l=255,c=0;break;case e.context.SHORT:l=32767.5,c=l-32768;break;case e.context.UNSIGNED_SHORT:l=65536,c=0;break;case e.context.INT:l=21474836475e-1,c=l-2147483648;break;case e.context.UNSIGNED_INT:l=4294967295,c=0;break;case e.context.FLOAT:}return{shift:c,scale:l}},t.getOpenGLFilterMode=c=>{switch(c){case _i.NEAREST:return e.context.NEAREST;case _i.LINEAR:return e.context.LINEAR;case _i.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case _i.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case _i.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case _i.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=c=>{switch(c){case Tc.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Tc.REPEAT:return e.context.REPEAT;case Tc.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(c,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const u=[];let d=e.width*e.height*e.components;if(f&&(d*=e.depth),c!==_n.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let g=0;g<l.length;g++)if(l[g]){const p=l[g].length>d?l[g].subarray(0,d):l[g];u.push(new Float32Array(p))}else u.push(null);if(c!==_n.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let g=0;g<l.length;g++)if(l[g]){const p=l[g].length>d?l[g].subarray(0,d):l[g];u.push(new Uint8Array(p))}else u.push(null);let h=!1;if(e._openGLRenderWindow.getWebgl2())h=e.openGLDataType===e.context.HALF_FLOAT;else{const g=e.context.getExtension("OES_texture_half_float");h=g&&e.openGLDataType===g.HALF_FLOAT_OES}if(h)for(let g=0;g<l.length;g++)if(l[g]){const p=new Uint16Array(d),v=l[g];for(let w=0;w<d;w++)p[w]=vK(v[w]);u.push(p)}else u.push(null);if(u.length===0)for(let g=0;g<l.length;g++)u.push(l[g]);return u};function r(c){if(e._openGLRenderWindow.getWebgl2())return c;const l=[],f=e.width,u=e.height,d=e.components;if(c&&(!tg(f)||!tg(u))){const h=e.context.getExtension("OES_texture_half_float"),g=ha(f),p=ha(u),v=g*p*e.components;for(let w=0;w<c.length;w++)if(c[w]!==null){let m=null;const y=u/p,x=f/g;let C=!1;e.openGLDataType===e.context.FLOAT?m=new Float32Array(v):h&&e.openGLDataType===h.HALF_FLOAT_OES?(m=new Uint16Array(v),C=!0):m=new Uint8Array(v);for(let S=0;S<p;S++){const T=S*g*d,_=S*y;let E=Math.floor(_),D=Math.ceil(_);D>=u&&(D=u-1);const b=_-E,I=1-b;E=E*f*d,D=D*f*d;for(let R=0;R<g;R++){const M=R*d,P=R*x;let k=Math.floor(P),z=Math.ceil(P);z>=f&&(z=f-1);const A=P-k;k*=d,z*=d;for(let L=0;L<d;L++)C?m[T+M+L]=mf.toHalf(mf.fromHalf(c[w][E+k+L])*I*(1-A)+mf.fromHalf(c[w][E+z+L])*I*A+mf.fromHalf(c[w][D+k+L])*b*(1-A)+mf.fromHalf(c[w][D+z+L])*b*A):m[T+M+L]=c[w][E+k+L]*I*(1-A)+c[w][E+z+L]*I*A+c[w][D+k+L]*b*(1-A)+c[w][D+z+L]*b*A}}l.push(m),e.width=g,e.height=p}else l.push(null)}if(l.length===0)for(let h=0;h<c.length;h++)l.push(c[h]);return l}function n(c){var l;return e._openGLRenderWindow?e.resizable||(l=e.renderable)!=null&&l.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&e.oglNorm16Ext&&(c===_n.UNSIGNED_SHORT||c===_n.SHORT)):!1:!1}t.create2DFromRaw=function(c,l,f,u,d){let h=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(u,!0),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return g0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const g=[d],p=t.updateArrayDataTypeForGL(u,g),v=r(p);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,h),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),n(u)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),v[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v[0]),e.generateMipmap&&e.context.generateMipmap(e.target),h&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(c,l,f,u,d)=>{if(t.getOpenGLDataType(u),t.getInternalFormat(u,f),t.getFormat(u,f),!e.internalFormat||!e.format||!e.openGLDataType)return g0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=d.length/6-1,t.createTexture(),t.bind();const h=t.updateArrayDataTypeForGL(u,d),g=r(h),p=[];let v=e.width,w=e.height;for(let m=0;m<g.length;m++){m%6===0&&m!==0&&(v/=2,w/=2),p[m]=Xd(u,w*v*e.components);for(let y=0;y<w;++y){const x=y*v*e.components,C=(w-y-1)*v*e.components;p[m].set(g[m].slice(C,C+v*e.components),x)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),n(u)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let m=0;m<6;m++){let y=0,x=e.width,C=e.height;for(;x>=1&&C>=1;){let S=null;y<=e.maxLevel&&(S=p[6*y+m]),n(u)?S!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+m,y,0,0,x,C,e.format,e.openGLDataType,S):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+m,y,e.internalFormat,x,C,0,e.format,e.openGLDataType,S),y++,x/=2,C/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(u,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(c,l,f,u)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===_n.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(g0("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=c,e.height=l,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),n(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),u!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,u)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,u),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=c=>{if(t.getOpenGLDataType(_n.UNSIGNED_CHAR),t.getInternalFormat(_n.UNSIGNED_CHAR,4),t.getFormat(_n.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return g0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const l=!e._openGLRenderWindow.getWebgl2()&&(!tg(c.width)||!tg(c.height)),f=document.createElement("canvas");f.width=l?ha(c.width):c.width,f.height=l?ha(c.height):c.height,e.width=f.width,e.height=f.height;const u=f.getContext("2d");u.translate(0,f.height),u.scale(1,-1),u.drawImage(c,0,0,c.width,c.height,0,0,f.width,f.height);const d=f;return n(_n.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),d!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,d)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,d),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(_n.UNSIGNED_CHAR,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0};function i(c,l,f){const u=new Array(f),d=new Array(f);for(let h=0;h<f;++h)u[h]=c[h],d[h]=l[h]-c[h]||1;return{scale:d,offset:u}}function o(c,l){for(let f=0;f<c.length;f++){const u=c[f],d=l[f]+u;if(u<-2048||u>2048||d<-2048||d>2048)return!1}return!0}function a(c,l,f,u){t.getOpenGLDataType(c);const d=o(l,f)||u;let h=!1;if(e._openGLRenderWindow.getWebgl2())h=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&d||e.openGLDataType===e.context.HALF_FLOAT;else{const g=e.context.getExtension("OES_texture_half_float");h=g&&e.openGLDataType===g.HALF_FLOAT_OES}e.canUseHalfFloat=h&&d}function s(c,l){const f=c.getNumberOfComponents(),u=c.getDataType(),d=c.getData(),h=new Array(f),g=new Array(f);for(let v=0;v<f;++v){const[w,m]=c.getRange(v);h[v]=w,g[v]=m}const p=i(h,g,f);return a(u,p.offset,p.scale,l),t.useHalfFloat()||t.getOpenGLDataType(u,!0),{numComps:f,dataType:u,data:d,scaleOffsets:p}}t.create2DFilterableFromRaw=function(c,l,f,u,d){let h=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(c,l,Lt.newInstance({numberOfComponents:f,dataType:u,values:d}),h)},t.create2DFilterableFromDataArray=function(c,l,f){let u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:d,dataType:h,data:g}=s(f,u);t.create2DFromRaw(c,l,d,h,g)},t.updateVolumeInfoForGL=(c,l)=>{var d,h;let f=!1;const u=t.useHalfFloat();(!((d=e.volumeInfo)!=null&&d.scale)||!((h=e.volumeInfo)!=null&&h.offset))&&(e.volumeInfo={scale:new Array(l),offset:new Array(l)});for(let g=0;g<l;++g)e.volumeInfo.scale[g]=1,e.volumeInfo.offset[g]=0;if(e.oglNorm16Ext&&!u&&c===_n.SHORT){for(let g=0;g<l;++g)e.volumeInfo.scale[g]=32767;f=!0}if(e.oglNorm16Ext&&!u&&c===_n.UNSIGNED_SHORT){for(let g=0;g<l;++g)e.volumeInfo.scale[g]=65535;f=!0}if(c===_n.UNSIGNED_CHAR){for(let g=0;g<l;++g)e.volumeInfo.scale[g]=255;f=!0}return(c===_n.FLOAT||u&&(c===_n.SHORT||c===_n.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(c,l,f,u,d,h)=>{let g=d,p=h;if(!t.updateVolumeInfoForGL(g,u)&&p){const x=c*l*f,C=structuredClone(e.volumeInfo),S=new Float32Array(x*u);e.volumeInfo.offset=C.offset,e.volumeInfo.scale=C.scale;let T=0;const _=C.scale.map(E=>1/E);for(let E=0;E<x;E++)for(let D=0;D<u;D++)S[T]=(p[T]-C.offset[D])*_[D],T++;g=_n.FLOAT,p=S}if(t.getOpenGLDataType(g),t.getInternalFormat(g,u),t.getFormat(g,u),!e.internalFormat||!e.format||!e.openGLDataType)return g0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=u,e.width=c,e.height=l,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const v=[p],m=t.updateArrayDataTypeForGL(g,v,!0),y=r(m);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),n(g)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),y[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,y[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,y[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(g,e.oglNorm16Ext,t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(c,l,f,u,d,h){let g=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(c,l,f,Lt.newInstance({numberOfComponents:u,dataType:d,values:h}),g)},t.create3DFilterableFromDataArray=function(c,l,f,u){let d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:h,dataType:g,data:p,scaleOffsets:v}=s(u,d),w=[],m=[];for(let L=0;L<h;++L)w[L]=0,m[L]=1;if(e.volumeInfo={scale:m,offset:w,dataComputedScale:v.scale,dataComputedOffset:v.offset,width:c,height:l,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(c,l,f,h,g,p);const y=c*l*f,x=structuredClone(v);let C=(L,N,H,ee,oe)=>{L[N]=H},S=_n.UNSIGNED_CHAR;if(g===_n.UNSIGNED_CHAR)for(let L=0;L<h;++L)x.offset[L]=0,x.scale[L]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(S=_n.FLOAT,C=(L,N,H,ee,oe)=>{L[N]=(H-ee)/oe}):(S=_n.UNSIGNED_CHAR,C=(L,N,H,ee,oe)=>{L[N]=255*(H-ee)/oe});if(t.getOpenGLDataType(S),t.getInternalFormat(S,h),t.getFormat(S,h),!e.internalFormat||!e.format||!e.openGLDataType)return g0("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=h,e.depth=1,e.numberOfDimensions=2;let T=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);T>4096&&(S===_n.FLOAT||h>=3)&&(T=4096);let _=1,E=1;y>T*T&&(_=Math.ceil(Math.sqrt(y/(T*T))),E=_);let D=Math.sqrt(y)/_;D=ha(D);const b=Math.floor(D*_/c),I=Math.ceil(f/b),R=ha(l*I/E);e.width=D,e.height=R,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=b,e.volumeInfo.yreps=I,e.volumeInfo.xstride=_,e.volumeInfo.ystride=E,e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;let M;const P=D*R*h;S===_n.FLOAT?M=new Float32Array(P):M=new Uint8Array(P);let k=0;const z=Math.floor(c/_),A=Math.floor(l/E);for(let L=0;L<I;L++){const N=Math.min(b,f-L*b),H=h*(e.width-N*Math.floor(c/_));for(let ee=0;ee<A;ee++){for(let oe=0;oe<N;oe++){const de=h*((L*b+oe)*c*l+E*ee*c);for(let ue=0;ue<z;ue++)for(let me=0;me<h;me++)C(M,k,p[de+_*ue*h+me],x.offset[me],x.scale[me]),k++}k+=H}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),n(S)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),M!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,M)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,M),t.deactivate(),!0},t.setOpenGLRenderWindow=c=>{e._openGLRenderWindow!==c&&(t.releaseGraphicsResources(),e._openGLRenderWindow=c,e.context=null,c&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=c=>c&&c.isCurrent()?c.getIntegerv(c.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=c=>{e.enableUseHalfFloat=c}}const wK={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Tc.CLAMP_TO_EDGE,wrapT:Tc.CLAMP_TO_EDGE,wrapR:Tc.CLAMP_TO_EDGE,minificationFilter:_i.NEAREST,magnificationFilter:_i.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function fM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wK,r),Gn.extend(t,e,r),e.sendParametersTime={},Zn(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Zn(e.textureBuildTime,{mtime:0}),Yp(t,e,["format","openGLDataType"]),Fr(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),mo(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),Jp(t,e,["openGLRenderWindow"]),yK(t,e)}const dM=Sn(fM,"vtkOpenGLTexture");var rr={newInstance:dM,extend:fM,...LO};Hr("vtkTexture",dM);function xK(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){nn("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let o=i.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())o+=n;else{nn("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=e.context;if(!n){nn("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())i+=r;else{nn("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,i,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else nn("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else nn("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){nn("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const r=e.context,n=rr.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(_t.LINEAR),n.setMagnificationFilter(_t.LINEAR),n.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,Ht.UNSIGNED_CHAR,null),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const CK={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function hM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CK,r),Zn(t,e),e.colorBuffers&&nn("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Yd(t,e,["colorBuffers"]),xK(t,e)}const SK=Sn(hM,"vtkFramebuffer");var $y={newInstance:SK,extend:hM};function TK(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${K.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}),e.delegates.forEach(i=>{i.traverse(r,t)}),e.postDelegateOperations.forEach(i=>{t.setCurrentOperation(i),r.traverse(t)}))}}const _K={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function gM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_K,r),K.obj(t,e),K.get(t,e,["currentOperation"]),K.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),K.moveToProtected(t,e,["currentParent"]),TK(t,e)}const EK=K.newInstance(gM,"vtkRenderPass");var DT={newInstance:EK,extend:gM},vn=1e-6,Rr=typeof Float32Array<"u"?Float32Array:Array,DK=Math.PI/180;function bK(t){return t*DK}function du(t,e){return Math.abs(t-e)<=vn*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function bT(){var t=new Rr(9);return Rr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function jy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function IK(t){var e=new Rr(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function OK(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rg(t,e,r,n,i,o,a,s,c){var l=new Rr(9);return l[0]=t,l[1]=e,l[2]=r,l[3]=n,l[4]=i,l[5]=o,l[6]=a,l[7]=s,l[8]=c,l}function pM(t,e,r,n,i,o,a,s,c,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t}function Ta(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function IT(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function n1(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=f*a-s*l,d=-f*o+s*c,h=l*o-a*c,g=r*u+n*d+i*h;return g?(g=1/g,t[0]=u*g,t[1]=(-f*n+i*l)*g,t[2]=(s*n-i*a)*g,t[3]=d*g,t[4]=(f*r-i*c)*g,t[5]=(-s*r+i*o)*g,t[6]=h*g,t[7]=(-l*r+n*c)*g,t[8]=(a*r-n*o)*g,t):null}function MK(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8];return t[0]=a*f-s*l,t[1]=i*l-n*f,t[2]=n*s-i*a,t[3]=s*c-o*f,t[4]=r*f-i*c,t[5]=i*o-r*s,t[6]=o*l-a*c,t[7]=n*c-r*l,t[8]=r*a-n*o,t}function df(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8];return e*(l*o-a*c)+r*(-l*i+a*s)+n*(c*i-o*s)}function Od(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=r[0],h=r[1],g=r[2],p=r[3],v=r[4],w=r[5],m=r[6],y=r[7],x=r[8];return t[0]=d*n+h*a+g*l,t[1]=d*i+h*s+g*f,t[2]=d*o+h*c+g*u,t[3]=p*n+v*a+w*l,t[4]=p*i+v*s+w*f,t[5]=p*o+v*c+w*u,t[6]=m*n+y*a+x*l,t[7]=m*i+y*s+x*f,t[8]=m*o+y*c+x*u,t}function RK(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=r[0],h=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=c,t[6]=d*n+h*a+l,t[7]=d*i+h*s+f,t[8]=d*o+h*c+u,t}function PK(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=Math.sin(r),h=Math.cos(r);return t[0]=h*n+d*a,t[1]=h*i+d*s,t[2]=h*o+d*c,t[3]=h*a-d*n,t[4]=h*s-d*i,t[5]=h*c-d*o,t[6]=l,t[7]=f,t[8]=u,t}function LK(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function AK(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function NK(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kK(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function VK(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function FK(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,f=n*a,u=n*s,d=i*a,h=i*s,g=i*c,p=o*a,v=o*s,w=o*c;return t[0]=1-u-g,t[3]=f-w,t[6]=d+v,t[1]=f+w,t[4]=1-l-g,t[7]=h-p,t[2]=d-v,t[5]=h+p,t[8]=1-l-u,t}function UK(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15],m=r*s-n*a,y=r*c-i*a,x=r*l-o*a,C=n*c-i*s,S=n*l-o*s,T=i*l-o*c,_=f*p-u*g,E=f*v-d*g,D=f*w-h*g,b=u*v-d*p,I=u*w-h*p,R=d*w-h*v,M=m*R-y*I+x*b+C*D-S*E+T*_;return M?(M=1/M,t[0]=(s*R-c*I+l*b)*M,t[1]=(c*D-a*R-l*E)*M,t[2]=(a*I-s*D+l*_)*M,t[3]=(i*I-n*R-o*b)*M,t[4]=(r*R-i*D+o*E)*M,t[5]=(n*D-r*I-o*_)*M,t[6]=(p*T-v*S+w*C)*M,t[7]=(v*x-g*T-w*y)*M,t[8]=(g*S-p*x+w*m)*M,t):null}function BK(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function GK(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function WK(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function zK(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function mM(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function $K(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function jK(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function HK(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function KK(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=e[0],d=e[1],h=e[2],g=e[3],p=e[4],v=e[5],w=e[6],m=e[7],y=e[8];return Math.abs(r-u)<=vn*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=vn*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-h)<=vn*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-g)<=vn*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(a-p)<=vn*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-v)<=vn*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-w)<=vn*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-m)<=vn*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(f-y)<=vn*Math.max(1,Math.abs(f),Math.abs(y))}var qK=Od,XK=mM;const YK=Object.freeze(Object.defineProperty({__proto__:null,add:zK,adjoint:MK,clone:IK,copy:OK,create:bT,determinant:df,equals:KK,exactEquals:HK,frob:WK,fromMat2d:VK,fromMat4:jy,fromQuat:FK,fromRotation:NK,fromScaling:kK,fromTranslation:AK,fromValues:rg,identity:Ta,invert:n1,mul:qK,multiply:Od,multiplyScalar:$K,multiplyScalarAndAdd:jK,normalFromMat4:UK,projection:BK,rotate:PK,scale:LK,set:pM,str:GK,sub:XK,subtract:mM,translate:RK,transpose:IT},Symbol.toStringTag,{value:"Module"}));function ba(){var t=new Rr(16);return Rr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function JK(t){var e=new Rr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function OT(t,e,r,n,i,o,a,s,c,l,f,u,d,h,g,p){var v=new Rr(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=i,v[5]=o,v[6]=a,v[7]=s,v[8]=c,v[9]=l,v[10]=f,v[11]=u,v[12]=d,v[13]=h,v[14]=g,v[15]=p,v}function ZK(t,e,r,n,i,o,a,s,c,l,f,u,d,h,g,p,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t[9]=f,t[10]=u,t[11]=d,t[12]=h,t[13]=g,t[14]=p,t[15]=v,t}function yt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Yt(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Or(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15],m=r*s-n*a,y=r*c-i*a,x=r*l-o*a,C=n*c-i*s,S=n*l-o*s,T=i*l-o*c,_=f*p-u*g,E=f*v-d*g,D=f*w-h*g,b=u*v-d*p,I=u*w-h*p,R=d*w-h*v,M=m*R-y*I+x*b+C*D-S*E+T*_;return M?(M=1/M,t[0]=(s*R-c*I+l*b)*M,t[1]=(i*I-n*R-o*b)*M,t[2]=(p*T-v*S+w*C)*M,t[3]=(d*S-u*T-h*C)*M,t[4]=(c*D-a*R-l*E)*M,t[5]=(r*R-i*D+o*E)*M,t[6]=(v*x-g*T-w*y)*M,t[7]=(f*T-d*x+h*y)*M,t[8]=(a*I-s*D+l*_)*M,t[9]=(n*D-r*I-o*_)*M,t[10]=(g*S-p*x+w*m)*M,t[11]=(u*x-f*S-h*m)*M,t[12]=(s*E-a*b-c*_)*M,t[13]=(r*b-n*E+i*_)*M,t[14]=(p*y-g*C-v*m)*M,t[15]=(f*C-u*y+d*m)*M,t):null}function QK(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],f=e[8],u=e[9],d=e[10],h=e[11],g=e[12],p=e[13],v=e[14],w=e[15];return t[0]=s*(d*w-h*v)-u*(c*w-l*v)+p*(c*h-l*d),t[1]=-(n*(d*w-h*v)-u*(i*w-o*v)+p*(i*h-o*d)),t[2]=n*(c*w-l*v)-s*(i*w-o*v)+p*(i*l-o*c),t[3]=-(n*(c*h-l*d)-s*(i*h-o*d)+u*(i*l-o*c)),t[4]=-(a*(d*w-h*v)-f*(c*w-l*v)+g*(c*h-l*d)),t[5]=r*(d*w-h*v)-f*(i*w-o*v)+g*(i*h-o*d),t[6]=-(r*(c*w-l*v)-a*(i*w-o*v)+g*(i*l-o*c)),t[7]=r*(c*h-l*d)-a*(i*h-o*d)+f*(i*l-o*c),t[8]=a*(u*w-h*p)-f*(s*w-l*p)+g*(s*h-l*u),t[9]=-(r*(u*w-h*p)-f*(n*w-o*p)+g*(n*h-o*u)),t[10]=r*(s*w-l*p)-a*(n*w-o*p)+g*(n*l-o*s),t[11]=-(r*(s*h-l*u)-a*(n*h-o*u)+f*(n*l-o*s)),t[12]=-(a*(u*v-d*p)-f*(s*v-c*p)+g*(s*d-c*u)),t[13]=r*(u*v-d*p)-f*(n*v-i*p)+g*(n*d-i*u),t[14]=-(r*(s*v-c*p)-a*(n*v-i*p)+g*(n*c-i*s)),t[15]=r*(s*d-c*u)-a*(n*d-i*u)+f*(n*c-i*s),t}function eq(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],l=t[8],f=t[9],u=t[10],d=t[11],h=t[12],g=t[13],p=t[14],v=t[15],w=e*a-r*o,m=e*s-n*o,y=e*c-i*o,x=r*s-n*a,C=r*c-i*a,S=n*c-i*s,T=l*g-f*h,_=l*p-u*h,E=l*v-d*h,D=f*p-u*g,b=f*v-d*g,I=u*v-d*p;return w*I-m*b+y*D+x*E-C*_+S*T}function rn(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=e[8],d=e[9],h=e[10],g=e[11],p=e[12],v=e[13],w=e[14],m=e[15],y=r[0],x=r[1],C=r[2],S=r[3];return t[0]=y*n+x*s+C*u+S*p,t[1]=y*i+x*c+C*d+S*v,t[2]=y*o+x*l+C*h+S*w,t[3]=y*a+x*f+C*g+S*m,y=r[4],x=r[5],C=r[6],S=r[7],t[4]=y*n+x*s+C*u+S*p,t[5]=y*i+x*c+C*d+S*v,t[6]=y*o+x*l+C*h+S*w,t[7]=y*a+x*f+C*g+S*m,y=r[8],x=r[9],C=r[10],S=r[11],t[8]=y*n+x*s+C*u+S*p,t[9]=y*i+x*c+C*d+S*v,t[10]=y*o+x*l+C*h+S*w,t[11]=y*a+x*f+C*g+S*m,y=r[12],x=r[13],C=r[14],S=r[15],t[12]=y*n+x*s+C*u+S*p,t[13]=y*i+x*c+C*d+S*v,t[14]=y*o+x*l+C*h+S*w,t[15]=y*a+x*f+C*g+S*m,t}function Wn(t,e,r){var n=r[0],i=r[1],o=r[2],a,s,c,l,f,u,d,h,g,p,v,w;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(a=e[0],s=e[1],c=e[2],l=e[3],f=e[4],u=e[5],d=e[6],h=e[7],g=e[8],p=e[9],v=e[10],w=e[11],t[0]=a,t[1]=s,t[2]=c,t[3]=l,t[4]=f,t[5]=u,t[6]=d,t[7]=h,t[8]=g,t[9]=p,t[10]=v,t[11]=w,t[12]=a*n+f*i+g*o+e[12],t[13]=s*n+u*i+p*o+e[13],t[14]=c*n+d*i+v*o+e[14],t[15]=l*n+h*i+w*o+e[15]),t}function Wc(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ki(t,e,r,n){var i=n[0],o=n[1],a=n[2],s=Math.hypot(i,o,a),c,l,f,u,d,h,g,p,v,w,m,y,x,C,S,T,_,E,D,b,I,R,M,P;return s<vn?null:(s=1/s,i*=s,o*=s,a*=s,c=Math.sin(r),l=Math.cos(r),f=1-l,u=e[0],d=e[1],h=e[2],g=e[3],p=e[4],v=e[5],w=e[6],m=e[7],y=e[8],x=e[9],C=e[10],S=e[11],T=i*i*f+l,_=o*i*f+a*c,E=a*i*f-o*c,D=i*o*f-a*c,b=o*o*f+l,I=a*o*f+i*c,R=i*a*f+o*c,M=o*a*f-i*c,P=a*a*f+l,t[0]=u*T+p*_+y*E,t[1]=d*T+v*_+x*E,t[2]=h*T+w*_+C*E,t[3]=g*T+m*_+S*E,t[4]=u*D+p*b+y*I,t[5]=d*D+v*b+x*I,t[6]=h*D+w*b+C*I,t[7]=g*D+m*b+S*I,t[8]=u*R+p*M+y*P,t[9]=d*R+v*M+x*P,t[10]=h*R+w*M+C*P,t[11]=g*R+m*M+S*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function MT(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],c=e[7],l=e[8],f=e[9],u=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+f*n,t[6]=s*i+u*n,t[7]=c*i+d*n,t[8]=l*i-o*n,t[9]=f*i-a*n,t[10]=u*i-s*n,t[11]=d*i-c*n,t}function RT(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[8],f=e[9],u=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-f*n,t[2]=s*i-u*n,t[3]=c*i-d*n,t[8]=o*n+l*i,t[9]=a*n+f*i,t[10]=s*n+u*i,t[11]=c*n+d*i,t}function PT(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],c=e[3],l=e[4],f=e[5],u=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+f*n,t[2]=s*i+u*n,t[3]=c*i+d*n,t[4]=l*i-o*n,t[5]=f*i-a*n,t[6]=u*i-s*n,t[7]=d*i-c*n,t}function Hy(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function LT(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function AT(t,e,r){var n=r[0],i=r[1],o=r[2],a=Math.hypot(n,i,o),s,c,l;return a<vn?null:(a=1/a,n*=a,i*=a,o*=a,s=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=n*n*l+c,t[1]=i*n*l+o*s,t[2]=o*n*l-i*s,t[3]=0,t[4]=n*i*l-o*s,t[5]=i*i*l+c,t[6]=o*i*l+n*s,t[7]=0,t[8]=n*o*l+i*s,t[9]=i*o*l-n*s,t[10]=o*o*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function tq(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function nq(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rq(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vM(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,c=i+i,l=o+o,f=n*s,u=n*c,d=n*l,h=i*c,g=i*l,p=o*l,v=a*s,w=a*c,m=a*l;return t[0]=1-(h+p),t[1]=u+m,t[2]=d-w,t[3]=0,t[4]=u-m,t[5]=1-(f+p),t[6]=g+v,t[7]=0,t[8]=d+w,t[9]=g-v,t[10]=1-(f+h),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function iq(t,e){var r=new Rr(3),n=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],c=e[5],l=e[6],f=e[7],u=n*n+i*i+o*o+a*a;return u>0?(r[0]=(s*a+f*n+c*o-l*i)*2/u,r[1]=(c*a+f*i+l*n-s*o)*2/u,r[2]=(l*a+f*o+s*i-c*n)*2/u):(r[0]=(s*a+f*n+c*o-l*i)*2,r[1]=(c*a+f*i+l*n-s*o)*2,r[2]=(l*a+f*o+s*i-c*n)*2),vM(t,e,r),t}function oq(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function yM(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],c=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(c,l,f),t}function tC(t,e){var r=new Rr(3);yM(r,e);var n=1/r[0],i=1/r[1],o=1/r[2],a=e[0]*n,s=e[1]*i,c=e[2]*o,l=e[4]*n,f=e[5]*i,u=e[6]*o,d=e[8]*n,h=e[9]*i,g=e[10]*o,p=a+f+g,v=0;return p>0?(v=Math.sqrt(p+1)*2,t[3]=.25*v,t[0]=(u-h)/v,t[1]=(d-c)/v,t[2]=(s-l)/v):a>f&&a>g?(v=Math.sqrt(1+a-f-g)*2,t[3]=(u-h)/v,t[0]=.25*v,t[1]=(s+l)/v,t[2]=(d+c)/v):f>g?(v=Math.sqrt(1+f-a-g)*2,t[3]=(d-c)/v,t[0]=(s+l)/v,t[1]=.25*v,t[2]=(u+h)/v):(v=Math.sqrt(1+g-a-f)*2,t[3]=(s-l)/v,t[0]=(d+c)/v,t[1]=(u+h)/v,t[2]=.25*v),t}function wM(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=i+i,l=o+o,f=a+a,u=i*c,d=i*l,h=i*f,g=o*l,p=o*f,v=a*f,w=s*c,m=s*l,y=s*f,x=n[0],C=n[1],S=n[2];return t[0]=(1-(g+v))*x,t[1]=(d+y)*x,t[2]=(h-m)*x,t[3]=0,t[4]=(d-y)*C,t[5]=(1-(u+v))*C,t[6]=(p+w)*C,t[7]=0,t[8]=(h+m)*S,t[9]=(p-w)*S,t[10]=(1-(u+g))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function aq(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],c=e[3],l=o+o,f=a+a,u=s+s,d=o*l,h=o*f,g=o*u,p=a*f,v=a*u,w=s*u,m=c*l,y=c*f,x=c*u,C=n[0],S=n[1],T=n[2],_=i[0],E=i[1],D=i[2],b=(1-(p+w))*C,I=(h+x)*C,R=(g-y)*C,M=(h-x)*S,P=(1-(d+w))*S,k=(v+m)*S,z=(g+y)*T,A=(v-m)*T,L=(1-(d+p))*T;return t[0]=b,t[1]=I,t[2]=R,t[3]=0,t[4]=M,t[5]=P,t[6]=k,t[7]=0,t[8]=z,t[9]=A,t[10]=L,t[11]=0,t[12]=r[0]+_-(b*_+M*E+z*D),t[13]=r[1]+E-(I*_+P*E+A*D),t[14]=r[2]+D-(R*_+k*E+L*D),t[15]=1,t}function gv(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,c=i+i,l=r*a,f=n*a,u=n*s,d=i*a,h=i*s,g=i*c,p=o*a,v=o*s,w=o*c;return t[0]=1-u-g,t[1]=f+w,t[2]=d-v,t[3]=0,t[4]=f-w,t[5]=1-l-g,t[6]=h+p,t[7]=0,t[8]=d+v,t[9]=h-p,t[10]=1-l-u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function sq(t,e,r,n,i,o,a){var s=1/(r-e),c=1/(i-n),l=1/(o-a);return t[0]=o*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*c,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function xM(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}var cq=xM;function lq(t,e,r,n,i){var o=1/Math.tan(e/2),a;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(a=1/(n-i),t[10]=i*a,t[14]=i*n*a):(t[10]=-1,t[14]=-n),t}function uq(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+s),l=2/(i+o);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-s)*c*.5),t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function CM(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=(a+o)*l,t[15]=1,t}var NT=CM;function fq(t,e,r,n,i,o,a){var s=1/(e-r),c=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*c,t[14]=o*l,t[15]=1,t}function kT(t,e,r,n){var i,o,a,s,c,l,f,u,d,h,g=e[0],p=e[1],v=e[2],w=n[0],m=n[1],y=n[2],x=r[0],C=r[1],S=r[2];return Math.abs(g-x)<vn&&Math.abs(p-C)<vn&&Math.abs(v-S)<vn?yt(t):(f=g-x,u=p-C,d=v-S,h=1/Math.hypot(f,u,d),f*=h,u*=h,d*=h,i=m*d-y*u,o=y*f-w*d,a=w*u-m*f,h=Math.hypot(i,o,a),h?(h=1/h,i*=h,o*=h,a*=h):(i=0,o=0,a=0),s=u*a-d*o,c=d*i-f*a,l=f*o-u*i,h=Math.hypot(s,c,l),h?(h=1/h,s*=h,c*=h,l*=h):(s=0,c=0,l=0),t[0]=i,t[1]=s,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=u,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(i*g+o*p+a*v),t[13]=-(s*g+c*p+l*v),t[14]=-(f*g+u*p+d*v),t[15]=1,t)}function dq(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=n[0],c=n[1],l=n[2],f=i-r[0],u=o-r[1],d=a-r[2],h=f*f+u*u+d*d;h>0&&(h=1/Math.sqrt(h),f*=h,u*=h,d*=h);var g=c*d-l*u,p=l*f-s*d,v=s*u-c*f;return h=g*g+p*p+v*v,h>0&&(h=1/Math.sqrt(h),g*=h,p*=h,v*=h),t[0]=g,t[1]=p,t[2]=v,t[3]=0,t[4]=u*v-d*p,t[5]=d*g-f*v,t[6]=f*p-u*g,t[7]=0,t[8]=f,t[9]=u,t[10]=d,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function hq(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function gq(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function pq(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function SM(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function TM(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function mq(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function vq(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function yq(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c=t[6],l=t[7],f=t[8],u=t[9],d=t[10],h=t[11],g=t[12],p=t[13],v=t[14],w=t[15],m=e[0],y=e[1],x=e[2],C=e[3],S=e[4],T=e[5],_=e[6],E=e[7],D=e[8],b=e[9],I=e[10],R=e[11],M=e[12],P=e[13],k=e[14],z=e[15];return Math.abs(r-m)<=vn*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-y)<=vn*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-x)<=vn*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-C)<=vn*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-S)<=vn*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(s-T)<=vn*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(c-_)<=vn*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(l-E)<=vn*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(f-D)<=vn*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(u-b)<=vn*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(d-I)<=vn*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(h-R)<=vn*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(g-M)<=vn*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(p-P)<=vn*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(v-k)<=vn*Math.max(1,Math.abs(v),Math.abs(k))&&Math.abs(w-z)<=vn*Math.max(1,Math.abs(w),Math.abs(z))}var pv=rn,wq=SM;const hp=Object.freeze(Object.defineProperty({__proto__:null,add:pq,adjoint:QK,clone:JK,copy:sr,create:ba,determinant:eq,equals:yq,exactEquals:vq,frob:gq,fromQuat:gv,fromQuat2:iq,fromRotation:AT,fromRotationTranslation:vM,fromRotationTranslationScale:wM,fromRotationTranslationScaleOrigin:aq,fromScaling:LT,fromTranslation:Hy,fromValues:OT,fromXRotation:tq,fromYRotation:nq,fromZRotation:rq,frustum:sq,getRotation:tC,getScaling:yM,getTranslation:oq,identity:yt,invert:Or,lookAt:kT,mul:pv,multiply:rn,multiplyScalar:TM,multiplyScalarAndAdd:mq,ortho:NT,orthoNO:CM,orthoZO:fq,perspective:cq,perspectiveFromFieldOfView:uq,perspectiveNO:xM,perspectiveZO:lq,rotate:Ki,rotateX:MT,rotateY:RT,rotateZ:PT,scale:Wc,set:ZK,str:hq,sub:wq,subtract:SM,targetTo:dq,translate:Wn,transpose:Yt},Symbol.toStringTag,{value:"Module"}));function Ae(){var t=new Rr(3);return Rr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function xq(t){var e=new Rr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function fo(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function xt(t,e,r){var n=new Rr(3);return n[0]=t,n[1]=e,n[2]=r,n}function Cq(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Dn(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function br(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function yn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Sq(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Tq(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function nC(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function f2(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function _M(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function mr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Xt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function li(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function EM(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function is(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function DM(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function kn(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function gt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xn(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],c=r[2];return t[0]=i*c-o*s,t[1]=o*a-n*c,t[2]=n*s-i*a,t}function Pt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function d2(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function _q(t,e,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=e[0],c=e[1],l=e[2],f=i*l-o*c,u=o*s-n*l,d=n*c-i*s,h=i*d-o*u,g=o*f-n*d,p=n*u-i*f,v=a*2;return f*=v,u*=v,d*=v,h*=2,g*=2,p*=2,t[0]=s+f+h,t[1]=c+u+g,t[2]=l+d+p,t}function VT(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2],c=Math.sqrt(r*r+n*n+i*i),l=Math.sqrt(o*o+a*a+s*s),f=c*l,u=f&&gt(t,e)/f;return Math.acos(Math.min(Math.max(u,-1),1))}function Eq(t){return t[0]=0,t[1]=0,t[2]=0,t}function XE(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function rC(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(r-o)<=vn*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=vn*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=vn*Math.max(1,Math.abs(i),Math.abs(s))}var bn=yn,bM=Sq,iC=EM,Md=fo;(function(){var t=Ae();return function(e,r,n,i,o,a){var s,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function IM(){var t=new Rr(4);return Rr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function h2(t,e,r,n){var i=new Rr(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function YE(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Dq(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a,t}function JE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function $l(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}(function(){var t=IM();return function(e,r,n,i,o,a){var s,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();function hu(){var t=new Rr(4);return Rr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ky(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function bq(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>vn?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function ZE(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],c=r[1],l=r[2],f=r[3];return t[0]=n*f+a*s+i*l-o*c,t[1]=i*f+a*c+o*s-n*l,t[2]=o*f+a*l+n*c-i*s,t[3]=a*f-n*s-i*c-o*l,t}function g2(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],c=r[0],l=r[1],f=r[2],u=r[3],d,h,g,p,v;return h=i*c+o*l+a*f+s*u,h<0&&(h=-h,c=-c,l=-l,f=-f,u=-u),1-h>vn?(d=Math.acos(h),g=Math.sin(d),p=Math.sin((1-n)*d)/g,v=Math.sin(n*d)/g):(p=1-n,v=n),t[0]=p*i+v*c,t[1]=p*o+v*l,t[2]=p*a+v*f,t[3]=p*s+v*u,t}function Iq(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Oq(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[o*3+o]-e[a*3+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[o*3+a]-e[a*3+o])*n,t[o]=(e[o*3+i]+e[i*3+o])*n,t[a]=(e[a*3+i]+e[i*3+a])*n}return t}var QE=h2,OM=Dq;(function(){var t=Ae(),e=xt(1,0,0),r=xt(0,1,0);return function(n,i,o){var a=gt(i,o);return a<-.999999?(xn(t,e,i),Md(t)<1e-6&&xn(t,r,i),kn(t,t),Ky(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(xn(t,i,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,OM(n,n))}})();(function(){var t=hu(),e=hu();return function(r,n,i,o,a,s){return g2(t,n,a,s),g2(e,i,o,s),g2(r,t,e,2*s*(1-s)),r}})();(function(){var t=bT();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],OM(e,Oq(e,t))}})();function Vt(){var t=new Rr(2);return Rr!=Float32Array&&(t[0]=0,t[1]=0),t}function j1(t){var e=new Rr(2);return e[0]=t[0],e[1]=t[1],e}function e6(t,e){var r=new Rr(2);return r[0]=t,r[1]=e,r}function ga(t,e,r){return t[0]=e,t[1]=r,t}function Di(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Sr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function _c(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Mq(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function ir(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function mv(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Oc(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function FT(t,e){return t[0]*e[0]+t[1]*e[1]}function Rq(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],a=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+o*o),s=a&&(r*i+n*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}var Pq=mv,ya=Sr,UT=ir;(function(){var t=Vt();return function(e,r,n,i,o,a){var s,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}})();const Ac={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var MM={ObjectType:Ac};const{ObjectType:p2}=MM,Lq={};function Aq(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(s){switch(s){case p2.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case p2.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case p2.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,i=null,o=!0,a="";t.getType=()=>n,t.setType=s=>{n=s},t.getHandle=()=>i,t.isReady=()=>o===!1,t.generateBuffer=s=>{const c=r(s);return i===null&&(i=e.context.createBuffer(),n=s),r(n)===c},t.upload=(s,c)=>t.generateBuffer(c)?(e.context.bindBuffer(r(n),i),e.context.bufferData(r(n),s,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=s.length*s.BYTES_PER_ELEMENT,o=!1,!0):(a="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(r(n),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=s=>{e._openGLRenderWindow!==s&&(t.releaseGraphicsResources(),e._openGLRenderWindow=s,e.context=null,s&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>a}const Nq={objectType:p2.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function RM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nq,r),K.obj(t,e),K.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),K.moveToProtected(t,e,["openGLRenderWindow"]),Aq(t,e)}const kq=K.newInstance(RM);var Mc={newInstance:kq,extend:RM,...Lq,...MM};const PM={FLAT:0,GOURAUD:1,PHONG:2},Mi={POINTS:0,WIREFRAME:1,SURFACE:2},Vq=PM;var LM={Shading:PM,Representation:Mi,Interpolation:Vq};const{vtkErrorMacro:t6}=K;function Fq(t,e){const r=new Float64Array(3);DM(r,e);const n=new Float64Array(16);return wM(n,hu(),t,r),n}function Uq(t,e){return t===null||e===null?!1:!(XE(t,[0,0,0])&&XE(e,[1,1,1]))}function Bq(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Ac.ARRAY_BUFFER),t.createVBO=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const s=o.points.getData();let c=null,l=null,f=null;const u=o.colors?o.colors.getNumberOfComponents():0,d=o.tcoords?o.tcoords.getNumberOfComponents():0;o.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=o.normals.getData()),o.customAttributes&&o.customAttributes.forEach(L=>{L&&(e.customData.push({data:L.getData(),offset:4*e.blockSize,components:L.getNumberOfComponents(),name:L.getName()}),e.blockSize+=L.getNumberOfComponents())}),o.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=d,e.blockSize+=d,l=o.tcoords.getData()),o.colors?(e.colorComponents=o.colors.getNumberOfComponents(),e.colorOffset=0,f=o.colors.getData(),e.colorBO||(e.colorBO=Mc.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let h=0,g=0,p=0,v=0,w=0,m=0,y;const x={anythingToPoints(L,N,H,ee){for(let oe=0;oe<L;++oe)y(N[H+oe],ee)},linesToWireframe(L,N,H,ee){for(let oe=0;oe<L-1;++oe)y(N[H+oe],ee),y(N[H+oe+1],ee)},polysToWireframe(L,N,H,ee){if(L>2)for(let oe=0;oe<L;++oe)y(N[H+oe],ee),y(N[H+(oe+1)%L],ee)},stripsToWireframe(L,N,H,ee){if(L>2){for(let oe=0;oe<L-1;++oe)y(N[H+oe],ee),y(N[H+oe+1],ee);for(let oe=0;oe<L-2;oe++)y(N[H+oe],ee),y(N[H+oe+2],ee)}},polysToSurface(L,N,H,ee){for(let oe=0;oe<L-2;oe++)y(N[H+0],ee),y(N[H+oe+1],ee),y(N[H+oe+2],ee)},stripsToSurface(L,N,H,ee){for(let oe=0;oe<L-2;oe++)y(N[H+oe],ee),y(N[H+oe+1+oe%2],ee),y(N[H+oe+1+(oe+1)%2],ee)}},C={anythingToPoints(L,N){return L},linesToWireframe(L,N){return L>1?(L-1)*2:0},polysToWireframe(L,N){return L>2?L*2:0},stripsToWireframe(L,N){return L>2?L*4-6:0},polysToSurface(L,N){return L>2?(L-2)*3:0},stripsToSurface(L,N,H){return L>2?(L-2)*3:0}};let S=null,T=null;i===Mi.POINTS||n==="verts"?(S=x.anythingToPoints,T=C.anythingToPoints):i===Mi.WIREFRAME||n==="lines"?(S=x[`${n}ToWireframe`],T=C[`${n}ToWireframe`]):(S=x[`${n}ToSurface`],T=C[`${n}ToSurface`]);const _=r.getData(),E=_.length;let D=0;for(let L=0;L<E;)D+=T(_[L],_),L+=_[L]+1;let b=null;const I=new Float32Array(D*e.blockSize);f&&(b=new Uint8Array(D*4));let R=0,M=0,P=0,k=0;for(let L=0;L<3;++L){const N=o.points.getRange(L),H=N[1]-N[0];P+=H*H;const ee=.5*(N[1]+N[0]);k+=ee*ee}if(P>0&&(Math.abs(k)/P>1e6||Math.abs(Math.log10(P))>3||P===0&&k>1e6)){const L=new Float64Array(3),N=new Float64Array(3);for(let H=0;H<3;++H){const ee=o.points.getRange(H),oe=ee[1]-ee[0];L[H]=.5*(ee[1]+ee[0]),N[H]=oe>0?1/oe:1}t.setCoordShiftAndScale(L,N)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(a)if(!a.points&&!a.cells)a.points=new Int32Array(D),a.cells=new Int32Array(D);else{const L=new Int32Array(D+a.points.length);L.set(a.points),a.points=L;const N=new Int32Array(D+a.cells.length);N.set(a.cells),a.cells=N}let A=o.vertexOffset;y=function(N,H){if(a&&(a.points[A]=N,a.cells[A]=m+o.cellOffset),++A,h=N*3,e.coordShiftAndScaleEnabled?(I[R++]=(s[h++]-e.coordShift[0])*e.coordScale[0],I[R++]=(s[h++]-e.coordShift[1])*e.coordScale[1],I[R++]=(s[h++]-e.coordShift[2])*e.coordScale[2]):(I[R++]=s[h++],I[R++]=s[h++],I[R++]=s[h++]),c!==null&&(o.haveCellNormals?g=(m+o.cellOffset)*3:g=N*3,I[R++]=c[g++],I[R++]=c[g++],I[R++]=c[g++]),e.customData.forEach(ee=>{w=N*ee.components;for(let oe=0;oe<ee.components;++oe)I[R++]=ee.data[w++]}),l!==null){o.useTCoordsPerCell?p=H*d:p=N*d;for(let ee=0;ee<d;++ee)I[R++]=l[p++]}f!==null&&(o.haveCellScalars?v=(m+o.cellOffset)*u:v=N*u,b[M++]=f[v++],b[M++]=f[v++],b[M++]=f[v++],b[M++]=u===4?f[v++]:255)};for(let L=0;L<E;L+=_[L]+1,m++)S(_[L],_,L+1,m+o.cellOffset);return e.elementCount=D,t.upload(I,Ac.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(b,Ac.ARRAY_BUFFER)),m},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){t6("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){t6("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!rC(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!rC(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=Uq(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=Fq(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const Gq={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function AM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gq,r),Mc.extend(t,e,r),K.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),K.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),Bq(t,e)}const Wq=K.newInstance(AM);var zq={newInstance:Wq,extend:AM};const{vtkErrorMacro:$q}=K;function jq(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return $q(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const Hq={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function NM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hq,r),K.obj(t,e),K.setGet(t,e,["shaderType","source","error","handle","context"]),jq(t,e)}const Kq=K.newInstance(NM,"vtkShader");var bw={newInstance:Kq,extend:NM};const{vtkErrorMacro:_s}=K;function qq(t,e,r,n){const i=typeof r=="string"?r:r.join(`
`),o=n===!1?e:new RegExp(e,"g"),a=t.replace(o,i);return{replace:a!==i,result:a}}function Xq(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(_s(e.error),0):t.link()?(t.setCompiled(!0),1):(_s(`Links failed: ${e.error}`),0):(_s(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),_s(e.fragmentShader.getError()),0):(_s(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),_s(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const n=e.context.getProgramInfoLog(e.handle);return _s(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix4fv(i,!1,o),!0},t.setUniformMatrix3x3=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const o=new Float32Array(n);return e.context.uniformMatrix3fv(i,!1,o),!0},t.setUniformf=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(i,n),!0)},t.setUniformfv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(i,n),!0)},t.setUniformi=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(i,n),!0)},t.setUniformiv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(i,n),!0)},t.setUniform2f=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(o,n,i),!0},t.setUniform2fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(i,n),!0)},t.setUniform2i=(r,n,i)=>{const o=t.findUniform(r);if(o===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(o,n,i),!0},t.setUniform2iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(i,n),!0)},t.setUniform3f=(r,n,i,o)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(o===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n,i,o),!0},t.setUniform3fArray=(r,n)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(i,n),!0)},t.setUniform3i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,s[0],s[1],s[2]),!0},t.setUniform3iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(i,n),!0)},t.setUniform4f=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4fv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(i,n),!0)},t.setUniform4i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];let s=o;if(s.length===1&&Array.isArray(s[0])&&(s=s[0]),s.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,s[0],s[1],s[2],s[3]),!0},t.setUniform4iv=(r,n)=>{const i=t.findUniform(r);return i===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(i,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):(_s("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return _s("attempt to find uniform when the shader program is not linked"),!1;const n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}const Yq={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function kM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yq,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=bw.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=bw.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=bw.newInstance(),e.geometryShader.setShaderType("Geometry"),K.obj(t,e),K.get(t,e,["lastCameraMTime"]),K.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Xq(t,e)}const Jq=K.newInstance(kM,"vtkShaderProgram");var Te={newInstance:Jq,extend:kM,substitute:qq};function Zq(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,1):r.vertexAttribDivisor(a.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,i.buffer);for(let o=0;o<i.attributes.length;++o){const a=i.attributes[o],s=a.isMatrix?a.size:1;for(let c=0;c<s;++c)r.enableVertexAttribArray(a.index+c),r.vertexAttribPointer(a.index+c,a.size,a.type,a.normalize,a.stride,a.offset+a.stride*c/a.size),a.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(a.index+c,0):r.vertexAttribDivisor(a.index+c,0)),r.disableVertexAttribArray(a.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,i,o,a,s,c,l)=>t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,0,!1),t.addAttributeArrayWithDivisor=(r,n,i,o,a,s,c,l,f,u)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==Ac.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;const d=e.context,h={};if(h.name=i,h.index=d.getAttribLocation(e.handleProgram,i),h.offset=o,h.stride=a,h.type=s,h.size=c,h.normalize=l,h.isMatrix=u,h.divisor=f,h.Index===-1)return!1;if(n.bind(),d.enableVertexAttribArray(h.index),d.vertexAttribPointer(h.index,h.size,h.type,h.normalize,h.stride,h.offset),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h.index,1):d.vertexAttribDivisor(h.index,1)),h.buffer=n.getHandle(),!e.supported){let g=!1;for(let p=0;p<e.buffers.length;++p){const v=e.buffers[p];if(v.buffer===h.buffer){g=!0;let w=!1;for(let m=0;m<v.attributes.length;++m)v.attributes[m].name===i&&(w=!0,v.attributes[m]=h);w||v.attributes.push(h)}}g||e.buffers.push({buffer:h.buffer,attributes:[h]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,i,o,a,s,c,l,f)=>{const u=t.addAttributeArrayWithDivisor(r,n,i,o,a,s,c,l,f,!0);if(!u)return u;const d=e.context,h=d.getAttribLocation(e.handleProgram,i);for(let g=1;g<c;g++)d.enableVertexAttribArray(h+g),d.vertexAttribPointer(h+g,c,s,l,a,o+a*g/c),f>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h+g,1):d.vertexAttribDivisor(h+g,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){const i=e.buffers[n];for(let o=0;o<i.attributes.length;++o)if(i.attributes[o].name===r)return i.attributes.splice(o,1),i.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const Qq={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function VM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qq,r),e.buffers=[],K.obj(t,e),K.get(t,e,["supported"]),K.setGet(t,e,["forceEmulation"]),Zq(t,e)}const eX=K.newInstance(VM,"vtkOpenGLVertexArrayObject");var BT={newInstance:eX,extend:VM};const Ol={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function tX(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,i,o)=>{if(e.CABO.getElementCount()){const a=t.getOpenGLMode(i),s=t.haveWideLines(r,n),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),a===c.LINES&&s?(t.updateShaders(r,n,o),c.drawArraysInstanced(a,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(c.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,o),c.drawArrays(a,0,e.CABO.getElementCount()),c.lineWidth(1));const u=(a===c.POINTS?1:0)||(a===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/u}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;const n=e.primitiveType;return r===Mi.POINTS||n===Ol.Points?e.context.POINTS:r===Mi.WIREFRAME||n===Ol.Lines||n===Ol.TrisEdges||n===Ol.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,i)=>!!(i.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,i)=>{if(t.getNeedToRebuildShaders(r,n,i)){const o={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(o,r,n);const a=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);a!==t.getProgram()&&(t.setProgram(a),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,r,n),i.setPropertyShaderParameters(t,r,n),i.setCameraShaderParameters(t,r,n),i.setLightingShaderParameters(t,r,n),i.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,i)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const o=parseFloat(n.getProperty().getLineWidth()),a=o/2;t.getProgram().setUniformf("lineWidthStepSize",o/Math.ceil(o)),t.getProgram().setUniformf("halfLineWidth",a)}e.primitiveType===Ol.Points||n.getProperty().getRepresentation()===Mi.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,i)=>{let o=r.Vertex;o=Te.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,i)&&(o=Te.substitute(o,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,o=Te.substitute(o,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=o},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Ol.Points?2:e.primitiveType===Ol.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const nX={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function FM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nX,r),K.obj(t,e),e.shaderSourceTime={},K.obj(e.shaderSourceTime),e.attributeUpdateTime={},K.obj(e.attributeUpdateTime),K.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=Te.newInstance(),e.VAO=BT.newInstance(),e.CABO=zq.newInstance(),tX(t,e)}const rX=K.newInstance(FM);var Js={newInstance:rX,extend:FM,primTypes:Ol};const{Representation:ig,Interpolation:og}=LM;function n6(t){return()=>K.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function iX(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,i)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==i)&&(e.color[0]=r,e.color[1]=n,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=n6("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{const n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=n6("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(og.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(og.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(og.PHONG),t.getInterpolationAsString=()=>K.enumToString(og,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(ig.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(ig.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(ig.POINTS),t.getRepresentationAsString=()=>K.enumToString(ig,e.representation)}const oX={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:og.GOURAUD,representation:ig.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function UM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oX,r),K.obj(t,e),K.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),K.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),iX(t,e)}const aX=K.newInstance(UM,"vtkProperty");var Zd={newInstance:aX,extend:UM,...LM};const{Representation:sX}=Zd,{vtkErrorMacro:r6}=K;function cX(t){const e=Te.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const lX=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function uX(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),i=new Uint16Array([4,0,1,3,2]),o=Lt.newInstance({numberOfComponents:3,values:r});o.setName("points");const a=Lt.newInstance({numberOfComponents:2,values:n});a.setName("tcoords");const s=Lt.newInstance({numberOfComponents:1,values:i});e.tris.getCABO().createVBO(s,"polys",sX.SURFACE,{points:o,tcoords:a,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{const n=r.getSize(),i=r.getContext();e.framebuffer=$y.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=rr.newInstance(),e.translucentRGBATexture.setInternalFormat(i.RGBA16F),e.translucentRGBATexture.setFormat(i.RGBA),e.translucentRGBATexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw(n[0],n[1],4,"Float32Array",null),e.translucentRTexture=rr.newInstance(),e.translucentRTexture.setInternalFormat(i.R16F),e.translucentRTexture.setFormat(i.RED),e.translucentRTexture.setOpenGLDataType(i.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw(n[0],n[1],1,"Float32Array",null),e.translucentZTexture=rr.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw(n[0],n[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),lX,"")},t.createVBO=r=>{const n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();const i=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||r6("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(i,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||r6("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,i)=>{if(e.deleted)return;const o=r.getSize(),a=r.getContext();if(e._supported=!1,n.getSelector()||!a||!r.getWebgl2()||!a.getExtension("EXT_color_buffer_half_float")&&!a.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{const c=e.framebuffer.getSize();c===null||c[0]!==o[0]||c[1]!==o[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}a.drawBuffers([a.COLOR_ATTACHMENT0]),a.clearBufferfv(a.COLOR,0,[0,0,0,0]),a.clearBufferfv(a.DEPTH,0,[1]),a.colorMask(!1,!1,!1,!1),i.getOpaqueActorCount()>0&&(i.setCurrentOperation("opaqueZBufferPass"),n.traverse(i)),a.colorMask(!0,!0,!0,!0),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1]),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),a.clearBufferfv(a.COLOR,0,[0,0,0,1]),a.clearBufferfv(a.COLOR,1,[0,0,0,0]),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFuncSeparate(a.ONE,a.ONE,a.ZERO,a.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),a.drawBuffers([a.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=BT.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),a.depthMask(!1),a.depthFunc(a.ALWAYS),a.viewport(0,0,o[0],o[1]),a.scissor(0,0,o[0],o[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),a.depthMask(!0),a.depthFunc(a.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const s=n.getTiledSizeAndOrigin();a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize)},t.getShaderReplacement=()=>e._supported?cX:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}const fX={framebuffer:null,copyShader:null,tris:null};function BM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fX,r),DT.extend(t,e,r),e.VBOBuildTime={},K.obj(e.VBOBuildTime,{mtime:0}),e.tris=Js.newInstance(),K.get(t,e,["framebuffer"]),uX(t,e)}const dX=K.newInstance(BM,"vtkOpenGLOrderIndependentTranslucentPass");var hX={newInstance:dX,extend:BM};function gX(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);const i=r.getRenderable().getNumberOfLayers(),o=r.getRenderable().getRenderersByReference();for(let a=0;a<i;a++)for(let s=0;s<o.length;s++){const c=o[s],l=r.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===a){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),l.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const f=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=$y.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const u=e.framebuffer.getSize();(u===null||u[0]!==f[0]||u[1]!==f[1])&&(e.framebuffer.create(f[0],f[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),l.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),l.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),l.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=hX.newInstance()),e.translucentPass.traverse(r,l,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),l.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),l.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const pX={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function GM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pX,r),DT.extend(t,e,r),K.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),gX(t,e)}const mX=K.newInstance(GM,"vtkForwardPass");var vX={newInstance:mX,extend:GM};const co={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var WM={PassTypes:co};const{vtkErrorMacro:i6,vtkWarningMacro:yX}=K;function wX(t,e){e.classHierarchy.push("vtkFieldData");const r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:Qa(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(i=>i),e.arrays=n.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{const i=n.getName(),{array:o,index:a}=t.getArrayWithIndex(i);return o!=null?(e.arrays[a]={data:n},a):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return t.removeArrayByIndex(i)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((i,o,a)=>o.data.getName()===n?o.data:i,null),t.getArrayWithIndex=n=>{const i=e.arrays.findIndex(o=>o.data.getName()===n);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{const i=e.arrays[n];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(a=>{const s=t.getFlag(a.getName());if(s!==!1&&!(e.doCopyAllOff&&s!==!0)&&a){let c=t.getArrayByName(a.getName());if(c)if(a.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<a.getNumberOfTuples()){const l=o>-1?o:i;c.insertTuple(l,a.getTuple(i))}else c.insertTuples(0,a.getTuples());else i6("Unhandled case in passData");else if(i<0||i>a.getNumberOfTuples())t.addArray(a),n.getAttributes(a).forEach(l=>{t.setAttribute(a,l)});else{const l=a.getNumberOfComponents();let f=a.getNumberOfValues();const u=o>-1?o:i;f<=u*l&&(f=(u+1)*l),c=Lt.newInstance({name:a.getName(),dataType:a.getDataType(),numberOfComponents:l,values:K.newTypedArray(a.getDataType(),f),size:0}),c.insertTuple(u,a.getTuple(i)),t.addArray(c),n.getAttributes(a).forEach(d=>{t.setAttribute(c,d)})}}})},t.interpolateData=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let f=t.getArrayByName(c.getName());if(f)if(c.getNumberOfComponents()===f.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const u=a>-1?a:i;f.interpolateTuple(u,c,i,c,o,s),yX("Unexpected case in interpolateData")}else f.insertTuples(c.getTuples());else i6("Unhandled case in interpolateData");else if(i<0||o<0||i>c.getNumberOfTuples())t.addArray(c),n.getAttributes(c).forEach(u=>{t.setAttribute(c,u)});else{const u=c.getNumberOfComponents();let d=c.getNumberOfValues();const h=a>-1?a:i;d<=h*u&&(d=(h+1)*u),f=Lt.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:u,values:K.newTypedArray(c.getDataType(),d),size:0}),f.interpolateTuple(h,c,i,c,o,s),t.addArray(f),n.getAttributes(c).forEach(g=>{t.setAttribute(f,g)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(i=>{const o=i.newClone();return o.deepCopy(i),{data:o}})},t.copyFlags=n=>n.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,i)=>i.data.getMTime()>n?i.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,i)=>n+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const n=r();return n&&(n.arrays=e.arrays.map(i=>({data:i.data.getState()}))),n}}const xX={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function zM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xX,r),K.obj(t,e),wX(t,e)}const CX=K.newInstance(zM,"vtkFieldData");var SX={newInstance:CX,extend:zM};const TX={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},_X={MAX:0,EXACT:1,NOLIMIT:2},EX={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DX={DUPLICATEPOINT:1,HIDDENPOINT:2},bX={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},IX="vtkGhostType",vv={DEFAULT:0,SINGLE:1,DOUBLE:2};var $M={AttributeCopyOperations:bX,AttributeLimitTypes:_X,AttributeTypes:TX,CellGhostTypes:EX,DesiredOutputPrecision:vv,PointGhostTypes:DX,ghostArrayName:IX};const{AttributeTypes:wl,AttributeCopyOperations:Ju}=$M,{vtkWarningMacro:H1}=K;function OX(t,e){const r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(a){let s=r.find(c=>wl[c.toUpperCase()]===a||typeof a!="number"&&c.toLowerCase()===a.toLowerCase());return typeof s>"u"&&(s=null),s}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=a=>!0,t.setAttribute=(a,s)=>{const c=n(s);if(a&&c.toUpperCase()==="PEDIGREEIDS"&&!a.isA("vtkDataArray"))return H1(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(a&&!t.checkNumberOfComponents(a,c))return H1(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===a)return l;t.removeArrayByIndex(l)}return a?(l=t.addArray(a),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=a=>r.filter(s=>t[`get${s}`]()===a),t.setActiveAttributeByName=(a,s)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(a).index,s),t.setActiveAttributeByIndex=(a,s)=>{const c=n(s);if(a>=0&&a<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(a);if(!l.isA("vtkDataArray"))return H1(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return H1(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=a,t.modified(),a}return a===-1&&(e[`active${c}`]=a,t.modified()),-1},t.getActiveAttribute=a=>{const s=n(a);return t[`get${s}`]()},t.removeAllArrays=()=>{r.forEach(a=>{e[`active${a}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=a=>(a!==-1&&r.forEach(s=>{a===e[`active${s}`]?e[`active${s}`]=-1:a<e[`active${s}`]&&(e[`active${s}`]-=1)}),i.removeArrayByIndex(a)),r.forEach(a=>{const s=`active${a}`;t[`get${a}`]=()=>t.getArrayByIndex(e[s]),t[`set${a}`]=c=>t.setAttribute(c,a),t[`setActive${a}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,a),t[`copy${a}Off`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[Ju.PASSDATA][wl[c]]=!1},t[`copy${a}On`]=()=>{const c=a.toUpperCase();e.copyAttributeFlags[Ju.PASSDATA][wl[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Ju).filter(a=>a!=="ALLCOPY").forEach(a=>{e.copyAttributeFlags[Ju[a]]=Object.keys(wl).filter(s=>s!=="NUM_ATTRIBUTES").reduce((s,c)=>(s[wl[c]]=!0,s),[])}),e.copyAttributeFlags[Ju.COPYTUPLE][wl.GLOBALIDS]=!1,e.copyAttributeFlags[Ju.INTERPOLATE][wl.GLOBALIDS]=!1,e.copyAttributeFlags[Ju.COPYTUPLE][wl.PEDIGREEIDS]=!1},t.initialize=K.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(a=>{!e.dataArrays[a].ref&&e.dataArrays[a].type==="vtkDataArray"&&t.addArray(Lt.newInstance(e.dataArrays[a]))});const o=t.shallowCopy;t.shallowCopy=(a,s)=>{o(a,s),e.arrays=a.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,s),{data:l}})},t.initializeAttributeCopyFlags()}const MX={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function jM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MX,r),SX.extend(t,e,r),K.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),OX(t,e)}const RX=K.newInstance(jM,"vtkDataSetAttributes");var o6={newInstance:RX,extend:jM,...$M};const PX={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},LX={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var AX={FieldDataTypes:PX,FieldAssociations:LX};const oC=["pointData","cellData","fieldData"];function NX(t,e){e.classHierarchy.push("vtkDataSet"),oC.forEach(n=>{e[n]?e[n]=Qa(e[n]):e[n]=o6.newInstance()});const r=t.shallowCopy;t.shallowCopy=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,i),oC.forEach(o=>{e[o]=o6.newInstance(),e[o].shallowCopy(n.getReferenceByName(o))})}}const kX={};function HM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kX,r),K.obj(t,e),K.setGet(t,e,oC),NX(t,e)}const VX=K.newInstance(HM,"vtkDataSet");var Qd={newInstance:VX,extend:HM,...AX};const{FieldAssociations:FX}=Qd;function UX(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,i,o,a)=>{},t.selectAsync=async(r,n,i,o,a)=>{const s=await t.getSourceDataAsync(r,n,i,o,a);return s?s.generateSelection(n,i,o,a):[]}}const BX={fieldAssociation:FX.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function KM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BX,r),K.obj(t,e),K.setGet(t,e,["fieldAssociation","captureZValues"]),UX(t,e)}const GX=K.newInstance(KM,"vtkHardwareSelector");var WX={newInstance:GX,extend:KM};const zX={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},$X={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var jX={SelectionContent:zX,SelectionField:$X};function HX(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const KX={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function qM(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KX,r),K.obj(t,e),e.properties={},K.setGet(t,e,["contentType","fieldType","properties","selectionList"]),HX(t,e)}const qX=K.newInstance(qM,"vtkSelectionNode");var XM={newInstance:qX,extend:qM,...jX};const{PassTypes:Br}=WM,{SelectionContent:XX,SelectionField:a6}=XM,{FieldAssociations:Tg}=Qd,{vtkErrorMacro:YM}=K,Fl=1;function JM(t){return`${t.propID} ${t.compositeID}`}function ZM(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4;return r[i+3]}function Ec(t,e,r,n){if(!r)return 0;const i=(e*(n[2]-n[0]+1)+t)*4,o=r[i],a=r[i+1];return(r[i+2]*256+a)*256+o}function QM(t,e){let r=e;return r<<=24,r|=t,r}function YX(t,e,r,n){{if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const i=[e[0]-t.area[0],e[1]-t.area[1]],o=Ec(i[0],i[1],t.pixBuffer[Br.ACTOR_PASS],t.area);if(o<=0||o-Fl>=t.props.length)return null;const a={};a.valid=!0,a.propID=o-Fl,a.prop=t.props[a.propID];let s=Ec(i[0],i[1],t.pixBuffer[Br.COMPOSITE_INDEX_PASS],t.area);if((s<0||s>16777215)&&(s=0),a.compositeID=s-Fl,t.captureZValues){const f=(i[1]*(t.area[2]-t.area[0]+1)+i[0])*4;a.zValue=(256*t.zBuffer[f]+t.zBuffer[f+1])/65535,a.displayPosition=e}if(t.pixBuffer[Br.ID_LOW24]&&ZM(i[0],i[1],t.pixBuffer[Br.ID_LOW24],t.area)===0)return a;const c=Ec(i[0],i[1],t.pixBuffer[Br.ID_LOW24],t.area),l=Ec(i[0],i[1],t.pixBuffer[Br.ID_HIGH24],t.area);return a.attributeID=QM(c,l),a}}function eR(t,e,r,n,i){const o=[];let a=0;return e.forEach((s,c)=>{const l=XM.newInstance();switch(l.setContentType(XX.INDICES),t){case Tg.FIELD_ASSOCIATION_CELLS:l.setFieldType(a6.CELL);break;case Tg.FIELD_ASSOCIATION_POINTS:l.setFieldType(a6.POINT);break;default:YM("Unknown field association")}l.getProperties().propID=s.info.propID,l.getProperties().prop=s.info.prop,l.getProperties().compositeID=s.info.compositeID,l.getProperties().attributeID=s.info.attributeID,l.getProperties().pixelCount=s.pixelCount,r&&(l.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],l.getProperties().worldPosition=i.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n)),l.setSelectionList(s.attributeIDs),o[a]=l,a++}),o}function JX(t,e,r,n,i){const o=Math.floor(e),a=Math.floor(r),s=Math.floor(n),c=Math.floor(i),l=new Map,f=[0,0];for(let u=a;u<=c;u++)for(let d=o;d<=s;d++){const g=YX(t,[d,u],0,f);if(g&&g.valid){const p=JM(g);if(!l.has(p))l.set(p,{info:g,pixelCount:1,attributeIDs:[g.attributeID]});else{const v=l.get(p);v.pixelCount++,t.captureZValues&&g.zValue<v.info.zValue&&(v.info=g),v.attributeIDs.indexOf(g.attributeID)===-1&&v.attributeIDs.push(g.attributeID)}}}return eR(t.fieldAssociation,l,t.captureZValues,t.renderer,t.openGLRenderWindow)}function ZX(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=$y.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const i=e.framebuffer.getSize();!i||i[0]!==n[0]||i[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Tg.FIELD_ASSOCIATION_POINTS){const i=e._openGLRenderWindow.getContext(),o=i.isEnabled(i.BLEND);i.disable(i.BLEND),e._openGLRenderWindow.traverseAllPasses(),o&&i.enable(i.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,i,o,a,s)=>{if(e._renderer=n,i===void 0){const l=e._openGLRenderWindow.getSize();t.setArea(0,0,l[0]-1,l[1]-1)}else t.setArea(i,o,a,s);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var l=arguments.length,f=new Array(l),u=0;u<l;u++)f[u]=arguments[u];return JX(c,...f)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return YM("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const i=[];for(e.currentPass=Br.MIN_KNOWN_PASS;e.currentPass<=Br.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===Br.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),i.push(e.currentPass));return i.forEach(o=>{e.currentPass=o,t.processPixelBuffers()}),e.currentPass=Br.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,i)=>{t.isPropHit(i)&&n.processSelectorPixelBuffers(t,e.propPixels[i])})},t.passRequired=n=>{if(n===Br.ID_HIGH24){if(e.fieldAssociation===Tg.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Tg.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){const i=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(i),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===Br.ACTOR_PASS){if(e.captureZValues){const i=e._openGLRenderWindow.getRenderPasses();if(typeof i[0].requestDepth=="function"&&typeof i[0].getFramebuffer=="function"){const o=i[0].getFramebuffer();o.saveCurrentBindingsAndBuffers(),o.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),o.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let i=0;for(let o=0;o<=e.area[3]-e.area[1];o++)for(let a=0;a<=e.area[2]-e.area[0];a++){let s=Ec(a,o,n,e.area);s>0&&(s--,s in e.hitProps||(e.hitProps[s]=!0,e.propPixels[s]=[]),e.propPixels[s].push(i*4)),++i}},t.renderProp=n=>{e.currentPass===Br.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Fl),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===Br.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+Fl)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>K.enumToString(Br,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,i,o)=>{const a=i<0?0:i;if(a===0){if(o[0]=n[0],o[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;const f=[n[0]-e.area[0],n[1]-e.area[1]],u=Ec(f[0],f[1],e.pixBuffer[Br.ACTOR_PASS],e.area);if(u<=0||u-Fl>=e.props.length)return null;const d={};d.valid=!0,d.propID=u-Fl,d.prop=e.props[d.propID];let h=Ec(f[0],f[1],e.pixBuffer[Br.COMPOSITE_INDEX_PASS],e.area);if((h<0||h>16777215)&&(h=0),d.compositeID=h-Fl,e.captureZValues){const v=(f[1]*(e.area[2]-e.area[0]+1)+f[0])*4;d.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,d.displayPosition=n}if(e.pixBuffer[Br.ID_LOW24]&&ZM(f[0],f[1],e.pixBuffer[Br.ID_LOW24],e.area)===0)return d;const g=Ec(f[0],f[1],e.pixBuffer[Br.ID_LOW24],e.area),p=Ec(f[0],f[1],e.pixBuffer[Br.ID_HIGH24],e.area);return d.attributeID=QM(g,p),d}const s=[n[0],n[1]],c=[0,0];let l=t.getPixelInformation(n,0,o);if(l&&l.valid)return l;for(let f=1;f<a;++f){for(let u=s[1]>f?s[1]-f:0;u<=s[1]+f;++u)if(c[1]=u,s[0]>=f&&(c[0]=s[0]-f,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[0]=s[0]+f,l=t.getPixelInformation(c,0,o),l&&l.valid))return l;for(let u=s[0]>=f?s[0]-(f-1):0;u<=s[0]+(f-1);++u)if(c[0]=u,s[1]>=f&&(c[1]=s[1]-f,l=t.getPixelInformation(c,0,o),l&&l.valid)||(c[1]=s[1]+f,l=t.getPixelInformation(c,0,o),l&&l.valid))return l}return o[0]=n[0],o[1]=n[1],null},t.generateSelection=(n,i,o,a)=>{const s=Math.floor(n),c=Math.floor(i),l=Math.floor(o),f=Math.floor(a),u=new Map,d=[0,0];for(let h=c;h<=f;h++)for(let g=s;g<=l;g++){const p=[g,h],v=t.getPixelInformation(p,0,d);if(v&&v.valid){const w=JM(v);if(!u.has(w))u.set(w,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const m=u.get(w);m.pixelCount++,e.captureZValues&&v.zValue<m.info.zValue&&(m.info=v),m.attributeIDs.indexOf(v.attributeID)===-1&&m.attributeIDs.push(v.attributeID)}}}return eR(e.fieldAssociation,u,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,i)=>{e._openGLRenderWindow=n,e._renderer=i};const r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const QX={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function tR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QX,r),WX.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),K.setGetArray(t,e,["area"],4),K.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),K.setGetArray(t,e,["propColorValue"],3),K.moveToProtected(t,e,["renderer","openGLRenderWindow"]),K.event(t,e,"event"),ZX(t,e)}const eY=K.newInstance(tR,"vtkOpenGLHardwareSelector");var GT={newInstance:eY,extend:tR,...WM},nR={exports:{}};(function(t,e){(function(r){t.exports=r()})(function(r){var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(w,m){var y=w[0],x=w[1],C=w[2],S=w[3];y+=(x&C|~x&S)+m[0]-680876936|0,y=(y<<7|y>>>25)+x|0,S+=(y&x|~y&C)+m[1]-389564586|0,S=(S<<12|S>>>20)+y|0,C+=(S&y|~S&x)+m[2]+606105819|0,C=(C<<17|C>>>15)+S|0,x+=(C&S|~C&y)+m[3]-1044525330|0,x=(x<<22|x>>>10)+C|0,y+=(x&C|~x&S)+m[4]-176418897|0,y=(y<<7|y>>>25)+x|0,S+=(y&x|~y&C)+m[5]+1200080426|0,S=(S<<12|S>>>20)+y|0,C+=(S&y|~S&x)+m[6]-1473231341|0,C=(C<<17|C>>>15)+S|0,x+=(C&S|~C&y)+m[7]-45705983|0,x=(x<<22|x>>>10)+C|0,y+=(x&C|~x&S)+m[8]+1770035416|0,y=(y<<7|y>>>25)+x|0,S+=(y&x|~y&C)+m[9]-1958414417|0,S=(S<<12|S>>>20)+y|0,C+=(S&y|~S&x)+m[10]-42063|0,C=(C<<17|C>>>15)+S|0,x+=(C&S|~C&y)+m[11]-1990404162|0,x=(x<<22|x>>>10)+C|0,y+=(x&C|~x&S)+m[12]+1804603682|0,y=(y<<7|y>>>25)+x|0,S+=(y&x|~y&C)+m[13]-40341101|0,S=(S<<12|S>>>20)+y|0,C+=(S&y|~S&x)+m[14]-1502002290|0,C=(C<<17|C>>>15)+S|0,x+=(C&S|~C&y)+m[15]+1236535329|0,x=(x<<22|x>>>10)+C|0,y+=(x&S|C&~S)+m[1]-165796510|0,y=(y<<5|y>>>27)+x|0,S+=(y&C|x&~C)+m[6]-1069501632|0,S=(S<<9|S>>>23)+y|0,C+=(S&x|y&~x)+m[11]+643717713|0,C=(C<<14|C>>>18)+S|0,x+=(C&y|S&~y)+m[0]-373897302|0,x=(x<<20|x>>>12)+C|0,y+=(x&S|C&~S)+m[5]-701558691|0,y=(y<<5|y>>>27)+x|0,S+=(y&C|x&~C)+m[10]+38016083|0,S=(S<<9|S>>>23)+y|0,C+=(S&x|y&~x)+m[15]-660478335|0,C=(C<<14|C>>>18)+S|0,x+=(C&y|S&~y)+m[4]-405537848|0,x=(x<<20|x>>>12)+C|0,y+=(x&S|C&~S)+m[9]+568446438|0,y=(y<<5|y>>>27)+x|0,S+=(y&C|x&~C)+m[14]-1019803690|0,S=(S<<9|S>>>23)+y|0,C+=(S&x|y&~x)+m[3]-187363961|0,C=(C<<14|C>>>18)+S|0,x+=(C&y|S&~y)+m[8]+1163531501|0,x=(x<<20|x>>>12)+C|0,y+=(x&S|C&~S)+m[13]-1444681467|0,y=(y<<5|y>>>27)+x|0,S+=(y&C|x&~C)+m[2]-51403784|0,S=(S<<9|S>>>23)+y|0,C+=(S&x|y&~x)+m[7]+1735328473|0,C=(C<<14|C>>>18)+S|0,x+=(C&y|S&~y)+m[12]-1926607734|0,x=(x<<20|x>>>12)+C|0,y+=(x^C^S)+m[5]-378558|0,y=(y<<4|y>>>28)+x|0,S+=(y^x^C)+m[8]-2022574463|0,S=(S<<11|S>>>21)+y|0,C+=(S^y^x)+m[11]+1839030562|0,C=(C<<16|C>>>16)+S|0,x+=(C^S^y)+m[14]-35309556|0,x=(x<<23|x>>>9)+C|0,y+=(x^C^S)+m[1]-1530992060|0,y=(y<<4|y>>>28)+x|0,S+=(y^x^C)+m[4]+1272893353|0,S=(S<<11|S>>>21)+y|0,C+=(S^y^x)+m[7]-155497632|0,C=(C<<16|C>>>16)+S|0,x+=(C^S^y)+m[10]-1094730640|0,x=(x<<23|x>>>9)+C|0,y+=(x^C^S)+m[13]+681279174|0,y=(y<<4|y>>>28)+x|0,S+=(y^x^C)+m[0]-358537222|0,S=(S<<11|S>>>21)+y|0,C+=(S^y^x)+m[3]-722521979|0,C=(C<<16|C>>>16)+S|0,x+=(C^S^y)+m[6]+76029189|0,x=(x<<23|x>>>9)+C|0,y+=(x^C^S)+m[9]-640364487|0,y=(y<<4|y>>>28)+x|0,S+=(y^x^C)+m[12]-421815835|0,S=(S<<11|S>>>21)+y|0,C+=(S^y^x)+m[15]+530742520|0,C=(C<<16|C>>>16)+S|0,x+=(C^S^y)+m[2]-995338651|0,x=(x<<23|x>>>9)+C|0,y+=(C^(x|~S))+m[0]-198630844|0,y=(y<<6|y>>>26)+x|0,S+=(x^(y|~C))+m[7]+1126891415|0,S=(S<<10|S>>>22)+y|0,C+=(y^(S|~x))+m[14]-1416354905|0,C=(C<<15|C>>>17)+S|0,x+=(S^(C|~y))+m[5]-57434055|0,x=(x<<21|x>>>11)+C|0,y+=(C^(x|~S))+m[12]+1700485571|0,y=(y<<6|y>>>26)+x|0,S+=(x^(y|~C))+m[3]-1894986606|0,S=(S<<10|S>>>22)+y|0,C+=(y^(S|~x))+m[10]-1051523|0,C=(C<<15|C>>>17)+S|0,x+=(S^(C|~y))+m[1]-2054922799|0,x=(x<<21|x>>>11)+C|0,y+=(C^(x|~S))+m[8]+1873313359|0,y=(y<<6|y>>>26)+x|0,S+=(x^(y|~C))+m[15]-30611744|0,S=(S<<10|S>>>22)+y|0,C+=(y^(S|~x))+m[6]-1560198380|0,C=(C<<15|C>>>17)+S|0,x+=(S^(C|~y))+m[13]+1309151649|0,x=(x<<21|x>>>11)+C|0,y+=(C^(x|~S))+m[4]-145523070|0,y=(y<<6|y>>>26)+x|0,S+=(x^(y|~C))+m[11]-1120210379|0,S=(S<<10|S>>>22)+y|0,C+=(y^(S|~x))+m[2]+718787259|0,C=(C<<15|C>>>17)+S|0,x+=(S^(C|~y))+m[9]-343485551|0,x=(x<<21|x>>>11)+C|0,w[0]=y+w[0]|0,w[1]=x+w[1]|0,w[2]=C+w[2]|0,w[3]=S+w[3]|0}function o(w){var m=[],y;for(y=0;y<64;y+=4)m[y>>2]=w.charCodeAt(y)+(w.charCodeAt(y+1)<<8)+(w.charCodeAt(y+2)<<16)+(w.charCodeAt(y+3)<<24);return m}function a(w){var m=[],y;for(y=0;y<64;y+=4)m[y>>2]=w[y]+(w[y+1]<<8)+(w[y+2]<<16)+(w[y+3]<<24);return m}function s(w){var m=w.length,y=[1732584193,-271733879,-1732584194,271733878],x,C,S,T,_,E;for(x=64;x<=m;x+=64)i(y,o(w.substring(x-64,x)));for(w=w.substring(x-64),C=w.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=0;x<C;x+=1)S[x>>2]|=w.charCodeAt(x)<<(x%4<<3);if(S[x>>2]|=128<<(x%4<<3),x>55)for(i(y,S),x=0;x<16;x+=1)S[x]=0;return T=m*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(T[2],16),E=parseInt(T[1],16)||0,S[14]=_,S[15]=E,i(y,S),y}function c(w){var m=w.length,y=[1732584193,-271733879,-1732584194,271733878],x,C,S,T,_,E;for(x=64;x<=m;x+=64)i(y,a(w.subarray(x-64,x)));for(w=x-64<m?w.subarray(x-64):new Uint8Array(0),C=w.length,S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=0;x<C;x+=1)S[x>>2]|=w[x]<<(x%4<<3);if(S[x>>2]|=128<<(x%4<<3),x>55)for(i(y,S),x=0;x<16;x+=1)S[x]=0;return T=m*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),_=parseInt(T[2],16),E=parseInt(T[1],16)||0,S[14]=_,S[15]=E,i(y,S),y}function l(w){var m="",y;for(y=0;y<4;y+=1)m+=n[w>>y*8+4&15]+n[w>>y*8&15];return m}function f(w){var m;for(m=0;m<w.length;m+=1)w[m]=l(w[m]);return w.join("")}f(s("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function w(m,y){return m=m|0||0,m<0?Math.max(m+y,0):Math.min(m,y)}ArrayBuffer.prototype.slice=function(m,y){var x=this.byteLength,C=w(m,x),S=x,T,_,E,D;return y!==r&&(S=w(y,x)),C>S?new ArrayBuffer(0):(T=S-C,_=new ArrayBuffer(T),E=new Uint8Array(_),D=new Uint8Array(this,C,T),E.set(D),_)}}();function u(w){return/[\u0080-\uFFFF]/.test(w)&&(w=unescape(encodeURIComponent(w))),w}function d(w,m){var y=w.length,x=new ArrayBuffer(y),C=new Uint8Array(x),S;for(S=0;S<y;S+=1)C[S]=w.charCodeAt(S);return m?C:x}function h(w){return String.fromCharCode.apply(null,new Uint8Array(w))}function g(w,m,y){var x=new Uint8Array(w.byteLength+m.byteLength);return x.set(new Uint8Array(w)),x.set(new Uint8Array(m),w.byteLength),x}function p(w){var m=[],y=w.length,x;for(x=0;x<y-1;x+=2)m.push(parseInt(w.substr(x,2),16));return String.fromCharCode.apply(String,m)}function v(){this.reset()}return v.prototype.append=function(w){return this.appendBinary(u(w)),this},v.prototype.appendBinary=function(w){this._buff+=w,this._length+=w.length;var m=this._buff.length,y;for(y=64;y<=m;y+=64)i(this._hash,o(this._buff.substring(y-64,y)));return this._buff=this._buff.substring(y-64),this},v.prototype.end=function(w){var m=this._buff,y=m.length,x,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S;for(x=0;x<y;x+=1)C[x>>2]|=m.charCodeAt(x)<<(x%4<<3);return this._finish(C,y),S=f(this._hash),w&&(S=p(S)),this.reset(),S},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(w){return this._buff=w.buff,this._length=w.length,this._hash=w.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(w,m){var y=m,x,C,S;if(w[y>>2]|=128<<(y%4<<3),y>55)for(i(this._hash,w),y=0;y<16;y+=1)w[y]=0;x=this._length*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt(x[2],16),S=parseInt(x[1],16)||0,w[14]=C,w[15]=S,i(this._hash,w)},v.hash=function(w,m){return v.hashBinary(u(w),m)},v.hashBinary=function(w,m){var y=s(w),x=f(y);return m?p(x):x},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(w){var m=g(this._buff.buffer,w),y=m.length,x;for(this._length+=w.byteLength,x=64;x<=y;x+=64)i(this._hash,a(m.subarray(x-64,x)));return this._buff=x-64<y?new Uint8Array(m.buffer.slice(x-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(w){var m=this._buff,y=m.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C,S;for(C=0;C<y;C+=1)x[C>>2]|=m[C]<<(C%4<<3);return this._finish(x,y),S=f(this._hash),w&&(S=p(S)),this.reset(),S},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var w=v.prototype.getState.call(this);return w.buff=h(w.buff),w},v.ArrayBuffer.prototype.setState=function(w){return w.buff=d(w.buff,!0),v.prototype.setState.call(this,w)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(w,m){var y=c(new Uint8Array(w)),x=f(y);return m?p(x):x},v})})(nR);var tY=nR.exports;const nY=Ys(tY),rY=["lastShaderProgramBound","context","_openGLRenderWindow"];function iY(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,i)=>{let o=n;i.length>0&&(o=Te.substitute(o,"VSOut","GSOut").result);const a=e._openGLRenderWindow.getWebgl2();let s=`
`,c=`#version 100
`;a?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(s=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(s+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),o=Te.substitute(o,"//VTK::System::Dec",[`${c}
`,a?"":`#extension GL_OES_standard_derivatives : enable
`,s,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let l=Te.substitute(r,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(a){l=Te.substitute(l,"varying","out").result,o=Te.substitute(o,"varying","in").result;let u="",d=0;for(;o.includes(`gl_FragData[${d}]`);)o=Te.substitute(o,`gl_FragData\\[${d}\\]`,`fragOutput${d}`).result,u+=`layout(location = ${d}) out vec4 fragOutput${d};
`,d++;o=Te.substitute(o,"//VTK::Output::Dec",u).result}const f=Te.substitute(i,"//VTK::System::Dec",c).result;return{VSSource:l,FSSource:o,GSSource:f}},t.readyShaderProgramArray=(r,n,i)=>{const o=t.replaceShaderValues(r,n,i),a=t.getShaderProgram(o.VSSource,o.FSSource,o.GSSource);return t.readyShaderProgram(a)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,i)=>{const o=`${r}${n}${i}`,a=nY.hash(o);if(!(a in e.shaderPrograms)){const s=Te.newInstance();return s.setContext(e.context),s.getVertexShader().setSource(r),s.getFragmentShader().setSource(n),i&&s.getGeometryShader().setSource(i),s.setMd5Hash(a),e.shaderPrograms[a]=s,s}return e.shaderPrograms[a]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}const oY={lastShaderProgramBound:null,shaderPrograms:null,context:null};function rR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oY,r),e.shaderPrograms={},K.obj(t,e),K.setGet(t,e,rY),K.moveToProtected(t,e,["openGLRenderWindow"]),iY(t,e)}const aY=K.newInstance(rR,"vtkShaderCache");var sY={newInstance:aY,extend:rR};const{vtkErrorMacro:cY}=K;function lY(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&cY("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}const uY={context:null,numberOfTextureUnits:0,textureUnits:0};function iR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uY,r),K.obj(t,e),e.textureUnits=[],K.get(t,e,["numberOfTextureUnits"]),K.setGet(t,e,["context"]),lY(t,e)}const fY=K.newInstance(iR,"vtkOpenGLTextureUnitManager");var dY={newInstance:fY,extend:iR};function hY(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{const n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,i)=>{const o=i.getViewportByReference(),a=t.getFramebufferSize();return o[0]*a[0]<=r&&o[2]*a[0]>=r&&o[1]*a[1]<=n&&o[3]*a[1]>=n},t.getViewportSize=r=>{const n=r.getViewportByReference(),i=t.getFramebufferSize();return[(n[2]-n[0])*i[0],(n[3]-n[1])*i[1]]},t.getViewportCenter=r=>{const n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r/o[0],n/o[1],i]},t.normalizedDisplayToDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r*o[0],n*o[1],i]},t.worldToView=(r,n,i,o)=>o.worldToView(r,n,i),t.viewToWorld=(r,n,i,o)=>o.viewToWorld(r,n,i),t.worldToDisplay=(r,n,i,o)=>{const a=o.worldToView(r,n,i),s=t.getViewportSize(o),c=o.viewToProjection(a[0],a[1],a[2],s[0]/s[1]),l=o.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(l[0],l[1],l[2])},t.displayToWorld=(r,n,i,o)=>{const a=t.displayToNormalizedDisplay(r,n,i),s=o.normalizedDisplayToProjection(a[0],a[1],a[2]),c=t.getViewportSize(o),l=o.projectionToView(s[0],s[1],s[2],c[0]/c[1]);return o.viewToWorld(l[0],l[1],l[2])},t.normalizedDisplayToViewport=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=t.normalizedDisplayToDisplay(r,n,i);return[s[0]-a[0]-.5,s[1]-a[1]-.5,i]},t.viewportToNormalizedViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return a&&a[0]!==0&&a[1]!==0?[r/(a[0]-1),n/(a[1]-1),i]:[r,n,i]},t.normalizedViewportToViewport=(r,n,i,o)=>{const a=t.getViewportSize(o);return[r*(a[0]-1),n*(a[1]-1),i]},t.displayToLocalDisplay=(r,n,i)=>{const o=t.getFramebufferSize();return[r,o[1]-n-1,i]},t.viewportToNormalizedDisplay=(r,n,i,o)=>{let a=o.getViewportByReference();a=t.normalizedDisplayToDisplay(a[0],a[1],0);const s=r+a[0]+.5,c=n+a[1]+.5;return t.displayToNormalizedDisplay(s,c,i)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{K.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,i,o)=>{K.vtkErrorMacro("not implemented")},t.createSelector=()=>{K.vtkErrorMacro("not implemented")}}const gY={size:void 0,selector:void 0};function oR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gY,r),e.size||(e.size=[300,300]),K.getArray(t,e,["size"],2),K.get(t,e,["selector"]),Gn.extend(t,e,r),hY(t,e)}const pY=K.newInstance(oR,"vtkRenderWindowViewNode");var mY={newInstance:pY,extend:oR};const vY="__getUnderlyingContext";function yY(){const t=new Map,e={apply(i,o,a){return t.has(a[0])?t.get(a[0]):i.apply(o,a)}};function r(i){return{apply(o,a,s){return t.set(i,s[0]),o.apply(a,s)}}}const n=Object.create(null);return n.getParameter=(i,o,a,s)=>new Proxy(s.bind(i),e),n.depthMask=(i,o,a,s)=>new Proxy(s.bind(i),r(i.DEPTH_WRITEMASK)),{get(i,o,a){if(o===vY)return()=>i;let s=Reflect.get(i,o,i);s instanceof Function&&(s=s.bind(i));const c=n[o];return c?c(i,o,a,s):s}}}const{vtkDebugMacro:s6,vtkErrorMacro:c6}=K,wY={position:"absolute",top:0,left:0,width:"100%",height:"100%"},xY=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function oo(t,e,r){const n=t.createFramebuffer(),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),o===t.FRAMEBUFFER_COMPLETE}let yv=0;const qy=[];function CY(){yv++,qy.forEach(t=>t(yv))}function SY(){yv--,qy.forEach(t=>t(yv))}function TY(t){qy.push(t)}function _Y(t){return qy.pop()}function l6(t){t.preventDefault()}function EY(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=yY()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",l6,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const i=[0,0];function o(){e.renderable&&(e.size[0]!==i[0]||e.size[1]!==i[1])&&(i[0]=e.size[0],i[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(o),t.buildPass=u=>{if(u){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(d=>{var h;(h=d.setOpenGLRenderWindow)==null||h.call(d,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&CY(),e.textureUnitManager=dY.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const u=e.context;u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),u.depthFunc(u.LEQUAL),u.enable(u.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=u=>{e.el&&e.el!==u&&(e.canvas.parentNode!==e.el&&c6("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==u&&(e.el=u,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:u,height:d}=e.el.getBoundingClientRect();e.containerSize=[u,d]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var d;return((d=e.activeFramebuffer)==null?void 0:d.getSize())||e.size},t.getPixelData=(u,d,h,g)=>{const p=new Uint8Array((h-u+1)*(g-d+1)*4);return e.context.readPixels(u,d,h-u+1,g-d+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},d=null;const h=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&h&&(d=e.canvas.getContext("webgl2",u),d&&(e.webgl2=!0,s6("using webgl2"))),d||(s6("using webgl1"),d=e.canvas.getContext("webgl",u)||e.canvas.getContext("experimental-webgl",u)),new Proxy(d,n())},t.get2DContext=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",u)},t.restoreContext=()=>{const u=DT.newInstance();u.setCurrentOperation("Release"),u.traverse(t,null)},t.activateTexture=u=>{const d=e._textureResourceIds.get(u);if(d!==void 0){e.context.activeTexture(e.context.TEXTURE0+d);return}const h=t.getTextureUnitManager().allocate();if(h<0){c6("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(u,h),e.context.activeTexture(e.context.TEXTURE0+h)},t.deactivateTexture=u=>{const d=e._textureResourceIds.get(u);d!==void 0&&(t.getTextureUnitManager().free(d),e._textureResourceIds.delete(u))},t.getTextureUnitForTexture=u=>{const d=e._textureResourceIds.get(u);return d!==void 0?d:-1},t.getDefaultTextureByteSize=function(u){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(u){case Ht.CHAR:case Ht.SIGNED_CHAR:case Ht.UNSIGNED_CHAR:return 1;case d:case h:case Ht.UNSIGNED_SHORT:case Ht.SHORT:case Ht.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(u,d){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(u){case Ht.UNSIGNED_CHAR:switch(d){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(h&&!g&&Ht.UNSIGNED_SHORT):switch(d){case 1:return h.R16_EXT;case 2:return h.RG16_EXT;case 3:return h.RGB16_EXT;case 4:default:return h.RGBA16_EXT}case(h&&!g&&Ht.SHORT):switch(d){case 1:return h.R16_SNORM_EXT;case 2:return h.RG16_SNORM_EXT;case 3:return h.RGB16_SNORM_EXT;case 4:default:return h.RGBA16_SNORM_EXT}case Ht.UNSIGNED_SHORT:case Ht.SHORT:case Ht.FLOAT:default:switch(d){case 1:return g?e.context.R16F:e.context.R32F;case 2:return g?e.context.RG16F:e.context.RG32F;case 3:return g?e.context.RGB16F:e.context.RGB32F;case 4:default:return g?e.context.RGBA16F:e.context.RGBA32F}}switch(d){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=u=>{e.bgImage.src=u.src},t.setUseBackgroundImage=u=>{e.useBackgroundImage=u,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function a(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const d=document.createElement("canvas"),h=d.getContext("2d");d.width=e.canvas.width,d.height=e.canvas.height,h.drawImage(e.canvas,0,0);const g=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(m=>{m.getViewProps().forEach(x=>{if(x.getContainer){const S=x.getContainer().getElementsByTagName("canvas");for(let T=0;T<S.length;T++){const _=S[T],E=_.getBoundingClientRect(),D=E.x-g.x,b=E.y-g.y;h.drawImage(_,D,b)}}})});const w=d.toDataURL(u);d.remove(),t.invokeImageReady(w)}t.captureNextImage=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:d=!1,size:h=null,scale:g=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=u;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:h||g!==1?h||e.size.map(v=>v*g):null},new Promise((v,w)=>{const m=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=p,m.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(x=>{let{restoreParamsFn:C,arg:S}=x;return C(S)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(y);else{const x=document.createElement("img");if(x.style=wY,x.src=y,e._screenshot.placeHolder=e.el.appendChild(x),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),d){const C=d!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(S=>{const T=S.getActiveCamera(),_=T.get("focalPoint","position","parallelScale");return{resetCameraArgs:C?{renderer:S}:void 0,resetCameraFn:C?d:S.resetCamera,restoreParamsFn:T.set,arg:JSON.parse(JSON.stringify(_))}}),e._screenshot.cameras.forEach(S=>{let{resetCameraFn:T,resetCameraArgs:_}=S;return T(_)})}t.traverseAllPasses()}})})};let s;t.getHardwareMaximumLineWidth=()=>{if(s!=null)return s;const u=t.get3DContext(),d=u.getParameter(u.ALIASED_LINE_WIDTH_RANGE);return s=d[1],d[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const u=t.get3DContext(),d=u.getExtension("OES_texture_float"),h=u.getExtension("OES_texture_half_float"),g=u.getExtension("WEBGL_debug_renderer_info"),p=u.getExtension("WEBGL_draw_buffers"),v=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),w=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",u.getParameter(u.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",u.getParameter(u.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",u.getParameter(u.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",u.getParameter(u.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",u.getParameter(u.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&u.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",u.getParameter(u.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",u.getParameter(u.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",u.getParameter(u.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",u.getParameter(u.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",u.getParameter(u.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",u.getParameter(u.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",u.getParameter(u.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",u.getParameter(u.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",u.getParameter(u.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",u.getParameter(u.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",u.getParameter(u.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",u.getParameter(u.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",u.getParameter(u.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[d&&oo(u,u.RGBA,u.UNSIGNED_BYTE)?"RGBA":"",d&&oo(u,u.RGB,u.UNSIGNED_BYTE)?"RGB":"",d&&oo(u,u.LUMINANCE,u.UNSIGNED_BYTE)?"LUMINANCE":"",d&&oo(u,u.ALPHA,u.UNSIGNED_BYTE)?"ALPHA":"",d&&oo(u,u.LUMINANCE_ALPHA,u.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[h&&oo(u,u.RGBA,h.HALF_FLOAT_OES)?"RGBA":"",h&&oo(u,u.RGB,h.HALF_FLOAT_OES)?"RGB":"",h&&oo(u,u.LUMINANCE,h.HALF_FLOAT_OES)?"LUMINANCE":"",h&&oo(u,u.ALPHA,h.HALF_FLOAT_OES)?"ALPHA":"",h&&oo(u,u.LUMINANCE_ALPHA,h.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[d&&oo(u,u.RGBA,u.FLOAT)?"RGBA":"",d&&oo(u,u.RGB,u.FLOAT)?"RGB":"",d&&oo(u,u.LUMINANCE,u.FLOAT)?"LUMINANCE":"",d&&oo(u,u.ALPHA,u.FLOAT)?"ALPHA":"",d&&oo(u,u.LUMINANCE_ALPHA,u.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?u.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).precision," (-2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMin,"</sup> - 2<sup>",u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",u.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",u.getParameter(u.RENDERER)],["WebGL Vendor","VENDOR",u.getParameter(u.VENDOR)],["WebGL Version","VERSION",u.getParameter(u.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",u.getParameter(u.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",g&&u.getParameter(g.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",g&&u.getParameter(g.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],m={};for(;w.length;){const[y,x,C]=w.pop();x&&(m[x]={label:y,value:C})}return e._glInformation=m,m},t.traverseAllPasses=()=>{var d;if(e.renderPasses)for(let h=0;h<e.renderPasses.length;++h)e.renderPasses[h].traverse(t,null);e.notifyStartCaptureImage&&a(),t.copyParentContent();const u=e.renderable.getChildRenderWindowsByReference();for(let h=0;h<u.length;++h)(d=t.getViewNodeFor(u[h]))==null||d.traverseAllPasses()},t.copyParentContent=()=>{const u=e.rootOpenGLRenderWindow;if(!u||!e.context2D||e.children.some(g=>{var p;return!!((p=g.getSelector)!=null&&p.call(g))}))return;const d=u.getCanvas(),h=e.canvas;e.context2D.drawImage(d,0,d.height-h.height,h.width,h.height,0,0,h.width,h.height)},t.resizeFromChildRenderWindows=()=>{var d;const u=e.renderable.getChildRenderWindowsByReference();if(u.length>0){const h=[0,0];for(let g=0;g<u.length;++g){const p=(d=t.getViewNodeFor(u[g]))==null?void 0:d.getSize();p&&(h[0]=p[0]>h[0]?p[0]:h[0],h[1]=p[1]>h[1]?p[1]:h[1])}t.setSize(...h)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=u=>{if(e.viewStream===u)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=u,e.viewStream){const d=e.renderable.getRenderers()[0];d.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(h=>t.setBackgroundImage(h.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const u=GT.newInstance();return u.setOpenGLRenderWindow(t),u};function c(){e.canvas.removeEventListener("webglcontextlost",l6),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=K.chain(()=>{e.context&&SY(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=u=>{e.activeFramebuffer=u};const l=t.setSize;t.setSize=(u,d)=>{const h=l(u,d);return h&&t.invokeWindowResizeEvent({width:u,height:d}),h},t.registerGraphicsResourceUser=(u,d)=>{e._graphicsResources.has(u)||t.setGraphicsResourceForObject(u,null,null);const h=e._graphicsResources.get(u);h==null||h.users.add(d)},t.unregisterGraphicsResourceUser=(u,d)=>{var g;const h=e._graphicsResources.get(u);h&&(h.users.delete(d),h.users.size||((g=h.oglObject)==null||g.releaseGraphicsResources(t),e._graphicsResources.delete(u)))},t.getGraphicsResourceForObject=u=>e._graphicsResources.get(u),t.setGraphicsResourceForObject=(u,d,h)=>{var p;if(!u)return;const g=e._graphicsResources.get(u);(p=g==null?void 0:g.oglObject)==null||p.releaseGraphicsResources(t),e._graphicsResources.set(u,{coreObject:u,oglObject:d,hash:h,users:(g==null?void 0:g.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let u=0;return e._graphicsResources.forEach(d=>{let{oglObject:h}=d;u+=h.getAllocatedGPUMemoryInBytes()}),u},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(u=>{let{oglObject:d}=u;d.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(u=>{const d=t.getViewNodeFor(u);d==null||d.releaseGraphicsResources()})};const f={...t};xY.forEach(u=>{t[u]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[u](...arguments):f[u](...arguments)}})}const DY={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function aR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DY,r),mY.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=GT.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=mK.newInstance(),e.shaderCache=sY.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=vX.newInstance(),K.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),K.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),K.setGetArray(t,e,["size"],2),K.event(t,e,"imageReady"),K.event(t,e,"windowResizeEvent"),EY(t,e)}const WT=K.newInstance(aR,"vtkOpenGLRenderWindow");MO("WebGL",WT);var bY={newInstance:WT,extend:aR,pushMonitorGLContextCount:TY,popMonitorGLContextCount:_Y};Hr("vtkRenderWindow",WT);function IY(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),sr(e.keyMatrices.mcwc,e.renderable.getMatrix()),Yt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Ta(e.keyMatrices.normalMatrix):(jy(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),n1(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),IT(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const OY={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function sR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OY,r),Gn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Ta(new Float64Array(9)),mcwc:yt(new Float64Array(16))},Fr(t,e,["context"]),mo(t,e,["activeTextures"]),IY(t,e)}const cR=Sn(sR);var MY={newInstance:cR,extend:sR};Hr("vtkActor",cR);function RY(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const i=e.children[n];i.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(i)):e.oglmapper=i}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let i=0;i<e.activeTextures.length;i++)e.activeTextures[i].deactivate()}}const PY={context:null,activeTextures:null};function lR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PY,r),Gn.extend(t,e,r),Fr(t,e,["context"]),mo(t,e,["activeTextures"]),RY(t,e)}const uR=Sn(lR);var LY={newInstance:uR,extend:lR};Hr("vtkActor2D",uR);function AY(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){const n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){sr(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),jy(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),n1(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Yt(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const n=e._openGLRenderer.getAspectRatio();sr(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),Yt(e.keyMatrices.vcpc,e.keyMatrices.vcpc),rn(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}const NY={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function fR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NY,r),Gn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Fr(t,e,["context","keyMatrixTime"]),AY(t,e)}const dR=Sn(fR);var kY={newInstance:dR,extend:fR};Hr("vtkCamera",dR);function VY(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{const n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{const n=r.length;for(let i=0;i<n&&i<6;i++)t.addClippingPlane(r[i])}},t.getClippingPlaneInDataCoords=(r,n,i)=>{const o=e.clippingPlanes,a=r;if(o){const s=o.length;if(n>=0&&n<s){const c=o[n],l=c.getNormal(),f=c.getOrigin(),u=l[0],d=l[1],h=l[2],g=-(u*f[0]+d*f[1]+h*f[2]);i[0]=u*a[0]+d*a[4]+h*a[8]+g*a[12],i[1]=u*a[1]+d*a[5]+h*a[9]+g*a[13],i[2]=u*a[2]+d*a[6]+h*a[10]+g*a[14],i[3]=u*a[3]+d*a[7]+h*a[11]+g*a[15];return}}K.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}const FY={clippingPlanes:[]};function UY(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FY,r),K.obj(t,e),K.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),VY(t,e)}var hR={extend:UY};function BY(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);const n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{K.vtkErrorMacro("not implemented")}}const GY={};function gR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GY,r),K.obj(t,e),K.setGet(t,e,["transform"]),BY(t,e)}const WY=K.newInstance(gR,"vtkImplicitFunction");var zY={newInstance:WY,extend:gR};const aC=1e-6,pR="coincide",mR="disjoint";function $Y(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function vR(t,e,r){const n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function yR(t,e,r,n){const i=[];Lc(t,e,i);const o=qt(r,i);n[0]=t[0]-o*r[0],n[1]=t[1]-o*r[1],n[2]=t[2]-o*r[2]}function wR(t,e,r){const n=qt(t,e);let i=qt(e,e);return i===0&&(i=1),r[0]=t[0]-n*e[0]/i,r[1]=t[1]-n*e[1]/i,r[2]=t[2]-n*e[2]/i,r}function xR(t,e,r,n){const i=[];Lc(t,e,i);const o=qt(r,i),a=qt(r,r);a!==0?(n[0]=t[0]-o*r[0]/a,n[1]=t[1]-o*r[1]/a,n[2]=t[2]-o*r[2]/a):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function CR(t,e,r,n){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},o=[],a=[];Lc(e,t,o),Lc(r,t,a);const s=qt(n,a),c=qt(n,o);let l,f;return c<0?l=-c:l=c,s<0?f=-s*aC:f=s*aC,l<=f||(i.t=s/c,i.x[0]=t[0]+i.t*o[0],i.x[1]=t[1]+i.t*o[1],i.x[2]=t[2]+i.t*o[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function SR(t,e,r,n){const i={intersection:!1,l0:[],l1:[],error:null},o=[];$s(e,n,o);const a=o.map(u=>Math.abs(u));if(a[0]+a[1]+a[2]<aC){const u=[];return Lc(t,r,u),qt(e,u)===0?i.error=pR:i.error=mR,i}let s;a[0]>a[1]&&a[0]>a[2]?s="x":a[1]>a[2]?s="y":s="z";const c=[],l=-qt(e,t),f=-qt(n,r);switch(s){case"x":c[0]=0,c[1]=(f*e[2]-l*n[2])/o[0],c[2]=(l*n[1]-f*e[1])/o[0];break;case"y":c[0]=(l*n[2]-f*e[2])/o[1],c[1]=0,c[2]=(f*e[0]-l*n[0])/o[1];break;case"z":c[0]=(f*e[1]-l*n[1])/o[2],c[1]=(l*n[0]-f*e[0])/o[2],c[2]=0;break}return i.l0=c,fv(c,o,i.l1),i.intersection=!0,i}const jY={evaluate:$Y,distanceToPlane:vR,projectPoint:yR,projectVector:wR,generalizedProjectPoint:xR,intersectWithLine:CR,intersectWithPlane:SR,DISJOINT:mR,COINCIDE:pR};function HY(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>vR(r,e.origin,e.normal),t.projectPoint=(r,n)=>{yR(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>wR(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{xR(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,i)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>CR(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>SR(r,n,e.origin,e.normal)}const KY={normal:[0,0,1],origin:[0,0,0]};function TR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KY,r),zY.extend(t,e,r),K.setGetArray(t,e,["normal","origin"],3),HY(t,e)}const qY=K.newInstance(TR,"vtkPlane");var Yi={newInstance:qY,extend:TR,...jY};const Xy=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function _R(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function zc(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function zT(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $T(t){return zT(t,Xy)}function wv(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=i<e?i:e,t[1]=o>e?o:e,t[2]=a<r?a:r,t[3]=s>r?s:r,t[4]=c<n?c:n,t[5]=l>n?l:n,t}function jT(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)wv(t,...e[r]);else for(let r=0;r<e.length;r+=3)wv(t,...e.slice(r,r+3));return t}function ER(t,e,r,n,i,o,a){const[s,c,l,f,u,d]=t;return a===void 0?(t[0]=Math.min(e[0],s),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],f),t[4]=Math.min(e[4],u),t[5]=Math.max(e[5],d)):(t[0]=Math.min(e,s),t[1]=Math.max(r,c),t[2]=Math.min(n,l),t[3]=Math.max(i,f),t[4]=Math.min(o,u),t[5]=Math.max(a,d)),t}function DR(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e,t[1]=e>o?e:o,t[2]=r,t[3]=r>s?r:s,t[4]=n,t[5]=n>l?n:l,i!==e||a!==r||c!==n}function bR(t,e,r,n){const[i,o,a,s,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=r<a?r:a,t[3]=r,t[4]=n<c?n:c,t[5]=n,o!==e||s!==r||l!==n}function IR(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function HT(t,e,r,n){return zc(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function KT(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function XY(t,e,r,n){if(!zc(t))return!1;const i=KT(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],HT(t,e,r,n),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function _g(t,e){return t[e*2+1]-t[e*2]}function Yy(t){return[_g(t,0),_g(t,1),_g(t,2)]}function OR(t){return t.slice(0,2)}function MR(t){return t.slice(2,4)}function RR(t){return t.slice(4,6)}function PR(t){const e=Yy(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function LR(t){if(zc(t)){const e=Yy(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function qT(t){return[t[0],t[2],t[4]]}function XT(t){return[t[1],t[3],t[5]]}function K1(t,e){return t<=0&&e>=0||t>=0&&e<=0}function YT(t,e){let r=0;for(let n=0;n<2;n++)for(let i=2;i<4;i++)for(let o=4;o<6;o++)e[r++]=[t[n],t[i],t[o]];return e}function AR(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function NR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const n=YT(t,[]);for(let i=0;i<n.length;++i)Pt(n[i],n[i],e);return $T(r),jT(r,n)}function kR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function VR(t,e,r,n){const i=[].concat(Xy),o=t.getData();for(let a=0;a<o.length;a+=3){const s=[o[a],o[a+1],o[a+2]],c=qt(s,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=qt(s,r);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const f=qt(s,n);i[4]=Math.min(f,i[4]),i[5]=Math.max(f,i[5])}return i}function FR(t,e,r,n,i){let o=!0;const a=[];let s=0;const c=[],l=[0,0,0],f=0,u=1,d=2;for(let h=0;h<3;h++)e[h]<t[2*h]?(a[h]=u,l[h]=t[2*h],o=!1):e[h]>t[2*h+1]?(a[h]=f,l[h]=t[2*h+1],o=!1):a[h]=d;if(o)return n[0]=e[0],n[1]=e[1],n[2]=e[2],i[0]=0,1;for(let h=0;h<3;h++)a[h]!==d&&r[h]!==0?c[h]=(l[h]-e[h])/r[h]:c[h]=-1;for(let h=0;h<3;h++)c[s]<c[h]&&(s=h);if(c[s]>1||c[s]<0)return 0;i[0]=c[s];for(let h=0;h<3;h++)if(s!==h){if(n[h]=e[h]+c[s]*r[h],n[h]<t[2*h]||n[h]>t[2*h+1])return 0}else n[h]=l[h];return 1}function UR(t,e,r){const n=[];let i=0,o=1,a=1;for(let s=4;s<=5;++s){n[2]=t[s];for(let c=2;c<=3;++c){n[1]=t[c];for(let l=0;l<=1;++l)if(n[0]=t[l],i=Yi.evaluate(r,e,n),a&&(o=i>=0?1:-1,a=0),i===0||o>0&&i<0||o<0&&i>0)return 1}}return 0}function BR(t,e){if(!(zc(t)&&zc(e)))return!1;const r=[0,0,0,0,0,0];let n;for(let i=0;i<3;i++)if(n=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(n=!0,r[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(n=!0,r[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(n=!0,r[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(n=!0,r[i*2+1]=t[i*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function xv(t,e){if(!(zc(t)&&zc(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function Cv(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function YY(t,e){return!(!xv(t,e)||!Cv(t,...qT(e))||!Cv(t,...XT(e)))}function GR(t,e,r){const n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let o=0;for(let u=0;u<2;u++)for(let d=2;d<4;d++)for(let h=4;h<6;h++){const g=[t[u],t[d],t[h]];i[o++]=Yi.evaluate(r,e,g)}let a=2;for(;a--&&!(K1(i[n[a][0]],i[n[a][4]])&&K1(i[n[a][1]],i[n[a][5]])&&K1(i[n[a][2]],i[n[a][6]])&&K1(i[n[a][3]],i[n[a][7]])););if(a<0)return!1;const s=Math.sign(r[a]),c=Math.abs((t[a*2+1]-t[a*2])*r[a]);let l=s>0?1:0;for(let u=0;u<4;u++){if(c===0)continue;const d=Math.abs(i[n[a][u]])/c;s>0&&d<l&&(l=d),s<0&&d>l&&(l=d)}const f=(1-l)*t[a*2]+l*t[a*2+1];return s>0?t[a*2]=f:t[a*2+1]=f,!0}class JY{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Xy))}getBounds(){return this.bounds}equals(e){return _R(this.bounds,e)}isValid(){return zc(this.bounds)}setBounds(e){return zT(this.bounds,e)}reset(){return $T(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return wv(this.bounds,...r)}addPoints(e){return jT(this.bounds,e)}addBounds(e,r,n,i,o,a){return ER(this.bounds,e,r,n,i,o,a)}setMinPoint(e,r,n){return DR(this.bounds,e,r,n)}setMaxPoint(e,r,n){return bR(this.bounds,e,r,n)}inflate(e){return IR(this.bounds,e)}scale(e,r,n){return HT(this.bounds,e,r,n)}getCenter(){return KT(this.bounds)}getLength(e){return _g(this.bounds,e)}getLengths(){return Yy(this.bounds)}getMaxLength(){return PR(this.bounds)}getDiagonalLength(){return LR(this.bounds)}getMinPoint(){return qT(this.bounds)}getMaxPoint(){return XT(this.bounds)}getXRange(){return OR(this.bounds)}getYRange(){return MR(this.bounds)}getZRange(){return RR(this.bounds)}getCorners(e){return YT(this.bounds,e)}computeCornerPoints(e,r){return AR(this.bounds,e,r)}computeLocalBounds(e,r,n){return VR(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return NR(this.bounds,e,r)}computeScale3(e){return kR(this.bounds,e)}cutWithPlane(e,r){return GR(this.bounds,e,r)}intersectBox(e,r,n,i){return FR(this.bounds,e,r,n,i)}intersectPlane(e,r){return UR(this.bounds,e,r)}intersect(e){return BR(this.bounds,e)}intersects(e){return xv(this.bounds,e)}containsPoint(e,r,n){return Cv(this.bounds,e,r,n)}contains(e){return xv(this.bounds,e)}}function ZY(t){const e=t&&t.bounds;return new JY(e)}const QY={equals:_R,isValid:zc,setBounds:zT,reset:$T,addPoint:wv,addPoints:jT,addBounds:ER,setMinPoint:DR,setMaxPoint:bR,inflate:IR,scale:HT,scaleAboutCenter:XY,getCenter:KT,getLength:_g,getLengths:Yy,getMaxLength:PR,getDiagonalLength:LR,getMinPoint:qT,getMaxPoint:XT,getXRange:OR,getYRange:MR,getZRange:RR,getCorners:YT,computeCornerPoints:AR,computeLocalBounds:VR,transformBounds:NR,computeScale3:kR,cutWithPlane:GR,intersectBox:FR,intersectPlane:UR,intersect:BR,intersects:xv,containsPoint:Cv,contains:YY,INIT_BOUNDS:Xy};var Nn={newInstance:ZY,...QY};function eJ(t,e){t.getBounds=()=>(K.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),fu()),t.getCenter=()=>{var n;const r=t.getBounds();return e.center=Nn.isValid(r)?Nn.getCenter(r):null,(n=e.center)==null?void 0:n.slice()},t.getLength=()=>{const r=t.getBounds();return Nn.getDiagonalLength(r)}}const tJ=t=>({bounds:[...Nn.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function nJ(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tJ(r)),hR.extend(t,e,r),K.setGet(t,e,["viewSpecificProperties"]),eJ(t,e)}var JT={extend:nJ};const $a={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var WR={StructuredType:$a};const{StructuredType:hc}=WR;function rJ(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?hc.EMPTY:e===3?hc.XYZ_GRID:e===2?t[0]===t[1]?hc.YZ_PLANE:t[2]===t[3]?hc.XZ_PLANE:hc.XY_PLANE:e===1?t[0]<t[1]?hc.X_LINE:t[2]<t[3]?hc.Y_LINE:hc.Z_LINE:hc.SINGLE_POINT}var iJ={getDataDescriptionFromExtent:rJ,...WR};const{vtkErrorMacro:Zu}=K;function oJ(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Zu("instance deleted - cannot call any method"),!1;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];const o=n.length===1?n[0]:n;if(o.length!==6)return!1;const a=e.extent.some((s,c)=>s!==o[c]);return a&&(e.extent=o.slice(),e.dataDescription=iJ.getDataDescriptionFromExtent(e.extent),t.modified()),a},t.setDimensions=function(){let r,n,i;if(e.deleted){Zu("instance deleted - cannot call any method");return}if(arguments.length===1){const o=arguments.length<=0?void 0:arguments[0];r=o[0],n=o[1],i=o[2]}else if(arguments.length===3)r=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{Zu("Bad dimension specification");return}t.setExtent(0,r-1,0,n-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const r=t.getDimensions();let n=1;for(let i=0;i<3;i++){if(r[i]===0)return 0;r[i]>1&&(n*=r[i]-1)}return n},t.getNumberOfPoints=()=>{const r=t.getDimensions();return r[0]*r[1]*r[2]},t.getPoint=r=>{const n=t.getDimensions();if(n[0]===0||n[1]===0||n[2]===0)return Zu("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case $a.EMPTY:return null;case $a.SINGLE_POINT:break;case $a.X_LINE:i[0]=r;break;case $a.Y_LINE:i[1]=r;break;case $a.Z_LINE:i[2]=r;break;case $a.XY_PLANE:i[0]=r%n[0],i[1]=r/n[0];break;case $a.YZ_PLANE:i[1]=r%n[1],i[2]=r/n[1];break;case $a.XZ_PLANE:i[0]=r%n[0],i[2]=r/n[0];break;case $a.XYZ_GRID:i[0]=r%n[0],i[1]=r/n[0]%n[1],i[2]=r/(n[0]*n[1]);break;default:Zu("Invalid dataDescription");break}const o=[0,0,0];return t.indexToWorld(i,o),o},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=r=>Nn.transformBounds(r,e.indexToWorld),t.getSpatialExtent=()=>Nn.inflate([...e.extent],.5),t.computeTransforms=()=>{Hy(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Wc(e.indexToWorld,e.indexToWorld,e.spacing),Or(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Pt(n,r,e.indexToWorld),n},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Pt(n,r,e.worldToIndex),n},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Nn.transformBounds(r,e.indexToWorld,n)},t.worldToIndexBounds=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Nn.transformBounds(r,e.worldToIndex,n)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>Nn.getCenter(t.getBounds()),t.computeHistogram=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(r,i);const o=[0,0,0],a=[0,0,0];Nn.computeCornerPoints(i,o,a),Yx(o,o),Yx(a,a);const s=t.getDimensions();Zx(o,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],o),Zx(a,[0,0,0],[s[0]-1,s[1]-1,s[2]-1],a);const c=s[0],l=s[0]*s[1],f=t.getPointData().getScalars().getData();let u=-1/0,d=1/0,h=0,g=0,p=0;for(let y=o[2];y<=a[2];y++)for(let x=o[1];x<=a[1];x++){let C=o[0]+x*c+y*l;for(let S=o[0];S<=a[0];S++){if(!n||n([S,x,y],i)){const T=f[C];T>u&&(u=T),T<d&&(d=T),h+=T*T,g+=T,p+=1}++C}}const v=p>0?g/p:0,w=p?Math.abs(h/p-v*v):0,m=Math.sqrt(w);return{minimum:d,maximum:u,average:v,variance:w,sigma:m,count:p}},t.computeIncrements=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let o=n;for(let a=0;a<3;++a)i[a]=o,o*=r[a*2+1]-r[a*2]+1;return i},t.computeOffsetIndex=r=>{let[n,i,o]=r;const a=t.getExtent(),s=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(a,s);return Math.floor((Math.round(n)-a[0])*c[0]+(Math.round(i)-a[2])*c[1]+(Math.round(o)-a[4])*c[2])},t.getOffsetIndexFromWorld=r=>{const n=t.getExtent(),i=t.worldToIndex(r);for(let o=0;o<3;++o)if(i[o]<n[o*2]||i[o]>n[o*2+1])return Zu(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${n}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=i)return Zu(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const o=t.getOffsetIndexFromWorld(r);return Number.isNaN(o)?o:t.getPointData().getScalars().getComponent(o,n)}}const aJ={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:$a.EMPTY};function zR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aJ,r),Qd.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Ta(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),K.get(t,e,["indexToWorld","worldToIndex"]),K.setGetArray(t,e,["origin","spacing"],3),K.setGetArray(t,e,["direction"],9),K.getArray(t,e,["extent"],6),oJ(t,e)}const sJ=K.newInstance(zR,"vtkImageData");var eh={newInstance:sJ,extend:zR};const cJ={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},sC={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var ZT={VectorMode:cJ,ScalarMappingTarget:sC};const lJ={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},uJ={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},fJ={BY_ID:0,BY_NAME:1};var Jy={ColorMode:lJ,GetArray:fJ,ScalarMode:uJ};const{ScalarMappingTarget:u6,VectorMode:Ds}=ZT,{VtkDataTypes:xl}=Lt,{ColorMode:q1}=Jy,{vtkErrorMacro:f6}=K;function dJ(t){return t}function d6(t){return Math.floor(t*255+.5)}function hJ(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Ds.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Ds.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Ds.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){f6("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){const i=n.length;for(let o=0;o<i;o++)e.annotationArray.push({value:r[o],annotation:String(n[o])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let i=t.checkForAnnotatedValue(r),o=!1;return i>=0?e.annotationArray[i].annotation!==n&&(e.annotationArray[i].annotation=n,o=!0):(e.annotationArray.push({value:r,annotation:n}),i=e.annotationArray.length-1,o=!0),o&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{const n=t.checkForAnnotatedValue(r),i=n>=0;return i&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(r);t.getIndexedColor(i,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){const n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,i)=>{const o=r.getNumberOfComponents();let a=null;if(n===q1.DEFAULT&&(r.getDataType()===xl.UNSIGNED_CHAR||r.getDataType()===xl.UNSIGNED_CHAR_CLAMPED)||n===q1.DIRECT_SCALARS&&r)a=t.convertToRGBA(r,o,r.getNumberOfTuples());else{const s={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:xl.UNSIGNED_CHAR},c=K.newTypedArray(s.dataType,4*r.getNumberOfTuples());s.values=c,s.size=c.length,a=Lt.newInstance(s);let l=i;l<0&&o>1?t.mapVectorsThroughTable(r,a,u6.RGBA,-1,-1):(l<0&&(l=0),l>=o&&(l=o-1),t.mapScalarsThroughTable(r,a,u6.RGBA,l))}return a},t.mapVectorsToMagnitude=(r,n,i)=>{const o=r.getNumberOfTuples(),a=r.getNumberOfComponents(),s=n.getData(),c=r.getData();for(let l=0;l<o;l++){let f=0;for(let u=0;u<i;u++)f+=c[l*a+u]*c[l*a+u];s[l]=Math.sqrt(f)}},t.mapVectorsThroughTable=(r,n,i,o,a)=>{let s=t.getVectorMode(),c=a,l=o;const f=r.getNumberOfComponents();s===Ds.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=f&&(l=f-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=f):(l<0&&(l=0),l>=f&&(l=f-1),l+c>f&&(c=f-l)),s===Ds.MAGNITUDE&&(f===1||c===1)&&(s=Ds.COMPONENT));let u=0;switch(l>0&&(u=l),s){case Ds.COMPONENT:{t.mapScalarsThroughTable(r,n,i,u);break}case Ds.RGBCOLORS:break;case Ds.MAGNITUDE:default:{const d=Lt.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,d,c),t.mapScalarsThroughTable(d,n,i,0);break}}},t.luminanceToRGBA=(r,n,i,o)=>{const a=o(i),s=n.getData(),c=r.getData(),l=s.length,f=0,u=1;let d=0;for(let h=f;h<l;h+=u){const g=o(s[h]);c[d*4]=g,c[d*4+1]=g,c[d*4+2]=g,c[d*4+3]=a,d++}},t.luminanceAlphaToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,f=2;let u=0;for(let d=l;d<c;d+=f){const h=o(a[d]);s[u]=h,s[u+1]=h,s[u+2]=h,s[u+3]=o(a[d+1])*i,u+=4}},t.rGBToRGBA=(r,n,i,o)=>{const a=d6(i),s=n.getData(),c=r.getData(),l=s.length,f=0,u=3;let d=0;for(let h=f;h<l;h+=u)c[d*4]=o(s[h]),c[d*4+1]=o(s[h+1]),c[d*4+2]=o(s[h+2]),c[d*4+3]=a,d++},t.rGBAToRGBA=(r,n,i,o)=>{const a=n.getData(),s=r.getData(),c=a.length,l=0,f=4;let u=0;for(let d=l;d<c;d+=f)s[u*4]=o(a[d]),s[u*4+1]=o(a[d+1]),s[u*4+2]=o(a[d+2]),s[u*4+3]=o(a[d+3])*i,u++},t.convertToRGBA=(r,n,i)=>{let{alpha:o}=e;if(n===4&&o>=1&&r.getDataType()===xl.UNSIGNED_CHAR)return r;const a=Lt.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:xl.UNSIGNED_CHAR});if(i<=0)return a;o=o>0?o:0,o=o<1?o:1;let s=dJ;switch((r.getDataType()===xl.FLOAT||r.getDataType()===xl.DOUBLE)&&(s=d6),n){case 1:t.luminanceToRGBA(a,r,o,s);break;case 2:t.luminanceAlphaToRGBA(a,r,s);break;case 3:t.rGBToRGBA(a,r,o,s);break;case 4:t.rGBAToRGBA(a,r,o,s);break;default:return f6("Cannot convert colors"),null}return a},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,i)=>{if(!r)return t.isOpaque();const o=r.getNumberOfComponents();return n===q1.DEFAULT&&r.getDataType()===xl.UNSIGNED_CHAR||n===q1.DIRECT_SCALARS?o===3||o===1?e.alpha>=1:r.getRange(o-1)[0]===255:!0}}const gJ={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Ds.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function $R(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gJ,r),K.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],K.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),K.setArray(t,e,["mappingRange"],2),K.getArray(t,e,["mappingRange"]),hJ(t,e)}const pJ=K.newInstance($R,"vtkScalarsToColors");var Zy={newInstance:pJ,extend:$R,...ZT};const{vtkErrorMacro:h6}=K,g6=0,p6=1,Iw=2;function mJ(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let i=0;const o=Number(r);return o<n.range[0]?i=n.maxIndex+g6+1.5:o>n.range[1]?i=n.maxIndex+p6+1.5:(i=(o+n.shift)*n.scale,i=i<n.maxIndex?i:n.maxIndex),Math.floor(i)},t.linearLookup=(r,n,i)=>{let o=0;hv(r)?o=Math.floor(i.maxIndex+1.5+Iw):o=t.linearIndexLookup(r,i);const a=4*o;return n.slice(a,a+4)},t.indexedLookupFunction=(r,n,i)=>{let o=t.getAnnotatedValueIndexInternal(r);o===-1&&(o=e.numberOfColors+Iw);const a=4*o;return[n[a],n[a+1],n[a+2],n[a+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,i,o)=>{let a=t.linearLookup;e.indexedLookup&&(a=t.indexedLookupFunction);const s=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:s,shift:0,scale:0};t.lookupShiftAndScale(s,c);const l=t.getAlpha(),f=r.getNumberOfTuples(),u=r.getNumberOfComponents(),d=n.getData(),h=r.getData();if(l>=1){if(i===sC.RGBA)for(let g=0;g<f;g++){const p=a(h[g*u+o],e.table,c);d[g*4]=p[0],d[g*4+1]=p[1],d[g*4+2]=p[2],d[g*4+3]=p[3]}}else if(i===sC.RGBA)for(let g=0;g<f;g++){const p=a(h[g*u+o],e.table,c);d[g*4]=p[0],d[g*4+1]=p[1],d[g*4+2]=p[2],d[g*4+3]=Math.floor(p[3]*l+.5)}},t.forceBuild=()=>{let r=0,n=0,i=0,o=0;const a=e.numberOfColors-1;a&&(r=(e.hueRange[1]-e.hueRange[0])/a,n=(e.saturationRange[1]-e.saturationRange[0])/a,i=(e.valueRange[1]-e.valueRange[0])/a,o=(e.alphaRange[1]-e.alphaRange[0])/a),e.table.length=4*a+16;const s=[],c=[];for(let l=0;l<=a;l++)s[0]=e.hueRange[0]+l*r,s[1]=e.saturationRange[0]+l*n,s[2]=e.valueRange[0]+l*i,vf(s,c),c[3]=e.alphaRange[0]+l*o,e.table[l*4]=c[0]*255+.5,e.table[l*4+1]=c[1]*255+.5,e.table[l*4+2]=c[2]*255+.5,e.table[l*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){const i=r[0].length;e.numberOfColors=r.length;const o=4-i;let a=0;for(let s=0;s<e.numberOfColors;s++)e.table[s*4]=255,e.table[s*4+1]=255,e.table[s*4+2]=255,e.table[s*4+3]=255;for(let s=0;s<r.length;s++){const c=r[s];for(let l=0;l<i;l++)e.table[a++]=c[l];a+=o}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return h6("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==Ht.UNSIGNED_CHAR)return h6("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();const n=r.getData();e.table.length=n.length;for(let i=0;i<n.length;i++)e.table[i]=n[i];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:r}=e,n=e.table;let i=(r+g6)*4;e.useBelowRangeColor||r===0?(n[i]=e.belowRangeColor[0]*255+.5,n[i+1]=e.belowRangeColor[1]*255+.5,n[i+2]=e.belowRangeColor[2]*255+.5,n[i+3]=e.belowRangeColor[3]*255+.5):(n[i]=n[0],n[i+1]=n[1],n[i+2]=n[2],n[i+3]=n[3]),i=(r+p6)*4,e.useAboveRangeColor||r===0?(n[i]=e.aboveRangeColor[0]*255+.5,n[i+1]=e.aboveRangeColor[1]*255+.5,n[i+2]=e.aboveRangeColor[2]*255+.5,n[i+3]=e.aboveRangeColor[3]*255+.5):(n[i]=n[4*(r-1)+0],n[i+1]=n[4*(r-1)+1],n[i+2]=n[4*(r-1)+2],n[i+3]=n[4*(r-1)+3]),i=(r+Iw)*4,n[i]=e.nanColor[0]*255+.5,n[i+1]=e.nanColor[1]*255+.5,n[i+2]=e.nanColor[2]*255+.5,n[i+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const vJ={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function jR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vJ,r),Zy.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},K.obj(e.buildTime),e.opaqueFlagBuildTime={},K.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},K.obj(e.insertTime,{mtime:0}),K.get(t,e,["buildTime"]),K.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),K.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),K.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),K.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),mJ(t,e)}const yJ=K.newInstance(jR,"vtkLookupTable");var Sv={newInstance:yJ,extend:jR};const gs={Off:0,PolygonOffset:1};let cC=gs.PolygonOffset,Tv=gs.Off;const wJ=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function xJ(){return cC}function CJ(t){const e=cC===t;return cC=t,e}function SJ(){return Tv}function Qy(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Tv===t;return Tv=t,e}function TJ(){return Qy(gs.Off)}function _J(){return Qy(gs.Off)}function EJ(){return Qy(gs.PolygonOffset)}function DJ(){return wJ[Tv]}var lC={Resolve:gs,getResolveCoincidentTopologyAsString:DJ,getResolveCoincidentTopologyPolygonOffsetFaces:xJ,getResolveCoincidentTopology:SJ,setResolveCoincidentTopology:Qy,setResolveCoincidentTopologyPolygonOffsetFaces:CJ,setResolveCoincidentTopologyToDefault:TJ,setResolveCoincidentTopologyToOff:_J,setResolveCoincidentTopologyToPolygonOffset:EJ};function HR(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=K.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}const QT=["Polygon","Line","Point"],bJ={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},yf={};HR(yf,bJ,QT.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function IJ(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),K.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(lC).forEach(r=>{t[r]=lC[r]}),Object.keys(yf).forEach(r=>{t[r]=yf[r]}),HR(t,e.topologyOffset,QT.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const r=yf.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const r=yf.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const r=yf.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var e5={implementCoincidentTopologyMethods:IJ,staticOffsetAPI:yf,otherStaticMethods:lC,CATEGORIES:QT,Resolve:gs};const{FieldAssociations:m6}=Qd,{staticOffsetAPI:OJ,otherStaticMethods:MJ}=e5,{ColorMode:X1,ScalarMode:Qu,GetArray:Ow}=Jy,{VectorMode:RJ}=ZT,{VtkDataTypes:PJ}=Lt;function Ph(t){return()=>K.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function LJ(t,e){const r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){const n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function AJ(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function v6(t,e,r){const n=Math.floor(e),i=n%(2*r[0]);let o,a;i<r[0]?(t[0]=i,o=1,a=t[0]===r[0]-1):(t[0]=2*r[0]-1-i,o=-1,a=t[0]===0);const s=Math.floor(n/r[0]),c=s%(2*r[1]);let l,f;c<r[1]?(t[1]=c,l=1,f=t[1]===r[1]-1):(t[1]=2*r[1]-1-c,l=-1,f=t[1]===0),t[2]=Math.floor(s/r[1]);const u=e-n;a?f?t[2]+=u:t[1]+=l*u:t[0]+=o*u,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}const y6=new WeakMap;function NJ(t,e,r,n,i,o,a){var I;const s=new Array(arguments.length);for(let R=0;R<arguments.length;++R){const M=arguments[R];s[R]=((I=M.getMTime)==null?void 0:I.call(M))??M}const c=s.join("/"),l=y6.get(t);if(l&&l.stringHash===c)return l.textureCoordinates;const f=(r[1]-r[0])/(n-1),[u,d]=[r[0]-f,r[1]+f],h=u-.5*f,g=1/(d-u+f),p=u,v=(n+1)/(d-u),w=t.getData(),m=t.getNumberOfTuples(),y=t.getNumberOfComponents(),x=e<0||e>=y,C=i[2]<=1?2:3,S=Lt.newInstance({numberOfComponents:C,values:new Float32Array(m*C)}),T=S.getData(),_=[0,0,0];v6(_,n+2,i);let E=0,D=0;const b=[.5,.5,.5];for(let R=0;R<m;++R){let M;if(x){let P=0;for(let k=0;k<y;++k){const z=w[E+k];P+=z*z}M=Math.sqrt(P)}else M=w[E+e];if(E+=y,o&&(M=Sv.applyLogScale(M,r,r)),hv(M))b[0]=_[0],b[1]=_[1],b[2]=_[2];else if(a){let P=(M-p)*v;P<1?P=0:P>n&&(P=n+1),v6(b,P,i)}else{b[1]=.49;const P=(M-h)*g;P>1e3?b[0]=1e3:P<-1e3?b[0]=-1e3:b[0]=P}for(let P=0;P<C;++P)T[D++]=b[P]}return y6.set(t,{stringHash:c,textureCoordinates:S}),S}function kJ(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=fu(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=Sv.newInstance()},t.getColorModeAsString=()=>K.enumToString(X1,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>K.enumToString(Qu,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,i,o,a)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let s=null,c=!1;if(n===Qu.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),c=!0);else if(n===Qu.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===Qu.USE_CELL_DATA)s=r.getCellData().getScalars(),c=!0;else if(n===Qu.USE_POINT_FIELD_DATA){const l=r.getPointData();i===Ow.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===Qu.USE_CELL_FIELD_DATA){const l=r.getCellData();c=!0,i===Ow.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===Qu.USE_FIELD_DATA){const l=r.getFieldData();i===Ow.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}return{scalars:s,cellFlag:c}},t.mapScalars=(r,n)=>{const{scalars:i,cellFlag:o}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=o,!i){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const a=`${t.getMTime()}${i.getMTime()}${n}`;if(e.colorBuildString!==a){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(i,o))e.mapScalarsToTexture(i,o,n);else{e.colorCoordinates=null,e.colorTextureMap=null;const s=t.getLookupTable();s&&(s.build(),e.colorMapColors=s.mapScalars(i,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${i.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,i)=>{const o=e.lookupTable.getRange(),a=e.lookupTable.usingLogScale();a&&Sv.getLogRange(o,o);const s=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==i){e.lookupTable.setAlpha(i),e.colorTextureMap=null,e.lookupTable.build();const l=e.lookupTable.getNumberOfAvailableColors(),f=2048,u=f**3-3,h=4096-2,g=2,p=n?u:h;e.numberOfColorsInRange=Math.min(Math.max(l,g),p);const v=e.numberOfColorsInRange+3,w=e.numberOfColorsInRange+2,m=n?[Math.min(Math.ceil(v/f**0),f),Math.min(Math.ceil(v/f**1),f),Math.min(Math.ceil(v/f**2),f)]:[w,2,1],y=m[0]*m[1]*m[2],x=new Float64Array(y);x.fill(NaN);const C=e.numberOfColorsInRange,S=C+2,T=[0,0,0],_=o[0],E=o[1]-o[0];for(let I=0;I<S;++I){const R=AJ(T,m),M=_+E*(I-1)/(C-1);x[R]=a?10**M:M,LJ(T,m)}const D=Lt.newInstance({numberOfComponents:1,values:x}),b=e.lookupTable.mapScalars(D,e.colorMode,0);e.colorTextureMap=eh.newInstance(),e.colorTextureMap.setDimensions(m),e.colorTextureMap.getPointData().setScalars(b),e.lookupTable.setAlpha(s)}const c=e.lookupTable.getVectorMode()===RJ.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=NJ(r,c,o,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),a,n)},t.getIsOpaque=()=>{const r=t.getInputData(),i=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||i==null)return!0;const o=t.getLookupTable();return o?(o.build(),o.areScalarsOpaque(i,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==X1.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===X1.DEFAULT&&r.getDataType()===PJ.UNSIGNED_CHAR||e.colorMode===X1.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Ph("AcquireInvertibleLookupTable"),t.valueToColor=Ph("ValueToColor"),t.colorToValue=Ph("ColorToValue"),t.useInvertibleColorFor=Ph("UseInvertibleColorFor"),t.clearInvertibleColor=Ph("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const i=r.getRawPixelBuffer(co.ID_LOW24),o=r.getRawPixelBuffer(co.ID_HIGH24),a=r.getCurrentPass(),s=r.getFieldAssociation();let c=null;s===m6.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:s===m6.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&n.forEach(l=>{if(a===co.ID_LOW24){let f=0;o&&(f+=o[l],f*=256),f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],d=r.getPixelBuffer(co.ID_LOW24);d[l]=u&255,d[l+1]=(u&65280)>>8,d[l+2]=(u&16711680)>>16}else if(a===co.ID_HIGH24&&o){let f=0;f+=o[l],f*=256,f+=i[l+2],f*=256,f+=i[l+1],f*=256,f+=i[l];const u=c[f],d=r.getPixelBuffer(co.ID_HIGH24);d[l]=(u&4278190080)>>24}})}}const VJ={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function KR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VJ,r),JT.extend(t,e,r),K.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),K.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),K.setGetArray(t,e,["scalarRange"],2),e5.implementCoincidentTopologyMethods(t,e),kJ(t,e)}const FJ=K.newInstance(KR,"vtkMapper");var js={newInstance:FJ,extend:KR,...OJ,...MJ,...Jy};const UJ={DISPLAY:0,WORLD:1};var qR={CoordinateSystem:UJ};const{CoordinateSystem:uC}=qR;function w6(t){return()=>K.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function BJ(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){const i=e.textures[n].getMTime();i>r&&(r=i)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=w6("pick"),t.hasKey=w6("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{const n=e.textures.filter(i=>i!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(uC.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(uC.DISPLAY)}const GJ={allocatedRenderTime:10,coordinateSystem:uC.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function XR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GJ,r),K.obj(t,e),K.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),K.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),K.moveToProtected(t,e,["parentProp"]),BJ(t,e)}const WJ=K.newInstance(XR,"vtkProp");var r1={newInstance:WJ,extend:XR,...qR},e_=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,i1=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function zJ(t,e){t.replaceShaderCoincidentOffset=(r,n,i)=>{const o=t.getCoincidentParameters(n,i);if(o&&(o.factor!==0||o.offset!==0)){let a=r.Fragment;a=Te.substitute(a,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(o.factor!==0?(a=Te.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Te.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Te.substitute(a,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(o.factor!==0?(a=Te.substitute(a,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,a=Te.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):a=Te.substitute(a,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=a}}}function $J(t,e){t.applyShaderReplacements=(r,n,i)=>{let o=null;if(n&&(o=n.ShaderReplacements),o)for(let a=0;a<o.length;a++){const s=o[a];if(i&&s.replaceFirst||!i&&!s.replaceFirst){const c=s.shaderType,l=r[c],f=Te.substitute(l,s.originalValue,s.replacementValue,s.replaceAll);r[c]=f.result}}},t.buildShaders=(r,n,i)=>{t.getReplacedShaderTemplate(r,n,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);const o=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,o,!0),t.replaceShaderValues(r,n,i),t.applyShaderReplacements(r,o)},t.getReplacedShaderTemplate=(r,n,i)=>{const o=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,i);let a=r.Vertex;if(o){const l=o.VertexShaderCode;l!==void 0&&l!==""&&(a=l)}r.Vertex=a;let s=r.Fragment;if(o){const l=o.FragmentShaderCode;l!==void 0&&l!==""&&(s=l)}r.Fragment=s;let c=r.Geometry;if(o){const l=o.GeometryShaderCode;l!==void 0&&(c=l)}r.Geometry=c}}var Hs={implementReplaceShaderCoincidentOffset:zJ,implementBuildShadersWithReplacements:$J};const{FieldAssociations:Mw}=Qd,{primTypes:ri}=Js,{Representation:p0,Shading:x6}=Zd,{ScalarMode:Y1}=js,{Filter:C6,Wrap:S6}=rr,{vtkErrorMacro:ef}=Ni,jJ={type:"StartEvent"},HJ={type:"EndEvent"},{CoordinateSystem:KJ}=r1;function qJ(t){const e=t.getSelector();return e?e.getCurrentPass():co.MIN_KNOWN_PASS-1}function XJ(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let a=ri.Start;a<ri.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=e_,n.Fragment=i1,n.Geometry=""},t.replaceShaderColor=(n,i,o)=>{let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(f=f.concat(["varying vec4 vertexColorVSOutput;"]),a=Te.substitute(a,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,a=Te.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,s=Te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=Te.substitute(c,"//VTK::Color::Impl",u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=Te.substitute(c,"//VTK::Color::Impl",u.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(o.getBackfaceProperty()&&!e.drawingEdges&&(f=f.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),l?(f=f.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):u=u.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(f=f.concat(["uniform samplerBuffer texture1;"])),c=Te.substitute(c,"//VTK::Color::Impl",u).result),c=Te.substitute(c,"//VTK::Color::Dec",f).result,n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderLight=(n,i,o)=>{let a=n.Fragment;const s="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),l=e.lastBoundBO.getReferenceByName("lastLightCount");let f=[];switch(c){case 0:a=Te.substitute(a,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:a=Te.substitute(a,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`]);a=Te.substitute(a,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let u=0;u<l;++u)f=f.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${u}));`,`  diffuseL += ((df${s}) * lightColor${u});`,`  if (dot(normalVCVSOutput, lightDirectionVC${u}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${u},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${s} * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Te.substitute(a,"//VTK::Light::Impl",f,!1).result;break;case 3:for(let u=0;u<l;++u)f=f.concat([`uniform vec3 lightColor${u};`,`uniform vec3 lightDirectionVC${u}; // normalized`,`uniform vec3 lightHalfAngleVC${u}; // normalized`,`uniform vec3 lightPositionVC${u};`,`uniform vec3 lightAttenuation${u};`,`uniform float lightConeAngle${u};`,`uniform float lightExponent${u};`,`uniform int lightPositional${u};`]);a=Te.substitute(a,"//VTK::Light::Dec",f).result,f=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let u=0;u<l;++u)f=f.concat(["  attenuation = 1.0;",`  if (lightPositional${u} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${u};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${u};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${u}.x`,`       + lightAttenuation${u}.y * distanceVC`,`       + lightAttenuation${u}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${u} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${u});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${u})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${u});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${s}) * lightColor${u});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${u},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${s}) * lightColor${u});`,"    }"]);f=f.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),a=Te.substitute(a,"//VTK::Light::Impl",f,!1).result;break;default:ef("bad light complexity")}n.Fragment=a},t.replaceShaderNormal=(n,i,o)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex,c=n.Geometry,l=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(s=Te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=Te.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=Te.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,l=Te.substitute(l,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,l=Te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(l=Te.substitute(l,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,l=Te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(o.getProperty().getRepresentation())===e.context.LINES?(l=Te.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Te.substitute(l,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(l=Te.substitute(l,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,l=Te.substitute(l,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,l=Te.substitute(l,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=s,n.Geometry=c,n.Fragment=l}},t.replaceShaderPositionVC=(n,i,o)=>{e.lastBoundBO.replaceShaderPositionVC(n,i,o);let a=n.Vertex,s=n.Geometry,c=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Te.substitute(a,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Te.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=Te.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=Te.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(a=Te.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderTCoord=(n,i,o)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;if(e.drawingEdges)return;a=Te.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const l=e.openGLActor.getActiveTextures();let f=2,u=2;if(l&&l.length>0&&(f=l[0].getComponents(),l[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(u=3)),e.renderable.getColorTextureMap()&&(f=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),u=2),u===2){if(a=Te.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,s=Te.substitute(s,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Te.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,l&&l.length>=1)switch(f){case 1:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(a=Te.substitute(a,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,s=Te.substitute(s,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=Te.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,f){case 1:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=Te.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=a,n.Geometry=s,n.Fragment=c}},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();a=Te.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,a=Te.substitute(a,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,s=Te.substitute(s,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getCoincidentParameters=(n,i)=>{let o={factor:0,offset:0};const a=i.getProperty();if(e.renderable.getResolveCoincidentTopology()==gs.PolygonOffset||a.getEdgeVisibility()&&a.getRepresentation()===p0.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===ri.Points||a.getRepresentation()===p0.POINTS?o=e.renderable.getCoincidentTopologyPointOffsetParameter():c===ri.Lines||a.getRepresentation()===p0.WIREFRAME?o=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===ri.Tris||c===ri.TriStrips)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===ri.TrisEdges||c===ri.TriStripsEdges)&&(o=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),o.factor/=2,o.offset/=2)}const s=e._openGLRenderer.getSelector();return s&&s.getFieldAssociation()===Mw.FIELD_ASSOCIATION_POINTS&&(o.offset-=2),o},t.replaceShaderPicking=(n,i,o)=>{let a=n.Fragment,s=n.Vertex;if(a=Te.substitute(a,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===co.ID_LOW24||e.lastSelectionState===co.ID_HIGH24)&&(s=Te.substitute(s,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,s=Te.substitute(s,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,a=Te.substitute(a,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,a=Te.substitute(a,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case co.ID_LOW24:a=Te.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case co.ID_HIGH24:a=Te.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:a=Te.substitute(a,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,a=Te.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=a,n.Vertex=s}},t.replaceShaderValues=(n,i,o)=>{if(t.replaceShaderColor(n,i,o),t.replaceShaderNormal(n,i,o),t.replaceShaderLight(n,i,o),t.replaceShaderTCoord(n,i,o),t.replaceShaderPicking(n,i,o),t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o),t.replaceShaderPositionVC(n,i,o),e.haveSeenDepthRequest){let a=n.Fragment;a=Te.substitute(a,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,a=Te.substitute(a,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=a}},t.getNeedToRebuildShaders=(n,i,o)=>{let a=0,s=0;const c=n.getPrimitiveType(),l=e.currentInput;let f=!1;const u=l.getPointData().getNormals(),d=l.getCellData().getNormals(),h=o.getProperty().getInterpolation()===x6.FLAT,g=o.getProperty().getRepresentation(),p=n.getOpenGLMode(g,c);if((p===e.context.TRIANGLES||d&&!u||!h&&u||!h&&p===e.context.LINES)&&(f=!0),o.getProperty().getLighting()&&f){a=0;const y=i.getLightsByReference();for(let x=0;x<y.length;++x){const C=y[x];C.getSwitch()>0&&(s++,a===0&&(a=1)),a===1&&(s>1||C.getIntensity()!==1||!C.lightTypeIsHeadLight())&&(a=2),a<3&&C.getPositional()&&(a=3)}}let v=!1;const w=e.lastBoundBO.getReferenceByName("lastLightComplexity"),m=e.lastBoundBO.getReferenceByName("lastLightCount");return(w!==a||m!==s)&&(e.lastBoundBO.set({lastLightComplexity:a},!0),e.lastBoundBO.set({lastLightCount:s},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,i,o)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(s=>{s.callback(s.userData,n,i,o)})},t.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||ef("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&c>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||ef("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((l,f)=>{n.getProgram().isAttributeUsed(`${l}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${l}MC`,n.getCABO().getCustomData()[f].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[f].components,!1)||ef(`Error setting ${l}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||ef("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||ef("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),l=[],u=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,d=u?sr(e.tmpMat4,o.getMatrix()):o.getMatrix();u&&(Yt(d,d),rn(d,d,u),Yt(d,d));for(let h=0;h<c;h++){const g=[];e.renderable.getClippingPlaneInDataCoords(d,h,g);for(let p=0;p<4;p++)l.push(g[p])}n.getProgram().setUniformi("numClipPlanes",c),n.getProgram().setUniform4fv("clipPlanes",l)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const f=a[c].getTextureUnit(),u=`texture${f+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,f)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",c.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",c.factor)}n.setMapperShaderParameters(i,o,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,i,o)=>{const a=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(a<2)return;const s=n.getProgram();let c=0;const l=i.getLightsByReference();for(let d=0;d<l.length;++d){const h=l[d];if(h.getSwitch()>0){const p=h.getColorByReference(),v=h.getIntensity();e.lightColor[0]=p[0]*v,e.lightColor[1]=p[1]*v,e.lightColor[2]=p[2]*v;const w=h.getDirection(),m=i.getActiveCamera().getViewMatrix(),y=[...w];h.lightTypeIsSceneLight()&&(y[0]=m[0]*w[0]+m[1]*w[1]+m[2]*w[2],y[1]=m[4]*w[0]+m[5]*w[1]+m[6]*w[2],y[2]=m[8]*w[0]+m[9]*w[1]+m[10]*w[2],Hf(y)),e.lightDirection[0]=y[0],e.lightDirection[1]=y[1],e.lightDirection[2]=y[2],Hf(e.lightDirection),s.setUniform3fArray(`lightColor${c}`,e.lightColor),s.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(a<3)return;const u=i.getActiveCamera().getViewMatrix();Yt(u,u),c=0;for(let d=0;d<l.length;++d){const h=l[d];if(h.getSwitch()>0){const p=h.getTransformedPosition(),v=new Float64Array(3);Pt(v,p,u),s.setUniform3fArray(`lightAttenuation${c}`,h.getAttenuationValuesByReference()),s.setUniformi(`lightPositional${c}`,h.getPositional()),s.setUniformf(`lightExponent${c}`,h.getExponent()),s.setUniformf(`lightConeAngle${c}`,h.getConeAngle()),s.setUniform3fArray(`lightPositionVC${c}`,[v[0],v[1],v[2]]),c++}}};function r(n,i,o){return i.identity(o),n.reduce((a,s,c)=>c===0?s?i.copy(a,s):i.identity(a):s?i.multiply(a,a,s):a,o)}t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLCamera.getKeyMatrices(i),c=i.getActiveCamera(),l=e.openGLCamera.getKeyMatrixTime().getMTime(),f=a.getLastCameraMTime(),d=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,h=o.getIsIdentity(),g=h?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(o.getCoordinateSystem()===KJ.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();yt(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,rn(e.tmpMat4,e.tmpMat4,d),a.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else a.setUniformMatrix("MCPCMatrix",r([s.wcpc,g.mcwc,d],hp,e.tmpMat4));a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",r([s.wcvc,g.mcwc,d],hp,e.tmpMat4)),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",r([s.normalMatrix,g.normalMatrix],YK,e.tmpMat3)),f!==l&&(a.isUniformUsed("cameraParallel")&&a.setUniformi("cameraParallel",c.getParallelProjection()),a.setLastCameraMTime(l)),h||a.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram();let s=o.getProperty(),c=s.getOpacity(),l=e.drawingEdges?s.getEdgeColorByReference():s.getAmbientColorByReference(),f=e.drawingEdges?s.getEdgeColorByReference():s.getDiffuseColorByReference(),u=e.drawingEdges?1:s.getAmbient(),d=e.drawingEdges?0:s.getDiffuse(),h=e.drawingEdges?0:s.getSpecular();const g=s.getSpecularPower();a.setUniformf("opacityUniform",c),a.setUniform3fArray("ambientColorUniform",l),a.setUniform3fArray("diffuseColorUniform",f),a.setUniformf("ambient",u),a.setUniformf("diffuse",d);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let v=s.getSpecularColorByReference();if(a.setUniform3fArray("specularColorUniform",v),a.setUniformf("specularPowerUniform",g),a.setUniformf("specular",h),a.isUniformUsed("ambientIntensityBF")){if(s=o.getBackfaceProperty(),c=s.getOpacity(),l=s.getAmbientColor(),u=s.getAmbient(),f=s.getDiffuseColor(),d=s.getDiffuse(),v=s.getSpecularColor(),h=s.getSpecular(),a.setUniformf("ambientIntensityBF",u),a.setUniformf("diffuseIntensityBF",d),a.setUniformf("opacityUniformBF",c),a.setUniform3fArray("ambientColorUniformBF",l),a.setUniform3fArray("diffuseColorUniformBF",f),p<1)return;a.setUniformf("specularIntensityBF",h),a.setUniform3fArray("specularColorUniformBF",v),a.setUniformf("specularPowerUniformBF",g)}},t.updateMaximumPointCellIds=(n,i)=>{var s,c,l,f;const o=e._openGLRenderer.getSelector();if(!o)return;if((c=(s=e.selectionWebGLIdsToVTKIds)==null?void 0:s.points)!=null&&c.length){const u=e.selectionWebGLIdsToVTKIds.points.length;o.setMaximumPointId(u-1)}if((f=(l=e.selectionWebGLIdsToVTKIds)==null?void 0:l.cells)!=null&&f.length){const u=e.selectionWebGLIdsToVTKIds.cells.length;o.setMaximumCellId(u-1)}o.getFieldAssociation()===Mw.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,i)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const o=qJ(e._openGLRenderer);if(e.lastSelectionState!==o&&(e.selectionStateChanged.modified(),e.lastSelectionState=o),e._openGLRenderer.getSelector())switch(o){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(n,i),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=i.getProperty().getEdgeVisibility()&&o===p0.SURFACE,s=e._openGLRenderer.getSelector(),c=s&&s.getFieldAssociation()===Mw.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===co.ID_LOW24||e.lastSelectionState===co.ID_HIGH24);for(let l=ri.Start;l<ri.End;l++)e.primitives[l].setPointPicking(c),e.primitives[l].getCABO().getElementCount()&&(e.drawingEdges=a&&(l===ri.TrisEdges||l===ri.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[l],e.primitiveIDOffset+=e.primitives[l].drawArrays(n,i,o,t),e.vertexIDOffset+=e.primitives[l].getCABO().getElementCount()))},t.renderPieceFinish=(n,i)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,i)=>{if(t.invokeEvent(jJ),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(HJ),!e.currentInput){ef("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context,a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.computeBounds=(n,i)=>{if(!t.getInput()){Jd(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentInput.getMTime()},t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===Y1.USE_CELL_DATA||s===Y1.USE_CELL_FIELD_DATA||s===Y1.USE_FIELD_DATA||!o.getPointData().getScalars())&&s!==Y1.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);let c=i.getProperty().getInterpolation()!==x6.FLAT?o.getPointData().getNormals():null;c===null&&o.getCellData().getNormals()&&(e.haveCellNormals=!0,c=o.getCellData().getNormals());const l=i.getProperty().getRepresentation();let f=o.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(f=null);let u=!1;if(e.renderable.getColorCoordinates()){f=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=rr.newInstance({resizable:!0}));const h=e.internalColorTexture;h.setMinificationFilter(C6.NEAREST),h.setMagnificationFilter(C6.NEAREST),h.setWrapS(S6.CLAMP_TO_EDGE),h.setWrapT(S6.CLAMP_TO_EDGE),h.setOpenGLRenderWindow(e._openGLRenderWindow);const g=e.renderable.getColorTextureMap(),p=g.getExtent(),v=g.getPointData().getScalars();h.create2DFromRaw(p[1]-p[0]+1,p[3]-p[2]+1,v.getNumberOfComponents(),v.getDataType(),v.getData()),h.activate(),h.sendParameters(),h.deactivate()}const d=`${o.getMTime()}A${l}B${o.getMTime()}C${c?c.getMTime():1}D${a?a.getMTime():1}E${i.getProperty().getEdgeVisibility()}F${f?f.getMTime():1}`;if(e.VBOBuildString!==d){const g={points:o.getPoints(),normals:c,tcoords:f,colors:a,cellOffset:0,vertexOffset:0,useTCoordsPerCell:u,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(w=>o.getPointData().getArrayByName(w))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:o.getVerts()},{inRep:"lines",cells:o.getLines()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()},{inRep:"polys",cells:o.getPolys()},{inRep:"strips",cells:o.getStrips()}],v=i.getProperty().getEdgeVisibility()&&l===p0.SURFACE;for(let w=ri.Start;w<ri.End;w++)w!==ri.TrisEdges&&w!==ri.TriStripsEdges?(g.cellOffset+=e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,l,g,e.selectionWebGLIdsToVTKIds),g.vertexOffset+=e.primitives[w].getCABO().getElementCount()):v?e.primitives[w].getCABO().createVBO(p[w].cells,p[w].inRep,p0.WIREFRAME,{...g,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[w].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=d}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(i=>{n+=i.getAllocatedGPUMemoryInBytes()}),n}}const YJ={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:co.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function YR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YJ,r),Gn.extend(t,e,r),Hs.implementReplaceShaderCoincidentOffset(t,e,r),Hs.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=ri,e.tmpMat3=Ta(new Float64Array(9)),e.tmpMat4=yt(new Float64Array(16));for(let n=ri.Start;n<ri.End;n++)e.primitives[n]=Js.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Fr(t,e,["context"]),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Zn(e.selectionStateChanged,{mtime:0}),XJ(t,e)}const JR=Sn(YR,"vtkOpenGLPolyDataMapper");var t5={newInstance:JR,extend:YR};Hr("vtkMapper",JR);const{vtkErrorMacro:Lh}=Ni,{Representation:JJ}=Zd,{ObjectType:J1}=Mc,{PassTypes:ZJ}=GT,QJ={type:"StartEvent"},eZ={type:"EndEvent"};function tZ(t,e){e.classHierarchy.push("vtkOpenGLGlyph3DMapper");const r={...t};t.renderPiece=(n,i)=>{if(t.invokeEvent(QJ),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(1),t.invokeEvent(eZ),!e.currentInput){Lh("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const o=e.context;e._openGLRenderWindow.getWebgl2()?(e.hardwareSupport=!0,e.extension=null):e.extension||(e.extension=e.context.getExtension("ANGLE_instanced_arrays"),e.hardwareSupport=!!e.extension);const a=i.getProperty().getBackfaceCulling(),s=i.getProperty().getFrontfaceCulling();!a&&!s?e._openGLRenderWindow.disableCullFace():s?(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.FRONT)):(e._openGLRenderWindow.enableCullFace(),o.cullFace(o.BACK)),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.multiply4x4WithOffset=(n,i,o,a)=>{const s=i[0],c=i[1],l=i[2],f=i[3],u=i[4],d=i[5],h=i[6],g=i[7],p=i[8],v=i[9],w=i[10],m=i[11],y=i[12],x=i[13],C=i[14],S=i[15];let T=o[a],_=o[a+1],E=o[a+2],D=o[a+3];n[0]=T*s+_*u+E*p+D*y,n[1]=T*c+_*d+E*v+D*x,n[2]=T*l+_*h+E*w+D*C,n[3]=T*f+_*g+E*m+D*S,T=o[a+4],_=o[a+5],E=o[a+6],D=o[a+7],n[4]=T*s+_*u+E*p+D*y,n[5]=T*c+_*d+E*v+D*x,n[6]=T*l+_*h+E*w+D*C,n[7]=T*f+_*g+E*m+D*S,T=o[a+8],_=o[a+9],E=o[a+10],D=o[a+11],n[8]=T*s+_*u+E*p+D*y,n[9]=T*c+_*d+E*v+D*x,n[10]=T*l+_*h+E*w+D*C,n[11]=T*f+_*g+E*m+D*S,T=o[a+12],_=o[a+13],E=o[a+14],D=o[a+15],n[12]=T*s+_*u+E*p+D*y,n[13]=T*c+_*d+E*v+D*x,n[14]=T*l+_*h+E*w+D*C,n[15]=T*f+_*g+E*m+D*S},t.replaceShaderNormal=(n,i,o)=>{if(e.hardwareSupport&&e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let s=n.Vertex;e.lastBoundBO.getCABO().getNormalOffset()&&(s=Te.substitute(s,"//VTK::Normal::Dec",["attribute vec3 normalMC;","attribute mat3 gNormal;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * gNormal * normalMC;"]).result),n.Vertex=s}r.replaceShaderNormal(n,i,o)},t.replaceShaderColor=(n,i,o)=>{if(e.hardwareSupport&&e.renderable.getColorArray()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getReferenceByName("lastLightComplexity");let f=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity"];l&&(f=f.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let u=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];l&&(u=u.concat(["  vec3 specularColor;","  float specularPower;"])),u=u.concat(["  opacity = opacityUniform;"]),l&&(u=u.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.drawingEdges||(f=f.concat(["varying vec4 vertexColorVSOutput;"]),a=Te.substitute(a,"//VTK::Color::Dec",["attribute vec4 gColor;","varying vec4 vertexColorVSOutput;"]).result,a=Te.substitute(a,"//VTK::Color::Impl",["vertexColorVSOutput = gColor;"]).result,s=Te.substitute(s,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,s=Te.substitute(s,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,u=u.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])),c=Te.substitute(c,"//VTK::Color::Impl",u).result,c=Te.substitute(c,"//VTK::Color::Dec",f).result,n.Vertex=a,n.Geometry=s,n.Fragment=c}r.replaceShaderColor(n,i,o)},t.replaceShaderPositionVC=(n,i,o)=>{if(e.hardwareSupport){let a=n.Vertex;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(a=Te.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","vertexVCVSOutput = MCVCMatrix * gVertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result,a=Te.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result):(a=Te.substitute(a,"//VTK::Camera::Dec",["attribute mat4 gMatrix;","uniform mat4 MCPCMatrix;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["vec4 gVertexMC = gMatrix * vertexMC;","  gl_Position = MCPCMatrix * gVertexMC;"]).result),n.Vertex=a}r.replaceShaderPositionVC(n,i,o)},t.replaceShaderPicking=(n,i,o)=>{if(e.hardwareSupport){let a=n.Fragment,s=n.Vertex;s=Te.substitute(s,"//VTK::Picking::Dec",["attribute vec3 mapperIndexVS;","varying vec3 mapperIndexVSOutput;"]).result,s=Te.substitute(s,"//VTK::Picking::Impl","  mapperIndexVSOutput = mapperIndexVS;").result,n.Vertex=s,a=Te.substitute(a,"//VTK::Picking::Dec",["varying vec3 mapperIndexVSOutput;","uniform vec3 mapperIndex;","uniform int picking;"]).result,a=Te.substitute(a,"//VTK::Picking::Impl",["  vec4 pickColor = picking == 2 ? vec4(mapperIndexVSOutput,1.0) : vec4(mapperIndex,1.0);","  gl_FragData[0] = picking != 0 ? pickColor : gl_FragData[0];"]).result,n.Fragment=a}else r.replaceShaderPicking(n,i,o)},t.updateGlyphShaderParameters=(n,i,o,a,s,c,l,f)=>{const u=o.getProgram();if(n){const d=e.normalMatrix,h=c,g=l*9,p=e.tmpMat3,v=d[0],w=d[1],m=d[2],y=d[3],x=d[4],C=d[5],S=d[6],T=d[7],_=d[8],E=h[g],D=h[g+1],b=h[g+2],I=h[g+3],R=h[g+4],M=h[g+5],P=h[g+6],k=h[g+7],z=h[g+8];p[0]=E*v+D*y+b*S,p[1]=E*w+D*x+b*T,p[2]=E*m+D*C+b*_,p[3]=I*v+R*y+M*S,p[4]=I*w+R*x+M*T,p[5]=I*m+R*C+M*_,p[6]=P*v+k*y+z*S,p[7]=P*w+k*x+z*T,p[8]=P*m+k*C+z*_,u.setUniformMatrix3x3("normalMatrix",e.tmpMat3)}if(t.multiply4x4WithOffset(e.tmpMat4,e.mcpcMatrix,s,l*16),u.setUniformMatrix("MCPCMatrix",e.tmpMat4),i&&(t.multiply4x4WithOffset(e.tmpMat4,e.mcvcMatrix,s,l*16),u.setUniformMatrix("MCVCMatrix",e.tmpMat4)),a){const d=a.getData();e.tmpColor[0]=d[l*4]/255,e.tmpColor[1]=d[l*4+1]/255,e.tmpColor[2]=d[l*4+2]/255,u.setUniform3fArray("ambientColorUniform",e.tmpColor),u.setUniform3fArray("diffuseColorUniform",e.tmpColor)}f&&u.setUniform3fArray("mapperIndex",f.getPropColorValue())},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation(),a=e.context,s=i.getProperty().getEdgeVisibility()&&o===JJ.SURFACE,c=e.openGLCamera.getKeyMatrices(n),l=e.openGLActor.getKeyMatrices();Od(e.normalMatrix,c.normalMatrix,l.normalMatrix),rn(e.mcpcMatrix,c.wcpc,l.mcwc),rn(e.mcvcMatrix,c.wcvc,l.mcwc);const f=e.renderable.getMatrixArray(),u=e.renderable.getNormalArray(),d=e.renderable.getColorArray(),h=f.length/16;let g=!1;e._openGLRenderer.getSelector()&&e._openGLRenderer.getSelector().getCurrentPass()===ZJ.COMPOSITE_INDEX_PASS&&(g=!0);for(let p=e.primTypes.Start;p<e.primTypes.End;p++){const v=e.primitives[p].getCABO();if(v.getElementCount()){e.drawingEdges=s&&(p===e.primTypes.TrisEdges||p===e.primTypes.TriStripsEdges),e.lastBoundBO=e.primitives[p],e.primitives[p].updateShaders(n,i,t);const w=e.primitives[p].getProgram(),m=e.primitives[p].getOpenGLMode(o),y=w.isUniformUsed("normalMatrix"),x=w.isUniformUsed("MCVCMatrix");if(e.hardwareSupport)e.extension?e.extension.drawArraysInstancedANGLE(m,0,v.getElementCount(),h):a.drawArraysInstanced(m,0,v.getElementCount(),h);else for(let C=0;C<h;++C)g&&e._openGLRenderer.getSelector().renderCompositeIndex(C),t.updateGlyphShaderParameters(y,x,e.primitives[p],d,f,u,C,g?e._openGLRenderer.getSelector():null),a.drawArrays(m,0,v.getElementCount())}}},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.glyphBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){n.getProgram().isAttributeUsed("gMatrix")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.matrixBuffer,"gMatrix",0,64,e.context.FLOAT,4,!1,1)||Lh("Error setting gMatrix in shader VAO."):n.getVAO().removeAttributeArray("gMatrix"),n.getProgram().isAttributeUsed("gNormal")?n.getVAO().addAttributeMatrixWithDivisor(n.getProgram(),e.normalBuffer,"gNormal",0,36,e.context.FLOAT,3,!1,1)||Lh("Error setting gNormal in shader VAO."):n.getVAO().removeAttributeArray("gNormal"),n.getProgram().isAttributeUsed("gColor")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.colorBuffer,"gColor",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Lh("Error setting gColor in shader VAO."):n.getVAO().removeAttributeArray("gColor"),n.getProgram().isAttributeUsed("mapperIndexVS")?n.getVAO().addAttributeArrayWithDivisor(n.getProgram(),e.pickBuffer,"mapperIndexVS",0,4,e.context.UNSIGNED_BYTE,4,!0,1,!1)||Lh("Error setting mapperIndexVS in shader VAO."):n.getVAO().removeAttributeArray("mapperIndexVS"),r.setMapperShaderParameters(n,i,o),n.getAttributeUpdateTime().modified();return}r.setMapperShaderParameters(n,i,o)},t.getNeedToRebuildBufferObjects=(n,i)=>(e.renderable.buildArrays(),e.VBOBuildTime.getMTime()<e.renderable.getBuildTime().getMTime()?!0:r.getNeedToRebuildBufferObjects(n,i)),t.getNeedToRebuildShaders=(n,i,o)=>!!(r.getNeedToRebuildShaders(n,i,o)||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()),t.buildBufferObjects=(n,i)=>{if(e.hardwareSupport){const o=e.renderable.getMatrixArray(),a=e.renderable.getNormalArray(),s=e.renderable.getColorArray();if(e.matrixBuffer||(e.matrixBuffer=Mc.newInstance(),e.matrixBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.normalBuffer=Mc.newInstance(),e.normalBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.colorBuffer=Mc.newInstance(),e.colorBuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.pickBuffer=Mc.newInstance(),e.pickBuffer.setOpenGLRenderWindow(e._openGLRenderWindow)),e.renderable.getBuildTime().getMTime()>e.glyphBOBuildTime.getMTime()){e.matrixBuffer.upload(o,J1.ARRAY_BUFFER),e.normalBuffer.upload(a,J1.ARRAY_BUFFER),s?e.colorBuffer.upload(s.getData(),J1.ARRAY_BUFFER):e.colorBuffer.releaseGraphicsResources();const c=o.length/16,l=new Uint8Array(4*c);for(let f=0;f<c;++f){let u=f+1;const d=f*4;l[d]=u%256,u-=l[d],u/=256,l[d+1]=u%256,u-=l[d+1],u/=256,l[d+2]=u%256,l[d+3]=255}e.pickBuffer.upload(l,J1.ARRAY_BUFFER),e.glyphBOBuildTime.modified()}}return r.buildBufferObjects(n,i)}}const nZ={normalMatrix:null,mcpcMatrix:null,mcwcMatrix:null};function ZR(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nZ,r),t5.extend(t,e,r),e.tmpMat3=Ta(new Float64Array(9)),e.normalMatrix=Ta(new Float64Array(9)),e.mcpcMatrix=yt(new Float64Array(16)),e.mcvcMatrix=yt(new Float64Array(16)),e.tmpColor=[],e.glyphBOBuildTime={},Zn(e.glyphBOBuildTime,{mtime:0}),tZ(t,e)}const QR=Sn(ZR,"vtkOpenGLGlyph3DMapper");var rZ={newInstance:QR,extend:ZR};Hr("vtkGlyph3DMapper",QR);const iZ={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var n5={SlicingMode:iZ};const Pf={NEAREST:0,LINEAR:1};var oZ={InterpolationType:Pf};function Ks(t,e,r){return t?`${t.getMTime()}-${e}-${r}`:"0"}function t_(t,e){return`${t.getMTime()}A${e.getMTime()}`}const{vtkErrorMacro:m0}=Ni,{SlicingMode:Ba}=n5;function aZ(t){const e=t.split(`
`),r=[];for(let n=0;n<e.length;++n){const i=e[n].trim();i.length>0&&r.push(i)}return r}function sZ(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function r(n){e.openGLTexture.releaseGraphicsResources(n),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const o=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(o.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()==gs.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.getShaderTemplate=(n,i,o)=>{n.Vertex=e_,n.Fragment=i1,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Te.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,a=Te.substitute(a,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,a=Te.substitute(a,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=o.getProperty().getIndependentComponents();let f=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let d=1;d<c;d++)f=f.concat([`uniform float cshift${d};`,`uniform float cscale${d};`,`uniform float pwfshift${d};`,`uniform float pwfscale${d};`]);switch(c){case 1:f=f.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:f=f.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:f=f.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:m0("Unsupported number of independent coordinates.")}}if(s=Te.substitute(s,"//VTK::TCoord::Dec",f).result,o.getProperty().getUseLabelOutline()===!0&&(s=Te.substitute(s,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;"]).result,s=Te.substitute(s,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,s=Te.substitute(s,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","#endif"]).result),l){const d=["r","g","b","a"];let h=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let g=0;g<c;g++)h=h.concat([`vec3 tcolor${g} = mix${g} * texture2D(colorTexture1, vec2(tvalue.${d[g]} * cscale${g} + cshift${g}, height${g})).rgb;`,`float compWeight${g} = mix${g} * texture2D(pwfTexture1, vec2(tvalue.${d[g]} * pwfscale${g} + pwfshift${g}, height${g})).r;`]);switch(c){case 1:h=h.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:h=h.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:m0("Unsupported number of independent coordinates.")}s=Te.substitute(s,"//VTK::TCoord::Impl",h).result}else switch(c){case 1:s=Te.substitute(s,"//VTK::TCoord::Impl",[...aZ(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, centerPosIS.xy).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 1.0, 1.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, neighborPosIS.xy).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:s=Te.substitute(s,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(nn("OpenGL has a limit of 6 clipping planes"),c=6),a=Te.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Te.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getNeedToRebuildShaders=(n,i,o)=>{var l;const a=e.openGLTexture.getComponents(),s=o.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=n.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.updateShaders=(n,i,o)=>{if(e.lastBoundBO=n,t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||m0("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),e.context.FALSE)||m0("Error setting tcoordMC in shader VAO.")),n.getAttributeUpdateTime().modified());const a=e.openGLTexture.getTextureUnit();n.getProgram().setUniformi("texture1",a);const s=e.openGLTexture.getComponents(),c=o.getProperty().getIndependentComponents();if(c)for(let g=0;g<s;g++)n.getProgram().setUniformf(`mix${g}`,o.getProperty().getComponentWeight(g));const l=e.openGLTexture.getShiftAndScale();for(let g=0;g<s;g++){let p=o.getProperty().getColorWindow(),v=o.getProperty().getColorLevel();const w=c?g:0,m=o.getProperty().getRGBTransferFunction(w);if(m&&o.getProperty().getUseLookupTableScalarRange()){const C=m.getRange();p=C[1]-C[0],v=.5*(C[1]+C[0])}const y=l.scale/p,x=(l.shift-v)/p+.5;n.getProgram().setUniformf(`cshift${g}`,x),n.getProgram().setUniformf(`cscale${g}`,y)}for(let g=0;g<s;g++){let p=1,v=0;const w=c?g:0,m=o.getProperty().getPiecewiseFunction(w);if(m){const y=m.getRange(),x=y[1]-y[0],C=.5*(y[0]+y[1]);p=l.scale/x,v=(l.shift-C)/x+.5}n.getProgram().setUniformf(`pwfshift${g}`,v),n.getProgram().setUniformf(`pwfscale${g}`,p)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const g=t.getCoincidentParameters(i,o);n.getProgram().setUniformf("coffset",g.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",g.factor)}const f=e.colorTexture.getTextureUnit();n.getProgram().setUniformi("colorTexture1",f);const u=e.pwfTexture.getTextureUnit();n.getProgram().setUniformi("pwfTexture1",u);const d=e.labelOutlineThicknessTexture.getTextureUnit();if(n.getProgram().setUniformi("labelOutlineTexture1",d),e.renderable.getNumberOfClippingPlanes()){let g=e.renderable.getNumberOfClippingPlanes();g>6&&(nn("OpenGL has a limit of 6 clipping planes"),g=6);const v=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,w=v?sr(e.imagematinv,o.getMatrix()):o.getMatrix();v&&(Yt(w,w),rn(w,w,v),Yt(w,w)),Yt(e.imagemat,e.currentInput.getIndexToWorld()),rn(e.imagematinv,w,e.imagemat);const m=[];for(let y=0;y<g;y++){const x=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,y,x);for(let C=0;C<4;C++)m.push(x[C])}n.getProgram().setUniformi("numClipPlanes",g),n.getProgram().setUniform4fv("clipPlanes",m)}if(o.getProperty().getUseLabelOutline()===!0){const g=o.getProperty().getLabelOutlineOpacity();n.getProgram().setUniformf("outlineOpacity",g)}},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();rn(e.imagemat,s.mcwc,l);const f=e.openGLCamera.getKeyMatrices(i);if(rn(e.imagemat,f.wcpc,e.imagemat),n.getCABO().getCoordShiftAndScaleEnabled()){const d=n.getCABO().getInverseShiftAndScaleMatrix();rn(e.imagemat,e.imagemat,d)}if(a.setUniformMatrix("MCPCMatrix",e.imagemat),o.getProperty().getUseLabelOutline()===!0){const d=c.getWorldToIndex(),h=c.getDimensions();a.setUniform3i("imageDimensions",h[0],h[1],1),a.setUniformMatrix("vWCtoIDX",d);const g=e.openGLCamera.getKeyMatrices(i);Or(e.projectionToWorld,g.wcpc),e.openGLCamera.getKeyMatrices(i),a.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const p=t.getRenderTargetSize();a.setUniformf("vpWidth",p[0]),a.setUniformf("vpHeight",p[1]);const v=t.getRenderTargetOffset();a.setUniformf("vpOffsetX",v[0]/p[0]),a.setUniformf("vpOffsetY",v[1]/p[1])}},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),c=o.getProperty().getOpacity();a.setUniformf("opacity",c)},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i),e.lastBoundBO=null},t.renderPieceDraw=(n,i)=>{const o=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.renderPiece=(n,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){m0("No input!");return}t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i)},t.computeBounds=(n,i)=>{if(!t.getInput()){Jd(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i)},t.getNeedToRebuildBufferObjects=(n,i)=>{var o,a,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((o=e.openGLTexture)!=null&&o.getHandle())||!((a=e.colorTexture)!=null&&a.getHandle())||!((s=e.labelOutlineThicknessTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(n,i)=>{var I,R,M,P;const o=e.currentInput;if(!o)return;const a=o.getPointData()&&o.getPointData().getScalars();if(!a)return;const s=a.getDataType(),c=a.getNumberOfComponents(),l=i.getProperty(),f=l.getInterpolationType(),u=l.getIndependentComponents(),d=u?c:1,h=u?2*d:1,g=l.getRGBTransferFunction(),p=Ks(g,u,d),v=e._openGLRenderWindow.getGraphicsResourceForObject(g);if(!((I=v==null?void 0:v.oglObject)!=null&&I.getHandle())||(v==null?void 0:v.hash)!==p){e.colorTexture=rr.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const k=1024,z=k*h*3,A=new Uint8ClampedArray(z);if(f===Pf.NEAREST?(e.colorTexture.setMinificationFilter(_t.NEAREST),e.colorTexture.setMagnificationFilter(_t.NEAREST)):(e.colorTexture.setMinificationFilter(_t.LINEAR),e.colorTexture.setMagnificationFilter(_t.LINEAR)),g){const L=new Float32Array(k*3);for(let N=0;N<d;N++){const H=l.getRGBTransferFunction(N),ee=H.getRange();if(H.getTable(ee[0],ee[1],k,L,1),u)for(let oe=0;oe<k*3;oe++)A[N*k*6+oe]=255*L[oe],A[N*k*6+oe+k*3]=255*L[oe];else for(let oe=0;oe<k*3;oe++)A[N*k*6+oe]=255*L[oe]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(k,h,3,Ht.UNSIGNED_CHAR,A)}else{for(let L=0;L<k*3;++L)A[L]=255*L/((k-1)*3),A[L+1]=255*L/((k-1)*3),A[L+2]=255*L/((k-1)*3);e.colorTexture.create2DFromRaw(k,1,3,Ht.UNSIGNED_CHAR,A)}g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.colorTexture,p),g!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=g)}else e.colorTexture=v.oglObject;const m=l.getPiecewiseFunction(),y=Ks(m,u,d),x=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((R=x==null?void 0:x.oglObject)!=null&&R.getHandle())||(x==null?void 0:x.hash)!==y){const z=1024*h,A=new Uint8ClampedArray(z);if(e.pwfTexture=rr.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),f===Pf.NEAREST?(e.pwfTexture.setMinificationFilter(_t.NEAREST),e.pwfTexture.setMagnificationFilter(_t.NEAREST)):(e.pwfTexture.setMinificationFilter(_t.LINEAR),e.pwfTexture.setMagnificationFilter(_t.LINEAR)),m){const L=new Float32Array(z),N=new Float32Array(1024);for(let H=0;H<d;++H){const ee=l.getPiecewiseFunction(H);if(ee===null)L.fill(1);else{const oe=ee.getRange();if(ee.getTable(oe[0],oe[1],1024,N,1),u)for(let de=0;de<1024;de++)L[H*1024*2+de]=N[de],L[H*1024*2+de+1024]=N[de];else for(let de=0;de<1024;de++)L[H*1024*2+de]=N[de]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,h,1,Ht.FLOAT,L)}else A.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,Ht.UNSIGNED_CHAR,A);m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.pwfTexture,y),m!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=m)}else e.pwfTexture=x.oglObject;t.updatelabelOutlineThicknessTexture(i);const{ijkMode:S}=e.renderable.getClosestIJKAxis();let T=e.renderable.getSlice();S!==e.renderable.getSlicingMode()&&(T=e.renderable.getSliceAtPosition(T));const _=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(T),E=o.getExtent();let D;S===Ba.I&&(D=_-E[0]),S===Ba.J&&(D=_-E[2]),(S===Ba.K||S===Ba.NONE)&&(D=_-E[4]);const b=`${T}A${o.getMTime()}A${a.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==b){const k=o.getDimensions();e.openGLTexture||(e.openGLTexture=rr.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),f===Pf.NEAREST?(new Set([1,3,4]).has(c)&&s===Ht.UNSIGNED_CHAR&&!u&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(_t.NEAREST),e.openGLTexture.setMagnificationFilter(_t.NEAREST)):(c===4&&s===Ht.UNSIGNED_CHAR&&!u?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(_t.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(_t.LINEAR),e.openGLTexture.setMagnificationFilter(_t.LINEAR)),e.openGLTexture.setWrapS(dp.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(dp.CLAMP_TO_EDGE);const z=k[0]*k[1]*c,A=new Float32Array(12),L=new Float32Array(8);for(let _e=0;_e<4;_e++)L[_e*2]=_e%2?1:0,L[_e*2+1]=_e>1?1:0;const N=[Ba.X,Ba.Y,Ba.Z].includes(e.renderable.getSlicingMode())?T:_,H=o.getSpatialExtent(),ee=a.getData();let oe=null;if(S===Ba.I){oe=new ee.constructor(k[2]*k[1]*c);let _e=0;for(let Ce=0;Ce<k[2];Ce++)for(let F=0;F<k[1];F++){let O=(D+F*k[0]+Ce*k[0]*k[1])*c;_e=(Ce*k[1]+F)*c;const $=O+c;for(;O<$;)oe[_e++]=ee[O++]}k[0]=k[1],k[1]=k[2],A[0]=N,A[1]=H[2],A[2]=H[4],A[3]=N,A[4]=H[3],A[5]=H[4],A[6]=N,A[7]=H[2],A[8]=H[5],A[9]=N,A[10]=H[3],A[11]=H[5]}else if(S===Ba.J){oe=new ee.constructor(k[2]*k[0]*c);let _e=0;for(let Ce=0;Ce<k[2];Ce++)for(let F=0;F<k[0];F++){let O=(F+D*k[0]+Ce*k[0]*k[1])*c;_e=(Ce*k[0]+F)*c;const $=O+c;for(;O<$;)oe[_e++]=ee[O++]}k[1]=k[2],A[0]=H[0],A[1]=N,A[2]=H[4],A[3]=H[1],A[4]=N,A[5]=H[4],A[6]=H[0],A[7]=N,A[8]=H[5],A[9]=H[1],A[10]=N,A[11]=H[5]}else S===Ba.K||S===Ba.NONE?(oe=ee.subarray(D*z,(D+1)*z),A[0]=H[0],A[1]=H[2],A[2]=N,A[3]=H[1],A[4]=H[2],A[5]=N,A[6]=H[0],A[7]=H[3],A[8]=N,A[9]=H[1],A[10]=H[3],A[11]=N):m0("Reformat slicing not yet supported.");e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(k[0],k[1],c,a.getDataType(),oe,(P=(M=e.renderable).getPreferSizeOverAccuracy)==null?void 0:P.call(M)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const de=Lt.newInstance({numberOfComponents:3,values:A});de.setName("points");const ue=Lt.newInstance({numberOfComponents:2,values:L});ue.setName("tcoords");const me=new Uint16Array(8);me[0]=3,me[1]=0,me[2]=1,me[3]=3,me[4]=3,me[5]=0,me[6]=3,me[7]=2;const Ee=Lt.newInstance({numberOfComponents:1,values:me});e.tris.getCABO().createVBO(Ee,"polys",Mi.SURFACE,{points:de,tcoords:ue,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=b}},t.updatelabelOutlineThicknessTexture=n=>{var c;const i=n.getProperty().getLabelOutlineThickness(),o=e._openGLRenderWindow.getGraphicsResourceForObject(i),a=`${i.join("-")}`;if(!((c=o==null?void 0:o.oglObject)!=null&&c.getHandle())||(o==null?void 0:o.hash)!==a){const d=new Uint8Array(1024);for(let h=0;h<1024;++h){const g=typeof i[h]<"u"?i[h]:i[0];d[h]=g}e.labelOutlineThicknessTexture=rr.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(_t.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(_t.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,Ht.UNSIGNED_CHAR,d),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,a),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=o.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:n,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:n,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[n,i]},t.delete=Zp(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const cZ={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function eP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cZ,r),Gn.extend(t,e,r),Hs.implementReplaceShaderCoincidentOffset(t,e,r),Hs.implementBuildShadersWithReplacements(t,e,r),e.tris=Js.newInstance(),e.imagemat=yt(new Float64Array(16)),e.imagematinv=yt(new Float64Array(16)),e.projectionToWorld=yt(new Float64Array(16)),e.idxToView=yt(new Float64Array(16)),e.idxNormalMatrix=Ta(new Float64Array(9)),e.modelToView=yt(new Float64Array(16)),e.projectionToView=yt(new Float64Array(16)),Fr(t,e,[]),e.VBOBuildTime={},Zn(e.VBOBuildTime),sZ(t,e)}const tP=Sn(eP,"vtkOpenGLImageMapper");var lZ={newInstance:tP,extend:eP};Hr("vtkAbstractImageMapper",tP);const tf={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:Z1}=K;function uZ(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function r(n){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>n.unregisterGraphicsResourceUser(i,t))}t.buildPass=n=>{if(n){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&r(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(n,i)=>{n&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(n,i)=>e.renderable.getResolveCoincidentTopology()===gs.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const n=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,n)},t.renderPiece=(n,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i))},t.renderPieceStart=(n,i)=>{t.updateBufferObjects(n,i)},t.renderPieceDraw=(n,i)=>{const o=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,n,i),o.drawArrays(o.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(n,i)=>{},t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i),i.getProperty().getInterpolationType()===Pf.NEAREST?(e.volumeTexture.setMinificationFilter(_t.NEAREST),e.volumeTexture.setMagnificationFilter(_t.NEAREST),e.colorTexture.setMinificationFilter(_t.NEAREST),e.colorTexture.setMagnificationFilter(_t.NEAREST),e.pwfTexture.setMinificationFilter(_t.NEAREST),e.pwfTexture.setMagnificationFilter(_t.NEAREST)):(e.volumeTexture.setMinificationFilter(_t.LINEAR),e.volumeTexture.setMagnificationFilter(_t.LINEAR),e.colorTexture.setMinificationFilter(_t.LINEAR),e.colorTexture.setMagnificationFilter(_t.LINEAR),e.pwfTexture.setMinificationFilter(_t.LINEAR),e.pwfTexture.setMagnificationFilter(_t.LINEAR))},t.getNeedToRebuildBufferObjects=(n,i)=>{var a;const o=e.VBOBuildTime.getMTime();return o<t.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentImageDataInput.getMTime()||o<e.currentCenterlineInput.getMTime()||!((a=e.volumeTexture)!=null&&a.getHandle())},t.buildBufferObjects=(n,i)=>{var _,E,D,b;const o=e.currentImageDataInput,a=e.currentCenterlineInput,s=(_=o==null?void 0:o.getPointData())==null?void 0:_.getScalars();if(!s)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(s),l=t_(o,s);if(!((E=c==null?void 0:c.oglObject)!=null&&E.getHandle())||(c==null?void 0:c.hash)!==l){e.volumeTexture=rr.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const I=o.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(I[0],I[1],I[2],s,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.volumeTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.volumeTexture=c.oglObject;const u=s.getNumberOfComponents(),d=i.getProperty(),h=d.getIndependentComponents(),g=h?u:1,p=h?2*g:1,v=d.getRGBTransferFunction(),w=Ks(v,h,g),m=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!((D=m==null?void 0:m.oglObject)!=null&&D.getHandle())||(m==null?void 0:m.hash)!==w){const R=1024*p*3,M=new Uint8ClampedArray(R);if(e.colorTexture=rr.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),v){const P=new Float32Array(3072);for(let k=0;k<g;k++){const z=d.getRGBTransferFunction(k),A=z.getRange();if(z.getTable(A[0],A[1],1024,P,1),h)for(let L=0;L<1024*3;L++)M[k*1024*6+L]=255*P[L],M[k*1024*6+L+1024*3]=255*P[L];else for(let L=0;L<1024*3;L++)M[k*1024*6+L]=255*P[L]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,Ht.UNSIGNED_CHAR,M)}else{for(let P=0;P<1024*3;++P)M[P]=255*P/(1023*3),M[P+1]=255*P/(1023*3),M[P+2]=255*P/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,Ht.UNSIGNED_CHAR,M)}v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.colorTexture,w),v!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=v)}else e.colorTexture=m.oglObject;const x=d.getPiecewiseFunction(),C=Ks(x,h,g),S=e._openGLRenderWindow.getGraphicsResourceForObject(x);if(!((b=S==null?void 0:S.oglObject)!=null&&b.getHandle())||(S==null?void 0:S.hash)!==C){const R=1024*p,M=new Uint8ClampedArray(R);if(e.pwfTexture=rr.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),x){const P=new Float32Array(R),k=new Float32Array(1024);for(let z=0;z<g;++z){const A=d.getPiecewiseFunction(z);if(A===null)P.fill(1);else{const L=A.getRange();if(A.getTable(L[0],L[1],1024,k,1),h)for(let N=0;N<1024;N++)P[z*1024*2+N]=k[N],P[z*1024*2+N+1024]=k[N];else for(let N=0;N<1024;N++)P[z*1024*2+N]=k[N]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,Ht.FLOAT,P)}else M.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,Ht.UNSIGNED_CHAR,M);x&&(e._openGLRenderWindow.setGraphicsResourceForObject(x,e.pwfTexture,C),x!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(x,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=x)}else e.pwfTexture=S.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()){const I=a.getNumberOfPoints(),R=I<=1?0:I-1,M=a.getDistancesToFirstPoint(),P=e.renderable.getHeight(),k=4*R,z=new Float32Array(3*k),A=e.renderable.getWidth();for(let F=0,O=0;F<R;++F)z.set([0,P-M[F],0],O),O+=3,z.set([A,P-M[F],0],O),O+=3,z.set([A,P-M[F+1],0],O),O+=3,z.set([0,P-M[F+1],0],O),O+=3;const L=Lt.newInstance({numberOfComponents:3,values:z});L.setName("points");const N=new Uint16Array(5*R);for(let F=0,O=0,$=0;F<R;++F)N.set([4,$+3,$+2,$+1,$],O),O+=5,$+=4;const H=Lt.newInstance({numberOfComponents:1,values:N}),ee=a.getPoints(),oe=new Float32Array(3*k),de=new Array(3),ue=new Array(3);for(let F=0,O=0;F<R;++F)ee.getPoint(F,de),ee.getPoint(F+1,ue),oe.set(de,O),O+=3,oe.set(de,O),O+=3,oe.set(ue,O),O+=3,oe.set(ue,O),O+=3;const me=Lt.newInstance({numberOfComponents:3,values:oe,name:"centerlinePosition"}),Ee=new Float32Array(k);for(let F=0,O=0;F<R;++F)Ee.set([0,1,3,2],O),O+=4;const _e=Lt.newInstance({numberOfComponents:1,values:Ee,name:"quadIndex"}),Ce=[me,_e];if(!e.renderable.getUseUniformOrientation()){const F=e.renderable.getOrientedCenterline().getOrientations()??[],O=new Float32Array(4*k),$=new Float32Array(4*k);for(let Z=0;Z<R;++Z){const ne=F[Z],xe=F[Z+1];for(let Ie=0;Ie<4;++Ie){const je=4*(Ie+4*Z);O.set(ne,je),$.set(xe,je)}}const W=Lt.newInstance({numberOfComponents:4,values:O,name:"centerlineTopOrientation"}),X=Lt.newInstance({numberOfComponents:4,values:$,name:"centerlineBotOrientation"});Ce.push(W,X)}e.tris.getCABO().createVBO(H,"polys",Mi.SURFACE,{points:L,customAttributes:Ce}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(n,i,o)=>{const a=e.volumeTexture.getComponents(),s=o.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),f=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return n.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==f||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==a||e.lastIndependentComponents!==s?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=f,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=a,e.lastIndependentComponents=s,!0):!1},t.buildShaders=(n,i,o)=>{t.getShaderTemplate(n,i,o),t.replaceShaderValues(n,i,o)},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];a=Te.substitute(a,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,a=Te.substitute(a,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],f=e.renderable.isProjectionEnabled(),u=e.renderable.getUseUniformOrientation();u?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),f&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),a=Te.substitute(a,"//VTK::Color::Dec",l).result;const d=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];u?(d.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),f&&d.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):d.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),a=Te.substitute(a,"//VTK::Color::Impl",d).result;const h=e.volumeTexture.getComponents(),g=o.getProperty().getIndependentComponents();let p=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];f&&p.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),u?(p.push("in vec3 samplingDirVSOutput;"),f&&p.push("in vec3 projectionDirVSOutput;")):(p.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),f&&p.push("uniform vec3 bitangentDirection;"));const v=e.renderable.getCenterPoint();if(v&&p.push("uniform vec3 globalCenterPoint;"),g){for(let m=1;m<h;m++)p=p.concat([`uniform float cshift${m};`,`uniform float cscale${m};`,`uniform float pwfshift${m};`,`uniform float pwfscale${m};`]);switch(h){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:Z1("Unsupported number of independent coordinates.")}}s=Te.substitute(s,"//VTK::TCoord::Dec",p).result;let w=[];if(u?(w.push("vec3 samplingDirection = samplingDirVSOutput;"),f&&w.push("vec3 projectionDirection = projectionDirVSOutput;")):(w.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),f&&w.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),v?w.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):w.push("float horizontalOffset = quadOffsetVSOutput.x;"),w.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),f){const m=e.renderable.getProjectionMode();switch(m){case tf.MIN:w.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case tf.MAX:case tf.AVERAGE:default:w.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(w.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),m){case tf.MAX:w.push("  tvalue = max(tvalue, sampledTextureValue);");break;case tf.MIN:w.push("  tvalue = min(tvalue, sampledTextureValue);");break;case tf.AVERAGE:default:w.push("  tvalue = tvalue + sampledTextureValue;");break}w.push("}"),m===tf.AVERAGE&&w.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else w.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(g){const m=["r","g","b","a"];for(let y=0;y<h;++y)w=w.concat([`vec3 tcolor${y} = mix${y} * texture2D(colorTexture1, vec2(tvalue.${m[y]} * cscale${y} + cshift${y}, height${y})).rgb;`,`float compWeight${y} = mix${y} * texture2D(pwfTexture1, vec2(tvalue.${m[y]} * pwfscale${y} + pwfshift${y}, height${y})).r;`]);switch(h){case 1:w=w.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:w=w.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:w=w.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:Z1("Unsupported number of independent coordinates.")}}else switch(h){case 1:w=w.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:w=w.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:w=w.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}s=Te.substitute(s,"//VTK::TCoord::Impl",w).result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,t.replaceShaderClip(n,i,o),t.replaceShaderCoincidentOffset(n,i,o)},t.replaceShaderClip=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(K.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),a=Te.substitute(a,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,a=Te.substitute(a,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,s=Te.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,s=Te.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=a,n.Fragment=s},t.getShaderTemplate=(n,i,o)=>{n.Vertex=e_,n.Fragment=i1,n.Geometry=""},t.setMapperShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=n.getCABO();s.getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(a.isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(a,s,"vertexMC",s.getVertexOffset(),s.getStride(),e.context.FLOAT,3,e.context.FALSE)||Z1("Error setting vertexMC in shader VAO.")),n.getCABO().getCustomData().forEach(h=>{h&&a.isAttributeUsed(h.name)&&!n.getVAO().addAttributeArray(a,s,h.name,h.offset,s.getStride(),e.context.FLOAT,h.components,e.context.FALSE)&&Z1(`Error setting ${h.name} in shader VAO.`)}),n.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(a.setUniformi("volumeTexture",c),a.setUniformf("width",e.renderable.getWidth()),n.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),a.isUniformUsed("tangentDirection")){const h=e.renderable.getTangentDirection();n.getProgram().setUniform3fArray("tangentDirection",h)}if(a.isUniformUsed("bitangentDirection")){const h=e.renderable.getBitangentDirection();n.getProgram().setUniform3fArray("bitangentDirection",h)}if(a.isUniformUsed("centerlineOrientation")){const h=e.renderable.getUniformOrientation();n.getProgram().setUniform4fv("centerlineOrientation",h)}if(a.isUniformUsed("globalCenterPoint")){const h=e.renderable.getCenterPoint();a.setUniform3fArray("globalCenterPoint",h)}if(e.renderable.isProjectionEnabled()){const h=e.currentImageDataInput,g=h.getSpacing(),p=h.getDimensions(),v=e.renderable.getProjectionSlabThickness(),w=e.renderable.getProjectionSlabNumberOfSamples(),m=bM([],g,p);a.setUniform3fArray("volumeSizeMC",m),a.setUniformi("projectionSlabNumberOfSamples",w);const y=-.5*v;a.setUniformf("projectionConstantOffset",y);const x=v/(w-1);a.setUniformf("projectionStepLength",x)}const l=e.currentImageDataInput,f=l.getWorldToIndex(),u=LT(new Float32Array(16),DM([],l.getDimensions())),d=pv(u,u,f);if(a.setUniformMatrix("MCTCMatrix",d),e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(K.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),h=6);const p=s.getCoordShiftAndScaleEnabled()?s.getInverseShiftAndScaleMatrix():null,v=p?sr(e.imagematinv,o.getMatrix()):o.getMatrix();p&&(Yt(v,v),rn(v,v,p),Yt(v,v)),Yt(e.imagemat,e.currentImageDataInput.getIndexToWorld()),rn(e.imagematinv,v,e.imagemat);const w=[];for(let m=0;m<h;m++){const y=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,m,y);for(let x=0;x<4;x++)w.push(y[x])}a.setUniformi("numClipPlanes",h),a.setUniform4fv("clipPlanes",w)}if(a.isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,o);a.setUniformf("coffset",h.offset),a.isUniformUsed("cfactor")&&a.setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(n,i,o)=>{const a=e.openGLImageSlice.getKeyMatrices().mcwc,s=e.openGLCamera.getKeyMatrices(i).wcpc;if(rn(e.imagemat,s,a),n.getCABO().getCoordShiftAndScaleEnabled()){const c=n.getCABO().getInverseShiftAndScaleMatrix();rn(e.imagemat,e.imagemat,c)}n.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=o.getProperty(),c=s.getOpacity();a.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),f=s.getIndependentComponents();if(f)for(let g=0;g<l;++g)a.setUniformf(`mix${g}`,s.getComponentWeight(g));const u=e.volumeTexture.getVolumeInfo();for(let g=0;g<l;g++){let p=s.getColorWindow(),v=s.getColorLevel();const w=f?g:0,m=s.getRGBTransferFunction(w);if(m&&s.getUseLookupTableScalarRange()){const C=m.getRange();p=C[1]-C[0],v=.5*(C[1]+C[0])}const y=u.scale[g]/p,x=(u.offset[g]-v)/p+.5;a.setUniformf(`cshift${g}`,x),a.setUniformf(`cscale${g}`,y)}const d=e.colorTexture.getTextureUnit();a.setUniformi("colorTexture1",d);for(let g=0;g<l;g++){let p=1,v=0;const w=f?g:0,m=s.getPiecewiseFunction(w);if(m){const y=m.getRange(),x=y[1]-y[0],C=.5*(y[0]+y[1]);p=u.scale[g]/x,v=(u.offset[g]-C)/x+.5}a.setUniformf(`pwfshift${g}`,v),a.setUniformf(`pwfscale${g}`,p)}const h=e.pwfTexture.getTextureUnit();a.setUniformi("pwfTexture1",h)},t.updateShaders=(n,i,o)=>{if(t.getNeedToRebuildShaders(n,i,o)){const a={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(a,i,o);const s=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==n.getProgram()&&(n.setProgram(s),n.getVAO().releaseGraphicsResources()),n.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(n.getProgram());n.getVAO().bind(),t.setMapperShaderParameters(n,i,o),t.setCameraShaderParameters(n,i,o),t.setPropertyShaderParameters(n,i,o)},t.delete=K.chain(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const fZ={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function nP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fZ,r),Gn.extend(t,e,r),Hs.implementReplaceShaderCoincidentOffset(t,e,r),K.algo(t,e,2,0),e.tris=Js.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=yt(new Float64Array(16)),e.imagematinv=yt(new Float64Array(16)),e.VBOBuildTime={},K.obj(e.VBOBuildTime,{mtime:0}),uZ(t,e)}const rP=K.newInstance(nP,"vtkOpenGLImageCPRMapper"),dZ={};var hZ={newInstance:rP,extend:nP,...dZ};Hr("vtkImageCPRMapper",rP);function gZ(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{r&&e.context.depthMask(!0)},t.translucentPass=(r,n)=>{e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(sr(e.keyMatrices.mcwc,e.renderable.getMatrix()),Yt(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const pZ={context:null,keyMatrixTime:null,keyMatrices:null};function iP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pZ,r),Gn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:yt(new Float64Array(16))},Fr(t,e,["context"]),gZ(t,e)}const oP=Sn(iP,"vtkOpenGLImageSlice");var mZ={newInstance:oP,extend:iP};Hr("vtkImageSlice",oP);const{vtkDebugMacro:vZ}=Ni;function yZ(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),o=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,a=e._openGLRenderer.getTiledSizeAndOrigin();let s=null;if(e.renderable.getUseZValues()){const c=n.getZBufferTexture(),l=Math.floor(c.getWidth()),f=Math.floor(c.getHeight()),u=e._openGLRenderWindow.getContext();c.bind();const d=n.getFramebuffer();d?d.saveCurrentBindingsAndBuffers():vZ("No framebuffer to save/restore");const h=u.createFramebuffer();u.bindFramebuffer(u.FRAMEBUFFER,h),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,c.getHandle(),0),u.checkFramebufferStatus(u.FRAMEBUFFER)===u.FRAMEBUFFER_COMPLETE&&(s=new Uint8Array(l*f*4),u.viewport(0,0,l,f),u.readPixels(0,0,l,f,u.RGBA,u.UNSIGNED_BYTE,s)),d&&d.restorePreviousBindingsAndBuffers(),u.deleteFramebuffer(h)}e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}const wZ={};function aP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wZ,r),Gn.extend(t,e,r),yZ(t,e)}const sP=Sn(aP,"vtkOpenGLPixelSpaceCallbackMapper");var xZ={newInstance:sP,extend:aP};Hr("vtkPixelSpaceCallbackMapper",sP);const{vtkDebugMacro:CZ}=Ni;function SZ(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(CZ("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),n|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const o=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.colorMask(!0,!0,!0,!0),n&&i.clear(n),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],f=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,f);let d=Math.round(u[0])-s,h=Math.round(u[1])-c;return d<0&&(d=0),h<0&&(h=0),{usize:d,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.clear=()=>{let r=0;const n=e.context;if(!e.renderable.getTransparent()){const o=e.renderable.getBackgroundByReference();n.clearColor(o[0],o[1],o[2],o[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const TZ={context:null,_openGLRenderWindow:null,selector:null};function cP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TZ,r),Gn.extend(t,e,r),mo(t,e,["shaderCache"]),Fr(t,e,["selector"]),Jp(t,e,["openGLRenderWindow"]),SZ(t,e)}const lP=Sn(cP,"vtkOpenGLRenderer");var _Z={newInstance:lP,extend:cP};Hr("vtkRenderer",lP);const{vtkErrorMacro:T6}=Ni;function EZ(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const i=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",i);const o=e._openGLRenderer.getRenderable(),a=e.openGLCamera.getKeyMatrices(o),s=new Float64Array(16);if(Or(s,a.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",s),e.lastFormat==="box"){const c=o.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const n=new Float32Array(12);for(let s=0;s<4;s++)n[s*3]=s%2*2-1,n[s*3+1]=s>1?1:-1,n[s*3+2]=1;const i=Lt.newInstance({numberOfComponents:3,values:n});i.setName("points");const o=new Uint16Array(8);o[0]=3,o[1]=0,o[2]=1,o[3]=3,o[4]=3,o[5]=0,o[6]=3,o[7]=2;const a=Lt.newInstance({numberOfComponents:1,values:o});e.tris.getCABO().createVBO(a,"polys",Mi.SURFACE,{points:i,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||T6("Error setting vertexMC in shader VAO."));const r=e.renderable.getTextures();r.length||T6("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}const DZ={context:null};function uP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DZ,r),Gn.extend(t,e,r),e.openGLTexture=rr.newInstance(),e.tris=Js.newInstance(),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Ta(new Float64Array(9)),mcwc:yt(new Float64Array(16))},Fr(t,e,["context"]),mo(t,e,["activeTextures"]),EZ(t,e)}const fP=Sn(uP);var bZ={newInstance:fP,extend:uP};Hr("vtkSkybox",fP);var IZ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkSphereMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Spheres

attribute vec4 vertexMC;
attribute vec2 offsetMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying vec3 centerVCVSOutput;

uniform int cameraParallel;
uniform float scaleFactor;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  // compute the projected vertex position
  vec2 scaledOffsetMC = scaleFactor * offsetMC;
  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = length(scaledOffsetMC)*0.5;

  // make the triangle face the camera
  if (cameraParallel == 0)
    {
    vec3 dir = normalize(-vertexVCVSOutput.xyz);
    vec3 base2 = normalize(cross(dir,vec3(1.0,0.0,0.0)));
    vec3 base1 = cross(base2,dir);
    vertexVCVSOutput.xyz = vertexVCVSOutput.xyz + scaledOffsetMC.x*base1 + scaledOffsetMC.y*base2;
    }
  else
    {
    // add in the offset
    vertexVCVSOutput.xy = vertexVCVSOutput.xy + scaledOffsetMC;
    }

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:OZ}=Ni;function MZ(t,e){e.classHierarchy.push("vtkOpenGLSphereMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=IZ,n.Fragment=i1,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Te.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Impl",[`vec4 vertexVC = vertexVCVSOutput;
`]).result;const c=[`uniform float invertedDepth;
`,`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Te.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float b = 2.0*dot(EyePos,EyeDir);
`,`  float c = dot(EyePos,EyePos) - 1.0;
`,`  float d = b*b - 4.0*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t = (-b - invertedDepth*sqrt(d))*0.5;
`,`    normalVCVSOutput = invertedDepth*normalize(EyePos + t*EyeDir);
`,`    vertexVC.xyz = normalVCVSOutput*radiusVCVSOutput + centerVCVSOutput;
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{if(n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"offsetMC",12,n.getCABO().getStride(),e.context.FLOAT,2,!1)||OZ("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isUniformUsed("invertedDepth")&&n.getProgram().setUniformf("invertedDepth",e.invert?-1:1),n.getProgram().isUniformUsed("scaleFactor")){const s=e.currentInput.getPointData();e.renderable.getScaleArray()!=null&&s.hasArray(e.renderable.getScaleArray())?n.getProgram().setUniformf("scaleFactor",e.renderable.getScaleFactor()):n.getProgram().setUniformf("scaleFactor",1)}r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc),a.isUniformUsed("MCVCMatrix"))if(o.getIsIdentity())a.setUniformMatrix("MCVCMatrix",c.wcvc);else{const l=e.openGLActor.getKeyMatrices(),f=new Float64Array(16);rn(f,c.wcvc,l.mcwc),a.setUniformMatrix("MCVCMatrix",f)}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),f=l.getNumberOfPoints(),u=l.getData(),d=5;let h=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(h=c.getArray(e.renderable.getScaleArray()).getData());let g=null,p=0,v=null;a?(p=a.getNumberOfComponents(),s.setColorOffset(0),s.setColorBOStride(4),g=a.getData(),v=new Uint8Array(3*f*4),s.getColorBO()||s.setColorBO(Mc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow)):s.getColorBO()&&s.setColorBO(null),s.setColorComponents(p);const w=new Float32Array(d*f*3);s.setStride(d*4);const m=Math.cos(Tr(30));let y=0,x=0,C=0,S=0;for(let T=0;T<f;++T){let _=e.renderable.getRadius();h&&(_=h[T]),y=T*3,w[C++]=u[y++],w[C++]=u[y++],w[C++]=u[y++],w[C++]=-2*_*m,w[C++]=-_,g&&(x=T*p,v[S++]=g[x],v[S++]=g[x+1],v[S++]=g[x+2],v[S++]=g[x+3]),y=T*3,w[C++]=u[y++],w[C++]=u[y++],w[C++]=u[y++],w[C++]=2*_*m,w[C++]=-_,g&&(v[S++]=g[x],v[S++]=g[x+1],v[S++]=g[x+2],v[S++]=g[x+3]),y=T*3,w[C++]=u[y++],w[C++]=u[y++],w[C++]=u[y++],w[C++]=0,w[C++]=2*_,g&&(v[S++]=g[x],v[S++]=g[x+1],v[S++]=g[x+2],v[S++]=g[x+3])}s.setElementCount(C/d),s.upload(w,Ac.ARRAY_BUFFER),a&&s.getColorBO().upload(v,Ac.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const RZ={};function dP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RZ,r),t5.extend(t,e,r),MZ(t,e)}const hP=Sn(dP,"vtkOpenGLSphereMapper");var PZ={newInstance:hP,extend:dP};Hr("vtkSphereMapper",hP);var LZ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkStickMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// this shader implements imposters in OpenGL for Sticks

attribute vec4 vertexMC;
attribute vec3 orientMC;
attribute vec4 offsetMC;
attribute float radiusMC;

// optional normal declaration
//VTK::Normal::Dec

//VTK::Picking::Dec

// Texture coordinates
//VTK::TCoord::Dec

uniform mat3 normalMatrix; // transform model coordinate directions to view coordinates

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

varying vec4 vertexVCVSOutput;
varying float radiusVCVSOutput;
varying float lengthVCVSOutput;
varying vec3 centerVCVSOutput;
varying vec3 orientVCVSOutput;

uniform int cameraParallel;

void main()
{
  //VTK::Picking::Impl

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  vertexVCVSOutput = MCVCMatrix * vertexMC;
  centerVCVSOutput = vertexVCVSOutput.xyz;
  radiusVCVSOutput = radiusMC;
  lengthVCVSOutput = length(orientMC);
  orientVCVSOutput = normalMatrix * normalize(orientMC);

  // make sure it is pointing out of the screen
  if (orientVCVSOutput.z < 0.0)
    {
    orientVCVSOutput = -orientVCVSOutput;
    }

  // make the basis
  vec3 xbase;
  vec3 ybase;
  vec3 dir = vec3(0.0,0.0,1.0);
  if (cameraParallel == 0)
    {
    dir = normalize(-vertexVCVSOutput.xyz);
    }
  if (abs(dot(dir,orientVCVSOutput)) == 1.0)
    {
    xbase = normalize(cross(vec3(0.0,1.0,0.0),orientVCVSOutput));
    ybase = cross(xbase,orientVCVSOutput);
    }
  else
    {
    xbase = normalize(cross(orientVCVSOutput,dir));
    ybase = cross(orientVCVSOutput,xbase);
    }

  vec3 offsets = offsetMC.xyz*2.0-1.0;
  vertexVCVSOutput.xyz = vertexVCVSOutput.xyz +
    radiusVCVSOutput*offsets.x*xbase +
    radiusVCVSOutput*offsets.y*ybase +
    0.5*lengthVCVSOutput*offsets.z*orientVCVSOutput;

  gl_Position = VCPCMatrix * vertexVCVSOutput;
}
`;const{vtkErrorMacro:Q1}=Ni;function AZ(t,e){e.classHierarchy.push("vtkOpenGLStickMapper");const r={...t};t.getShaderTemplate=(n,i,o)=>{n.Vertex=LZ,n.Fragment=i1,n.Geometry=""},t.replaceShaderValues=(n,i,o)=>{let a=n.Vertex,s=n.Fragment;a=Te.substitute(a,"//VTK::Camera::Dec",[`uniform mat4 VCPCMatrix;
`,"uniform mat4 MCVCMatrix;"]).result,s=Te.substitute(s,"//VTK::PositionVC::Dec","varying vec4 vertexVCVSOutput;").result,s=Te.substitute(s,"//VTK::PositionVC::Impl",`  vec4 vertexVC = vertexVCVSOutput;
`).result;const c=[`uniform int cameraParallel;
`,`varying float radiusVCVSOutput;
`,`varying vec3 orientVCVSOutput;
`,`varying float lengthVCVSOutput;
`,`varying vec3 centerVCVSOutput;
`,`uniform mat4 VCPCMatrix;
`];s=Te.substitute(s,"//VTK::Normal::Dec",c).result;let l="";e.context.getExtension("EXT_frag_depth")&&(l=`  gl_FragDepthEXT = (pos.z / pos.w + 1.0) / 2.0;
`),e._openGLRenderWindow.getWebgl2()&&(l=`gl_FragDepth = (pos.z / pos.w + 1.0) / 2.0;
`),s=Te.substitute(s,"//VTK::Depth::Impl",[`  vec3 EyePos;
`,`  vec3 EyeDir;
`,`  if (cameraParallel != 0) {
`,`    EyePos = vec3(vertexVC.x, vertexVC.y, vertexVC.z + 3.0*radiusVCVSOutput);
`,`    EyeDir = vec3(0.0,0.0,-1.0); }
`,`  else {
`,`    EyeDir = vertexVC.xyz;
`,`    EyePos = vec3(0.0,0.0,0.0);
`,`    float lengthED = length(EyeDir);
`,`    EyeDir = normalize(EyeDir);
`,`    if (lengthED > radiusVCVSOutput*3.0) {
`,`      EyePos = vertexVC.xyz - EyeDir*3.0*radiusVCVSOutput; }
`,`    }
`,`  EyePos = EyePos - centerVCVSOutput;
`,`  vec3 base1;
`,`  if (abs(orientVCVSOutput.z) < 0.99) {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,0.0,1.0))); }
`,`  else {
`,`    base1 = normalize(cross(orientVCVSOutput,vec3(0.0,1.0,0.0))); }
`,`  vec3 base2 = cross(orientVCVSOutput,base1);
`,`  EyePos = vec3(dot(EyePos,base1),dot(EyePos,base2),dot(EyePos,orientVCVSOutput));
`,`  EyeDir = vec3(dot(EyeDir,base1),dot(EyeDir,base2),dot(EyeDir,orientVCVSOutput));
`,`  EyePos = EyePos/radiusVCVSOutput;
`,`  float a = EyeDir.x*EyeDir.x + EyeDir.y*EyeDir.y;
`,`  float b = 2.0*(EyePos.x*EyeDir.x + EyePos.y*EyeDir.y);
`,`  float c = EyePos.x*EyePos.x + EyePos.y*EyePos.y - 1.0;
`,`  float d = b*b - 4.0*a*c;
`,`  vec3 normalVCVSOutput = vec3(0.0,0.0,1.0);
`,`  if (d < 0.0) { discard; }
`,`  else {
`,`    float t =  (-b - sqrt(d))/(2.0*a);
`,`    float tz = EyePos.z + t*EyeDir.z;
`,`    vec3 iPoint = EyePos + t*EyeDir;
`,`    if (abs(iPoint.z)*radiusVCVSOutput > lengthVCVSOutput*0.5) {
`,`      float t2 = (-b + sqrt(d))/(2.0*a);
`,`      float tz2 = EyePos.z + t2*EyeDir.z;
`,`      if (tz2*radiusVCVSOutput > lengthVCVSOutput*0.5 || tz*radiusVCVSOutput < -0.5*lengthVCVSOutput) { discard; }
`,`      else {
`,`        normalVCVSOutput = orientVCVSOutput;
`,`        float t3 = (lengthVCVSOutput*0.5/radiusVCVSOutput - EyePos.z)/EyeDir.z;
`,`        iPoint = EyePos + t3*EyeDir;
`,`        vertexVC.xyz = radiusVCVSOutput*(iPoint.x*base1 + iPoint.y*base2 + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`        }
`,`      }
`,`    else {
`,`      normalVCVSOutput = iPoint.x*base1 + iPoint.y*base2;
`,`      vertexVC.xyz = radiusVCVSOutput*(normalVCVSOutput + iPoint.z*orientVCVSOutput) + centerVCVSOutput;
`,`      }
`,`    }
`,`  vec4 pos = VCPCMatrix * vertexVC;
`,l]).result,s=Te.substitute(s,"//VTK::Normal::Impl","").result,e.haveSeenDepthRequest&&(s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float computedZ = (pos.z / pos.w + 1.0) / 2.0;","float iz = floor(computedZ * 65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),n.Vertex=a,n.Fragment=s,r.replaceShaderValues(n,i,o)},t.setMapperShaderParameters=(n,i,o)=>{n.getCABO().getElementCount()&&(e.VBOBuildTime>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())&&(n.getProgram().isAttributeUsed("orientMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"orientMC",12,n.getCABO().getStride(),e.context.FLOAT,3,!1)||Q1("Error setting 'orientMC' in shader VAO.")),n.getProgram().isAttributeUsed("offsetMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"offsetMC",0,n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,3,!0)||Q1("Error setting 'offsetMC' in shader VAO.")),n.getProgram().isAttributeUsed("radiusMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"radiusMC",24,n.getCABO().getStride(),e.context.FLOAT,1,!1)||Q1("Error setting 'radiusMC' in shader VAO."))),r.setMapperShaderParameters(n,i,o)},t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),s=i.getActiveCamera(),c=e.openGLCamera.getKeyMatrices(i);if(a.isUniformUsed("VCPCMatrix")&&a.setUniformMatrix("VCPCMatrix",c.vcpc),o.getIsIdentity())a.isUniformUsed("MCVCMatrix")&&a.setUniformMatrix("MCVCMatrix",c.wcvc),a.isUniformUsed("normalMatrix")&&a.setUniformMatrix3x3("normalMatrix",c.normalMatrix);else{const l=e.openGLActor.getKeyMatrices();if(a.isUniformUsed("MCVCMatrix")){const f=new Float64Array(16);rn(f,c.wcvc,l.mcwc),a.setUniformMatrix("MCVCMatrix",f)}if(a.isUniformUsed("normalMatrix")){const f=new Float64Array(9);Od(f,c.normalMatrix,l.normalMatrix),a.setUniformMatrix3x3("normalMatrix",f)}}a.isUniformUsed("cameraParallel")&&n.getProgram().setUniformi("cameraParallel",s.getParallelProjection())},t.getOpenGLMode=(n,i)=>e.context.TRIANGLES,t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,1);const a=e.renderable.getColorMapColors(),s=e.primitives[e.primTypes.Tris].getCABO(),c=o.getPointData(),l=o.getPoints(),f=l.getNumberOfPoints(),u=l.getData();let d=3;d+=4;let h=null,g=0;s.setColorBOStride(4),s.getColorBO()||s.setColorBO(Mc.newInstance()),s.getColorBO().setOpenGLRenderWindow(e._openGLRenderWindow),a&&(g=a.getNumberOfComponents(),s.setColorOffset(4),h=a.getData(),s.setColorBOStride(8)),s.setColorComponents(g),s.setStride(d*4);const p=new Float32Array(d*f*12),v=new Uint8Array(12*f*(h?8:4));let w=null,m=null;e.renderable.getScaleArray()!=null&&c.hasArray(e.renderable.getScaleArray())&&(w=c.getArray(e.renderable.getScaleArray()).getData()),e.renderable.getOrientationArray()!=null&&c.hasArray(e.renderable.getOrientationArray())?m=c.getArray(e.renderable.getOrientationArray()).getData():Q1([`Error setting orientationArray.
`,"You have to specify the stick orientation"]);const y=[0,1,3,0,3,2,2,3,5,2,5,4];let x=0,C=0,S=0,T=0;for(let _=0;_<f;++_){let E=e.renderable.getLength(),D=e.renderable.getRadius();w&&(E=w[_*2],D=w[_*2+1]);for(let b=0;b<y.length;++b)x=_*3,p[S++]=u[x++],p[S++]=u[x++],p[S++]=u[x++],x=_*3,p[S++]=m[x++]*E,p[S++]=m[x++]*E,p[S++]=m[x++]*E,p[S++]=D,v[T++]=255*(y[b]%2),v[T++]=y[b]>=4?255:0,v[T++]=y[b]>=2?255:0,v[T++]=255,C=_*g,h&&(v[T++]=h[C],v[T++]=h[C+1],v[T++]=h[C+2],v[T++]=h[C+3])}s.setElementCount(S/d),s.upload(p,Ac.ARRAY_BUFFER),s.getColorBO().upload(v,Ac.ARRAY_BUFFER),e.VBOBuildTime.modified()}}const NZ={};function gP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NZ,r),t5.extend(t,e,r),AZ(t,e)}const pP=Sn(gP,"vtkOpenGLStickMapper");var kZ={newInstance:pP,extend:gP};Hr("vtkStickMapper",pP);function VZ(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=r=>{!e.renderable||!e.renderable.getVisibility()||r&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementVolumeCount()}},t.traverseVolumePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0].traverse(r),t.apply(r,!1))},t.volumePass=r=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!r)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),sr(e.MCWCMatrix,e.renderable.getMatrix()),Yt(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?Ta(e.normalMatrix):(jy(e.normalMatrix,e.MCWCMatrix),n1(e.normalMatrix,e.normalMatrix),IT(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const FZ={};function mP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FZ,r),Gn.extend(t,e,r),e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),Fr(t,e,["context"]),VZ(t,e)}const vP=Sn(mP,"vtkOpenGLVolume");var UZ={newInstance:vP,extend:mP};Hr("vtkVolume",vP);const fC={NEAREST:0,LINEAR:1,FAST_LINEAR:2},yP={FRACTIONAL:0,PROPORTIONAL:1},m2={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var wP={InterpolationType:fC,OpacityMode:yP,ColorMixPreset:m2},BZ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,GZ=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:WZ,vtkErrorMacro:Rw}=Ni;function zZ(t){switch(t){case m2.CUSTOM:return"//VTK::CustomColorMix";case m2.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case m2.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function $Z(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function r(i){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(o=>i.unregisterGraphicsResourceUser(o,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(i,o)=>{if(i){const a=o.getZBufferTexture();a!==e.zBufferTexture&&(e.zBufferTexture=a)}},t.opaqueZBufferPass=(i,o)=>t.zBufferPass(i,o),t.volumePass=(i,o)=>{if(i){const a=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&r(a),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const s=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,s)}},t.getShaderTemplate=(i,o,a)=>{i.Vertex=BZ,i.Fragment=GZ,i.Geometry=""},t.useIndependentComponents=i=>{var l,f;const o=i.getIndependentComponents(),a=e.currentInput,s=(f=(l=a==null?void 0:a.getPointData())==null?void 0:l.getScalars())==null?void 0:f.getNumberOfComponents(),c=i.getColorMixPreset();return o&&s>=2||!!c},t.replaceShaderValues=(i,o,a)=>{const s=a.getProperty();let c=i.Fragment;s.getInterpolationType()===fC.LINEAR&&(c=Te.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(a)===!0&&(c=Te.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===r2.LABELMAP_EDGE_PROJECTION_BLEND&&(c=Te.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const d=e.scalarTexture.getComponents();c=Te.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${d}`).result;const h=t.useIndependentComponents(s);h&&(c=Te.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const g=[],p=[];for(let T=0;T<d;T++)s.getOpacityMode(T)===yP.PROPORTIONAL&&g.push(`#define vtkComponent${T}Proportional`),s.getForceNearestInterpolation(T)&&p.push(`#define vtkComponent${T}ForceNearest`);c=Te.substitute(c,"//VTK::vtkProportionalComponents",g.join(`
`)).result,c=Te.substitute(c,"//VTK::vtkForceNearestComponents",p.join(`
`)).result;const v=s.getColorMixPreset(),w=zZ(v);w&&(c=Te.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=Te.substitute(c,"//VTK::CustomComponentsColorMix::Impl",w).result);const m=e.currentInput.getSpatialExtent(),y=e.currentInput.getSpacing(),x=new Float64Array(3);Dn(x,(m[1]-m[0])*y[0],(m[3]-m[2])*y[1],(m[5]-m[4])*y[2]);const C=fo(x)/t.getCurrentSampleDistance(o);c=Te.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(C)}`).result,c=Te.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=Te.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=Te.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&s.getAmbient()>0&&(c=Te.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const S=h?d:1;e.gopacity=!1;for(let T=0;!e.gopacity&&T<S;++T)e.gopacity||(e.gopacity=s.getUseGradientOpacity(T));e.gopacity&&(c=Te.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=Te.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=Te.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=Te.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=Te.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,i.Fragment=c,t.replaceShaderLight(i,o,a),t.replaceShaderClippingPlane(i,o,a)},t.replaceShaderLight=(i,o,a)=>{if(e.lightComplexity===0)return;let s=i.Fragment,c=0;o.getLights().forEach(l=>{l.getSwitch()&&(c+=1)}),s=Te.substitute(s,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(s=Te.substitute(s,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(s=Te.substitute(s,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0&&(s=Te.substitute(s,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),i.Fragment=s},t.replaceShaderClippingPlane=(i,o,a)=>{let s=i.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;s=Te.substitute(s,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,s=Te.substitute(s,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}i.Fragment=s};const n=(i,o)=>{let a=0;i.getProperty().getShade()&&e.renderable.getBlendMode()===r2.COMPOSITE_BLEND&&(a=0,e.numberOfLights=0,o.forEach(s=>{s.getSwitch()>0&&(e.numberOfLights++,a===0&&(a=1)),a===1&&(e.numberOfLights>1||s.getIntensity()!==1||!s.lightTypeIsHeadLight())&&(a=2),a<3&&s.getPositional()&&(a=3)})),a!==e.lightComplexity&&(e.lightComplexity=a,t.modified())};t.getNeedToRebuildShaders=(i,o,a)=>{var w;const s=a.getProperty();n(a,o.getLights());const c=e.scalarTexture.getComponents(),l=[],f=[];for(let m=0;m<c;m++)l.push(s.getOpacityMode(m)),f.push(s.getForceNearestInterpolation(m));const u=e.currentInput.getSpatialExtent(),d=e.currentInput.getSpacing(),h=new Float64Array(3);Dn(h,(u[1]-u[0])*d[0],(u[3]-u[2])*d[1],(u[5]-u[4])*d[2]);const g=fo(h)/t.getCurrentSampleDistance(o),p=!!e.zBufferTexture,v={iComps:s.getIndependentComponents(),colorMixPreset:s.getColorMixPreset(),interpolationType:s.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(a),numComp:c,maxSamples:g,useGradientOpacity:s.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:p,opacityModes:l,forceNearestInterps:f};return((w=i.getProgram())==null?void 0:w.getHandle())===0||i.getShaderSourceTime().getMTime()<t.getMTime()||i.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!YI(e.previousState,v)?(e.previousState=v,!0):!1},t.updateShaders=(i,o,a)=>{if(t.getNeedToRebuildShaders(i,o,a)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,o,a);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,o,a),t.setCameraShaderParameters(i,o,a),t.setPropertyShaderParameters(i,o,a),t.getClippingPlaneShaderParameters(i,o,a)},t.setMapperShaderParameters=(i,o,a)=>{var f;const s=i.getProgram();i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexDC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexDC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Rw("Error setting vertexDC in shader VAO.")),i.getAttributeUpdateTime().modified()),s.setUniformi("texture1",e.scalarTexture.getTextureUnit()),s.setUniformf("sampleDistance",t.getCurrentSampleDistance(o));const c=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange();if((f=c==null?void 0:c.dataComputedScale)!=null&&f.length){const u=[],d=[];for(let h=0;h<4;h++)u[h]=l[0]*c.dataComputedScale[h]+c.dataComputedOffset[h],d[h]=l[1]*c.dataComputedScale[h]+c.dataComputedOffset[h],u[h]=(u[h]-c.offset[h])/c.scale[h],d[h]=(d[h]-c.offset[h])/c.scale[h];s.setUniform4f("ipScalarRangeMin",u[0],u[1],u[2],u[3]),s.setUniform4f("ipScalarRangeMax",d[0],d[1],d[2],d[3])}if(e.zBufferTexture!==null){s.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const u=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();s.setUniformf("vpZWidth",u[0]),s.setUniformf("vpZHeight",u[1])}},t.setCameraShaderParameters=(i,o,a)=>{const s=e.openGLCamera.getKeyMatrices(o),c=e.openGLVolume.getKeyMatrices();rn(e.modelToView,s.wcvc,c.mcwc);const l=i.getProgram(),f=e.openGLCamera.getRenderable(),u=f.getClippingRange();l.setUniformf("camThick",u[1]-u[0]),l.setUniformf("camNear",u[0]),l.setUniformf("camFar",u[1]);const d=e.currentInput.getBounds(),h=e.currentInput.getDimensions(),g=new Float64Array(3),p=new Float64Array(3);let v=1,w=-1,m=1,y=-1;for(let k=0;k<8;++k){if(Dn(g,d[k%2],d[2+Math.floor(k/2)%2],d[4+Math.floor(k/4)]),Pt(g,g,e.modelToView),!f.getParallelProjection()){kn(p,g);const z=-u[0]/g[2];mr(g,p,z)}Pt(g,g,s.vcpc),v=Math.min(g[0],v),w=Math.max(g[0],w),m=Math.min(g[1],m),y=Math.max(g[1],y)}l.setUniformf("dcxmin",v),l.setUniformf("dcxmax",w),l.setUniformf("dcymin",m),l.setUniformf("dcymax",y),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",f.getParallelProjection());const x=e.currentInput.getSpatialExtent(),C=e.currentInput.getSpacing(),S=new Float64Array(3);Dn(S,(x[1]-x[0])*C[0],(x[3]-x[2])*C[1],(x[5]-x[4])*C[2]),l.setUniform3f("vSpacing",C[0],C[1],C[2]),Dn(g,x[0],x[2],x[4]),e.currentInput.indexToWorldVec3(g,g),Pt(g,g,e.modelToView),l.setUniform3f("vOriginVC",g[0],g[1],g[2]);const T=e.currentInput.getIndexToWorld();rn(e.idxToView,e.modelToView,T),Od(e.idxNormalMatrix,s.normalMatrix,c.normalMatrix),Od(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const _=fo(S)/t.getCurrentSampleDistance(o);_>e.renderable.getMaximumSamplesPerRay()&&WZ(`The number of steps required ${Math.ceil(_)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const E=new Float64Array(3);if(Dn(E,1,1,1),Tq(E,E,S),l.setUniform3f("vVCToIJK",E[0],E[1],E[2]),l.setUniform3i("volumeDimensions",h[0],h[1],h[2]),l.setUniform3f("volumeSpacings",C[0],C[1],C[2]),!e._openGLRenderWindow.getWebgl2()){const k=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",k.xreps),l.setUniformi("xstride",k.xstride),l.setUniformi("ystride",k.ystride)}const D=new Float64Array(3),b=new Float64Array(3);for(let k=0;k<6;++k){switch(k){case 1:Dn(D,-1,0,0),Dn(b,x[0],x[2],x[4]);break;case 2:Dn(D,0,1,0),Dn(b,x[1],x[3],x[5]);break;case 3:Dn(D,0,-1,0),Dn(b,x[0],x[2],x[4]);break;case 4:Dn(D,0,0,1),Dn(b,x[1],x[3],x[5]);break;case 5:Dn(D,0,0,-1),Dn(b,x[0],x[2],x[4]);break;case 0:default:Dn(D,1,0,0),Dn(b,x[1],x[3],x[5]);break}d2(D,D,e.idxNormalMatrix),Pt(b,b,e.idxToView);const z=-1*gt(b,D);l.setUniform3f(`vPlaneNormal${k}`,D[0],D[1],D[2]),l.setUniformf(`vPlaneDistance${k}`,z)}if(t.isLabelmapOutlineRequired(a)){const z=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",z);const A=o.getActiveCamera(),[L,N]=A.getClippingRange(),H=A.getDistance();A.setClippingRange(H,H+.1);const ee=e.openGLCamera.getKeyMatrices(o);Or(e.projectionToWorld,ee.wcpc),A.setClippingRange(L,N),e.openGLCamera.getKeyMatrices(o),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const oe=t.getRenderTargetSize();l.setUniformf("vpWidth",oe[0]),l.setUniformf("vpHeight",oe[1]);const de=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",de[0]/oe[0]),l.setUniformf("vpOffsetY",de[1]/oe[1])}if(Or(e.projectionToView,s.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let I=0;const R=[],M=[],P=[];if(o.getLights().forEach(k=>{if(k.getSwitch()>0){const A=k.getColor(),L=k.getIntensity();R[0+I*3]=A[0]*L,R[1+I*3]=A[1]*L,R[2+I*3]=A[2]*L;const N=k.getDirection();Dn(D,N[0],N[1],N[2]),d2(D,D,s.normalMatrix),kn(D,D),M[0+I*3]=D[0],M[1+I*3]=D[1],M[2+I*3]=D[2],P[0+I*3]=-.5*D[0],P[1+I*3]=-.5*D[1],P[2+I*3]=-.5*(D[2]-1),I++}}),l.setUniformi("twoSidedLighting",o.getTwoSidedLighting()),l.setUniformi("lightNum",I),l.setUniform3fv("lightColor",R),l.setUniform3fv("lightDirectionVC",M),l.setUniform3fv("lightHalfAngleVC",P),e.lightComplexity===3){I=0;const k=[],z=[],A=[],L=[],N=[];o.getLights().forEach(H=>{if(H.getSwitch()>0){const oe=H.getAttenuationValues();z[0+I*3]=oe[0],z[1+I*3]=oe[1],z[2+I*3]=oe[2],L[I]=H.getExponent(),A[I]=H.getConeAngle(),N[I]=H.getPositional();const de=H.getTransformedPosition();Pt(de,de,e.modelToView),k[0+I*3]=de[0],k[1+I*3]=de[1],k[2+I*3]=de[2],I+=1}}),l.setUniform3fv("lightPositionVC",k),l.setUniform3fv("lightAttenuation",z),l.setUniformfv("lightConeAngle",A),l.setUniformfv("lightExponent",L),l.setUniformiv("lightPositional",N)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&a.getProperty().getAmbient()>0){const k=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",k);const z=[];for(let A=0;A<k;A++)z[A*2]=Math.random()*.5,z[A*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",z),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(i,o,a)=>{const s=i.getProgram();s.setUniformi("ctexture",e.colorTexture.getTextureUnit()),s.setUniformi("otexture",e.opacityTexture.getTextureUnit()),s.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),s.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),l=a.getProperty(),f=e.scalarTexture.getComponents(),u=t.useIndependentComponents(l);if(u)for(let h=0;h<f;h++)s.setUniformf(`mix${h}`,a.getProperty().getComponentWeight(h));for(let h=0;h<f;h++){const g=u?h:0,p=c.scale[h],w=l.getScalarOpacity(g).getRange(),m=p/(w[1]-w[0]),y=(c.offset[h]-w[0])/(w[1]-w[0]);s.setUniformf(`oshift${h}`,y),s.setUniformf(`oscale${h}`,m);const C=l.getRGBTransferFunction(g).getRange(),S=(c.offset[h]-C[0])/(C[1]-C[0]),T=p/(C[1]-C[0]);s.setUniformf(`cshift${h}`,S),s.setUniformf(`cscale${h}`,T)}if(e.gopacity)if(u)for(let h=0;h<f;++h){const g=c.scale[h];if(l.getUseGradientOpacity(h)){const v=l.getGradientOpacityMinimumOpacity(h),w=l.getGradientOpacityMaximumOpacity(h);s.setUniformf(`gomin${h}`,v),s.setUniformf(`gomax${h}`,w);const m=[l.getGradientOpacityMinimumValue(h),l.getGradientOpacityMaximumValue(h)];s.setUniformf(`goscale${h}`,g*(w-v)/(m[1]-m[0])),s.setUniformf(`goshift${h}`,-m[0]*(w-v)/(m[1]-m[0])+v)}else s.setUniformf(`gomin${h}`,1),s.setUniformf(`gomax${h}`,1),s.setUniformf(`goscale${h}`,0),s.setUniformf(`goshift${h}`,1)}else{const h=c.scale[f-1],g=l.getGradientOpacityMinimumOpacity(0),p=l.getGradientOpacityMaximumOpacity(0);s.setUniformf("gomin0",g),s.setUniformf("gomax0",p);const v=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];s.setUniformf("goscale0",h*(p-g)/(v[1]-v[0])),s.setUniformf("goshift0",-v[0]*(p-g)/(v[1]-v[0])+g)}if(t.isLabelmapOutlineRequired(a)===!0){const h=a.getProperty().getLabelOutlineOpacity();s.setUniformf("outlineOpacity",h)}e.lightComplexity>0&&(s.setUniformf("vAmbient",l.getAmbient()),s.setUniformf("vDiffuse",l.getDiffuse()),s.setUniformf("vSpecular",l.getSpecular()),s.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(i,o,a)=>{if(e.renderable.getClippingPlanes().length>0){const s=e.openGLCamera.getKeyMatrices(o),c=[],l=[],f=[],u=e.renderable.getClippingPlanes(),d=u.length;for(let g=0;g<d;++g){const p=u[g].getNormal(),v=u[g].getOrigin();d2(p,p,s.normalMatrix),Pt(v,v,s.wcvc);const w=-1*gt(v,p);c.push(p[0]),c.push(p[1]),c.push(p[2]),l.push(w),f.push(v[0]),f.push(v[1]),f.push(v[2])}const h=i.getProgram();h.setUniform3fv("vClipPlaneNormals",c),h.setUniformfv("vClipPlaneDistances",l),h.setUniform3fv("vClipPlaneOrigins",f),h.setUniformi("clip_numPlanes",d)}},t.delete=Zp(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:i,vsize:o}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,o]},t.getRenderTargetOffset=()=>{const{lowerLeftU:i,lowerLeftV:o}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,o]},t.getCurrentSampleDistance=i=>{const o=i.getVTKWindow().getInteractor(),a=e.renderable.getSampleDistance();if(o.isAnimating()){const s=e.renderable.getInteractionSampleDistanceFactor();return a*s}return a},t.renderPieceStart=(i,o)=>{const a=i.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,a.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=a.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=a.getRecentAnimationFrameRate(),l=a.getDesiredUpdateRate()/c;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*c[0]),e._smallViewportHeight=Math.ceil(l*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const u=e.framebuffer.getSize();(!u||u[0]!==c[0]||u[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const f=e.context;f.clearColor(0,0,0,0),f.colorMask(!0,!0,!0,!0),f.clear(f.COLOR_BUFFER_BIT),f.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(i,o),o.getProperty().getInterpolationType()===fC.NEAREST?(e.scalarTexture.setMinificationFilter(_t.NEAREST),e.scalarTexture.setMagnificationFilter(_t.NEAREST)):(e.scalarTexture.setMinificationFilter(_t.LINEAR),e.scalarTexture.setMagnificationFilter(_t.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(i,o)=>{const a=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,i,o),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(i,o)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=BT.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Rw("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const a=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,a[0],a[1]);const s=e.framebuffer.getColorTexture();s.activate(),e.copyShader.setUniformi("texture",s.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),s.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(i,o)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){Rw("No input!");return}t.renderPieceStart(i,o),t.renderPieceDraw(i,o),t.renderPieceFinish(i,o)},t.computeBounds=(i,o)=>{if(!t.getInput()){Jd(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(i,o)=>{t.getNeedToRebuildBufferObjects(i,o)&&t.buildBufferObjects(i,o)},t.getNeedToRebuildBufferObjects=(i,o)=>{var a,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((a=e.scalarTexture)!=null&&a.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.labelOutlineThicknessTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,o)=>{var C,S;const a=e.currentInput;if(!a)return;const s=a.getPointData()&&a.getPointData().getScalars();if(!s)return;const c=o.getProperty();if(!e.jitterTexture.getHandle()){const T=new Uint8Array(1024);for(let _=0;_<32*32;++_)T[_]=255*Math.random();e.jitterTexture.setMinificationFilter(_t.LINEAR),e.jitterTexture.setMagnificationFilter(_t.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Ht.UNSIGNED_CHAR,T)}const l=s.getNumberOfComponents(),f=t.useIndependentComponents(c),u=f?l:1,d=c.getScalarOpacity(),h=e._openGLRenderWindow.getGraphicsResourceForObject(d);let g=Ks(d,f,u);if(!(h!=null&&h.oglObject)||h.hash!==g){e.opacityTexture=rr.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const T=1024,_=T*2*u,E=new Float32Array(_),D=new Float32Array(T);for(let b=0;b<u;++b){const I=c.getScalarOpacity(b),R=t.getCurrentSampleDistance(i)/c.getScalarOpacityUnitDistance(b),M=I.getRange();I.getTable(M[0],M[1],T,D,1);for(let P=0;P<T;++P)E[b*T*2+P]=1-(1-D[P])**R,E[b*T*2+P+T]=E[b*T*2+P]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(_t.LINEAR),e.opacityTexture.setMagnificationFilter(_t.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(T,2*u,1,Ht.FLOAT,E);else{const b=new Uint8ClampedArray(_);for(let I=0;I<_;++I)b[I]=255*E[I];e.opacityTexture.create2DFromRaw(T,2*u,1,Ht.UNSIGNED_CHAR,b)}d&&(e._openGLRenderWindow.setGraphicsResourceForObject(d,e.opacityTexture,g),d!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(d,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=d)}else e.opacityTexture=h.oglObject;const v=c.getRGBTransferFunction();g=Ks(v,f,u);const w=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!((C=w==null?void 0:w.oglObject)!=null&&C.getHandle())||(w==null?void 0:w.hash)!==g){e.colorTexture=rr.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const T=1024,_=T*2*u*3,E=new Uint8ClampedArray(_),D=new Float32Array(T*3);for(let b=0;b<u;++b){const I=c.getRGBTransferFunction(b),R=I.getRange();I.getTable(R[0],R[1],T,D,1);for(let M=0;M<T*3;++M)E[b*T*6+M]=255*D[M],E[b*T*6+M+T*3]=255*D[M]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(_t.LINEAR),e.colorTexture.setMagnificationFilter(_t.LINEAR),e.colorTexture.create2DFromRaw(T,2*u,3,Ht.UNSIGNED_CHAR,E),v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.colorTexture,g),v!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=v)}else e.colorTexture=w.oglObject;t.updateLabelOutlineThicknessTexture(o);const y=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(g=t_(a,s),!((S=y==null?void 0:y.oglObject)!=null&&S.getHandle())||(y==null?void 0:y.hash)!==g){e.scalarTexture=rr.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const T=a.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(T[0],T[1],T[2],s,e.renderable.getPreferSizeOverAccuracy()),s&&(e._openGLRenderWindow.setGraphicsResourceForObject(s,e.scalarTexture,g),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s)}else e.scalarTexture=y.oglObject;if(!e.tris.getCABO().getElementCount()){const T=new Float32Array(12);for(let b=0;b<4;b++)T[b*3]=b%2*2-1,T[b*3+1]=b>1?1:-1,T[b*3+2]=-1;const _=new Uint16Array(8);_[0]=3,_[1]=0,_[2]=1,_[3]=3,_[4]=3,_[5]=0,_[6]=3,_[7]=2;const E=Lt.newInstance({numberOfComponents:3,values:T});E.setName("points");const D=Lt.newInstance({numberOfComponents:1,values:_});e.tris.getCABO().createVBO(D,"polys",Mi.SURFACE,{points:E,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=i=>{var l;const o=i.getProperty().getLabelOutlineThickness(),a=e._openGLRenderWindow.getGraphicsResourceForObject(o),s=`${o.join("-")}`;if(!((l=a==null?void 0:a.oglObject)!=null&&l.getHandle())||(a==null?void 0:a.hash)!==s){e.labelOutlineThicknessTexture=rr.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const f=1024,u=1,d=f*u,h=new Uint8Array(d);for(let g=0;g<f;++g){const p=typeof o[g]<"u"?o[g]:o[0];h[g]=p}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(_t.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(_t.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(f,u,1,Ht.UNSIGNED_CHAR,h),o&&(e._openGLRenderWindow.setGraphicsResourceForObject(o,e.labelOutlineThicknessTexture,s),o!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=o)}else e.labelOutlineThicknessTexture=a.oglObject},t.isLabelmapOutlineRequired=i=>{const o=i.getProperty(),a=e.renderable;return o.getUseLabelOutline()||a.getBlendMode()===r2.LABELMAP_EDGE_PROJECTION_BLEND}}const jZ={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function xP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jZ,r),Gn.extend(t,e,r),Hs.implementBuildShadersWithReplacements(t,e,r),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),e.tris=Js.newInstance(),e.jitterTexture=rr.newInstance(),e.jitterTexture.setWrapS(dp.REPEAT),e.jitterTexture.setWrapT(dp.REPEAT),e.framebuffer=$y.newInstance(),e.idxToView=yt(new Float64Array(16)),e.idxNormalMatrix=Ta(new Float64Array(9)),e.modelToView=yt(new Float64Array(16)),e.projectionToView=yt(new Float64Array(16)),e.projectionToWorld=yt(new Float64Array(16)),Fr(t,e,["context"]),$Z(t,e)}const CP=Sn(xP,"vtkOpenGLVolumeMapper");var SP={newInstance:CP,extend:xP};Hr("vtkVolumeMapper",CP);function n_(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return Float32Array}}function r_(t,e,r={}){const{isVolumeBuffer:n=!1}=r,i=n_(t,n),o=i.BYTES_PER_ELEMENT;return{numBytes:e*o,TypedArrayConstructor:i}}function HZ(t,e){e.classHierarchy.push("vtkStreamingOpenGLVolumeMapper"),t.buildBufferObjects=(r,n)=>{var p;const i=e.currentInput;if(!i)return;const o=n.getProperty();if(!e.jitterTexture.getHandle()){const v=new Uint8Array(1024);for(let w=0;w<32*32;++w)v[w]=255*Math.random();e.jitterTexture.setMinificationFilter(_t.LINEAR),e.jitterTexture.setMagnificationFilter(_t.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,Ht.UNSIGNED_CHAR,v)}const{numberOfComponents:a}=i.get("numberOfComponents"),s=t.useIndependentComponents(o),c=o.getScalarOpacity(),l=e._openGLRenderWindow.getGraphicsResourceForObject(c);let f=Ks(c,s,a);if(!(l!=null&&l.oglObject)||l.hash!==f){e.opacityTexture=rr.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const v=1024,w=v*2*a,m=new Float32Array(w),y=new Float32Array(v);for(let x=0;x<a;++x){const C=o.getScalarOpacity(x),S=t.getCurrentSampleDistance(r)/o.getScalarOpacityUnitDistance(x),T=C.getRange();C.getTable(T[0],T[1],v,y,1);for(let _=0;_<v;++_)m[x*v*2+_]=1-(1-y[_])**S,m[x*v*2+_+v]=m[x*v*2+_]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(_t.LINEAR),e.opacityTexture.setMagnificationFilter(_t.LINEAR),e._openGLRenderWindow.getWebgl2()&&e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(v,2*a,1,Ht.FLOAT,m);else{const x=new Uint8ClampedArray(w);for(let C=0;C<w;++C)x[C]=255*m[C];e.opacityTexture.create2DFromRaw(v,2*a,1,Ht.UNSIGNED_CHAR,x)}c&&(e._openGLRenderWindow.setGraphicsResourceForObject(c,e.opacityTexture,f),c!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(c,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=c)}else e.opacityTexture=l.oglObject;const d=o.getRGBTransferFunction();f=Ks(d,s,a);const h=e._openGLRenderWindow.getGraphicsResourceForObject(d);if(!((p=h==null?void 0:h.oglObject)!=null&&p.getHandle())||(h==null?void 0:h.hash)!==f){e.colorTexture=rr.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const v=1024,w=v*2*a*3,m=new Uint8ClampedArray(w),y=new Float32Array(v*3);for(let x=0;x<a;++x){const C=o.getRGBTransferFunction(x),S=C.getRange();C.getTable(S[0],S[1],v,y,1);for(let T=0;T<v*3;++T)m[x*v*6+T]=255*y[T],m[x*v*6+T+v*3]=255*y[T]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(_t.LINEAR),e.colorTexture.setMagnificationFilter(_t.LINEAR),e.colorTexture.create2DFromRaw(v,2*a,3,Ht.UNSIGNED_CHAR,m),d&&(e._openGLRenderWindow.setGraphicsResourceForObject(d,e.colorTexture,f),d!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(d,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=d)}else e.colorTexture=h.oglObject;if(t.updateLabelOutlineThicknessTexture(n),f=`${i.getMTime()}-${e.scalarTexture.getMTime()}`,e.scalarTextureString!==f){const v=i.getDimensions();e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.scalarTexture.enableUseHalfFloat(!1);const w=e.scalarTexture.getTextureParameters(),m=i.get("dataType").dataType;let y=!0;if((w==null?void 0:w.dataType)===m&&(w==null?void 0:w.width)===v[0]&&(w==null?void 0:w.height)===v[1]&&(w==null?void 0:w.depth)===v[2]&&(y=!1),y){const x=e.context.getExtension("EXT_texture_norm16");e.scalarTexture.setOglNorm16Ext(x),e.scalarTexture.resetFormatAndType(),e.scalarTexture.setTextureParameters({width:v[0],height:v[1],depth:v[2],numberOfComponents:a,dataType:m}),e.scalarTexture.create3DFromRaw(v[0],v[1],v[2],a,m,null),e.scalarTexture.update3DFromRaw()}else e.scalarTexture.deactivate(),e.scalarTexture.update3DFromRaw();e.scalarTextureString=f}if(!e.tris.getCABO().getElementCount()){const v=new Float32Array(12);for(let x=0;x<4;x++)v[x*3]=x%2*2-1,v[x*3+1]=x>1?1:-1,v[x*3+2]=-1;const w=new Uint16Array(8);w[0]=3,w[1]=0,w[2]=1,w[3]=3,w[4]=3,w[5]=0,w[6]=3,w[7]=2;const m=Lt.newInstance({numberOfComponents:3,values:v});m.setName("points");const y=Lt.newInstance({numberOfComponents:1,values:w});e.tris.getCABO().createVBO(y,"polys",Mi.SURFACE,{points:m,cellOffset:0})}e.VBOBuildTime.modified()},t.getNeedToRebuildBufferObjects=(r,n)=>{var i,o,a,s,c,l;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<n.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<n.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<((i=e.scalarTexture)==null?void 0:i.getMTime())||e.VBOBuildTime.getMTime()<((o=e.colorTexture)==null?void 0:o.getMTime())||e.VBOBuildTime.getMTime()<((a=e.labelOutlineThicknessTexture)==null?void 0:a.getMTime())||!((s=e.scalarTexture)!=null&&s.getHandle())||!((c=e.colorTexture)!=null&&c.getHandle())||!((l=e.labelOutlineThicknessTexture)!=null&&l.getHandle())}}const KZ={};function TP(t,e,r={}){Object.assign(e,KZ,r),SP.extend(t,e,r),e.scalarTexture=r.scalarTexture,e.previousState={},HZ(t,e)}const qZ=K.newInstance(TP,"vtkStreamingOpenGLVolumeMapper"),XZ={newInstance:qZ,extend:TP},_P=Object.create(null);function mi(t,e){_P[t]=e}function YZ(t,e){e.classHierarchy.push("vtkStreamingOpenGLViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,i=r.getClassName(n++),o=!1;const a=Object.keys(e.overrides);for(;i&&!o;)a.includes(i)?o=!0:i=r.getClassName(n++);if(!o)return null;const s=e.getModelInitialValues(r),c=e.overrides[i](s);return c.setMyFactory(t),c},e.overrides=_P,e.getModelInitialValues=r=>{const n={};return r.getClassName()==="vtkSharedVolumeMapper"&&(n.scalarTexture=r.getScalarTexture()),n}}const JZ={};function EP(t,e,r={}){Object.assign(e,JZ,r),ET.extend(t,e,r),YZ(t,e),mi("vtkActor",MY.newInstance),mi("vtkActor2D",LY.newInstance),mi("vtkCamera",kY.newInstance),mi("vtkGlyph3DMapper",rZ.newInstance),mi("vtkImageMapper",lZ.newInstance),mi("vtkImageCPRMapper",hZ.newInstance),mi("vtkImageSlice",mZ.newInstance),mi("vtkMapper",t5.newInstance),mi("vtkPixelSpaceCallbackMapper",xZ.newInstance),mi("vtkRenderer",_Z.newInstance),mi("vtkSkybox",bZ.newInstance),mi("vtkSphereMapper",PZ.newInstance),mi("vtkStickMapper",kZ.newInstance),mi("vtkTexture",rr.newInstance),mi("vtkVolume",UZ.newInstance),mi("vtkVolumeMapper",SP.newInstance),mi("vtkSharedVolumeMapper",XZ.newInstance)}const ZZ=K.newInstance(EP,"vtkStreamingOpenGLViewNodeFactory"),QZ={newInstance:ZZ,extend:EP};function eQ(t,e){e.classHierarchy.push("vtkStreamingOpenGLRenderWindow")}function DP(t,e,r={}){Object.assign(e,r),bY.extend(t,e,r),e.myFactory=QZ.newInstance(),mi("vtkRenderWindow",bP),eQ(t,e)}const bP=K.newInstance(DP,"vtkStreamingOpenGLRenderWindow"),tQ={newInstance:bP,extend:DP},{vtkDebugMacro:em}=K;function nQ(t,e){e.classHierarchy.push("vtkCamera");const r=new Float64Array(3),n=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),o=yt(new Float64Array(16)),a=yt(new Float64Array(16)),s=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),f=yt(new Float64Array(16)),u=yt(new Float64Array(16)),d=new Float64Array(3),h=new Float64Array(3);function g(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,v,w)=>{p===e.position[0]&&v===e.position[1]&&w===e.position[2]||(e.position[0]=p,e.position[1]=v,e.position[2]=w,t.computeDistance(),t.modified())},t.setFocalPoint=(p,v,w)=>{p===e.focalPoint[0]&&v===e.focalPoint[1]&&w===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=v,e.focalPoint[2]=w,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,em("Distance is set to minimum."));const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],w=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+v*v+w*w),e.distance<1e-20){e.distance=1e-20,em("Distance is set to minimum.");const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=w/e.distance,g()},t.dolly=p=>{if(p<=0)return;const v=e.distance/p;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=p=>{const v=e.position,w=e.focalPoint,m=e.viewUp,y=new Float64Array([m[0],m[1],m[2],0]);yt(f);const x=new Float64Array([w[0]-v[0],w[1]-v[1],w[2]-v[2]]);Ki(f,f,Tr(p),x),$l(y,y,f),e.viewUp[0]=y[0],e.viewUp[1]=y[1],e.viewUp[2]=y[2],t.modified()},t.azimuth=p=>{const v=e.focalPoint;yt(u),Wn(u,u,v),Ki(u,u,Tr(p),e.viewUp),Wn(u,u,[-v[0],-v[1],-v[2]]),Pt(d,e.position,u),t.setPosition(d[0],d[1],d[2])},t.yaw=p=>{const v=e.position;yt(u),Wn(u,u,v),Ki(u,u,Tr(p),e.viewUp),Wn(u,u,[-v[0],-v[1],-v[2]]),Pt(h,e.focalPoint,u),t.setFocalPoint(h[0],h[1],h[2])},t.elevation=p=>{const v=e.focalPoint,w=t.getViewMatrix(),m=[-w[0],-w[1],-w[2]];yt(u),Wn(u,u,v),Ki(u,u,Tr(p),m),Wn(u,u,[-v[0],-v[1],-v[2]]),Pt(d,e.position,u),t.setPosition(d[0],d[1],d[2])},t.pitch=p=>{const v=e.position,w=t.getViewMatrix(),m=[w[0],w[1],w[2]];yt(u),Wn(u,u,v),Ki(u,u,Tr(p),m),Wn(u,u,[-v[0],-v[1],-v[2]]),Pt(h,e.focalPoint,u),t.setFocalPoint(...h)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,v,w)=>{const m=[p,v,w];fv(e.position,m,e.position),fv(e.focalPoint,m,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const v=[...e.viewUp,1],w=[],m=[],y=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],$l(w,[...e.position,1],p),$l(m,[...e.focalPoint,1],p),$l(y,v,p),y[0]-=w[0],y[1]-=w[1],y[2]-=w[2],t.setPosition(...w.slice(0,3)),t.setFocalPoint(...m.slice(0,3)),t.setViewUp(...y.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let v=p;v<1e-20&&(v=1e-20,em("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=p=>{let v=p;v<1e-20&&(v=1e-20,em("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=p=>{},t.getCameraLightTransformMatrix=p=>(sr(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{sr(o,t.getViewMatrix()),Or(o,o),LT(a,[e.distance,e.distance,e.distance]),rn(o,o,a),yt(e.cameraLightTransform),Wn(e.cameraLightTransform,o,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const v=QE(p[0],p[1],p[2],p[3]),w=hu(),m=QE(0,0,1,0);return Iq(w,v),ZE(m,v,m),ZE(m,m,w),[m[0],m[1],m[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),Or(p,p)},t.getWorldToPhysicalMatrix=p=>{yt(p);const v=[3];$s(e.physicalViewNorth,e.physicalViewUp,v),p[0]=v[0],p[1]=v[1],p[2]=v[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],Yt(p,p),Dn(s,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Wc(p,p,s),Wn(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{Or(o,p),Pt(s,r,o),t.computeDistance();const v=e.distance;t.setPosition(s[0],s[1],s[2]),Pt(c,n,o),yn(c,c,s),kn(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),Pt(l,i,o),yn(l,l,s),kn(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(o),rn(o,p,o),t.computeViewParametersFromViewMatrix(o)},t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(sr(o,e.viewMatrix),t.computeViewParametersFromViewMatrix(o),Yt(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;kT(o,e.position,e.focalPoint,e.viewUp),Yt(o,o);const p=new Float64Array(16);return sr(p,o),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,v,w)=>{const m=new Float64Array(16);if(yt(m),e.projectionMatrix){const C=1/e.physicalScale;return Dn(s,C,C,C),sr(m,e.projectionMatrix),Wc(m,m,s),Yt(m,m),m}yt(o);const y=e.clippingRange[1]-e.clippingRange[0],x=[e.clippingRange[0]+(v+1)*y/2,e.clippingRange[0]+(w+1)*y/2];if(e.parallelProjection){const C=e.parallelScale*p,S=e.parallelScale,T=(e.windowCenter[0]-1)*C,_=(e.windowCenter[0]+1)*C,E=(e.windowCenter[1]-1)*S,D=(e.windowCenter[1]+1)*S;NT(o,T,_,E,D,x[0],x[1]),Yt(o,o)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const C=Math.tan(Tr(e.viewAngle)/2);let S,T;e.useHorizontalViewAngle===!0?(S=e.clippingRange[0]*C,T=e.clippingRange[0]*C/p):(S=e.clippingRange[0]*C*p,T=e.clippingRange[0]*C);const _=(e.windowCenter[0]-1)*S,E=(e.windowCenter[0]+1)*S,D=(e.windowCenter[1]-1)*T,b=(e.windowCenter[1]+1)*T,I=x[0],R=x[1];o[0]=2*I/(E-_),o[5]=2*I/(b-D),o[2]=(_+E)/(E-_),o[6]=(D+b)/(b-D),o[10]=-(I+R)/(R-I),o[14]=-1,o[11]=-2*I*R/(R-I),o[15]=0}}return sr(m,o),m},t.getCompositeProjectionMatrix=(p,v,w)=>{const m=t.getViewMatrix(),y=t.getProjectionMatrix(p,v,w);return rn(y,m,y),y},t.setDirectionOfProjection=(p,v,w)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===w)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=v,e.directionOfProjection[2]=w;const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,g()},t.setDeviceAngles=(p,v,w,m)=>{const y=[3];$s(e.physicalViewNorth,e.physicalViewUp,y);const x=yt(new Float64Array(16));Ki(x,x,Tr(p),e.physicalViewUp),Ki(x,x,Tr(v),y),Ki(x,x,Tr(w),e.physicalViewNorth),Ki(x,x,Tr(-m),e.physicalViewUp);const C=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),S=new Float64Array(e.physicalViewNorth);Pt(C,C,x),Pt(S,S,x),t.setDirectionOfProjection(C[0],C[1],C[2]),t.setViewUp(S[0],S[1],S[2]),t.modified()},t.setOrientationWXYZ=(p,v,w,m)=>{const y=yt(new Float64Array(16));if(p!==0&&(v!==0||w!==0||m!==0)){const S=Tr(p),T=hu();Ky(T,[v,w,m],S),gv(y,T)}const x=new Float64Array(3);Pt(x,[0,0,-1],y);const C=new Float64Array(3);Pt(C,[0,1,0],y),t.setDirectionOfProjection(...x),t.setViewUp(...C),t.modified()},t.computeClippingRange=p=>{let v=null,w=null;v=e.viewPlaneNormal,w=e.position;const m=-v[0],y=-v[1],x=-v[2],C=-(m*w[0]+y*w[1]+x*w[2]),S=[m*p[0]+y*p[2]+x*p[4]+C,1e-18];for(let T=0;T<2;T++)for(let _=0;_<2;_++)for(let E=0;E<2;E++){const D=m*p[E]+y*p[2+_]+x*p[4+T]+C;S[0]=D<S[0]?D:S[0],S[1]=D>S[1]?D:S[1]}return S}}const rQ={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:ba(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function IP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rQ,r),K.obj(t,e),K.get(t,e,["distance"]),K.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),K.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),K.setGetArray(t,e,["clippingRange","windowCenter"],2),K.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),nQ(t,e)}const iQ=K.newInstance(IP,"vtkCamera");var i_={newInstance:iQ,extend:IP};const oQ=["HeadLight","CameraLight","SceneLight"];function aQ(t,e){e.classHierarchy.push("vtkLight");const r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?Pt(r,e.position,e.transformMatrix):Dn(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?Pt(r,e.focalPoint,e.transformMatrix):Dn(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(bn(e.direction,e.focalPoint,e.position),Hf(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{const i=new Float64Array(3);bn(i,e.position,n),e.focalPoint=i},t.setDirectionAngle=(n,i)=>{const o=Tr(n),a=Tr(i);t.setPosition(Math.cos(o)*Math.sin(a),Math.sin(o),Math.cos(o)*Math.cos(a)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const sQ={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function OP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sQ,r),K.obj(t,e),K.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),K.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),aQ(t,e)}const cQ=K.newInstance(OP,"vtkLight");var lQ={newInstance:cQ,extend:OP,LIGHT_TYPES:oQ};const{vtkErrorMacro:v2}=K;function uQ(t){return()=>v2(`vtkViewport::${t} - NOT IMPLEMENTED`)}function fQ(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{const i=e.props.filter(o=>o!==n);e.props.length!==i.length&&(e.props=i)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];i.push(n);const o=n.getNestedProps();if(o&&o.length)for(let a=0;a<o.length;a++)r(o[a],i);return i}t.getViewPropsWithNestedProps=()=>{const n=[];for(let i=0;i<e.props.length;i++)r(e.props[i],n);return n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>v2("call displayToView on your view instead"),t.viewToDisplay=()=>v2("callviewtodisplay on your view instead"),t.getSize=()=>v2("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,i,o)=>{const a=t.normalizedDisplayToNormalizedViewport(n,i,o);return t.normalizedViewportToProjection(a[0],a[1],a[2])},t.normalizedDisplayToNormalizedViewport=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/a[0],(i-e.viewport[1])/a[1],o]},t.normalizedViewportToProjection=(n,i,o)=>[n*2-1,i*2-1,o*2-1],t.projectionToNormalizedDisplay=(n,i,o)=>{const a=t.projectionToNormalizedViewport(n,i,o);return t.normalizedViewportToNormalizedDisplay(a[0],a[1],a[2])},t.normalizedViewportToNormalizedDisplay=(n,i,o)=>{const a=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*a[0]+e.viewport[0],i*a[1]+e.viewport[1],o]},t.projectionToNormalizedViewport=(n,i,o)=>[(n+1)*.5,(i+1)*.5,(o+1)*.5],t.PickPropFrom=uQ("PickPropFrom")}const dQ={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function MP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dQ,r),K.obj(t,e),K.event(t,e,"event"),K.setGetArray(t,e,["viewport"],4),K.setGetArray(t,e,["background","background2"],3),fQ(t,e)}const hQ=K.newInstance(MP,"vtkViewport");var gQ={newInstance:hQ,extend:MP};const{vtkDebugMacro:Ah,vtkErrorMacro:Ml,vtkWarningMacro:pQ}=Ni;function _6(t){return()=>Ml(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function mQ(t,e){e.classHierarchy.push("vtkRenderer");const r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},i={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Ah("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const o=t.getActiveCameraAndResetIfCreated();e.lights.forEach(a=>{a.lightTypeIsSceneLight()||(a.lightTypeIsHeadLight()?(a.setPositionFrom(o.getPositionByReference()),a.setFocalPointFrom(o.getFocalPointByReference()),a.modified(o.getMTime())):a.lightTypeIsCameraLight()?a.setTransformMatrix(o.getCameraLightTransformMatrix(ba())):Ml("light has unknown light type",a.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=_6("allocateTime"),t.updateGeometry=_6("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=o=>{Ah(t.getClassName(),t,"setting Layer to ",o),e.layer!==o&&(e.layer=o,t.modified()),t.setPreserveColorBuffer(!!o)},t.setActiveCamera=o=>e.activeCamera===o?!1:(e.activeCamera=o,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:o}),!0),t.makeCamera=()=>{const o=i_.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:o}),o},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(o=>{e.actors=e.actors.concat(o.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=o=>{e.actors=e.actors.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(a=>{t.removeViewProp(a)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(o=>{e.volumes=e.volumes.concat(o.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=o=>{e.volumes=e.volumes.filter(a=>a!==o),t.removeViewProp(o),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(a=>{t.removeViewProp(a)}),e.volumes=[],t.modified()},t.hasLight=o=>e.lights.includes(o),t.addLight=o=>{o&&!t.hasLight(o)&&(e.lights.push(o),t.modified())},t.removeLight=o=>{e.lights=e.lights.filter(a=>a!==o),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=o=>{e.lights=o,t.modified()},t.makeLight=lQ.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(o,a,s,c)=>{let l=t.normalizedDisplayToProjection(o,a,s);return l=t.projectionToView(l[0],l[1],l[2],c),t.viewToWorld(l[0],l[1],l[2])},t.worldToNormalizedDisplay=(o,a,s,c)=>{let l=t.worldToView(o,a,s);return l=t.viewToProjection(l[0],l[1],l[2],c),t.projectionToNormalizedDisplay(l[0],l[1],l[2])},t.viewToWorld=(o,a,s)=>{if(e.activeCamera===null)return Ml("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Or(c,c),Yt(c,c);const l=new Float64Array([o,a,s]);return Pt(l,l,c),l},t.projectionToView=(o,a,s,c)=>{if(e.activeCamera===null)return Ml("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);Or(l,l),Yt(l,l);const f=new Float64Array([o,a,s]);return Pt(f,f,l),f},t.worldToView=(o,a,s)=>{if(e.activeCamera===null)return Ml("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Yt(c,c);const l=new Float64Array([o,a,s]);return Pt(l,l,c),l},t.viewToProjection=(o,a,s,c)=>{if(e.activeCamera===null)return Ml("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const l=e.activeCamera.getProjectionMatrix(c,-1,1);Yt(l,l);const f=new Float64Array([o,a,s]);return Pt(f,f,l),f},t.computeVisiblePropBounds=()=>{e.allBounds[0]=Nn.INIT_BOUNDS[0],e.allBounds[1]=Nn.INIT_BOUNDS[1],e.allBounds[2]=Nn.INIT_BOUNDS[2],e.allBounds[3]=Nn.INIT_BOUNDS[3],e.allBounds[4]=Nn.INIT_BOUNDS[4],e.allBounds[5]=Nn.INIT_BOUNDS[5];let o=!0;t.invokeEvent(r);for(let a=0;a<e.props.length;++a){const s=e.props[a];if(s.getVisibility()&&s.getUseBounds()){const c=s.getBounds();c&&u2(c)&&(o=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return o&&(Jd(e.allBounds),Ah("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),s=[0,0,0];if(!u2(a))return Ah("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Ml("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),s[0]=(a[0]+a[1])/2,s[1]=(a[2]+a[3])/2,s[2]=(a[4]+a[5])/2;let l=a[1]-a[0],f=a[3]-a[2],u=a[5]-a[4];l*=l,f*=f,u*=u;let d=l+f+u;d=d===0?1:d,d=Math.sqrt(d)*.5;const h=Tr(e.activeCamera.getViewAngle()),g=d,p=d/Math.sin(h*.5),v=e.activeCamera.getViewUp();return Math.abs(qt(v,c))>.999&&(pQ("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(s[0],s[1],s[2]),e.activeCamera.setPosition(s[0]+p*c[0],s[1]+p*c[1],s[2]+p*c[2]),t.resetCameraClippingRange(a),e.activeCamera.setParallelScale(g),e.activeCamera.setPhysicalScale(d),e.activeCamera.setPhysicalTranslation(-s[0],-s[1],-s[2]),t.invokeEvent(i),!0},t.resetCameraClippingRange=function(){const a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!u2(a))return Ah("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Ml("Trying to reset clipping range of non-existent camera"),!1;const s=e.activeCamera.computeClippingRange(a);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const l=Tr(e.activeCamera.getViewAngle());c=.2*Math.tan(l/2)*s[1]}return s[1]-s[0]<c&&(c=c-s[1]+s[0],s[1]+=c/2,s[0]-=c/2),s[0]<0&&(s[0]=0),s[0]=.99*s[0]-(s[1]-s[0])*e.clippingRangeExpansion,s[1]=1.01*s[1]+(s[1]-s[0])*e.clippingRangeExpansion,s[0]=s[0]>=s[1]?.01*s[1]:s[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),s[0]<e.nearClippingPlaneTolerance*s[1]&&(s[0]=e.nearClippingPlaneTolerance*s[1]),e.activeCamera.setClippingRange(s[0],s[1]),t.invokeEvent(n),!1},t.setRenderWindow=o=>{o!==e._renderWindow&&(e._vtkWindow=o,e._renderWindow=o)},t.visibleActorCount=()=>e.props.filter(o=>o.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let o=e.mtime;const a=e.activeCamera?e.activeCamera.getMTime():0;a>o&&(o=a);const s=e._createdLight?e._createdLight.getMTime():0;return s>o&&(o=s),o},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const vQ={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:fu(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function RP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,vQ,r),gQ.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),mo(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Fr(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Yd(t,e,["actors","volumes","lights"]),sT(t,e,["background"],4,1),Jp(t,e,["renderWindow"]),mQ(t,e)}const yQ=Sn(RP,"vtkRenderer");var PP={newInstance:yQ,extend:RP};const wQ={Unknown:0,LeftController:1,RightController:2},xQ={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},CQ={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var LP={Device:wQ,Input:xQ,Axis:CQ};const{Device:tm,Input:hf}=LP,{vtkWarningMacro:nm,vtkErrorMacro:rm,normalizeWheel:SQ,vtkOnceErrorMacro:TQ}=K,v0={ctrlKey:!1,altKey:!1,shiftKey:!1},Pw={"xr-standard":[hf.Trigger,hf.Grip,hf.TrackPad,hf.Thumbstick,hf.A,hf.B]},o_=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Nh(t){t.cancelable&&t.preventDefault()}function im(t){const e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:i}=r;e[n]=i}),e}function _Q(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const r={...t},n=new Set,i=new Map;let o=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{rm("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>nm("empty event loop");function a(p,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,v))}t.getCurrentRenderer=()=>(e.currentRenderer||a(0,0),e.currentRenderer);function s(p){const v=e._view.getCanvas(),w=v.getBoundingClientRect(),m=v.width/w.width,y=v.height/w.height,x={x:m*(p.clientX-w.left),y:y*(w.height-p.clientY+w.top),z:0};return(i.size<=1||!e.currentRenderer)&&a(x.x,x.y),x}const c=e._getScreenEventPositionFor||s;function l(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function f(p){const v=l(p);return{key:p.key,keyCode:p.charCode,...v}}function u(p){return p.pointerType||""}const d=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",Nh),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;r.setContainer(p)&&d()};const h=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,o=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",Nh),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),i.clear()};t.unbindEvents=()=>{h(),r.setContainer(null)},t.handleKeyPress=p=>{const v=f(p);t.keyPressEvent(v)},t.handleKeyDown=p=>{const v=f(p);t.keyDownEvent(v)},t.handleKeyUp=p=>{const v=f(p);t.keyUpEvent(v)},t.handlePointerEnter=p=>{const v={...l(p),position:c(p),deviceType:u(p)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=p=>{const v={...l(p),position:c(p),deviceType:u(p)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Nh(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),i.has(p.pointerId)&&nm("[RenderWindowInteractor] duplicate pointerId detected"),i.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(i.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&Nh(p),i.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(i.has(p.pointerId))switch(i.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(i.has(p.pointerId)){const v=i.get(p.pointerId);v.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const v={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:rm(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var p;return(p=document.exitPointerLock)==null?void 0:p.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function g(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){rm("undefined requester, can not start animating");return}if(n.has(p)){nm("requester is already registered for animating");return}n.add(p),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const v=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(p)){if(!v){const w=p&&p.getClassName?p.getClassName():p;nm(`${w} did not request an animation`)}return}n.delete(p),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,v,w)=>{p.inputSources.forEach(m=>{const y=m.gripSpace==null?null:v.getPose(m.gripSpace,w),x=m.gripSpace==null?null:v.getPose(m.targetRaySpace,w),C=m.gamepad,S=m.handedness;if(C){C.index in e.lastGamepadValues||(e.lastGamepadValues[C.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let T=0;T<C.buttons.length;++T)T in e.lastGamepadValues[C.index][S].buttons||(e.lastGamepadValues[C.index][S].buttons[T]=!1),e.lastGamepadValues[C.index][S].buttons[T]!==C.buttons[T].pressed&&y!=null&&(t.button3DEvent({gamepad:C,position:y.transform.position,orientation:y.transform.orientation,targetPosition:x.transform.position,targetOrientation:x.transform.orientation,pressed:C.buttons[T].pressed,device:m.handedness==="left"?tm.LeftController:tm.RightController,input:Pw[C.mapping]&&Pw[C.mapping][T]?Pw[C.mapping][T]:hf.Trigger}),e.lastGamepadValues[C.index][S].buttons[T]=C.buttons[T].pressed),e.lastGamepadValues[C.index][S].buttons[T]&&y!=null&&t.move3DEvent({gamepad:C,position:y.transform.position,orientation:y.transform.orientation,targetPosition:x.transform.position,targetOrientation:x.transform.orientation,device:m.handedness==="left"?tm.LeftController:tm.RightController})}})},t.handleMouseMove=p=>{const v={...l(p),position:c(p),deviceType:u(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),g(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{Nh(p);const v={...SQ(p),...l(p),position:c(p),deviceType:u(p)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?o=Math.abs(v.spinY):o=1),v.spinY/=o,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const v={...l(p),position:c(p),deviceType:u(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:rm(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const v=[...i.values()];if(e.recognizeGestures&&v.length>1){const w=im(i);if(v.length===2){const m={...l(v0),position:v[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(m)}t.recognizeGesture("TouchStart",w)}else if(v.length===1){const w={...l(v0),position:c(p),deviceType:u(p)};t.leftButtonPressEvent(w)}},t.handleTouchMove=p=>{const v=[...i.values()];if(e.recognizeGestures&&v.length>1){const w=im(i);t.recognizeGesture("TouchMove",w)}else if(v.length===1){const w={...l(v0),position:v[0].position,deviceType:u(p)};t.mouseMoveEvent(w)}},t.handleTouchEnd=p=>{const v=[...i.values()];if(e.recognizeGestures)if(v.length===0){const w={...l(v0),position:c(p),deviceType:u(p)};t.leftButtonReleaseEvent(w)}else if(v.length===1){const w=im(i);t.recognizeGesture("TouchEnd",w);const m={...l(v0),position:v[0].position,deviceType:u(p)};t.leftButtonPressEvent(m)}else{const w=im(i);t.recognizeGesture("TouchMove",w)}else if(v.length===1){const w={...l(v0),position:v[0].position,deviceType:u(p)};t.leftButtonReleaseEvent(w)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var p,v,w;return(w=(v=(p=e._view)==null?void 0:p.getRenderable())==null?void 0:v.getRenderersByReference())==null?void 0:w[0]},t.findPokedRenderer=function(){var S,T;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const w=(T=(S=e._view)==null?void 0:S.getRenderable())==null?void 0:T.getRenderers();if(!w||w.length===0)return null;w.sort((_,E)=>_.getLayer()-E.getLayer());let m=null,y=null,x=null,C=w.length;for(;C--;){const _=w[C];if(e._view.isInViewport(p,v,_)&&_.getInteractive()){x=_;break}m===null&&_.getInteractive()&&(m=_),y===null&&e._view.isInViewport(p,v,_)&&(y=_)}return x===null&&(x=m),x===null&&(x=y),x==null&&(x=w[0]),x},t.render=()=>{!t.isAnimating()&&!e.inRender&&g()},o_.forEach(p=>{const v=p.charAt(0).toLowerCase()+p.slice(1);t[`${v}Event`]=w=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){TQ(`
          Can not forward events without a current renderer on the interactor.
        `);return}const y={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...w};t[`invoke${p}`](y)}}),t.recognizeGesture=(p,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(v).forEach(D=>{e.startingEventPositions[D]=v[D]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let w=0;const m=[],y=[];Object.keys(v).forEach(D=>{m[w]=v[D],y[w]=e.startingEventPositions[D],w++});const x=Math.sqrt((y[0].x-y[1].x)*(y[0].x-y[1].x)+(y[0].y-y[1].y)*(y[0].y-y[1].y)),C=Math.sqrt((m[0].x-m[1].x)*(m[0].x-m[1].x)+(m[0].y-m[1].y)*(m[0].y-m[1].y));let S=uv(Math.atan2(y[1].y-y[0].y,y[1].x-y[0].x)),T=uv(Math.atan2(m[1].y-m[0].y,m[1].x-m[0].x)),_=T-S;T=T+180>=360?T-180:T+180,S=S+180>=360?S-180:S+180,Math.abs(T-S)<Math.abs(_)&&(_=T-S);const E=[];if(E[0]=(m[0].x-y[0].x+m[1].x-y[1].x)/2,E[1]=(m[0].y-y[0].y+m[1].y-y[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let D=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);D<15&&(D=15);const b=Math.abs(C-x),I=C*3.1415926*Math.abs(_)/360,R=Math.sqrt(E[0]*E[0]+E[1]*E[1]);if(b>D&&b>I&&b>R){e.currentGesture="Pinch";const M={scale:1,touches:v};t.startPinchEvent(M)}else if(I>D&&I>R){e.currentGesture="Rotate";const M={rotation:0,touches:v};t.startRotateEvent(M)}else if(R>D){e.currentGesture="Pan";const M={translation:[0,0],touches:v};t.startPanEvent(M)}}else{if(e.currentGesture==="Rotate"){const D={rotation:_,touches:v};t.rotateEvent(D)}if(e.currentGesture==="Pinch"){const D={scale:C/x,touches:v};t.pinchEvent(D)}if(e.currentGesture==="Pan"){const D={translation:E,touches:v};t.panEvent(D)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{h();const v=r.setContainer(p??null);return v&&d(),v},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const EQ={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function AP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EQ,r),K.obj(t,e),e._animationExtendedEnd=0,K.event(t,e,"RenderEvent"),o_.forEach(n=>K.event(t,e,n)),K.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),K.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),K.moveToProtected(t,e,["view"]),_Q(t,e)}const DQ=K.newInstance(AP,"vtkRenderWindowInteractor");var bQ={newInstance:DQ,extend:AP,handledEvents:o_,...LP};const{vtkErrorMacro:IQ}=K,OQ=[1,-1,1,-1,1,-1];function MQ(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==r&&(e.size=r*n,e.values=K.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(n),t.modified())},t.setPoint=function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];t.setTuple(r,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(r,n,i)=>t.insertNextTuple([r,n,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const o=t.getRange(1);e.bounds[2]=o[0],e.bounds[3]=o[1];const a=t.getRange(2);return e.bounds[4]=a[0],e.bounds[5]=a[1],e.bounds}if(t.getNumberOfComponents()!==2)return IQ(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),OQ;const r=t.getRange(0);e.bounds[0]=r[0],e.bounds[1]=r[1];const n=t.getRange(1);return e.bounds[2]=n[0],e.bounds[3]=n[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const RQ={empty:!0,numberOfComponents:3,dataType:Ht.FLOAT,bounds:[1,-1,1,-1,1,-1]};function NP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RQ,r),Lt.extend(t,e,r),MQ(t,e)}const PQ=K.newInstance(NP,"vtkPoints");var gp={newInstance:PQ,extend:NP};function kP(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function VP(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}const LQ={extractCellSizes:kP,getNumberOfCells:VP};function AQ(t,e){e.classHierarchy.push("vtkCellArray");const r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=VP(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=kP(t.getData())),e.cellSizes),t.resize=n=>{const i=t.getNumberOfTuples();r.resize(n);const o=t.getNumberOfTuples();o<i&&(o===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let i=n;const o=e.values[i++];return e.values.subarray(i,i+o)},t.insertNextCell=n=>{const i=t.getNumberOfCells();return t.insertNextTuples([n.length,...n]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(n.length),i}}function NQ(t){return{empty:!0,numberOfComponents:1,dataType:Ht.UNSIGNED_INT,...t}}function FP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Lt.extend(t,e,NQ(r)),AQ(t,e)}const kQ=K.newInstance(FP,"vtkCellArray");var Kf={newInstance:kQ,extend:FP,...LQ};function VQ(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=K.newTypedArray(r.getDataType(),3*e.pointsIds.length));const o=r.getData();e.pointsIds.forEach((a,s)=>{let c=3*a,l=3*s;i[l]=o[c],i[++l]=o[++c],i[++l]=o[++c]}),e.points.setData(i)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let i=r.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const r=e.points.getNumberOfPoints(),n=[];if(r){e.points.getPoint(0,n),e.bounds[0]=n[0],e.bounds[1]=n[0],e.bounds[2]=n[1],e.bounds[3]=n[1],e.bounds[4]=n[2],e.bounds[5]=n[2];for(let i=1;i<r;i++)e.points.getPoint(i,n),e.bounds[0]=n[0]<e.bounds[0]?n[0]:e.bounds[0],e.bounds[1]=n[0]>e.bounds[1]?n[0]:e.bounds[1],e.bounds[2]=n[1]<e.bounds[2]?n[1]:e.bounds[2],e.bounds[3]=n[1]>e.bounds[3]?n[1]:e.bounds[3],e.bounds[4]=n[2]<e.bounds[4]?n[2]:e.bounds[4],e.bounds[5]=n[2]>e.bounds[5]?n[2]:e.bounds[5]}else Jd(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let r=0,n=0;for(let i=0;i<3;i++)n=e.bounds[2*i+1]-e.bounds[2*i],r+=n*n;return r},t.getParametricDistance=r=>{let n,i=0;for(let o=0;o<3;o++)r[o]<0?n=-r[o]:r[o]>1?n=r[o]-1:n=0,n>i&&(i=n);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,i,o,a,s,c)=>{},t.evaluatePosition=(r,n,i,o,a,s)=>{K.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const FQ={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function UP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FQ,r),K.obj(t,e),e.points||(e.points=gp.newInstance()),K.get(t,e,["points","pointsIds"]),VQ(t,e)}const UQ=K.newInstance(UP,"vtkCell");var _v={newInstance:UQ,extend:UP};function BQ(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function GQ(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{const n=r.getPoints().getNumberOfPoints(),i=r.getNumberOfCells(),o=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a){const{cellPointIds:s}=r.getCellPoints(a);s.forEach(c=>{t.insertCellReference(c,o[c]++,a)})}}else{for(let a=0;a<i;a++)_v.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(n),e.maxId=n-1;for(let a=0;a<i;++a)_v.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,o[c]++,a)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(i=>i!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{BQ(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,i)=>{e.array[r].cells[n]=i}}const WQ={array:null,maxId:0,extend:0};function BP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WQ,r),K.obj(t,e),GQ(t,e)}const zQ=K.newInstance(BP,"vtkCellLinks");var $Q={newInstance:zQ,extend:BP};const Qn={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},dC=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function jQ(t){return t<dC.length?dC[t]:"UnknownClass"}function HQ(t){return dC.findIndex(t)}function KQ(t){return t<Qn.VTK_QUADRATIC_EDGE||t===Qn.VTK_CONVEX_POINT_SET||t===Qn.VTK_POLYHEDRON}function qQ(t){return t===Qn.VTK_TRIANGLE_STRIP||t===Qn.VTK_POLY_LINE||t===Qn.VTK_POLY_VERTEX}const XQ={getClassNameFromTypeId:jQ,getTypeIdFromClassName:HQ,isLinear:KQ,hasSubCells:qQ};function YQ(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,i)=>{e.typeArray[r]=n,e.locationArray[r]=i,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,i)=>{e.size=r,e.typeArray=n,e.locationArray=i,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=Qn.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{const n=t.getNumberOfTypes();for(let i=0;i<n;++i)if(r===t.getCellType(i))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}const JQ={size:0,maxId:-1,extend:1e3};function GP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JQ,r),K.obj(t,e),K.get(t,e,["size","maxId","extend"]),K.getArray(t,e,["typeArray","locationArray"]),YQ(t,e)}const ZQ=K.newInstance(GP,"vtkCellTypes");var QQ={newInstance:ZQ,extend:GP,...XQ};const eee={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var WP={IntersectionState:eee};const{IntersectionState:y2}=WP;function G0(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},o=[];let a;o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2];const s=o[0]*(t[0]-e[0])+o[1]*(t[1]-e[1])+o[2]*(t[2]-e[2]),c=qt(o,o);let l=1e-5*s;return c!==0&&(i.t=s/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?a=e:i.t>1?a=r:(a=o,o[0]=e[0]+i.t*o[0],o[1]=e[1]+i.t*o[1],o[2]=e[2]+i.t*o[2]),n&&(n[0]=a[0],n[1]=a[1],n[2]=a[2]),i.distance=Ms(a,t),i}function zP(t,e,r,n,i,o){const a=[],s=[],c=[];i[0]=0,o[0]=0,Lc(e,t,a),Lc(n,r,s),Lc(r,t,c);const l=[qt(a,a),-qt(a,s),-qt(a,s),qt(s,s)],f=[];if(f[0]=qt(a,c),f[1]=-qt(s,c),XO(l,f,2)===0){let u=Number.MAX_VALUE;const d=[t,e,r,n],h=[r,r,t,t],g=[n,n,e,e];o[0],o[0],i[0],i[0],i[0],i[0],o[0],o[0];let p;for(let v=0;v<4;v++)p=G0(d[v],h[v],g[v]),p.distance<u&&(u=p.distance);return y2.ON_LINE}return i[0]=f[0],o[0]=f[1],i[0]>=0&&i[0]<=1&&o[0]>=0&&o[0]<=1?y2.YES_INTERSECTION:y2.NO_INTERSECTION}const tee={distanceToLine:G0,intersection:zP};function nee(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,i,o,a,s)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};s[1]=0,s[2]=0;const l=[],f=[],u=[];e.points.getPoint(0,f),e.points.getPoint(1,u);const d=[],h=[],g=zP(n,i,f,u,d,h);if(c.t=d[0],c.betweenPoints=r(c.t),s[0]=h[0],g===y2.YES_INTERSECTION){for(let p=0;p<3;p++)a[p]=f[p]+s[0]*(u[p]-f[p]),l[p]=n[p]+c.t*(i[p]-n[p]);if(Ms(a,l)<=o*o)return c.intersect=1,c}else{let p;if(c.t<0)return p=G0(n,f,u,a),p.distance<=o*o&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=G0(i,f,u,a),p.distance<=o*o&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(s[0]<0)return s[0]=0,p=G0(f,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c;if(s[0]>1)return s[0]=1,p=G0(u,n,i,a),c.t=p.t,p.distance<=o*o&&(c.intersect=1),c}return c},t.evaluateLocation=(n,i,o)=>{const a=[],s=[];e.points.getPoint(0,a),e.points.getPoint(1,s);for(let c=0;c<3;c++)i[c]=a[c]+n[0]*(s[c]-a[c]);o[0]=1-n[0],o[1]=n[0]},t.evaluateOrientation=(n,i,o)=>e.orientations?(g2(i,e.orientations[0],e.orientations[1],n[0]),o[0]=1-n[0],o[1]=n[0],!0):!1}const ree={orientations:null};function $P(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ree,r),_v.extend(t,e,r),K.setGet(t,e,["orientations"]),nee(t,e)}const iee=K.newInstance($P,"vtkLine");var sa={newInstance:iee,extend:$P,...tee,...WP};function oee(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Qa(e.points):e.points=gp.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const r=t.shallowCopy;t.shallowCopy=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,i),e.points=gp.newInstance(),e.points.shallowCopy(n.getPoints())}}const aee={};function jP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aee,r),Qd.extend(t,e,r),K.setGet(t,e,["points"]),oee(t,e)}const see=K.newInstance(jP,"vtkPointSet");var cee={newInstance:see,extend:jP};function a_(t,e,r,n){const i=r[0]-e[0],o=r[1]-e[1],a=r[2]-e[2],s=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];n[0]=o*l-a*c,n[1]=a*s-i*l,n[2]=i*c-o*s}function Ev(t,e,r,n){a_(t,e,r,n);const i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);i!==0&&(n[0]/=i,n[1]/=i,n[2]/=i)}function lee(t,e,r,n,i,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,s=!1;const c=[],l=[],f=[],u=[],d=[];Ev(t,e,r,u),Ev(n,i,o,d);const h=-qt(u,t),g=-qt(d,n),p=[qt(d,t)+g,qt(d,e)+g,qt(d,r)+g];if(p[0]*p[1]>a&&p[0]*p[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const v=[qt(u,n)+h,qt(u,i)+h,qt(u,o)+h];if(v[0]*v[1]>a&&v[0]*v[2]>a)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Math.abs(u[0]-d[0])<1e-9&&Math.abs(u[1]-d[1])<1e-9&&Math.abs(u[2]-d[2])<1e-9&&Math.abs(h-g)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};const w=[t,e,r],m=[n,i,o],y=qt(u,d),x=(h-g*y)/(y*y-1),C=(g-h*y)/(y*y-1),S=[x*u[0]+C*d[0],x*u[1]+C*d[1],x*u[2]+C*d[2]],T=$s(u,d,[]);Hf(T);let _=0,E=0;const D=[],b=[];let I=50,R=50;for(let k=0;k<3;k++){const z=k,A=(k+1)%3,L=Yi.intersectWithLine(w[z],w[A],n,d);L.intersection&&L.t>0-a&&L.t<1+a&&(L.t<1+a&&L.t>1-a&&(I=_),D[_++]=qt(L.x,T)-qt(S,T));const N=Yi.intersectWithLine(m[z],m[A],t,u);N.intersection&&N.t>0-a&&N.t<1+a&&(N.t<1+a&&N.t>1-a&&(R=E),b[E++]=qt(N.x,T)-qt(S,T))}if(_>2){_--;const k=D[2];D[2]=D[I],D[I]=k}if(E>2){E--;const k=b[2];b[2]=b[R],b[R]=k}if(_!==2||E!==2)return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(b[0])||Number.isNaN(b[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f};if(D[0]>D[1]){const k=D[1];D[1]=D[0],D[0]=k}if(b[0]>b[1]){const k=b[1];b[1]=b[0],b[0]=k}let M,P;return D[1]<b[0]||b[1]<D[0]?{intersect:!1,coplanar:s,pt1:c,pt2:l,surfaceId:f}:(D[0]<b[0]?D[1]<b[1]?(f[0]=2,f[1]=1,M=b[0],P=D[1]):(f[0]=2,f[1]=2,M=b[0],P=b[1]):D[1]<b[1]?(f[0]=1,f[1]=1,M=D[0],P=D[1]):(f[0]=1,f[1]=2,M=D[0],P=b[1]),Kx(S,T,M,c),Kx(S,T,P,l),{intersect:!0,coplanar:s,pt1:c,pt2:l,surfaceId:f})}const uee={computeNormalDirection:a_,computeNormal:Ev,intersectWithTriangle:lee};function fee(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,i,o,a)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};a[2]=0;const c=[],l=i*i,f=[],u=[],d=[];e.points.getPoint(0,f),e.points.getPoint(1,u),e.points.getPoint(2,d);const h=[],g=[];if(Ev(f,u,d,h),h[0]!==0||h[1]!==0||h[2]!==0){const y=Yi.intersectWithLine(r,n,f,h);if(s.betweenPoints=y.betweenPoints,s.t=y.t,o[0]=y.x[0],o[1]=y.x[1],o[2]=y.x[2],!y.intersection)return a[0]=0,a[1]=0,s.intersect=0,s;const x=t.evaluatePosition(o,c,a,g);if(x.evaluation>=0)return x.dist2<=l?(s.intersect=1,s):(s.intersect=x.evaluation,s)}const p=Ms(f,u),v=Ms(u,d),w=Ms(d,f);e.line||(e.line=sa.newInstance()),p>v&&p>w?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,u)):v>w&&v>p?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,d)):(e.line.getPoints().setPoint(0,d),e.line.getPoints().setPoint(1,f));const m=e.line.intersectWithLine(r,n,i,o,a);if(s.betweenPoints=m.betweenPoints,s.t=m.t,m.intersect){const y=[],x=[],C=[];for(let S=0;S<3;S++)y[S]=f[S]-d[S],x[S]=u[S]-d[S],C[S]=o[S]-d[S];return a[0]=qt(C,y)/w,a[1]=qt(C,x)/v,s.intersect=1,s}return a[0]=0,a[1]=0,s.intersect=0,s},t.evaluatePosition=(r,n,i,o)=>{const a={subId:0,dist2:0,evaluation:-1};let s,c;const l=[],f=[],u=[],d=[];let h;const g=[],p=[],v=[];let w=0,m=0;const y=[];let x,C,S,T=[];const _=[],E=[],D=[];a.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,f),e.points.getPoint(0,u),a_(l,f,u,d),Yi.generalizedProjectPoint(r,l,d,D);let b=0;for(s=0;s<3;s++)d[s]<0?h=-d[s]:h=d[s],h>b&&(b=h,m=s);for(c=0,s=0;s<3;s++)s!==m&&(y[c++]=s);for(s=0;s<2;s++)g[s]=D[y[s]]-u[y[s]],p[s]=l[y[s]]-u[y[s]],v[s]=f[y[s]]-u[y[s]];if(w=Er(p,v),w===0)return i[0]=0,i[1]=0,a.evaluation=-1,a;if(i[0]=Er(g,v)/w,i[1]=Er(p,g)/w,o[0]=1-(i[0]+i[1]),o[1]=i[0],o[2]=i[1],o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&o[2]>=0&&o[2]<=1)n&&(a.dist2=Ms(D,r),n[0]=D[0],n[1]=D[1],n[2]=D[2]),a.evaluation=1;else{let I;if(n){if(o[1]<0&&o[2]<0)for(x=Ms(r,u),C=sa.distanceToLine(r,l,u,I,_),S=sa.distanceToLine(r,u,f,I,E),x<C?(a.dist2=x,T=u):(a.dist2=C,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[2]<0&&o[0]<0)for(x=Ms(r,l),C=sa.distanceToLine(r,l,u,I,_),S=sa.distanceToLine(r,l,f,I,E),x<C?(a.dist2=x,T=l):(a.dist2=C,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[1]<0&&o[0]<0)for(x=Ms(r,f),C=sa.distanceToLine(r,f,u,I,_),S=sa.distanceToLine(r,l,f,I,E),x<C?(a.dist2=x,T=f):(a.dist2=C,T=_),S<a.dist2&&(a.dist2=S,T=E),s=0;s<3;s++)n[s]=T[s];else if(o[0]<0){const R=sa.distanceToLine(r,l,f,n);a.dist2=R.distance}else if(o[1]<0){const R=sa.distanceToLine(r,f,u,n);a.dist2=R.distance}else if(o[2]<0){const R=sa.distanceToLine(r,l,u,n);a.dist2=R.distance}}a.evaluation=0}return a},t.evaluateLocation=(r,n,i)=>{const o=[],a=[],s=[];e.points.getPoint(0,o),e.points.getPoint(1,a),e.points.getPoint(2,s);const c=1-r[0]-r[1];for(let l=0;l<3;l++)n[l]=o[l]*c+a[l]*r[0]+s[l]*r[1];i[0]=c,i[1]=r[0],i[2]=r[1]},t.getParametricDistance=r=>{let n,i=0;const o=[];o[0]=r[0],o[1]=r[1],o[2]=1-r[0]-r[1];for(let a=0;a<3;a++)o[a]<0?n=-o[a]:o[a]>1?n=o[a]-1:n=0,n>i&&(i=n);return i}}const dee={};function HP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dee,r),_v.extend(t,e,r),fee(t,e)}const hee=K.newInstance(HP,"vtkTriangle");var gee={newInstance:hee,extend:HP,...uee};const Lw=["verts","lines","polys","strips"],{vtkWarningMacro:E6}=K,pee={[Qn.VTK_LINE]:sa,[Qn.VTK_POLY_LINE]:sa,[Qn.VTK_TRIANGLE]:gee};function mee(t,e){e.classHierarchy.push("vtkPolyData");function r(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,o=>o.toUpperCase()).replace(/\s+/g,"")}Lw.forEach(i=>{t[`getNumberOf${r(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=Qa(e[i]):e[i]=Kf.newInstance()}),t.getNumberOfCells=()=>Lw.reduce((i,o)=>i+e[o].getNumberOfCells(),0);const n=t.shallowCopy;t.shallowCopy=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(i,o),Lw.forEach(a=>{e[a]=Kf.newInstance(),e[a].shallowCopy(i.getReferenceByName(a))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),o=t.getNumberOfLines(),a=t.getNumberOfPolys(),s=t.getNumberOfStrips(),c=i+o+a+s,l=new Uint8Array(c);let f=l;const u=new Uint32Array(c);let d=u;if(i){let h=0;e.verts.getCellSizes().forEach((g,p)=>{d[p]=h,f[p]=g>1?Qn.VTK_POLY_VERTEX:Qn.VTK_VERTEX,h+=g+1}),d=d.subarray(i),f=f.subarray(i)}if(o){let h=0;e.lines.getCellSizes().forEach((g,p)=>{d[p]=h,f[p]=g>2?Qn.VTK_POLY_LINE:Qn.VTK_LINE,g===1&&E6("Building VTK_LINE ",p," with only one point, but VTK_LINE needs at least two points. Check the input."),h+=g+1}),d=d.subarray(o),f=f.subarray(o)}if(a){let h=0;e.polys.getCellSizes().forEach((g,p)=>{switch(d[p]=h,g){case 3:f[p]=Qn.VTK_TRIANGLE;break;case 4:f[p]=Qn.VTK_QUAD;break;default:f[p]=Qn.VTK_POLYGON;break}g<3&&E6("Building VTK_TRIANGLE ",p," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=g+1}),d+=d.subarray(a),f+=f.subarray(a)}if(s){let h=0;f.fill(Qn.VTK_TRIANGLE_STRIP,0,s),e.strips.getCellSizes().forEach((g,p)=>{d[p]=h,h+=g+1})}e.cells=QQ.newInstance(),e.cells.setCellTypes(c,l,u)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=$Q.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const o=t.getCellType(i);let a=null;switch(o){case Qn.VTK_VERTEX:case Qn.VTK_POLY_VERTEX:a=e.verts;break;case Qn.VTK_LINE:case Qn.VTK_POLY_LINE:a=e.lines;break;case Qn.VTK_TRIANGLE:case Qn.VTK_QUAD:case Qn.VTK_POLYGON:a=e.polys;break;case Qn.VTK_TRIANGLE_STRIP:a=e.strips;break;default:return a=null,{type:0,cellPointIds:null}}const s=e.cells.getCellLocation(i),c=a.getCell(s);return{cellType:o,cellPointIds:c}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,o,a)=>{const s=e.links.getLink(o),c=e.links.getLink(a);return s.cells.filter(l=>l!==i&&c.cells.indexOf(l)!==-1)},t.getCell=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=t.getCellPoints(i),s=o||pee[a.cellType].newInstance();return s.initialize(t.getPoints(),a.cellPointIds),s}}const vee={};function KP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vee,r),cee.extend(t,e,r),K.get(t,e,["cells","links"]),K.setGet(t,e,["verts","lines","polys","strips"]),mee(t,e)}const yee=K.newInstance(KP,"vtkPolyData");var Qr={newInstance:yee,extend:KP};const wee=1e-6;function xee(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((i,o)=>i+n[o]),t.modified()},t.getOrientationWXYZ=()=>{const n=hu();tC(n,e.rotation);const i=new Float64Array(3),o=bq(i,n);return[uv(o),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return tC(n,e.rotation)},t.rotateX=n=>{n!==0&&(MT(e.rotation,e.rotation,Tr(n)),t.modified())},t.rotateY=n=>{n!==0&&(RT(e.rotation,e.rotation,Tr(n)),t.modified())},t.rotateZ=n=>{n!==0&&(PT(e.rotation,e.rotation,Tr(n)),t.modified())},t.rotateWXYZ=(n,i,o,a)=>{if(n===0||i===0&&o===0&&a===0)return;const s=Tr(n),c=hu();Ky(c,[i,o,a],s);const l=new Float64Array(16);gv(l,c),rn(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-wee)return;const i=gv(new Float64Array(16),n);rn(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(n,i,o)=>n===e.orientation[0]&&i===e.orientation[1]&&o===e.orientation[2]?!1:(e.orientation=[n,i,o],yt(e.rotation),t.rotateZ(o),t.rotateX(n),t.rotateY(i),t.modified(),!0),t.setUserMatrix=n=>e1(e.userMatrix,n)?!1:(sr(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){yt(e.matrix),e.userMatrix&&rn(e.matrix,e.matrix,e.userMatrix),Wn(e.matrix,e.matrix,e.origin),Wn(e.matrix,e.matrix,e.position),rn(e.matrix,e.matrix,e.rotation),Wc(e.matrix,e.matrix,e.scale),Wn(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),Yt(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let i=0;i<4;++i)(n===i?1:0)!==e.matrix[n+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>Nn.getCenter(e.bounds),t.getLength=()=>Nn.getLength(e.bounds),t.getXRange=()=>Nn.getXRange(e.bounds),t.getYRange=()=>Nn.getYRange(e.bounds),t.getZRange=()=>Nn.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r)}const Cee={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function qP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cee,r),r1.extend(t,e,r),e.matrixMTime={},K.obj(e.matrixMTime),K.get(t,e,["bounds","isIdentity"]),K.getArray(t,e,["orientation"]),K.setGetArray(t,e,["origin","position","scale"],3),e.matrix=yt(new Float64Array(16)),e.rotation=yt(new Float64Array(16)),e.userMatrix=yt(new Float64Array(16)),e.transform=null,xee(t,e)}const See=K.newInstance(qP,"vtkProp3D");var s_={newInstance:See,extend:qP};const{vtkDebugMacro:Tee}=K;function _ee(t,e){e.classHierarchy.push("vtkActor");const r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=Zd.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;if(!e.mapperBounds||n[0]!==e.mapperBounds[0]||n[1]!==e.mapperBounds[1]||n[2]!==e.mapperBounds[2]||n[3]!==e.mapperBounds[3]||n[4]!==e.mapperBounds[4]||n[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){Tee("Recomputing bounds..."),e.mapperBounds=n.concat();const i=[];Nn.getCorners(n,i),t.computeMatrix();const o=new Float64Array(16);Yt(o,e.matrix),i.forEach(a=>Pt(a,a,o)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((a,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,a):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,a)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=r.getMTime();if(e.property!==null){const i=e.property.getMTime();n=i>n?i:n}if(e.backfaceProperty!==null){const i=e.backfaceProperty.getMTime();n=i>n?i:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let i=e.mapper.getMTime();n=i>n?i:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),i=e.mapper.getInput().getMTime(),n=i>n?i:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,i)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,i)}}const Eee={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function XP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eee,r),s_.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.set(t,e,["property"]),K.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),_ee(t,e)}const Dee=K.newInstance(XP,"vtkActor");var qs={newInstance:Dee,extend:XP};function bee(t,e){const r=t.invokeResize;delete t.invokeResize,e.renderWindow=Rj.newInstance(),e.rendererMap={},e.openGLRenderWindow=tQ.newInstance(),e.renderWindow.addView(e.openGLRenderWindow),e.interactor=bQ.newInstance(),e.interactor.setView(e.openGLRenderWindow),e.interactor.initialize(),t.addRenderer=({viewport:n,id:i,background:o})=>{const a=PP.newInstance({viewport:n,background:o||e.background});e.renderWindow.addRenderer(a),e.rendererMap[i]=a},t.destroy=()=>{e.renderWindow.getInteractor().delete()},t.removeRenderer=n=>{const i=t.getRenderer(n);e.renderWindow.removeRenderer(i),i.delete(),delete e.rendererMap[n]},t.getRenderer=n=>e.rendererMap[n],t.getRenderers=()=>{const{rendererMap:n}=e;return Object.keys(n).map(o=>({id:o,renderer:n[o]}))},t.resize=()=>{if(e.container){const{width:n,height:i}=e.container;e.openGLRenderWindow.setSize(Math.floor(n),Math.floor(i)),r(),e.renderWindow.render()}},t.setContainer=n=>{e.container=n,e.openGLRenderWindow.setContainer(e.container)},t.delete=K.chain(t.setContainer,t.destroy,e.openGLRenderWindow.delete,t.delete),t.resize()}const Iee={background:[0,0,0],container:null};function YP(t,e,r={}){Object.assign(e,Iee,r),K.obj(t,e),K.get(t,e,["renderWindow","openGLRenderWindow","interactor","container"]),K.event(t,e,"resize"),bee(t,e)}const Oee=K.newInstance(YP),Mee={newInstance:Oee,extend:YP},{vtkErrorMacro:om}=K;function Ree(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let r,n=0,i=0;e.nodes.length>0&&(n=e.nodes[0].y);for(let o=1;o<e.nodes.length;o++){if(r=e.nodes[o].y,r!==n)if(r>n)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(n=r,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const r=e.nodes.length;if(e.function=null,r>0){e.function=[];for(let n=0;n<r;n++)e.function[2*n]=e.nodes[n].x,e.function[2*n+1]=e.nodes[n].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let r=1,n=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){r=0;break}return r?n=Number.MAX_VALUE:i>0?n=e.nodes[i-1].x:e.clamping?n=-Number.MAX_VALUE:n=e.nodes[0].x,n},t.getNodeValue=(r,n)=>{const i=e.nodes.length;return r<0||r>=i?(om("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].y,n[2]=e.nodes[r].midpoint,n[3]=e.nodes[r].sharpness,1)},t.setNodeValue=(r,n)=>{const i=e.nodes.length;if(r<0||r>=i)return om("Index out of range!"),-1;const o=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].y=n[1],e.nodes[r].midpoint=n[2],e.nodes[r].sharpness=n[3],o!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(r,n)=>t.addPointLong(r,n,.5,0),t.addPointLong=(r,n,i,o)=>{if(i<0||i>1)return om("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return om("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const a={x:r,y:n,midpoint:i,sharpness:o};e.nodes.push(a),t.sortAndUpdateRange();let s;for(s=0;s<e.nodes.length&&e.nodes[s].x!==r;s++);return s<e.nodes.length?s:-1},t.setNodes=r=>{e.nodes!==r&&(e.nodes=r,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((n,i)=>n.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const r=e.range.slice(),n=e.nodes.length;return n?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[n-1].x):(e.range[0]=0,e.range[1]=0),r[0]===e.range[0]&&r[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n;for(n=0;n<e.nodes.length&&e.nodes[n].x!==r;n++);if(n>=e.nodes.length)return-1;const i=n;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(r,n,i,o)=>{t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=r&&e.nodes[a].x<=i?e.nodes.splice(a,1):a++;t.addPoint(r,n,.5,0),t.addPoint(i,o,.5,0)},t.getValue=r=>{const n=[];return t.getTable(r,r,1,n),n[0]},t.adjustRange=r=>{if(r.length<2)return 0;const n=t.getRange();n[0]<r[0]?t.addPoint(r[0],t.getValue(r[0])):t.addPoint(r[0],t.getValue(n[0])),n[1]>r[1]?t.addPoint(r[1],t.getValue(r[1])):t.addPoint(r[1],t.getValue(n[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=r[0]&&e.nodes[i].x<=r[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{const r=e.nodes.length;if(r<2)return-1;let n=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<r-1;i++){const o=e.nodes[i+1].x-e.nodes[i].x;o<n&&(n=o)}return n},t.getTable=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,s,c=0;const l=e.nodes.length;let f=0;l!==0&&(f=e.nodes[l-1].y);let u=0,d=0,h=0,g=0,p=0,v=0,w=0;for(s=0;s<i;s++){const m=a*s;for(i>1?u=r+s/(i-1)*(n-r):u=.5*(r+n);c<l&&u>e.nodes[c].x;)c++,c<l&&(d=e.nodes[c-1].x,h=e.nodes[c].x,g=e.nodes[c-1].y,p=e.nodes[c].y,v=e.nodes[c-1].midpoint,w=e.nodes[c-1].sharpness,v<1e-5&&(v=1e-5),v>.99999&&(v=.99999));if(c>=l)o[m]=e.clamping?f:0;else if(c===0)o[m]=e.clamping?e.nodes[0].y:0;else{let y=(u-d)/(h-d);if(y<v?y=.5*y/v:y=.5+.5*(y-v)/(1-v),w>.99)if(y<.5){o[m]=g;continue}else{o[m]=p;continue}if(w<.01){o[m]=(1-y)*g+y*p;continue}y<.5?y=.5*(y*2)**(1+10*w):y>.5&&(y=1-.5*((1-y)*2)**(1+10*w));const x=y*y,C=x*y,S=2*C-3*x+1,T=-2*C+3*x,_=C-2*x+y,E=C-x,D=p-g,b=(1-w)*D;o[m]=S*g+T*p+_*b+E*b;const I=g<p?g:p,R=g>p?g:p;o[m]=o[m]<I?I:o[m],o[m]=o[m]>R?R:o[m]}}}}const Pee={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function JP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pee,r),K.obj(t,e),e.nodes=[],K.setGet(t,e,["allowDuplicateScalars","clamping"]),K.setArray(t,e,["range"],2),K.getArray(t,e,["range"]),Ree(t,e)}const Lee=K.newInstance(JP,"vtkPiecewiseFunction");var Rd={newInstance:Lee,extend:JP};const{BlendMode:Rl,FilterMode:ag}=HI;function Aee(t,e,r,n,i){let o=null;return i?(o=i,o.removeAllPoints()):o=Rd.newInstance(),o.addPointLong(-1024,0,1,1),o.addPoint(t,e),o.addPoint(r,n),o}const Nee={createRadonTransferFunction:Aee};function kee(t,e){e.classHierarchy.push("vtkVolumeMapper");const r={...t};t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=fu(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(Rl.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(Rl.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(Rl.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(Rl.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(Rl.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(Rl.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>K.enumToString(Rl,e.blendMode),t.setAverageIPScalarRange=(n,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(n,i)},t.getFilterModeAsString=()=>K.enumToString(ag,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(ag.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(ag.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(ag.RAW)},t.setGlobalIlluminationReach=n=>r.setGlobalIlluminationReach(es(n,0,1)),t.setVolumetricScatteringBlending=n=>r.setVolumetricScatteringBlending(es(n,0,1)),t.setVolumeShadowSamplingDistFactor=n=>r.setVolumeShadowSamplingDistFactor(n>=1?n:1),t.setAnisotropy=n=>r.setAnisotropy(es(n,-.99,.99)),t.setLAOKernelSize=n=>r.setLAOKernelSize(CT(es(n,1,32))),t.setLAOKernelRadius=n=>r.setLAOKernelRadius(n>=1?n:1)}const Vee={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:Rl.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:ag.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function ZP(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vee,r),JT.extend(t,e,r),K.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),K.setGetArray(t,e,["ipScalarRange"],2),K.event(t,e,"lightingActivated"),kee(t,e)}const Fee=K.newInstance(ZP,"vtkVolumeMapper");var QP={newInstance:Fee,extend:ZP,...Nee};function Uee(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const r=t.delete;t.delete=()=>{e.scalarTexture=null,r()}}const Bee={scalarTexture:null};function eL(t,e,r={}){Object.assign(e,Bee,r),QP.extend(t,e,r),K.setGet(t,e,["scalarTexture"]),Uee(t,e)}const Gee=K.newInstance(eL,"vtkSharedVolumeMapper"),Wee={newInstance:Gee,extend:eL};function wr(t){const e=t.indexOf(":");return t.substring(e+1)}const zee=1073741824;class $ee{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*zee,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const r=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(r)}this._maxCacheSize=e},this.isCacheable=e=>{const r=this.getBytesAvailable(),n=Array.from(this._imageCache.values()).reduce((o,a)=>a.sharedCacheKey?o:o+a.sizeInBytes,0);return r+n>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,r=!1)=>{const n=this._imageCache.get(e);if(!n)return;if(n.sharedCacheKey&&!r)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=n;i!=null&&i.cancelFn&&i.cancelFn(),i!=null&&i.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const r=this._volumeCache.get(e);if(!r)return;const{volumeLoadObject:n,volume:i}=r;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),n.cancelFn&&n.cancelFn(),i.imageIds&&i.imageIds.forEach(o=>{const a=this._imageCache.get(o);a&&a.sharedCacheKey===e&&(a.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:r,done:n}=e.next();if(n)break;this.removeImageLoadObject(r,{force:!0}),Qe(We,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:r})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:r,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(r),Qe(We,$e.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:r})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(r)return r.timeStamp=Date.now(),r.volumeLoadObject},this.putGeometryLoadObject=(e,r)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(r.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const n={loaded:!1,geometryId:e,geometryLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),r.promise.then(i=>{try{this._putGeometryCommon(e,i,n)}catch(o){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,o),o}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(!r)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(r.sizeInBytes);const n={geometry:r,geometryId:e};Qe(We,$e.GEOMETRY_CACHE_GEOMETRY_REMOVED,n),this._decacheGeometry(e)},this._decacheGeometry=e=>{const r=this._geometryCache.get(e);if(!r)return;const{geometryLoadObject:n}=r;n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImage=(e,r=_o.FAR_REPLICATE)=>{var i;if(e===void 0)throw new Error("getImage: imageId must not be undefined");const n=this._imageCache.get(e);if(n&&(n.timeStamp=Date.now(),!(((i=n.image)==null?void 0:i.imageQualityStatus)<r)))return n.image},this.getVolume=(e,r=!1)=>{var i;if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const n=this._volumeCache.get(e);return n?(n.timeStamp=Date.now(),n.volume):r?(i=[...this._volumeCache.values()].find(o=>o.volumeId.includes(e)))==null?void 0:i.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(r=>r.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(n=>n.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:r=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(!n)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,r),this.incrementImageCacheSize(-n.sizeInBytes);const i={image:n,imageId:e};Qe(We,$e.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const r=this._volumeCache.get(e);if(!r)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const n={volume:r,volumeId:e};Qe(We,$e.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const r=this._geometryCache.get(e);if(r)return r.timeStamp=Date.now(),r.geometryLoadObject}}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,r){let n=this.getBytesAvailable();if(n>=e)return n;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function o(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(o);const a=i.map(c=>c.imageId);let s=a;r&&(s=a.filter(c=>!r.includes(c)));for(const c of s)if(this.removeImageLoadObject(c),Qe(We,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n;for(const c of a)if(this.removeImageLoadObject(c),Qe(We,$e.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),n=this.getBytesAvailable(),n>=e)return n}_putImageCommon(e,r,n){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!r){console.warn("Image is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error($e.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.image=r,n.sizeInBytes=r.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const i={image:n};Qe(We,$e.IMAGE_CACHE_IMAGE_ADDED,i),n.sharedCacheKey=r.sharedCacheKey}async putImageLoadObject(e,r){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(r.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const n=this._imageCache.get(e);if(n!=null&&n.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(r.cancelFn&&typeof r.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...n,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),this._imageCache.set(e,i),r.promise.then(o=>{try{this._putImageCommon(e,o,i)}catch(a){throw console.debug(`Error in _putImageCommon for image ${e}:`,a),a}}).catch(o=>{throw console.debug(`Error caching image ${e}:`,o),this._imageCache.delete(e),o})}putImageSync(e,r){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,n);try{this._putImageCommon(e,r,n)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(r)return r.timeStamp=Date.now(),r.imageLoadObject}isLoaded(e){const r=this._imageCache.get(e);return r?r.loaded:!1}getVolumeContainingImageId(e){const r=Array.from(this._volumeCache.keys()),n=wr(e);for(const i of r){const o=this._volumeCache.get(i);if(!o)return;const{volume:a}=o;if(!a.imageIds.length)return;const s=a.getImageURIIndex(n);if(s>-1)return{volume:a,imageIdIndex:s}}}getCachedImageBasedOnImageURI(e){const r=wr(e),i=Array.from(this._imageCache.keys()).find(o=>wr(o)===r);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,r,n){var o;if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}n.loaded=!0,n.volume=r,(o=r.imageIds)==null||o.forEach(a=>{const s=this._imageCache.get(a);s&&(s.sharedCacheKey=e)});const i={volume:n};Qe(We,$e.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,r){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const n={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,n);try{this._putVolumeCommon(e,r,n)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,r){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(r.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(r.cancelFn&&typeof r.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:r,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),r.promise.then(i=>{try{this._putVolumeCommon(e,i,n)}catch(o){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,o),this._volumeCache.delete(e),o}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,r,n){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!r){console.warn("Geometry is undefined");return}if(r.sizeInBytes===void 0||Number.isNaN(r.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(r.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(r.sizeInBytes))throw new Error($e.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(r.sizeInBytes),n.loaded=!0,n.geometry=r,n.sizeInBytes=r.sizeInBytes,this.incrementGeometryCacheSize(n.sizeInBytes);const i={geometry:n};Qe(We,$e.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,r){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const n={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(r)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,n);try{this._putGeometryCommon(e,r,n)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,r){const n=this._imageCache.get(e);if(!n){r&&this._imageCache.set(e,{image:r,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}n.loaded&&(n.loaded=!1,n.imageLoadObject=null,this.incrementImageCacheSize(-n.sizeInBytes),n.sizeInBytes=0),n.image=r||n.image}getImageQuality(e){var n;const r=(n=this._imageCache.get(e))==null?void 0:n.image;return r?r.imageQualityStatus||_o.FULL_RESOLUTION:void 0}}const ke=new $ee;function D6(t,e){const r=n_(e),n=new r(t.length);return n.set(t),n}function jee(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const r=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(s,c,l,f,u,d,h)=>{e.inputDataType=u,e.inputNumComps=f,r(s,c,l,f,u,d,h)};const n=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(s,c)=>{const l=n(s,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:s}=e;if(!s)return;const c=ke.getVolume(s);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){a();return}return t.hasUpdatedFrames()&&o()};const i=t.modified;t.setUpdatedFrame=s=>{e.updatedFrames[s]=!0,i()},t.modified=()=>{i();const s=ke.getVolume(e.volumeId);if(!s)return;const c=s.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function o(){const s=ke.getVolume(e.volumeId),c=s.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const f=ke.getImage(c[l]);if(!f)continue;let u=f.voxelManager.getScalarData();const d=e.context;s.dataType!==u.constructor.name&&(u=D6(u,s.dataType));const[h]=t.updateArrayDataTypeForGL(s.dataType,[u]);t.bind();const g=l;d.texSubImage3D(e.target,0,0,0,g,e.width,e.height,1,e.format,e.openGLDataType,h),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function a(){const s=ke.getVolume(e.volumeId),c=s.getCurrentTimePointImageIds();if(!c.length)return!1;let l;for(let f=0;f<c.length;f++){const u=c[f],d=ke.getImage(u);let h;d?(h=d.voxelManager.getScalarData(),l=h.constructor):(l=n_(s.dataType,!0),h=new l(e.width*e.height));const g=e.context;s.dataType!==h.constructor.name&&(h=D6(h,s.dataType));const[p]=t.updateArrayDataTypeForGL(s.dataType,[h]);t.bind();let v=f;g.texSubImage3D(e.target,0,0,0,v,e.width,e.height,1,e.format,e.openGLDataType,p),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(s=>s),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=s=>{e.volumeId=s},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:s,height:c,depth:l,numberOfComponents:f,dataType:u})=>{e.width??(e.width=s),e.height??(e.height=c),e.depth??(e.depth=l),e.inputNumComps??(e.inputNumComps=f),e.inputDataType??(e.inputDataType=u)},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const Hee={updatedFrames:[]};function tL(t,e,r={}){Object.assign(e,Hee,r),rr.extend(t,e,r),jee(t,e)}const Kee=K.newInstance(tL,"vtkStreamingOpenGLTexture"),qee={newInstance:Kee,extend:tL},Xee={isPerformingCoordinateTransformation:!1};function nL(t,e,r={}){Object.assign(e,Xee,r),i_.extend(t,e,r),K.setGet(t,e,["isPerformingCoordinateTransformation"]),Jee(t,e)}const Yee=K.newInstance(nL,"vtkSlabCamera");function Jee(t,e){e.classHierarchy.push("vtkSlabCamera");const r=yt(new Float64Array(16)),n=new Float64Array(3);t.getProjectionMatrix=(i,o,a)=>{const s=ba();if(e.projectionMatrix){const d=1/e.physicalScale;return Dn(n,d,d,d),sr(s,e.projectionMatrix),Wc(s,s,n),Yt(s,s),s}yt(r);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const f=l-c,u=[c+(o+1)*f/2,c+(a+1)*f/2];if(e.parallelProjection){const d=e.parallelScale*i,h=e.parallelScale,g=(e.windowCenter[0]-1)*d,p=(e.windowCenter[0]+1)*d,v=(e.windowCenter[1]-1)*h,w=(e.windowCenter[1]+1)*h;NT(r,g,p,v,w,u[0],u[1]),Yt(r,r)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const d=Math.tan(kt.radiansFromDegrees(e.viewAngle)/2);let h,g;e.useHorizontalViewAngle===!0?(h=c*d,g=c*d/i):(h=c*d*i,g=c*d);const p=(e.windowCenter[0]-1)*h,v=(e.windowCenter[0]+1)*h,w=(e.windowCenter[1]-1)*g,m=(e.windowCenter[1]+1)*g,y=u[0],x=u[1];r[0]=2*y/(v-p),r[5]=2*y/(m-w),r[2]=(p+v)/(v-p),r[6]=(w+m)/(m-w),r[10]=-(y+x)/(x-y),r[14]=-1,r[11]=-2*y*x/(x-y),r[15]=0}}return sr(s,r),s}}const Zee={newInstance:Yee,extend:nL};function Ls(t){return Oo(t,"vtkVolume")||Oo(t,"vtkImageSlice")}function Oo(t,e){return!!("isA"in t?t:t.actor).isA(e)}const Us=[];function th(t,e=0){let r;for(r=0;r<Us.length&&!(Us[r].priority<=e);r++);Us.splice(r,0,{priority:e,provider:t})}function Qee(t){for(let e=0;e<Us.length;e++)if(Us[e].provider===t){Us.splice(e,1);break}}function ete(){for(;Us.length>0;)Us.pop()}function dt(t,...e){for(let r=0;r<Us.length;r++){const n=Us[r].provider(t,...e);if(n!==void 0)return n}}const rL=Object.freeze(Object.defineProperty({__proto__:null,addProvider:th,get:dt,removeAllProviders:ete,removeProvider:Qee},Symbol.toStringTag,{value:"Module"}));function Su(t,e){const{direction:r,spacing:n}=t,i=r.slice(0,3),o=r.slice(3,6),a=r.slice(6,9),s=[gt(i,e),gt(o,e),gt(a,e)],c=Ae();return Dn(c,s[0]*n[0],s[1]*n[1],s[2]*n[2]),fo(c)}function $c(t,e,r){const{direction:n,spacing:i,imageIds:o}=t;if(!o.length)return;const a=n.slice(6,9),s=gt(a,r);if(Math.abs(s)<1-cs)return;const l=Su({direction:n,spacing:i},r)/2;let f;for(let u=0;u<o.length;u++){const d=o[u],{imagePositionPatient:h}=dt("imagePlaneModule",d),g=Ae();bn(g,e,h);const p=gt(g,r);Math.abs(p)<l&&(f=d)}return f}const tte=t=>t,b6=1e-6;let iL=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=yt(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?bK:tte}rotateFromDirections(e,r){const n=new Float64Array(3),i=new Float64Array(3),o=new Float64Array(16);Dn(n,e[0],e[1],e[2]),Dn(i,r[0],r[1],r[2]),kn(n,n),kn(i,i);const a=gt(n,i);return a>=1?this:(xn(this.tmp,n,i),fo(this.tmp)<b6&&(xn(this.tmp,[1,0,0],e),fo(this.tmp)<b6&&xn(this.tmp,[0,1,0],e)),AT(o,Math.acos(a),this.tmp),rn(this.matrix,this.matrix,o),this)}rotate(e,r){return Dn(this.tmp,...r),kn(this.tmp,this.tmp),Ki(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return MT(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return RT(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return PT(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,r,n){return Dn(this.tmp,e,r,n),Wn(this.matrix,this.matrix,this.tmp),this}scale(e,r,n){return Dn(this.tmp,e,r,n),Wc(this.matrix,this.matrix,this.tmp),this}multiply(e){return rn(this.matrix,this.matrix,e),this}multiply3x3(e){return rn(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Or(this.matrix,this.matrix),this}identity(){return yt(this.matrix),this}apply(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(e1(yT,this.matrix))return this;const i=n===-1?e.length:r+n*3;for(let o=r;o<i;o+=3)Dn(this.tmp,e[o],e[o+1],e[o+2]),Pt(this.tmp,this.tmp,this.matrix),e[o]=this.tmp[0],e[o+1]=this.tmp[1],e[o+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&sr(this.matrix,e),this}};function nte(){return new iL(!0)}function rte(){return new iL(!1)}var wi={buildFromDegree:nte,buildFromRadian:rte};function oL(t){const e=t.getMapper().getInputData(),r=e.extentToBounds(e.getExtent());return[[r[0],r[2],r[4]],[r[0],r[2],r[5]],[r[0],r[3],r[4]],[r[0],r[3],r[5]],[r[1],r[2],r[4]],[r[1],r[2],r[5]],[r[1],r[3],r[4]],[r[1],r[3],r[5]]]}const ite=cs*cs,Aw=t=>Math.abs(Math.abs(t)-1)<ite,Nw=(t,e)=>Aw(t[e])||Aw(t[e+1])||Aw(t[e+2]),ote=t=>Nw(t,0)&&Nw(t,3)&&Nw(t,6);function r5(t,e,r){const n=t.getMapper().getInputData();let i;const o=n.getDirection();if(ote(o))i=oL(t);else{const[u,d,h]=n.getDimensions();i=[[0,0,0],[u-1,0,0],[0,d-1,0],[u-1,d-1,0],[0,0,h-1],[u-1,0,h-1],[0,d-1,h-1],[u-1,d-1,h-1]].map(p=>n.indexToWorld(p))}const a=wi.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(u=>a.apply(u));const s=[...r];a.apply(s);const c=s[0];let l=1/0,f=-1/0;for(let u=0;u<8;u++){const d=i[u][0];d>f&&(f=d),d<l&&(l=d)}return{min:l,max:f,current:c,actor:t,viewPlaneNormal:e,focalPoint:r}}function cd(t,e,r,n,i,o){const{min:a,max:s,current:c}=r,l=Ae();bn(l,e,t);const f=Math.round((s-a)/i),d=(c-a)/(s-a)*f;let h=Math.round(d),g=[t[0]-n[0]*d*i,t[1]-n[1]*d*i,t[2]-n[2]*d*i];h+=o,h>f?h=f:h<0&&(h=0);const p=h*i;g=[g[0]+n[0]*p,g[1]+n[1]*p,g[2]+n[2]*p];const v=[g[0]+l[0],g[1]+l[1],g[2]+l[2]];return{newFocalPoint:g,newPosition:v}}const ate={RGB:0,HSV:1,LAB:2,DIVERGING:3},ste={LINEAR:0,LOG10:1};var aL={ColorSpace:ate,Scale:ste};const{ColorSpace:ca,Scale:c_}=aL,{ScalarMappingTarget:am}=Zy,{vtkDebugMacro:cte,vtkErrorMacro:gc,vtkWarningMacro:lte}=K;function I6(t,e){const r=t[0],n=t[1],i=t[2],o=Math.sqrt(r*r+n*n+i*i),a=o>.001?Math.acos(r/o):0,s=a>.001?Math.atan2(i,n):0;e[0]=o,e[1]=a,e[2]=s}function ute(t,e){const r=t[0],n=t[1],i=t[2];e[0]=r*Math.cos(n),e[1]=r*Math.sin(n)*Math.cos(i),e[2]=r*Math.sin(n)*Math.sin(i)}function O6(t,e){if(t[0]>=e-.1)return t[2];const r=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+r:t[2]-r}function fte(t,e){let r=t-e;for(r<0&&(r=-r);r>=2*Math.PI;)r-=2*Math.PI;return r>Math.PI&&(r=2*Math.PI-r),r}function M6(t,e,r,n){const i=[],o=[];Df(e,i),Df(r,o);const a=[],s=[];I6(i,a),I6(o,s);let c=t;if(a[1]>.05&&s[1]>.05&&fte(a[2],s[2])>.33*Math.PI){let u=Math.max(a[0],s[0]);u=Math.max(88,u),t<.5?(s[0]=u,s[1]=0,s[2]=0,c*=2):(a[0]=u,a[1]=0,a[2]=0,c=2*c-1)}a[1]<.05&&s[1]>.05?a[2]=O6(s,a[0]):s[1]<.05&&a[1]>.05&&(s[2]=O6(a,s[0]));const l=[];l[0]=(1-c)*a[0]+c*s[0],l[1]=(1-c)*a[1]+c*s[1],l[2]=(1-c)*a[2]+c*s[2];const f=[];ute(l,f),dv(f,n)}function dte(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(r,n,i,o)=>t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(a<0||a>1)return gc("Midpoint outside range [0.0, 1.0]"),-1;if(s<0||s>1)return gc("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(r);const c={x:r,r:n,g:i,b:o,midpoint:a,sharpness:s};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==r;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(r,n,i,o)=>t.addHSVPointLong(r,n,i,o,.5,0),t.addHSVPointLong=function(r,n,i,o){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return vf([n,i,o],c),t.addRGBPoint(r,c[0],c[1],c[2],a,s)},t.setNodes=r=>{if(e.nodes!==r){const n=JSON.stringify(e.nodes);e.nodes=r;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||n!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const r=JSON.stringify(e.nodes);e.nodes.sort((o,a)=>o.x-a.x);const n=JSON.stringify(e.nodes),i=t.updateRange();return!i&&r!==n?(t.modified(),!0):i},t.updateRange=()=>{const r=[2];r[0]=e.mappingRange[0],r[1]=e.mappingRange[1];const n=e.nodes.length;return n?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[n-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),r[0]===e.mappingRange[0]&&r[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=r=>{let n=0;for(;n<e.nodes.length&&e.nodes[n].x!==r;n++);const i=n;if(n>=e.nodes.length)return-1;let o=!1;return e.nodes.splice(n,1),(n===0||n===e.nodes.length)&&(o=t.updateRange()),o||t.modified(),i},t.movePoint=(r,n)=>{if(r!==n){t.removePoint(n);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===r){e.nodes[i].x=n,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(r,n,i,o,a,s,c,l)=>{t.sortAndUpdateRange();for(let f=0;f<e.nodes.length;)e.nodes[f].x>=r&&e.nodes[f].x<=a?e.nodes.splice(f,1):f++;t.addRGBPointLong(r,n,i,o,.5,0),t.addRGBPointLong(a,s,c,l,.5,0),t.modified()},t.addHSVSegment=(r,n,i,o,a,s,c,l)=>{const f=[n,i,o],u=[s,c,l],d=[],h=[];vf(f,d),vf(u,h),t.addRGBSegment(r,d[0],d[1],d[2],a,h[0],h[1],h[2])},t.mapValue=r=>{const n=[];return t.getColor(r,n),[Math.floor(255*n[0]+.5),Math.floor(255*n[1]+.5),Math.floor(255*n[2]+.5),255]},t.getColor=(r,n)=>{if(e.indexedLookup){const i=t.getSize(),o=t.getAnnotatedValueIndexInternal(r);if(o<0||i===0){const a=t.getNanColorByReference();n[0]=a[0],n[1]=a[1],n[2]=a[2]}else{const a=[];t.getNodeValue(o%i,a),n[0]=a[1],n[1]=a[2],n[2]=a[3]}return}t.getTable(r,r,1,n)},t.getRedValue=r=>{const n=[];return t.getColor(r,n),n[0]},t.getGreenValue=r=>{const n=[];return t.getColor(r,n),n[1]},t.getBlueValue=r=>{const n=[];return t.getColor(r,n),n[2]},t.getTable=(r,n,i,o)=>{const a=Number(r),s=Number(n);if(hv(a)||hv(s)){for(let E=0;E<i;E++)o[E*3+0]=e.nanColor[0],o[E*3+1]=e.nanColor[1],o[E*3+2]=e.nanColor[2];return}let c=0;const l=e.nodes.length;let f=0,u=0,d=0;l!==0&&(f=e.nodes[l-1].r,u=e.nodes[l-1].g,d=e.nodes[l-1].b);let h=0,g=0,p=0;const v=[0,0,0],w=[0,0,0];let m=0,y=0;const x=[];let C=e.scale===c_.LOG10;C&&(C=e.mappingRange[0]>0);let S=0,T=0,_=0;C&&(S=Math.log10(a),T=Math.log10(s));for(let E=0;E<i;E++){const D=3*E;if(i>1?C?(_=S+E/(i-1)*(T-S),h=10**_):h=a+E/(i-1)*(s-a):C?(_=.5*(S+T),h=10**_):h=.5*(a+s),e.discretize){const b=e.mappingRange;if(h>=b[0]&&h<=b[1]){const I=e.numberOfValues,R=b[1]-b[0];if(I<=1)h=b[0]+R/2;else{const M=(h-b[0])/R,P=CT(I*M);h=b[0]+P/(I-1)*R}}}for(;c<l&&h>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,p=e.nodes[c].x,C&&(g=Math.log10(g),p=Math.log10(p)),v[0]=e.nodes[c-1].r,w[0]=e.nodes[c].r,v[1]=e.nodes[c-1].g,w[1]=e.nodes[c].g,v[2]=e.nodes[c-1].b,w[2]=e.nodes[c].b,m=e.nodes[c-1].midpoint,y=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(h>e.mappingRange[1])o[D]=0,o[D+1]=0,o[D+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(o[D]=e.aboveRangeColor[0],o[D+1]=e.aboveRangeColor[1],o[D+2]=e.aboveRangeColor[2]):(o[D]=f,o[D+1]=u,o[D+2]=d));else if(h<e.mappingRange[0]||tM(h)&&h<0)o[D]=0,o[D+1]=0,o[D+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(o[D]=e.belowRangeColor[0],o[D+1]=e.belowRangeColor[1],o[D+2]=e.belowRangeColor[2]):l>0&&(o[D]=e.nodes[0].r,o[D+1]=e.nodes[0].g,o[D+2]=e.nodes[0].b));else if(c===0&&(Math.abs(h-a)<1e-6||e.discretize))l>0?(o[D]=e.nodes[0].r,o[D+1]=e.nodes[0].g,o[D+2]=e.nodes[0].b):(o[D]=0,o[D+1]=0,o[D+2]=0);else{let b=0;if(C?b=(_-g)/(p-g):b=(h-g)/(p-g),b<m?b=.5*b/m:b=.5+.5*(b-m)/(1-m),y>.99)if(b<.5){o[D]=v[0],o[D+1]=v[1],o[D+2]=v[2];continue}else{o[D]=w[0],o[D+1]=w[1],o[D+2]=w[2];continue}if(y<.01){if(e.colorSpace===ca.RGB)o[D]=(1-b)*v[0]+b*w[0],o[D+1]=(1-b)*v[1]+b*w[1],o[D+2]=(1-b)*v[2]+b*w[2];else if(e.colorSpace===ca.HSV){const N=[],H=[];ng(v,N),ng(w,H),e.hSVWrap&&(N[0]-H[0]>.5||H[0]-N[0]>.5)&&(N[0]>H[0]?N[0]-=1:H[0]-=1);const ee=[];ee[0]=(1-b)*N[0]+b*H[0],ee[0]<0&&(ee[0]+=1),ee[1]=(1-b)*N[1]+b*H[1],ee[2]=(1-b)*N[2]+b*H[2],vf(ee,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]}else if(e.colorSpace===ca.LAB){const N=[],H=[];Df(v,N),Df(w,H);const ee=[];ee[0]=(1-b)*N[0]+b*H[0],ee[1]=(1-b)*N[1]+b*H[1],ee[2]=(1-b)*N[2]+b*H[2],dv(ee,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]}else e.colorSpace===ca.DIVERGING?(M6(b,v,w,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]):gc("ColorSpace set to invalid value.",e.colorSpace);continue}b<.5?b=.5*(b*2)**(1+10*y):b>.5&&(b=1-.5*((1-b)*2)**(1+10*y));const I=b*b,R=I*b,M=2*R-3*I+1,P=-2*R+3*I,k=R-2*I+b,z=R-I;let A,L;if(e.colorSpace===ca.RGB)for(let N=0;N<3;N++)A=w[N]-v[N],L=(1-y)*A,o[D+N]=M*v[N]+P*w[N]+k*L+z*L;else if(e.colorSpace===ca.HSV){const N=[],H=[];ng(v,N),ng(w,H),e.hSVWrap&&(N[0]-H[0]>.5||H[0]-N[0]>.5)&&(N[0]>H[0]?N[0]-=1:H[0]-=1);const ee=[];for(let oe=0;oe<3;oe++)A=H[oe]-N[oe],L=(1-y)*A,ee[oe]=M*N[oe]+P*H[oe]+k*L+z*L,oe===0&&ee[oe]<0&&(ee[oe]+=1);vf(ee,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]}else if(e.colorSpace===ca.LAB){const N=[],H=[];Df(v,N),Df(w,H);const ee=[];for(let oe=0;oe<3;oe++)A=H[oe]-N[oe],L=(1-y)*A,ee[oe]=M*N[oe]+P*H[oe]+k*L+z*L;dv(ee,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]}else e.colorSpace===ca.DIVERGING?(M6(b,v,w,x),o[D]=x[0],o[D+1]=x[1],o[D+2]=x[2]):gc("ColorSpace set to invalid value.");for(let N=0;N<3;N++)o[D+N]=o[D+N]<0?0:o[D+N],o[D+N]=o[D+N]>1?1:o[D+N]}}},t.getUint8Table=function(r,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==o)return e.table;if(e.nodes.length===0)return gc("Attempting to lookup a value with no points in the function"),e.table;const a=o?4:3;(e.tableSize!==i||e.tableWithAlpha!==o)&&(e.table=new Uint8Array(i*a),e.tableSize=i,e.tableWithAlpha=o);const s=[];t.getTable(r,n,i,s);for(let c=0;c<i;c++)e.table[c*a+0]=Math.floor(s[c*3+0]*255+.5),e.table[c*a+1]=Math.floor(s[c*3+1]*255+.5),e.table[c*a+2]=Math.floor(s[c*3+2]*255+.5),o&&(e.table[c*a+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=r=>{t.removeAllPoints();const n=r.getNumberOfComponents();for(let i=0;i<r.getNumberOfTuples();i++)switch(n){case 3:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:r.getComponent(i,0),g:r.getComponent(i,1),b:r.getComponent(i,2),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}case 6:{e.nodes.push({x:r.getComponent(i,0),r:r.getComponent(i,1),g:r.getComponent(i,2),b:r.getComponent(i,3),midpoint:r.getComponent(i,4),sharpness:r.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(r,n,i,o)=>{let a=0;t.removeAllPoints(),i>1&&(a=(n-r)/(i-1));for(let s=0;s<i;s++){const c={x:r+a*s,r:o[s*3],g:o[s*3+1],b:o[s*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(r,n)=>r<0||r>=e.nodes.length?(gc("Index out of range!"),-1):(n[0]=e.nodes[r].x,n[1]=e.nodes[r].r,n[2]=e.nodes[r].g,n[3]=e.nodes[r].b,n[4]=e.nodes[r].midpoint,n[5]=e.nodes[r].sharpness,1),t.setNodeValue=(r,n)=>{if(r<0||r>=e.nodes.length)return gc("Index out of range!"),-1;const i=e.nodes[r].x;return e.nodes[r].x=n[0],e.nodes[r].r=n[1],e.nodes[r].g=n[2],e.nodes[r].b=n[3],e.nodes[r].midpoint=n[4],e.nodes[r].sharpness=n[5],i!==n[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{var n;if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const r=((n=e.nodes)==null?void 0:n.length)??0;return Math.max(4094,r)},t.getIndexedColor=(r,n)=>{const i=t.getSize();if(i>0&&r>=0){const a=[];t.getNodeValue(r%i,a);for(let s=0;s<3;++s)n[s]=a[s+1];n[3]=1;return}const o=t.getNanColorByReference();n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=1},t.fillFromDataPointer=(r,n)=>{if(!(r<=0||!n)){t.removeAllPoints();for(let i=0;i<r;i++)t.addRGBPoint(n[i*4],n[i*4+1],n[i*4+2],n[i*4+3])}},t.setMappingRange=(r,n)=>{const i=[r,n],o=t.getRange();if(o[1]===i[1]&&o[0]===i[0])return;if(i[1]===i[0]){gc("attempt to set zero width color range");return}const a=(i[1]-i[0])/(o[1]-o[0]),s=i[0]-o[0]*a;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*a+s;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=r=>{const n=t.getRange(),i=[];n[0]<r[0]?(t.getColor(r[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])):(t.getColor(n[0],i),t.addRGBPoint(r[0],i[0],i[1],i[2])),n[1]>r[1]?(t.getColor(r[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])):(t.getColor(n[1],i),t.addRGBPoint(r[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let o=0;o<e.nodes.length;)e.nodes[o].x>=r[0]&&e.nodes[o].x<=r[1]?e.nodes.splice(o,1):++o;return 1},t.estimateMinNumberOfSamples=(r,n)=>{const i=t.findMinimumXDistance();return Math.ceil((n-r)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let r=Number.MAX_VALUE;for(let n=0;n<e.nodes.length-1;n++){const i=e.nodes[n+1].x-e.nodes[n].x;i<r&&(r=i)}return r},t.mapScalarsThroughTable=(r,n,i,o)=>{if(t.getSize()===0){cte("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(r,n,i,o):t.mapData(r,n,i,o)},t.mapData=(r,n,i,o)=>{if(t.getSize()===0){lte("Transfer Function Has No Points!");return}const a=Math.floor(t.getAlpha()*255+.5),s=r.getNumberOfTuples(),c=r.getNumberOfComponents(),l=n.getData(),f=r.getData(),u=[];if(i===am.RGBA)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*4]=Math.floor(u[0]*255+.5),l[d*4+1]=Math.floor(u[1]*255+.5),l[d*4+2]=Math.floor(u[2]*255+.5),l[d*4+3]=a}if(i===am.RGB)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*3]=Math.floor(u[0]*255+.5),l[d*3+1]=Math.floor(u[1]*255+.5),l[d*3+2]=Math.floor(u[2]*255+.5)}if(i===am.LUMINANCE)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5)}if(i===am.LUMINANCE_ALPHA)for(let d=0;d<s;d++){const h=f[d*c+o];t.getColor(h,u),l[d*2]=Math.floor(u[0]*76.5+u[1]*150.45+u[2]*28.05+.5),l[d*2+1]=a}},t.applyColorMap=r=>{const n=JSON.stringify(e.colorSpace);r.ColorSpace&&(e.colorSpace=ca[r.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(gc(`ColorSpace ${r.ColorSpace} not supported, using RGB instead`),e.colorSpace=ca.RGB));let i=n!==JSON.stringify(e.colorSpace);const o=i||JSON.stringify(e.nanColor);if(r.NanColor)for(e.nanColor=[].concat(r.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||o!==JSON.stringify(e.nanColor);const a=i||JSON.stringify(e.nodes);if(r.RGBPoints){const l=r.RGBPoints.length;e.nodes=[];const f=.5,u=0;for(let d=0;d<l;d+=4)e.nodes.push({x:r.RGBPoints[d],r:r.RGBPoints[d+1],g:r.RGBPoints[d+2],b:r.RGBPoints[d+3],midpoint:f,sharpness:u})}const s=t.sortAndUpdateRange(),c=!s&&(i||a!==JSON.stringify(e.nodes));return c&&t.modified(),s||c}}const hte={clamping:!0,colorSpace:ca.RGB,hSVWrap:!0,scale:c_.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function sL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hte,r),Zy.extend(t,e,r),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},K.obj(e.buildTime),K.get(t,e,["buildTime","mappingRange"]),K.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:ca},{type:"enum",name:"scale",enum:c_}]),K.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),K.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),dte(t,e)}const gte=K.newInstance(sL,"vtkColorTransferFunction");var gu={newInstance:gte,extend:sL,...aL},pte=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const Pd=Object.create(null);pte.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{Pd[t.Name]=t});const Ld=Object.keys(Pd);Ld.sort();function mte(t){return Pd[t]}function vte(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(Pd[t.Name]||(Ld.push(t.Name),Ld.sort()),Pd[t.Name]=t)}function yte(t){const e=Ld.indexOf(t);e>-1&&Ld.splice(e,1),delete Pd[t]}var Dv={addPreset:vte,removePresetByName:yte,getPresetByName:mte,rgbPresetNames:Ld};function fr(t){return fp.get(t)}function Qi(){return fp.getAll()}const bv=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",wte=t=>Array.isArray(t)?[]:{},pp=(t,e)=>e&&e.clone===!0&&bv(t)?ci(wte(t),t,e):t,R6=(t,e,r)=>{const n=t.slice();return e.forEach(function(i,o){typeof n[o]>"u"?n[o]=pp(i,r):bv(i)?n[o]=ci(t[o],i,r):t.indexOf(i)===-1&&(n[o]=pp(i,r))}),n},xte=(t,e,r)=>{const n={};return bv(t)&&Object.keys(t).forEach(function(i){n[i]=pp(t[i],r)}),Object.keys(e).forEach(function(i){!bv(e[i])||!t[i]?n[i]=pp(e[i],r):n[i]=ci(t[i],e[i],r)}),n},ci=(t={},e={},r=void 0)=>{const n=Array.isArray(e),o=(r||{arrayMerge:R6}).arrayMerge||R6;return n?Array.isArray(t)?o(t,e,r):pp(e,r):xte(t,e,r)};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const cL=Symbol("Comlink.proxy"),Cte=Symbol("Comlink.endpoint"),lL=Symbol("Comlink.releaseProxy"),kw=Symbol("Comlink.finalizer"),w2=Symbol("Comlink.thrown"),uL=t=>typeof t=="object"&&t!==null||typeof t=="function",Ste={canHandle:t=>uL(t)&&t[cL],serialize(t){const{port1:e,port2:r}=new MessageChannel;return l_(t,e),[r,[r]]},deserialize(t){return t.start(),hC(t)}},Tte={canHandle:t=>uL(t)&&w2 in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},fL=new Map([["proxy",Ste],["throw",Tte]]);function _te(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function l_(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(i){if(!i||!i.data)return;if(!_te(r,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:o,type:a,path:s}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(wf);let l;try{const f=s.slice(0,-1).reduce((d,h)=>d[h],t),u=s.reduce((d,h)=>d[h],t);switch(a){case"GET":l=u;break;case"SET":f[s.slice(-1)[0]]=wf(i.data.value),l=!0;break;case"APPLY":l=u.apply(f,c);break;case"CONSTRUCT":{const d=new u(...c);l=pL(d)}break;case"ENDPOINT":{const{port1:d,port2:h}=new MessageChannel;l_(t,h),l=Ote(d,[d])}break;case"RELEASE":l=void 0;break;default:return}}catch(f){l={value:f,[w2]:0}}Promise.resolve(l).catch(f=>({value:f,[w2]:0})).then(f=>{const[u,d]=Mv(f);e.postMessage(Object.assign(Object.assign({},u),{id:o}),d),a==="RELEASE"&&(e.removeEventListener("message",n),dL(e),kw in t&&typeof t[kw]=="function"&&t[kw]())}).catch(f=>{const[u,d]=Mv({value:new TypeError("Unserializable return value"),[w2]:0});e.postMessage(Object.assign(Object.assign({},u),{id:o}),d)})}),e.start&&e.start()}function Ete(t){return t.constructor.name==="MessagePort"}function dL(t){Ete(t)&&t.close()}function hC(t,e){return gC(t,[],e)}function sm(t){if(t)throw new Error("Proxy has been released and is not useable")}function hL(t){return b0(t,{type:"RELEASE"}).then(()=>{dL(t)})}const Iv=new WeakMap,Ov="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Iv.get(t)||0)-1;Iv.set(t,e),e===0&&hL(t)});function Dte(t,e){const r=(Iv.get(e)||0)+1;Iv.set(e,r),Ov&&Ov.register(t,e,t)}function bte(t){Ov&&Ov.unregister(t)}function gC(t,e=[],r=function(){}){let n=!1;const i=new Proxy(r,{get(o,a){if(sm(n),a===lL)return()=>{bte(i),hL(t),n=!0};if(a==="then"){if(e.length===0)return{then:()=>i};const s=b0(t,{type:"GET",path:e.map(c=>c.toString())}).then(wf);return s.then.bind(s)}return gC(t,[...e,a])},set(o,a,s){sm(n);const[c,l]=Mv(s);return b0(t,{type:"SET",path:[...e,a].map(f=>f.toString()),value:c},l).then(wf)},apply(o,a,s){sm(n);const c=e[e.length-1];if(c===Cte)return b0(t,{type:"ENDPOINT"}).then(wf);if(c==="bind")return gC(t,e.slice(0,-1));const[l,f]=P6(s);return b0(t,{type:"APPLY",path:e.map(u=>u.toString()),argumentList:l},f).then(wf)},construct(o,a){sm(n);const[s,c]=P6(a);return b0(t,{type:"CONSTRUCT",path:e.map(l=>l.toString()),argumentList:s},c).then(wf)}});return Dte(i,t),i}function Ite(t){return Array.prototype.concat.apply([],t)}function P6(t){const e=t.map(Mv);return[e.map(r=>r[0]),Ite(e.map(r=>r[1]))]}const gL=new WeakMap;function Ote(t,e){return gL.set(t,e),t}function pL(t){return Object.assign(t,{[cL]:!0})}function Mv(t){for(const[e,r]of fL)if(r.canHandle(t)){const[n,i]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:t},gL.get(t)||[]]}function wf(t){switch(t.type){case"HANDLER":return fL.get(t.name).deserialize(t.value);case"RAW":return t.value}}function b0(t,e,r){return new Promise(n=>{const i=Mte();t.addEventListener("message",function o(a){!a.data||!a.data.id||a.data.id!==i||(t.removeEventListener("message",o),n(a.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),r)})}function Mte(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class u_{constructor(e){this.numRequests={[Wt.Interaction]:0,[Wt.Thumbnail]:0,[Wt.Prefetch]:0,[Wt.Compute]:0},this.id=e||Cn(),this.requestPool={[Wt.Interaction]:{0:[]},[Wt.Thumbnail]:{0:[]},[Wt.Prefetch]:{0:[]},[Wt.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[Wt.Interaction]:0,[Wt.Thumbnail]:0,[Wt.Prefetch]:0,[Wt.Compute]:0},this.maxNumRequests={[Wt.Interaction]:6,[Wt.Thumbnail]:6,[Wt.Prefetch]:5,[Wt.Compute]:1e3}}setMaxSimultaneousRequests(e,r){this.maxNumRequests[e]=r}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,r,n,i=0){const o={requestFn:e,type:r,additionalDetails:n};this.requestPool[r][i]===void 0&&(this.requestPool[r][i]=[]),this.requestPool[r][i].push(o),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(r=>{const n=this.requestPool[r];Object.keys(n).forEach(i=>{n[i]=n[i].filter(o=>e(o))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const r=this.maxNumRequests[e]-this.numRequests[e];let n=0;for(let i=0;i<r;i++){const o=this.getNextRequest(e);if(o===null)return!1;if(o){this.numRequests[e]++,this.awake=!0;let a;try{a=o.requestFn()}catch(s){console.warn("sendRequest failed",s)}a!=null&&a.finally?a.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,n++)}}return n&&this.startAgain(),!0}getNextRequest(e){const r=this.getSortedPriorityGroups(e);for(const n of r)if(this.requestPool[e][n].length)return this.requestPool[e][n].shift();return null}startGrabbing(){const e=this.sendRequests(Wt.Interaction),r=this.sendRequests(Wt.Thumbnail),n=this.sendRequests(Wt.Prefetch),i=this.sendRequests(Wt.Compute);!e&&!r&&!n&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(n=>this.requestPool[e][n].length).sort((n,i)=>n-i)}getRequestPool(){return this.requestPool}}class mL{constructor(){this.workerRegistry={},this.workerPoolManager=new u_("webworker")}registerWorker(e,r,n={}){var c;const{maxWorkerInstances:i=1,overwrite:o=!1,autoTerminateOnIdle:a={enabled:!1,idleTimeThreshold:3e3}}=n;if(this.workerRegistry[e]&&!o){console.warn(`Worker type '${e}' is already registered...`);return}o&&((c=this.workerRegistry[e])!=null&&c.idleCheckIntervalId)&&clearInterval(this.workerRegistry[e].idleCheckIntervalId);const s={workerFn:null,instances:[],loadCounters:[],lastActiveTime:[],nativeWorkers:[],autoTerminateOnIdle:a.enabled,idleCheckIntervalId:null,idleTimeThreshold:a.idleTimeThreshold};s.loadCounters=Array(i).fill(0),s.lastActiveTime=Array(i).fill(null);for(let l=0;l<i;l++){const f=r();s.instances.push(hC(f)),s.nativeWorkers.push(f),s.workerFn=r}this.workerRegistry[e]=s}getNextWorkerAPI(e){const r=this.workerRegistry[e];if(!r)return console.error(`Worker type '${e}' is not registered.`),null;const n=r.instances.filter(a=>a!==null);let i=0,o=r.loadCounters[0]||0;for(let a=1;a<n.length;a++){const s=r.loadCounters[a]||0;s<o&&(i=a,o=s)}if(r.instances[i]===null){const a=r.workerFn();r.instances[i]=hC(a),r.nativeWorkers[i]=a}return r.loadCounters[i]+=1,{api:r.instances[i],index:i}}executeTask(e,r,n={},{requestType:i=Wt.Compute,priority:o=0,options:a={},callbacks:s=[]}={}){return new Promise((c,l)=>{const f=async()=>{const{api:u,index:d}=this.getNextWorkerAPI(e);if(!u){const h=new Error(`No available worker instance for '${e}'`);console.error(h),l(h);return}try{let h=[];s.length&&(h=s.map(v=>pL(v)));const g=this.workerRegistry[e];g.processing=!0;const p=await u[r](n,...h);g.processing=!1,g.lastActiveTime[d]=Date.now(),g.autoTerminateOnIdle&&!g.idleCheckIntervalId&&g.idleTimeThreshold&&(g.idleCheckIntervalId=setInterval(()=>{this.terminateIdleWorkers(e,g.idleTimeThreshold)},g.idleTimeThreshold)),c(p)}catch(h){console.error(`Error executing method '${r}' on worker '${e}':`,h),l(h)}finally{this.workerRegistry[e].loadCounters[d]--}};this.workerPoolManager.addRequest(f,i,a,o)})}terminateIdleWorkers(e,r){const n=this.workerRegistry[e];if(n.processing)return;const i=Date.now();n.instances.forEach((o,a)=>{const s=n.lastActiveTime[a],c=s!==null&&n.loadCounters[a]>0,l=i-s;!c&&l>r&&this.terminateWorkerInstance(e,a)})}terminate(e){const r=this.workerRegistry[e];if(!r){console.error(`Worker type '${e}' is not registered.`);return}r.instances.forEach((n,i)=>{this.terminateWorkerInstance(e,i)})}terminateWorkerInstance(e,r){const n=this.workerRegistry[e],i=n.instances[r];i!==null&&(i[lL](),n.nativeWorkers[r].terminate(),n.instances[r]=null,n.lastActiveTime[r]=null)}}let jl=!1;const pC={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:t=>null};let ts={...pC,rendering:{...pC.rendering}},Eg=null;function Rte(){const t=document.createElement("canvas");return t.getContext("webgl2")||t.getContext("webgl")||t.getContext("experimental-webgl")}function vL(){const t=Rte();return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext}function yL(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function wL(t=ts){var r;return jl||(ts=ci(pC,t),yL()&&((r=t.rendering)!=null&&r.preferSizeOverAccuracy?ts.rendering.preferSizeOverAccuracy=!0:console.log("norm16 texture not supported, you can turn on the preferSizeOverAccuracy flag to use native data type, but be aware of the inaccuracy of the rendering in high bits")),vL()?console.log("CornerstoneRender: using GPU rendering"):(console.log("CornerstoneRender: GPU not detected, using CPU rendering"),ts.rendering.useCPURendering=!0),jl=!0,Eg||(Eg=new mL),jl)}function Pte(t,e=!0){ts.rendering.useCPURendering=t,jl=!0,e&&a5()}function Lte(t){ts.rendering.preferSizeOverAccuracy=t,jl=!0,a5()}function i5(){return!yL()}function Ate(){ts.rendering.useCPURendering=!vL(),a5()}function ld(){return ts.rendering.useCPURendering}function xL(){return jl}function Nte(){jl=!1}function o5(){return ts}function kte(t){ts=t,a5()}function a5(){Qi().forEach(t=>{t.getViewports().forEach(e=>{e.updateRenderingPipeline()})})}function Kc(){return Eg||(Eg=new mL),Eg}function CL(t){return ts.peerImport(t)}function SL(t,e,r){return Math.abs(t-e)<=r}function Vte(t,e,r=1e-5){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!SL(t[n],e[n],r))return!1;return!0}function L6(t){return typeof t=="number"}function A6(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function At(t,e,r=1e-5){return typeof t!=typeof e||t===null||e===null?!1:L6(t)&&L6(e)?SL(t,e,r):A6(t)&&A6(e)?Vte(t,e,r):!1}const TL=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(TL):!t,mC=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map(mC):t,_L=(t,e,r=void 0)=>At(t,TL(e),r),Fte=(t,e,r=void 0)=>At(mC(t),mC(e),r),f_=new Map;function Ute(t){f_.set(t.Name,t)}function mp(t){return f_.get(t)}function EL(){return Array.from(f_.keys())}function d_(t,e){const r=Dv.rgbPresetNames.map(s=>Dv.getPresetByName(s)),n=EL().map(s=>mp(s)),o=r.concat(n).find(s=>{const{RGBPoints:c}=s;if(c.length!==t.length)return!1;for(let l=0;l<c.length;l+=4)if(!At(c.slice(l+1,l+4),t.slice(l+1,l+4)))return!1;return!0});if(!o)return null;const a=[];if(Oo(e,"vtkVolume")){const s=e.getProperty().getScalarOpacity(0).getDataPointer();if(!s)return{name:o.Name};for(let c=0;c<s.length;c+=2)a.push({value:s[c],opacity:s[c+1]})}return{name:o.Name,opacity:a}}const Bte=Object.freeze(Object.defineProperty({__proto__:null,findMatchingColormap:d_,getColormap:mp,getColormapNames:EL,registerColormap:Ute},Symbol.toStringTag,{value:"Module"}));function Dg(t){if(!t)return;const e=t.getSize();for(let r=0;r<e;r++){const n=[];t.getNodeValue(r,n),n[1]=1-n[1],n[2]=1-n[2],n[3]=1-n[3],t.setNodeValue(r,n)}}const vC=(t,e,r)=>e-r/4*Math.log((1-t)/t);function nh(t,e){const r=Math.abs(e-t)+1,n=(t+e+1)/2;return{windowWidth:r,windowCenter:n}}function ru(t,e,r=lo.LINEAR){if(r===lo.LINEAR)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(r===lo.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};if(r===lo.SAMPLED_SIGMOID){const n=vC(.01,e,t),i=vC(.99,e,t);return{lower:n,upper:i}}else throw new Error("Invalid VOI LUT function")}const Gte=Object.freeze(Object.defineProperty({__proto__:null,toLowHighRange:ru,toWindowLevel:nh},Symbol.toStringTag,{value:"Module"}));function h_(t,e=1024){const{windowWidth:r,windowCenter:n}=nh(t.lower,t.upper),o=Array.from({length:e},(s,c)=>(c+1)/(e+2)).flatMap(s=>[vC(s,n,r),s,s,s,.5,0]),a=gu.newInstance();return a.buildFunctionFromArray(Lt.newInstance({values:o,numberOfComponents:6})),a}function yr(t,e){return t.worldToIndex(e).map(Math.round)}function x2(t,e){return t.worldToIndex(e)}function Rv(t){const e=t.getSize(),r=[];for(let n=0;n<e;n++){const i=[];t.getNodeValue(n,i),r.push(i)}return r}function s5(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(r=>{t.addRGBPoint(...r)}))}const Wte=Object.freeze(Object.defineProperty({__proto__:null,getTransferFunctionNodes:Rv,setTransferFunctionNodes:s5},Symbol.toStringTag,{value:"Module"})),{InterpolationType:sg,OpacityMode:zte}=wP,{vtkErrorMacro:Vw}=K,C2=4;function $te(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,o;for(let a=0;a<C2;a++)e.componentData[a].colorChannels===1?e.componentData[a].grayTransferFunction&&(o=e.componentData[a].grayTransferFunction.getMTime(),i=i>o?i:o):e.componentData[a].colorChannels===3&&e.componentData[a].rGBTransferFunction&&(o=e.componentData[a].rGBTransferFunction.getMTime(),i=i>o?i:o),e.componentData[a].scalarOpacity&&(o=e.componentData[a].scalarOpacity.getMTime(),i=i>o?i:o),e.componentData[a].gradientOpacity&&(e.componentData[a].disableGradientOpacity||(o=e.componentData[a].gradientOpacity.getMTime(),i=i>o?i:o));return i},t.getColorChannels=i=>i<0||i>3?(Vw("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=!1;return e.componentData[i].grayTransferFunction!==o&&(e.componentData[i].grayTransferFunction=o,a=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,a=!0),a&&t.modified(),a},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=Rd.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=!1;return e.componentData[i].rGBTransferFunction!==o&&(e.componentData[i].rGBTransferFunction=o,a=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,a=!0),a&&t.modified(),a},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=gu.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==o?(e.componentData[i].scalarOpacity=o,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=Rd.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=C2)return Vw("Invalid index"),!1;const a=Math.min(1,Math.max(0,o));return e.componentData[i].componentWeight!==a?(e.componentData[i].componentWeight=a,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=C2?(Vw("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(sg.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(sg.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(sg.FAST_LINEAR),t.getInterpolationTypeAsString=()=>K.enumToString(sg,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const o=K.capitalize(i);t[`set${o}`]=(a,s)=>e.componentData[a][`${i}`]!==s?(e.componentData[a][`${i}`]=s,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const o=K.capitalize(i);t[`get${o}`]=a=>e.componentData[a][`${i}`]})}const jte={colorMixPreset:null,independentComponents:!0,interpolationType:sg.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function DL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,jte,r),K.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<C2;++n)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:zte.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}K.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),K.setGetArray(t,e,["labelOutlineThickness"]),$te(t,e)}const Hte=K.newInstance(DL,"vtkVolumeProperty");var Kte={newInstance:Hte,extend:DL,...wP};const{vtkDebugMacro:qte}=K;function Xte(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=Kte.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;const n=i=>i[0].map((o,a)=>i.map(s=>s[a]));if(!e.mapperBounds||!n([r,e.mapperBounds]).reduce((i,o)=>i&&o[0]===o[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){qte("Recomputing bounds..."),e.mapperBounds=r.map(a=>a);const i=[];Nn.getCorners(r,i),t.computeMatrix();const o=new Float64Array(16);Yt(o,e.matrix),i.forEach(a=>Pt(a,a,o)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((a,s)=>s%2===0?i.reduce((c,l)=>c>l[s/2]?l[s/2]:c,a):i.reduce((c,l)=>c<l[(s-1)/2]?l[(s-1)/2]:c,a)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=e.mtime;if(e.property!==null){const n=e.property.getMTime();r=n>r?n:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}return r}}const Yte={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function bL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yte,r),s_.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.set(t,e,["property"]),K.setGet(t,e,["mapper"]),K.getArray(t,e,["bounds"],6),Xte(t,e)}const Jte=K.newInstance(bL,"vtkVolume");var Zte={newInstance:Jte,extend:bL};const{vtkErrorMacro:Qte}=K;class ene{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const r=e[0],n=e[e.length-1];if(r===n||e.length<2)return;const i=this.segmentMapping[r],o=this.segmentMapping[n];if(i!==void 0&&o!==void 0)if(Math.abs(i)===Math.abs(o)){const a=i<o?o:i,s=this.segments[a];if(i>0)for(let c=1;c<e.length-1;c++)s.push(e[c]);else for(let c=1;c<e.length-1;c++)s.unshift(e[e.length-1-c]);this.faces.push(s),this.segments[a]=null,this.segmentMapping[r]=void 0,this.segmentMapping[n]=void 0}else{const a=Math.abs(i),s=Math.abs(o),c=this.segments[a],l=this.segments[s];this.segments[a]=null,this.segments[s]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const a=this.segments[i];for(let s=1;s<e.length;s++)a.push(e[s]);this.segmentMapping[n]=i}else{const a=this.segments[-i];this.segmentMapping[n]=i;for(let s=1;s<e.length;s++)a.unshift(e[s])}this.segmentMapping[r]=void 0}else if(o!==void 0){if(o>0){const a=this.segments[o];for(let s=1;s<e.length;s++)a.push(e[e.length-1-s]);this.segmentMapping[r]=o}else{const a=this.segments[-o];this.segmentMapping[r]=o;for(let s=1;s<e.length;s++)a.unshift(e[e.length-s-1])}this.segmentMapping[n]=void 0}else{const a=this.segments.length;this.segments.push(e),this.segmentMapping[r]=-a,this.segmentMapping[n]=a}}}function tne(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(r,n)=>{const i=r[0];if(!i){Qte("Invalid or missing input");return}const o=Qr.newInstance();o.shallowCopy(i);const a=new ene,s=i.getLines().getData();let c=0;for(;c<s.length;){const d=s[c++],h=[];for(let g=0;g<d;g++)h.push(s[c+g]);a.addSegment(h),c+=d}const{faces:l}=a;let f=l.length;for(let d=0;d<l.length;d++)f+=l[d].length;const u=new Uint16Array(f);c=0;for(let d=0;d<l.length;d++){const h=l[d];u[c++]=h.length;for(let g=0;g<h.length;g++)u[c++]=h[g]}o.setPolys(Kf.newInstance({values:u,name:"faces"})),n[0]=o}}const nne={};function IL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nne,r),K.obj(t,e),K.algo(t,e,1,1),tne(t,e)}const rne=K.newInstance(IL,"vtkClosedPolyLineToSurfaceFilter");var ine={newInstance:rne,extend:IL};const{vtkErrorMacro:N6}=Ni;function one(t){const e=t.getPolys().getData(),r=t.getStrips().getData(),n={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(n.polyIdx<e.length){n.cellSize=e[n.polyIdx];const i=n.polyIdx+1,o=i+n.cellSize;n.polyIdx=o;let a=0;for(let s=i;s<o;++s)n.cell[a++]=e[s]}else if(n.stripIdx<r.length){n.cellSize=3,n.remainingStripLength===0&&(n.remainingStripLength=r[n.stripIdx]-2,n.stripIdx+=3);const i=n.stripIdx-2,o=n.stripIdx+1;n.stripIdx++,n.remainingStripLength--;let a=0;for(let s=i;s<o;++s)n.cell[a++]=r[s]}else if(!n.done)n.done=!0;else throw new Error("Iterator is done")}};return n.next(),n}function ane(t,e){e.classHierarchy.push("vtkCutter");const r={...t};t.getMTime=()=>{let i=r.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function n(i,o){const a=i.getPoints(),s=a.getData(),c=a.getNumberOfPoints(),l=[],f=[],u=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let d=0,h=0;for(;d<s.length;)e.cutScalars[h++]=e.cutFunction.evaluateFunction(s[d++],s[d++],s[d++]);const g=[],p=new Array(3),v=new Array(3),w=[];for(const y=one(i);!y.done;y.next()){if(y.cellSize<=2)continue;for(let _=0;_<y.cellSize;)w[_]=e.cutScalars[y.cell[_++]];const x=w[0]>0;let C=!0;for(let _=1;_<y.cell.length;_++)if(w[_]>0!==x){C=!1;break}if(C)continue;const S=[];for(let _=0;_<y.cellSize;_++){const E=_+1===y.cellSize?0:_+1,D=w[_]>0;if(w[E]>0===D)continue;let I=_,R=E,M=w[R]-w[I];M<=0&&(I=E,R=_,M*=-1);let P=0;M!==0&&(P=(e.cutValue-w[I])/M);const k=y.cell[I],z=y.cell[R];p[0]=s[k*3],p[1]=s[k*3+1],p[2]=s[k*3+2],v[0]=s[z*3],v[1]=s[z*3+1],v[2]=s[z*3+2];const A=[p[0]+P*(v[0]-p[0]),p[1]+P*(v[1]-p[1]),p[2]+P*(v[2]-p[2])];S.push({pointEdge1:k,pointEdge2:z,intersectedPoint:A,newPointID:-1})}for(let _=0;_<S.length;_++){const E=S[_];let D=!1;for(let b=0;b<g.length;b++){const I=g[b],R=E.pointEdge1===I.pointEdge1&&E.pointEdge2===I.pointEdge2,M=E.intersectedPoint[0]===I.intersectedPoint[0]&&E.intersectedPoint[1]===I.intersectedPoint[1]&&E.intersectedPoint[2]===I.intersectedPoint[2];if(R||M){D=!0,S[_].newPointID=g[b].newPointID;break}}D||(l.push(E.intersectedPoint[0]),l.push(E.intersectedPoint[1]),l.push(E.intersectedPoint[2]),S[_].newPointID=l.length/3-1,g.push(S[_]))}const T=S.length;T===2?f.push(T,S[0].newPointID,S[1].newPointID):T>2&&(u.push(T),S.forEach(_=>{u.push(_.newPointID)}))}o.getPoints().setData(Gy(a.getDataType(),l),3),f.length!==0&&o.getLines().setData(Uint16Array.from(f)),u.length!==0&&o.getPolys().setData(Uint16Array.from(u))}t.requestData=(i,o)=>{const a=i[0];if(!a){N6("Invalid or missing input");return}if(!e.cutFunction){N6("Missing cut function");return}const s=Qr.newInstance();n(a,s),o[0]=s}}const sne={cutFunction:null,cutScalars:null,cutValue:0};function OL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sne,r),Zn(t,e),cT(t,e,1,1),Fr(t,e,["cutFunction","cutValue"]),ane(t,e)}const cne=Sn(OL,"vtkCutter");var lne={newInstance:cne,extend:OL};const une=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],fne=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function dne(t,e){e.classHierarchy.push("vtkCubeSource");function r(n,i){if(e.deleted)return;const o=Qr.newInstance();i[0]=o;const a=24,s=K.newTypedArray(e.pointType,a*3);o.getPoints().setData(s,3);const c=K.newTypedArray(e.pointType,a*3),l=Lt.newInstance({name:"Normals",values:c,numberOfComponents:3});o.getPointData().setNormals(l);let f=2;e.generate3DTextureCoordinates===!0&&(f=3);const u=K.newTypedArray(e.pointType,a*f),d=Lt.newInstance({name:"TextureCoordinates",values:u,numberOfComponents:f});o.getPointData().setTCoords(d);const h=[0,0,0],g=[0,0,0],p=[0,0];let v=0;h[0]=-e.xLength/2,g[0]=-1,g[1]=0,g[2]=0;for(let w=0;w<2;w++){h[1]=-e.yLength/2;for(let m=0;m<2;m++){p[1]=h[1]+.5,h[2]=-e.zLength/2;for(let y=0;y<2;y++)p[0]=(h[2]+.5)*(1-2*w),s[v*3]=h[0],s[v*3+1]=h[1],s[v*3+2]=h[2],c[v*3]=g[0],c[v*3+1]=g[1],c[v*3+2]=g[2],f===2?(u[v*f]=p[0],u[v*f+1]=p[1]):(u[v*f]=2*w-1,u[v*f+1]=2*m-1,u[v*f+2]=2*y-1),v++,h[2]+=e.zLength;h[1]+=e.yLength}h[0]+=e.xLength,g[0]+=2}h[1]=-e.yLength/2,g[1]=-1,g[0]=0,g[2]=0;for(let w=0;w<2;w++){h[0]=-e.xLength/2;for(let m=0;m<2;m++){p[0]=(h[0]+.5)*(2*w-1),h[2]=-e.zLength/2;for(let y=0;y<2;y++)p[1]=(h[2]+.5)*-1,s[v*3]=h[0],s[v*3+1]=h[1],s[v*3+2]=h[2],c[v*3]=g[0],c[v*3+1]=g[1],c[v*3+2]=g[2],f===2?(u[v*f]=p[0],u[v*f+1]=p[1]):(u[v*f]=2*m-1,u[v*f+1]=2*w-1,u[v*f+2]=2*y-1),v++,h[2]+=e.zLength;h[0]+=e.xLength}h[1]+=e.yLength,g[1]+=2}h[2]=-e.zLength/2,g[2]=-1,g[0]=0,g[1]=0;for(let w=0;w<2;w++){h[1]=-e.yLength/2;for(let m=0;m<2;m++){p[1]=h[1]+.5,h[0]=-e.xLength/2;for(let y=0;y<2;y++)p[0]=(h[0]+.5)*(2*w-1),s[v*3]=h[0],s[v*3+1]=h[1],s[v*3+2]=h[2],c[v*3]=g[0],c[v*3+1]=g[1],c[v*3+2]=g[2],f===2?(u[v*f]=p[0],u[v*f+1]=p[1]):(u[v*f]=2*y-1,u[v*f+1]=2*m-1,u[v*f+2]=2*w-1),v++,h[0]+=e.xLength;h[1]+=e.yLength}h[2]+=e.zLength,g[2]+=2}if(e.rotations&&wi.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(s).apply(c),e.center&&wi.buildFromRadian().translate(...e.center).apply(s),e.matrix){wi.buildFromRadian().setMatrix(e.matrix).apply(s);const w=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];wi.buildFromRadian().setMatrix(w).apply(c)}e.generateFaces?o.getPolys().deepCopy(e._polys):o.getPolys().initialize(),e.generateLines?(o.getLines().deepCopy(e._lineCells),o.getPointData().setNormals(null)):o.getLines().initialize(),o.modified()}t.setBounds=function(){let n=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))n=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)n.push(i<0||arguments.length<=i?void 0:arguments[i]);n.length===6&&(t.setXLength(n[1]-n[0]),t.setYLength(n[3]-n[2]),t.setZLength(n[5]-n[4]),t.setCenter([(n[0]+n[1])/2,(n[2]+n[3])/2,(n[4]+n[5])/2]))},t.requestData=r}const hne={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function ML(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hne,r),K.obj(t,e),K.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),K.setGetArray(t,e,["center","rotations"],3),K.setGetArray(t,e,["matrix"],16),e._polys=Kf.newInstance({values:Uint16Array.from(fne)}),e._lineCells=Kf.newInstance({values:Uint16Array.from(une)}),K.moveToProtected(t,e,["polys","lineCells"]),K.algo(t,e,0,1),dne(t,e)}const gne=K.newInstance(ML,"vtkCubeSource");var RL={newInstance:gne,extend:ML};const{vtkErrorMacro:k6}=K;function pne(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const r={...t};t.requestData=(n,i)=>{const o=n[0];if(!o||!o.isA("vtkImageData")){k6("Invalid or missing input");return}const a=o.getSpatialExtent();if(!a){k6("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(a),e._cubeSource.setMatrix(o.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(r.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const mne={};function PL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mne,r),K.obj(t,e),K.algo(t,e,1,1),e._cubeSource=RL.newInstance(),K.moveToProtected(t,e,["cubeSource","tmpOut"]),pne(t,e)}const vne=K.newInstance(PL,"vtkImageDataOutlineFilter");var yne={newInstance:vne,extend:PL};let g_;function wne(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(r,n)=>(Pt(n,r,e.matrix),n),t.transformPoints=(r,n)=>{const i=new Float64Array(3),o=new Float64Array(3);for(let a=0;a<r.length;a+=3)i[0]=r[a],i[1]=r[a+1],i[2]=r[a+2],Pt(o,i,e.matrix),n[a]=o[0],n[a+1]=o[1],n[a+2]=o[2];return n},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(r,n)=>(e.preMultiplyFlag?rn(n,e.matrix,r):rn(n,r,e.matrix),n),t.transformMatrices=(r,n)=>{const i=new Float64Array(16),o=new Float64Array(16),a=e.preMultiplyFlag?()=>rn(o,e.matrix,i):()=>rn(o,i,e.matrix);for(let s=0;s<r.length;s+=16){for(let c=0;c<16;++c)i[c]=r[s+c];a();for(let c=0;c<16;++c)n[s+c]=o[c]}return n},t.getInverse=()=>g_({matrix:kt.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const xne={preMultiplyFlag:!1,matrix:[...yT]};function LL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xne,r),K.obj(t,e),K.setGet(t,e,["preMultiplyFlag"]),K.setGetArray(t,e,["matrix"],16),wne(t,e)}g_=K.newInstance(LL,"vtkTransform");var Cne={newInstance:g_,extend:LL},Sne=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,Tne=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:nf}=Ni;function V6(t,e,r){return e.identity(r),t.reduce((n,i,o)=>o===0?i?e.copy(n,i):e.identity(n):i?e.multiply(n,n,i):n,r)}function _ne(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function r(i){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(o=>i.unregisterGraphicsResourceUser(o,t))}t.buildPass=i=>{if(i){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const o=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(o.getActiveCamera());const a=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),a&&!a.isDeleted()&&a!==e._openGLRenderWindow&&r(a),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(i,o)=>{i&&(e.currentRenderPass=o,t.render())},t.zBufferPass=i=>{i&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=i=>t.zBufferPass(i),t.opaquePass=i=>{i&&t.render()},t.getCoincidentParameters=(i,o)=>e.renderable.getResolveCoincidentTopology()==gs.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const i=e._openGLImageSlice.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.renderPiece=(i,o)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){nf("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(i,o),t.renderPieceDraw(i,o),t.renderPieceFinish(i,o),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(i,o)=>{t.updateBufferObjects(i,o),o.getProperty().getInterpolationType()===Pf.NEAREST?(e.openGLTexture.setMinificationFilter(_t.NEAREST),e.openGLTexture.setMagnificationFilter(_t.NEAREST),e.colorTexture.setMinificationFilter(_t.NEAREST),e.colorTexture.setMagnificationFilter(_t.NEAREST),e.pwfTexture.setMinificationFilter(_t.NEAREST),e.pwfTexture.setMagnificationFilter(_t.NEAREST)):(e.openGLTexture.setMinificationFilter(_t.LINEAR),e.openGLTexture.setMagnificationFilter(_t.LINEAR),e.colorTexture.setMinificationFilter(_t.LINEAR),e.colorTexture.setMagnificationFilter(_t.LINEAR),e.pwfTexture.setMinificationFilter(_t.LINEAR),e.pwfTexture.setMagnificationFilter(_t.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(i,o)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,i,o),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(i,o)=>{},t.updateBufferObjects=(i,o)=>{t.getNeedToRebuildBufferObjects(i,o)&&t.buildBufferObjects(i,o)},t.getNeedToRebuildBufferObjects=(i,o)=>{var a,s,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<o.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<o.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!((a=e.openGLTexture)!=null&&a.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,o)=>{var T,_,E,D;const a=e.currentInput;if(!a)return;const s=(T=a.getPointData())==null?void 0:T.getScalars();if(!s)return;const c=s.getNumberOfComponents();let l=t_(a,s);const f=e._openGLRenderWindow.getGraphicsResourceForObject(s);if(!((_=f==null?void 0:f.oglObject)!=null&&_.getHandle())||(f==null?void 0:f.hash)!==l){e.openGLTexture=rr.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const b=a.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(b[0],b[1],b[2],s),e._openGLRenderWindow.setGraphicsResourceForObject(s,e.openGLTexture,l),s!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(s,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=s}else e.openGLTexture=f.oglObject;const d=o.getProperty(),h=d.getIndependentComponents(),g=h?c:1,p=h?2*g:1,v=d.getRGBTransferFunction();l=Ks(v,h,g);const w=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!((E=w==null?void 0:w.oglObject)!=null&&E.getHandle())||(w==null?void 0:w.hash)!==l){const I=1024*p*3,R=new Uint8ClampedArray(I);if(e.colorTexture=rr.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),v){const M=new Float32Array(3072);for(let P=0;P<g;P++){const k=d.getRGBTransferFunction(P),z=k.getRange();if(k.getTable(z[0],z[1],1024,M,1),h)for(let A=0;A<1024*3;A++)R[P*1024*6+A]=255*M[A],R[P*1024*6+A+1024*3]=255*M[A];else for(let A=0;A<1024*3;A++)R[P*1024*6+A]=255*M[A]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,p,3,Ht.UNSIGNED_CHAR,R)}else{for(let M=0;M<1024*3;++M)R[M]=255*M/(1023*3),R[M+1]=255*M/(1023*3),R[M+2]=255*M/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,Ht.UNSIGNED_CHAR,R)}v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.colorTexture,l),v!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=v)}else e.colorTexture=w.oglObject;const y=d.getPiecewiseFunction();l=Ks(y,h,g);const x=e._openGLRenderWindow.getGraphicsResourceForObject(y);if(!((D=x==null?void 0:x.oglObject)!=null&&D.getHandle())||(x==null?void 0:x.hash)!==l){const I=1024*p,R=new Uint8ClampedArray(I);if(e.pwfTexture=rr.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),y){const M=new Float32Array(I),P=new Float32Array(1024);for(let k=0;k<g;++k){const z=d.getPiecewiseFunction(k);if(z===null)M.fill(1);else{const A=z.getRange();if(z.getTable(A[0],A[1],1024,P,1),h)for(let L=0;L<1024;L++)M[k*1024*2+L]=P[L],M[k*1024*2+L+1024]=P[L];else for(let L=0;L<1024;L++)M[k*1024*2+L]=P[L]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,p,1,Ht.FLOAT,M)}else R.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,Ht.UNSIGNED_CHAR,R);y&&(e._openGLRenderWindow.setGraphicsResourceForObject(y,e.pwfTexture,l),y!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(y,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=y)}else e.pwfTexture=x.oglObject;const S=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==S){const b=Lt.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});b.setName("points");const I=Lt.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),R={points:b,cellOffset:0};if(e.renderable.getSlabThickness()>0){const M=e.resliceGeom.getPointData().getNormals();M?R.normals=M:nf("Slab mode requested without normals")}e.tris.getCABO().createVBO(I,"polys",Mi.SURFACE,R)}e.VBOBuildString=S,e.VBOBuildTime.modified()},t.updateShaders=(i,o,a)=>{if(e.lastBoundBO=i,t.getNeedToRebuildShaders(i,o,a)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,o,a);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,o,a),t.setCameraShaderParameters(i,o,a),t.setPropertyShaderParameters(i,o,a)},t.setMapperShaderParameters=(i,o,a)=>{const s=i.getProgram();if(i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())){s.isUniformUsed("texture1")&&s.setUniformi("texture1",e.openGLTexture.getTextureUnit()),s.isAttributeUsed("vertexWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"vertexWC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||nf("Error setting vertexWC in shader VAO.")),s.isAttributeUsed("normalWC")&&(i.getVAO().addAttributeArray(s,i.getCABO(),"normalWC",i.getCABO().getNormalOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||nf("Error setting normalWC in shader VAO.")),s.isUniformUsed("slabThickness")&&s.setUniformf("slabThickness",e.renderable.getSlabThickness()),s.isUniformUsed("spacing")&&s.setUniform3fv("spacing",e.currentInput.getSpacing()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabType")&&s.setUniformi("slabType",e.renderable.getSlabType()),s.isUniformUsed("slabTrapezoid")&&s.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null;if(s.isUniformUsed("WCTCMatrix")){const f=e.currentInput,u=f.getDimensions();sr(e.tmpMat4,f.getIndexToWorld()),Wn(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Wc(e.tmpMat4,e.tmpMat4,u),Or(e.tmpMat4,e.tmpMat4),l&&rn(e.tmpMat4,e.tmpMat4,l),s.setUniformMatrix("WCTCMatrix",e.tmpMat4)}s.isUniformUsed("vboScaling")&&s.setUniform3fv("vboScaling",i.getCABO().getCoordScale()??[1,1,1]),i.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&i.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),i.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(o,a);i.getProgram().setUniformf("coffset",c.offset),i.getProgram().isUniformUsed("cfactor")&&i.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(i,o,a)=>{const s=e._openGLCamera.getKeyMatrices(o),c=e._openGLImageSlice.getKeyMatrices(),f=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null,u=i.getProgram();u.isUniformUsed("MCPCMatrix")&&(yt(e.tmpMat4),u.setUniformMatrix("MCPCMatrix",V6([s.wcpc,c.mcwc,f],hp,e.tmpMat4))),u.isUniformUsed("MCVCMatrix")&&(yt(e.tmpMat4),u.setUniformMatrix("MCVCMatrix",V6([s.wcvc,c.mcwc,f],hp,e.tmpMat4)))},t.setPropertyShaderParameters=(i,o,a)=>{const s=i.getProgram(),c=a.getProperty(),l=c.getOpacity();s.setUniformf("opacity",l);const f=e.openGLTexture.getComponents(),u=c.getIndependentComponents();if(u)for(let p=0;p<f;++p)s.setUniformf(`mix${p}`,c.getComponentWeight(p));const d=e.openGLTexture.getVolumeInfo();for(let p=0;p<f;p++){let v=c.getColorWindow(),w=c.getColorLevel();const m=u?p:0,y=c.getRGBTransferFunction(m);if(y&&c.getUseLookupTableScalarRange()){const S=y.getRange();v=S[1]-S[0],w=.5*(S[1]+S[0])}const x=d.scale[p]/v,C=(d.offset[p]-w)/v+.5;s.setUniformf(`cshift${p}`,C),s.setUniformf(`cscale${p}`,x)}const h=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",h);for(let p=0;p<f;p++){let v=1,w=0;const m=u?p:0,y=c.getPiecewiseFunction(m);if(y){const x=y.getRange(),C=x[1]-x[0],S=.5*(x[0]+x[1]);v=d.scale[p]/C,w=(d.offset[p]-S)/C+.5}s.setUniformf(`pwfshift${p}`,w),s.setUniformf(`pwfscale${p}`,v)}const g=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",g),s.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(i,o,a)=>{var h;const s=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),f=e.renderable.getSlabType(),u=e.renderable.getSlabTrapezoidIntegration();let d=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(d=!0),d||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((h=i.getProgram())==null?void 0:h.getHandle())===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==c||e.lastSlabThickness!==l||e.lastSlabType!==f||e.lastSlabTrapezoidIntegration!==u?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=c,e.lastSlabThickness=l,e.lastSlabType=f,e.lastSlabTrapezoidIntegration=u,!0):!1},t.getShaderTemplate=(i,o,a)=>{i.Vertex=Sne,i.Fragment=Tne,i.Geometry=""},t.replaceShaderValues=(i,o,a)=>{if(t.replaceShaderTCoord(i,o,a),t.replaceShaderPositionVC(i,o,a),e.haveSeenDepthRequest){let s=i.Fragment;s=Te.substitute(s,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,s=Te.substitute(s,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,i.Fragment=s}t.replaceShaderCoincidentOffset(i,o,a)},t.replaceShaderTCoord=(i,o,a)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],u=e.renderable.getSlabThickness();s=Te.substitute(s,"//VTK::TCoord::Dec",f).result;const d=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];s=Te.substitute(s,"//VTK::TCoord::Impl",d).result;const h=e.openGLTexture.getComponents(),g=a.getProperty().getIndependentComponents();let p=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(g){for(let w=1;w<h;w++)p=p.concat([`uniform float cshift${w};`,`uniform float cscale${w};`,`uniform float pwfshift${w};`,`uniform float pwfscale${w};`]);switch(h){case 1:p=p.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:p=p.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:p=p.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:nf("Unsupported number of independent coordinates.")}}u>0&&(p=p.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),p=p.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=Te.substitute(l,"//VTK::TCoord::Dec",p).result;let v=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(u>0&&(v=v.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),g){const w=["r","g","b","a"];for(let m=0;m<h;++m)v=v.concat([`vec3 tcolor${m} = mix${m} * texture2D(colorTexture1, vec2(tvalue.${w[m]} * cscale${m} + cshift${m}, height${m})).rgb;`,`float compWeight${m} = mix${m} * texture2D(pwfTexture1, vec2(tvalue.${w[m]} * pwfscale${m} + pwfshift${m}, height${m})).r;`]);switch(h){case 1:v=v.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:v=v.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:v=v.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:nf("Unsupported number of independent coordinates.")}}else switch(h){case 1:v=v.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:v=v.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:v=v.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=Te.substitute(l,"//VTK::TCoord::Impl",v).result,i.Vertex=s,i.Fragment=l,i.Geometry=c},t.replaceShaderPositionVC=(i,o,a)=>{let s=i.Vertex;const c=i.Geometry;let l=i.Fragment;const f=e.renderable.getSlabThickness();let u=["attribute vec4 vertexWC;"];u=u.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),f>0&&(u=u.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),s=Te.substitute(s,"//VTK::PositionVC::Dec",u).result;let d=["gl_Position = MCPCMatrix * vertexWC;"];f>0&&(d=d.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),s=Te.substitute(s,"//VTK::PositionVC::Impl",d).result,s=Te.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let h=[];f>0&&(h=h.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=Te.substitute(l,"//VTK::PositionVC::Dec",h).result,i.Vertex=s,i.Geometry=c,i.Fragment=l};function n(i){kt.normalize(i);const o=[0,0,0];for(let a=0;a<3;++a){Eq(o),o[a]=1;const s=kt.dot(i,o);if(s<-.999||s>.999)return[!0,a]}return[!1,2]}t.updateResliceGeometry=()=>{var u;let i="";const o=e.currentInput,a=o==null?void 0:o.getBounds();let s=!0,c=2;const l=e.renderable.getSlicePolyData(),f=e.renderable.getSlicePlane();if(l)i=i.concat(`PolyData${l.getMTime()}`);else if(f){i=i.concat(`Plane${f.getMTime()}`);const d=bT();o&&(i=i.concat(`Image${o.getMTime()}`),pM(d,...o.getDirection()),n1(d,d));const h=[...f.getNormal()];d2(h,h,d),[s,c]=n(h)}else{const d=Yi.newInstance();d.setNormal(0,0,1);let h=[0,1,0,1,0,1];o&&(h=a),d.setOrigin(h[0],h[2],.5*(h[5]+h[4])),e.renderable.setSlicePlane(d),i=i.concat(`Plane${f==null?void 0:f.getMTime()}`),o&&(i=i.concat(`Image${o.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==i){if(l)e.resliceGeom||(e.resliceGeom=Qr.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(f)if(s){const d=new Float32Array(12),h=o.worldToIndex(f.getOrigin(),[0,0,0]),g=[(c+1)%3,(c+2)%3].sort(),p=o.getSpatialExtent();let v=0;for(let C=0;C<2;++C)for(let S=0;S<2;++S)d[v+c]=h[c],d[v+g[0]]=p[2*g[0]+S],d[v+g[1]]=p[2*g[1]+C],v+=3;e.transform.setMatrix(o.getIndexToWorld()),e.transform.transformPoints(d,d);const w=new Uint16Array(8);w[0]=3,w[1]=0,w[2]=1,w[3]=3,w[4]=3,w[5]=0,w[6]=3,w[7]=2;const m=f.getNormal();kt.normalize(m);const y=new Float32Array(12);for(let C=0;C<4;++C)y[3*C]=m[0],y[3*C+1]=m[1],y[3*C+2]=m[2];e.resliceGeom||(e.resliceGeom=Qr.newInstance()),e.resliceGeom.getPoints().setData(d,3),e.resliceGeom.getPolys().setData(w,1);const x=Lt.newInstance({numberOfComponents:3,values:y,name:"Normals"});e.resliceGeom.getPointData().setNormals(x)}else{e.outlineFilter.setInputData(o),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(f),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=Qr.newInstance());const d=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(d.getPoints().getData(),3),e.resliceGeom.getPolys().setData(d.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(d.getPointData().getNormals());const h=f.getNormal(),g=e.resliceGeom.getNumberOfPoints();kt.normalize(h);const p=new Float32Array(g*3);for(let w=0;w<g;++w)p[3*w]=h[0],p[3*w+1]=h[1],p[3*w+2]=h[2];const v=Lt.newInstance({numberOfComponents:3,values:p,name:"Normals"});e.resliceGeom.getPointData().setNormals(v)}else nf("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=i,(u=e.resliceGeom)==null||u.modified()}},t.setOpenGLTexture=i=>{i&&(e.openGLTexture=i,e._externalOpenGLTexture=!0)},t.delete=Zp(()=>{e._openGLRenderWindow&&r(e._openGLRenderWindow)},t.delete)}const Ene={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function Dne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ene,r),Gn.extend(t,e,r),Hs.implementReplaceShaderCoincidentOffset(t,e,r),Hs.implementBuildShadersWithReplacements(t,e,r),e.tris=Js.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Zn(e.VBOBuildTime),e.tmpMat4=yt(new Float64Array(16)),e.outlineFilter=yne.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=Qr.newInstance(),e.cutter=lne.newInstance(),e.lineToSurfaceFilter=ine.newInstance(),e.transform=Cne.newInstance(),mo(t,e,["openGLTexture"]),_ne(t,e)}const bne=Sn(Dne,"vtkOpenGLImageResliceMapper");Hr("vtkImageResliceMapper",bne);const AL=Object.create(null);function Ia(t,e){AL[t]=e}function Ine(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const One={};function Mne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,One,r),e.overrides=AL,ET.extend(t,e,r),Ine(t,e)}K.newInstance(Mne,"vtkWebGPUViewNodeFactory");function Rne(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,i,o)=>{if(yt(r),e.renderable.getParallelProjection()){const a=e.renderable.getParallelScale(),s=a*n,c=a,l=(o[0]-1)*s,f=(o[0]+1)*s,u=(o[1]-1)*c,d=(o[1]+1)*c,h=1/(f-l),g=1/(d-u);r[0]=2*h,r[5]=2*g,r[10]=1/(i[1]-i[0]),r[12]=(f+l)*h,r[13]=(d+u)*g,r[14]=i[1]/(i[1]-i[0])}else{const a=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let s,c;e.renderable.getUseHorizontalViewAngle()===!0?(s=i[0]*a,c=i[0]*a/n):(s=i[0]*a*n,c=i[0]*a);const l=(o[0]-1)*s,f=(o[0]+1)*s,u=(o[1]-1)*c,d=(o[1]+1)*c;r[0]=2*i[0]/(f-l),r[5]=2*i[0]/(d-u),r[12]=(l+f)/(f-l),r[13]=(u+d)/(d-u),r[10]=0,r[14]=i[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;const n=e.renderable.getClippingRangeByReference();let i=-n[0]/r;return i=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(i*(n[1]-n[0])),.5*i+.5},t.getKeyMatrices=r=>{const n=r.getRenderable(),i=r.getParent();if(Math.max(i.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){const o=e.renderable.getViewMatrix();sr(e.keyMatrices.normalMatrix,o),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Or(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Yt(e.keyMatrices.wcvc,o);const a=r.getStabilizedCenterByReference();Wn(e.keyMatrices.scvc,e.keyMatrices.wcvc,a);const s=r.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,s,c,e.renderable.getWindowCenterByReference()),rn(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Or(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const Pne={keyMatrixTime:null,keyMatrices:null};function Lne(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pne,r),Gn.extend(t,e,r),e.keyMatrixTime={},K.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},K.setGet(t,e,["keyMatrixTime"]),Rne(t,e)}const Ane=K.newInstance(Lne);Ia("vtkCamera",Ane);function Nne(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==r[i]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{const n=[];for(let i=0;i<e.bindables.length;i++){const o=e.bindables[i].getBindGroupLayoutEntry();o.binding=i,n.push(o)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupTime().getMTime();n=a>n?a:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let o=0;o<e.bindables.length;o++){const a=e.bindables[o].getBindGroupEntry();a.binding=o,i.push(a)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{const n=[],i=r.getBindGroupLayoutCount(e.label);for(let o=0;o<e.bindables.length;o++)n.push(e.bindables[o].getShaderCode(o,i));return n.join(`
`)}}const kne={device:null,handle:null,label:null};function NL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kne,r),K.obj(t,e),e.bindables=[],e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),K.setGet(t,e,["label","device","arrayInformation"]),Nne(t,e)}const Vne=K.newInstance(NL);var kL={newInstance:Vne,extend:NL};function Fne(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}const Une={device:null,handle:null};function VL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Une,r),K.obj(t,e),K.get(t,e,["lastCameraMTime"]),K.setGet(t,e,["device","handle"]),Fne(t,e)}const Bne=K.newInstance(VL,"vtkWebGPUShaderModule");var Gne={newInstance:Bne,extend:VL};function Wne(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(r)?r.join(`
`):r;let o=!1;t.search(e)!==-1&&(o=!0);let a="";n&&(a="g");const s=new RegExp(e,a),c=t.replace(s,i);return{replace:o,result:c}}function zne(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{const n=r.getType(),i=r.getHash(),o=e._shaderModules.keys();for(let s=0;s<o.length;s++){const c=o[s];if(c.getHash()===i&&c.getType()===n)return e._shaderModules.get(c)}const a=Gne.newInstance();return a.initialize(e.device,r),e._shaderModules.set(r,a),a}}const $ne={shaderModules:null,device:null,window:null};function FL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$ne,r),e._shaderModules=new Map,K.obj(t,e),K.setGet(t,e,["device","window"]),zne(t,e)}const jne=K.newInstance(FL,"vtkWebGPUShaderCache");var Un={newInstance:jne,extend:FL,substitute:Wne};function Hne(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;const i=[];for(let o=0;o<e.layouts.length;o++)i.push(e.layouts[o].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let o=0;o<e.shaderDescriptions.length;o++){const a=e.shaderDescriptions[o],s=r.getShaderModule(a);a.getType()==="vertex"&&(e.pipelineDescription.vertex.module=s.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),a.getType()==="fragment"&&(e.pipelineDescription.fragment.module=s.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}const Kne={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function UL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kne,r),Zn(t,e),e.layouts=[],e.shaderDescriptions=[],mo(t,e,["handle","pipelineDescription"]),Fr(t,e,["device","renderEncoder","topology","vertexState"]),Hne(t,e)}const qne=Sn(UL,"vtkWebGPUPipeline");var Xne={newInstance:qne,extend:UL};function Yne(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(i)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{const i=[];let o=[];if(n&&i.push(n.getShaderCode()),r||e.builtinInputNames.length){const a=[];if(a.push(`struct ${e.type}Input
{`),r){const s=r.getOutputNamesByReference(),c=r.getOutputTypesByReference(),l=r.getOutputInterpolationsByReference();for(let f=0;f<s.length;f++)l[f]!==void 0?a.push(`  @location(${f}) @interpolate(${l[f]}) ${s[f]} : ${c[f]},`):a.push(`  @location(${f}) ${s[f]} : ${c[f]},`)}for(let s=0;s<e.builtinInputNames.length;s++)a.push(`  ${e.builtinInputNames[s]} : ${e.builtinInputTypes[s]},`);a.length>1&&(a.push("};"),o=a,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=Un.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const a=[`struct ${e.type}Output
{`];for(let s=0;s<e.outputNames.length;s++)e.outputInterpolations[s]!==void 0?a.push(`  @location(${s}) @interpolate(${e.outputInterpolations[s]}) ${e.outputNames[s]} : ${e.outputTypes[s]},`):a.push(`  @location(${s}) ${e.outputNames[s]} : ${e.outputTypes[s]},`);for(let s=0;s<e.builtinOutputNames.length;s++)a.push(`  ${e.builtinOutputNames[s]} : ${e.builtinOutputTypes[s]},`);a.push("};"),o=o.concat(a),e.code=Un.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=Un.substitute(e.code,"//VTK::IOStructs::Dec",o).result}}const Jne={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function BL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jne,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],K.obj(t,e),K.setGet(t,e,["type","hash","code"]),K.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Yne(t,e)}const Zne=K.newInstance(BL,"vtkWebGPUShaderDescription");var F6={newInstance:Zne,extend:BL};const U6={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Qne(t){return!t||t.length<6?0:t in U6?U6[t]:(nn(`unknown format ${t}`),null)}function ere(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return nn(`unknown format ${t}`),0;const i=5-n/2;return e*i}function tre(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function nre(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{nn(`unknown format ${t}`);return}const r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){nn(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function rre(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{nn(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function ire(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function ore(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";nn(`unknown format ${t}`)}}var Oi={getDetailsFromTextureFormat:Qne,getByteStrideFromBufferFormat:ere,getNumberOfComponentsFromBufferFormat:tre,getNativeTypeFromBufferFormat:nre,getShaderTypeFromBufferFormat:rre,getByteStrideFromShaderFormat:ire,getNativeTypeFromShaderFormat:ore};function are(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function sre(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",o=n;Array.isArray(o)||(o=[o]);for(let a=0;a<e.inputs.length;a++)if(are(e.inputs[a].names,o)){if(e.inputs[a].buffer===r)return;e.inputs[a].buffer=r;return}e.inputs.push({buffer:r,stepMode:i,names:o}),e.inputs=e.inputs.sort((a,s)=>a.names[0]<s.names[0]?-1:a.names[0]>s.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let i=0;i<e.inputs.length;i++)for(let o=0;o<e.inputs[i].names.length;o++){const a=e.inputs[i].buffer.getArrayInformation()[o],s=Oi.getShaderTypeFromBufferFormat(a.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[i].names[o]} : ${s}`,n++}return r},t.getVertexInputInformation=()=>{const r={};if(e.inputs.length){const n=[];let i=0;for(let o=0;o<e.inputs.length;o++){const a=e.inputs[o].buffer,s={arrayStride:a.getStrideInBytes(),stepMode:e.inputs[o].stepMode,attributes:[]},c=a.getArrayInformation();for(let l=0;l<e.inputs[o].names.length;l++)s.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;n.push(s)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const cre={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function GL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cre,r),Zn(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Fr(t,e,["created","device","handle","indexBuffer"]),sre(t,e)}const lre=Sn(GL,"vtkWebGPUVertexInput");var ure={newInstance:lre,extend:GL};const fre=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,dre=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function hre(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,i)=>{const o=F6.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),a=F6.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),s=n.getShaderDescriptions();s.push(o),s.push(a);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),u=c.match(l).filter((d,h,g)=>g.indexOf(d)===h).map(d=>`replaceShader${d.substring(7,d.length-2)}`);for(let d=0;d<u.length;d++){const h=u[d];h!=="replaceShaderIOStructs"&&e.shaderReplacements.has(h)&&e.shaderReplacements.get(h)(r,n,i)}t.replaceShaderIOStructs(r,n,i)},t.replaceShaderIOStructs=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.replaceShaderCode(null,i),n.getShaderDescription("fragment").replaceShaderCode(o)},t.replaceShaderRenderEncoder=(r,n,i)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,i)=>{if(!e.WebGPURenderer)return;const o=e.WebGPURenderer.getBindGroup().getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=Un.substitute(s,"//VTK::Renderer::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");s=c.getCode(),s=Un.substitute(s,"//VTK::Renderer::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,i)=>{const o=e.bindGroup.getShaderCode(n),a=n.getShaderDescription("vertex");let s=a.getCode();s=Un.substitute(s,"//VTK::Mapper::Dec",[o]).result,a.setCode(s);const c=n.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),s=c.getCode(),s=Un.substitute(s,"//VTK::Mapper::Dec",[o]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let a=o.getCode();a=Un.substitute(a,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,i)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{const n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?r.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);const i=e.textureViews[n].getSampler();i&&r.push(i)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Xne.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const gre={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function WL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gre,r),Gn.extend(t,e,r),e.textureViews=[],e.vertexInput=ure.newInstance(),e.bindGroup=kL.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||dre,e.vertexShaderTemplate=e.vertexShaderTemplate||fre,e.shaderReplacements=new Map,K.get(t,e,["pipeline","vertexInput"]),K.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),hre(t,e)}const pre=K.newInstance(WL,"vtkWebGPUSimpleMapper");var zL={newInstance:pre,extend:WL};function mre(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();a=Un.substitute(a,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}const vre={};function $L(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vre,r),zL.extend(t,e,r),mre(t,e)}const yre=K.newInstance($L,"vtkWebGPUFullScreenQuad");var yC={newInstance:yre,extend:$L};const wre={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},xre={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var o1={BufferUsage:wre,PrimitiveTypes:xre};const Fw=["getMappedRange","mapAsync","unmap"];function Cre(t,e,r,n){const i=n.byteLength,o=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),a=o.getMappedRange(0,i);new Uint8Array(a).set(new Uint8Array(n)),o.unmap();const s=t.createCommandEncoder();s.copyBufferToBuffer(o,0,e,r,i);const c=s.finish();t.queue.submit([c]),o.destroy()}function Sre(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{Cre(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r.byteLength,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=r.byteLength,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<Fw.length;r++)t[Fw[r]]=function(){return e.handle[Fw[r]](...arguments)}}const Tre={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function jL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tre,r),K.obj(t,e),K.get(t,e,["handle","sizeInBytes","usage"]),K.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),Sre(t,e)}const _re=K.newInstance(jL);var wC={newInstance:_re,extend:jL,...o1};const{Representation:B6}=Zd,{PrimitiveTypes:Al}=o1;class Ere{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}}function Dre(t){switch(t){case Al.Points:return"points";case Al.Lines:return"lines";case Al.Triangles:case Al.TriangleEdges:return"polys";case Al.TriangleStripEdges:case Al.TriangleStrips:return"strips";default:return""}}function cm(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function bre(t,e,r){const n=t.length;for(let a=0;a<n;a++){let s=t[a];if(r.cellProvokedMap.has(s)){r.ibo[r.iboId++]=r.cellProvokedMap.get(s);for(let c=a+1;c<a+n;c++){s=t[c%n];const l=cm(r,s,e);r.ibo[r.iboId++]=l}return}}for(let a=0;a<n;a++){let s=t[a];if(!r.provokedPointIds[s]){let c=cm(r,s,e);r.provokedPointIds[s]=1,r.cellProvokedMap.set(s,c),r.flatIdToCellId[c]=e,r.ibo[r.iboId++]=c;for(let l=a+1;l<a+n;l++)s=t[l%n],c=cm(r,s,e),r.ibo[r.iboId++]=c;return}}let i=t[0],o=r.flatId;r.cellProvokedMap.set(i,o),r.flatIdToPointId[r.flatId]=i,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=o;for(let a=1;a<n;a++)i=t[a],o=cm(r,i,e),r.ibo[r.iboId++]=o}function Ire(t,e,r){const n=t.length;r.iboSize+=n;for(let i=0;i<n;i++){const o=t[i];if(r.cellProvokedMap.has(o))return}for(let i=0;i<n;i++){const o=t[i];if(!r.provokedPointIds[o]){r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}let xc;const G6=new Uint32Array(1),aa=new Uint32Array(2),Cl=new Uint32Array(3),Uw={anythingToPoints(t,e,r,n,i){for(let o=0;o<t;++o)G6[0]=e[r+o],xc(G6,n,i)},linesToWireframe(t,e,r,n,i){for(let o=0;o<t-1;++o)aa[0]=e[r+o],aa[1]=e[r+o+1],xc(aa,n,i)},polysToWireframe(t,e,r,n,i){if(t>2)for(let o=0;o<t;++o)aa[0]=e[r+o],aa[1]=e[r+(o+1)%t],xc(aa,n,i)},stripsToWireframe(t,e,r,n,i){if(t>2){for(let o=0;o<t-1;++o)aa[0]=e[r+o],aa[1]=e[r+o+1],xc(aa,n,i);for(let o=0;o<t-2;o++)aa[0]=e[r+o],aa[1]=e[r+o+2],xc(aa,n,i)}},polysToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)Cl[0]=e[r],Cl[1]=e[r+o+1],Cl[2]=e[r+o+2],xc(Cl,n,i)},stripsToSurface(t,e,r,n,i){for(let o=0;o<t-2;o++)Cl[0]=e[r+o],Cl[1]=e[r+o+1+o%2],Cl[2]=e[r+o+1+(o+1)%2],xc(Cl,n,i)}};function Ore(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{const n=r.cells,i=r.primitiveType,o=r.representation,a=r.cellOffset,s=n.getData(),c=s.length,l=Dre(i),f=r.numberOfPoints,u={provokedPointIds:new Uint8Array(f),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Ere};let d=null;o===B6.POINTS||i===Al.Points?d=Uw.anythingToPoints:o===B6.WIREFRAME||i===Al.Lines?d=Uw[`${l}ToWireframe`]:d=Uw[`${l}ToSurface`],xc=Ire;let h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),d(s[g],s,g+1,h,u),g+=s[g]+1,h++;f<=65535?u.flatIdToPointId=new Uint16Array(f+u.extraPoints):u.flatIdToPointId=new Uint32Array(f+u.extraPoints),f+u.extraPoints<36863?u.pointIdToFlatId=new Int16Array(f):u.pointIdToFlatId=new Int32Array(f),f+u.extraPoints<=65535?(u.ibo=new Uint16Array(u.iboSize),r.format="uint16"):(u.ibo=new Uint32Array(u.iboSize),r.format="uint32"),h<=65535?u.flatIdToCellId=new Uint16Array(f+u.extraPoints):u.flatIdToCellId=new Uint32Array(f+u.extraPoints),u.pointIdToFlatId.fill(-1),u.provokedPointIds.fill(0),xc=bre,h=a||0;for(let g=0;g<c;)u.cellProvokedMap.clear(),d(s[g],s,g+1,h,u),g+=s[g]+1,h++;delete u.provokedPointIds,delete u.pointIdToFlatId,r.nativeArray=u.ibo,e.flatIdToPointId=u.flatIdToPointId,e.flatIdToCellId=u.flatIdToCellId,e.flatSize=u.flatId,e.indexCount=u.iboId}}const Mre={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function HL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mre,r),wC.extend(t,e,r),K.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Ore(t,e)}const Rre=K.newInstance(HL);var Pre={newInstance:Rre,extend:HL,...o1};const{BufferUsage:Sl}=o1,{vtkErrorMacro:Lre}=Ni,{VtkDataTypes:rf}=Lt,Are={};function Nre(t){let e;switch(t.getDataType()){case rf.UNSIGNED_CHAR:e="uint8";break;case rf.FLOAT:e="float32";break;case rf.UNSIGNED_INT:e="uint32";break;case rf.INT:e="sint32";break;case rf.DOUBLE:e="float32";break;case rf.UNSIGNED_SHORT:e="uint16";break;case rf.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Lre(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function W6(t,e,r,n,i){const o={},a=t.getFlatSize();if(!a)return o;let s=[0,0,0,0];i.shift&&(i.shift.length?s=i.shift:s.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let f,u=0;const d=r+(l?1:0),h=Xd(n,a*d);let g=t.getFlatIdToPointId();i.cellData&&(g=t.getFlatIdToCellId()),r===1?f=function(v){h[u++]=c[0]*e[v]+s[0]}:r===2?f=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1]}:r===3&&!l?f=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2]}:r===3&&l?f=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2],h[u++]=c[3]*1+s[3]}:r===4&&(f=function(v){h[u++]=c[0]*e[v]+s[0],h[u++]=c[1]*e[v+1]+s[1],h[u++]=c[2]*e[v+2]+s[2],h[u++]=c[3]*e[v+3]+s[3]});for(let p=0;p<a;p++){const v=r*g[p];f(v)}return o.nativeArray=h,o}function kre(t,e,r,n){const i=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],o=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],a=[];return $s(i,o,a),Hf(a),a}function Vre(t,e){const r=e.getData(),n=t.getData();if(!n||!r)return null;const i=new Int8Array(t.getNumberOfCells()*4),o=n.length;let a=0;for(let s=0;s<o;){const c=kre(r,n[s+1],n[s+2],n[s+3]);i[a++]=127*c[0],i[a++]=127*c[1],i[a++]=127*c[2],i[a++]=127,s+=n[s]+1}return i}function Fre(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let i,o;if(n.usage===Sl.Index&&(i=Pre.newInstance({label:n.label}),i.setDevice(e.device),o=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(n),i.createAndWrite(n.nativeArray,o),i.setArrayInformation([{format:n.format}])),i||(i=wC.newInstance({label:n.label}),i.setDevice(e.device)),n.usage===Sl.UniformArray&&(o=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===Sl.Storage&&(o=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(n.nativeArray,o)),n.usage===Sl.Texture&&(o=GPUBufferUsage.COPY_SRC,i.createAndWrite(n.nativeArray,o)),n.usage===Sl.PointArray){o=GPUBufferUsage.VERTEX;const a=Oi.getNativeTypeFromBufferFormat(n.format),s=W6(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),a,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});i.createAndWrite(s.nativeArray,o),i.setStrideInBytes(Oi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===Sl.NormalsFromPoints){o=GPUBufferUsage.VERTEX;const a=Oi.getNativeTypeFromBufferFormat(n.format),s=Vre(n.cells,n.dataArray),c=W6(n.indexBuffer,s,4,a,{cellData:!0});i.createAndWrite(c.nativeArray,o),i.setStrideInBytes(Oi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===Sl.RawVertex&&(o=GPUBufferUsage.VERTEX,i.createAndWrite(n.nativeArray,o),i.setStrideInBytes(Oi.getByteStrideFromBufferFormat(n.format)),i.setArrayInformation([{offset:0,format:n.format}])),i.setSourceTime(n.time),i}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,i)=>{const o=Nre(n),a={hash:`${n.getMTime()}I${i.getMTime()}${o}`,usage:Sl.PointArray,format:o,dataArray:n,indexBuffer:i};return t.getBuffer(a)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=wC.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const Ure={device:null,fullScreenQuadBuffer:null};function KL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ure,r),Zn(t,e),Fr(t,e,["device"]),Fre(t,e)}const Bre=Sn(KL);var rh={newInstance:Bre,extend:KL,...Are,...o1};const{BufferUsage:Gre}=rh,{vtkErrorMacro:y0}=K;function Wre(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){y0(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);const i=Oi.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:i,offset:e.sizeInBytes,nativeType:Oi.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=i},t.send=r=>{if(!e._buffer){const n={nativeArray:e.Float32Array,usage:Gre.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=K.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){y0(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType];s[(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT]=i},t.setArray=(r,n,i)=>{const o=e._bufferEntryNames.get(r);if(o===void 0){y0(`entry named ${r} not found in UBO`);return}const a=e.bufferEntries[o];t.createView(a.nativeType);const s=e[a.nativeType],c=(a.offset+n*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)s[c+l]=i[l]},t.setAllInstancesFromArray=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){y0(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)a[l+f]=n[c*s+f]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){y0(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<s;f++)a[l+f]=n[c*s+f]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{const i=e._bufferEntryNames.get(r);if(i===void 0){y0(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType],s=9;for(let c=0;c<e.numberOfInstances;c++){const l=(o.offset+c*e.sizeInBytes)/a.BYTES_PER_ELEMENT;for(let f=0;f<3;f++)for(let u=0;u<3;u++)a[l+f*4+u]=n[c*s+f*3+u]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{const i=[`struct ${e.label}StructEntry
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const zre={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function qL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zre,r),K.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},K.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},K.get(t,e,["bindGroupTime"]),K.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Wre(t,e)}const $re=K.newInstance(qL,"vtkWebGPUStorageBuffer");var jre={newInstance:$re,extend:qL};const{BufferUsage:Hre}=rh,{vtkErrorMacro:Bw}=K;function Kre(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){Bw(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:Oi.getByteStrideFromShaderFormat(n),offset:-1,nativeType:Oi.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0;const n=[];let i=4;for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.sizeInBytes%16===0&&(i=Math.max(16,i)),a.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed===!1&&a.sizeInBytes%16===0&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(a.packed===!1&&a.sizeInBytes===12)for(let s=0;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(c.packed===!1&&c.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0)for(let s=o+1;s<e.bufferEntries.length;s++){const c=e.bufferEntries[s];if(!c.packed&&c.sizeInBytes%8===0){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];if(!a.packed&&a.sizeInBytes%8===0){let s=!1;for(let c=0;!s&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let f=c+1;f<e.bufferEntries.length;f++){const u=e.bufferEntries[f];if(!u.packed&&u.sizeInBytes===4){a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes,l.packed=!0,l.offset=r,n.push(l),r+=l.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,s=!0;break}}}}}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];!a.packed&&a.sizeInBytes>4&&(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];a.packed||(a.packed=!0,a.offset=r,n.push(a),r+=a.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let o=0;o<e.bufferEntries.length;o++)e._bufferEntryNames.set(e.bufferEntries[o].name,o);e.sizeInBytes=r,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){const n={nativeArray:e.Float32Array,usage:Hre.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=K.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){Bw(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];o.lastValue!==n&&(a[o.offset/a.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),o.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(r);if(i===void 0){Bw(`entry named ${r} not found in UBO`);return}const o=e.bufferEntries[i];t.createView(o.nativeType);const a=e[o.nativeType];let s=!1;for(let c=0;c<n.length;c++)(!o.lastValue||o.lastValue[c]!==n[c])&&(a[o.offset/a.BYTES_PER_ELEMENT+c]=n[c],s=!0);s&&(e.sendDirty=!0,o.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let o=0;o<e.bufferEntries.length;o++){const a=e.bufferEntries[o];i.push(`  ${a.name}: ${a.type},`)}return i.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const qre={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function XL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qre,r),K.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},K.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,K.get(t,e,["binding","bindGroupTime"]),K.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),Kre(t,e)}const Xre=K.newInstance(XL,"vtkWebGPUUniformBuffer");var ud={newInstance:Xre,extend:XL};const{vtkDebugMacro:Yre}=Ni,z6=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,Jre=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,lm=new Float64Array(16),$6=new Float64Array(16);function Zre(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function Qre(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),o=[],a=[];mr(a,i,.5*(r[0]+r[1])),br(o,n,a),bn(a,o,e.stabilizedCenter),Md(a)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=o,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let i=0;i<n.length;++i)n[i].getSwitch()>0&&r++;return r||(Yre("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{var n;const r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){const i=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",i.wcvc),e.UBO.setArray("SCPCMatrix",i.scpc),e.UBO.setArray("PCSCMatrix",i.pcsc),e.UBO.setArray("SCVCMatrix",i.scvc),e.UBO.setArray("VCPCMatrix",i.vcpc),e.UBO.setArray("WCVCNormals",i.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(n=e.renderable.getEnvironmentTexture())==null?void 0:n.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const o=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[o.usize,o.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const a=e._parent.getDevice();e.UBO.sendIfNeeded(a)}},t.updateSSBO=()=>{const r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let o=0;o<r.length;o++)i+=r[o].getMTime();if(i!==e.lightTimeString){const o=new Float32Array(r.length*4),a=new Float32Array(r.length*4),s=new Float32Array(r.length*4),c=new Float32Array(r.length*4);for(let f=0;f<r.length;f++){const u=f*4,d=r[f].getPosition();Pt(d,d,n.wcvc),o[u]=d[0],o[u+1]=d[1],o[u+2]=d[2],o[u+3]=0,a[u]=-r[f].getDirection()[0],a[u+1]=-r[f].getDirection()[1],a[u+2]=-r[f].getDirection()[2],a[u+3]=0,s[u]=r[f].getColor()[0],s[u+1]=r[f].getColor()[1],s[u+2]=r[f].getColor()[2],s[u+3]=r[f].getIntensity()*5,c[u]=Zre(r[f]),c[u+1]=Math.cos(Tr(r[f].getConeAngle())),c[u+2]=Math.cos(Tr(r[f].getConeAngle()+r[f].getConeFalloff())),c[u+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",o),e.SSBO.setAllInstancesFromArray("LightDir",a),e.SSBO.setAllInstancesFromArray("LightColor",s),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=r=>{const n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var o;if(e.renderable.getTransparent()||e.suppressClear)return;const r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=yC.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(z6);const a=ud.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((o=e.backgroundTex)!=null&&o.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(Jre);const a=ud.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a);const s=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(s.getReady()){const c=s.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const l=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=yC.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(z6);const a=ud.newInstance({label:"mapperUBO"});a.addEntry("FSQMatrix","mat4x4<f32>"),a.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(a)}const n=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),Yt($6,n.normalMatrix),pv(lm,n.scvc,n.pcsc),pv(lm,$6,lm),e.clearFSQ.getUBO().setArray("FSQMatrix",lm),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{const r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],i=r[0]-n[0],o=r[1]-n[1],a=e._parent.normalizedDisplayToDisplay(i,o),s=Math.round(a[0]),c=Math.round(a[1]),l=r[2]-n[0],f=r[3]-n[1],u=e._parent.normalizedDisplayToDisplay(l,f);let d=Math.round(u[0])-s,h=Math.round(u[1])-c;return d<0&&(d=0),h<0&&(h=0),{usize:d,vsize:h,lowerLeftU:s,lowerLeftV:c}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const eie={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function tie(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eie,r),Gn.extend(t,e,r),e.UBO=ud.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=jre.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=kL.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=yt(new Float64Array(16)),e.stabilizedTime={},Zn(e.stabilizedTime,{mtime:0}),mo(t,e,["bindGroup","stabilizedTime"]),Yd(t,e,["stabilizedCenter"]),Fr(t,e,["renderEncoder","selector","suppressClear","UBO"]),Qre(t,e)}const nie=Sn(tie,"vtkWebGPURenderer");Ia("vtkRenderer",nie);function rie(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const iie={device:null,handle:null,label:null,options:null};function YL(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iie,r),K.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","handle","options"]),K.setGet(t,e,["bindGroupLayoutEntry","device","label"]),rie(t,e)}const oie=K.newInstance(YL);var JL={newInstance:oie,extend:YL};const{SlicingMode:j6}=n5,aie=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function sie(t,e,r){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${r}`}return"0"}const ko=new Float64Array(16),Es=new Float64Array(16),um=new Float64Array(16),pc=new Float64Array(4),Xr=new Float64Array(4);function cie(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const o=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(o.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),o=e.WebGPUImageSlice.getRenderable(),a=o.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||o.getProperty().getMTime()>i){const s=a.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();yt(ko),Wn(ko,ko,c);const l=o.getMatrix();Yt(Es,l),Or(Es,Es),rn(ko,Es,ko);const f=s.getWorldToIndex();rn(ko,f,ko),Or(um,ko),Hy(Es,[.5,.5,.5]),rn(ko,Es,ko);const u=s.getDimensions();yt(Es),Wc(Es,Es,[1/u[0],1/u[1],1/u[2]]),rn(ko,Es,ko),e.UBO.setArray("SCTCMatrix",ko);const d=e.currentInput.getExtent(),{ijkMode:h}=e.renderable.getClosestIJKAxis();let g=e.renderable.getSlice();h!==e.renderable.getSlicingMode()&&(g=e.renderable.getSliceAtPosition(g));let p=2,v=0,w=1;h===j6.I?(p=0,v=1,w=2):h===j6.J&&(p=1,v=2,w=0),pc[p]=g,pc[v]=d[v*2]-.5,pc[w]=d[w*2]-.5,pc[3]=1,$l(pc,pc,um),e.UBO.setArray("Origin",pc),Xr[p]=g,Xr[v]=d[v*2+1]+.5,Xr[w]=d[w*2]-.5,Xr[3]=1,$l(Xr,Xr,um),YE(Xr,Xr,pc),Xr[3]=1,e.UBO.setArray("Axis1",Xr),Xr[p]=g,Xr[v]=d[v*2]-.5,Xr[w]=d[w*2+1]+.5,Xr[3]=1,$l(Xr,Xr,um),YE(Xr,Xr,pc),Xr[3]=1,e.UBO.setArray("Axis2",Xr);const m=[1,1,1,1],y=[0,0,0,0],x=e.textureViews[0],C=x.getTexture().getScale(),S=x.getTexture().getNumberOfComponents();for(let T=0;T<S;T++){let _=o.getProperty().getColorWindow(),E=o.getProperty().getColorLevel();const b=o.getProperty().getRGBTransferFunction(0);if(b){const I=b.getRange();_=I[1]-I[0],E=.5*(I[1]+I[0])}m[T]=C/_,y[T]=-E/_+.5}e.UBO.setArray("cScale",m),e.UBO.setArray("cShift",y),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const a=1,s=sie(i,i.getRGBTransferFunction,a);if(e.colorTextureString!==s){e.numRows=a;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const f=new Float32Array(e.rowLength*3);for(let u=0;u<a;u++){l=i.getRGBTransferFunction(u);const d=l.getRange();l.getTable(d[0],d[1],e.rowLength,f,1);for(let h=0;h<e.rowLength;h++){const g=u*e.rowLength*8+h*4;c[g]=255*f[h*3],c[g+1]=255*f[h*3+1],c[g+2]=255*f[h*3+2],c[g+3]=255;for(let p=0;p<4;p++)c[g+e.rowLength*4+p]=c[g+p]}}}else for(let f=0;f<e.rowLength;++f){const u=255*f/(e.rowLength-1);c[f*4]=u,c[f*4+1]=u,c[f*4+2]=u,c[f*4+3]=255;for(let d=0;d<4;d++)c[f*4+e.rowLength*4+d]=c[f*4+d]}{const f={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},d=e.device.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[1]=d}e.colorTextureString=s}};const r=t.updateBuffers;t.updateBuffers=()=>{r();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),o=e.textureViews;if(!o[0]||o[0].getTexture()!==i){const c=i.createView("imgTexture");o[0]=c}t.updateLUTImage(),t.updateUBO();const s=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===Pf.NEAREST?"nearest":"linear";(!e.clampSampler||s!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=JL.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:s,magFilter:s}),e.additionalBindables=[e.clampSampler])};const n=t.getShaderReplacements();t.replaceShaderPosition=(i,o,a)=>{const s=o.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=s.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=Un.substitute(c,"//VTK::Position::Impl",l).result,s.setCode(c)},n.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,o,a)=>{const s=o.getShaderDescription("vertex");e.dimensions===2?s.addOutput("vec2<f32>","tcoordVS"):s.addOutput("vec3<f32>","tcoordVS")},n.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,o,a)=>{const s=o.getShaderDescription("fragment");let c=s.getCode();e.dimensions===3?c=Un.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=Un.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=Un.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,s.setCode(c)},n.set("replaceShaderImage",t.replaceShaderImage)}const lie={rowLength:1024};function uie(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lie,r),yC.extend(t,e,r),t.setFragmentShaderTemplate(aie),e.UBO=ud.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Zn(e.lutBuildTime,{mtime:0}),e.imagemat=yt(new Float64Array(16)),e.imagematinv=yt(new Float64Array(16)),e.VBOBuildTime={},Zn(e.VBOBuildTime),cie(t,e)}const fie=Sn(uie,"vtkWebGPUImageMapper");Ia("vtkImageMapper",fie);function die(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=r=>{if(!(!e.renderable||!e.renderable.getVisibility())&&r){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children.forEach(n=>{n.traverse(r)}),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix(),i=r.getStabilizedCenterByReference();e.bufferShift[0]=n[3]-i[0],e.bufferShift[1]=n[7]-i[1],e.bufferShift[2]=n[11]-i[2],Yt(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?yt(e.keyMatrices.normalMatrix):(sr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Or(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Yt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Wn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Wn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const hie={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function gie(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hie,r),Gn.extend(t,e,r),e.keyMatricesTime={},Zn(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Zn(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:yt(new Float64Array(16))},e.bufferShift=[0,0,0,0],mo(t,e,["propID","keyMatricesTime"]),die(t,e)}const pie=Sn(gie,"vtkWebGPUImageSlice");Ia("vtkImageSlice",pie);function mie(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,o)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const a=e.renderable.getMapper().getBounds();if(!a||a.length!==6||a[0]>a[1])return;o.addVolume(t)}};const r=new Float64Array(3),n=new Float64Array(3);t.getBoundingCubePoints=(i,o)=>{const a=e.renderable.getMapper().getInputData();if(!a)return;const s=a.getExtent(),c=e.renderable.getMatrix();let l=0;for(let f=4;f<6;f++){r[2]=s[f];for(let u=2;u<4;u++){r[1]=s[u];for(let d=0;d<2;d++){r[0]=s[d],a.indexToWorld(r,n);let h=o+l*3;i[h++]=c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3],i[h++]=c[4]*n[0]+c[5]*n[1]+c[6]*n[2]+c[7],i[h++]=c[8]*n[0]+c[9]*n[1]+c[10]*n[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const o=e.renderable.getMatrix(),a=i.getStabilizedCenterByReference();Yt(e.keyMatrices.bcwc,o),Wn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const vie={propID:void 0,keyMatricesTime:null};function yie(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vie,r),Gn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),mie(t,e)}const wie=K.newInstance(yie,"vtkWebGPUVolume");Ia("vtkVolume",wie);function xie(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),o=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,a=e.WebGPURenderer.getTiledSizeAndOrigin(),s=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),o,i,a,s)}}const Cie={};function Sie(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cie,r),Gn.extend(t,e,r),xie(t,e)}const Tie=K.newInstance(Sie,"vtkWebGPUPixelSpaceCallbackMapper");Ia("vtkPixelSpaceCallbackMapper",Tie);const H6=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],K6=[[0,-1,0],[0,1,0]],_ie=[[0,-1,0],[0,1,0],[0,0,-1]],Eie=[[0,-1,0],[0,1,0],[0,0,1]];var Cd;let I0=(Cd=class{static copyMap(e,r){for(const[n,i]of r.rows)e.rows.set(n,structuredClone(i))}constructor(e,r,n=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const o=(a,s,c)=>{const{start:l,end:f,value:u}=s;for(let d=l;d<f;d++)i[a+d]=u};this.forEach(o)},this.get=i=>{const o=i%this.jMultiple,a=(i-o)/this.jMultiple,s=this.getRLE(o,a);return(s==null?void 0:s.value)??this.defaultValue},this.getRun=(i,o)=>{const a=i+o*this.height;return this.rows.get(a)},this.set=(i,o)=>{if(o===void 0)return;const a=i%this.width,s=(i-a)/this.width,c=this.rows.get(s);if(!c){this.rows.set(s,[{start:a,end:a+1,value:o}]);return}const l=this.findIndex(c,a),f=c[l],u=c[l-1];if(!f){if(!u||u.value!==o||u.end!==a){c[l]={start:a,end:a+1,value:o};return}u.end++;return}const{start:d,end:h,value:g}=f;if(o===g&&a>=d)return;const p={start:a,end:a+1,value:o},v=a>d,w=v?l+1:l,m=v?f:u;let y=v?c[l+1]:f;if((m==null?void 0:m.value)===o&&(m==null?void 0:m.end)===a){m.end++,(y==null?void 0:y.value)===o&&y.start===a+1?(m.end=y.end,c.splice(l,1)):(y==null?void 0:y.start)===a&&(y.start++,y.start===y.end&&(c.splice(l,1),y=c[l],(y==null?void 0:y.start)===a+1&&y.value===o&&(m.end=y.end,c.splice(l,1))));return}if((y==null?void 0:y.value)===o&&y.start===a+1){y.start--,(m==null?void 0:m.end)>a&&(m.end=a,m.end===m.start&&c.splice(l,1));return}if((y==null?void 0:y.start)===a&&y.end===a+1){y.value=o;const x=c[l+1];(x==null?void 0:x.start)==a+1&&x.value===o&&(c.splice(l+1,1),y.end=x.end);return}a===(y==null?void 0:y.start)&&y.start++,v&&h>a+1?c.splice(w,0,p,{start:a+1,end:m.end,value:m.value}):c.splice(w,0,p),(m==null?void 0:m.end)>a&&(m.end=a)},this.width=e,this.height=r,this.depth=n,this.jMultiple=e,this.kMultiple=this.jMultiple*r}toIJK(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[r,n,i]}toIndex([e,r,n]){return e+n*this.kMultiple+r*this.jMultiple}getRLE(e,r,n=0){const i=this.rows.get(r+n*this.height);if(!i)return;const o=this.findIndex(i,e),a=i[o];return e>=(a==null?void 0:a.start)?a:void 0}has(e){const r=e%this.jMultiple,n=(e-r)/this.jMultiple,i=this.getRLE(r,n);return(i==null?void 0:i.value)!==void 0}delete(e){const r=e%this.width,n=(e-r)/this.width,i=this.rows.get(n);if(!i)return;const o=this.findIndex(i,r),a=i[o];if(!a||a.start>r)return;if(a.end===r+1){a.end--,a.start>=a.end&&(i.splice(o,1),i.length||this.rows.delete(n));return}if(a.start===r){a.start++;return}const s={value:a.value,start:r+1,end:a.end};a.end=r,i.splice(o+1,0,s)}findIndex(e,r){for(let n=0;n<e.length;n++){const{end:i}=e[n];if(r<i)return n}return e.length}forEach(e,r){const n=r==null?void 0:r.rowModified;for(const[i,o]of this.rows){const a=n?[...o]:o;for(const s of a)e(i*this.width,s,o)}}forEachRow(e){for(const[r,n]of this.rows)e(r*this.width,n)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,r){r?r.fill(0):r=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:n,height:i,numComps:o}=this;for(let a=0;a<i;a++){const s=this.getRun(a,e);if(s)if(o===1)for(const c of s){const l=a*n,{start:f,end:u,value:d}=c;for(let h=f;h<u;h++)r[l+h]=d}else for(const c of s){const l=a*n*o,{start:f,end:u,value:d}=c;for(let h=f;h<u;h+=o)for(let g=0;g<o;g++)r[l+h+g]=d[g]}}return r}floodFill(e,r,n,i,o){const a=this.getRLE(e,r,n);if(!a)throw new Error(`Initial point ${e},${r},${n} isn't in the RLE`);const s=[[a,r,n]],c=a.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(s,c,i,o)}flood(e,r,n,i){let o=0;const{planar:a=!0,diagonals:s=!0,singlePlane:c=!1}=i||{},l={planar:a,diagonals:s,singlePlane:c};for(;e.length;){const f=e.pop(),[u]=f;if(u.value!==r)continue;u.value=n,o+=u.end-u.start;const d=this.findAdjacents(f,l).filter(h=>h&&h[0].value===r);e.push(...d)}return o}fillFrom(e,r){for(let n=r[2][0];n<=r[2][1];n++)for(let i=r[1][0];i<=r[1][1];i++){let o,a;for(let s=r[0][0];s<=r[0][1];s++){const c=e(s,i,n);if(c===void 0){o=void 0;continue}a||(a=[],this.rows.set(i+n*this.height,a)),o&&o.value!==c&&(o=void 0),o||(o={start:s,end:s,value:c},a.push(o)),o.end++}}}findAdjacents(e,{diagonals:r=!0,planar:n=!0,singlePlane:i=!1}){const[o,a,s,c]=e,{start:l,end:f}=o,u=l>0&&this.getRLE(l-1,a,s),d=f<this.width&&this.getRLE(f,a,s),h=r?[l>0?l-1:l,f<this.width?f+1:f]:[l,f],g=[];u&&g.push([u,a,s]),d&&g.push([d,a,s]);for(const p of c||(i?K6:H6)){const[,v,w]=p,m=v+a,y=w+s;if(m<0||m>=this.height||y<0||y>=this.depth)continue;const x=this.getRun(m,y);if(x)for(const C of x){const S=c||i&&K6||n&&w>0&&Eie||n&&w<0&&_ie||H6;C.end<=h[0]||C.start>=h[1]||g.push([C,m,y,S])}}return g}},Cd.getScalarData=function(e=Uint8ClampedArray){const r=new e(this.frameSize);return this.map.updateScalarData(r),r},Cd),S2=class cg{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:r=1024,dimensions:n=3,growSize:i=128}=e,o=r*n;this.growSize=i,this.array=new ArrayBuffer(o*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=n}forEach(e){for(let r=0;r<this._length;r++)e(this.getPoint(r),r)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;return this.data.subarray(r,r+this._dimensions)}getPointArray(e){const r=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;for(let i=0;i<this._dimensions;i++)r.push(this.data[i+n]);return r}grow(e=1,r=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const n=this.data.length+r,i=new ArrayBuffer(n*this._dimensions*this._byteSize),o=new Float32Array(i);o.set(this.data),this.data=o,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let r=0;r<e;r++){const n=r*this._dimensions,i=(this._length-1-r)*this._dimensions;for(let o=0;o<this._dimensions;o++){const a=this.data[n+o];this.data[n+o]=this.data[i+o],this.data[i+o]=a}}}getTypedArray(){return this.data}push(e){this.grow(1);const r=this.length*this._dimensions;for(let n=0;n<this._dimensions;n++)this.data[n+r]=e[n];this._length++}map(e){const r=[];for(let n=0;n<this._length;n++)r.push(e(this.getPoint(n),n));return r}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:r,y:n,z:i}=e;return this.forEach(o=>{r.push(o[0]),n.push(o[1]),i&&i.push(o[2])}),e}static fromXYZ({x:e,y:r,z:n}){const i=cg.create3(e.length);let o=0;for(let a=0;a<e.length;a++)i.data[o++]=e[a],i.data[o++]=r[a],i.data[o++]=n?n[a]:0;return i._length=e.length,i}subselect(e=10,r=0){const n=new cg({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const o=(r+Math.floor(this.length*i/e))%this.length;n.push(this.getPoint(o))}return n}static create3(e=128,r){e=Math.max(e,(r==null?void 0:r.length)||0);const n=new cg({initialSize:e,dimensions:3});return r&&r.forEach(i=>n.push(i)),n}static create2(e=128){return new cg({initialSize:e,dimensions:2})}};function ZL(t){const e=Ae(),r=t.getDimensions(),n=S2.create3(r[0]),i=S2.create3(r[1]),o=S2.create3(r[2]),a=t.getDirection(),s=a.slice(0,3),c=a.slice(3,6),l=a.slice(6,9),f=t.getSpacing(),[u,d,h]=f,g=t.indexToWorld([0,0,0]),p=xt(s[0]*u,s[1]*u,s[2]*u),v=xt(c[0]*d,c[1]*d,c[2]*d),w=xt(l[0]*h,l[1]*h,l[2]*h),m=Ae();for(let S=0;S<r[0];S++)n.push(br(m,g,mr(m,p,S)));for(let S=0;S<r[1];S++)i.push(mr(m,v,S));for(let S=0;S<r[2];S++)o.push(mr(m,w,S));const y=n.getTypedArray(),x=i.getTypedArray(),C=o.getTypedArray();return(S,T=e)=>{const[_,E,D]=S,b=_*3,I=E*3,R=D*3;return T[0]=y[b]+x[I]+C[R],T[1]=y[b+1]+x[I+1]+C[R+1],T[2]=y[b+2]+x[I+2]+C[R+2],T}}function c5(t,e){const{pointInShapeFn:r,callback:n,boundsIJK:i,returnPoints:o=!1}=e;let a;t.getScalarData?a=t.getScalarData():a=t.getPointData().getScalars().getData();const s=t.getDimensions(),c=[[0,s[0]],[0,s[1]],[0,s[2]]],f=Die({imageData:t,bounds:i||c,scalarData:a,pointInShapeFn:r,callback:n});return o?f:void 0}function Die({imageData:t,bounds:e,scalarData:r,pointInShapeFn:n,callback:i}){const[[o,a],[s,c],[l,f]]=e,{numComps:u}=t,d=t.getDimensions(),h=ZL(t),g=[0,0,0],p=u||r.length/d[2]/d[1]/d[0],v=d[0]*p,w=d[1]*v,m=[];for(let y=l;y<=f;y++){g[2]=y;const x=y*w;for(let C=s;C<=c;C++){g[1]=C;const S=x+C*v;for(let T=o;T<=a;T++){g[0]=T;const _=h(g);if(n(_,g)){const E=S+T*p;let D;p>2?D=[r[E],r[E+1],r[E+2]]:D=r[E],m.push({value:D,index:E,pointIJK:g,pointLPS:_.slice()}),i({value:D,index:E,pointIJK:g,pointLPS:_})}}}}return m}function bie({voxelManager:t,bounds:e,imageData:r,pointInShapeFn:n,callback:i}){const[[o,a],[s,c],[l,f]]=e,u=ZL(r),d=[0,0,0],h=[];for(let g=l;g<=f;g++){d[2]=g;for(let p=s;p<=c;p++){d[1]=p;for(let v=o;v<=a;v++){d[0]=v;const w=u(d);if(n(w,d)){const m=t.toIndex(d),y=t.getAtIndex(m);h.push({value:y,index:m,pointIJK:[...d],pointLPS:w.slice()}),i==null||i({value:y,index:m,pointIJK:d,pointLPS:w})}}}}return h}const Iie=5*1024;let ls=class Yr{constructor(e,r){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(n,i,o)=>{const a=this.toIndex([n,i,o]);return this._get(a)},this.setAtIJK=(n,i,o,a)=>{const s=this.toIndex([n,i,o]),c=this._set(s,a);return c!==!1&&(this.modifiedSlices.add(o),Yr.addBounds(this.boundsIJK,[n,i,o])),c},this.getAtIJKPoint=([n,i,o])=>this.getAtIJK(n,i,o),this.setAtIJKPoint=([n,i,o],a)=>{this.setAtIJK(n,i,o,a)},this.getAtIndex=n=>this._get(n),this.setAtIndex=(n,i)=>{const o=this._set(n,i);if(o!==!1){const a=this.toIJK(n);this.modifiedSlices.add(a[2]),Yr.addBounds(this.boundsIJK,a)}return o},this.getMiddleSliceData=()=>{const n=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:n,slicePlane:2})},this.forEach=(n,i={})=>{const o=i.boundsIJK||this.getBoundsIJK(),a=i.isInObject||this.isInObject||(()=>!0),s=i.returnPoints||!1,c=i.imageData,l=Math.min(o[0][0],o[0][1]),f=Math.max(o[0][0],o[0][1]),u=Math.min(o[1][0],o[1][1]),d=Math.max(o[1][0],o[1][1]),h=Math.min(o[2][0],o[2][1]),g=Math.max(o[2][0],o[2][1]),p=[];if(c)return bie({voxelManager:this,imageData:i.imageData,bounds:[[l,f],[u,d],[h,g]],pointInShapeFn:a,callback:n});if(this.map){if(this.map instanceof I0)return this.rleForEach(n,i);for(const v of this.map.keys()){const w=this.toIJK(v);if(!a(null,w))continue;const m=this._get(v);s&&p.push({value:m,index:v,pointIJK:w,pointLPS:null}),n({value:m,index:v,pointIJK:w,pointLPS:null})}return p}else{for(let v=h;v<=g;v++){const w=v*this.frameSize;for(let m=u;m<=d;m++){const y=w+m*this.width;for(let x=l,C=y+x;x<=f;x++,C++){const S=this.getAtIndex(C),T=[x,m,v];a(null,T)&&(s&&p.push({value:S,index:C,pointIJK:T,pointLPS:null}),n({value:S,index:C,pointIJK:[x,m,v],pointLPS:null}))}}}return p}},this.getSliceData=({sliceIndex:n,slicePlane:i})=>{const[o,a,s]=this.dimensions,c=o*a,l=n*c;let f;const u=this.getConstructor();function d(g){return typeof g=="function"}if(!d(u))return new Uint8Array(0);let h;switch(i){case 0:f=a*s,h=new u(f);for(let g=0;g<a;g++)for(let p=0;p<s;p++){const v=n+g*o+p*c;this.setSliceDataValue(h,g*s+p,this._get(v))}break;case 1:f=o*s,h=new u(f);for(let g=0;g<o;g++)for(let p=0;p<s;p++){const v=g+n*o+p*c;this.setSliceDataValue(h,g+p*o,this._get(v))}break;case 2:f=o*a,h=new u(f);for(let g=0;g<f;g++)this.setSliceDataValue(h,g,this._get(l+g));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=r._get,this._set=r._set,this._id=r._id||"",this._getConstructor=r._getConstructor,this.numberOfComponents=this.numberOfComponents||1,this.scalarData=r.scalarData,this._getScalarData=r._getScalarData,this._updateScalarData=r._updateScalarData}getMinMax(){let e,r;const n=({value:i})=>{const o=Array.isArray(i);if(e===void 0&&(e=o?[...i]:i,r=o?[...i]:i),o)for(let a=0;a<i.length;a++)e[a]=Math.min(e[a],i[a]),r[a]=Math.max(r[a],i[a]);else e=Math.min(e,i),r=Math.max(r,i)};return this.forEach(n,{boundsIJK:this.getDefaultBounds()}),{min:e,max:r}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,r){const n=(r==null?void 0:r.boundsIJK)||this.getBoundsIJK(),{isWithinObject:i}=r||{},o=this.map;o.defaultValue=void 0;for(let a=n[2][0];a<=n[2][1];a++)for(let s=n[1][0];s<=n[1][1];s++){const c=o.getRun(s,a);if(c)for(const l of c){const{start:f,end:u,value:d}=l,h=this.toIndex([0,s,a]);for(let g=f;g<u;g++){const p={value:d,index:h+g,pointIJK:[g,s,a]};(i==null?void 0:i(p))!==!1&&e(p)}}}}getScalarData(e=!1){var r;if(this.scalarData)return(r=this._updateScalarData)==null||r.call(this,this.scalarData),this.scalarData;if(this._getScalarData){const n=this._getScalarData();return e&&console.log("Not transient, should store value",n),n}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var e,r;(e=this.map)==null||e.clear(),this.boundsIJK.map(n=>{n[0]=1/0,n[1]=-1/0}),this.modifiedSlices.clear(),(r=this.points)==null||r.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(e,r){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(r[0],e[0][0]),e[0][1]=Math.max(r[0],e[0][1]),e[1][0]=Math.min(r[1],e[1][0]),e[1][1]=Math.max(r[1],e[1][1]),e[2][0]=Math.min(r[2],e[2][0]),e[2][1]=Math.max(r[2],e[2][1])}addPoint(e){const r=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(r)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,r,n){if(Array.isArray(n))for(let i=0;i<n.length;i++)e[r*n.length+i]=this.toNumber(n[i]);else e[r]=this.toNumber(n)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n=3}){const i=new Yr(e,{_get:o=>(o*=n,[r[o++],r[o++],r[o++]]),_id:"_createRGBScalarVolumeVoxelManager",_set:(o,a)=>{o*=3;const s=!At(r[o],a);return r[o++]=a[0],r[o++]=a[1],r[o++]=a[2],s},numberOfComponents:n,scalarData:r});return i.clear=()=>{r.fill(0)},i}static createImageVolumeVoxelManager({dimensions:e,imageIds:r,numberOfComponents:n=1}){const i=e[0]*e[1];function o(f){const u=Math.floor(f/i);if(u<0||u>=e[2])return{};const d=r[u];if(!d)return console.warn(`ImageId not found for sliceIndex: ${u}`),{pixelData:null,pixelIndex:null};const h=ke.getImage(d);if(!h)return console.warn(`Image not found for imageId: ${d}`),{pixelData:null,pixelIndex:null};const g=h.voxelManager,p=f%i;return{voxelManager:g,pixelIndex:p}}function a(f){const{voxelManager:u,pixelIndex:d}=o(f);return!u||d===null?null:u.getAtIndex(d)}function s(f,u){const{voxelManager:d,pixelIndex:h}=o(f);if(!d||h===null)return!1;const g=d.getAtIndex(h),p=!At(u,g);return p&&(d.setAtIndex(h,u),!0)}const c=()=>{const{voxelManager:f}=o(0);return f?f.getConstructor():null},l=new Yr(e,{_get:a,_set:s,numberOfComponents:n,_getConstructor:c,_id:"createImageVolumeVoxelManager"});return l.getMiddleSliceData=()=>{const f=Math.floor(e[2]/2);return l.getSliceData({sliceIndex:f,slicePlane:2})},l.clear=()=>{for(const f of r)ke.getImage(f).voxelManager.clear()},l.getRange=()=>{let f=1/0,u=-1/0;for(const d of r){const h=ke.getImage(d);h&&(h.minPixelValue<f&&(f=h.minPixelValue),h.maxPixelValue>u&&(u=h.maxPixelValue))}return f===1/0&&u===-1/0?[0,0]:[f,u]},l._getScalarDataLength=()=>{const{voxelManager:f}=o(0);return f?f.getScalarDataLength()*e[2]:0},l.getCompleteScalarDataArray=()=>{const f=l._getConstructor();if(!f)return new Uint8Array(0);const u=l.getScalarDataLength(),d=new f(u),h=e[0]*e[1]*n;for(let g=0;g<e[2];g++){const{voxelManager:p}=o(g*h/n);if(p){const v=g*h,w=p.getScalarData();if(n===1)d.set(w,v);else for(let m=0;m<w.length;m+=n)for(let y=0;y<n;y++)d[v+m+y]=w[m+y]}}return d},l.setCompleteScalarDataArray=f=>{const u=e[0]*e[1]*n,d=l._getConstructor();let h=1/0,g=-1/0;for(let p=0;p<e[2];p++){const{voxelManager:v}=o(p*u/n);if(v&&d){const w=p*u,m=w+u,y=new d(u);y.set(f.subarray(w,m)),v.scalarData=y;for(let S=0;S<y.length;S++){const T=y[S];h=Math.min(h,T),g=Math.max(g,T)}const x=r[p],C=ke.getImage(x);C&&(C.minPixelValue=h,C.maxPixelValue=g)}}for(let p=0;p<e[2];p++)l.modifiedSlices.add(p);l.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},l}static createScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n=1}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!n&&(n=r.length/e[0]/e[1]/e[2],n>4||n<1||n===2))throw new Error(`Number of components ${n} must be 1, 3 or 4`);return n>1?Yr._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:r,numberOfComponents:n}):Yr._createNumberVolumeVoxelManager({dimensions:e,scalarData:r})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:r,timePoint:n=0,numberOfComponents:i=1}){if(!i){const s=ke.getImage(e[0][0]);if(!s)throw new Error("Unable to determine number of components: No image found");if(i=s.getPixelData().length/(r[0]*r[1]),i>4||i<1||i===2)throw new Error(`Number of components ${i} must be 1, 3 or 4`)}const o=e.map(s=>Yr.createImageVolumeVoxelManager({dimensions:r,imageIds:s,numberOfComponents:i})),a=new Yr(r,{_get:s=>o[n]._get(s),_set:(s,c)=>o[n]._set(s,c),numberOfComponents:i,_id:"createScalarDynamicVolumeVoxelManager"});return a.getScalarDataLength=()=>o[n].getScalarDataLength(),a.getConstructor=()=>o[n].getConstructor(),a.getRange=()=>o[n].getRange(),a.getMiddleSliceData=()=>o[n].getMiddleSliceData(),a.setTimePoint=s=>{n=s,a._get=c=>o[n]._get(c),a._set=(c,l)=>o[n]._set(c,l)},a.getAtIndexAndTimePoint=(s,c)=>o[c]._get(s),a.getTimePointScalarData=s=>o[s].getCompleteScalarDataArray(),a.getTimePointScalarData=s=>o[s].getCompleteScalarDataArray(),a.getCurrentTimePointScalarData=()=>o[n].getCompleteScalarDataArray(),a}static createImageVoxelManager({width:e,height:r,scalarData:n,numberOfComponents:i=1}){const o=[e,r,1];if(!i&&(i=n.length/e/r,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Yr._createRGBScalarVolumeVoxelManager({dimensions:o,scalarData:n,numberOfComponents:i}):Yr._createNumberVolumeVoxelManager({dimensions:o,scalarData:n})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:r}){const n=new Yr(e,{_get:i=>r[i],_set:(i,o)=>{const a=r[i]!==o;return r[i]=o,a},_getConstructor:()=>r.constructor,_id:"_createNumberVolumeVoxelManager"});return n.scalarData=r,n.clear=()=>{n.scalarData.fill(0)},n.getMiddleSliceData=()=>{const i=Math.floor(e[2]/2);return n.getSliceData({sliceIndex:i,slicePlane:2})},n}static createMapVoxelManager({dimension:e}){const r=new Map,n=new Yr(e,{_get:r.get.bind(r),_set:(i,o)=>r.set(i,o)&&!0,_id:"createMapVoxelManager"});return n.map=r,n}static createHistoryVoxelManager({sourceVoxelManager:e}){const r=new Map,{dimensions:n}=e,i=new Yr(n,{_get:o=>r.get(o),_set:function(o,a){if(r.has(o))a===r.get(o)&&r.delete(o);else{const s=this.sourceVoxelManager.getAtIndex(o);if(s===a)return!1;r.set(o,s)}this.sourceVoxelManager.setAtIndex(o,a)},_id:"createHistoryVoxelManager"});return i.map=r,i.scalarData=e.scalarData,i.sourceVoxelManager=e,i}static createRLEHistoryVoxelManager(e){const{dimensions:r}=e,n=new I0(r[0],r[1],r[2]),i=new Yr(r,{_get:o=>n.get(o),_set:function(o,a){const s=n.get(o);if(s===void 0){const c=this.sourceVoxelManager.getAtIndex(o);if(c===a||c===void 0&&a===0||a===null)return!1;n.set(o,c??0)}else(a===s||a===null)&&(n.delete(o),a=s);this.sourceVoxelManager.setAtIndex(o,a)},_getScalarData:I0.getScalarData,_updateScalarData:o=>(n.updateScalarData(o),o),_id:"createRLEHistoryVoxelManager"});return i.map=n,i.sourceVoxelManager=e,i}static createLazyVoxelManager({dimensions:e,planeFactory:r}){const n=new Map,[i,o]=e,a=i*o,s=new Yr(e,{_get:c=>n.get(Math.floor(c/a))[c%a],_set:(c,l)=>{const f=Math.floor(c/a);let u=n.get(f);return u||(u=r(i,o),n.set(f,u)),u[c%a]=l,!0},_id:"createLazyVoxelManager"});return s.map=n,s}static createRLEVolumeVoxelManager({dimensions:e}){const[r,n,i]=e,o=new I0(r,n,i),a=new Yr(e,{_get:s=>o.get(s),_set:(s,c)=>(o.set(s,c),!0),_getScalarData:I0.getScalarData,_updateScalarData:s=>(o.updateScalarData(s),s),_id:"createRLEVolumeVoxelManager"});return a.map=o,a.getPixelData=o.getPixelData.bind(o),a}static createRLEImageVoxelManager({dimensions:e}){const[r,n]=e;return Yr.createRLEVolumeVoxelManager({dimensions:[r,n,1]})}static addInstanceToImage(e){const{width:r,height:n}=e,i=e.voxelManager.getScalarData();if(i.length>=r*n){e.voxelManager=Yr.createScalarVolumeVoxelManager({dimensions:[r,n,1],scalarData:i});return}e.voxelManager=Yr.createRLEVolumeVoxelManager({dimensions:[r,n,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=Iie}};class ih{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null;const{imageIds:r,scaling:n,dimensions:i,spacing:o,origin:a,direction:s,dataType:c,volumeId:l,referencedVolumeId:f,metadata:u,referencedImageIds:d,additionalDetails:h,voxelManager:g,numberOfComponents:p}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:v}=e;this.imageIds=r,this.volumeId=l,this.metadata=u,this.dimensions=i,this.spacing=o,this.origin=a,this.direction=s,this.dataType=c,this.vtkOpenGLTexture=qee.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=g??ls.createImageVolumeVoxelManager({dimensions:i,imageIds:r,numberOfComponents:p}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],v||(v=eh.newInstance(),v.setDimensions(i),v.setSpacing(o),v.setDirection(s),v.setOrigin(a)),v.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:p||1}),v.set({hasScalarVolume:!1}),this.imageData=v,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),n&&(this.scaling=n),f&&(this.referencedVolumeId=f),d&&(this.referencedImageIds=d),h&&(this.additionalDetails=h)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,r)=>{const n=wr(e);this._imageIdsIndexMap.set(e,r),this._imageURIsIndexMap.set(n,r)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){ke.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(r=>ke.getImage(r))}}let kh={};const Hl={add:(t,e)=>{Hl.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const r=e.type;kh[t]||(kh[t]={}),kh[t][r]=e.metadata},get:(t,e)=>{var r;return(r=kh[e])==null?void 0:r[t]},clear:()=>{kh={}}};th(Hl.get);const ei=new u_("imageLoadPool");ei.grabDelay=0;ei.setMaxSimultaneousRequests(Wt.Interaction,1e3);ei.setMaxSimultaneousRequests(Wt.Thumbnail,1e3);ei.setMaxSimultaneousRequests(Wt.Prefetch,1e3);const Pv={};let Lv;function QL(t,e){const r=ke.getImageLoadObject(t);if(r)return q6(r.promise,t),r;const n=t.split(":")[0],i=Pv[n]||Lv;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${n}'`);const o=i(t,e);return q6(o.promise,t),o}function q6(t,e){Promise.resolve(t).then(r=>{Oie(r),Qe(We,$e.IMAGE_LOADED,{image:r})}).catch(r=>{const n={imageId:e,error:r};Qe(We,$e.IMAGE_LOAD_FAILED,n)})}function Oie(t){if(!t.voxelManager){const{width:e,height:r,numberOfComponents:n}=t,i=ls.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:r,numberOfComponents:n});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function eA(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return QL(t,e).promise}function us(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const r=QL(t,e);return ke.getImageLoadObject(t)||ke.putImageLoadObject(t,r),r.promise}function Mie(t,e={priority:0,requestType:"prefetch"}){if(!t||t.length===0)throw new Error("loadAndCacheImages: parameter imageIds must be list of image Ids");return t.map(n=>us(n,e))}function p_(t,e={}){var p;if(t===void 0)throw new Error("createAndCacheDerivedImage: parameter imageId must not be undefined");e.imageId===void 0&&(e.imageId=`derived:${Cn()}`);const{imageId:r,skipCreateBuffer:n,onCacheAdd:i,voxelRepresentation:o}=e,a=dt("imagePlaneModule",t),s=a.rows*a.columns,{TypedArrayConstructor:c}=r_((p=e.targetBuffer)==null?void 0:p.type,s),l=new c(n?1:s),f=r,u=dt("imagePlaneModule",t);Hl.add(f,{type:"imagePlaneModule",metadata:u});const d=dt("generalSeriesModule",t);Hl.add(f,{type:"generalSeriesModule",metadata:d}),Hl.add(f,{type:"generalImageModule",metadata:{instanceNumber:e.instanceNumber}});const h=dt("imagePixelModule",t);Hl.add(f,{type:"imagePixelModule",metadata:{...h,bitsAllocated:8,bitsStored:8,highBit:7,samplesPerPixel:1,pixelRepresentation:0}});const g=v_(r,{scalarData:l,onCacheAdd:i,skipCreateBuffer:n,targetBuffer:{type:l.constructor.name},voxelRepresentation:o,dimensions:[a.columns,a.rows],spacing:[a.columnPixelSpacing,a.rowPixelSpacing],origin:a.imagePositionPatient,direction:a.imageOrientationPatient,frameOfReferenceUID:a.frameOfReferenceUID});return g.referencedImageId=t,ke.getImageLoadObject(r)||ke.putImageSync(r,g),g}function m_(t,e={}){if(t.length===0)throw new Error("createAndCacheDerivedImages: parameter imageIds must be list of image Ids");return t.map((n,i)=>{var a;const o={imageId:((a=e==null?void 0:e.getDerivedImageId)==null?void 0:a.call(e,n))||`derived:${Cn()}`,...e};return p_(n,{...o,instanceNumber:i+1})})}function v_(t,e){const{scalarData:r,origin:n,direction:i,targetBuffer:o,skipCreateBuffer:a,onCacheAdd:s,frameOfReferenceUID:c,voxelRepresentation:l}=e,f=e.dimensions,u=e.spacing;if(!f||!u)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const d=f[0],h=f[1],g=u[0],p=u[1],v={frameOfReferenceUID:c,rows:h,columns:d,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:n??[0,0,0],pixelSpacing:[p,g],rowPixelSpacing:p,columnPixelSpacing:g},w=d*h,m=r.length/w;let y;if(r){if(!(r instanceof Uint8Array||r instanceof Float32Array||r instanceof Uint16Array||r instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");y=r}else if(!a){const{TypedArrayConstructor:R}=r_(o==null?void 0:o.type,w);y=new R(w)}let x,C,S;if(y instanceof Uint8Array)x=8,C=8,S=7;else if(y instanceof Uint16Array)x=16,C=16,S=15;else if(y instanceof Int16Array)x=16,C=16,S=15;else if(y instanceof Float32Array)x=32,C=32,S=31;else throw new Error("Unsupported scalarData type");const T={samplesPerPixel:1,photometricInterpretation:y.length>f[0]*f[1]?"RGB":"MONOCHROME2",rows:h,columns:d,bitsAllocated:x,bitsStored:C,highBit:S},_={imagePlaneModule:v,imagePixelModule:T};["imagePlaneModule","imagePixelModule"].forEach(R=>{Hl.add(t,{type:R,metadata:_[R]||{}})});const E=l===KI.RLE&&ls.createRLEImageVoxelManager({dimensions:f})||ls.createImageVoxelManager({height:h,width:d,numberOfComponents:m,scalarData:y});let D=y[0],b=y[0];for(let R=1;R<y.length;R++)y[R]<D&&(D=y[R]),y[R]>b&&(b=y[R]);const I={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:T.photometricInterpretation==="RGB",numberOfComponents:T.samplesPerPixel,dataType:o==null?void 0:o.type,slope:1,minPixelValue:D,maxPixelValue:b,rows:T.rows,columns:T.columns,getCanvas:void 0,height:T.rows,width:T.columns,rgba:void 0,columnPixelSpacing:v.columnPixelSpacing,rowPixelSpacing:v.rowPixelSpacing,FrameOfReferenceUID:v.frameOfReferenceUID,invert:!1,getPixelData:()=>E.getScalarData(),voxelManager:E,sizeInBytes:r.byteLength};return s==null||s(I),ke.putImageSync(I.imageId,I),I}function tA(t){const e=({additionalDetails:n})=>n.imageId?n.imageId!==t:!0;ei.filterRequests(e);const r=ke.getImageLoadObject(t);r&&r.cancelFn()}function Rie(t){t.forEach(e=>{tA(e)})}function Pie(){const t=ei.getRequestPool();Object.keys(t).forEach(e=>{const r=t[e];Object.keys(r).forEach(n=>{const o=r[n].pop().additionalDetails,{imageId:a,volumeId:s}=o;let c;a?c=ke.getImageLoadObject(a):s&&(c=ke.getVolumeLoadObject(s)),c&&c.cancel()}),ei.clearRequestStack(e)})}function fd(t,e){Pv[t]=e}function Lie(t){const e=Lv;return Lv=t,e}function Aie(){Object.keys(Pv).forEach(t=>delete Pv[t]),Lv=void 0}function y_(t,e={}){return m_(t,{...e,targetBuffer:{type:"Uint8Array"}})}function Nie(t,e={}){return p_(t,{...e,targetBuffer:{type:"Uint8Array"}})}const kie=Object.freeze(Object.defineProperty({__proto__:null,cancelLoadAll:Pie,cancelLoadImage:tA,cancelLoadImages:Rie,createAndCacheDerivedImage:p_,createAndCacheDerivedImages:m_,createAndCacheDerivedLabelmapImage:Nie,createAndCacheDerivedLabelmapImages:y_,createAndCacheLocalImage:v_,loadAndCacheImage:us,loadAndCacheImages:Mie,loadImage:eA,registerImageLoader:fd,registerUnknownImageLoader:Lie,unregisterAllImageLoaders:Aie},Symbol.toStringTag,{value:"Module"}));function nA(t){const e=t[0],{pixelRepresentation:r,bitsAllocated:n,bitsStored:i,highBit:o,photometricInterpretation:a,samplesPerPixel:s}=dt("imagePixelModule",e),c=[],l=dt("voiLutModule",e);let f;if(l){const{windowWidth:m,windowCenter:y}=l;if(f=l==null?void 0:l.voiLUTFunction,Array.isArray(m))for(let x=0;x<m.length;x++)c.push({windowWidth:m[x],windowCenter:y[x]});else c.push({windowWidth:m,windowCenter:y})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:u,seriesInstanceUID:d}=dt("generalSeriesModule",e),{imageOrientationPatient:h,pixelSpacing:g,frameOfReferenceUID:p,columns:v,rows:w}=dt("imagePlaneModule",e);return{BitsAllocated:n,BitsStored:i,SamplesPerPixel:s,HighBit:o,PhotometricInterpretation:a,PixelRepresentation:r,Modality:u,ImageOrientationPatient:h,PixelSpacing:g,FrameOfReferenceUID:p,Columns:v,Rows:w,voiLut:c,VOILUTFunction:f,SeriesInstanceUID:d}}function w_(t,e){const{imagePositionPatient:r,imageOrientationPatient:n}=dt("imagePlaneModule",t[0]);if(!e){const g=xt(n[0],n[1],n[2]),p=xt(n[3],n[4],n[5]);e=Ae(),xn(e,g,p)}const i=Ae(),o=t[0].split(":")[0]==="wadouri";Dn(i,r[0],r[1],r[2]);let a,s;function c(g){const{imagePositionPatient:p}=dt("imagePlaneModule",g),v=Ae();return bn(v,r,p),gt(v,e)}if(o){const g=[t[0],t[Math.floor(t.length/2)]];a=t;const p=c(g[0]),v=c(g[1]);p-v<0&&a.reverse();const w=dt("imagePlaneModule",g[1]);if(!w)throw new Error("Incomplete metadata required for volume construction.");const m=Ae();bn(m,r,w.imagePositionPatient);const y=gt(m,e);s=Math.abs(y)/Math.floor(t.length/2)}else{const g=t.map(v=>({distance:c(v),imageId:v}));g.sort((v,w)=>w.distance-v.distance),a=g.map(v=>v.imageId);const p=g.length;s=Math.abs(g[p-1].distance-g[0].distance)/(p-1)}const{imagePositionPatient:l,sliceThickness:f,spacingBetweenSlices:u}=dt("imagePlaneModule",a[0]),{strictZSpacingForVolumeViewport:d}=o5().rendering;return s===0&&!d&&(f&&u?(console.log("Could not calculate zSpacing. Using spacingBetweenSlices"),s=u):f?(console.log("Could not calculate zSpacing and no spacingBetweenSlices. Using sliceThickness"),s=f):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),s=1)),{zSpacing:s,origin:l,sortedImageIds:a}}function rA(t){const e=dt("modalityLutModule",t)||{},r=dt("generalSeriesModule",t)||{},{modality:n}=r,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:n},o=dt("scalingModule",t)||{};return{...i,...n==="PT"&&{suvbw:o.suvbw,suvbsa:o.suvbsa,suvlbm:o.suvlbm}}}const x_=t=>Object.values(t).some(r=>typeof r=="number"&&!Number.isInteger(r)),X6={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function l5(t,e){const r=nA(t),{ImageOrientationPatient:n,PixelSpacing:i,Columns:o,Rows:a}=r,s=xt(n[0],n[1],n[2]),c=xt(n[3],n[4],n[5]),l=Ae();xn(l,s,c);const{zSpacing:f,origin:u,sortedImageIds:d}=w_(t,l),h=t.length,g=[i[1],i[0],f],p=[o,a,h].map(w=>Math.floor(w)),v=[...s,...c,...l];return{dimensions:p,spacing:g,origin:u,dataType:Vie(d,r),direction:v,metadata:r,imageIds:d,volumeId:e,voxelManager:null,numberOfComponents:r.PhotometricInterpretation==="RGB"?3:1}}function Vie(t,e){const{BitsAllocated:r,PixelRepresentation:n}=e,i=n===1,o=Fie(t);if(o)return o;const[a,s,c]=[0,Math.floor(t.length/2),t.length-1],l=[a,s,c].map(h=>rA(t[h])),f=l.some(h=>h.rescaleIntercept<0||h.rescaleSlope<0),u=l.some(h=>x_(h)),d=i5();switch(r){case 8:return"Uint8Array";case 16:return d&&u?"Float32Array":i||f?"Int16Array":!i&&!f?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${r} is not defined to generate scalarData for the volume.`)}}function Fie(t){const r=[0,Math.floor(t.length/2),t.length-1].map(i=>ke.getImage(t[i]));if(!r.every(Boolean))return null;const n=r[0].getPixelData().constructor.name;return r.every(i=>i.getPixelData().constructor.name===n)&&n in X6?X6[n]:null}let Av=class iA{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const r=new iA("as iterator");return e.then(n=>{try{r.add(n,!0)}catch(i){r.reject(i)}},n=>{r.reject(n)}),r}add(e,r=!1){this.nextValue=e,this.done||(this.done=r),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var r;this.rejectReason=e,(r=this.waiting)==null||r.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,r)=>{this.waiting.resolve=e,this.waiting.reject=r})),await this.waiting.promise}yield this.nextValue}async forEach(e,r){let n=0;try{for await(const i of this){const{done:o}=this;try{await e(i,o,n),n++}catch(a){if(!o){console.warn("Caught exception in intermediate value",a);continue}if(r)r(a,o);else throw a}}}catch(i){if(r)r(i,!0);else throw i}}generate(e,r){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},n=>{this.reject(n),r?r(n):console.warn("Couldn't process because",n)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}};const w0=new Map,Y6="imageRetrieveConfiguration",vp={IMAGE_RETRIEVE_CONFIGURATION:Y6,clear:()=>{w0.clear()},add:(t,e)=>{w0.set(t,e)},clone:()=>new Map(w0),restore:t=>{w0.clear(),t.forEach((e,r)=>{w0.set(r,e)})},get:(t,...e)=>{if(t===Y6)return e.map(r=>w0.get(r)).find(r=>r!==void 0)}};th(vp.get.bind(vp));function a1(t){const e=Qi(),r=[];return e.forEach(n=>{const o=n.getVolumeViewports().filter(a=>a.hasVolumeId(t));r.push(...o)}),r}const xC=t=>{const e=Uie(t);e!=null&&e.length&&e.forEach(({renderingEngine:r,viewportIds:n})=>{r.hasBeenDestroyed||r.renderViewports(n)})};function Uie(t){const e=Qi(),r=[];return e.forEach(n=>{const i=a1(t);i.length&&r.push({renderingEngine:n,viewportIds:i.map(o=>o.id)})}),r}const J6=[{id:"initialImages",retrieveType:"single"}],Bie=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],Gw=[{offset:-1,imageQualityStatus:_o.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:_o.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:_o.FAR_REPLICATE}],Gie=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Wt.Thumbnail,priority:5,nearbyFrames:Gw},{id:"quarterThumb",decimate:4,offset:3,requestType:Wt.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:Gw},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Wt.Thumbnail,retrieveType:"multipleFast",nearbyFrames:Gw},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Wt.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Wt.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Wt.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Wt.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function oA(t,e,r=0){const n=[];for(let i=r;i<t.length;i+=e)n.push(i);return n}function Wie(t,e,r){var n;if((n=e==null?void 0:e.nearbyRequests)!=null&&n.length)for(const i of e.nearbyRequests)try{const{itemId:o,imageQualityStatus:a}=i,s=ke.getImageQuality(o);if(s!==void 0&&s>=a)continue;const c={...r,imageId:o,imageQualityStatus:a};ke.setPartialImage(o,c),t.successCallback(o,c)}catch(o){console.warn("Couldn't fill nearby item ",i.itemId,o)}}const Y0=class Y0{constructor(e){this.stages=e.stages||J6,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,r){return new zie(this,e,r).loadImages()}};Y0.createProgressive=aA,Y0.interleavedRetrieveStages={stages:Gie},Y0.singleRetrieveStages={stages:J6},Y0.sequentialRetrieveStages={stages:Bie};let yp=Y0;class zie{constructor(e,r,n){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new Av("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=r,this.listener=n}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const r of e)this.addRequest(r);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,r){const{imageId:n,next:i}=e,o=(f,u)=>{this.listener.errorCallback(n,c||!i,f),u&&this.updateStageStatus(e.stage,f)},a=(r.loader||us)(n,r),s=Av.as(a);let c=!1;return s.forEach(async(f,u)=>{const d=ke.getImageQuality(n);if(!f){console.warn("No image retrieved",n);return}const{imageQualityStatus:h}=f;if(c||(c=h===_o.FULL_RESOLUTION),d!==void 0&&d>h){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(n,f),this.displayedIterator.add(f),u&&this.updateStageStatus(e.stage),Wie(this.listener,e,f)},o).finally(()=>{if(!c&&i)ke.setPartialImage(n),this.addRequest(i,r.streamingData);else{c||this.listener.errorCallback(n,!0,"Couldn't decode"),this.outstandingRequests--;for(let f=i;f;f=f.next)this.updateStageStatus(f.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),s.getDonePromise().catch(f=>null)}addRequest(e,r={}){const{imageId:n,stage:i}=e,o=this.listener.getLoaderImageOptions(n);if(!o)return;const{retrieveType:a="default"}=i,{retrieveOptions:s}=this,c=s[a]||s.default,l={...o,retrieveType:a,retrieveOptions:c,streamingData:r},f=i.priority??-5,u=i.requestType||Wt.Interaction,d={imageId:n};ei.addRequest(this.sendRequest.bind(this,e,l),u,d,f)}updateStageStatus(e,r,n=!1){const{id:i}=e,o=this.stageStatusMap.get(i);if(o&&(o.imageLoadPendingCount--,r?o.imageLoadFailedCount++:n||o.totalImageCount++,!n&&!o.stageStartTime&&(o.stageStartTime=Date.now()),!o.imageLoadPendingCount)){const{imageLoadFailedCount:a,totalImageCount:s,stageStartTime:c=Date.now(),startTime:l}=o,f={stageId:i,numberOfFailures:a,numberOfImages:s,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};Qe(We,$e.IMAGE_RETRIEVAL_STAGE,f),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,r=new Map,n=(i,o)=>{const a=o<0?this.imageIds.length+o:o<1?Math.floor((this.imageIds.length-1)*o):o,s=this.imageIds[a];if(!s)throw new Error(`No value found to add to requests at ${o}`);const c={imageId:s,stage:i,index:a,nearbyRequests:this.findNearbyRequests(a,i)};this.addStageStatus(i);const l=r.get(s);l?l.next=c:e.push(c),r.set(s,c)};for(const i of this.stages)(i.positions||oA(this.imageIds,i.decimate||1,i.offset??0)).forEach(a=>{n(i,a)});return e}findNearbyRequests(e,r){const n=new Array;if(!r.nearbyFrames)return n;for(const i of r.nearbyFrames){const o=e+i.offset;o<0||o>=this.imageIds.length||n.push({itemId:this.imageIds[o],imageQualityStatus:i.imageQualityStatus,index:o})}return n}addStageStatus(e){const{id:r}=e,n=this.stageStatusMap.get(r)||{stageId:r,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return n.imageLoadPendingCount++,this.stageStatusMap.set(r,n),n}}function aA(t){return new yp(t)}const Z6=Wt.Prefetch;class sA extends ih{constructor(e,r){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:n}=this;if(!n||!n.loading)return;n.loading=!1,n.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:o})=>o.volumeId!==this.volumeId;ei.filterRequests(i)},this.loadStatus=r.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:r}=this,{numFrames:n}=this;for(let i=0;i<n;i++)r.setUpdatedFrame(i);this.modified(),e&&xC(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:r,framesProcessed:n,totalNumFrames:i}=e,{volumeId:o,reRenderFraction:a,loadStatus:s,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(r>this.reRenderTarget||n===i)&&(this.reRenderTarget+=a,xC(o)),n===i){s.callbacks.forEach(u=>u(e));const f={FrameOfReferenceUID:l,volumeId:o};Qe(We,$e.IMAGE_VOLUME_LOADING_COMPLETED,f)}}updateTextureAndTriggerEvents(e,r,n=_o.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:o,numFrames:a,totalNumFrames:s}=this,{FrameOfReferenceUID:c}=this.metadata;if(o[i]>n||o[i]===_o.FULL_RESOLUTION)return;const f=n===_o.FULL_RESOLUTION;o[e]=n,this.framesUpdated++,f&&(this.framesLoaded++,this.framesProcessed++);const u={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:a,framesProcessed:this.framesProcessed};Qe(We,$e.IMAGE_VOLUME_MODIFIED,u),f&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:s,complete:f,imageQualityStatus:n}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,r){const n=this.getImageIdIndex(e),{imageQualityStatus:i}=r;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",n);return}this.updateTextureAndTriggerEvents(n,e,i),this.isDynamicVolume()&&this.checkTimePointCompletion(n)}errorCallback(e,r,n){if(!r)return;const{totalNumFrames:i,numFrames:o}=this,a=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:a,error:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:o,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const s={error:n,imageIdIndex:a,imageId:e};Qe(We,$e.IMAGE_LOAD_ERROR,s)}load(e){const{imageIds:r,loadStatus:n,numFrames:i}=this,{transferSyntaxUID:o}=dt("transferSyntax",r[0])||{},a=dt(vp.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,o,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:a?(a.create||yp.createProgressive)(a):this,n.loading===!0)return;const{loaded:s}=this.loadStatus,c=r.length;if(s){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:r}=dt("transferSyntax",e)||{},n=dt("imagePlaneModule",e)||{},{rows:i,columns:o}=n,a=this.getImageIdIndex(e),s=dt("modalityLutModule",e)||{},c=dt("generalSeriesModule",e)||{},l={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:c.modality};if(l.modality==="PT"){const h=dt("scalingModule",e);h&&(this._addScalingToVolume(h),l.suvbw=h.suvbw)}const f=x_(l),u=i5();if(this.isPreScaled=!0,l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:h,rescaleIntercept:g}=l;this.isPreScaled=typeof h=="number"&&typeof g=="number"}return!u&&f&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:o},allowFloatRendering:u,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:Z6,transferSyntaxUID:r,additionalDetails:{imageId:e,imageIdIndex:a,volumeId:this.volumeId}}}callLoadImage(e,r,n){const{cachedFrames:i}=this;if(i[r]===_o.FULL_RESOLUTION)return;const o=s=>{const{image:c}=s.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(r),We.removeEventListener($e.IMAGE_CACHE_IMAGE_ADDED,o))};return We.addEventListener($e.IMAGE_CACHE_IMAGE_ADDED,o),Av.as(us(e,n)).forEach(s=>{this.successCallback(e,s)},this.errorCallback.bind(this,r,e))}getImageIdsRequests(e,r){this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),e.map(o=>{const a=this.getImageIdIndex(o),s=Z6,c=r,l=this.getLoaderImageOptions(o);return{callLoadImage:this.callLoadImage.bind(this),imageId:o,imageIdIndex:a,options:l,priority:c,requestType:s,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(r=>{if(!r)return;const{callLoadImage:n,imageId:i,imageIdIndex:o,options:a,priority:s,requestType:c,additionalDetails:l}=r;ei.addRequest(n.bind(this,i,o,a),c,l,s)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(n=>{console.debug("progressive loading failed to complete",n)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),r&&(o.suvbw=r),this.scaling={PT:o}}checkTimePointCompletion(e){}}class cA extends sA{constructor(e,r){e.imageIds||(e.imageIds=r.imageIds),super(e,r),this.getImageIdsToLoad=()=>{const{imageIds:n}=this;return this.numFrames=n.length,n}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:r}=this;return this.getImageIdsRequests(r,e)}}function lA(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function r(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[g,p]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],v=[0,g,p];await Promise.all(v.map(w=>new Promise((m,y)=>{const x=e.imageIds[w];ei.addRequest(async()=>{eA(x).then(()=>{console.log(`Prefetched imageId: ${x}`),m(!0)}).catch(C=>{y(C)})},Wt.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=l5(e.imageIds,t),{dimensions:o,spacing:a,origin:s,direction:c,metadata:l,imageIds:f,dataType:u,numberOfComponents:d}=i;return new cA({volumeId:t,metadata:l,dimensions:o,spacing:a,origin:s,direction:c,imageIds:f,dataType:u,numberOfComponents:d},{imageIds:f,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const n=r();return{promise:n,decache:()=>{n.then(i=>{i.destroy(),i=null})},cancel:()=>{n.then(i=>{i.cancelLoading()})}}}const C_={};let dd=lA;function uA(t,e){const r=t.indexOf(":"),n=t.substring(0,r);let i=C_[n];if(i==null){if(dd==null||typeof dd!="function")throw new Error(`No volume loader for scheme ${n} has been registered`);i=dd}const o=i(t,e);return o.promise.then(function(a){Qe(We,$e.VOLUME_LOADED,{volume:a})},function(a){const s={volumeId:t,error:a};Qe(We,$e.VOLUME_LOADED_FAILED,s)}),o}function S_(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let r=ke.getVolumeLoadObject(t);return r!==void 0?r.promise:(r=uA(t,e),r.promise.then(n=>n))}async function u5(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let r=ke.getVolumeLoadObject(t);return r!==void 0||(r=uA(t,e),ke.putVolumeLoadObject(t,r)),r.promise}function fA(t,e){const r=ke.getVolume(t);if(!r)throw new Error(`Cannot created derived volume: Referenced volume with id ${t} does not exist.`);let{volumeId:n}=e;const{voxelRepresentation:i}=e;n===void 0&&(n=Cn());const{metadata:o,dimensions:a,spacing:s,origin:c,direction:l}=r,f=r.isDynamicVolume()?r.getCurrentTimePointImageIds():r.imageIds??[],u=m_(f,{targetBuffer:e.targetBuffer,voxelRepresentation:i}),d=u[0].dataType,h=u.map(p=>p.imageId),g=new ih({volumeId:n,dataType:d,metadata:structuredClone(o),dimensions:[a[0],a[1],a[2]],spacing:s,origin:c,direction:l,referencedVolumeId:t,imageIds:h,referencedImageIds:r.imageIds??[]});return ke.putVolumeSync(n,g),g}async function f5(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImages: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImages: parameter volumeId must not be undefined");const r=ke.getVolume(t);return r||(e.filter(o=>!ke.getImage(o)).length===0?T_(t,e):await u5(t,{imageIds:e}))}function T_(t,e){if(e===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter imageIds must not be undefined");if(t===void 0)throw new Error("createAndCacheVolumeFromImagesSync: parameter volumeId must not be undefined");const r=ke.getVolume(t);if(r)return r;const n=l5(e,t),i=new ih({volumeId:t,dataType:n.dataType,metadata:structuredClone(n.metadata),dimensions:n.dimensions,spacing:n.spacing,origin:n.origin,direction:n.direction,referencedVolumeId:n.referencedVolumeId,imageIds:n.imageIds,referencedImageIds:n.referencedImageIds});return ke.putVolumeSync(t,i),i}function s1(t,e={}){const{metadata:r,dimensions:n,spacing:i,origin:o,direction:a,scalarData:s,targetBuffer:c,preventCache:l=!1}=e,f=ke.getVolume(t);if(f)return f;const u=n[0]*n[1],d=s?s.constructor.name:(c==null?void 0:c.type)??"Float32Array",h=u*n[2];let g;switch(d){case"Uint8Array":case"Int8Array":g=h;break;case"Uint16Array":case"Int16Array":g=h*2;break;case"Float32Array":g=h*4;break}if(!ke.isCacheable(g))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const v=[];for(let y=0;y<n[2];y++){const x=`${t}_slice_${y}`;v.push(x);const C=s.subarray(y*u,(y+1)*u);v_(x,{scalarData:C,dimensions:[n[0],n[1]],spacing:[i[0],i[1]],origin:o,direction:a,targetBuffer:{type:d}})}const w=new ih({volumeId:t,metadata:structuredClone(r),dimensions:[n[0],n[1],n[2]],spacing:i,origin:o,direction:a,imageIds:v,dataType:d}),m=ls.createImageVolumeVoxelManager({imageIds:v,dimensions:n,numberOfComponents:1});return w.voxelManager=m,l||ke.putVolumeSync(t,w),w}function $ie(t,e){C_[t]=e}function dA(){return Object.keys(C_)}function jie(t){const e=dd;return dd=t,e}function hA(){return dd.name}function s0(t,e={}){return fA(t,{...e,targetBuffer:{type:"Uint8Array",...e==null?void 0:e.targetBuffer}})}function Hie(t,e,r=!1){return t.scalarData||(t.scalarData=new Uint8Array(t.dimensions[0]*t.dimensions[1]*t.dimensions[2])),s1(e,{...t,preventCache:r})}const Kie=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheDerivedLabelmapVolume:s0,createAndCacheDerivedVolume:fA,createAndCacheVolume:u5,createAndCacheVolumeFromImages:f5,createAndCacheVolumeFromImagesSync:T_,createLocalLabelmapVolume:Hie,createLocalVolume:s1,getUnknownVolumeLoaderSchema:hA,getVolumeLoaderSchemes:dA,loadVolume:S_,registerUnknownVolumeLoader:jie,registerVolumeLoader:$ie},Symbol.toStringTag,{value:"Module"}));function gA(t,e){const r=Wee.newInstance();o5().rendering.preferSizeOverAccuracy&&r.setPreferSizeOverAccuracy(!0),r.setInputData(t);const n=t.getSpacing(),i=(n[0]+n[1]+n[2])/6;return r.setMaximumSamplesPerRay(4e3),r.setSampleDistance(i),r.setScalarTexture(e),r}function pA(t){const e=QP.newInstance();e.setBlendMode(t.getBlendMode());const r=t.getInputData(),{voxelManager:n}=r.get("voxelManager"),i=n.getCompleteScalarDataArray(),o=Lt.newInstance({name:"Pixels",values:i});return r.getPointData().setScalars(o),e.setInputData(r),e.setMaximumSamplesPerRay(t.getMaximumSamplesPerRay()),e.setSampleDistance(t.getSampleDistance()),e}const qie=0,Xie=Wt.Prefetch;async function __(t,e){let r=Jie(e);!r&&e.imageIds.length&&(r=await Zie(e),r=Yie(e,r)),!(r.lower===0&&r.upper===0||r.lower===void 0||r.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)}function Yie(t,e){const r=t.imageIds,n=Math.floor(r.length/2),i=r[n],o=dt("generalSeriesModule",i)||{};return Qie(o.modality,t)?{lower:0,upper:5}:e}function Jie(t){const{imageIds:e,metadata:r}=t;let n;if(e!=null&&e.length){const i=Math.floor(e.length/2),o=e[i],a=dt("voiLutModule",o);if(a&&a.windowWidth&&a.windowCenter){n={},n.voiLUTFunction=a==null?void 0:a.voiLUTFunction;const{windowWidth:s,windowCenter:c}=a,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;l!==0&&(n={windowWidth:l,windowCenter:f})}}else n=r.voiLut[0];if(n&&(n.windowWidth!==0||n.windowCenter!==0)){const{lower:i,upper:o}=ru(Number(n.windowWidth),Number(n.windowCenter),n.voiLUTFunction);return{lower:i,upper:o}}}async function Zie(t){var h;const{imageIds:e}=t,r=Math.floor(e.length/2),n=t.imageIds[r],i=dt("generalSeriesModule",n)||{},{modality:o}=i,a=dt("modalityLutModule",n)||{},s={rescaleSlope:a.rescaleSlope,rescaleIntercept:a.rescaleIntercept,modality:o};let c;if(o==="PT"){const g=dt("scalingModule",n);g&&(c={...s,suvbw:g.suvbw})}const l={priority:qie,requestType:Xie,preScale:{scalingParameters:c}};let f=ke.getImage(n);(h=t.referencedImageIds)!=null&&h.length||(f=await us(n,{...l,ignoreCache:!0}));let{min:u,max:d}=f.voxelManager.getMinMax();return(u==null?void 0:u.length)>1&&(u=Math.min(...u),d=Math.max(...d)),{lower:u,upper:d}}function Qie(t,e){var r;return!(t!=="PT"||!e.isPreScaled||!((r=e.scaling)!=null&&r.PT.suvbw))}async function Nv(t,e,r,n=!1){const{volumeId:i,callback:o,blendMode:a}=t,s=await S_(i);if(!s)throw new Error(`imageVolume with id: ${s.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=s,f=gA(c,l);a&&f.setBlendMode(a);const u=Zte.newInstance();u.setMapper(f);const{numberOfComponents:d}=c.get("numberOfComponents");return u.getProperty().set({viewportId:r}),d===3&&u.getProperty().setIndependentComponents(!1),await __(u,s),o&&o({volumeActor:u,volumeId:i}),n||eoe(e,r,u,i),u}function eoe(t,e,r,n){const i=r.getProperty().getRGBTransferFunction(0).getRange(),o={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:n};Qe(t,$e.VOI_MODIFIED,o)}const Zs=t=>{const e="volumeId:",r=t.includes(e)?t.substring(e.length):t,n=r.indexOf("sliceIndex=");return n===-1?r:r.substring(0,n-1)},toe=1+cs,noe=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),Q6=t=>!!dA().find(e=>noe(t.volumeId,e));function oh(t,e,r,n=!1){const{viewPlaneNormal:i}=e,o=t.getActors();if(!o.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const a=o.map(l=>{const f=l.referencedId??l.uid;return ke.getVolume(f)}).filter(l=>!!l);if(r){const l=Zs(r),f=a.findIndex(g=>l.includes(g.volumeId)),u=a[f],{uid:d}=o[f],h=e9(u,i,t,n);return{imageVolume:u,spacingInNormalDirection:h,actorUID:d}}if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=a.find(Q6);for(let l=0;l<a.length;l++){const f=a[l];if(c&&!Q6(f))continue;const u=e9(f,i,t);u*toe<s.spacingInNormalDirection&&(s.spacingInNormalDirection=u,s.imageVolume=f,s.actorUID=o[l].uid)}return s}function e9(t,e,r,n=!1){const{slabThickness:i}=r.getProperties();let o=i;return(!i||!n)&&(o=Su(t,e)),o}function kv(t){const e=t.getCamera(),{spacingInNormalDirection:r,imageVolume:n}=oh(t,e);if(!n)return;const{viewPlaneNormal:i,focalPoint:o}=e,a=t.getActors().find(g=>g.referencedId===n.volumeId||g.uid===n.volumeId);a||console.warn("No actor found for with actorUID of",n.volumeId);const s=a.actor,c=r5(s,i,o),{min:l,max:f,current:u}=c,d=Math.round((f-l)/r)+1;let h=(u-l)/(f-l)*d;return h=Math.floor(h),h>d-1?h=d-1:h<0&&(h=0),{numberOfSlices:d,imageIndex:h}}const W0={};function roe(t){W0[t]!==void 0&&delete W0[t]}function ioe(t){const{renderingEngineId:e,viewportId:r}=t.detail,i=fr(e).getViewport(r);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");W0[i.id]===void 0&&(W0[i.id]=0);const o=kv(i);if(!o){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:a,imageIndex:s}=o;if(W0[i.id]===s)return;W0[i.id]=s;const c={imageIndex:s,viewportId:r,renderingEngineId:e,numberOfSlices:a};Qe(i.element,$e.VOLUME_NEW_IMAGE,c)}function Ad(t,e,r){const[n,i,o]=t,[a,s,c]=e,[l,f,u,d]=r,h=a-n,g=s-i,p=c-o,v=-1*(l*n+f*i+u*o-d)/(l*h+f*g+u*p),w=h*v+n,m=g*v+i,y=p*v+o;return[w,m,y]}function Nc(t,e,r=!1){const[n,i,o]=t,a=n*e[0]+i*e[1]+o*e[2];if(r){const s=Math.sqrt(n*n+i*i+o*o);return[n/s,i/s,o/s,a/s]}return[n,i,o,a]}function mA(t,e,r){const[n,i,o,a]=t,[s,c,l,f]=e,[u,d,h,g]=r,p=rg(n,s,u,i,c,d,o,l,h),v=rg(a,f,g,i,c,d,o,l,h),w=rg(n,s,u,a,f,g,o,l,h),m=rg(n,s,u,i,c,d,a,f,g),y=df(v)/df(p),x=df(w)/df(p),C=df(m)/df(p);return[y,x,C]}function Vv(t,e,r=!1){const[n,i,o,a]=t,[s,c,l]=e,f=n*s+i*c+o*l-a,u=Math.abs(f)/Math.sqrt(n*n+i*i+o*o);return(r?Math.sign(f):1)*u}const ooe=Object.freeze(Object.defineProperty({__proto__:null,linePlaneIntersection:Ad,planeDistanceToPoint:Vv,planeEquation:Nc,threePlaneIntersection:mA},Symbol.toStringTag,{value:"Module"}));function CC(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function pa(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(pa);{const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=pa(t[r]));return e}}const Bg=class Bg{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Uo.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=r=>{},this.viewportWidgets=new Map,this.addWidget=(r,n)=>{this.viewportWidgets.set(r,n)},this.getWidget=r=>this.viewportWidgets.get(r),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(n=>{if(n.getEnabled()&&n.setEnabled(!1),n.getActor&&n.getRenderer){const i=n.getActor(),o=n.getRenderer();o&&i&&o.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=pa(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=pa(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Uo.NO_DATA||this.viewportStatus===Uo.LOADING||(this.viewportStatus=Uo.RENDERED)}getRenderingEngine(){return fp.get(this.renderingEngineId)}getRenderer(){var r;const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return(r=e.offscreenMultiRenderWindow)==null?void 0:r.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,r=!1){var n,i;this.options=structuredClone(e),(n=this.options)!=null&&n.displayArea&&this.setDisplayArea((i=this.options)==null?void 0:i.displayArea),r&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:r}){const n=this.getDefaultImageData();if(!n)return;const i=this.getCamera(),{viewPlaneNormal:o,viewUp:a,focalPoint:s,position:c}=i,l=xn(Ae(),o,a);let f=Cq(Ae(),a);const u=is(Ae(),o),d=li(c,s),g=n.getDimensions().map(C=>Math.floor(C/2)),p=[g[0],g[1],g[2]],v=n.indexToWorld(p,Ae()),w=this._getFocalPointForResetCamera(v,i,{resetPan:!0,resetToCenter:!1}),m=yn(Ae(),s,w),y=fo(m),x=C=>{const S=mr(Ae(),C,2*gt(m,C));return yn(S,S,m),kn(S,S),S};if(e){const C=x(f),S=Xt(Ae(),w,C,y),T=Xt(Ae(),S,u,d);this.setCamera({viewPlaneNormal:u,position:T,focalPoint:S}),this.flipHorizontal=!this.flipHorizontal}if(r){f=is(f,a);const C=x(l),S=Xt(Ae(),w,C,y),T=Xt(Ae(),S,u,d);this.setCamera({focalPoint:S,viewPlaneNormal:u,viewUp:f,position:T}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&Ls(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const r=this.getActors();let n=r[0];return e&&(n=r.find(o=>o.referencedId===e)),!n||!Ls(n)?null:n.actor}getActorUIDByIndex(e){const r=this.getActors()[e];if(r)return r.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,{resetCamera:!0})}_removeActor(e){const r=this.getActor(e);if(!r){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(r.actor),this._actors.delete(e)}removeActors(e){e.forEach(r=>{this._removeActor(r)})}addActors(e,r={}){const{resetCamera:n=!1}=r,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(s=>{this.addActor(s)});const o=this.getViewPresentation(),a=this.getViewReference();this.resetCamera(),n||(this.setViewReference(a),this.setViewPresentation(o))}addActor(e){const{uid:r,actor:n}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${r} Rendering Engine has been destroyed`);return}if(!r||!n)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(r)){console.warn(`Actor ${r} already exists for this viewport`);return}const o=this.getRenderer();o==null||o.addActor(n),this._actors.set(r,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,r,n){const i=n[0],o=n[1],a=n[2],s=i*r[0]+o*r[1]+a*r[2],c=e.getBounds(),l=this._getEdges(c),f=[];for(const u of l){const[[d,h,g],[p,v,w]]=u;if(i*(p-d)+o*(v-h)+a*(w-g)===0)continue;const m=Ad([d,h,g],[p,v,w],[i,o,a,s]);this._isInBounds(m,c)&&f.push(m)}return f}setInterpolationType(e,r){}setDisplayArea(e,r=!1){var a;if(!e)return;const{storeAsInitialCamera:n,type:i}=e;n&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:o}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((a=this.getProperties())==null?void 0:a.interpolationType)??Ef.LINEAR),this.setDisplayAreaFit(e)),n&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=o,!r&&!o){const s={viewportId:this.id,displayArea:e,storeAsInitialCamera:n};Qe(this.element,$e.DISPLAY_AREA_MODIFIED,s),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:r=1}=e,n=this.canvas,i=n.height,o=n.width;if(i<8||o<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(Ef.NEAREST),this.setCamera({parallelScale:i*c/(2*r)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:f,viewUp:u,viewPlaneNormal:d}=this.getCamera(),h=Ae();if(n.height%2&&Xt(h,h,u,r*.5*c),n.width%2){const g=xn(Ae(),u,d);Xt(h,h,g,r*.5*c)}!h[0]&&!h[1]&&!h[2]||this.setCamera({focalPoint:br(Ae(),l,h),position:br(Ae(),f,h)})}setDisplayAreaFit(e){const{imageArea:r,imageCanvasPoint:n}=e,i=(window==null?void 0:window.devicePixelRatio)||1,o=this.getDefaultImageData();if(!o)return;const a=this.sWidth/i,s=this.sHeight/i,c=o.getDimensions(),l=this.worldToCanvas(o.indexToWorld([0,0,0])),f=this.worldToCanvas(o.indexToWorld([c[0],c[1],c[2]])),u=[Math.abs(f[0]-l[0]),Math.abs(f[1]-l[1])],[d,h]=u;let g=this.getZoom()/this.insetImageMultiplier;if(r){const[p,v]=r,w=Math.max(Math.abs(d/a),Math.abs(h/s)),m=Math.abs(p*d/a),y=Math.abs(v*h/s),x=this.getZoom(),C=this.getZoom(this.fitToCanvasCamera);g=(m>y?w/m:w/y)*x/C,this.setZoom(this.insetImageMultiplier*g,!1)}if(n){console.log("Starting pan update zoom=",g);const{imagePoint:p,canvasPoint:v=p||[.5,.5]}=n,[w,m]=v,y=a*(w-.5),x=s*(m-.5),[C,S]=p||v,T=g,_=this.insetImageMultiplier*T*d*(.5-C),E=this.insetImageMultiplier*T*h*(.5-S),D=_+y,b=E+x,I=[D,b];console.log("delta point",D,this.getPan()[0],_,y),Di(I,I,this.getPan()),this.setPan(I,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetToCenter:i=!0,storeAsInitialCamera:o=!0}=e||{},a=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const s=this.getCamera(),c=a.computeVisiblePropBounds(),l=[0,0,0],f=this.getDefaultImageData();if(f){const R=f.getSpacing();c[0]=c[0]+R[0]/2,c[1]=c[1]-R[0]/2,c[2]=c[2]+R[1]/2,c[3]=c[3]-R[1]/2,c[4]=c[4]+R[2]/2,c[5]=c[5]-R[2]/2}const u=this.getVtkActiveCamera(),d=u.getViewPlaneNormal(),h=u.getViewUp();if(l[0]=(c[0]+c[1])/2,l[1]=(c[2]+c[3])/2,l[2]=(c[4]+c[5])/2,f){const M=f.getDimensions().map(k=>Math.floor(k/2)),P=[M[0],M[1],M[2]];f.indexToWorld(P,l)}const{widthWorld:g,heightWorld:p}=this._getWorldDistanceViewUpAndViewRight(c,h,d),v=[this.sWidth,this.sHeight],w=g/p,m=v[0]/v[1],y=w/m,x=y<1?this.insetImageMultiplier*p/2:this.insetImageMultiplier*p*y/2,C=Bg.boundsRadius(c)*(this.type===Hn.VOLUME_3D?10:1),S=this.insetImageMultiplier*C,T=Math.abs(kt.dot(h,d))>.999?[-h[2],h[0],h[1]]:h,_=this._getFocalPointForResetCamera(l,s,{resetPan:r,resetToCenter:i}),E=[_[0]+S*d[0],_[1]+S*d[1],_[2]+S*d[2]];a.resetCameraClippingRange(c);const D=[-_r.MAXIMUM_RAY_DISTANCE,_r.MAXIMUM_RAY_DISTANCE];u.setPhysicalScale(C),u.setPhysicalTranslation(-_[0],-_[1],-_[2]),this.setCamera({parallelScale:n?x:s.parallelScale,focalPoint:_,position:E,viewAngle:90,viewUp:T,clippingRange:D});const b=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),o&&this.setInitialCamera(b),n&&this.setZoom(1,o);const I={type:"ResetCameraEvent",renderer:a};return a.invokeEvent(I),this.triggerCameraModifiedEventIfNecessary(s,b),f&&this.options.displayArea&&n&&r&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const n=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),o=this.worldToCanvas(yn([0,0,0],e.focalPoint,i)),a=this.worldToCanvas(yn([0,0,0],n,i));return Sr([0,0],o,a)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,r=!1){const n=this.getCamera(),{focalPoint:i,position:o}=n,a=this.canvasToWorld([0,0]),s=Sr([0,0],e,this.getPan());if(Math.abs(s[0])<1&&Math.abs(s[1])<1&&!r)return;const c=yn(Ae(),this.canvasToWorld(s),a),l=yn(Ae(),i,c),f=yn(Ae(),o,c);this.setCamera({...n,focalPoint:l,position:f},r)}getZoom(e=this.initialCamera){if(!e)return 1;const r=this.getVtkActiveCamera(),{parallelScale:n}=e;return n/r.getParallelScale()}setZoom(e,r=!1){const n=this.getCamera(),{parallelScale:i}=this.initialCamera,o=i/e;n.parallelScale===o&&!r||this.setCamera({...n,parallelScale:o},r)}_getFocalPointForViewPlaneReset(e){const{focalPoint:r,viewPlaneNormal:n}=this.getCamera(),i=this._getViewImageDataIntersections(e,r,n);let o=0,a=0,s=0;return i.forEach(([l,f,u])=>{o+=l,a+=f,s+=u}),[o/i.length,a/i.length,s/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),r=(s,c)=>s.some(l=>isNaN(l))?c:s,n=r([...e.getViewUp()],[0,1,0]),i=r([...e.getViewPlaneNormal()],[0,0,-1]),o=r([...e.getPosition()],[0,0,1]),a=r([...e.getFocalPoint()],[0,0,0]);return{viewUp:n,viewPlaneNormal:i,position:o,focalPoint:a,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,r=!1){const n=this.getVtkActiveCamera(),i=this.getCamera(),o=Object.assign({},i,e),{viewUp:a,viewPlaneNormal:s,position:c,focalPoint:l,parallelScale:f,viewAngle:u,flipHorizontal:d,flipVertical:h,clippingRange:g}=e;if(d!==void 0){const w=d&&!this.flipHorizontal||!d&&this.flipHorizontal;w&&this.flip({flipHorizontal:w})}if(h!==void 0){const w=h&&!this.flipVertical||!h&&this.flipVertical;w&&this.flip({flipVertical:w})}a!==void 0&&n.setViewUp(a),s!==void 0&&n.setDirectionOfProjection(-s[0],-s[1],-s[2]),c!==void 0&&n.setPosition(...c),l!==void 0&&n.setFocalPoint(...l),f!==void 0&&n.setParallelScale(f),u!==void 0&&n.setViewAngle(u),g!==void 0&&n.setClippingRange(g);const p=i.focalPoint,v=i.viewUp;if(p&&l||v&&a){const w=n.getViewPlaneNormal(),m=n.getViewUp();let y=!1,x=!1;if(l){const C=[l[0]-p[0],l[1]-p[1],l[2]-p[2]];y=Math.abs(kt.dot(C,w))>0}if(a&&(x=!At(m,v)),y||x){const C=this.getDefaultActor();if(!(C!=null&&C.actor))return;Oo(C,"vtkActor")||this.updateClippingPlanesForActors(o),(Oo(C,"vtkImageSlice")||this.type===Hn.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}r&&this.setInitialCamera(o),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,r){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const n={previousCamera:e,camera:r,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.CAMERA_MODIFIED,n)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(n=>{if(!n.actor)return;const i=n.actor.getMapper();let o=n!=null&&n.clippingFilter?n==null?void 0:n.clippingFilter.getClippingPlanes():i.getClippingPlanes();o.length===0&&(n!=null&&n.clippingFilter)&&(o=[Yi.newInstance(),Yi.newInstance()]);let a=_r.MINIMUM_SLAB_THICKNESS;n.slabThickness&&(a=n.slabThickness);const{viewPlaneNormal:s,focalPoint:c}=e;this.setOrientationOfClippingPlanes(o,a,s,c),Qe(this.element,$e.CLIPPING_PLANES_UPDATED,{actorEntry:n,focalPoint:c,vtkPlanes:o,viewport:this})})}setOrientationOfClippingPlanes(e,r,n,i){if(e.length<2)return;const o=[n[0],n[1],n[2]];kt.multiplyScalar(o,r),e[0].setNormal(n);const a=[0,0,0];kt.subtract(i,o,a),e[0].setOrigin(a),e[1].setNormal(-n[0],-n[1],-n[2]);const s=[0,0,0];kt.add(i,o,s),e[1].setOrigin(s)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const r=e.actor.getMapper();let n=e!=null&&e.clippingFilter?e==null?void 0:e.clippingFilter.getClippingPlanes():r.getClippingPlanes();return n.length===0&&(e!=null&&e.clippingFilter)&&(n=[Yi.newInstance(),Yi.newInstance()]),n}_getWorldDistanceViewUpAndViewRight(e,r,n){const i=this._getCorners(e),o=this._getCorners(e),a=xn(Ae(),r,n);let s=wi.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]);i.forEach(d=>s.apply(d));let c=1/0,l=-1/0;for(let d=0;d<8;d++){const h=i[d][0];h>l&&(l=h),h<c&&(c=h)}s=wi.buildFromDegree().identity().rotateFromDirections([a[0],a[1],a[2]],[1,0,0]),o.forEach(d=>s.apply(d));let f=1/0,u=-1/0;for(let d=0;d<8;d++){const h=o[d][0];h>u&&(u=h),h<f&&(f=h)}return{widthWorld:u-f,heightWorld:l-c}}getViewReference(e={}){const{focalPoint:r,viewPlaneNormal:n,viewUp:i}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:r,viewPlaneNormal:n,viewUp:i,sliceIndex:e.sliceIndex??this.getSliceIndex()}}isReferenceViewable(e,r){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:n}=e,i=this.getCamera();return n&&!At(n,i.viewPlaneNormal)&&!At(is(i.viewPlaneNormal,i.viewPlaneNormal),n)?r==null?void 0:r.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0}){const r={},{rotation:n,displayArea:i,zoom:o,pan:a}=e;n&&(r.rotation=this.getRotation()),i&&(r.displayArea=this.getDisplayArea());const s=this.getZoom();return o&&(r.zoom=s),a&&(r.pan=this.getPan(),_c(r.pan,r.pan,1/s)),r}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:r,zoom:n=this.getZoom(),pan:i,rotation:o}=e;r!==this.getDisplayArea()&&this.setDisplayArea(r),this.setZoom(n),i&&this.setPan(_c([0,0],i,n)),o>=0&&this.setRotation(o)}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,r,{resetPan:n=!0,resetToCenter:i=!0}){if(i&&n)return e;if(i&&!n)return CC(r.focalPoint)?e:r.focalPoint;if(!i&&n){const o=r,a=o.focalPoint,s=o.viewPlaneNormal,c=yn(Ae(),e,a),l=gt(c,s),f=Xt(Ae(),e,s,-1*l);return[f[0],f[1],f[2]]}if(!n&&!i)return CC(r.focalPoint)?e:r.focalPoint}_isInBounds(e,r){const[n,i,o,a,s,c]=r,[l,f,u]=e;return!(l<n||l>i||f<o||f>a||u<s||u>c)}_getEdges(e){const[r,n,i,o,a,s,c,l]=this._getCorners(e);return[[r,n],[r,a],[r,i],[n,o],[n,s],[i,o],[i,c],[o,l],[a,c],[a,s],[s,l],[c,l]]}static boundsRadius(e){const r=(e[1]-e[0])**2,n=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(r+n+i||1)*.5}setDataIds(e,r){throw new Error("Unsupported operatoin setDataIds")}};Bg.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},Bg.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let qf=Bg;function vA(t,e,r=!1){const n=t.getCamera(),{focalPoint:i,viewPlaneNormal:o}=n,{spacingInNormalDirection:a,actorUID:s}=oh(t,n,e,r);if(!s)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(s);if(!c)return console.warn("No actor found for with actorUID of",s),null;const l=c.actor;return{sliceRange:r5(l,o,i),spacingInNormalDirection:a,camera:n}}function Lf(t,e,r=!1){const{sliceRange:n,spacingInNormalDirection:i,camera:o}=vA(t,e,r),{min:a,max:s,current:c}=n,l=Math.round((s-a)/i),u=(c-a)/(s-a)*l,d=Math.round(u);return{numScrollSteps:l,currentStepIndex:d,sliceRangeInfo:{sliceRange:n,spacingInNormalDirection:i,camera:o}}}function yA(t){let e=[];const[r,n]=t.getRange();t.getTable(r,n,1024,e),e=e.filter((h,g)=>g%3===0);const i=[...Array(1024).keys()].map((h,g)=>r+(n-r)/1023*g),o=e[256],a=Math.log((1-o)/o),s=i[256],c=e[256*3],l=Math.log((1-c)/c),f=i[256*3],u=Math.round(4*(f-s)/(a-l)),d=Math.round(s+u*a/4);return[Math.round(d-u/2),Math.round(d+u/2)]}function wA(t,e){const r=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:n}=aoe(r),i=n[0],o=n[1]-n[0],a=gu.newInstance(),s=[];for(let x=0;x<r.length;x+=4){let C=r[x];const S=r[x+1],T=r[x+2],_=r[x+3];C=(C-i)/o,s.push([C,S,T,_])}soe(s,n,a),t.getProperty().setRGBTransferFunction(0,a);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=Rd.newInstance(),f=[];for(let x=0;x<c.length;x+=2){let C=c[x];const S=c[x+1];C=(C-i)/o,f.push([C,S])}coe(f,n,l);const u=t.getProperty();u.setScalarOpacity(0,l);const[d,h,g,p]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);u.setUseGradientOpacity(0,!0),u.setGradientOpacityMinimumValue(0,d),u.setGradientOpacityMinimumOpacity(0,h),u.setGradientOpacityMaximumValue(0,g),u.setGradientOpacityMaximumOpacity(0,p),e.interpolation==="1"&&u.setInterpolationTypeToFastLinear(),u.setShade(e.shade==="1");const v=parseFloat(e.ambient),w=parseFloat(e.diffuse),m=parseFloat(e.specular),y=parseFloat(e.specularPower);u.setAmbient(v),u.setDiffuse(w),u.setSpecular(m),u.setSpecularPower(y)}function aoe(t){let e=1/0,r=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),r=Math.max(r,t[i]);const n=(r-e)/2;return{shiftRange:[-n,n],min:e,max:r}}function soe(t,e,r){const n=e[1]-e[0],i=t.map(([o,a,s,c])=>[o*n+e[0],a,s,c]);return r.removeAllPoints(),i.forEach(([o,a,s,c])=>r.addRGBPoint(o,a,s,c)),i}function coe(t,e,r){const n=e[1]-e[0],i=t.map(([o,a])=>[o*n+e[0],a]);return r.removeAllPoints(),i.forEach(([o,a])=>r.addPoint(o,a)),i}class Xn extends qf{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const o=this.getPan(this.fitToCanvasCamera),a=this.getPan(),s=this.getCamera(),c=ya([0,0],o,a);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),f=l?is([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:f}),this.rotateCamera(i);const u=this.getPan(),d=this.getPan(this.fitToCanvasCamera),h=ya([0,0],u,d),g=Di([0,0],o,h);if(this.setPan(g,!1),this._suppressCameraModifiedEvents)return;const p=this.getCamera(),v={previousCamera:s,camera:p,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.CAMERA_MODIFIED,v)},this.getDefaultProperties=i=>{let o;return i!==void 0&&(o=this.perVolumeIdDefaultProperties.get(i)),o!==void 0?o:{...this.globalDefaultProperties}},this.getProperties=i=>{var C;if(!this._getApplicableVolumeActor(i))return;const{colormap:a,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}=this.viewportProperties;if(i||(i=this.getVolumeId()),!ke.getVolume(i))return null;const h=this.getActors().find(S=>S.referencedId===i);if(!h)return;const p=h.actor.getProperty().getRGBTransferFunction(0),[v,w]=((C=this.viewportProperties)==null?void 0:C.VOILUTFunction)==="SIGMOID"?yA(p):p.getRange(),m={lower:v,upper:w},y=this.getColormap(i);return{colormap:i&&y?y:a,voiRange:m,VOILUTFunction:s,interpolationType:c,invert:l,slabThickness:f,preset:u}},this.getColormap=i=>{const o=this._getApplicableVolumeActor(i);if(!o)return;const{volumeActor:a}=o,s=this._getOrCreateColorTransferFunction(i),{nodes:c}=s.getState(),l=c.reduce((u,d)=>(u.push(d.x,d.r,d.g,d.b),u),[]);return d_(l,a)},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:o,flipVertical:a}=this.getCameraNoRotation(),s=a?is([0,0,0],this.initialViewUp):this.initialViewUp;if(!s)return 0;const c=VT(s,i)*180/Math.PI,l=xn([0,0,0],s,i);return gt(l,o)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{var g,p;const o=this.getVtkActiveCamera();(g=o.setIsPerformingCoordinateTransformation)==null||g.call(o,!0);const a=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[i[0]*f,i[1]*f],d=[u[0]+this.sx,u[1]+this.sy];d[1]=l[1]-d[1];const h=c.displayToWorld(d[0],d[1],0,a);return(p=o.setIsPerformingCoordinateTransformation)==null||p.call(o,!1),[h[0],h[1],h[2]]},this.worldToCanvas=i=>{var g;const o=this.getVtkActiveCamera();(g=o.setIsPerformingCoordinateTransformation)==null||g.call(o,!0);const a=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...i,a);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy],d=window.devicePixelRatio||1,h=[u[0]/d,u[1]/d];return o.setIsPerformingCoordinateTransformation(!1),h},this.hasImageURI=i=>this.getActors().filter(a=>Oo(a,"vtkVolume")).some(({uid:a,referencedId:s})=>{const c=ke.getVolume(s||a);return c!=null&&c.imageIds?c.imageIds.map(wr).includes(i):!1}),this.getImageIds=i=>{const o=this._getApplicableVolumeActor(i);if(!o)throw new Error(`No actor found for the given volumeId: ${i}`);const a=o.volumeId,s=ke.getVolume(a);if(!s)throw new Error(`imageVolume with id: ${a} does not exist in cache`);return s.imageIds},this.useCPURendering=ld(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const r=this.getRenderer(),n=Zee.newInstance();switch(r.setActiveCamera(n),this.type){case Hn.ORTHOGRAPHIC:n.setParallelProjection(!0);break;case Hn.VOLUME_3D:n.setParallelProjection(!0);break;case Hn.PERSPECTIVE:n.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,r=!0){const{viewPlaneNormal:n,viewUp:i}=this._getOrientationVectors(e),o=this.getVtkActiveCamera();o.setDirectionOfProjection(-n[0],-n[1],-n[2]),o.setViewUpFrom(i),this.initialViewUp=i,r&&this.resetCamera()}initializeVolumeNewImageEventDispatcher(){const e=n.bind(this),r=i.bind(this);function n(o){const{viewportId:a}=o.detail;a!==this.id||this.isDisabled||!this.getImageData()||ioe(o)}function i(o){const{viewportId:a}=o.detail;a===this.id&&(this.element.removeEventListener($e.CAMERA_MODIFIED,e),We.removeEventListener($e.ELEMENT_DISABLED,r),roe(a))}this.element.removeEventListener($e.CAMERA_MODIFIED,e),this.element.addEventListener($e.CAMERA_MODIFIED,e),We.addEventListener($e.ELEMENT_DISABLED,r)}setVOILUTFunction(e,r,n){Object.values(lo).includes(e)||(e=lo.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,r,n),this.viewportProperties.VOILUTFunction=e}setColormap(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=gu.newInstance();let s=mp(e.name);const{name:c}=e;if(s||(s=Dv.getPresetByName(c)),!s)throw new Error(`Colormap ${e} not found`);const l=o.getProperty().getRGBTransferFunction(0).getRange();if(a.applyColorMap(s),a.setMappingRange(l[0],l[1]),o.getProperty().setRGBTransferFunction(0,a),this.viewportProperties.colormap=e,!n){const f={viewportId:this.id,colormap:e,volumeId:r};Qe(this.element,$e.VOI_MODIFIED,f),Qe(this.element,$e.COLORMAP_MODIFIED,f)}}setOpacity(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n,o=Rd.newInstance();if(typeof e.opacity=="number"){const a=i.getProperty().getRGBTransferFunction(0).getRange();o.addPoint(a[0],e.opacity),o.addPoint(a[1],e.opacity)}else e.opacity.forEach(({opacity:a,value:s})=>{o.addPoint(s,a)});i.getProperty().setScalarOpacity(0,o),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const o=i.volumeId,a=this._getOrCreateColorTransferFunction(o);if(Dg(a),this.viewportProperties.invert=e,!n){const s={...this.getVOIModifiedEventDetail(o),invertStateChanged:!0};Qe(this.element,$e.VOI_MODIFIED,s)}}getVOIModifiedEventDetail(e){const r=this._getApplicableVolumeActor(e);if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);const o=r.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),a=this.getColormap(e),{VOILUTFunction:s,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:o[0],upper:o[1]},volumeId:r.volumeId,VOILUTFunction:s,colormap:a,invert:c}}_getOrCreateColorTransferFunction(e){const r=this._getApplicableVolumeActor(e);if(!r)return null;const{volumeActor:n}=r,i=n.getProperty().getRGBTransferFunction(0);if(i)return i;const o=gu.newInstance();return n.getProperty().setRGBTransferFunction(0,o),o}setInterpolationType(e,r){const n=this._getApplicableVolumeActor(r);if(!n)return;const{volumeActor:i}=n;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,r,n=!1){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i,a=i.volumeId,s=e;if(typeof s>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(a);if(c===lo.SAMPLED_SIGMOID){const l=h_(s);o.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:f}=s;o.getProperty().getRGBTransferFunction(0).setRange(l,f)}if(!n){const l={...this.getVOIModifiedEventDetail(a)};Qe(this.element,$e.VOI_MODIFIED,l)}this.viewportProperties.voiRange=s}rotateCamera(e){const r=e-this.getRotation();this.getVtkActiveCamera().roll(-r)}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(r,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const r=super.getViewReference(e),n=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(r.volumeId=n),typeof(e==null?void 0:e.sliceIndex)!="number")return r;const{viewPlaneNormal:i}=r,o=(e==null?void 0:e.sliceIndex)-this.getSliceIndex(),{sliceRangeInfo:a}=Lf(this,n,!0),{sliceRange:s,spacingInNormalDirection:c,camera:l}=a,{focalPoint:f,position:u}=l,{newFocalPoint:d}=cd(f,u,s,i,c,o);return r.cameraFocalPoint=d,r}isReferenceViewable(e,r){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,r))return!1;if(r!=null&&r.withNavigation)return!0;const n=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=n&&n<=i[1]:i===void 0||i===n}scroll(e=1){const r=this.getVolumeId(),{sliceRangeInfo:n}=Lf(this,r,!0);if(!n)return;const{sliceRange:i,spacingInNormalDirection:o,camera:a}=n,{focalPoint:s,viewPlaneNormal:c,position:l}=a,{newFocalPoint:f,newPosition:u}=cd(s,l,i,c,o,e);this.setCamera({focalPoint:f,position:u})}setViewReference(e){if(!e)return;const r=this.getVolumeId(),{viewPlaneNormal:n,FrameOfReferenceUID:i,cameraFocalPoint:o,viewUp:a}=e;let{sliceIndex:s}=e;const{focalPoint:c,viewPlaneNormal:l,position:f}=this.getCamera(),u=_L(l,n),d=At(l,n);if(typeof s=="number"&&e.volumeId===r&&(u||d)){const{currentStepIndex:h,sliceRangeInfo:g,numScrollSteps:p}=Lf(this,r,!0),{sliceRange:v,spacingInNormalDirection:w}=g;u&&(s=p-s-1);const m=s-h,{newFocalPoint:y,newPosition:x}=cd(c,f,v,l,w,m);this.setCamera({focalPoint:y,position:x})}else if(i===this.getFrameOfReferenceUID()){if(n&&!u&&!d){this.setOrientation({viewPlaneNormal:n,viewUp:a}),this.setViewReference(e);return}if(o){const h=yn([0,0,0],o,c),g=n??l,p=gt(h,g);At(p,0)||mr(h,g,p);const v=br([0,0,0],c,h),w=br([0,0,0],f,h);this.setCamera({focalPoint:v,position:w})}}else throw new Error(`Incompatible view refs: ${i}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,interpolationType:a,slabThickness:s}={},c,l=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:r,invert:n,colormap:i,preset:o,slabThickness:s}),n!==void 0&&this.viewportProperties.invert!==n&&this.setInvert(n,c,l),i!=null&&i.name&&this.setColormap(i,c,l),(i==null?void 0:i.opacity)!=null&&this.setOpacity(i,c),e!==void 0&&this.setVOI(e,c,l),typeof a<"u"&&this.setInterpolationType(a),r!==void 0&&this.setVOILUTFunction(r,c,l),o!==void 0&&this.setPreset(o,c,l),s!==void 0&&this.setSlabThickness(s)}resetToDefaultProperties(e){var n,i;const r=this.globalDefaultProperties;(n=r.colormap)!=null&&n.name&&this.setColormap(r.colormap,e),((i=r.colormap)==null?void 0:i.opacity)!=null&&this.setOpacity(r.colormap,e),r.voiRange!==void 0&&this.setVOI(r.voiRange,e),r.VOILUTFunction!==void 0&&this.setVOILUTFunction(r.VOILUTFunction,e),r.invert!==void 0&&this.setInvert(r.invert,e),r.slabThickness!==void 0&&(this.setSlabThickness(r.slabThickness),this.viewportProperties.slabThickness=r.slabThickness),r.preset!==void 0&&this.setPreset(r.preset,e,!1),r.preset!==void 0&&this.setPreset(r.preset,e,!1),this.render()}setPreset(e,r,n){const i=this._getApplicableVolumeActor(r);if(!i)return;const{volumeActor:o}=i;let a=e;typeof a=="string"&&(a=XI.find(s=>s.name===e)),a&&(wA(o,a),this.viewportProperties.preset=a,this.render(),n||Qe(this.element,$e.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:o,presetName:a.name}))}async setVolumes(e,r=!1,n=!1){const i=ke.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist, you need to create/allocate the volume first`);const o=i.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,o),this._FrameOfReferenceUID=o,e.forEach(s=>{this._addVolumeId(s.volumeId)});const a=[];for(let s=0;s<e.length;s++){const{volumeId:c,actorUID:l,slabThickness:f,...u}=e[s],d=await Nv(e[s],this.element,this.id,n),h=l||Cn();a.push({uid:h,actor:d,slabThickness:f,referencedId:c,...u})}this._setVolumeActors(a),this.viewportStatus=Uo.PRE_RENDER,this.initializeColorTransferFunction(e),Qe(this.element,$e.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:a}),r&&this.render()}async addVolumes(e,r=!1,n=!1){const i=ke.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const o=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(a=>{this._addVolumeId(a.volumeId)});for(let a=0;a<e.length;a++){const{volumeId:s,visibility:c,actorUID:l,slabThickness:f,...u}=e[a],d=await Nv(e[a],this.element,this.id,n);c||d.setVisibility(!1);const h=l||Cn();o.push({uid:h,actor:d,slabThickness:f,referencedId:s,...u})}this.addActors(o),this.initializeColorTransferFunction(e),r&&this.render()}removeVolumeActors(e,r=!1){this.removeActors(e),r&&this.render()}setOrientation(e,r=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const r=e[0].volumeId,n=this._getOrCreateColorTransferFunction(r);!this.initialTransferFunctionNodes&&n&&(this.initialTransferFunctionNodes=Rv(n))}_getApplicableVolumeActor(e){const r=this.getActors();if(!(r!=null&&r.length))return;if(e){const i=r.find(o=>o.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const n=r[0];return{volumeActor:n.actor,volumeId:n.referencedId,actorUID:n.uid}}async _isValidVolumeInputArray(e,r){const n=e.length;for(let i=1;i<n;i++){const o=ke.getVolume(e[i].volumeId);if(r!==o.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const r of this.volumeIds)if(r.includes(e))return!0;return!1}getImageData(e){var s,c,l;if(!this.getDefaultActor())return;e||(e=this.getVolumeId());const n=(s=this.getActors())==null?void 0:s.find(f=>f.referencedId===e);if(!Oo(n,"vtkVolume"))return;const i=n.actor,o=ke.getVolume(e),a=i.getMapper().getInputData();return{dimensions:a.getDimensions(),spacing:a.getSpacing(),origin:a.getOrigin(),direction:a.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:(c=o==null?void 0:o.metadata)==null?void 0:c.Modality,FrameOfReferenceUID:(l=o==null?void 0:o.metadata)==null?void 0:l.FrameOfReferenceUID},get scalarData(){var f;return(f=o==null?void 0:o.voxelManager)==null?void 0:f.getScalarData()},scaling:o==null?void 0:o.scaling,hasPixelSpacing:!0,voxelManager:o==null?void 0:o.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,r){super.setCamera(e,r),this.setCameraClippingRange()}_setVolumeActors(e){for(let r=0;r<e.length;r++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&Wl[e])return this.viewportProperties.orientation=e,Wl[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(Wl).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let r=_r.MINIMUM_SLAB_THICKNESS;return e.forEach(n=>{n.slabThickness>r&&(r=n.slabThickness)}),r}getIntensityFromWorld(e){const r=this.getDefaultActor();if(!Oo(r,"vtkVolume"))return;const{actor:n}=r,i=n.getMapper().getInputData(),o=ke.getVolume(this.getVolumeId()),a=yr(i,e);return o.voxelManager.getAtIJKPoint(a)}getVolumeId(e){const r=this.getActors();if(!r)return;if(!(e!=null&&e.volumeId)){const i=r.find(o=>o.actor.getClassName()==="vtkVolume");return(i==null?void 0:i.referencedId)||(i==null?void 0:i.uid)}const n=r.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===(e==null?void 0:e.volumeId));return(n==null?void 0:n.referencedId)||(n==null?void 0:n.uid)}getViewReferenceId(e={}){var c;let{volumeId:r,sliceIndex:n}=e;if(!r){const l=this.getActors();if(!l)return;r=(c=l.find(f=>f.actor.getClassName()==="vtkVolume"))==null?void 0:c.referencedId}const i=this.getSliceIndex();n??(n=i);const{viewPlaneNormal:o,focalPoint:a}=this.getCamera(),s=r.includes("?")?"&":"?";return`volumeId:${r}${s}sliceIndex=${n}&viewPlaneNormal=${o.join(",")}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}}function Ul(t,e){const{imageData:r}=t.getImageData(),n=t.canvasToWorld(e);return yr(r,n)}function Nd(t,e){return t.indexToWorld(e)}function loe(t,e){const{imageData:r}=t.getImageData(),n=Nd(r,e);return t.worldToCanvas(n)}class Rn extends Xn{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:n}=kv(this)||{};return n},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(n,i=!0)=>{const{currentStepIndex:o}=Lf(this,n||this.getVolumeId(),i);return o},this.getSliceIndex=()=>{const{imageIndex:n}=kv(this)||{};return n},this.getCurrentImageId=()=>{const n=this.getDefaultActor();if(!n||!Oo(n,"vtkVolume"))return;const i=ke.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:o,focalPoint:a}=this.getCamera();return $c(i,a,o)},this.getSlicePlaneCoordinates=()=>{const n=this.getDefaultActor();if(!(n!=null&&n.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),o=ke.getVolume(i),a=this.getCamera(),{focalPoint:s,position:c,viewPlaneNormal:l}=a,f=Su(o,l),u=r5(n.actor,l,s),d=Math.round((u.current-u.min)/f),h=Math.round((u.max-u.current)/f),g=this.getSliceIndex(),p=[];for(let v=-d;v<=h;v++){const{newFocalPoint:w}=cd(s,c,u,l,f,v);p.push({sliceIndex:g+v,point:w})}return p};const{orientation:r}=this.options;if(r&&r!==As.ACQUISITION){this.applyViewOrientation(r);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,r=!1,n=!1){const i=ke.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,r,n)}async addVolumes(e,r=!1,n=!1){const i=ke.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,r,n)}jumpToWorld(e){const{focalPoint:r}=this.getCamera(),n=[0,0,0];bn(n,e,r);const i=this.getCamera(),o=i.viewPlaneNormal,a=gt(n,o),s=xt(o[0],o[1],o[2]);if(mr(s,s,a),Math.abs(s[0])>.001||Math.abs(s[1])>.001||Math.abs(s[2])>.001){const c=[0,0,0],l=[0,0,0];br(c,i.focalPoint,s),br(l,i.position,s),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,r=!0){let n,i;if(typeof e=="string"){if(Wl[e])({viewPlaneNormal:n,viewUp:i}=Wl[e]);else if(e==="acquisition")({viewPlaneNormal:n,viewUp:i}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:n,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:n,viewUp:i}=e),this.applyViewOrientation(e);r&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-_r.MAXIMUM_RAY_DISTANCE,_r.MAXIMUM_RAY_DISTANCE):e.setClippingRange(_r.MINIMUM_SLAB_THICKNESS,_r.MAXIMUM_RAY_DISTANCE)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const r=this.getVolumeId(),n=ke.getVolume(r);if(!n)throw new Error(`imageVolume with id: ${r} does not exist in cache`);const{direction:i}=n,o=i.slice(6,9).map(s=>-s),a=i.slice(3,6).map(s=>-s);return{viewPlaneNormal:o,viewUp:a}}_setViewPlaneToAcquisitionPlane(e){let r,n;if(e){const{direction:i}=e;r=i.slice(6,9).map(o=>-o),n=i.slice(3,6).map(o=>-o)}else({viewPlaneNormal:r,viewUp:n}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:r,viewUp:n}),this.initialViewUp=n,this.resetCamera()}getBlendMode(e){const r=this.getActors(),n=(e==null?void 0:e.length)>0?r.find(i=>e.includes(i.uid)):r[0];return(n==null?void 0:n.blendMode)||(n==null?void 0:n.actor.getMapper().getBlendMode())}setBlendMode(e,r=[],n=!1){let i=this.getActors();(r==null?void 0:r.length)>0&&(i=i.filter(o=>r.includes(o.uid))),i.forEach(o=>{var c;const{actor:a}=o,s=a.getMapper();(c=s.setBlendMode)==null||c.call(s,e),o.blendMode=e}),n&&this.render()}resetCamera(e){const{resetPan:r=!0,resetZoom:n=!0,resetRotation:i=!0,resetToCenter:o=!0,suppressEvents:a=!1,resetOrientation:s=!0}=e||{},{orientation:c}=this.viewportProperties;c&&s&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:r,resetZoom:n,resetToCenter:o});const l=this.getVtkActiveCamera(),f=l.getViewPlaneNormal(),u=l.getFocalPoint();if(this.getActors().forEach(h=>{if(!h.actor)return;const g=h.actor.getMapper();if(g.getClippingPlanes().length===0&&!(h!=null&&h.clippingFilter)){const v=Yi.newInstance(),w=Yi.newInstance(),m=[v,w];let y=_r.MINIMUM_SLAB_THICKNESS;h.slabThickness&&(y=h.slabThickness),this.setOrientationOfClippingPlanes(m,y,f,u),g.addClippingPlane(v),g.addClippingPlane(w)}}),i&&Wl[this.viewportProperties.orientation]!==void 0){const h=Wl[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:h.viewUp,viewPlaneNormal:h.viewPlaneNormal})}if(!a){const h={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};Qe(this.element,$e.CAMERA_RESET,h)}return!0}setSlabThickness(e,r=[]){e<.1&&(e=.1);let n=this.getActors();(r==null?void 0:r.length)>0&&(n=n.filter(o=>r.includes(o.uid))),n.forEach(o=>{Oo(o,"vtkVolume")&&(o.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(n=>{Oo(n,"vtkVolume")&&(n.slabThickness=_r.MINIMUM_SLAB_THICKNESS)});const r=this.getCamera();this.updateClippingPlanesForActors(r),this.triggerCameraModifiedEventIfNecessary(r,r),this.viewportProperties.slabThickness=void 0}getSliceViewInfo(){const{width:e,height:r}=this.getCanvas(),n=Ul(this,[0,0]),i=Ul(this,[e-1,0]),o=Ul(this,[0,r-1]),a=bn(Ae(),i,n),s=bn(Ae(),o,n),c=xn(Ae(),a,s);kn(a,a),kn(s,s),kn(c,c);const{dimensions:l}=this.getImageData(),[f,u,d]=l,p=[[0,0,0],[f-1,0,0],[0,u-1,0],[f-1,u-1,0],[0,0,d-1],[f-1,0,d-1],[0,u-1,d-1],[f-1,u-1,d-1]].map(D=>loe(this,D)).reduce((D,b)=>(D.minX=Math.min(D.minX,b[0]),D.minY=Math.min(D.minY,b[1]),D.maxX=Math.max(D.maxX,b[0]),D.maxY=Math.max(D.maxY,b[1]),D),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),v=Ul(this,[p.minX,p.minY]),w=OT(a[0],a[1],a[2],0,s[0],s[1],s[2],0,c[0],c[1],c[2],0,v[0],v[1],v[2],1),m=Ul(this,[p.maxX,p.maxY]),y=bn(Ae(),m,v),x=Or(ba(),w),{viewPlaneNormal:C}=this.getCamera();if(C.filter(D=>Math.abs(D)>cs).length>1)throw new Error("getSliceInfo is not supported for oblique views");const T=C.findIndex(D=>Math.abs(D)>1-cs);if(T===-1)throw new Error("Unable to determine slice axis");const _=gt(a,y)+1,E=gt(s,y)+1;return{sliceIndex:this.getSliceIndex(),width:_,height:E,slicePlane:T,sliceToIndexMatrix:w,indexToSliceMatrix:x}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const r=super.getViewReference(e);if(!(r!=null&&r.volumeId))return;const n=ke.getVolume(r.volumeId);return r.referencedImageId=$c(n,r.cameraFocalPoint,r.viewPlaneNormal),r}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=_r.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const n=ke.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(__(r.actor,n),Ls(r)){const l=r.actor.getProperty().getRGBTransferFunction(0);s5(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),Qe(this.element,$e.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:r}=this.getCamera(),n=_r.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:o})=>{const a=[Yi.newInstance(),Yi.newInstance()];return this.setOrientationOfClippingPlanes(a,n,r,i),{sliceIndex:o,planes:a.map(s=>({normal:s.getNormal(),origin:s.getOrigin()}))}})}}function uoe(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(K.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),fu())}const foe={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function doe(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,foe,r),JT.extend(t,e,r),K.setGet(t,e,["slice","useCustomExtents"]),K.setGetArray(t,e,["customDisplayExtent"],6),K.setGetArray(t,e,["backgroundColor"],4),uoe(t,e)}var hoe={extend:doe};function xA(t,e,r){const n=r.getCurrentImage(),i=n.getExtent(),o=[i[0],i[2],i[4]],{ijkMode:a}=r.getClosestIJKAxis();let s=r.isA("vtkImageArrayMapper")?r.getSubSlice():r.getSlice();a!==r.getSlicingMode()&&(s=r.getSliceAtPosition(s)),o[a]+=s;const c=[0,0,0];n.indexToWorld(o,c),o[a]+=1;const l=[0,0,0];n.indexToWorld(o,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],kn(l,l);const f=Yi.intersectWithLine(t,e,c,l);if(f.intersection){const u=f.x,d=[0,0,0];return n.worldToIndex(u,d),{t:f.t,absoluteIJK:d}}return null}function goe(t,e,r){const n=xA(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=[Math.round(n.absoluteIJK[0]),Math.round(n.absoluteIJK[1]),Math.round(n.absoluteIJK[2])];return a[0]<o[0]||a[0]>o[1]||a[1]<o[2]||a[1]>o[3]||a[2]<o[4]||a[2]>o[5]?null:{t:n.t,ijk:a}}return null}function poe(t,e,r){const n=xA(t,e,r);if(n){const o=r.getCurrentImage().getExtent(),a=n.absoluteIJK,s=[Math.floor(a[0]),Math.floor(a[1]),Math.floor(a[2])];if(s[0]<o[0]||s[0]>o[1]-1||s[1]<o[2]||s[1]>o[3]-1||s[2]<o[4]||s[2]>(o[5]?o[5]-1:o[5]))return null;const c=[a[0]-s[0],a[1]-s[1],a[2]-s[2]];return{t:n.t,ijk:s,pCoords:c}}return null}const{staticOffsetAPI:moe,otherStaticMethods:voe}=e5,{SlicingMode:mn}=n5;function yoe(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=n=>{const i=t.getCurrentImage();let o;if(n.length===3)o=n;else if(Number.isFinite(n)){const f=i.getBounds();switch(e.slicingMode){case mn.X:o=[n,(f[3]+f[2])/2,(f[5]+f[4])/2];break;case mn.Y:o=[(f[1]+f[0])/2,n,(f[5]+f[4])/2];break;case mn.Z:o=[(f[1]+f[0])/2,(f[3]+f[2])/2,n];break}}const a=[0,0,0];i.worldToIndex(o,a);const s=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case mn.I:l=es(a[0],s[0],s[1]);break;case mn.J:l=es(a[1],s[2],s[3]);break;case mn.K:l=es(a[2],s[4],s[5]);break;default:return 0}return l},t.setSliceFromCamera=n=>{const i=n.getFocalPoint();switch(e.slicingMode){case mn.I:case mn.J:case mn.K:{const o=t.getSliceAtPosition(i);t.setSlice(o)}break;case mn.X:t.setSlice(i[0]);break;case mn.Y:t.setSlice(i[1]);break;case mn.Z:t.setSlice(i[2]);break}},t.setXSlice=n=>{t.setSlicingMode(mn.X),t.setSlice(n)},t.setYSlice=n=>{t.setSlicingMode(mn.Y),t.setSlice(n)},t.setZSlice=n=>{t.setSlicingMode(mn.Z),t.setSlice(n)},t.setISlice=n=>{t.setSlicingMode(mn.I),t.setSlice(n)},t.setJSlice=n=>{t.setSlicingMode(mn.J),t.setSlice(n)},t.setKSlice=n=>{t.setSlicingMode(mn.K),t.setSlice(n)},t.getSlicingModeNormal=()=>{const n=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case mn.X:n[0]=1;break;case mn.Y:n[1]=1;break;case mn.Z:n[2]=1;break;case mn.I:c2(i,[1,0,0],n);break;case mn.J:c2(i,[0,1,0],n);break;case mn.K:c2(i,[0,0,1],n);break}return n};function r(){let n;switch(e.slicingMode){case mn.X:n=0;break;case mn.Y:n=1;break;case mn.Z:n=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),o=nM(i);let a=0;for(;a<3&&o[n+3*a]===0;++a);const s=o[n+3*a]<0;e.closestIJKAxis={ijkMode:a,flip:s}}t.setSlicingMode=n=>{e.slicingMode!==n&&(e.slicingMode=n,t.getCurrentImage()&&r(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===mn.NONE)&&t.getCurrentImage()&&r(),e.closestIJKAxis),t.getBounds=()=>{const n=t.getCurrentImage();if(!n)return fu();if(!e.useCustomExtents)return n.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:o}=t.getClosestIJKAxis();let a=e.slice;switch(o!==e.slicingMode&&(a=t.getSliceAtPosition(e.slice)),o){case mn.I:i[0]=a,i[1]=a;break;case mn.J:i[2]=a,i[3]=a;break;case mn.K:i[4]=a,i[5]=a;break}return n.extentToBounds(i)},t.getBoundsForSlice=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const o=t.getCurrentImage();if(!o)return fu();const a=o.getSpatialExtent(),{ijkMode:s}=t.getClosestIJKAxis();let c=n;switch(s!==e.slicingMode&&(c=t.getSliceAtPosition(n)),s){case mn.I:a[0]=c-i,a[1]=c+i;break;case mn.J:a[2]=c-i,a[3]=c+i;break;case mn.K:a[4]=c-i,a[5]=c+i;break}return o.extentToBounds(a)},t.intersectWithLineForPointPicking=(n,i)=>goe(n,i,t),t.intersectWithLineForCellPicking=(n,i)=>poe(n,i,t),t.getCurrentImage=()=>t.getInputData()}const woe={slicingMode:mn.NONE,closestIJKAxis:{ijkMode:mn.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function CA(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,woe,r),hoe.extend(t,e,r),K.get(t,e,["slicingMode"]),K.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),e5.implementCoincidentTopologyMethods(t,e),yoe(t,e)}const xoe=K.newInstance(CA,"vtkImageMapper");var Coe={newInstance:xoe,extend:CA,...moe,...voe,...n5};const{InterpolationType:T2}=oZ,{vtkErrorMacro:t9}=K,_2=4;function Soe(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let r=e.mtime,n;for(let i=0;i<_2;i++)e.componentData[i].rGBTransferFunction&&(n=e.componentData[i].rGBTransferFunction.getMTime(),r=r>n?r:n),e.componentData[i].piecewiseFunction&&(n=e.componentData[i].piecewiseFunction.getMTime(),r=r>n?r:n);return r},t.setRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].rGBTransferFunction!==o?(e.componentData[i].rGBTransferFunction=o,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].rGBTransferFunction},t.setPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),e.componentData[i].piecewiseFunction!==o?(e.componentData[i].piecewiseFunction=o,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[r].piecewiseFunction},t.setScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=r,o=n;return Number.isInteger(r)||(o=r,i=0),t.setPiecewiseFunction(i,o)},t.getScalarOpacity=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(r)},t.setComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(r<0||r>=_2)return t9("Invalid index"),!1;const i=Math.min(1,Math.max(0,n));return e.componentData[r].componentWeight!==i?(e.componentData[r].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return r<0||r>=_2?(t9("Invalid index"),0):e.componentData[r].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(T2.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(T2.LINEAR),t.getInterpolationTypeAsString=()=>K.enumToString(T2,e.interpolationType)}const Toe={independentComponents:!1,interpolationType:T2.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function SA(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,Toe,r),K.obj(t,e),!e.componentData){e.componentData=[];for(let n=0;n<_2;n++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}K.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),K.setGetArray(t,e,["labelOutlineThickness"]),Soe(t,e)}const _oe=K.newInstance(SA,"vtkImageProperty");var Eoe={newInstance:_oe,extend:SA};const{vtkDebugMacro:Doe}=K;function boe(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=Eoe.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;const n=i=>i[0].map((o,a)=>i.map(s=>s[a]));if(!e.mapperBounds||!n([r,e.mapperBounds]).reduce((i,o)=>i&&o[0]===o[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){Doe("Recomputing bounds..."),e.mapperBounds=r.map(o=>o),t.computeMatrix();const i=new Float64Array(16);Yt(i,e.matrix),Nn.transformBounds(r,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(r,n)=>{const i=e.mapper.getBoundsForSlice(r,n);if(!Nn.isValid(i))return i;t.computeMatrix();const o=new Float64Array(16);return Yt(o,e.matrix),Nn.transformBounds(i,o)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let r=e.mtime;if(e.property!==null){const n=e.property.getMTime();r=n>r?n:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let n=e.mapper.getMTime();r=n>r?n:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),n=e.mapper.getInput().getMTime(),r=n>r?n:r)}if(e.property!==null){let n=e.property.getMTime();r=n>r?n:r,e.property.getRGBTransferFunction()!==null&&(n=e.property.getRGBTransferFunction().getMTime(),r=n>r?n:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const Ioe={mapper:null,property:null,bounds:[...Nn.INIT_BOUNDS]};function TA(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ioe,r),s_.extend(t,e,r),e.boundsMTime={},K.obj(e.boundsMTime),K.set(t,e,["property"]),K.setGet(t,e,["mapper"]),K.getArray(t,e,["bounds"],6),boe(t,e)}const Ooe=K.newInstance(TA,"vtkImageSlice");var Moe={newInstance:Ooe,extend:TA};function _A(t){const e=gu.newInstance();let r=0,n=1024;return t.lower!==void 0&&t.upper!==void 0&&(r=t.lower,n=t.upper),e.addRGBPoint(r,0,0,0),e.addRGBPoint(n,1,1,1),e}function d5(t,e){const r=e.voxelManager.getScalarData();if(!t.getPointData)return;const n=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let o=0;o<e.columns*e.rows;o++)i[o*3]=r[o*4],i[o*3+1]=r[o*4+1],i[o*3+2]=r[o*4+2];e.rgba=!1,e.getPixelData=()=>i,n.set(i)}else n.set(r);t.modified()}function Jt(){return window.performance?performance.now():Date.now()}function Roe(t,e){return function(r){const n=((r-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(n,0),255)}}function Poe(t){const r=Math.max(...t.lut).toString(2).length-8,n=t.lut[0]>>r,i=t.lut[t.lut.length-1]>>r,o=t.firstValueMapped+t.lut.length-1;return function(a){return a<t.firstValueMapped?n:a>=o?i:t.lut[a-t.firstValueMapped]>>r}}function EA(t,e,r){return r?Poe(r):Roe(t,e)}function Loe(t,e,r,n,i){const o=t.maxPixelValue,a=t.minPixelValue,s=Math.min(a,0);if(t.cachedLut===void 0){const f=o-s+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(f)}const c=t.cachedLut.lutArray,l=EA(Array.isArray(e)?e[0]:e,Array.isArray(r)?r[0]:r,i);if(n)for(let f=a;f<=o;f++)c[f+-s]=255-l(f);else for(let f=a;f<=o;f++)c[f+-s]=l(f);return c}function Aoe(t,e,r){let n=Jt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=Jt(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a]=e[i[s]+-o],s+=2,a+=2;else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a]=e[i[s]],s+=2,a+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-n}function Noe(t,e,r){let n=Jt();const i=t.getPixelData();t.stats.lastGetPixelDataTime=Jt()-n;const o=t.minPixelValue;let a=0,s=0;const c=i.length;if(n=Jt(),o<0)for(;s<c;)r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=e[i[s++]+-o],r[a++]=i[s++];else for(;s<c;)r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=e[i[s++]],r[a++]=i[s++];t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-n}class ah{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new ah;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const r=this.m[0]*e[0]+this.m[2]*e[1],n=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],o=this.m[1]*e[2]+this.m[3]*e[3],a=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],s=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),r=this.m[3]*e,n=-this.m[1]*e,i=-this.m[2]*e,o=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=r,this.m[1]=n,this.m[2]=i,this.m[3]=o,this.m[4]=a,this.m[5]=s}rotate(e){const r=Math.cos(e),n=Math.sin(e),i=this.m[0]*r+this.m[2]*n,o=this.m[1]*r+this.m[3]*n,a=this.m[0]*-n+this.m[2]*r,s=this.m[1]*-n+this.m[3]*r;this.m[0]=i,this.m[1]=o,this.m[2]=a,this.m[3]=s}translate(e,r){this.m[4]+=this.m[0]*e+this.m[2]*r,this.m[5]+=this.m[1]*e+this.m[3]*r}scale(e,r){this.m[0]*=e,this.m[1]*=e,this.m[2]*=r,this.m[3]*=r}transformPoint(e){const r=e[0],n=e[1];return[r*this.m[0]+n*this.m[2]+this.m[4],r*this.m[1]+n*this.m[3]+this.m[5]]}}function wp(t,e){const r=new ah;if(!t.viewport.displayedArea)return r;r.translate(t.canvas.width/2,t.canvas.height/2);const n=t.viewport.rotation;n!==0&&r.rotate(n*Math.PI/180);let i=t.viewport.scale,o=t.viewport.scale;const a=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),s=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(o*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,o=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(s*o),l=t.canvas.width/(a*i);i=o=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(o*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return r.scale(i,o),n!==0&&r.rotate(-n*Math.PI/180),r.translate(t.viewport.translation.x,t.viewport.translation.y),n!==0&&r.rotate(n*Math.PI/180),t.viewport.hflip&&r.scale(-1,1),t.viewport.vflip&&r.scale(1,-1),r.translate(-a/2,-s/2),r}function E_(t,e,r){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=wp(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function D_(t,e){const r=t.renderingTools.lastRenderedImageId,n=t.renderingTools.lastRenderedViewport;return e.imageId!==r||!n||n.windowCenter!==t.viewport.voi.windowCenter||n.windowWidth!==t.viewport.voi.windowWidth||n.invert!==t.viewport.invert||n.rotation!==t.viewport.rotation||n.hflip!==t.viewport.hflip||n.vflip!==t.viewport.vflip||n.modalityLUT!==t.viewport.modalityLUT||n.voiLUT!==t.viewport.voiLUT||n.colormap!==t.viewport.colormap}function Fv(t,e){const r=t.renderingTools.renderCanvas;r.width=e.width,r.height=e.height;const n=r.getContext("2d");n.fillStyle="white",n.fillRect(0,0,r.width,r.height);const i=n.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=n,t.renderingTools.renderCanvasData=i}function b_(t){const e=t.image.imageId,r=t.viewport,n=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=n,t.renderingTools.lastRenderedViewport={windowCenter:r.voi.windowCenter,windowWidth:r.voi.windowWidth,invert:r.invert,rotation:r.rotation,hflip:r.hflip,vflip:r.vflip,modalityLUT:r.modalityLUT,voiLUT:r.voiLUT,colormap:r.colormap},t.renderingTools}function koe(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(Loe(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function Voe(t,e,r){const n=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!n)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const i=t.renderingTools.renderCanvas,{windowWidth:o,windowCenter:a}=t.viewport.voi;if((o===256||o===255)&&(a===128||a===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!D_(t,e)&&!r)return i;(i.width!==e.width||i.height!==e.height)&&Fv(t,e);let s=Jt();const c=koe(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Jt()-s;const l=t.renderingTools.renderCanvasData,f=t.renderingTools.renderCanvasContext;return e.rgba?Noe(e,c,l.data):Aoe(e,c,l.data),s=Jt(),f.putImageData(l,0,0),e.stats.lastPutImageDataTime=Jt()-s,i}function Foe(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,E_(t,n);const i=Voe(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=b_(t)}function Uoe(t,e,r){let n=Jt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-n;const o=i.length,a=t.minPixelValue;let s=3,c=0;if(n=Jt(),i instanceof Int16Array)if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;else if(i instanceof Uint16Array)for(;c<o;)r[s]=e[i[c++]],s+=4;else if(a<0)for(;c<o;)r[s]=e[i[c++]+-a],s+=4;else for(;c<o;)r[s]=e[i[c++]],s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-n}function Boe(t,e,r){let n=Jt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-n;const o=i.length;let a=3,s=0;for(n=Jt();s<o;)r[a]=e(i[s++]),a+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-n}function Goe(t,e,r){let n=Jt();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-n;const o=i.length,a=t.minPixelValue;let s=0,c=0,l;if(n=Jt(),i instanceof Int16Array)if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(i instanceof Uint16Array)for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else if(a<0)for(;c<o;)l=e[i[c++]+-a],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;else for(;c<o;)l=e[i[c++]],r[s++]=l,r[s++]=l,r[s++]=l,r[s++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-n}function Woe(t,e){if(zoe(t))return;const r=e.maxPixelValue*e.slope+e.intercept,n=e.minPixelValue*e.slope+e.intercept,i=r-n,o=(r+n)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:o,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=o)}function zoe(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function n9(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function $oe(t,e){return r=>r*t+e}function joe(t){const e=t.lut[0],r=t.lut[t.lut.length-1],n=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=n?r:t.lut[i]}function Hoe(t,e,r){return r?joe(r):$oe(t,e)}function Koe(t,e,r,n,i,o){const a=t.maxPixelValue,s=t.minPixelValue,c=Math.min(s,0);if(t.cachedLut===void 0){const d=a-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(d)}const l=t.cachedLut.lutArray,f=Hoe(t.slope,t.intercept,i),u=EA(e,r,o);if(t.isPreScaled)if(n)for(let d=s;d<=a;d++)l[d+-c]=255-u(d);else for(let d=s;d<=a;d++)l[d+-c]=u(d);else if(n)for(let d=s;d<=a;d++)l[d+-c]=255-u(f(d));else for(let d=s;d<=a;d++)l[d+-c]=u(f(d));return l}function DA(t,e,r){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&n9(t.cachedLut.modalityLUT,e.modalityLUT)&&n9(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!r||(Woe(e,t),Koe(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function qoe(t,e,r,n=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),Fv(t,e));const o=t.renderingTools.renderCanvas;if(!D_(t,e)&&!r)return o;(o.width!==e.width||o.height!==e.height)&&Fv(t,e),e.stats=e.stats||{};const a=t.renderingTools.renderCanvasData,s=t.renderingTools.renderCanvasContext;let c=Jt();e.stats.lastLutGenerateTime=Jt()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:f,windowCenter:u}=l.voi,d=u-f/2,p=255/(u+f/2-d);let v;l.invert?v=w=>255-(w-d)*p:v=w=>(w-d)*p,Boe(e,v,a.data)}else{const f=DA(e,l,r);n?Uoe(e,f,a.data):Goe(e,f,a.data)}return c=Jt(),s.putImageData(a,0,0),e.stats.lastPutImageDataTime=Jt()-c,o}function Xoe(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,E_(t,n);const i=qoe(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=b_(t)}const SC=0,TC=1,Yoe=2;function Joe(t,e,r){if(t>1)throw new Error("HSVToRGB expects hue < 1");const n=[];if(e===0)return n[0]=r,n[1]=r,n[2]=r,n;const i=Math.floor(t*6),o=6*t-i,a=r*(1-e),s=r*(1-e*o),c=r*(1-e*(1-o));switch(i){case 0:case 6:n[0]=r,n[1]=c,n[2]=a;break;case 1:n[0]=s,n[1]=r,n[2]=a;break;case 2:n[0]=a,n[1]=r,n[2]=c;break;case 3:n[0]=a,n[1]=s,n[2]=r;break;case 4:n[0]=c,n[1]=a,n[2]=r;break;case 5:n[0]=r,n[1]=a,n[2]=s;break}return n}function Zoe(t,e){let r;return t<e.Range[0]?r=e.MaxIndex+SC+1.5:t>e.Range[1]?r=e.MaxIndex+TC+1.5:r=(t+e.Shift)*e.Scale,Math.floor(r)}class I_{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,r){this.TableRange[0]=e,this.TableRange[1]=r}setHueRange(e,r){this.HueRange[0]=e,this.HueRange[1]=r}setSaturationRange(e,r){this.SaturationRange[0]=e,this.SaturationRange[1]=r}setValueRange(e,r){this.ValueRange[0]=e,this.ValueRange[1]=r}setRange(e,r){this.InputRange[0]=e,this.InputRange[1]=r}setAlphaRange(e,r){this.AlphaRange[0]=e,this.AlphaRange[1]=r}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const r=this.NumberOfColors-1;let n,i,o,a;r?(n=(this.HueRange[1]-this.HueRange[0])/r,i=(this.SaturationRange[1]-this.SaturationRange[0])/r,o=(this.ValueRange[1]-this.ValueRange[0])/r,a=(this.AlphaRange[1]-this.AlphaRange[0])/r):n=i=o=a=0;for(let s=0;s<=r;s++){const c=this.HueRange[0]+s*n,l=this.SaturationRange[0]+s*i,f=this.ValueRange[0]+s*o,u=this.AlphaRange[0]+s*a,d=Joe(c,l,f),h=[0,0,0,0];switch(this.Ramp){case"scurve":h[0]=Math.floor(127.5*(1+Math.cos((1-d[0])*Math.PI))),h[1]=Math.floor(127.5*(1+Math.cos((1-d[1])*Math.PI))),h[2]=Math.floor(127.5*(1+Math.cos((1-d[2])*Math.PI))),h[3]=Math.floor(u*255);break;case"linear":h[0]=Math.floor(d[0]*255+.5),h[1]=Math.floor(d[1]*255+.5),h[2]=Math.floor(d[2]*255+.5),h[3]=Math.floor(u*255+.5);break;case"sqrt":h[0]=Math.floor(Math.sqrt(d[0])*255+.5),h[1]=Math.floor(Math.sqrt(d[1])*255+.5),h[2]=Math.floor(Math.sqrt(d[2])*255+.5),h[3]=Math.floor(Math.sqrt(u)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(h)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,r=e+SC,n=e+TC,i=e+Yoe;this.UseBelowRangeColor||e===0?this.Table[r]=this.BelowRangeColor:this.Table[r]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[n]=this.AboveRangeColor:this.Table[n]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const r=this.getIndex(e);if(r<0)return this.NaNColor;if(r===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(r===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[r]}getIndex(e){const r={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?r.Scale=Number.MAX_VALUE:r.Scale=r.MaxIndex/(this.TableRange[1]-this.TableRange[0]),r.Range[0]=this.TableRange[0],r.Range[1]=this.TableRange[1],isNaN(e))return-1;let n=Zoe(e,r);return n===this.NumberOfColors+SC?n=0:n===this.NumberOfColors+TC&&(n=this.NumberOfColors-1),n}setTableValue(e,r,n,i,o){let a;if(typeof r=="number"&&n!==void 0&&i!==void 0&&o!==void 0)a=[r,n,i,o];else if(Array.isArray(r))a=r;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=a,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const r9=[0,0,0,0];function Qoe(t,e,r){r=r===null?100:r;const n=(e-t)/(r-1),i=[];for(;r-- >0;)i.push(t),t+=n;return i[i.length-1]=e,i}function eae(t,e){let r=0,n=t.length-1;for(;r<=n;){const i=r+Math.floor((n-r)/2),o=t[i];if(o===e)return i;e<o?n=i-1:r=i+1}return r}function tae(t,e){let r;const n=[],i=e.length;for(t.sort(function(o,a){return o-a}),r=0;r<i;r++)n[r]=eae(t,e[r]);return n}function Ww(t,e,r){let n;const i=[],o=[],a=[],s=[];for(r=r===null?1:r,n=0;n<e.length;n++){const f=e[n];i.push((t-1)*f[0]),o.push(f[1]),a.push(f[1])}const c=Qoe(0,1,t);for(n=0;n<t;n++)c[n]=(t-1)*Math.pow(c[n],r);const l=tae(i,c);for(n=1;n<t-1;n++){const f=l[n],u=(c[n]-i[f-1])/(i[f]-i[f-1]),d=o[f]-a[f-1];s[n]=u*d+a[f-1]}return s[0]=a[0],s[t-1]=o[e.length-1],s}function nae(t,e,r){let n;const i=[];e=e===null?256:e,r=r===null?1:r;const o=Ww(e,t.red,r),a=Ww(e,t.green,r),s=Ww(e,t.blue,r);for(n=0;n<e;n++){const c=Math.round(o[n]*255),l=Math.round(a[n]*255),f=Math.round(s[n]*255),u=[c,l,f,255];i.push(u)}return i}function rae(t,e){let r=$x[t];return r||(r=$x[t]={name:"",colors:[]}),!r.colors&&r.segmentedData&&(r.colors=nae(r.segmentedData,r.numColors,r.gamma)),{getId(){return t},getColorSchemeName(){return r.name},setColorSchemeName(i){r.name=i},getNumberOfColors(){return r.colors.length},setNumberOfColors(i){for(;r.colors.length<i;)r.colors.push(r9);r.colors.length=i},getColor(i){return this.isValidIndex(i)?r.colors[i]:r9},getColorRepeating(i){const o=r.colors.length;return i=o?i%o:0,this.getColor(i)},setColor(i,o){this.isValidIndex(i)&&(r.colors[i]=o)},addColor(i){r.colors.push(i)},insertColor(i,o){this.isValidIndex(i)&&r.colors.splice(i,1,o)},removeColor(i){this.isValidIndex(i)&&r.colors.splice(i,1)},clearColors(){r.colors=[]},buildLookupTable(i){if(!i)return;const o=r.colors.length;i.setNumberOfTableValues(o);for(let a=0;a<o;a++)i.setTableValue(a,r.colors[a])},createLookupTable(){const i=new I_;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<r.colors.length}}}function iae(t,e,r,n){let i=Jt();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,f,u,d;if(i=Jt(),r instanceof I_?d=r.Table:d=r,s<0)for(;l<a;)f=e[o[l++]+-s],u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)f=e[o[l++]],u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-i}function oae(t,e,r,n){let i=Jt();const o=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Jt()-i;const a=o.length,s=t.minPixelValue;let c=0,l=0,f,u,d;if(i=Jt(),r instanceof I_?d=r.Table:d=r,s<0)for(;l<a;)f=e(o[l++]+-s),u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];else for(;l<a;)f=e(o[l++]),u=d[f],n[c++]=u[0],n[c++]=u[1],n[c++]=u[2],n[c++]=u[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Jt()-i}function _C(t,e,r){return Math.max(e,Math.min(r,t))}function aae(t,e,r){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const n=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=rae(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const o=i.getId();if(!D_(t,e)&&!r&&t.renderingTools.colormapId===o)return n;(n.width!==e.width||n.height!==e.height)&&Fv(t,e);let a=Jt();(!t.renderingTools.colorLUT||r||t.renderingTools.colormapId!==o)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=o);const s=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,f=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:u,windowCenter:d}=l.voi,h=d-u/2,v=255/(d+u/2-h);let w;l.invert?w=m=>_C(Math.floor(255-(m-h)*v),0,255):w=m=>_C(Math.floor((m-h)*v),0,255),oae(e,w,f,s.data)}else{const u=DA(e,t.viewport,r);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Jt()-a,iae(e,u,f,s.data)}return a=Jt(),c.putImageData(s,0,0),e.stats.lastPutImageDataTime=Jt()-a,n}function sae(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const r=t.image;if(r===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const n=t.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),n.fillStyle="black",n.fillRect(0,0,t.canvas.width,t.canvas.height),n.imageSmoothingEnabled=!t.viewport.pixelReplication,E_(t,n);const i=aae(t,r,e),o=t.viewport.displayedArea.tlhc.x-1,a=t.viewport.displayedArea.tlhc.y-1,s=t.viewport.displayedArea.brhc.x-o,c=t.viewport.displayedArea.brhc.y-a;n.drawImage(i,o,a,s,c,0,0,s,c),t.renderingTools=b_(t)}function bA(t,e){const r=t.image;if(!t.canvas||!t.image)return;const n=Jt();if(r.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},r){let o=r.render;o||(t.viewport.colormap?o=sae:r.color?o=Foe:o=Xoe),o(t,e)}const i=Jt()-n;r.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function IA(t){return wp(t)}function fm(t,e){const r=IA(t);return r.invert(),r.transformPoint(e)}const cae={viewport:{}};function lae(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function uae(){const t=lae(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:lo.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,cae.viewport)}function bg(t,e){if(t==null)throw new Error(e)}function fae(t){return!(t==null||t===0||t===180)}function OA(t,e=null){return bg(t,"getImageSize: parameter image must not be undefined"),bg(t.width,"getImageSize: parameter image must have width"),bg(t.height,"getImageSize: parameter image must have height"),fae(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function O_(t,e,r=null){bg(t,"getImageScale: parameter canvas must not be undefined"),bg(e,"getImageScale: parameter image must not be undefined");const n=OA(e,r),i=e.rowPixelSpacing||1,o=e.columnPixelSpacing||1;let a=1,s=1;i<o?s=o/i:a=i/o;const c=t.height/n.height/a,l=t.width/n.width/s;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function MA(t,e,r,n){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return uae();const i=O_(t,e,0).scaleFactor;let o;return r==="PT"&&e.isPreScaled?o={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(o={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:o,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:r,voiLUT:e.voiLUT,colormap:n!==void 0?n:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function i9(t,e){return IA(t).transformPoint(e)}function dae(t){const{image:e}=t;t.viewport.scale=O_(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function hae(t){const{canvas:e}=t,{clientWidth:r,clientHeight:n}=e;(e.width!==r||e.height!==n)&&(e.width=r,e.height=n)}function gae(t,e,r){const n=t.viewport.scale,i=OA(t.image,t.viewport.rotation),o=Math.round(i.width*n),a=Math.round(i.height*n),s=t.viewport.translation.x,c=t.viewport.translation.y;return o===e&&a<=r||o<=e&&a===r&&s===0&&c===0}function pae(t,e,r){const n=t.viewport.scale,i=t.canvas.width,o=t.canvas.height,a=i/e,s=o/r,c=Math.sqrt(a*s);t.viewport.scale=c*n}function mae(t,e=!1){const r=t.canvas.width,n=t.canvas.height;hae(t),t.image!==void 0&&(e||gae(t,r,n)?dae(t):pae(t,r,n))}function vae(t,e){const{hflip:r,vflip:n,rotation:i}=e;if(t.x*=r?-1:1,t.y*=n?-1:1,i!==0){const o=i*Math.PI/180,a=Math.cos(o),s=Math.sin(o),c=t.x*a-t.y*s,l=t.x*s+t.y*a;t.x=c,t.y=l}return t}function yae(t,e=!0,r=!0){const{canvas:n,image:i,viewport:o}=t,a=O_(n,i,0).scaleFactor;o.vflip=!1,o.hflip=!1,e&&(o.translation.x=0,o.translation.y=0),r&&(o.displayedArea.tlhc.x=1,o.displayedArea.tlhc.y=1,o.displayedArea.brhc.x=i.columns,o.displayedArea.brhc.y=i.rows,o.scale=a)}const wae=1;class Jn extends qf{constructor(e){super(e),this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&mae(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=r=>{var n;return(n=this.getImagePlaneReferenceData(r))==null?void 0:n.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=r=>{const n=Coe.newInstance();n.setInputData(r);const i=Moe.newInstance();i.setMapper(n);const{preferSizeOverAccuracy:o}=o5().rendering;return o&&n.setPreferSizeOverAccuracy(!0),r.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=r=>{let n;return r!==void 0&&(n=this.perImageIdDefaultProperties.get(r)),n!==void 0?n:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,voiUpdatedWithSetProperties:s}=this;return{colormap:r,voiRange:n,VOILUTFunction:i,interpolationType:o,invert:a,isComputedVOI:!s}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:r}=this._cpuFallbackEnabledElement;return r.rotation},this.getRotationGPU=()=>{const{viewUp:r,viewPlaneNormal:n,flipVertical:i}=this.getCameraNoRotation(),o=i?is(Ae(),this.initialViewUp):this.initialViewUp,a=VT(o,r)*180/Math.PI,s=xn(Ae(),o,r);return gt(s,n)>=0?a:(360-a)%360},this.setRotation=r=>{const n=this.getCamera();if(this.useCPURendering?this.setRotationCPU(r):this.setRotationGPU(r),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),o={previousCamera:n,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.CAMERA_MODIFIED,o)},this.renderImageObject=r=>{this._setCSImage(r),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,r)},this._setCSImage=r=>{var n;r.isPreScaled=(n=r.preScale)==null?void 0:n.scaled,this.csImage=r},this.canvasToWorldCPU=(r,n=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,o]=fm(this._cpuFallbackEnabledElement,r),{origin:a,spacing:s,direction:c}=this.getImageData(),l=c.slice(0,3),f=c.slice(3,6);return Xt(n,a,l,i*s[0]),Xt(n,n,f,o*s[1]),n},this.worldToCanvasCPU=r=>{const{spacing:n,direction:i,origin:o}=this.getImageData(),a=i.slice(0,3),s=i.slice(3,6),c=yn(Ae(),r,o),l=[gt(c,a)/n[0],gt(c,s)/n[1]];return i9(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPU=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=window.devicePixelRatio||1,u=[r[0]*f,r[1]*f],d=[u[0]+this.sx,u[1]+this.sy];d[1]=l[1]-d[1];const h=c.displayToWorld(d[0],d[1],0,n);return i.setClippingRange(o[0],o[1]),[h[0],h[1],h[2]]},this.worldToCanvasGPU=r=>{const n=this.getRenderer(),i=this.getVtkActiveCamera(),o=i.getClippingRange(),a=i.getDistance();i.setClippingRange(a,a+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),f=c.worldToDisplay(...r,n);f[1]=l[1]-f[1];const u=[f[0]-this.sx,f[1]-this.sy];i.setClippingRange(o[0],o[1]);const d=window.devicePixelRatio||1;return[u[0]/d,u[1]/d]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=()=>this.imageIds[this.currentImageIdIndex],this.hasImageId=r=>this.imageIds.includes(r),this.hasImageURI=r=>{const n=this.imageIds;for(let i=0;i<n.length;i++)if(wr(n[i])===r)return!0;return!1},this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(bA(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraCPU({resetPan:n,resetZoom:i}),!0},gpu:(r={})=>{const{resetPan:n=!0,resetZoom:i=!0}=r;return this.resetCameraGPU({resetPan:n,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=ld(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.imageIds=[],this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return ld()}_configureRenderingPipeline(e){this.useCPURendering=e??ld();for(const r in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,r)){const n=this.renderingPipelineFunctions[r];this[r]=this.useCPURendering?n.cpu:n.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new ah,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),r=i_.newInstance();e.setActiveCamera(r),this.initialViewUp=[0,-1,0],r.setDirectionOfProjection(-0,-0,1),r.setViewUp(...this.initialViewUp),r.setParallelProjection(!0),r.setThicknessFromFocalPoint(.1),r.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){We.addEventListener($e.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),We.removeEventListener($e.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!Ls(e))return;const{actor:r}=e,n=r.getMapper().getInputData(),i=this.csImage;return{dimensions:n.getDimensions(),spacing:n.getSpacing(),origin:n.getOrigin(),direction:n.getDirection(),get scalarData(){return i==null?void 0:i.voxelManager.getScalarData()},imageData:r.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i==null?void 0:i.calibration,...this.calibration},preScale:{...i==null?void 0:i.preScale},voxelManager:i==null?void 0:i.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const r=e.spacing,n=this.csImage;return{dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>r,worldToIndex:i=>{const o=this.worldToCanvasCPU(i),a=fm(this._cpuFallbackEnabledElement,o);return[a[0],a[1],0]},indexToWorld:(i,o)=>{const a=i9(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(a,o)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...n==null?void 0:n.calibration,...this.calibration},preScale:{...n==null?void 0:n.preScale},voxelManager:n==null?void 0:n.voxelManager}}buildMetadata(e){const r=e.imageId,{pixelRepresentation:n,bitsAllocated:i,bitsStored:o,highBit:a,photometricInterpretation:s,samplesPerPixel:c}=dt("imagePixelModule",r),{windowWidth:l,windowCenter:f,voiLUTFunction:u}=e,{modality:d}=dt("generalSeriesModule",r),h=dt("scalingModule",r),g=dt(Bo.CALIBRATION,r);d==="PT"&&h&&this._addScalingToViewport(h),this.modality=d;const p=this._getValidVOILUTFunction(u);this.VOILUTFunction=p,this.calibration=g;let v=this._getImagePlaneModule(r);return this.useCPURendering||(v=this.calibrateIfNecessary(r,v)),{imagePlaneModule:v,imagePixelModule:{bitsAllocated:i,bitsStored:o,samplesPerPixel:c,highBit:a,photometricInterpretation:s,pixelRepresentation:n,windowWidth:l,windowCenter:f,modality:d,voiLUTFunction:p}}}calibrateIfNecessary(e,r){const n=dt("calibratedPixelSpacing",e),i=this.calibration!==n,{scale:o}=n||{};return this.hasPixelSpacing=o>0||r.rowPixelSpacing>0,r.calibration=n,i&&(this.calibration=n,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:o,calibration:n}),r}setDefaultProperties(e,r){r==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(r,e),this.getCurrentImageId()===r&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:r,VOILUTFunction:n,invert:i,interpolationType:o}={},a=!1){this.viewportStatus=this.csImage?Uo.PRE_RENDER:Uo.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??r,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??n,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??o},typeof e<"u"&&this.setColormap(e),typeof r<"u"&&this.setVOI(r,{suppressEvents:a,voiUpdatedWithSetProperties:!0}),typeof n<"u"&&this.setVOILUTFunction(n,a),typeof i<"u"&&this.setInvertColor(i),typeof o<"u"&&this.setInterpolationType(o)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Uo.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(Ef.LINEAR);const r=this.getTransferFunction();s5(r,this.initialTransferFunctionNodes);const i=Rv(r).reduce((s,c)=>(s.push(c[0],c[1],c[2],c[3]),s),[]),o=this.getDefaultActor(),a=d_(i,o.actor);this.setColormap(a)}resetToDefaultProperties(){var i;this.cpuRenderingInvalidated=!0,this.viewportStatus=Uo.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),r=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(i=r.colormap)!=null&&i.name&&this.setColormap(r.colormap);let n;r.voiRange==null?n=this._getVOIRangeForCurrentImage():n=r.voiRange,this.setVOI(n),this.setInterpolationType(Ef.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:r,invert:n}=this;this.setVOI(e),this.setInterpolationType(r),this.setInvertColor(n)}getCameraCPU(){const{metadata:e,viewport:r}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:n}=e,i=n.slice(6,9).map(u=>-u);let o=n.slice(3,6).map(u=>-u);if(r.rotation){const u=AT(ba(),r.rotation*Math.PI/180,i);o=Pt(Ae(),o,u)}const a=[this.element.clientWidth/2,this.element.clientHeight/2],s=this.canvasToWorld(a),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),f=li(c,l)/2;return{parallelProjection:!0,focalPoint:s,position:[0,0,0],parallelScale:f,scale:r.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[o[0],o[1],o[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:r,image:n}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:o,parallelScale:a,scale:s,flipHorizontal:c,flipVertical:l}=e,{clientHeight:f}=this.element;if(o){const d=this.worldToCanvasCPU(o),h=fm(this._cpuFallbackEnabledElement,d),g=this.worldToCanvasCPU(i.focalPoint),p=fm(this._cpuFallbackEnabledElement,g),v=Vt();Sr(v,e6(h[0],h[1]),e6(p[0],p[1]));const w=vae({x:v[0],y:v[1]},r);r.translation.x-=w.x,r.translation.y-=w.y}if(a){const{rowPixelSpacing:d}=n,h=f*d*.5/a;r.scale=h,r.parallelScale=a}if(s){const{rowPixelSpacing:d}=n;r.scale=s,r.parallelScale=f*d*.5/s}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=wp(this._cpuFallbackEnabledElement);const u={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.CAMERA_MODIFIED,u)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,focalPoint:[...e.map(n=>-n),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const r=this.getCameraCPU();this.setCameraCPU({...r,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:r}){const{viewport:n}=this._cpuFallbackEnabledElement;e!==void 0&&(n.hflip=e,this.flipHorizontal=n.hflip),r!==void 0&&(n.vflip=r,this.flipVertical=n.vflip)}setVOILUTFunction(e,r){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const n=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==n&&(i=!0),this.VOILUTFunction=n;const{voiRange:o}=this.getProperties();this.setVOI(o,{suppressEvents:r,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.rotation=e}setRotationGPU(e){const r=this.getPan(this.fitToCanvasCamera),n=this.getPan(),i=ya([0,0],r,n);this.setPan(i,!1);const{flipVertical:o}=this.getCamera(),a=o?is(Ae(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:a}),this.getVtkActiveCamera().roll(-e);const s=this.getPan(),c=this.getPan(this.fitToCanvasCamera),l=ya([0,0],s,c),f=Di([0,0],r,l);this.setPan(f,!1)}setInterpolationTypeGPU(e){const r=this.getDefaultActor();if(!r||!Ls(r))return;const{actor:n}=r;n.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r.pixelReplication=e!==Ef.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:r}=this._cpuFallbackEnabledElement;r&&(r.invert=e,this.invert=e)}setInvertColorGPU(e){const r=this.getDefaultActor();if(r&&Ls(r)){if(Oo(r,"vtkVolume")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Dg(i),this.invert=e}else if(Oo(r,"vtkImageSlice")){const i=r.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Dg(i),this.invert=e}}}setVOICPU(e,r={}){const{suppressEvents:n=!1}=r,{viewport:i,image:o}=this._cpuFallbackEnabledElement;if(!i||!o)return;if(typeof e>"u"){const{windowWidth:s,windowCenter:c}=o,l=Array.isArray(s)?s[0]:s,f=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:f,voiLUTFunction:o.voiLUTFunction};const{lower:u,upper:d}=ru(l,f,o.voiLUTFunction);e={lower:u,upper:d}}else{const{lower:s,upper:c}=e,{windowCenter:l,windowWidth:f}=nh(s,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:o.voiLUTFunction}),i.voi.windowWidth=f,i.voi.windowCenter=l}this.voiRange=e;const a={viewportId:this.id,range:e};n||Qe(this.element,$e.VOI_MODIFIED,a)}getTransferFunction(){const e=this.getDefaultActor();return!e||!Ls(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,r={}){const{suppressEvents:n=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:o=!1}=r;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const a=this.getDefaultActor();if(!a||!Ls(a))return;const s=a.actor;let c=e;if(typeof c>"u"){const h=s.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:h[0],upper:h[1]}}s.getProperty().setUseLookupTableScalarRange(!0);let l=s.getProperty().getRGBTransferFunction(0);const f=this.VOILUTFunction===lo.SAMPLED_SIGMOID;if((f||!l||i)&&(l=(f?h_:_A)(c),this.invert&&Dg(l),s.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=Rv(l)),f||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=o),n)return;const u={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};Qe(this.element,$e.VOI_MODIFIED,u)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:r,suvlbm:n,suvbsa:i}=e,o={};n&&(o.suvbwToSuvlbm=n/r),i&&(o.suvbwToSuvbsa=i/r),this.scaling.PT=o}_getNumCompsFromPhotometricInterpretation(e){let r=1;return(e==="RGB"||e.includes("YBR")||e==="PALETTE COLOR")&&(r=3),r}getImageDataMetadata(e){const{imagePlaneModule:r,imagePixelModule:n}=this.buildMetadata(e);let{rowCosines:i,columnCosines:o}=r;(i==null||o==null)&&(i=[1,0,0],o=[0,1,0]);const a=xt(i[0],i[1],i[2]),s=xt(o[0],o[1],o[2]),c=Ae();xn(c,a,s);let l=r.imagePositionPatient;l==null&&(l=[0,0,0]);const f=r.columnPixelSpacing||e.columnPixelSpacing,u=r.rowPixelSpacing||e.rowPixelSpacing,d=e.columns,h=e.rows,g=wae,p=1,v=e.numberOfComponents||this._getNumCompsFromPhotometricInterpretation(n.photometricInterpretation);return{bitsAllocated:n.bitsAllocated,numberOfComponents:v,origin:l,direction:[...a,...s,...c],dimensions:[d,h,p],spacing:[f,u,g],numVoxels:d*h*p,imagePlaneModule:r,imagePixelModule:n}}matchImagesForOverlay(e,r){return(i=>{const o=dt(Bo.IMAGE_PLANE,r),a=dt(Bo.IMAGE_PLANE,i),s=o.imageOrientationPatient,c=a.imageOrientationPatient;if(s&&c){if(At(o.imageOrientationPatient,a.imageOrientationPatient)){const f=o.imagePositionPatient,u=a.imagePositionPatient;if(f&&u&&At(f,u)){const h=o.rows,g=o.columns,p=a.rows,v=a.columns;if(h===p&&g===v)return i}}}else{const l=o.rows,f=o.columns,u=a.rows,d=a.columns;if(l===u&&f===d)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const r=this.imageIds[e];if(!r)return;const n=dt(Bo.IMAGE_PLANE,r);if(!n)return;const{imagePositionPatient:i,frameOfReferenceUID:o}=n;let{rowCosines:a,columnCosines:s}=n;a||(a=[1,0,0]),s||(s=[0,1,0]);const c=xn([0,0,0],s,a);return{FrameOfReferenceUID:o,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:r,sliceIndex:e}}_getCameraOrientation(e){const r=e.slice(6,9).map(i=>-i),n=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[r[0],r[1],r[2]],viewUp:[n[0],n[1],n[2]]}}createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){const s=new a.constructor(a.length),c=Lt.newInstance({name:"Pixels",numberOfComponents:o,values:s}),l=eh.newInstance();return l.setDimensions(n),l.setSpacing(i),l.setDirection(r),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a}){try{this._imageData=this.createVTKImageData({origin:e,direction:r,dimensions:n,spacing:i,numberOfComponents:o,pixelArray:a})}catch(s){console.error(s)}}async setStack(e,r=0){this._throwIfDestroyed(),this.imageIds=e,this.currentImageIdIndex=r,this.targetImageIdIndex=r;const n=dt(vp.IMAGE_RETRIEVE_CONFIGURATION,e[r],"stack");this.imagesLoader=n?(n.create||aA)(n):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=Ef.LINEAR,this.invert=!1,this.viewportStatus=Uo.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(r),o={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:r};return Qe(this.element,$e.VIEWPORT_NEW_IMAGE_SET,o),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,r){if(!r)return!1;const[n,i]=r.getSpacing(),[o,a]=r.getDimensions(),s=this._getImagePlaneModule(e.imageId),c=r.getDirection(),l=c.slice(0,3),f=c.slice(3,6),u=r.getPointData().getScalars().getDataType(),d=At(n,e.columnPixelSpacing),h=At(i,e.rowPixelSpacing),g=d||e.columnPixelSpacing===null&&n===1,p=h||e.rowPixelSpacing===null&&i===1,v=o===e.columns,w=a===e.rows,m=At(s.rowCosines,l),y=At(s.columnCosines,f),x=u===e.voxelManager.getScalarData().constructor.name;return g&&p&&v&&w&&m&&y&&x}_updateVTKImageDataFromCornerstoneImage(e){let n=this._getImagePlaneModule(e.imageId).imagePositionPatient;n==null&&(n=[0,0,0]),this._imageData.setOrigin(n),d5(this._imageData,e)}_loadAndDisplayImage(e,r){return this.useCPURendering?this._loadAndDisplayImageCPU(e,r):this._loadAndDisplayImageGPU(e,r)}_loadAndDisplayImageCPU(e,r){return new Promise((n,i)=>{function o(h,g,p){if(this.currentImageIdIndex!==g)return;const v=h.voxelManager.getScalarData(),w=h.preScale,m=w==null?void 0:w.scalingParameters,y=(w==null?void 0:w.scaled)&&(m==null?void 0:m.rescaleIntercept)%1!==0||(m==null?void 0:m.rescaleSlope)%1!==0;if(v instanceof Float32Array&&y){const C={min:h.maxPixelValue,max:h.minPixelValue},_=Math.abs(C.max-C.min)/65535,E=C.min,D=v.length,b=new Uint16Array(D);let I=65535,R=0;for(let M=0;M<D;M++){const P=Math.floor((v[M]-E)/_);b[M]=P,I=Math.min(I,P),R=Math.max(R,P)}h.minPixelValue=I,h.maxPixelValue=R,h.slope=_,h.intercept=E,h.getPixelData=()=>b,h.preScale={...h.preScale,scaled:!1}}this._setCSImage(h),this.viewportStatus=Uo.PRE_RENDER;const x={image:h,imageId:p,imageIdIndex:g,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.STACK_NEW_IMAGE,x),this._updateToDisplayImageCPU(h),this.render(),this.currentImageIdIndex=g,n(p)}function a(h,g,p){const v={error:h,imageIdIndex:g,imageId:p};this.suppressEvents||Qe(We,$e.IMAGE_LOAD_ERROR,v),i(h)}function s(h,g,p){return us(h,p).then(v=>{o.call(this,v,g,h)},v=>{a.call(this,v,g,h)})}const c=-5,l=Wt.Interaction,f={imageId:e,imageIdIndex:r},u={useRGBA:!0,requestType:l},d={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};Qe(this.element,$e.PRE_STACK_NEW_IMAGE,d),ei.addRequest(s.bind(this,e,r,u),l,f,c)})}successCallback(e,r){var l,f;const n=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==n)return;const i=(l=this.csImage)==null?void 0:l.imageFrame,o=r==null?void 0:r.imageFrame,a=(i==null?void 0:i.photometricInterpretation)||((f=this.csImage)==null?void 0:f.photometricInterpretation),s=(o==null?void 0:o.photometricInterpretation)||(r==null?void 0:r.photometricInterpretation);a!==s&&(this.stackInvalidated=!0),this._setCSImage(r);const c={image:r,imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(r),Qe(this.element,$e.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=n}errorCallback(e,r,n){if(!r)return;const i=this.imageIds.indexOf(e),o={error:n,imageIdIndex:i,imageId:e};Qe(We,$e.IMAGE_LOAD_ERROR,o)}getLoaderImageOptions(e){const r=this.imageIds.indexOf(e),{transferSyntaxUID:n}=dt("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:n,priority:5,requestType:Wt.Interaction,additionalDetails:{imageId:e,imageIdIndex:r}}}async loadImages(e,r){const n=await Promise.allSettled(e.map(o=>{const a=this.getLoaderImageOptions(o);return us(o,a).then(s=>(r.successCallback(o,s),o),s=>(r.errorCallback(o,!0,s),o))})),i=n.filter(o=>o.status==="rejected");if(i&&i.length){const o=new CustomEvent($e.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});We.dispatchEvent(o)}return n}_loadAndDisplayImageGPU(e,r){const n={imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};return Qe(this.element,$e.PRE_STACK_NEW_IMAGE,n),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const r=this.getImageDataMetadata(e),n=MA(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:o,voiLUTFunction:a}=n.voi;this.voiRange=ru(o,i,a),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...r},this.cpuImagePixelData=e.voxelManager.getScalarData();const s=Object.assign({},n,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?n:s,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=wp(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const r=[];e.forEach(n=>{const{imageId:i,...o}=n,a=ke.getImage(i),{origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u}=this.getImageDataMetadata(a),d=this.createVTKImageData({origin:s,dimensions:c,direction:l,spacing:f,numberOfComponents:u,pixelArray:a.voxelManager.getScalarData()}),h=this.createActorMapper(d);h&&(r.push({uid:n.actorUID??Cn(),actor:h,referencedId:i,...o}),n.callback&&n.callback({imageActor:h,imageId:n.imageId}))}),this.addActors(r)}_updateActorToDisplayImageId(e){const r=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),n=this.getViewPresentation();if(r&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(n),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),f=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:o,dimensions:a,spacing:s,numberOfComponents:c,pixelArray:f}),this._updateVTKImageDataFromCornerstoneImage(e);const u=this.createActorMapper(this._imageData),d=this.getActors();d.length&&d[0].uid===this.id?d[0].actor=u:d.unshift({uid:this.id,actor:u}),this.setActors(d);const{viewPlaneNormal:h,viewUp:g}=this._getCameraOrientation(o),p=this.getCamera();this.setCameraNoEvent({viewUp:g,viewPlaneNormal:h}),this.initialViewUp=g,this.resetCameraNoEvent(),this.setViewPresentation(n),this.triggerCameraEvent(this.getCamera(),p);const v=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const w=this._getInitialVOIRange(e);this.setVOI(w,{forceRecreateLUTFunction:!!v}),this.initialInvert=!!v,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.globalDefaultProperties.voiRange;const{windowCenter:r,windowWidth:n,voiLUTFunction:i}=e;let o=this._getVOIRangeFromWindowLevel(n,r,i);return o=this._getPTPreScaledRange()||o,o}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((e=this.csImage.preScale)!=null&&e.scalingParameters.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,r,n=lo.LINEAR){let i,o;if(typeof r=="number"&&typeof e=="number"?(i=r,o=e):Array.isArray(r)&&Array.isArray(e)&&(i=r[0],o=e[0]),i!==void 0&&o!==void 0)return ru(o,i,n)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Uo.PRE_RENDER;const r=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const n=this.perImageIdDefaultProperties.get(r);n!==void 0?this.setProperties(n):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return r}resetCameraCPU({resetPan:e=!0,resetZoom:r=!0}){const{image:n}=this._cpuFallbackEnabledElement;if(!n)return;yae(this._cpuFallbackEnabledElement,e,r);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:o,clientHeight:a}=this.element,s=[o/2,a/2],c=this.canvasToWorldCPU(s);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:r}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:!0})}scroll(e,r=!0,n=!1){const i=this.imageIds,o=this.targetImageIdIndex,a=i.length;let s=o+e;s=Math.max(0,s),n?s=s%a:s=Math.min(a-1,s),this.targetImageIdIndex=s;const c=i[s];ke.isLoaded(c)||!r?this.setImageIdIndex(s):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(s)},40));const f={newImageIdIndex:s,imageId:c,direction:e};s!==o&&Qe(this.element,$e.STACK_VIEWPORT_SCROLL,f)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const r=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,r)}triggerCameraEvent(e,r){const n={previousCamera:r,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||Qe(this.element,$e.CAMERA_MODIFIED,n)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),r={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||Qe(this.element,$e.IMAGE_SPACING_CALIBRATED,r),this._publishCalibratedEvent=!1}jumpToWorld(e){const r=this.getImageIds(),n=this.getImageData(),{direction:i,spacing:o}=n,a=$c({direction:i,spacing:o,imageIds:r},e,this.getCamera().viewPlaneNormal),s=r.indexOf(a);return s===-1?!1:(this.setImageIdIndex(s),this.render(),!0)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:r,voiLUTFunction:n}=this.csImage;return this._getVOIRangeFromWindowLevel(r,e,n)}_getValidVOILUTFunction(e){return Object.values(lo).includes(e)?e:lo.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:r}=this.getImageData();return{width:r[0],height:r[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,r={}){if(!super.isReferenceViewable(e,r))return!1;const{referencedImageId:n,sliceIndex:i}=e;if(e.volumeId&&!n)return r.asVolume;let o=this.getCurrentImageIdIndex(),a=this.imageIds[o];if(r.withNavigation&&typeof i=="number"&&(o=i,a=this.imageIds[o]),!a)return!1;if(r.asOverlay&&n&&this.matchImagesForOverlay(a,n))return!0;let{imageURI:s}=r;s||(s=wr(a));const l=wr(n)===s;if(l)return l;const{cameraFocalPoint:f}=e;if(r.asNearbyProjection&&f){const{spacing:u,direction:d,origin:h}=this.getImageData(),g=d.slice(6,9),p=Su({direction:d,spacing:u},g),v=yn(Ae(),f,h),w=gt(v,g),m=p/2;if(Math.abs(w)<=m)return!0}return!1}getViewReference(e={}){const{sliceIndex:r=this.getCurrentImageIdIndex()}=e,n=super.getViewReference(e),i=this.imageIds[r];if(i){if(n.referencedImageId=i,this.getCurrentImageIdIndex()!==r){const o=this.getImagePlaneReferenceData(r);if(!o)return;Object.assign(n,o)}return n}}setViewReference(e){if(!e)return;const{referencedImageId:r,sliceIndex:n}=e;if(typeof n=="number"&&r&&r===this.imageIds[n])this.scroll(n-this.targetImageIdIndex);else{const i=this.imageIds.indexOf(r);if(i!==-1)this.scroll(i-this.targetImageIdIndex);else throw new Error("Unsupported - referenced image id not found")}}getViewReferenceId(e={}){const{sliceIndex:r=this.currentImageIdIndex}=e;if(Array.isArray(r))throw new Error("Use of slice ranges for stacks not supported");return`imageId:${this.imageIds[r]}`}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const r=mp(e.name);this._cpuFallbackEnabledElement.viewport.colormap=r,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const n={viewportId:this.id,colormap:e};Qe(this.element,$e.COLORMAP_MODIFIED,n)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),o=i.getRGBTransferFunction(),a=mp(e.name)||Dv.getPresetByName(e.name);if(o)o.applyColorMap(a),o.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,o);else{const c=gu.newInstance();c.applyColorMap(a),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const s={viewportId:this.id,colormap:e};Qe(this.element,$e.COLORMAP_MODIFIED,s)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var i;const r=dt(Bo.IMAGE_PLANE,e);this.hasPixelSpacing=!r.usingDefaultValues||((i=this.calibration)==null?void 0:i.scale)>0,this.calibration||(this.calibration=r.calibration);const n={...r};return n.columnPixelSpacing||(n.columnPixelSpacing=1),n.rowPixelSpacing||(n.rowPixelSpacing=1),n.columnCosines||(n.columnCosines=[0,1,0]),n.rowCosines||(n.rowCosines=[1,0,0]),n.imagePositionPatient||(n.imagePositionPatient=[0,0,0]),n.imageOrientationPatient||(n.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),n}}class M_ extends Xn{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:r,orientation:n}=this.options,i=this.getVtkActiveCamera();r!=null&&i.setParallelProjection(r),n&&n!==As.ACQUISITION&&this.applyViewOrientation(n)}resetCamera({resetPan:e=!0,resetZoom:r=!0,resetToCenter:n=!0}={}){super.resetCamera({resetPan:e,resetZoom:r,resetToCenter:n});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-_r.MAXIMUM_RAY_DISTANCE,_r.MAXIMUM_RAY_DISTANCE):i.setClippingRange(_r.MINIMUM_SLAB_THICKNESS,_r.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,r){return null}setBlendMode(e,r,n){return null}resetProperties(e){const r=e?this.getActor(e):this.getDefaultActor();if(!r)throw new Error(`No actor found for the given volumeId: ${e}`);r.slabThickness&&(r.slabThickness=_r.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const n=ke.getVolume(e);if(!n)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(__(r.actor,n),Ls(r)){const i=r.actor.getProperty().getRGBTransferFunction(0);s5(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),Qe(this.element,$e.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-_r.MAXIMUM_RAY_DISTANCE,_r.MAXIMUM_RAY_DISTANCE):e.setClippingRange(_r.MINIMUM_SLAB_THICKNESS,_r.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}const RA="viewport-element",PA="cornerstone-canvas",o9=1e-4;function xae(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(PA),t.appendChild(e),e}function Cae(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(RA),t.appendChild(e),e}function Rs(t){const e=`canvas.${PA}`,r=`div.${RA}`,n=t.querySelector(r)||Cae(t),i=n.querySelector(e);if(i)return i;const o=xae(n),a=n.getBoundingClientRect(),s=window.devicePixelRatio||1,c=Math.ceil(a.width*s),l=Math.ceil(a.height*s);return o.width=c,o.height=l,o}async function R_(t,e,r,n=!1,i=!1){r.forEach(a=>{const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof Xn))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const o=r.map(async a=>{await t.getViewport(a).setVolumes(e,n,i)});await Promise.all(o)}async function LA(t,e,r,n=!1,i=!1){for(const a of r){const s=t.getViewport(a);if(!s)throw new Error(`Viewport with Id ${a} does not exist`);if(!(s instanceof Xn)){console.warn(`Viewport with Id ${a} is not a BaseVolumeViewport. Cannot add volume to this viewport.`);return}}const o=r.map(async a=>{await t.getViewport(a).addVolumes(e,n,i)});await Promise.all(o)}function AA(t,e,r){for(const n of r){const i=t.getViewport(n);if(!i)throw new Error(`Viewport with Id ${n} does not exist`);if(!i.addImages){console.warn(`Viewport with Id ${n} does not have addImages. Cannot add image segmentation to this viewport.`);return}}r.forEach(n=>{t.getViewport(n).addImages(e)})}class Sae{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,r){this.transferFunction[e]=r}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const r=this.transferFunction[0],n=r.getRedValue(e),i=r.getGreenValue(e),o=r.getBlueValue(e);return[n,i,o,this.opacity]}}class Tae{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class _ae{constructor(e,r){this.canvasProperties=new Sae(this),this.visibility=!1,this.mapper=new Tae(this),this.className="CanvasActor",this.derivedImage=r,this.viewport=e}renderRLE(e,r,n){const{width:i,height:o}=this.image;let{canvas:a}=this;(!a||a.width!==i||a.height!==o)&&(this.canvas=a=new window.OffscreenCanvas(i,o));const s=a.getContext("2d"),c=s.createImageData(i,o),{data:l}=c;l.fill(0);const{map:f}=n;let u=1/0,d=1/0,h=-1/0,g=-1/0;for(let w=0;w<o;w++){const m=f.getRun(w,0);if(!m)continue;d=Math.min(d,w),g=Math.max(g,w);const y=w*i<<2;let x;for(const C of m){const{start:S,end:T,value:_}=C;if(_===0){x||(x=[]),x.push(m.indexOf(C));continue}u=Math.min(u,S),h=Math.max(h,T);const E=this.canvasProperties.getColor(_).map(b=>b*255);let D=y+(S<<2);for(let b=S;b<T;b++)l[D++]=E[0],l[D++]=E[1],l[D++]=E[2],l[D++]=E[3]}}if(u>i)return;const p=h-u,v=g-d;s.putImageData(c,0,0,u-1,d-1,p+2,v+2),r.drawImage(a,u,d,p,v,u,d,p,v)}setMapper(e){this.mapper=e}render(e,r){if(!this.visibility)return;const n=this.image||this.getImage(),{width:i,height:o}=n,a=n.getScalarData();if(!a)return;const{voxelManager:s}=n;if(s&&s.map.getRun){this.renderRLE(e,r,s);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==o)&&(this.canvas=c=new window.OffscreenCanvas(i,o));const l=c.getContext("2d"),f=l.createImageData(i,o),{data:u}=f;let d=0,h=0,g=1/0,p=1/0,v=-1/0,w=-1/0;for(let x=0;x<o;x++)for(let C=0;C<i;C++){const S=a[d++];if(S){g=Math.min(C,g),p=Math.min(x,p),v=Math.max(C,v),w=Math.max(x,w);const T=this.canvasProperties.getColor(S);u[h]=T[0]*255,u[h+1]=T[1]*255,u[h+2]=T[2]*255,u[h+3]=127}h+=4}if(g>i)return;const m=v-g+1,y=w-p+1;l.putImageData(f,0,0,g,p,m,y),r.drawImage(c,g,p,m,y,g,p,m,y)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:r=>e.imageData.worldToIndex(r),indexToWorld:(r,n)=>e.imageData.indexToWorld(r,n),getDimensions:()=>e.dimensions,getScalarData:()=>{var r;return(r=this.derivedImage)==null?void 0:r.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:r=>{this.derivedImage=r,this.image=null},modified:()=>null}),this.image}}const Gg=class Gg extends qf{constructor(e){super({...e,canvas:e.canvas||Rs(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const r=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(r)?this.numberOfFrames:r},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const r=this.canvas,{clientWidth:n,clientHeight:i}=r;(r.width!==n||r.height!==i)&&(r.width=n,r.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(r,n=[0,0,0])=>{const i=this.videoCamera.panWorld,o=this.getWorldToCanvasRatio(),a=[i[0]*o,i[1]*o],s=[r[0]-a[0],r[1]-a[1]];return n.splice(0,2,s[0]/o,s[1]/o),n},this.worldToCanvas=r=>{const n=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(r[0]+n[0])*i,(r[1]+n[1])*i]},this.getRotation=()=>0,this.canvasToIndex=r=>{const n=this.getTransform();return n.invert(),n.transformPoint(r.map(i=>i*devicePixelRatio))},this.indexToCanvas=r=>this.getTransform().transformPoint(r).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var s;const r=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),o=this.canvasContext;o.resetTransform(),o.clearRect(0,0,this.canvas.width,this.canvas.height),o.transform(i[0]/r,i[1]/r,i[2]/r,i[3]/r,i[4]/r,i[5]/r),o.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const c of this.getActors())c.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),Qe(this.element,$e.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),Qe(this.element,$e.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(s=this.initialRender)==null||s.call(this);const a=this.getFrameNumber();this.isPlaying&&(a<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):a>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const r=typeof e=="string"?e:e.imageId,n=dt(Bo.IMAGE_PLANE,r);let i=n.rowCosines,o=n.columnCosines;(n.usingDefaultValues||i==null||o==null)&&(i=[1,0,0],o=[0,1,0]);const s=xt(i[0],i[1],i[2]),c=xt(o[0],o[1],o[2]),{rows:l,columns:f}=n,u=Ae();xn(u,s,c);let d=n.imagePositionPatient;d==null&&(d=[0,0,0]);const h=n.columnPixelSpacing||1,g=n.rowPixelSpacing||1,p=n.columns,v=n.rows,w=1,m=1;return this.hasPixelSpacing=!!n.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:d,rows:l,columns:f,direction:[...s,...c,...u],dimensions:[p,v,m],spacing:[h,g,w],hasPixelSpacing:this.hasPixelSpacing,numVoxels:p*v*m,imagePlaneModule:n}}setDataIds(e,r){var n;this.setVideo(e[0],(((n=r.viewReference)==null?void 0:n.sliceIndex)||0)+1)}setVideo(e,r){this.imageId=Array.isArray(e)?e[0]:e;const n=dt(Bo.IMAGE_URL,e);if(!(n!=null&&n.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=n,o=dt(Bo.GENERAL_SERIES,e);this.modality=o==null?void 0:o.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:a,numberOfFrames:s}=dt(Bo.CINE,e);return this.numberOfFrames=s,this.setVideoURL(i).then(()=>((!s||s===1)&&(s=Math.round(this.videoElement.duration*(a||30))),a||(a=Math.round(s/this.videoElement.duration)),this.fps=a,this.numberOfFrames=s,this.setFrameRange([1,s]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(r||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(r||1),c(this)},25)})))}async setVideoURL(e){return new Promise(r=>{this.videoElement.src=e,this.videoElement.preload="auto";const n=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",n),this.refreshRenderValues(),r(!0)};this.videoElement.addEventListener("loadedmetadata",n)})}getImageIds(){const e=new Array(this.numberOfFrames),r=this.imageId.replace(/[0-9]+$/,"");for(let n=0;n<this.numberOfFrames;n++)e[n]=`${r}${n+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const r=this.videoElement,n=this.renderFrame,o=r.currentTime+e*this.scrollSpeed/this.fps;r.currentTime=o;const a=s=>{n(),r.removeEventListener("seeked",a)};r.addEventListener("seeked",a)}async start(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=0,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async end(){const e=this.videoElement,r=this.renderFrame;if(e.currentTime=e.duration,e.paused){const n=i=>{r(),e.removeEventListener("seeked",n)};e.addEventListener("seeked",n)}}async setTime(e){const r=this.videoElement,n=this.renderFrame;if(r.currentTime=e,r.paused){const i=o=>{n(),r.removeEventListener("seeked",i)};r.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,r=up.FRAME){this.scrollSpeed=r===up.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var o;if(((o=this.scalarData)==null?void 0:o.frameNumber)===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const a=new Uint8ClampedArray;return a.getRange=()=>[0,255],a.frameNumber=-1,a}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const r=e.getContext("2d");r.drawImage(this.videoElement,0,0);const i=r.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,r=e.spacing,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>{const a=this.worldToCanvas(o),s=this.canvasToIndex(a);return[s[0],s[1],0]},indexToWorld:(o,a)=>{const s=this.indexToCanvas([o[0],o[1]]);return this.canvasToWorld(s,a)}},i={dimensions:e.dimensions,spacing:r,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:n,voxelManager:{forEach:(o,a)=>c5(a.imageData,{pointInShapeFn:a.isInObject??(()=>!0),callback:o,boundsIJK:a.boundsIJK,returnPoints:a.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(n,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const r=e.match(Gg.frameRangeExtractor),n=r?e.substring(0,r.index):e;return this.imageId.includes(n)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,r=128){const n=r-e/2,i=r+e/2-1;this.setVOI({lower:n,upper:i}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],r=Math.max(...e),n=e.map(c=>r/c),{lower:i=0,upper:o=255}=this.voiRange||{},a=(o-i+1)/255,s=i/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${n[0]*a} 0 0 0 ${s}           0 ${n[1]*a} 0 0 ${s}           0 0 ${n[2]*a} 0 ${s}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:r,focalPoint:n}=e;if(r&&(this.videoCamera.parallelScale=this.element.clientHeight/2/r),n!==void 0){const i=this.worldToCanvas(n),o=[this.element.clientWidth/2,this.element.clientHeight/2],a=[(i[0]-o[0])/this.videoCamera.parallelScale,(i[1]-o[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-a[0],this.videoCamera.panWorld[1]-a[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(){return this.imageId.replace("/frames/1",this.isPlaying?`/frames/${this.frameRange[0]}-${this.frameRange[1]}`:`/frames/${this.getFrameNumber()}`)}getViewReferenceId(e={}){const{sliceIndex:r}=e;return r===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(r)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${r[0]+1}-${r[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+r}`)}`}isReferenceViewable(e,r={}){let{imageURI:n}=r;const{referencedImageId:i,sliceIndex:o}=e;if(!super.isReferenceViewable(e))return!1;const a=this.getCurrentImageId();if(!n){const u=a.indexOf(":");n=a.substring(u+1,a.length-1)}if(r.withNavigation)return!0;const s=this.getSliceIndex();if(Array.isArray(o))return s>=o[0]&&s<=o[1];if(o!==void 0)return s===o;if(!i)return!1;const c=i.match(Gg.frameRangeExtractor);if(!c||!c[2])return!0;const l=c[2].split("-").map(u=>Number(u)),f=s+1;return l[0]<=f&&f<=(l[1]??l[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){let r=e==null?void 0:e.sliceIndex;return r||(r=this.isPlaying?[this.frameRange[0]-1,this.frameRange[1]-1]:this.getCurrentImageIdIndex()),{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:r}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,r=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(r),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const r=Math.floor(this.videoWidth*e),n=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-r)/2,o=(this.canvas.offsetHeight-n)/2,a=i/e,s=o/e;this.videoCamera.panWorld=[a,s],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,r=window.devicePixelRatio||1,n=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),o=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],a=[o[0]*i,o[1]*i],s=new ah;return s.scale(r,r),s.translate(o[0],o[1]),s.scale(n,n),s.translate(e[0],e[1]),s.translate(-a[0],-a[1]),s}updateCameraClippingPlanesAndRange(){}addImages(e){const r=this.getActors();e.forEach(n=>{const{imageId:i,...o}=n,a=ke.getImage(i),s=this.createActorMapper(a),c=n.actorUID??Cn();s&&(r.push({uid:c,actor:s,referencedId:i,...o}),n.callback&&n.callback({imageActor:s,imageId:i}))}),this.setActors(r)}createActorMapper(e){return new _ae(this,e)}};Gg.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let kd=Gg;const Eae=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`,a9=Symbol.for("map"),Dae="postrender",J0=class J0 extends qf{constructor(e){super({...e,canvas:e.canvas||Rs(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const n=this.canvas,{clientWidth:i,clientHeight:o}=n;(n.width!==i||n.height!==o)&&(n.width=i,n.height=o),this.refreshRenderValues()},this.canvasToWorld=n=>{if(!this.metadata)return;const[i,o]=this.canvasToIndex(n),{origin:a,spacing:s,direction:c}=this.getImageData(),l=xt(0,0,0),f=c.slice(0,3),u=c.slice(3,6);return Xt(l,a,f,i*s[0]),Xt(l,l,u,o*s[1]),[l[0],l[1],l[2]]},this.worldToCanvas=n=>{if(!this.metadata)return;const{spacing:i,direction:o,origin:a}=this.metadata,s=o.slice(0,3),c=o.slice(3,6),l=yn([0,0,0],n,a),f=[gt(l,s)/i[0],gt(l,c)/i[1]];return this.indexToCanvas(f)},this.postrender=()=>{this.refreshRenderValues(),Qe(this.element,$e.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=n=>{const i=this.getTransform();return i.invert(),i.transformPoint(n)},this.indexToCanvas=n=>this.getTransform().transformPoint(n),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=Cn(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const r=this.element.firstElementChild;r.insertBefore(this.microscopyElement,r.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener($e.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){var r;this.removeEventListeners(),(r=this.viewer)==null||r.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){var E;const r=this.metadataDicomweb.reduce((D,b)=>(D==null?void 0:D.NumberOfFrames)<b.NumberOfFrames?b:D),{TotalPixelMatrixColumns:n,TotalPixelMatrixRows:i,ImageOrientationSlide:o,ImagedVolumeWidth:a,ImagedVolumeHeight:s,ImagedVolumeDepth:c}=r,l=dt(Bo.IMAGE_PLANE,this.imageIds[e]);let f=o.slice(0,3),u=o.slice(3,6);(f==null||u==null)&&(f=[1,0,0],u=[0,1,0]);const d=xt(f[0],f[1],f[2]),h=xt(u[0],u[1],u[2]),g=Ae();xn(g,d,h);const{XOffsetInSlideCoordinateSystem:p=0,YOffsetInSlideCoordinateSystem:v=0,ZOffsetInSlideCoordinateSystem:w=0}=((E=r.TotalPixelMatrixOriginSequence)==null?void 0:E[0])||{},m=[p,v,w],y=a/n,x=s/i,C=n,S=i,T=c,_=1;return this.hasPixelSpacing=!!(a&&s),{bitsAllocated:8,numberOfComponents:3,origin:m,direction:[...d,...h,...g],dimensions:[C,S,_],spacing:[y,x,T],hasPixelSpacing:this.hasPixelSpacing,numVoxels:C*S*_,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:r}=e,n={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:o=>{const a=this.worldToCanvas(o),s=this.canvasToIndex(a);return[s[0],s[1],0]},indexToWorld:o=>{const a=this.indexToCanvas([o[0],o[1]]);return this.canvasToWorld(a)}};return{dimensions:e.dimensions,spacing:r,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:n,voxelManager:{forEach:(o,a)=>c5(a.imageData,{pointInShapeFn:a.isInObject??(()=>!0),callback:o,boundsIJK:a.boundsIJK,returnPoints:a.returnPoints??!1})}}}hasImageURI(e){return!0}setCamera(e){const r=this.getCamera(),{parallelScale:n,focalPoint:i}=e,o=this.getView(),{xSpacing:a}=this.internalCamera;if(n){const c=this.element.clientHeight/n,l=1/a/c;o.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);o.setCenter(l)}const s=this.getCamera();this.triggerCameraModifiedEventIfNecessary(r,s)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:r}=this.internalCamera,n=e*r,i=[this.element.clientWidth/2,this.element.clientHeight/2],o=this.canvasToWorld(i);return{parallelProjection:!0,focalPoint:o,position:o,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*n,viewPlaneNormal:[0,0,1]}}setDataIds(e,r){(r==null?void 0:r.miniNavigationOverlay)!==!1&&J0.addMiniNavigationOverlayCss();const n=(r==null?void 0:r.webClient)||dt(Bo.WADO_WEB_CLIENT,e[0]);if(!n)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,n)}async setWSI(e,r){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const n=await J0.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const i=this.imageIds.map(s=>{var u,d,h;const c=r.getDICOMwebMetadata(s);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=(u=c["00080008"])==null?void 0:u.Value;(l==null?void 0:l.length)===1&&(c["00080008"].Value=l[0].split("\\"));const f=(h=(d=c["00200052"])==null?void 0:d.Value)==null?void 0:h[0];return this.frameOfReferenceUID?f!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=f,c}),o=[];i.forEach(s=>{const c=new n.metadata.VLWholeSlideMicroscopyImage({metadata:s}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?o.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=o;const a=new n.viewer.VolumeImageViewer({client:r,metadata:o,controls:["overview","position"],retrieveRendered:!1,bindings:{}});a.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),a.deactivateDragPanInteraction(),this.viewer=a,this.map=a[a9],this.map.on(Dae,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const r=this.getCamera();this.setCamera({parallelScale:r.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[a9],r=window;return r.map=e,r.viewer=this.viewer,r.view=e==null?void 0:e.getView(),r.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const r=e.getResolution();if(!r||r<cs)return;const n=e.getCenter(),i=e.getProjection().getExtent(),o=e.getRotation(),a=e.getZoom(),{metadata:{spacing:[s,c]}}=this,l=1/r/s;Object.assign(this.internalCamera,{extent:i,centerIndex:n,worldToCanvasRatio:l,xSpacing:s,ySpacing:c,resolution:r,rotation:o,zoom:a})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var r;(r=this.getView())==null||r.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:r,rotation:n}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],o=new ah;return o.translate(i[0],i[1]),o.rotate(n),o.scale(1/r,-1/r),o.translate(-e[0],-e[1]),o}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=Eae,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};J0.getDicomMicroscopyViewer=async()=>CL("dicom-microscopy-viewer"),J0.overlayCssId="overlayCss";let Uv=J0;const NA={[Hn.ORTHOGRAPHIC]:Rn,[Hn.PERSPECTIVE]:Rn,[Hn.STACK]:Jn,[Hn.VOLUME_3D]:M_,[Hn.VIDEO]:kd,[Hn.WHOLE_SLIDE]:Uv};function x0(t){return NA[t].useCustomRenderingPipeline}const s9=2;class P_{constructor(e){if(this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=r=>{const i=this._getViewportsAsArray().map(o=>{if(o.getFrameOfReferenceUID()===r)return o.id});this.renderViewports(i)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const r=this._getViewportsAsArray(),n=[];for(let i=0;i<r.length;i++){const o=r[i];if(this._needsRender.has(o.id)){const a=this.renderViewportUsingCustomOrVtkPipeline(o);if(n.push(a),o.setRendered(),this._needsRender.delete(o.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,n.forEach(i=>{i!=null&&i.element&&Qe(i.element,$e.IMAGE_RENDERED,i)})},this.id=e||Cn(),this.useCPURendering=ld(),fp.set(this),!xL())throw new Error("@cornerstonejs/core is not initialized, run init() first");this.useCPURendering||(this.offscreenMultiRenderWindow=Mee.newInstance(),this.offScreenCanvasContainer=document.createElement("div"),this.offscreenMultiRenderWindow.setContainer(this.offScreenCanvasContainer)),this._viewports=new Map,this.hasBeenDestroyed=!1}enableElement(e){const r=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:n,viewportId:i}=r;if(!n)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:a}=r,s=x0(a);!this.useCPURendering&&!s?this.enableVTKjsDrivenViewport(r):this.addCustomViewport(r);const c=Rs(n),{background:l}=r.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(r),!x0(r.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),r.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const r=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const n=[],i=[];r.forEach(o=>{!this.useCPURendering&&!x0(o.type)?n.push(o):i.push(o)}),this.setVtkjsDrivenViewports(n),this.setCustomViewports(i),r.forEach(o=>{const a=Rs(o.element),{background:s}=o.defaultOptions;this.fillCanvasWithBackgroundColor(a,s)})}resize(e=!0,r=!0){this._throwIfDestroyed();const n=this._getViewportsAsArray(),i=[],o=[];n.forEach(a=>{x0(a.type)?o.push(a):i.push(a)}),i.length&&this._resizeVTKViewports(i,r,e),o.length&&this._resizeUsingCustomResizeHandler(o,r,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const r=this.getViewport(e);if(!r)throw new Error(`Viewport with Id ${e} does not exist`);if(!(r instanceof Jn))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return r}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(r=>r instanceof Jn)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),r=n=>n instanceof Xn;return e.filter(r)}render(){const r=this.getViewports().map(n=>n.id);this._setViewportsToBeRenderedNextFrame(r)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(r=>{this.offscreenMultiRenderWindow.removeRenderer(r.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),fp.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,r){const n=e.getContext("2d");let i;if(r){const o=r.map(a=>Math.floor(255*a));i=`rgb(${o[0]}, ${o[1]}, ${o[2]})`}else i="black";n.fillStyle=i,n.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:r,defaultOptions:n}=e;let i=n;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},r===Hn.ORTHOGRAPHIC&&(i={...i,orientation:As.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const r=[];return e.forEach(n=>{r.push(this._normalizeViewportInputEntry(n))}),r}_resizeUsingCustomResizeHandler(e,r=!0,n=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const o=i.getCamera();i.resetCamera(),r&&i.setCamera(o)}),n&&this.render()}_resizeVTKViewports(e,r=!0,n=!0){const i=e.map(o=>Rs(o.element));if(i.forEach(o=>{const a=window.devicePixelRatio||1;o.width=o.clientWidth*a,o.height=o.clientHeight*a}),i.length){const{offScreenCanvasWidth:o,offScreenCanvasHeight:a}=this._resizeOffScreenCanvas(i);this._resize(e,o,a)}e.forEach(o=>{const a=o.getCamera(),s=o.getRotation(),{flipHorizontal:c}=a;o.resetCameraForResize();const l=o.getDisplayArea();r&&(l?(c&&o.setCamera({flipHorizontal:c}),s&&o.setViewPresentation({rotation:s})):o.setCamera(a))}),n&&this.render()}enableVTKjsDrivenViewport(e){const n=this._getViewportsAsArray().filter(f=>x0(f.type)===!1),i=n.map(f=>f.canvas),o=Rs(e.element);i.push(o);const{offScreenCanvasWidth:a,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i),c=this._resize(n,a,s),l={...e,canvas:o};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:a,offScreenCanvasHeight:s,xOffset:c})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,r){const{element:n,canvas:i,viewportId:o,type:a,defaultOptions:s}=e;n.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:f}=r,{sxStartDisplayCoords:u,syStartDisplayCoords:d,sxEndDisplayCoords:h,syEndDisplayCoords:g,sx:p,sy:v,sWidth:w,sHeight:m}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,f);this.offscreenMultiRenderWindow.addRenderer({viewport:[u,d,h,g],id:o,background:s.background?s.background:[0,0,0]});const y={id:o,element:n,renderingEngineId:this.id,type:a,canvas:i,sx:p,sy:v,sWidth:w,sHeight:m,defaultOptions:s||{}};let x;if(a===Hn.STACK)x=new Jn(y);else if(a===Hn.ORTHOGRAPHIC||a===Hn.PERSPECTIVE)x=new Rn(y);else if(a===Hn.VOLUME_3D)x=new M_(y);else throw new Error(`Viewport Type ${a} is not supported`);this._viewports.set(o,x);const C={element:n,viewportId:o,renderingEngineId:this.id};x.suppressEvents||Qe(We,$e.ELEMENT_ENABLED,C)}addCustomViewport(e){const{element:r,viewportId:n,type:i,defaultOptions:o}=e;r.tabIndex=-1;const a=Rs(r),{clientWidth:s,clientHeight:c}=a;(a.width!==s||a.height!==c)&&(a.width=s,a.height=c);const l={id:n,renderingEngineId:this.id,element:r,type:i,canvas:a,sx:0,sy:0,sWidth:s,sHeight:c,defaultOptions:o||{}},f=NA[i],u=new f(l);this._viewports.set(n,u);const d={element:r,viewportId:n,renderingEngineId:this.id};Qe(We,$e.ELEMENT_ENABLED,d)}setCustomViewports(e){e.forEach(r=>{this.addCustomViewport(r)})}setVtkjsDrivenViewports(e){if(e.length){const r=e.map(a=>Rs(a.element));r.forEach(a=>{const s=window.devicePixelRatio||1,c=a.getBoundingClientRect();a.width=c.width*s,a.height=c.height*s});const{offScreenCanvasWidth:n,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(r);let o=0;for(let a=0;a<e.length;a++){const s=e[a],c=r[a],l={...s,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:n,offScreenCanvasHeight:i,xOffset:o}),o+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:r,offscreenMultiRenderWindow:n}=this,i=Math.max(...e.map(a=>a.height));let o=0;return e.forEach(a=>{o+=a.width}),r.width=o,r.height=i,n.resize(),{offScreenCanvasWidth:o,offScreenCanvasHeight:i}}_resize(e,r,n){let i=0;for(let o=0;o<e.length;o++){const a=e[o],{sxStartDisplayCoords:s,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:f,sx:u,sy:d,sWidth:h,sHeight:g}=this._getViewportCoordsOnOffScreenCanvas(a,r,n,i);i+=a.canvas.width,a.sx=u,a.sy=d,a.sWidth=h,a.sHeight=g,this.offscreenMultiRenderWindow.getRenderer(a.id).setViewport([s,c,l,f])}return i}_getViewportCoordsOnOffScreenCanvas(e,r,n,i){const{canvas:o}=e,{width:a,height:s}=o,c=i,l=0,f=c/r,u=l+(n-s)/n,d=a/r,h=s/n;return{sxStartDisplayCoords:f,syStartDisplayCoords:u,sxEndDisplayCoords:f+d,syEndDisplayCoords:u+h,sx:c,sy:l,sWidth:a,sHeight:s}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,r=e.getRenderWindow(),n=e.getRenderers();if(n.length){for(let i=0;i<n.length;i++){const{renderer:o,id:a}=n[i];this._needsRender.has(a)?o.setDraw(!0):o.setDraw(!1)}r.render();for(let i=0;i<n.length;i++)n[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let r;if(e.sWidth<s9||e.sHeight<s9){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(x0(e.type)===!0)r=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:n}=this,a=n.getOpenGLRenderWindow().get3DContext().canvas;r=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,a)}return r}_renderViewportFromVtkCanvasToOnscreenCanvas(e,r){const{element:n,canvas:i,sx:o,sy:a,sWidth:s,sHeight:c,id:l,renderingEngineId:f,suppressEvents:u}=e,{width:d,height:h}=i;return i.getContext("2d").drawImage(r,o,a,s,c,0,0,d,h),{element:n,suppressEvents:u,viewportId:l,renderingEngineId:f,viewportStatus:e.viewportStatus}}_resetViewport(e){const r=this.id,{element:n,canvas:i,id:o}=e,a={element:n,viewportId:o,renderingEngineId:r};e.removeWidgets(),Qe(We,$e.ELEMENT_DISABLED,a),n.removeAttribute("data-viewport-uid"),n.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(r=>{this._resetViewport(r)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();bae(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,r=e.getRenderWindow(),n=e.getRenderers();for(let c=0;c<n.length;c++)n[c].renderer.setDraw(!0);r.render();const a=e.getOpenGLRenderWindow().get3DContext().canvas,s=a.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:l,sy:f,sWidth:u,sHeight:d}=c,h=c.canvas,{width:g,height:p}=h;h.getContext("2d").drawImage(a,l,f,u,d,0,0,g,p)}),s}}function bae(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}class kA{constructor(e){this._color=[200,0,0],this.id=e.id,this._points=e.points,this._polys=e.polys,this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes(),this._updateCentroid()}_getSizeInBytes(){return this._points.length*4+this._polys.length*4}_updateCentroid(){const e=this._points.length/3;let r=0,n=0,i=0;for(let o=0;o<this._points.length;o+=3)r+=this._points[o],n+=this._points[o+1],i+=this._points[o+2];this._centroid=[r/e,n/e,i/e]}get color(){return this._color}set color(e){this._color=e}get points(){return this._points}set points(e){this._points=e,this._updateCentroid()}get polys(){return this._polys}set polys(e){this._polys=e}get segmentIndex(){return this._segmentIndex}get centroid(){return this._centroid}get flatPointsArray(){return this._points}get totalNumberOfPoints(){return this._points.length/3}}var ja;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ja||(ja={}));class h5{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i);let s=this._children.get(a);s||(s=new h5(this._target),this._children.set(a,s)),e=e.substring(i+1),s.addEventListener(e,r,n)}else this._addEventListener(e,r,n)}removeEventListener(e,r,n){const i=e.indexOf(".");if(i!==-1){const a=e.substring(0,i),s=this._children.get(a);if(!s)return;e=e.substring(i+1),s.removeEventListener(e,r,n),s.isEmpty&&this._children.delete(a)}else this._removeEventListener(e,r,n)}reset(){Array.from(this._children.entries()).forEach(([e,r])=>{if(r.reset(),r.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,r,n){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const a=(n==null?void 0:n.capture)??!1?ja.Capture:ja.Bubble,s=i.get(r)??ja.None;if(s&a){console.warn("A listener is already registered for this phase");return}i.set(r,s|a),this._target.addEventListener(e,r,n)}_removeEventListener(e,r,n){const o=(n==null?void 0:n.capture)??!1?ja.Capture:ja.Bubble,a=this._eventListeners.get(e);if(!a)return;(r?[r]:Array.from(a.keys())).forEach(c=>{const l=a.get(c)??ja.None;if(!!!(l&o))return;this._target.removeEventListener(e,c,n);const u=l^o;u===ja.None?a.delete(c):a.set(c,u)}),a.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,r){Array.from(r.entries()).forEach(([n,i])=>{const o=ja.Capture;for(let a=o;i;a<<=1){if(!(i&a))continue;const s=a===ja.Capture;this.removeEventListener(e,n,{capture:s}),i^=a}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,r])=>{this._unregisterAllListeners(e,r)})}}class VA{constructor(){this._targetsEventListeners=new Map}addEventListener(e,r,n,i){let o=this._targetsEventListeners.get(e);o||(o=new h5(e),this._targetsEventListeners.set(e,o)),o.addEventListener(r,n,i)}removeEventListener(e,r,n,i){const o=this._targetsEventListeners.get(e);o&&(o.removeEventListener(r,n,i),o.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,r])=>{r.reset(),this._targetsEventListeners.delete(e)})}}const Iae=Object.freeze(Object.defineProperty({__proto__:null,MultiTargetEventListenerManager:VA,TargetEventListeners:h5},Symbol.toStringTag,{value:"Module"}));function Oae(t,e){const r=t.getSize();for(let n=0;n<r;n++){const i=[];t.getNodeValue(n,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(n,i)}}function L_(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}const Mae=Symbol("LastRuntimeId"),Rae={},Pae=4294967295,Lae="-";function FA(t,e,r){return Aae(t!==null&&typeof t=="object"?t:Rae,Mae,(typeof r=="number"&&r>0?r:Pae)>>>0).join(typeof e=="string"?e:Lae)}function Aae(t,e,r){let n=t[e];n instanceof Array||(n=[0],Object.defineProperty(t,e,{value:n}));for(let i=!0,o=0;i&&o<n.length;++o){let a=n[o]|0;a<r?(i=!1,a=a+1):(a=0,o+1===n.length&&n.push(0)),n[o]=a}return n}const c9={},Nae={add:(t,e)=>{const r=wr(t);c9[r]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const r=wr(e);return c9[r]}}};function lg(t,e,r=1e-5){return Math.abs(t[0]+e[0])<r&&Math.abs(t[1]+e[1])<r&&Math.abs(t[2]+e[2])<r}function ur(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function kae(t,e){let r;e?r=[fr(e)]:r=Qi();const n=[];return r.forEach(i=>{const o=t.getActors(),a=i.getVolumeViewports();for(const s of a){const c=s.getActors();if(c.length!==o.length)continue;o.every(({uid:f})=>c.find(u=>f===u.uid))&&n.push(s)}}),n}const UA=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function BA(t,e,r=void 0,n="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const o=!e.imageId,a=!o&&e,s=o&&e,l=`renderGPUViewport-${a.imageId||s.volumeId}`,f=document.createElement("div"),u=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const d=t.width,h=t.height;f.style.width=`${d/u+o9}px`,f.style.height=`${h/u+o9}px`,f.style.visibility="hidden",f.style.position="absolute",document.body.appendChild(f);const g=l.split(":").join("-");f.setAttribute("viewport-id-for-remove",g);const p=Rs(f),v=fr(n)||new P_(n);let w=v.getViewport(l);if(!w){const m={viewportId:l,type:o?Hn.ORTHOGRAPHIC:Hn.STACK,element:f,defaultOptions:{...i,suppressEvents:!0}};v.enableElement(m),w=v.getViewport(l)}return new Promise(m=>{let y=!1,{viewReference:x}=i;const C=S=>{if(y)return;if(x){const I=x;x=null,w.setViewReference(I),w.render();return}t.getContext("2d").drawImage(p,0,0,p.width,p.height,0,0,t.width,t.height);const _=w.canvasToWorld([0,0]),E=w.canvasToWorld([p.width/u,0]),D=w.canvasToWorld([0,p.height/u]),b=1;y=!0,f.removeEventListener($e.IMAGE_RENDERED,C),setTimeout(()=>{v.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${g}"]`).forEach(R=>{R.remove()})},0),m({origin:_,bottomLeft:D,topRight:E,thicknessMm:b})};f.addEventListener($e.IMAGE_RENDERED,C),o?w.setVolumes([s],!1,!0):w.renderImageObject(e),w.resetCamera(),r==="PT"&&!UA(a)&&w.setProperties({voiRange:{lower:a.minPixelValue,upper:a.maxPixelValue}}),w.render()})}function GA(t,e,r,n,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const a=e,s=MA(t,a,r),c={canvas:t,viewport:s,image:a,renderingTools:{}};c.transform=wp(c);const l=!0;return new Promise((f,u)=>{bA(c,l),f(null)})}function Vae(t){const{canvas:e,imageId:r,viewReference:n,requestType:i=Wt.Thumbnail,priority:o=-5,renderingEngineId:a="_thumbnails",useCPURendering:s=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:f}=t,u=n==null?void 0:n.volumeId,d=u&&!r,h=n&&f?{...f,viewReference:n}:f,g=s?GA:BA;return new Promise((p,v)=>{function w(C,S){var D;const{modality:T}=dt("generalSeriesModule",S)||{},_=!d&&C,E=d&&C;_&&(_.isPreScaled=_.isPreScaled||((D=_.preScale)==null?void 0:D.scaled)),c&&(e.height=256,e.width=256),l&&_&&(e.width=_&&e.height*_.width/_.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,E&&s&&v(new Error("CPU rendering of volume not supported")),g(e,C,T,a,h).then(p)}function m(C,S){console.error(C,S),v(C)}function y(C,S,T){return us(C,T).then(_=>{w.call(this,_,C)},_=>{m.call(this,_,C)})}const x={useRGBA:!!s,requestType:i};if(u){const C=ke.getVolume(u);C||v(new Error(`Volume id ${u} not found in cache`));const S=C.imageIds[0];w(C,S)}else ei.addRequest(y.bind(null,r,null,x),i,{imageId:r},o)})}class WA{constructor(e="Tools",r=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.label=e,this._size=r}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}undo(e=1){for(;e>0&&this.undoAvailable>0;)this.ring[this.position].restoreMemo(!0),e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}redo(e=1){for(;e>0&&this.redoAvailable>0;){const r=(this.position+1)%this.size;this.ring[r].restoreMemo(!1),e--,this.position=r,this.undoAvailable++,this.redoAvailable--}}push(e){var n;if(!e)return;const r=e.restoreMemo?e:(n=e.createMemo)==null?void 0:n.call(e);if(r)return this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=r,r}}const Fae=new WA,A_=Object.freeze(Object.defineProperty({__proto__:null,DefaultHistoryMemo:Fae,HistoryMemo:WA},Symbol.toStringTag,{value:"Module"}));function EC(t,e){const r=dt("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||(a=1),s||(s=1);const c=Ae();Xt(c,o,n,-a/2),Xt(c,c,i,-s/2);const l=Ae();bn(l,e,c);const f=gt(l,i),u=gt(l,n);return[f/s,u/a]}function zA(t,e){const r=dt("imagePlaneModule",t);if(!r)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:n,rowCosines:i,imagePositionPatient:o}=r;let{columnPixelSpacing:a,rowPixelSpacing:s}=r;a||(a=1),s||(s=1);const c=Ae();return Xt(c,o,i,s*(e[0]-.5)),Xt(c,c,n,a*(e[1]-.5)),Array.from(c)}function Bv(t){const e=Qi(),r=[];return e.forEach(n=>{n.getViewports().forEach(o=>{o.hasImageURI(t)&&r.push(o)})}),r}function $A(t,e){const r=Uae(t,e);return r?r.index:null}function Uae(t,e){const r=e.getImageIds(),n=e.getCurrentImageIdIndex();if(r.length===0)return null;const i=c=>{const l=Bae(c);if(!l)return null;const f=Nc(l.planeNormal,l.imagePositionPatient);return Vv(f,t)},o={distance:i(r[n])??1/0,index:n},a=r.slice(n+1);for(let c=0;c<a.length;c++){const l=a[c],f=i(l);if(f!==null)if(f<=o.distance)o.distance=f,o.index=c+n+1;else break}const s=r.slice(0,n);for(let c=s.length-1;c>=0;c--){const l=s[c],f=i(l);if(!(f===null||f===o.distance))if(f<o.distance)o.distance=f,o.index=c;else break}return o.distance===1/0?null:o}function Bae(t){const e=dt("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:r,columnCosines:n,imagePositionPatient:i}=e,o=Dn(Ae(),...r),a=Dn(Ae(),...n),s=xn(Ae(),o,a);return{rowCosines:r,columnCosines:n,imagePositionPatient:i,planeNormal:s}}function N_(t){const{width:e,height:r}=t.getCanvas(),{sliceToIndexMatrix:n,indexToSliceMatrix:i}=t.getSliceViewInfo(),o=Ul(t,[0,0]),a=Ul(t,[e-1,0]),s=Ul(t,[0,r-1]),c=bn(Ae(),a,o),l=bn(Ae(),s,o),f=xn(Ae(),c,l);kn(c,c),kn(l,l),kn(f,f);const u=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),d=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!du(1,u)||!du(1,d))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:h}=t.getImageData(),g=t.getSliceViewInfo(),p=h.getSliceData(g);return{width:g.width,height:g.height,scalarData:p,sliceToIndexMatrix:n,indexToSliceMatrix:i}}const of={},xp={add:(t,e)=>{const[r,n]=t,i=`${r}_${n}`;of[i]||(of[i]={}),of[i]=e},get:(t,e,r)=>{if(t!=="spatialRegistrationModule")return;const n=`${e}_${r}`;if(of[n])return of[n];const i=`${r}_${e}`;if(of[i])return Or(ba(),of[i])}};th(xp.get.bind(xp));const Gae=.05;function jA(t,e){const r=t.getSliceIndex(),n=e.getSliceIndex(),i=dt("imagePlaneModule",r.toString()),o=dt("imagePlaneModule",n.toString());if(!i||!o){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:a}=o;if(!i.imageOrientationPatient.every((d,h)=>Math.abs(d-a[h])<Gae)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i==null?void 0:i.imageOrientationPatient,o==null?void 0:o.imageOrientationPatient);return}const c=i.imagePositionPatient,l=o.imagePositionPatient,f=yn(Ae(),c,l),u=Hy(ba(),f);xp.add([t.id,e.id],u)}function Gv(t){const{imageData:e,dimensions:r}=t.getImageData()||{};if(!e||!r)return[];const{canvas:n}=t,i=window.devicePixelRatio,o=[0,0],a=[n.width/i,0],s=[n.width/i,n.height/i],c=[0,n.height/i],l=t.canvasToWorld(o),f=t.canvasToWorld(a),u=t.canvasToWorld(s),d=t.canvasToWorld(c),h=e.worldToIndex(l),g=e.worldToIndex(f),p=e.worldToIndex(u),v=e.worldToIndex(d);return Wae({dimensions:r,imageData:e,topLeftImage:h,topRightImage:g,bottomRightImage:p,bottomLeftImage:v,topLeftWorld:l,topRightWorld:f,bottomRightWorld:u,bottomLeftWorld:d})}function Wae({dimensions:t,imageData:e,topLeftImage:r,topRightImage:n,bottomRightImage:i,bottomLeftImage:o,topLeftWorld:a,topRightWorld:s,bottomRightWorld:c,bottomLeftWorld:l}){const f=dm(r,t)?a:e.indexToWorld([0,0,0]),u=dm(n,t)?s:e.indexToWorld([t[0]-1,0,0]),d=dm(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),h=dm(o,t)?l:e.indexToWorld([0,t[1]-1,0]);return[f,u,h,d]}function dm(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function we(t){if(!t)return;const{viewportUid:e,renderingEngineUid:r}=t.dataset;return zr(e,r)}function zr(t,e){if(!e||!t)return;const r=fr(e);if(!r||r.hasBeenDestroyed)return;const n=r.getViewport(t);if(!n)return;const i=n.getFrameOfReferenceUID();return{viewport:n,renderingEngine:r,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function An(t){const e=Qi();for(let r=0;r<e.length;r++){const n=e[r];if(n.getViewport(t))return zr(t,n.id)}}function HA(){const t=[];return Qi().forEach(r=>{r.getViewports().forEach(({element:i})=>{t.push(we(i))})}),t}function zae(t){const e=we(t);if(!e)return;const{viewport:r}=e;if(!(r instanceof Jn))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${r.type}`);return r.getCornerstoneImage()}function KA(t){const e=t[0],{modality:r,seriesInstanceUID:n}=dt("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:c}=dt("imagePlaneModule",e),l={modality:r,imageOrientationPatient:i,pixelSpacing:o,frameOfReferenceUID:a,columns:s,rows:c,seriesInstanceUID:n};return t.every(u=>{const{modality:d,seriesInstanceUID:h}=dt("generalSeriesModule",u),{imageOrientationPatient:g,pixelSpacing:p,columns:v,rows:w}=dt("imagePlaneModule",u);return h===l.seriesInstanceUID&&d===l.modality&&v===l.columns&&w===l.rows&&At(g,l.imageOrientationPatient)&&At(p,l.pixelSpacing)})}const $ae=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function qA(t){return t?(Array.isArray(t)?t:[t]).find(r=>$ae.has(r)):!1}async function jae({viewport:t,options:e={}}){const r=t.getRenderingEngine();let n=e.volumeId||`${Cn()}`;n.split(":").length===0&&(n=`${hA()}:${n}`);const{id:i,element:o}=t,a=e.viewportId||i,s=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();r.enableElement({viewportId:a,type:Hn.ORTHOGRAPHIC,element:o,defaultOptions:{background:e.background,orientation:e.orientation}}),(await u5(n,{imageIds:s})).load();const u=r.getViewport(a);await R_(r,[{volumeId:n}],[a]);const d=()=>{u.render(),o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,d)};return(()=>{o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,d)})(),u.setViewPresentation(c),u.setViewReference(l),u.render(),u}async function Hae({viewport:t,options:e}){const r=t,{id:n,element:i}=r,o=t.getRenderingEngine(),{background:a}=e,s=e.viewportId||n,c=ke.getVolume(r.getVolumeId());if(!(c instanceof ih))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:s,type:Hn.STACK,element:i,defaultOptions:{background:a}},f=r.getViewReference();o.enableElement(l);const u=o.getViewport(s);return await u.setStack(c.imageIds),u.setViewReference(f),u.render(),u}function Kt(t,e=2){if(Array.isArray(t))return t.map(i=>Kt(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const r=Math.abs(t);if(r<1e-4)return`${t}`;const n=r>=100?e-2:r>=10?e-1:r>=1?e:r>=.1?e+1:r>=.01?e+2:r>=.001?e+3:e+4;return t.toFixed(n)}function Kl(t){return Math.round(t/cs)*cs}function XA(t,e,r){const n=t.length===e*r*4,i=t.length===e*r*3;if(n||i){const o=new Float32Array(e*r);let a=0,s=0;const c=n?4:3;for(let l=0;l<e;l++)for(let f=0;f<r;f++){const u=t[a],d=t[a+1],h=t[a+2];o[s]=(u+d+h)/3,a+=c,s++}return o}else return t}function YA(t){if(t instanceof Rn)return ke.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function JA(t,e){const r=[...t];return e>=r.length?(l9(r),r):(l9(r),r.slice(0,e))}function l9(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}function zw(t){const e=t.toString(16);return e.length==1?"0"+e:e}function Kae(t,e,r){return"#"+zw(t)+zw(e)+zw(r)}function qae(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}const Xae=Object.freeze(Object.defineProperty({__proto__:null,hexToRgb:qae,rgbToHex:Kae},Symbol.toStringTag,{value:"Module"}));function ZA(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(r){return console.debug("Error in JSON.stringify during deep comparison:",r),t===e}}function Yae(t,e,r){if(!r)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!r?void 0:r(e).metadata.Modality;throw new Error("Invalid viewport type")}const Jae=(t,e)=>t.reduce((r,n)=>((r[n[e]]=r[n[e]]||[]).push(n),r),{});function Zae(t){const e=t.map(a=>{const{imagePositionPatient:s}=dt("imagePlaneModule",a)||{};return{imageId:a,imagePositionPatient:s}});if(!e.every(a=>a.imagePositionPatient))return null;const r=Jae(e,"imagePositionPatient"),n=Object.keys(r),i=r[n[0]].length;return i===1||!n.every(a=>r[a].length===i)?null:r}function Qae(t,e){const r={};let n=[];const i=Object.keys(t);for(let o=0;o<i.length;o++){const a=new Set,s=t[i[o]];for(let c=0;c<s.length;c++){const l=e(s[c].imageId)||0;if(r[l]=r[l]||[],r[l].push({imageId:s[c].imageId}),a.add(l),a.size-1<c)return}if(o==0)n=Array.from(a);else if(!rse(n,a))return}return r}function Vh(t,e){const r=dt(e,t);try{return parseFloat(r)}catch{return}}function ese(t){const e=dt("20011003",t);try{const{InlineBinary:r}=e;if(r){const n=atob(r),i=new ArrayBuffer(n.length),o=new DataView(i);for(let a=0;a<n.length;a++)o.setUint8(a,n.charCodeAt(a));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function tse(t){let e=dt("0019100c",t)||dt("0019100C",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r)),parseFloat(e)}catch{return}}function nse(t){let e=dt("00431039",t);try{const{InlineBinary:r}=e;return r&&(e=atob(r).split("//")),parseFloat(e[0])%1e5}catch{return}}function rse(t,e){if(t.length!=e.size)return!1;for(let r=0;r<t.length;r++)if(!e.has(t[r]))return!1;return!0}function ise(t){const e=dt("petImageModule",t);return e?e.frameReferenceTime:0}function k_(t){const e=Zae(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const r=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],n=[i=>Vh(i,r[0]),i=>Vh(i,r[1]),i=>Vh(i,r[2]),i=>Vh(i,r[3]),i=>Vh(i,r[4]),ese,tse,nse,ise];for(let i=0;i<n.length;i++){const o=Qae(e,n[i]);if(o)return{imageIdGroups:Object.keys(o).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>o[c].map(l=>l.imageId)),splittingTag:r[i]}}return{imageIdGroups:[t],splittingTag:null}}function ose(t){const{imageIdGroups:e,splittingTag:r}=k_(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:r}}function ase(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o}=e;if(e.modality==="PT"&&typeof o=="number")for(let a=0;a<r;a++)t[a]=o*(t[a]*n+i);else for(let a=0;a<r;a++)t[a]=t[a]*n+i;return t}function Wv(t,e,r){return Math.min(Math.max(e,t),r)}function Xf(t,e){if(!we(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof Jn&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:n,delta:i,scrollSlabs:o}=e;if(t instanceof Rn)sse(t,n,i,o);else{const a=t.getCurrentImageIdIndex();if(a+i>t.getImageIds().length-1||a+i<0){const s={imageIdIndex:a,direction:i};Qe(We,$e.STACK_SCROLL_OUT_OF_BOUNDS,s)}t.scroll(i,e.debounceLoading,e.loop)}}function sse(t,e,r,n=!1){const i=n,{numScrollSteps:o,currentStepIndex:a,sliceRangeInfo:s}=Lf(t,e,i);if(!s)return;const{sliceRange:c,spacingInNormalDirection:l,camera:f}=s,{focalPoint:u,viewPlaneNormal:d,position:h}=f,{newFocalPoint:g,newPosition:p}=cd(u,h,c,d,l,r);t.setCamera({focalPoint:g,position:p}),t.render();const v=a+r,w={volumeId:e,viewport:t,delta:r,desiredStepIndex:v,currentStepIndex:a,numScrollSteps:o,currentImageId:t.getCurrentImageId()};(v>o||v<0)&&t.getCurrentImageId()?Qe(We,$e.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,w):Qe(We,$e.VOLUME_VIEWPORT_SCROLL,w)}async function V_(t,e={}){const{imageIndex:r,debounceLoading:n,volumeId:i}=e,o=we(t);if(!o)throw new Error("Element has been disabled");const{viewport:a}=o,{imageIndex:s,numberOfSlices:c}=cse(a,n),f=lse(c,r)-s;Xf(a,{delta:f,debounceLoading:n,volumeId:i})}function cse(t,e){return t instanceof Jn?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function lse(t,e){const r=t-1;return Wv(e,0,r)}function g5(t,e,r={}){const n=ke.getVolume(t);if(!n)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:o,direction:a,dimensions:s}=n,{minX:c,maxX:l,minY:f,maxY:u,minZ:d,maxZ:h}=e,g=[Math.min(c,l),Math.min(f,u),Math.min(d,h)],p=Nd(n.imageData,g),v=[Math.abs(l-c)+1,Math.abs(u-f)+1,Math.abs(h-d)+1],{targetBuffer:w}=r,m={metadata:i,dimensions:v,spacing:o,origin:p,direction:a,targetBuffer:w,scalarData:(w==null?void 0:w.type)==="Float32Array"?new Float32Array(v[0]*v[1]*v[2]):void 0},y=s1(Cn(),m),x=y.voxelManager.getCompleteScalarDataArray(),C=v[0]*v[1],S=s[0]*s[1],T=n.voxelManager.getCompleteScalarDataArray();for(let _=0;_<v[2];_++)for(let E=0;E<v[1];E++){const D=Nd(y.imageData,[0,E,_]),b=yr(n.imageData,D),I=b[2]*S+b[1]*s[0]+b[0],R=T.slice(I,I+v[0]),M=_*C+E*v[0];x.set(R,M)}return y.voxelManager.setCompleteScalarDataArray(x),y}function p5(t,e){const{viewUp:r,viewPlaneNormal:n}=e,i=x2(t,[0,0,0]),o=is(Ae(),r),a=is(Ae(),n),s=xn(Ae(),o,a),c=bn(Ae(),x2(t,o),i),l=bn(Ae(),x2(t,a),i);kn(c,c),kn(l,l);const f=xn(Ae(),c,l);return{worldVecRowDir:s,worldVecColDir:o,worldVecSliceDir:a,ijkVecRowDir:f,ijkVecColDir:c,ijkVecSliceDir:l}}const QA=(t,e)=>Yae(t,e,ke.getVolume),cn=Object.freeze(Object.defineProperty({__proto__:null,HistoryMemo:A_,PointsManager:S2,ProgressiveIterator:Av,RLEVoxelMap:I0,VoxelManager:ls,actorIsA:Oo,applyPreset:wA,autoLoad:xC,calculateViewportsSpatialRegistration:jA,calibratedPixelSpacingMetadataProvider:Nae,clamp:_C,clip:Wv,color:Xae,colormap:Bte,convertStackToVolumeViewport:jae,convertToGrayscale:XA,convertVolumeToStackViewport:Hae,createLinearRGBTransferFunction:_A,createSigmoidRGBTransferFunction:h_,createSubVolume:g5,decimate:oA,deepClone:pa,deepEqual:ZA,deepMerge:ci,eventListener:Iae,generateVolumePropsFromImageIds:l5,genericMetadataProvider:Hl,getBufferConfiguration:r_,getClosestImageId:$c,getClosestStackImageIndexForPoint:$A,getCurrentVolumeViewportSlice:N_,getDynamicVolumeInfo:ose,getImageLegacy:zae,getImageSliceDataForVolumeViewport:kv,getMinMax:L_,getRandomSampleFromArray:JA,getRuntimeId:FA,getScalingParameters:rA,getSliceRange:r5,getSpacingInNormalDirection:Su,getTargetVolumeAndSpacingInNormalDir:oh,getViewportImageCornersInWorld:Gv,getViewportImageIds:YA,getViewportModality:QA,getViewportsWithImageURI:Bv,getViewportsWithVolumeId:a1,getVoiFromSigmoidRGBTransferFunction:yA,getVolumeActorCorners:oL,getVolumeDirectionVectors:p5,getVolumeId:Zs,getVolumeSliceRangeInfo:vA,getVolumeViewportScrollInfo:Lf,getVolumeViewportsContainingSameVolumes:kae,hasFloatScalingParameters:x_,hasNaNValues:CC,imageIdToURI:wr,imageRetrieveMetadataProvider:vp,imageToWorldCoords:zA,indexWithinDimensions:ur,invertRgbTransferFunction:Dg,isEqual:At,isEqualAbs:Fte,isEqualNegative:_L,isImageActor:Ls,isOpposite:lg,isPTPrescaledWithSUV:UA,isValidVolume:KA,isVideoTransferSyntax:qA,jumpToSlice:V_,loadImageToCanvas:Vae,makeVolumeMetadata:nA,planar:ooe,pointInShapeCallback:c5,renderToCanvasCPU:GA,renderToCanvasGPU:BA,roundNumber:Kt,roundToPrecision:Kl,scaleArray:ase,scaleRgbTransferFunction:Oae,scroll:Xf,snapFocalPointToSlice:cd,sortImageIdsAndGetSpacing:w_,spatialRegistrationMetadataProvider:xp,splitImageIdsBy4DTags:k_,transferFunctionUtils:Wte,transformIndexToWorld:Nd,transformWorldToIndex:yr,transformWorldToIndexContinuous:x2,triggerEvent:Qe,updateVTKImageDataWithCornerstoneImage:d5,uuidv4:Cn,windowLevel:Gte,worldToImageCoords:EC},Symbol.toStringTag,{value:"Module"}));class eN extends sA{constructor(e,r){super(e,r),this._timePointIndex=0,this._loadedTimePoints=new Set,this._getImageIdRequests=(o,a)=>this.getImageIdsRequests(o,a),this.getImageLoadRequests=o=>{const a=this.getImageIdsToLoad();return this._getImageIdRequests(a,o)};const{imageIdGroups:n,splittingTag:i}=e;this._splittingTag=i,this._imageIdGroups=n,this.numTimePoints=this._imageIdGroups.length}_getImageIdsToLoad(){const e=this._imageIdGroups,r=this._timePointIndex,n=[...e[r]];let i=r-1,o=r+1;for(;i>=0||o<e.length;)i>=0&&n.push(...e[i--]),o<e.length&&n.push(...e[o++]);return n}getImageIdsToLoad(){return this._getImageIdsToLoad()}get timePointIndex(){return this._timePointIndex}set timePointIndex(e){this._timePointIndex!==e&&(this._timePointIndex=e,this.voxelManager.setTimePoint(e),this.invalidateVolume(!0),Qe(We,$e.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,{volumeId:this.volumeId,timePointIndex:e,numTimePoints:this.numTimePoints,imageIdGroupIndex:e,numImageIdGroups:this.numTimePoints,splittingTag:this.splittingTag}))}scroll(e){const r=this._timePointIndex+e;r<0?this.timePointIndex=this.numTimePoints-1:r>=this.numTimePoints?this.timePointIndex=0:this.timePointIndex=r}getCurrentTimePointImageIds(){return this._imageIdGroups[this._timePointIndex]}flatImageIdIndexToTimePointIndex(e){return Math.floor(e/this._imageIdGroups[0].length)}flatImageIdIndexToImageIdIndex(e){return e%this._imageIdGroups[0].length}get splittingTag(){return this._splittingTag}isTimePointLoaded(e){return this._loadedTimePoints.has(e)}markTimePointAsLoaded(e){this._loadedTimePoints.add(e),Qe(We,$e.DYNAMIC_VOLUME_TIME_POINT_LOADED,{volumeId:this.volumeId,timePointIndex:e})}checkTimePointCompletion(e){const r=this.flatImageIdIndexToTimePointIndex(e);this._imageIdGroups[r].every(o=>{const a=this.getImageIdIndex(o);return this.cachedFrames[a]===_o.FULL_RESOLUTION})&&!this.isTimePointLoaded(r)&&this.markTimePointAsLoaded(r)}}const sh=new u_("imageRetrievalPool");sh.setMaxSimultaneousRequests(Wt.Interaction,200);sh.setMaxSimultaneousRequests(Wt.Thumbnail,200);sh.setMaxSimultaneousRequests(Wt.Prefetch,200);sh.grabDelay=0;const u9=Symbol("DefaultSettings"),f9=Symbol("RuntimeSettings"),d9=Symbol("ObjectSettingsMap"),mc=Symbol("Dictionary");class Yn{constructor(e){const r=Object.create(e instanceof Yn&&mc in e?e[mc]:null);Object.seal(Object.defineProperty(this,mc,{value:r}))}set(e,r){return zv(this[mc],e,r,null)}get(e){return dse(this[mc],e)}unset(e){return use(this[mc],e+"")}forEach(e){h9(this[mc],e)}extend(){return new Yn(this)}import(e){tN(e)&&Object.keys(e).forEach(r=>{zv(this[mc],r,e[r],null)})}dump(){const e={};return h9(this[mc],(r,n)=>{typeof n<"u"&&nN(e,r,n)}),e}static assert(e){return e instanceof Yn?e:Yn.getRuntimeSettings()}static getDefaultSettings(e=null){let r=Yn[u9];if(r instanceof Yn||(r=new Yn,Yn[u9]=r),e){const n={};return r.forEach(i=>{if(i.startsWith(e)){const o=i.split(`${e}.`)[1];n[o]=r.get(i)}}),n}return r}static getRuntimeSettings(){let e=Yn[f9];return e instanceof Yn||(e=new Yn(Yn.getDefaultSettings()),Yn[f9]=e),e}static getObjectSettings(e,r){let n=null;if(e instanceof Yn)n=e;else if(typeof e=="object"&&e!==null){let i=Yn[d9];i instanceof WeakMap||(i=new WeakMap,Yn[d9]=i),n=i.get(e),n instanceof Yn||(n=new Yn(Yn.assert(Yn.getObjectSettings(r))),i.set(e,n))}return n}static extendRuntimeSettings(){return Yn.getRuntimeSettings().extend()}}function use(t,e){if(e.endsWith(".")){let r=0;const n=e,i=n.slice(0,-1),o=i.length===0;for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(o||a.startsWith(n)||a===i)&&(delete t[a],++r);return r>0}return delete t[e]}function h9(t,e){for(const r in t)e(r,t[r])}function fse(t,e,r,n){let i;if(n.has(r))return zv(t,e,null,n);n.add(r),i=0;for(const o in r)if(Object.prototype.hasOwnProperty.call(r,o)){const a=o.length===0?e:`${e}.${o}`;zv(t,a,r[o],n)||++i}return n.delete(r),i===0}function zv(t,e,r,n){return hse(e)?tN(r)?fse(t,e,r,n instanceof WeakSet?n:new WeakSet):(t[e]=r,!0):!1}function dse(t,e){return t[e]}function hse(t){let e,r,n;if(typeof t!="string"||(e=t.length-1)<0)return!1;for(n=-1;(r=t.indexOf(".",n+1))>=0;){if(r-n<2||r===e)return!1;n=r}return!0}function tN(t){if(typeof t=="object"&&t!==null){const e=Object.getPrototypeOf(t);if(e===Object.prototype||e===null)return!0}return!1}function nN(t,e,r){const n=e.indexOf(".");if(n>=0){const i=e.slice(0,n);let o=t[i];if(typeof o!="object"||o===null){const a=o;o={},typeof a<"u"&&(o[""]=a),t[i]=o}nN(o,e.slice(n+1,e.length),r)}else t[e]=r}Yn.getDefaultSettings().set("useCursors",!0);function E2(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function gse(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function rN(t){let e,r,n;t.length!==2?(e=E2,r=(s,c)=>E2(t(s),c),n=(s,c)=>t(s)-c):(e=t===E2||t===gse?t:pse,r=t,n=t);function i(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;r(s[u],c)<0?l=u+1:f=u}while(l<f)}return l}function o(s,c,l=0,f=s.length){if(l<f){if(e(c,c)!==0)return f;do{const u=l+f>>>1;r(s[u],c)<=0?l=u+1:f=u}while(l<f)}return l}function a(s,c,l=0,f=s.length){const u=i(s,c,l,f-1);return u>l&&n(s[u-1],c)>-n(s[u],c)?u-1:u}return{left:i,center:a,right:o}}function pse(){return 0}function mse(t){return t===null?NaN:+t}const vse=rN(E2),yse=vse.right;rN(mse).center;const wse=Math.sqrt(50),xse=Math.sqrt(10),Cse=Math.sqrt(2);function $v(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),a=o>=wse?10:o>=xse?5:o>=Cse?2:1;let s,c,l;return i<0?(l=Math.pow(10,-i)/a,s=Math.round(t*l),c=Math.round(e*l),s/l<t&&++s,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*a,s=Math.round(t/l),c=Math.round(e/l),s*l<t&&++s,c*l>e&&--c),c<s&&.5<=r&&r<2?$v(t,e,r*2):[s,c,l]}function Sse(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,o,a]=n?$v(e,t,r):$v(t,e,r);if(!(o>=i))return[];const s=o-i+1,c=new Array(s);if(n)if(a<0)for(let l=0;l<s;++l)c[l]=(o-l)/-a;else for(let l=0;l<s;++l)c[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)c[l]=(i+l)/-a;else for(let l=0;l<s;++l)c[l]=(i+l)*a;return c}function DC(t,e,r){return e=+e,t=+t,r=+r,$v(t,e,r)[2]}function Tse(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?DC(e,t,r):DC(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function _se(t,e){let r;if(e===void 0)for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let i of t)(i=e(i,++n,t))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function Ese(t){if(!(o=t.length))return[];for(var e=-1,r=_se(t,Dse),n=new Array(r);++e<r;)for(var i=-1,o,a=n[e]=new Array(o);++i<o;)a[i]=t[i][e];return n}function Dse(t){return t.length}function g9(){return Ese(arguments)}function bse(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function F_(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function iN(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function c1(){}var Cp=.7,jv=1/Cp,hd="\\s*([+-]?\\d+)\\s*",Sp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ise=/^#([0-9a-f]{3,8})$/,Ose=new RegExp(`^rgb\\(${hd},${hd},${hd}\\)$`),Mse=new RegExp(`^rgb\\(${Bs},${Bs},${Bs}\\)$`),Rse=new RegExp(`^rgba\\(${hd},${hd},${hd},${Sp}\\)$`),Pse=new RegExp(`^rgba\\(${Bs},${Bs},${Bs},${Sp}\\)$`),Lse=new RegExp(`^hsl\\(${Sp},${Bs},${Bs}\\)$`),Ase=new RegExp(`^hsla\\(${Sp},${Bs},${Bs},${Sp}\\)$`),p9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};F_(c1,Tp,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:m9,formatHex:m9,formatHex8:Nse,formatHsl:kse,formatRgb:v9,toString:v9});function m9(){return this.rgb().formatHex()}function Nse(){return this.rgb().formatHex8()}function kse(){return oN(this).formatHsl()}function v9(){return this.rgb().formatRgb()}function Tp(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Ise.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?y9(e):r===3?new Eo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?hm(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?hm(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ose.exec(t))?new Eo(e[1],e[2],e[3],1):(e=Mse.exec(t))?new Eo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Rse.exec(t))?hm(e[1],e[2],e[3],e[4]):(e=Pse.exec(t))?hm(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Lse.exec(t))?C9(e[1],e[2]/100,e[3]/100,1):(e=Ase.exec(t))?C9(e[1],e[2]/100,e[3]/100,e[4]):p9.hasOwnProperty(t)?y9(p9[t]):t==="transparent"?new Eo(NaN,NaN,NaN,0):null}function y9(t){return new Eo(t>>16&255,t>>8&255,t&255,1)}function hm(t,e,r,n){return n<=0&&(t=e=r=NaN),new Eo(t,e,r,n)}function Vse(t){return t instanceof c1||(t=Tp(t)),t?(t=t.rgb(),new Eo(t.r,t.g,t.b,t.opacity)):new Eo}function bC(t,e,r,n){return arguments.length===1?Vse(t):new Eo(t,e,r,n??1)}function Eo(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}F_(Eo,bC,iN(c1,{brighter(t){return t=t==null?jv:Math.pow(jv,t),new Eo(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Cp:Math.pow(Cp,t),new Eo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Eo(Af(this.r),Af(this.g),Af(this.b),Hv(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:w9,formatHex:w9,formatHex8:Fse,formatRgb:x9,toString:x9}));function w9(){return`#${bf(this.r)}${bf(this.g)}${bf(this.b)}`}function Fse(){return`#${bf(this.r)}${bf(this.g)}${bf(this.b)}${bf((isNaN(this.opacity)?1:this.opacity)*255)}`}function x9(){const t=Hv(this.opacity);return`${t===1?"rgb(":"rgba("}${Af(this.r)}, ${Af(this.g)}, ${Af(this.b)}${t===1?")":`, ${t})`}`}function Hv(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Af(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bf(t){return t=Af(t),(t<16?"0":"")+t.toString(16)}function C9(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Za(t,e,r,n)}function oN(t){if(t instanceof Za)return new Za(t.h,t.s,t.l,t.opacity);if(t instanceof c1||(t=Tp(t)),!t)return new Za;if(t instanceof Za)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),o=Math.max(e,r,n),a=NaN,s=o-i,c=(o+i)/2;return s?(e===o?a=(r-n)/s+(r<n)*6:r===o?a=(n-e)/s+2:a=(e-r)/s+4,s/=c<.5?o+i:2-o-i,a*=60):s=c>0&&c<1?0:a,new Za(a,s,c,t.opacity)}function Use(t,e,r,n){return arguments.length===1?oN(t):new Za(t,e,r,n??1)}function Za(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}F_(Za,Use,iN(c1,{brighter(t){return t=t==null?jv:Math.pow(jv,t),new Za(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Cp:Math.pow(Cp,t),new Za(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new Eo($w(t>=240?t-240:t+120,i,n),$w(t,i,n),$w(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new Za(S9(this.h),gm(this.s),gm(this.l),Hv(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Hv(this.opacity);return`${t===1?"hsl(":"hsla("}${S9(this.h)}, ${gm(this.s)*100}%, ${gm(this.l)*100}%${t===1?")":`, ${t})`}`}}));function S9(t){return t=(t||0)%360,t<0?t+360:t}function gm(t){return Math.max(0,Math.min(1,t||0))}function $w(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}function Bse(t,e,r,n,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*r+(1+3*t+3*o-3*a)*n+a*i)/6}function jw(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),i=t[n],o=t[n+1],a=n>0?t[n-1]:2*i-o,s=n<e-1?t[n+2]:2*o-i;return Bse((r-n/e)*e,a,i,o,s)}}const U_=t=>()=>t;function Gse(t,e){return function(r){return t+r*e}}function Wse(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function zse(t){return(t=+t)==1?aN:function(e,r){return r-e?Wse(e,r,t):U_(isNaN(e)?r:e)}}function aN(t,e){var r=e-t;return r?Gse(t,r):U_(isNaN(t)?e:t)}const T9=function t(e){var r=zse(e);function n(i,o){var a=r((i=bC(i)).r,(o=bC(o)).r),s=r(i.g,o.g),c=r(i.b,o.b),l=aN(i.opacity,o.opacity);return function(f){return i.r=a(f),i.g=s(f),i.b=c(f),i.opacity=l(f),i+""}}return n.gamma=t,n}(1);function $se(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=t[i]*(1-o)+e[i]*o;return n}}function jse(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hse(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),o=new Array(r),a;for(a=0;a<n;++a)i[a]=B_(t[a],e[a]);for(;a<r;++a)o[a]=e[a];return function(s){for(a=0;a<n;++a)o[a]=i[a](s);return o}}function Kse(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function Kv(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function qse(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=B_(t[i],e[i]):n[i]=e[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var IC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hw=new RegExp(IC.source,"g");function Xse(t){return function(){return t}}function Yse(t){return function(e){return t(e)+""}}function Jse(t,e){var r=IC.lastIndex=Hw.lastIndex=0,n,i,o,a=-1,s=[],c=[];for(t=t+"",e=e+"";(n=IC.exec(t))&&(i=Hw.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,c.push({i:a,x:Kv(n,i)})),r=Hw.lastIndex;return r<e.length&&(o=e.slice(r),s[a]?s[a]+=o:s[++a]=o),s.length<2?c[0]?Yse(c[0].x):Xse(e):(e=c.length,function(l){for(var f=0,u;f<e;++f)s[(u=c[f]).i]=u.x(l);return s.join("")})}function B_(t,e){var r=typeof e,n;return e==null||r==="boolean"?U_(e):(r==="number"?Kv:r==="string"?(n=Tp(e))?(e=n,T9):Jse:e instanceof Tp?T9:e instanceof Date?Kse:jse(e)?$se:Array.isArray(e)?Hse:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?qse:Kv)(t,e)}function Zse(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function Fh(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t(n/(e-1));return r}function Qse(t){return function(){return t}}function ece(t){return+t}var _9=[0,1];function z0(t){return t}function OC(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:Qse(isNaN(e)?NaN:.5)}function tce(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function nce(t,e,r){var n=t[0],i=t[1],o=e[0],a=e[1];return i<n?(n=OC(i,n),o=r(a,o)):(n=OC(n,i),o=r(o,a)),function(s){return o(n(s))}}function rce(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),o=new Array(n),a=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<n;)i[a]=OC(t[a],t[a+1]),o[a]=r(e[a],e[a+1]);return function(s){var c=yse(t,s,1,n)-1;return o[c](i[c](s))}}function ice(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function oce(){var t=_9,e=_9,r=B_,n,i,o,a=z0,s,c,l;function f(){var d=Math.min(t.length,e.length);return a!==z0&&(a=tce(t[0],t[d-1])),s=d>2?rce:nce,c=l=null,u}function u(d){return d==null||isNaN(d=+d)?o:(c||(c=s(t.map(n),e,r)))(n(a(d)))}return u.invert=function(d){return a(i((l||(l=s(e,t.map(n),Kv)))(d)))},u.domain=function(d){return arguments.length?(t=Array.from(d,ece),f()):t.slice()},u.range=function(d){return arguments.length?(e=Array.from(d),f()):e.slice()},u.rangeRound=function(d){return e=Array.from(d),r=Zse,f()},u.clamp=function(d){return arguments.length?(a=d?!0:z0,f()):a!==z0},u.interpolate=function(d){return arguments.length?(r=d,f()):r},u.unknown=function(d){return arguments.length?(o=d,u):o},function(d,h){return n=d,i=h,f()}}function ace(){return oce()(z0,z0)}function sce(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function qv(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function Vd(t){return t=qv(Math.abs(t)),t?t[1]:NaN}function cce(t,e){return function(r,n){for(var i=r.length,o=[],a=0,s=t[0],c=0;i>0&&s>0&&(c+s+1>n&&(s=Math.max(1,n-c)),o.push(r.substring(i-=s,i+s)),!((c+=s+1)>n));)s=t[a=(a+1)%t.length];return o.reverse().join(e)}}function lce(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var uce=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Xv(t){if(!(e=uce.exec(t)))throw new Error("invalid format: "+t);var e;return new G_({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Xv.prototype=G_.prototype;function G_(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}G_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fce(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var sN;function dce(t,e){var r=qv(t,e);if(!r)return t+"";var n=r[0],i=r[1],o=i-(sN=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+qv(t,Math.max(0,e+o-1))[0]}function E9(t,e){var r=qv(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const D9={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:sce,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>E9(t*100,e),r:E9,s:dce,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function b9(t){return t}var I9=Array.prototype.map,O9=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function hce(t){var e=t.grouping===void 0||t.thousands===void 0?b9:cce(I9.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?b9:lce(I9.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(u){u=Xv(u);var d=u.fill,h=u.align,g=u.sign,p=u.symbol,v=u.zero,w=u.width,m=u.comma,y=u.precision,x=u.trim,C=u.type;C==="n"?(m=!0,C="g"):D9[C]||(y===void 0&&(y=12),x=!0,C="g"),(v||d==="0"&&h==="=")&&(v=!0,d="0",h="=");var S=p==="$"?r:p==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",T=p==="$"?n:/[%p]/.test(C)?a:"",_=D9[C],E=/[defgprs%]/.test(C);y=y===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function D(b){var I=S,R=T,M,P,k;if(C==="c")R=_(b)+R,b="";else{b=+b;var z=b<0||1/b<0;if(b=isNaN(b)?c:_(Math.abs(b),y),x&&(b=fce(b)),z&&+b==0&&g!=="+"&&(z=!1),I=(z?g==="("?g:s:g==="-"||g==="("?"":g)+I,R=(C==="s"?O9[8+sN/3]:"")+R+(z&&g==="("?")":""),E){for(M=-1,P=b.length;++M<P;)if(k=b.charCodeAt(M),48>k||k>57){R=(k===46?i+b.slice(M+1):b.slice(M))+R,b=b.slice(0,M);break}}}m&&!v&&(b=e(b,1/0));var A=I.length+b.length+R.length,L=A<w?new Array(w-A+1).join(d):"";switch(m&&v&&(b=e(L+b,L.length?w-R.length:1/0),L=""),h){case"<":b=I+b+R+L;break;case"=":b=I+L+b+R;break;case"^":b=L.slice(0,A=L.length>>1)+I+b+R+L.slice(A);break;default:b=L+I+b+R;break}return o(b)}return D.toString=function(){return u+""},D}function f(u,d){var h=l((u=Xv(u),u.type="f",u)),g=Math.max(-8,Math.min(8,Math.floor(Vd(d)/3)))*3,p=Math.pow(10,-g),v=O9[8+g/3];return function(w){return h(p*w)+v}}return{format:l,formatPrefix:f}}var pm,cN,lN;gce({thousands:",",grouping:[3],currency:["$",""]});function gce(t){return pm=hce(t),cN=pm.format,lN=pm.formatPrefix,pm}function pce(t){return Math.max(0,-Vd(Math.abs(t)))}function mce(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Vd(e)/3)))*3-Vd(Math.abs(t)))}function vce(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Vd(e)-Vd(t))+1}function yce(t,e,r,n){var i=Tse(t,e,r),o;switch(n=Xv(n??",f"),n.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(o=mce(i,a))&&(n.precision=o),lN(n,a)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=vce(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=pce(i))&&(n.precision=o-(n.type==="%")*2);break}}return cN(n)}function wce(t){var e=t.domain;return t.ticks=function(r){var n=e();return Sse(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return yce(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,o=n.length-1,a=n[i],s=n[o],c,l,f=10;for(s<a&&(l=a,a=s,s=l,l=i,i=o,o=l);f-- >0;){if(l=DC(a,s,r),l===c)return n[i]=a,n[o]=s,e(n);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;c=l}return t},t}function W_(){var t=ace();return t.copy=function(){return ice(t,W_())},bse.apply(t,arguments),wce(t)}function xce(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,i=1;if(t.getInputData()){const a=t.getInputData();r=a.getDimensions()[0],n=a.getDimensions()[1],i=a.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),(r>1)+(n>1)+(i>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const r=document.createElement("canvas");r.width=e.image.width,r.height=e.image.height;const n=r.getContext("2d");return n.translate(0,r.height),n.scale(1,-1),n.drawImage(e.image,0,0,e.image.width,e.image.height),n.getImageData(0,0,r.width,r.height)}return null}}const Cce=(t,e,r,n)=>{const i=[1,2,1],o=4,a=i,s=o,c=t.length/(e*r);let l=e,f=r,u=t;const d=[u];for(let h=0;h<n;h++){const g=[...u];l/=2,f/=2,u=new Uint8ClampedArray(l*f*c);const p=c*l;let v=0;for(let m=0;m<u.length;m+=c){m%p===0&&(v+=2*c*l);for(let y=0;y<c;y++){let x=g[v+y];x+=g[v+c+y],x+=g[v-2*p+y],x+=g[v-2*p+c+y],x/=4,u[m+y]=x}v+=2*c}let w=[...u];for(let m=0;m<u.length;m+=c)for(let y=0;y<c;y++){let x=-(a.length-1)/2,C=s,S=0;for(let T=0;T<a.length;T++){let _=m+y+x*c;const E=_%p-(m+y)%p;E>c&&(_+=p),E<-c&&(_-=p),w[_]?S+=w[_]*a[T]:C-=a[T],x+=1}u[m+y]=S/C}w=[...u];for(let m=0;m<u.length;m+=c)for(let y=0;y<c;y++){let x=-(a.length-1)/2,C=s,S=0;for(let T=0;T<a.length;T++){const _=m+y+x*p;w[_]?S+=w[_]*a[T]:C-=a[T],x+=1}u[m+y]=S/C}d.push(u)}return d},Sce={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function uN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sce,r),K.obj(t,e),K.algo(t,e,6,0),K.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),K.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),xce(t,e)}const Tce=K.newInstance(uN,"vtkTexture"),_ce={generateMipmaps:Cce};var l1={newInstance:Tce,extend:uN,..._ce};const Ece=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],M9=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],mm=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],R9=[0,1,0,1,0,1,0,1,2,2,2,2],pr=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],$t=new Float64Array(3),vm=new Float64Array(3),Fn=new Float64Array(3),xf=new Float64Array(3),af=new Float64Array(3),ym=new Float64Array(3),Kw=new Float64Array(16);function qw(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function fN(t){const e=[],r=[];for(let n=0;n<3;n++){const i=W_().domain([t[n*2],t[n*2+1]]);e[n]=i.ticks(5);const o=i.tickFormat(5);r[n]=e[n].map(o)}return{ticks:e,tickStrings:r}}function Dce(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=r=>{e.renderable!==r&&(e.renderable=r,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(r.getProperty()),e.tmActor.setParentProp(r),t.modified())},t.createPolyDataForOneLabel=(r,n,i,o,a,s,c)=>{const l=e.renderable.get_tmAtlas().get(r);if(!l)return;const f=e.renderable.getTextPolyData().getPoints().getData(),u=e.lastSize;$t[0]=f[n*3],$t[1]=f[n*3+1],$t[2]=f[n*3+2],Pt(Fn,$t,i),Fn[0]+=.1,Pt(vm,Fn,o),yn(af,vm,$t),Fn[0]-=.1,Fn[1]+=.1,Pt(vm,Fn,o),yn(ym,vm,$t);for(let g=0;g<3;g++)af[g]/=.5*.1*u[0],ym[g]/=.5*.1*u[1];let d=c.ptIdx,h=c.cellIdx;$t[0]=f[n*3],$t[1]=f[n*3+1],$t[2]=f[n*3+2],a[0]<-.5?mr(Fn,af,a[0]*s-l.width):a[0]>.5?mr(Fn,af,a[0]*s):mr(Fn,af,a[0]*s-l.width/2),br($t,$t,Fn),mr(Fn,ym,a[1]*s-l.height/2),br($t,$t,Fn),c.points[d*3]=$t[0],c.points[d*3+1]=$t[1],c.points[d*3+2]=$t[2],c.tcoords[d*2]=l.tcoords[0],c.tcoords[d*2+1]=l.tcoords[1],d++,mr(Fn,af,l.width),br($t,$t,Fn),c.points[d*3]=$t[0],c.points[d*3+1]=$t[1],c.points[d*3+2]=$t[2],c.tcoords[d*2]=l.tcoords[2],c.tcoords[d*2+1]=l.tcoords[3],d++,mr(Fn,ym,l.height),br($t,$t,Fn),c.points[d*3]=$t[0],c.points[d*3+1]=$t[1],c.points[d*3+2]=$t[2],c.tcoords[d*2]=l.tcoords[4],c.tcoords[d*2+1]=l.tcoords[5],d++,mr(Fn,af,l.width),yn($t,$t,Fn),c.points[d*3]=$t[0],c.points[d*3+1]=$t[1],c.points[d*3+2]=$t[2],c.tcoords[d*2]=l.tcoords[6],c.tcoords[d*2+1]=l.tcoords[7],d++,c.polys[h*4]=3,c.polys[h*4+1]=d-4,c.polys[h*4+2]=d-3,c.polys[h*4+3]=d-2,h++,c.polys[h*4]=3,c.polys[h*4+1]=d-4,c.polys[h*4+2]=d-2,c.polys[h*4+3]=d-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const r=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);Yt(r,r);const n=e.renderable.getTextValues().length,i=n*4,o=n*2,a=new Float64Array(i*3),s=new Uint16Array(o*4),c=new Float32Array(i*2);Or(Kw,r);const l={ptIdx:0,cellIdx:0,polys:s,points:a,tcoords:c};let f=0,u=0,d=0;const h=e.renderable.getTextPolyData().getPoints().getData(),g=e.renderable.getTextValues();for(;f<h.length/3;){$t[0]=h[f*3],$t[1]=h[f*3+1],$t[2]=h[f*3+2],Pt(Fn,$t,r),$t[0]=h[f*3+3],$t[1]=h[f*3+4],$t[2]=h[f*3+5],Pt(xf,$t,r),yn(Fn,Fn,xf);const v=[Fn[0],Fn[1]];GO(v),t.createPolyDataForOneLabel(g[u],f,r,Kw,v,e.renderable.getAxisTitlePixelOffset(),l),f+=2,u++;for(let w=0;w<e.renderable.getTickCounts()[d];w++)t.createPolyDataForOneLabel(g[u],f,r,Kw,v,e.renderable.getTickLabelPixelOffset(),l),f++,u++;d++}const p=Lt.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(a,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(s,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(r,n,i)=>{(e.lastSize[0]!==r[0]||e.lastSize[1]!==r[1])&&(e.lastSize[0]=r[0],e.lastSize[1]=r[1],e.lastAspectRatio=r[0]/r[1],e.forceUpdate=!0),e.camera=n,t.updateTexturePolyData()}}const bce=K.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),K.obj(t,e),e.tmPolyData=Qr.newInstance(),e.tmMapper=js.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=qs.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),K.setGet(t,e,["renderable"]),K.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},K.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},K.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],Dce(t,e)},"vtkCubeAxesActorHelper");function Ice(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=n=>{e.camera!==n&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=n,n&&(e.cameraModifiedSub=n.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const n=e.camera.getViewMatrix();Yt(n,n);let i=!1;const o=Nn.getDiagonalLength(e.dataBounds),a=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let s=0;s<6;s++){let c=!1;const l=Math.floor(s/2),f=(l+1)%3,u=(l+2)%3;e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&e.dataBounds[u*2]!==e.dataBounds[u*2+1]&&($t[l]=e.dataBounds[s]-.1*o*Ece[s][l],$t[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),$t[u]=.5*(e.dataBounds[u*2]+e.dataBounds[u*2+1]),Pt(Fn,$t,n),$t[l]=e.dataBounds[s],Pt(xf,$t,n),yn(Fn,xf,Fn),kn(Fn,Fn),c=Fn[2]>a,e.camera.getParallelProjection()||(kn(xf,xf),c=gt(xf,Fn)>a)),c!==e.lastFacesToDraw[s]&&(e.lastFacesToDraw[s]=c,i=!0)}return i},t.updatePolyData=(n,i,o)=>{let a=0,s=0;a+=8;let c=0;for(let h=0;h<12;h++)i[h]>0&&c++;if(s+=c,e.gridLines)for(let h=0;h<6;h++)n[h]&&(a+=o[pr[h][0]].length*2+o[pr[h][1]].length*2,s+=o[pr[h][0]].length+o[pr[h][1]].length);const l=new Float64Array(a*3),f=new Uint32Array(s*3);let u=0,d=0;for(let h=0;h<2;h++)for(let g=0;g<2;g++)for(let p=0;p<2;p++)l[u*3]=e.dataBounds[p],l[u*3+1]=e.dataBounds[2+g],l[u*3+2]=e.dataBounds[4+h],u++;for(let h=0;h<12;h++)i[h]>0&&(f[d*3]=2,f[d*3+1]=mm[h][0],f[d*3+2]=mm[h][1],d++);if(e.gridLines){for(let h=0;h<6;h++)if(n[h]){const g=Math.floor(h/2);let p=o[pr[h][0]];for(let v=0;v<p.length;v++)l[u*3+g]=e.dataBounds[h],l[u*3+pr[h][0]]=p[v],l[u*3+pr[h][1]]=e.dataBounds[pr[h][1]*2],u++,l[u*3+g]=e.dataBounds[h],l[u*3+pr[h][0]]=p[v],l[u*3+pr[h][1]]=e.dataBounds[pr[h][1]*2+1],u++,f[d*3]=2,f[d*3+1]=u-2,f[d*3+2]=u-1,d++;p=o[pr[h][1]];for(let v=0;v<p.length;v++)l[u*3+g]=e.dataBounds[h],l[u*3+pr[h][1]]=p[v],l[u*3+pr[h][0]]=e.dataBounds[pr[h][0]*2],u++,l[u*3+g]=e.dataBounds[h],l[u*3+pr[h][1]]=p[v],l[u*3+pr[h][0]]=e.dataBounds[pr[h][0]*2+1],u++,f[d*3]=2,f[d*3+1]=u-2,f[d*3+2]=u-1,d++}}e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(f,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(n,i,o,a)=>{let s=0;for(let h=0;h<12;h++)i[h]===1&&(s+=2,s+=o[R9[h]].length);const c=e.polyData.getPoints().getData(),l=new Float64Array(s*3);let f=0,u=0,d=0;for(let h=0;h<6;h++)if(n[h])for(let g=0;g<4;g++){const p=M9[h][g];if(i[p]===1){const v=R9[p],w=mm[p][0]*3,m=mm[p][1]*3;l[f*3]=.5*(c[w]+c[m]),l[f*3+1]=.5*(c[w+1]+c[m+1]),l[f*3+2]=.5*(c[w+2]+c[m+2]),f++;const y=Math.floor(h/2);l[f*3+y]=e.dataBounds[h],l[f*3+pr[h][0]]=.5*(e.dataBounds[pr[h][0]*2]+e.dataBounds[pr[h][0]*2+1]),l[f*3+pr[h][1]]=.5*(e.dataBounds[pr[h][1]*2]+e.dataBounds[pr[h][1]*2+1]),f++,e.textValues[u]=e.axisLabels[v],u++;const x=(v+1)%3,C=(v+2)%3,S=o[v],T=a[v];e.tickCounts[d]=S.length;for(let _=0;_<S.length;_++)l[f*3+v]=S[_],l[f*3+x]=c[w+x],l[f*3+C]=c[w+C],f++,e.textValues[u]=T[_],u++;d++}}e.textPolyData.getPoints().setData(l,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const n=t.computeFacesToDraw(),i=e.lastFacesToDraw;let o=!1;for(let a=0;a<6;a++)e.dataBounds[a]!==e.lastTickBounds[a]&&(o=!0,e.lastTickBounds[a]=e.dataBounds[a]);if(n||o||e.forceUpdate){const a=new Array(12).fill(0);for(let c=0;c<6;c++)if(i[c])for(let l=0;l<4;l++)a[M9[c][l]]++;const s=e.generateTicks(e.dataBounds);t.updatePolyData(i,a,s.ticks),t.updateTextData(i,a,s.ticks,s.tickStrings),(o||e.forceUpdate)&&t.updateTextureAtlas(s.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=n=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let i=0,o=1;for(let a=0;a<3;a++){if(!e._tmAtlas.has(e.axisLabels[a])){qw(e.tmContext,e.axisTextStyle);const s=e.tmContext.measureText(e.axisLabels[a]),c={height:s.actualBoundingBoxAscent+2,startingHeight:o,width:s.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[a],c),o+=c.height,i<c.width&&(i=c.width)}qw(e.tmContext,e.tickTextStyle);for(let s=0;s<n[a].length;s++)if(!e._tmAtlas.has(n[a][s])){const c=e.tmContext.measureText(n[a][s]),l={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(n[a][s],l),o+=l.height,i<l.width&&(i=l.width)}}i=ha(i),o=ha(o),e._tmAtlas.forEach(a=>{a.tcoords=[0,(o-a.startingHeight-a.height)/o,a.width/i,(o-a.startingHeight-a.height)/o,a.width/i,(o-a.startingHeight)/o,0,(o-a.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),e._tmAtlas.forEach((a,s)=>{qw(e.tmContext,a.textStyle),e.tmContext.fillText(s,1,a.startingHeight+a.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),Nn.setBounds(e.bounds,e.gridActor.getBounds()),Nn.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const r=K.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=n=>r(n)[0]}function Oce(t,e,r){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...Nn.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:fN,...r,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...r==null?void 0:r.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...r==null?void 0:r.tickTextStyle}}}function dN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};qs.extend(t,e,Oce(t,e,r)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=l1.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=js.newInstance(),e.polyData=Qr.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=qs.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Qr.newInstance(),K.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),K.setGetArray(t,e,["dataBounds"],6),K.setGetArray(t,e,["axisLabels"],3),K.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Ice(t,e)}const Mce=K.newInstance(dN,"vtkCubeAxesActor");var hN={newInstance:Mce,extend:dN,newCubeAxesActorHelper:bce,defaultGenerateTicks:fN};function Rce(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e._openGLRenderWindow.getRenderable())}}}const Pce={};function Lce(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pce,r),Gn.extend(t,e,r),e.CubeAxesActorHelper=hN.newCubeAxesActorHelper(),Rce(t,e)}const Ace=Sn(Lce,"vtkOpenGLCubeAxesActor");Hr("vtkCubeAxesActor",Ace);const{ColorMode:Nce,ScalarMode:sf,GetArray:Xw}=Jy;function kce(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=Sv.newInstance()},t.getColorModeAsString=()=>K.enumToString(Nce,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>K.enumToString(sf,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,i,o,a)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let s=null,c=!1;if(n===sf.DEFAULT)s=r.getPointData().getScalars(),s||(s=r.getCellData().getScalars(),c=!0);else if(n===sf.USE_POINT_DATA)s=r.getPointData().getScalars();else if(n===sf.USE_CELL_DATA)s=r.getCellData().getScalars(),c=!0;else if(n===sf.USE_POINT_FIELD_DATA){const l=r.getPointData();i===Xw.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===sf.USE_CELL_FIELD_DATA){const l=r.getCellData();c=!0,i===Xw.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}else if(n===sf.USE_FIELD_DATA){const l=r.getFieldData();i===Xw.BY_ID?s=l.getArrayByIndex(o):s=l.getArrayByName(a)}return{scalars:s,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.mapScalars=(r,n)=>{const i=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!i){e.colorMapColors=null;return}const o=`${t.getMTime()}${i.getMTime()}${n}`;if(e.colorBuildString===o)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const a=t.getLookupTable();a&&(a.build(),e.colorMapColors=a.mapScalars(i,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${i.getMTime()}${n}`},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}}}const Vce={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function gN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vce,r),hR.extend(t,e,r),K.get(t,e,["colorMapColors"]),K.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),K.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),kce(t,e)}const Fce=K.newInstance(gN,"vtkMapper2D");var Uce={newInstance:Fce,extend:gN},Bce=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,Gce=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const pN={BACKGROUND:0,FOREGROUND:1};var mN={DisplayLocation:pN};const{primTypes:Ka}=Js,{ScalarMode:wm}=Uce,{vtkErrorMacro:xm}=Ni,Wce={type:"StartEvent"},zce={type:"EndEvent"};function $ce(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=n=>{n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=n=>{n&&t.render()},t.getShaderTemplate=(n,i,o)=>{n.Vertex=Gce,n.Fragment=Bce,n.Geometry=""},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let a=Ka.Start;a<Ka.End;a++)e.primitives[a].setOpenGLRenderWindow(e._openGLRenderWindow)}const i=e.openGLActor2D.getRenderable(),o=e._openGLRenderer.getRenderable();t.renderPiece(o,i)},t.renderPiece=(n,i)=>{if(t.invokeEvent(Wce),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(zce),!e.currentInput){xm("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(n,i),t.renderPieceDraw(n,i),t.renderPieceFinish(n,i))},t.renderPieceStart=(n,i)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(i)}t.updateBufferObjects(n,i),e.lastBoundBO=null},t.getNeedToRebuildShaders=(n,i,o)=>n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(n,i)=>{t.getNeedToRebuildBufferObjects(n,i)&&t.buildBufferObjects(n,i)},t.getNeedToRebuildBufferObjects=(n,i)=>{const o=e.VBOBuildTime.getMTime();return!!(o<t.getMTime()||o<e._openGLRenderWindow.getMTime()||o<e.renderable.getMTime()||o<i.getMTime()||o<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&o<n.getMTime())},t.buildBufferObjects=(n,i)=>{const o=e.currentInput;if(o===null)return;e.renderable.mapScalars(o,i.getProperty().getOpacity());const a=e.renderable.getColorMapColors();e.haveCellScalars=!1;const s=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(s===wm.USE_CELL_DATA||s===wm.USE_CELL_FIELD_DATA||s===wm.USE_FIELD_DATA||!o.getPointData().getScalars())&&s!==wm.USE_POINT_FIELD_DATA&&a&&(e.haveCellScalars=!0);const c=i.getProperty().getRepresentation();let l=o.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(l=null);const f=e.renderable.getTransformCoordinate(),d=n.getRenderWindow().getViews()[0].getViewportSize(n),h=`${o.getMTime()}A${c}B${o.getMTime()}C${a?a.getMTime():1}D${l?l.getMTime():1}E${f?n.getMTime():1}F${d}`;if(e.VBOBuildString!==h){let g=o.getPoints();if(f){const v=gp.newInstance(),w=g.getNumberOfPoints();v.setNumberOfPoints(w);const m=[];for(let y=0;y<w;++y){g.getPoint(y,m),f.setValue(m);const x=f.getComputedDoubleViewportValue(n);v.setPoint(y,x[0],x[1],0)}g=v}const p={points:g,tcoords:l,colors:a,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>o.getPointData().getArrayByName(v))};p.cellOffset+=e.primitives[Ka.Points].getCABO().createVBO(o.getVerts(),"verts",c,p),p.cellOffset+=e.primitives[Ka.Lines].getCABO().createVBO(o.getLines(),"lines",c,p),p.cellOffset+=e.primitives[Ka.Tris].getCABO().createVBO(o.getPolys(),"polys",c,p),p.cellOffset+=e.primitives[Ka.TriStrips].getCABO().createVBO(o.getStrips(),"strips",c,p),e.VBOBuildTime.modified(),e.VBOBuildString=h}},t.renderPieceDraw=(n,i)=>{const o=i.getProperty().getRepresentation();e.context.depthMask(!0);for(let s=Ka.Start;s<Ka.End;s++)e.primitives[s].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[s],e.primitiveIDOffset+=e.primitives[s].drawArrays(n,i,o,t))},t.renderPieceFinish=(n,i)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(n,i,o)=>{t.replaceShaderColor(n,i,o),t.replaceShaderTCoord(n,i,o),t.replaceShaderPicking(n,i,o),t.replaceShaderPositionVC(n,i,o)},t.replaceShaderColor=(n,i,o)=>{let a=n.Vertex,s=n.Geometry,c=n.Fragment;e.haveCellScalars&&(c=Te.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=Te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(a=Te.substitute(a,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,a=Te.substitute(a,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,s=Te.substitute(s,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,s=Te.substitute(s,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=Te.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=Te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=Te.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=Te.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c},t.replaceShaderTCoord=(n,i,o)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let a=n.Vertex,s=n.Geometry,c=n.Fragment;const l=e.lastBoundBO.getCABO().getTCoordComponents();l===1?(a=Te.substitute(a,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,a=Te.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Te.substitute(s,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,s=Te.substitute(s,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=Te.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=Te.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):l===2&&(a=Te.substitute(a,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,a=Te.substitute(a,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,s=Te.substitute(s,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,s=Te.substitute(s,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=Te.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=Te.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(s=Te.substitute(s,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=a,n.Geometry=s,n.Fragment=c}},t.replaceShaderPicking=(n,i,o)=>{let a=n.Fragment;a=Te.substitute(a,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,a=Te.substitute(a,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=a},t.replaceShaderPositionVC=(n,i,o)=>{e.lastBoundBO.replaceShaderPositionVC(n,i,o)},t.invokeShaderCallbacks=(n,i,o)=>{const a=e.renderable.getViewSpecificProperties().ShadersCallbacks;a&&a.forEach(s=>{s.callback(s.userData,n,i,o)})},t.setMapperShaderParameters=(n,i,o)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||xm("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,l)=>{n.getProgram().isAttributeUsed(`${c}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${c}MC`,n.getCABO().getCustomData()[l].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[l].components,!1)||xm(`Error setting ${c}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||xm("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const a=e.openGLActor2D.getActiveTextures();if(a)for(let c=0;c<a.length;++c){const f=a[c].getTextureUnit(),u=`texture${f+1}`;n.getProgram().isUniformUsed(u)&&n.getProgram().setUniformi(u,f)}n.setMapperShaderParameters(i,o,e._openGLRenderer.getTiledSizeAndOrigin());const s=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",s?s.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",s?s.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(n,i,o)=>{const a=e.renderable.getColorMapColors();if(!a||a.getNumberOfComponents()===0){const s=n.getProgram(),c=o.getProperty(),l=c.getOpacity(),f=c.getColor(),u=[f[0],f[1],f[2],l];s.setUniform4f("diffuseColor",u)}},t.setLightingShaderParameters=(n,i,o)=>{};function r(n,i,o){return i.identity(o),n.reduce((a,s,c)=>c===0?s?i.copy(a,s):i.identity(a):s?i.multiply(a,a,s):a,o)}t.setCameraShaderParameters=(n,i,o)=>{const a=n.getProgram(),c=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,f=i.getRenderWindow().getViews()[0].getViewportSize(i),u=i.getViewport(),d=o.getActualPositionCoordinate().getComputedDoubleViewportValue(i),h=[0,0,1,1],g=[0,0,1,1];if(g[0]=u[0]>=h[0]?u[0]:h[0],g[1]=u[1]>=h[1]?u[1]:h[1],g[2]=u[2]<=h[2]?u[2]:h[2],g[3]=u[3]<=h[3]?u[3]:h[3],g[0]>=g[2]||g[1]>=g[3])return;f[0]=eg(f[0]*(g[2]-g[0])/(u[2]-u[0])),f[1]=eg(f[1]*(g[3]-g[1])/(u[3]-u[1]));const p=e._openGLRenderer.getParent().getSize(),v=eg(d[0]-(g[0]-u[0])*p[0]),w=eg(d[1]-(g[1]-u[1])*p[1]),m=-v;let y=-v+f[0];const x=-w;let C=-w+f[1];m===y&&(y=m+1),x===C&&(C=x+1);const S=yt(new Float64Array(16));S[0]=2/(y-m),S[1*4+1]=2/(C-x),S[0*4+3]=-1*(y+m)/(y-m),S[1*4+3]=-1*(C+x)/(C-x),S[2*4+2]=0,S[2*4+3]=o.getProperty().getDisplayLocation()===pN.FOREGROUND?-1:1,S[3*4+3]=1,Yt(S,S),a.setUniformMatrix("WCVCMatrix",r([S,c],hp,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(i=>{n+=i.getAllocatedGPUMemoryInBytes()}),n}}const jce={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function Hce(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jce,r),Gn.extend(t,e,r),Hs.implementReplaceShaderCoincidentOffset(t,e,r),Hs.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Ka,e.tmpMat4=yt(new Float64Array(16));for(let n=Ka.Start;n<Ka.End;n++)e.primitives[n]=Js.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Fr(t,e,["context"]),e.VBOBuildTime={},Zn(e.VBOBuildTime,{mtime:0}),$ce(t,e)}const Kce=Sn(Hce,"vtkOpenGLPolyDataMapper2D");Hr("vtkMapper2D",Kce);const{VectorMode:qce}=Zy;function Yw(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function vN(t,e){return r=>{const n=r.getLastSize(),i=(n[0]/700)**.8,o=(n[1]/700)**.8,a=Math.min(i,o),s=r.getAxisTextStyle(),c=r.getTickTextStyle();Object.assign(s,e.axisTextStyle),Object.assign(c,e.tickTextStyle),s.fontSize=Math.max(24*a,12),r.getLastAspectRatio()>1?c.fontSize=Math.max(20*a,10):c.fontSize=Math.max(16*a,10);const l=r.updateTextureAtlas();r.setTopTitle(!1);const f=r.getBoxSizeByReference();if(r.getLastAspectRatio()>1)r.setTickLabelPixelOffset(.3*c.fontSize),l.titleWidth<=l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize?(r.setTopTitle(!0),r.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.98-f[0],-.92])):(r.setAxisTitlePixelOffset(.2*c.fontSize),f[0]=2*(l.titleHeight+r.getAxisTitlePixelOffset()+l.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.99-f[0],-.92])),f[1]=Math.max(1.2,Math.min(1.84/o,1.84));else{r.setAxisTitlePixelOffset(1.2*c.fontSize),r.setTickLabelPixelOffset(.1*c.fontSize);const u=2*(.8*c.fontSize+l.titleHeight+r.getAxisTitlePixelOffset())/n[1],d=2*l.tickWidth/n[0];f[0]=Math.min(1.9,Math.max(1.4,1.4*d*(r.getTicks().length+3))),f[1]=u,r.setBoxPosition([-.5*f[0],-.97])}r.recomputeBarSegments(l)}}function yN(t,e){return r=>{const n=r.getLastTickBounds(),i=W_().domain([n[0],n[1]]),o=i.ticks(5),a=i.tickFormat(5);r.setTicks(o),r.setTickStrings(o.map(a))}}function Xce(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=i=>{e.renderable!==i&&(e.renderable=i,e.barActor.setProperty(i.getProperty()),e.barActor.setParentProp(i),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(i.getProperty()),e.tmActor.setParentProp(i),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=i.generateTicks,e.axisTextStyle={...i.getAxisTextStyle()},e.tickTextStyle={...i.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(i,o,a)=>{(e.lastSize[0]!==i[0]||e.lastSize[1]!==i[1])&&(e.lastSize[0]=i[0],e.lastSize[1]=i[1],e.lastAspectRatio=i[0]/i[1],e.forceUpdate=!0);const s=e.renderable.getScalarsToColors();if(!(!s||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(s),e.camera=o,e.renderWindow=a,e.forceUpdate||Math.max(s.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=s.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const l=t.updateTextureAtlas();t.recomputeBarSegments(l)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const i={},o=new Map;let a=0,s=1;Yw(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.axisTextStyle};o.set(e.renderable.getAxisLabel(),l),s+=l.height,a=l.width,i.titleWidth=l.width,i.titleHeight=l.height,i.tickWidth=0,i.tickHeight=0,Yw(e.tmContext,e.tickTextStyle);const f=[...t.getTickStrings(),"NaN","Below","Above"];for(let u=0;u<f.length;u++)o.has(f[u])||(c=e.tmContext.measureText(f[u]),l={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle},o.set(f[u],l),s+=l.height,a<l.width&&(a=l.width),i.tickWidth<l.width&&(i.tickWidth=l.width),i.tickHeight<l.height&&(i.tickHeight=l.height));return a=ha(a),s=ha(s),o.forEach(u=>{u.tcoords=[0,(s-u.startingHeight-u.height)/s,u.width/a,(s-u.startingHeight-u.height)/s,u.width/a,(s-u.startingHeight)/s,0,(s-u.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),o.forEach((u,d)=>{Yw(e.tmContext,u.textStyle),e.tmContext.fillText(d,1,u.startingHeight+u.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=o,i},t.computeBarSize=i=>{e.vertical=e.boxSize[1]>e.boxSize[0];const o=2*i.tickHeight/e.lastSize[1],a=[1,1];if(e.vertical){const s=2*(i.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-s,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-s,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+s,e.barPosition[1]=e.boxPosition[1],a[1]=o}else{const s=(2*i.tickWidth-8)/e.lastSize[0],c=2*(i.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],a[0]=s}return a},t.recomputeBarSegments=i=>{var d,h,g,p;const o=t.computeBarSize(i);e.barSegments=[];const a=[0,0],s=e.vertical?1:0,c=e.vertical?.01:.02;function l(v,w){e.barSegments.push({corners:[[...a],[a[0]+o[0],a[1]],[a[0]+o[0],a[1]+o[1]],[a[0],a[1]+o[1]]],scalars:w,title:v}),a[s]+=o[s]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&l("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((h=(d=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&h.call(d))&&l("Below",[-.1,-.1,-.1,-.1]);const f=(p=(g=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:p.call(g);a[s]+=c;const u=o[s];o[s]=f?1-2*c-o[s]-a[s]:1-c-a[s],l("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&f&&(o[s]=u,a[s]+=c,l("Above",[1.1,1.1,1.1,1.1]))};const r=new Float64Array(3);t.createPolyDataForOneLabel=(i,o,a,s,c,l)=>{const f=e._tmAtlas.get(i);if(!f)return;let u=l.ptIdx,d=l.cellIdx;r[0]=(.5*o[0]+.5)*e.lastSize[0],r[1]=(.5*o[1]+.5)*e.lastSize[1],r[2]=o[2],r[0]+=c[0],r[1]+=c[1];const h=[],g=s==="vertical"?[1,0]:[0,1];s==="vertical"?(h[0]=f.width,h[1]=-f.height,a[0]==="middle"?r[1]-=f.width/2:a[0]==="right"&&(r[1]-=f.width),a[1]==="middle"?r[0]+=f.height/2:a[1]==="top"&&(r[0]+=f.height)):(h[0]=f.width,h[1]=f.height,a[0]==="middle"?r[0]-=f.width/2:a[0]==="right"&&(r[0]-=f.width),a[1]==="middle"?r[1]-=f.height/2:a[1]==="top"&&(r[1]-=f.height)),l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[0],l.tcoords[u*2+1]=f.tcoords[1],u++,r[g[0]]+=h[0],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[2],l.tcoords[u*2+1]=f.tcoords[3],u++,r[g[1]]+=h[1],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[4],l.tcoords[u*2+1]=f.tcoords[5],u++,r[g[0]]-=h[0],l.points[u*3]=r[0],l.points[u*3+1]=r[1],l.points[u*3+2]=r[2],l.tcoords[u*2]=f.tcoords[6],l.tcoords[u*2+1]=f.tcoords[7],u++,l.polys[d*4]=3,l.polys[d*4+1]=u-4,l.polys[d*4+2]=u-3,l.polys[d*4+3]=u-2,d++,l.polys[d*4]=3,l.polys[d*4+1]=u-4,l.polys[d*4+2]=u-2,l.polys[d*4+3]=u-1,l.ptIdx+=4,l.cellIdx+=2};const n=new Float64Array(3);t.updatePolyDataForLabels=()=>{const i=t.getTickStrings().length+e.barSegments.length,o=i*4,a=i*2,s=new Float64Array(o*3),c=new Uint16Array(a*4),l=new Float32Array(o*2),f={ptIdx:0,cellIdx:0,polys:c,points:s,tcoords:l},u=e.vertical?0:1,d=e.vertical?1:0;n[2]=-.99;const h=e.vertical?["right","middle"]:["middle","bottom"];let g=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(n[0]=e.boxPosition[0]+.5*e.boxSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)):(n[0]=e.barPosition[0]+e.barSize[0],n[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],f)),g=[-1,0]):(p[1]=e.tickLabelPixelOffset,n[0]=e.barPosition[0]+.5*e.barSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],f)),n[u]=e.barPosition[u]+(.5*g[u]+.5)*e.barSize[u],n[d]=e.barPosition[d]+e.barSize[d]*.5;let v=null;for(let S=0;S<e.barSegments.length;S++){const T=e.barSegments[S];T.title==="ticks"?v=T:(n[d]=e.barPosition[d]+.5*e.barSize[d]*(T.corners[2][d]+T.corners[0][d]),t.createPolyDataForOneLabel(T.title,n,h,"horizontal",p,f))}const w=e.barPosition[d]+e.barSize[d]*v.corners[0][d],m=e.barSize[d]*(v.corners[2][d]-v.corners[0][d]),y=t.getTicks(),x=t.getTickStrings();for(let S=0;S<y.length;S++){const T=(y[S]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);n[d]=w+m*T,t.createPolyDataForOneLabel(x[S],n,h,"horizontal",p,f)}const C=Lt.newInstance({numberOfComponents:2,values:l,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(C),e.tmPolyData.getPoints().setData(s,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var p,v;const i=e.renderable.getScalarsToColors();let o=0;e.renderable.getDrawNanAnnotation()&&i.getNanColor()&&(o+=1),e.renderable.getDrawBelowRangeSwatch()&&((p=i.getUseBelowRangeColor)!=null&&p.call(i))&&(o+=1),e.renderable.getDrawAboveRangeSwatch()&&((v=i.getUseAboveRangeColor)!=null&&v.call(i))&&(o+=1);const a=4*(1+o),s=a;let c=1;i.getVectorMode()===qce.COMPONENT&&(c=i.getVectorComponent()+1);const l=new Float64Array(a*3),f=new Uint16Array(s*5),u=new Float32Array(a*c);let d=0,h=0;for(let w=0;w<e.barSegments.length;w++){const m=e.barSegments[w];for(let y=0;y<4;y++){n[0]=e.barPosition[0]+m.corners[y][0]*e.barSize[0],n[1]=e.barPosition[1]+m.corners[y][1]*e.barSize[1],l[d*3]=(.5*n[0]+.5)*e.lastSize[0],l[d*3+1]=(.5*n[1]+.5)*e.lastSize[1],l[d*3+2]=n[2];for(let x=0;x<c;x++)u[d*c+x]=e.lastTickBounds[0]+m.scalars[y]*(e.lastTickBounds[1]-e.lastTickBounds[0]);d++}f[h*5]=4,f[h*5+1]=d-4,f[h*5+2]=d-3,f[h*5+3]=d-2,f[h*5+4]=d-1,h++}const g=Lt.newInstance({numberOfComponents:c,values:u,name:"Scalars"});e.polyData.getPointData().setScalars(g),e.polyData.getPoints().setData(l,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(f,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const Yce=K.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),K.obj(t,e),K.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),K.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),K.getArray(t,e,["boxPosition","boxSize"]),K.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},K.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=js.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Qr.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=qs.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Qr.newInstance(),e.tmMapper=js.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=l1.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=qs.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],Xce(t,e)},"vtkScalarBarActorHelper");function Jce(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(vN(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(yN())}}function Zce(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function wN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zce(r)),e.autoLayout||(e.autoLayout=vN(t,e)),e.generateTicks||(e.generateTicks=yN()),qs.extend(t,e,r),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),K.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),K.get(t,e,["axisTextStyle","tickTextStyle"]),K.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),K.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),Jce(t,e)}const Qce=K.newInstance(wN,"vtkScalarBarActor");var xN={newInstance:Qce,extend:wN,newScalarBarActorHelper:Yce};function ele(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,o=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e._openGLRenderWindow.getRenderable())}}}const tle={};function nle(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tle,r),Gn.extend(t,e,r),e.scalarBarActorHelper=xN.newScalarBarActorHelper(),ele(t,e)}const rle=Sn(nle,"vtkOpenGLScalarBarActor");Hr("vtkScalarBarActor",rle);const{CoordinateSystem:P9}=r1;function ile(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix();e.bufferShift[0]=n[3],e.bufferShift[1]=n[7],e.bufferShift[2]=n[11];const i=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===P9.WORLD&&(e.bufferShift[0]-=i[0],e.bufferShift[1]-=i[1],e.bufferShift[2]-=i[2]),Yt(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?yt(e.keyMatrices.normalMatrix):(sr(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Or(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Yt(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Wn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===P9.WORLD?Wn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]):sr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const ole={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function ale(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ole,r),Gn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],ile(t,e)}const sle=K.newInstance(ale);Ia("vtkActor",sle);const{CoordinateSystem:L9}=r1;function cle(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const n=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===L9.WORLD&&(e.bufferShift[0]-=n[0],e.bufferShift[1]-=n[1],e.bufferShift[2]-=n[2]),yt(e.keyMatrices.bcwc),yt(e.keyMatrices.normalMatrix),Wn(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===L9.WORLD?Wn(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):sr(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const lle={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function ule(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lle,r),Gn.extend(t,e,r),e.keyMatricesTime={},K.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},K.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],cle(t,e)}const fle=K.newInstance(ule);Ia("vtkActor2D",fle);function dle(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const hle={};function gle(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hle,r),Gn.extend(t,e,r),e.CubeAxesActorHelper=hN.newCubeAxesActorHelper(),dle(t,e)}const ple=Sn(gle,"vtkWebGPUCubeAxesActor");Ia("vtkCubeAxesActor",ple);const{DisplayLocation:MC}=mN;function mle(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(MC.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(MC.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Mi.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Mi.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Mi.POINTS),t.getRepresentationAsString=()=>K.enumToString(Mi,e.representation)}const vle={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Mi.SURFACE,displayLocation:MC.FOREGROUND};function CN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vle,r),K.obj(t,e),K.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),K.setGetArray(t,e,["color"],3),mle(t,e)}const yle=K.newInstance(CN,"vtkProperty2D");var wle={newInstance:yle,extend:CN,...mN};const{BufferUsage:pi,PrimitiveTypes:ao}=rh,{Representation:Cm}=Zd,{ScalarMode:Sm}=js,{CoordinateSystem:xle}=r1,{DisplayLocation:Cle}=wle,Sle=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,Tle=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function A9(t){return t.indexOf("edge")>=0}function _le(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=r=>{r&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==xle.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var o;const n=e.WebGPUActor.getRenderable().getProperty(),i=e.UBO.getSendTime();if(t.getMTime()>i||n.getMTime()>i||e.renderable.getMTime()>i){const a=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",a.bcwc),e.UBO.setArray("BCSCMatrix",a.bcsc),e.UBO.setArray("MCWCNormals",a.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===Cle.FOREGROUND?1:0);const l=n.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let l=n.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",n.getAmbient()),e.UBO.setArray("AmbientColor",[l[0],l[1],l[2],1]),e.UBO.setValue("DiffuseIntensity",n.getDiffuse()),l=n.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[l[0],l[1],l[2],1]),e.UBO.setValue("Roughness",n.getRoughness()),e.UBO.setValue("BaseIOR",n.getBaseIOR()),e.UBO.setValue("Metallic",n.getMetallic()),e.UBO.setValue("NormalStrength",n.getNormalStrength()),e.UBO.setValue("Emission",n.getEmission()),e.UBO.setValue("SpecularIntensity",n.getSpecular()),l=n.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[l[0],l[1],l[2],1])}const s=(o=n.getEdgeColorByReference)==null?void 0:o.call(n);s&&e.UBO.setArray("EdgeColor",[s[0],s[1],s[2],1]),e.UBO.setValue("LineWidth",n.getLineWidth()),e.UBO.setValue("Opacity",n.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();return r.getProperty().getLineWidth()<=1||e.primitiveType===ao.Verts?!1:e.primitiveType===ao.Triangles||e.primitiveType===ao.TriangleStrips?n===Cm.WIREFRAME:!0},t.replaceShaderPosition=(r,n,i)=>{const o=n.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),o.hasOutput("vertexVC")||o.addOutput("vec4<f32>","vertexVC");let a=o.getCode();e.useRendererMatrix?(a=Un.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(a=Un.substitute(a,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(a=Un.substitute(a,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(a=Un.substitute(a,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(o.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),a=Un.substitute(a,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),a=Un.substitute(a,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,o.setCode(a)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(r,n,i)=>{const o=i.getBuffer("normalMC"),a=e.WebGPUActor.getRenderable();if(o){const s=n.getShaderDescription("vertex");s.hasOutput("normalVC")||s.addOutput("vec3<f32>","normalVC",o.getArrayInformation()[0].interpolation),s.hasOutput("tangentVC")||s.addOutput("vec3<f32>","tangentVC",o.getArrayInformation()[0].interpolation),s.hasOutput("bitangentVC")||s.addOutput("vec3<f32>","bitangentVC",o.getArrayInformation()[0].interpolation);let c=s.getCode();c=Un.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,s.setCode(c);const l=n.getShaderDescription("fragment");c=l.getCode(),a.getProperty().getNormalTexture()?c=Un.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=Un.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,l.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(r,n,i)=>{var l;if(r.includes("sel"))return;const o=n.getShaderDescription("vertex");o.hasOutput("vertexVC")||o.addOutput("vec4<f32>","vertexVC");const a=e.WebGPURenderer.getRenderable(),s=n.getShaderDescription("fragment");let c=s.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!A9(r)&&!e.is2D&&!r.includes("sel")){const f=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(l=a.getEnvironmentTexture())!=null&&l.getImageLoaded()&&f.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=Un.substitute(c,"//VTK::Light::Impl",f).result,s.setCode(c)}else c=Un.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,s.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(r,n,i)=>{if(A9(r)){const l=n.getShaderDescription("fragment");let f=l.getCode();f=Un.substitute(f,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,l.setCode(f);return}const o=i.getBuffer("colorVI");if(!o)return;const a=n.getShaderDescription("vertex");a.addOutput("vec4<f32>","color",o.getArrayInformation()[0].interpolation);let s=a.getCode();s=Un.substitute(s,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,a.setCode(s);const c=n.getShaderDescription("fragment");s=c.getCode(),s=Un.substitute(s,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(s)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(r,n,i)=>{var h,g,p,v,w,m,y,x,C,S,T,_,E,D,b,I,R,M,P,k;if(!i.hasAttribute("tcoord"))return;const o=n.getShaderDescription("vertex"),a=i.getBuffer("tcoord"),s=Oi.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);let c=o.getCode();o.addOutput(`vec${s}<f32>`,"tcoordVS"),c=Un.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,o.setCode(c);const l=n.getShaderDescription("fragment");c=l.getCode();const f=e.WebGPUActor.getRenderable(),u=z=>z?z.getDimensionality()===s:!1,d=[];((p=(g=(h=f.getProperty()).getDiffuseTexture)==null?void 0:g.call(h))!=null&&p.getImageLoaded()||f.getTextures()[0]||e.colorTexture)&&(u((w=(v=f.getProperty()).getDiffuseTexture)==null?void 0:w.call(v))||u(f.getTextures()[0])||u(e.colorTexture))&&d.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(x=(y=(m=f.getProperty()).getRoughnessTexture)==null?void 0:y.call(m))!=null&&x.getImageLoaded()&&u(f.getProperty().getRoughnessTexture())&&d.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(T=(S=(C=f.getProperty()).getMetallicTexture)==null?void 0:S.call(C))!=null&&T.getImageLoaded()&&u(f.getProperty().getMetallicTexture())&&d.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(D=(E=(_=f.getProperty()).getNormalTexture)==null?void 0:E.call(_))!=null&&D.getImageLoaded()&&u(f.getProperty().getNormalTexture())&&d.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(R=(I=(b=f.getProperty()).getAmbientOcclusionTexture)==null?void 0:I.call(b))!=null&&R.getImageLoaded()&&u(f.getProperty().getAmbientOcclusionTexture())&&d.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(k=(P=(M=f.getProperty()).getEmissionTexture)==null?void 0:P.call(M))!=null&&k.getImageLoaded()&&u(f.getProperty().getEmissionTexture())&&d.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),c=Un.substitute(c,"//VTK::TCoord::Impl",d).result,l.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(r,n,i)=>{if(r.includes("sel")){const o=n.getShaderDescription("fragment");let a=o.getCode();a=Un.substitute(a,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,o.setCode(a)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(r,n)=>r===Cm.POINTS||n===ao.Points?pi.Verts:n===ao.Lines?pi.Lines:r===Cm.WIREFRAME?n===ao.Triangles?pi.LinesFromTriangles:pi.LinesFromStrips:n===ao.Triangles?pi.Triangles:n===ao.TriangleStrips?pi.Strips:n===ao.TriangleEdges?pi.LinesFromTriangles:pi.LinesFromStrips,t.getHashFromUsage=r=>`pt${r}`,t.getTopologyFromUsage=r=>{switch(r){case pi.Triangles:return"triangle-list";case pi.Verts:return"point-list";case pi.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var p,v;const r=e.currentInput,n=e.cellArray,i=e.primitiveType;let a=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const s=e.WebGPURenderWindow.getDevice();let c=!1;i===ao.TriangleEdges&&(c=!0,a=Cm.WIREFRAME);const l=e.vertexInput,f=r.getPoints();let u;if(n){const w={hash:`R${a}P${i}${n.getMTime()}`,usage:pi.Index,cells:n,numberOfPoints:f.getNumberOfPoints(),primitiveType:i,representation:a};u=s.getBufferManager().getBuffer(w),l.setIndexBuffer(u)}else l.setIndexBuffer(null);if(f){const w=e.WebGPUActor.getBufferShift(e.WebGPURenderer),m={hash:`${f.getMTime()}I${u.getMTime()}${w.join()}float32x4`,usage:pi.PointArray,format:"float32x4",dataArray:f,indexBuffer:u,shift:w,packExtra:!0},y=s.getBufferManager().getBuffer(m);l.addBuffer(y,["vertexBC"])}else l.removeBufferIfPresent("vertexBC");const d=t.getUsage(a,i);if(e._usesCellNormals=!1,!e.is2D&&(d===pi.Triangles||d===pi.Strips)){const w=r.getPointData().getNormals(),m={format:"snorm8x4",indexBuffer:u,packExtra:!0,shift:0,scale:127};if(w){m.hash=`${w.getMTime()}I${u.getMTime()}snorm8x4`,m.dataArray=w,m.usage=pi.PointArray;const y=s.getBufferManager().getBuffer(m);l.addBuffer(y,["normalMC"])}else if(i===ao.Triangles){e._usesCellNormals=!0,m.hash=`PFN${f.getMTime()}I${u.getMTime()}snorm8x4`,m.dataArray=f,m.cells=n,m.usage=pi.NormalsFromPoints;const y=s.getBufferManager().getBuffer(m);l.addBuffer(y,["normalMC"])}else l.removeBufferIfPresent("normalMC")}else l.removeBufferIfPresent("normalMC");let h=!1;if(e.renderable.getScalarVisibility()){const w=e.renderable.getColorMapColors();if(w&&!c){const m=e.renderable.getScalarMode();let y=!1;(m===Sm.USE_CELL_DATA||m===Sm.USE_CELL_FIELD_DATA||m===Sm.USE_FIELD_DATA||!r.getPointData().getScalars())&&m!==Sm.USE_POINT_FIELD_DATA&&w&&(y=!0);const x={usage:pi.PointArray,format:"unorm8x4",hash:`${y}${w.getMTime()}I${u.getMTime()}unorm8x4`,dataArray:w,indexBuffer:u,cellData:y,cellOffset:0},C=s.getBufferManager().getBuffer(x);l.addBuffer(C,["colorVI"]),h=!0}}h||l.removeBufferIfPresent("colorVI");let g=null;if((v=(p=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&v.call(p)&&e.renderable.getColorCoordinates()?g=e.renderable.getColorCoordinates():g=r.getPointData().getTCoords(),g&&!c){const w=s.getBufferManager().getBufferForPointArray(g,l.getIndexBuffer());l.addBuffer(w,["tcoord"])}else l.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,l,f,u,d,h,g,p,v,w,m,y,x,C,S;const r=[],n=[],i=(l=(c=e.renderable).getColorTextureMap)==null?void 0:l.call(c);i&&(e.colorTexture||(e.colorTexture=l1.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(i),n.push(["Diffuse",e.colorTexture]));const o=e.WebGPUActor.getRenderable(),a=e.WebGPURenderer.getRenderable(),s=[];if((u=(f=o.getProperty()).getDiffuseTexture)!=null&&u.call(f)){const T=["Diffuse",o.getProperty().getDiffuseTexture()];s.push(T)}if(o.getTextures()[0]){const T=["Diffuse",o.getTextures()[0]];s.push(T)}if(e.colorTexture){const T=["Diffuse",e.colorTexture];s.push(T)}if((h=(d=o.getProperty()).getRoughnessTexture)!=null&&h.call(d)){const T=["Roughness",o.getProperty().getRoughnessTexture()];s.push(T)}if((p=(g=o.getProperty()).getMetallicTexture)!=null&&p.call(g)){const T=["Metallic",o.getProperty().getMetallicTexture()];s.push(T)}if((w=(v=o.getProperty()).getNormalTexture)!=null&&w.call(v)){const T=["Normal",o.getProperty().getNormalTexture()];s.push(T)}if((y=(m=o.getProperty()).getAmbientOcclusionTexture)!=null&&y.call(m)){const T=["AmbientOcclusion",o.getProperty().getAmbientOcclusionTexture()];s.push(T)}if((C=(x=o.getProperty()).getEmissionTexture)!=null&&C.call(x)){const T=["Emission",o.getProperty().getEmissionTexture()];s.push(T)}if((S=a.getEnvironmentTexture)!=null&&S.call(a)){const T=["Environment",a.getEnvironmentTexture()];s.push(T)}for(let T=0;T<s.length;T++)(s[T][1].getInputData()||s[T][1].getJsImageData()||s[T][1].getCanvas())&&n.push(s[T]),s[T][1].getImage()&&s[T][1].getImageLoaded()&&n.push(s[T]);for(let T=0;T<n.length;T++){const _=n[T][1],E=n[T][0],D=e.device.getTextureManager().getTextureForVTKTexture(_);if(D.getReady()){let b=!1;for(let I=0;I<e.textures.length;I++)e.textures[I]===D&&(b=!0,r[I]=!0);if(!b){r[e.textures.length]=!0;const I=D.createView(`${E}Texture`);e.textures.push(D),e.textureViews.push(I);const R=_.getInterpolate()?"linear":"nearest";let M=null;!M&&_.getEdgeClamp()&&_.getRepeat()&&(M="mirror-repeat"),!M&&_.getEdgeClamp()&&(M="clamp-to-edge"),!M&&_.getRepeat()&&(M="repeat"),E!=="Environment"?I.addSampler(e.device,{addressModeU:M,addressModeV:M,addressModeW:M,minFilter:R,magFilter:R}):I.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:R,magFilter:R,mipmapFilter:"linear"})}}}for(let T=e.textures.length-1;T>=0;T--)r[T]||(e.textures.splice(T,1),e.textureViews.splice(T,1))},t.computePipelineHash=()=>{let r=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===ao.TriangleEdges||e.primitiveType===ao.TriangleStripEdges)r+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(r+="n"),e.vertexInput.hasAttribute("colorVI")&&(r+="c"),e.vertexInput.hasAttribute("tcoord")){const i=e.vertexInput.getBuffer("tcoord"),o=Oi.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);r+=`t${o}`}e.textures.length&&(r+=`tx${e.textures.length}`)}e._usesCellNormals&&(r+="cn"),e.SSBO&&(r+="ssbo");const n=t.getHashFromUsage(e.usage);r+=n,r+=e.renderEncoder.getPipelineHash(),e.pipelineHash=r},t.updateBuffers=()=>{e.primitiveType!==ao.TriangleEdges&&e.primitiveType!==ao.TriangleStripEdges&&t.updateTextures();const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();e.usage=t.getUsage(n,e.primitiveType),t.buildVertexInput();const i=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(i.getSizeInBytes()/i.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const o=r.getProperty();t.setNumberOfInstances(Math.ceil(o.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const Ele={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function SN(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ele,r),zL.extend(t,e,r),e.fragmentShaderTemplate=Tle,e.vertexShaderTemplate=Sle,e._tmpMat3=Ta(new Float64Array(9)),e._tmpMat4=yt(new Float64Array(16)),e.UBO=ud.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Fr(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],_le(t,e)}const Dle=Sn(SN,"vtkWebGPUCellArrayMapper");var TN={newInstance:Dle,extend:SN};const{PrimitiveTypes:Tm}=rh;function ble(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>TN.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],i=[];let o=0;for(let a=Tm.Points;a<=Tm.Triangles;a++)if(n[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[a]),s.setCurrentInput(r),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(e.renderable),o+=n[a].getNumberOfCells(),i.push(s)}else e.primitives[a]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let a=Tm.TriangleEdges;a<=Tm.TriangleStripEdges;a++)if(n[a-2].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[a-2]),s.setCurrentInput(r),s.setCellOffset(e.primitives[a-2].getCellOffset()),s.setPrimitiveType(a),s.setRenderable(e.renderable),i.push(s)}else e.primitives[a]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}const Ile={primitives:null};function Ole(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ile,r),Gn.extend(t,e,r),e.primitives=[],ble(t,e)}const Mle=Sn(Ole,"vtkWebGPUPolyDataMapper");Ia("vtkMapper",Mle);const{PrimitiveTypes:N9}=rh;function Rle(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>TN.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],i=[];let o=0;for(let a=N9.Points;a<=N9.Triangles;a++)if(n[a].getNumberOfValues()>0){e.primitives[a]||(e.primitives[a]=t.createCellArrayMapper());const s=e.primitives[a];s.setCellArray(n[a]),s.setCurrentInput(r),s.setCellOffset(o),s.setPrimitiveType(a),s.setRenderable(e.renderable),s.setIs2D(!0),o+=n[a].getNumberOfCells(),i.push(s)}else e.primitives[a]=null;t.prepareNodes(),t.addMissingChildren(i),t.removeUnusedNodes()}}function Ple(t){return{primitives:[],...t}}function Lle(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ple(r)),Gn.extend(t,e,r),e.primitives=[],Rle(t,e)}const Ale=Sn(Lle,"vtkWebGPUPolyDataMapper2D");Ia("vtkMapper2D",Ale);function Nle(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const i=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,o=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([o.usize,o.vsize],i,e.WebGPURenderWindow.getRenderable())}}}const kle={};function Vle(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kle,r),Gn.extend(t,e,r),e.scalarBarActorHelper=xN.newScalarBarActorHelper(),Nle(t,e)}const Fle=Sn(Vle,"vtkWebGPUScalarBarActor");Ia("vtkScalarBarActor",Fle);function Ule(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(r,n)=>{e.texture=r,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=Oi.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=i.sampleType},t.createFromTextureHandle=(r,n)=>{e.texture=null,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const i=Oi.getDetailsFromTextureFormat(n.format);e.bindGroupLayoutEntry.texture.sampleType=i.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(r,n)=>{let i="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?i="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(i="u32");let o=`@binding(${r}) @group(${n}) var ${e.label}: texture_${e.options.dimension}<${i}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(o=`@binding(${r}) @group(${n}) var ${e.label}: texture_depth_${e.options.dimension};`),o},t.addSampler=(r,n)=>{const i=JL.newInstance({label:`${e.label}Sampler`});i.create(r,n),t.setSampler(i)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const Ble={texture:null,handle:null,sampler:null,label:null};function _N(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ble,r),K.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},K.obj(e.bindGroupTime,{mtime:0}),K.get(t,e,["bindGroupTime","texture"]),K.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),Ule(t,e)}const Gle=K.newInstance(_N);var Wle={newInstance:Gle,extend:_N};const{BufferUsage:k9}=rh;function zle(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(r,n)=>{e.device=r,e.width=n.width,e.height=n.height,e.depth=n.depth?n.depth:1;const i=e.depth===1?"2d":"3d";e.format=n.format?n.format:"rgba8unorm",e.mipLevel=n.mipLevel?n.mipLevel:0,e.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:i,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(r,n,i)=>{e.device=r,e.handle=n,e.width=i.width,e.height=i.height,e.depth=i.depth?i.depth:1,e.format=i.format?i.format:"rgba8unorm",e.usage=i.usage?i.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=r=>{let n=[];if(r.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:r.canvas,flipY:r.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}r.jsImageData&&!r.nativeArray&&(r.width=r.jsImageData.width,r.height=r.jsImageData.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,r.nativeArray=r.jsImageData.data);const i=Oi.getDetailsFromTextureFormat(e.format);let o=e.width*i.stride;const a=(c,l,f)=>{const u=c.length/(l*f)*c.BYTES_PER_ELEMENT,d=i.elementSize===2&&i.sampleType==="float";if(d||u%256){const h=c,g=u/h.BYTES_PER_ELEMENT,p=i.elementSize,v=256*Math.floor((g*p+255)/256),w=v/p,m=K.newTypedArray(d?"Uint16Array":h.constructor.name,w*l*f);for(let y=0;y<l*f;y++)if(d)for(let x=0;x<g;x++)m[y*w+x]=mf.toHalf(h[y*g+x]);else m.set(h.subarray(y*g,(y+1)*g),y*w);return[m,v]}return[c,u]};if(r.nativeArray&&(n=r.nativeArray),r.image){const c=document.createElement("canvas");c.width=r.image.width,c.height=r.image.height;const l=c.getContext("2d");l.translate(0,c.height),l.scale(1,-1),l.drawImage(r.image,0,0,r.image.width,r.image.height,0,0,c.width,c.height),n=l.getImageData(0,0,r.image.width,r.image.height).data}const s=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=l1.generateMipmaps(n,e.width,e.height,e.mipLevel);let l=e.width,f=e.height;for(let u=0;u<=e.mipLevel;u++){const d=a(c[u],f,1);o=d[1];const h={dataArray:r.dataArray?r.dataArray:null,nativeArray:d[0],usage:k9.Texture},g=e.device.getBufferManager().getBuffer(h);s.copyBufferToTexture({buffer:g.getHandle(),offset:0,bytesPerRow:o,rowsPerImage:f},{texture:e.handle,mipLevel:u},[l,f,1]),l/=2,f/=2}e.device.submitCommandEncoder(s),e.ready=!0}else{const c=a(n,e.height,e.depth);o=c[1];const l={dataArray:r.dataArray?r.dataArray:null,usage:k9.Texture};l.nativeArray=c[0];const f=e.device.getBufferManager().getBuffer(l);s.copyBufferToTexture({buffer:f.getHandle(),offset:0,bytesPerRow:o,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(s),e.ready=!0}},t.getScale=()=>{const r=Oi.getDetailsFromTextureFormat(e.format);return r.elementSize===2&&r.sampleType==="float"?1:255},t.getNumberOfComponents=()=>Oi.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let r=0;return e.width>1&&r++,e.height>1&&r++,e.depth>1&&r++,r},t.resizeToMatch=r=>{(r.getWidth()!==e.width||r.getHeight()!==e.height||r.getDepth()!==e.depth)&&(e.width=r.getWidth(),e.height=r.getHeight(),e.depth=r.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(r,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(r!==e.width||n!==e.height||i!==e.depth)&&(e.width=r,e.height=n,e.depth=i,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n.dimension||(n.dimension=e.depth===1?"2d":"3d");const i=Wle.newInstance({label:r});return i.create(t,n),i}}const $le={device:null,handle:null,buffer:null,ready:!1,label:null};function jle(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$le,r),K.obj(t,e),K.get(t,e,["handle","ready","width","height","depth","format","usage"]),K.setGet(t,e,["device","label"]),zle(t,e)}K.newInstance(jle);function Hle(t){if(!t||t.data.length===0)throw new Error("Invalid contour set data, see publicContourSetData type for more info");if(!t.id)throw new Error("Invalid contour set data, each contour set must have an id");if(!t.data||!Array.isArray(t.data))throw new Error("Invalid contour set data, each contour set must have an array of contours");t.data.forEach(e=>{if(!e.points||!Array.isArray(e.points))throw new Error("Invalid contour set data, each contour must have an array of points");e.points.forEach(r=>{if(!r||!Array.isArray(r)||r.length!==3)throw new Error("Invalid contour set data, each point must be an array of length 3")})})}class V9{constructor(e){const{points:r,type:n}=e.data;this.id=e.id,this._points=r,this._type=n,this._color=e.color,this._segmentIndex=e.segmentIndex,this.sizeInBytes=this._getSizeInBytes()}_getSizeInBytes(){return this._points.length*3}get points(){return this._points}set points(e){this._points=e}get color(){return this._color}set color(e){this._color=e}get type(){return this._type}set type(e){this._type=e}get segmentIndex(){return this._segmentIndex}set segmentIndex(e){this._segmentIndex=e}get flatPointsArray(){return this._points.map(e=>[...e]).flat()}}class Kle{constructor(e){this._color=[200,0,0],this.id=e.id,this._contours=[],this._color=e.color??this._color,this.frameOfReferenceUID=e.frameOfReferenceUID,this._segmentIndex=e.segmentIndex,this._createEachContour(e.data),this.sizeInBytes=this._getSizeInBytes()}_createEachContour(e){e.forEach(r=>{const{points:n,type:i,color:o}=r,a=new V9({id:`${this.id}-segment-${this._segmentIndex}`,data:{points:n,type:i,segmentIndex:this._segmentIndex,color:o??this._color},segmentIndex:this._segmentIndex,color:o??this._color});this._contours.push(a)}),this._updateContourSetCentroid()}_updateContourSetCentroid(){const e=this.totalNumberOfPoints,r=this.flatPointsArray,n=r.reduce((a,s)=>[a[0]+s[0],a[1]+s[1],a[2]+s[2]],[0,0,0]),i=[n[0]/e,n[1]/e,n[2]/e],o=r.reduce((a,s)=>{const c=this._getDistance(i,s),l=this._getDistance(i,a);return c<l?s:a},r[0]);this._centroid=o}_getSizeInBytes(){return this._contours.reduce((e,r)=>e+r.sizeInBytes,0)}_getDistance(e,r){return Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2+(e[2]-r[2])**2)}get centroid(){return this._centroid}get segmentIndex(){return this._segmentIndex}get color(){return this._color}set color(e){this._color=e,this._contours.forEach(r=>{r instanceof V9&&(r.color=e)})}get contours(){return this._contours}get flatPointsArray(){return this._contours.flatMap(e=>e.points)}get numberOfContours(){return this._contours.length}get totalNumberOfPoints(){return this._contours.reduce((e,r)=>e+r.points.length,0)}get numberOfPointsArray(){return this._contours.map(e=>e.points.length)}getPointsInContour(e){return this._contours[e].points}getNumberOfPointsInAContour(e){return this.getPointsInContour(e).length}}function qle(t,e){Hle(e);const r=new Kle({id:e.id,data:e.data,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:$f.CONTOUR,data:r,sizeInBytes:r.sizeInBytes}}function Xle(t){var e,r;if(!t.id)throw new Error("Surface must have an id");if(((e=t.points)==null?void 0:e.length)===0)throw new Error("Surface must have non-empty points array");if(((r=t.polys)==null?void 0:r.length)===0)throw new Error("Surface must have non-empty polys array");if(!t.frameOfReferenceUID)throw new Error("Surface must have a frameOfReferenceUID")}function Yle(t,e){Xle(e);const r=new kA({id:e.id,points:e.points,polys:e.polys,color:e.color,frameOfReferenceUID:e.frameOfReferenceUID,segmentIndex:e.segmentIndex??1});return{id:t,type:$f.SURFACE,data:r,sizeInBytes:r.sizeInBytes}}const EN={};let Ig;function DN(t,e){const r=t.indexOf(":"),n=t.substring(0,r);let i=EN[n];if(i==null){if(Ig==null||typeof Ig!="function")throw new Error(`No geometry loader for scheme ${n} has been registered`);i=Ig}const o=i(t,e);return o.promise.then(function(a){Qe(We,$e.GEOMETRY_LOADED,{geometry:a})},function(a){const s={geometryId:t,error:a};Qe(We,$e.GEOMETRY_LOADED_FAILED,s)}),o}function Jle(t,e){if(t===void 0)throw new Error("loadGeometry: parameter geometryId must not be undefined");let r=ke.getGeometryLoadObject(t);return r!==void 0||(r=DN(t,e)),r.promise}async function Zle(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let r=ke.getGeometryLoadObject(t);return r!==void 0||(r=DN(t,e),await ke.putGeometryLoadObject(t,r)),r.promise}function bN(t,e){if(t===void 0)throw new Error("createAndCacheGeometry: parameter geometryId must not be undefined");let r=ke.getGeometry(t);if(r)return r;if(e.type===$f.CONTOUR)r=qle(t,e.geometryData);else if(e.type===$f.SURFACE)r=Yle(t,e.geometryData);else throw new Error("Unknown geometry type");return ke.putGeometrySync(t,r),r}function Qle(t,e){EN[t]=e}function eue(t){const e=Ig;return Ig=t,e}const tue=Object.freeze(Object.defineProperty({__proto__:null,createAndCacheGeometry:bN,loadAndCacheGeometry:Zle,loadGeometry:Jle,registerGeometryLoader:Qle,registerUnknownGeometryLoader:eue},Symbol.toStringTag,{value:"Module"}));function nue(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a 4D streaming image volume");const{imageIds:r}=e,{splittingTag:n,imageIdGroups:i}=k_(r),o=Math.floor(i.length/2),a=l5(i[o],t),{metadata:s,dimensions:c,spacing:l,direction:f,sizeInBytes:u,origin:d,numberOfComponents:h,dataType:g}=a,p=f.slice(6,9),v=i.map(x=>w_(x,p).sortedImageIds),w=v.flat(),m=ls.createScalarDynamicVolumeVoxelManager({dimensions:c,imageIdGroups:v,timePoint:0,numberOfComponents:h});let y=new eN({volumeId:t,metadata:s,dimensions:c,spacing:l,origin:d,direction:f,sizeInBytes:u,imageIds:w,imageIdGroups:v,splittingTag:n,voxelManager:m,numberOfComponents:h,dataType:g},{imageIds:w,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}});return{promise:Promise.resolve(y),decache:()=>{y.destroy(),y=null},cancel:()=>{y.cancelLoading()}}}const rue=Object.freeze(Object.defineProperty({__proto__:null,BaseVolumeViewport:Xn,CONSTANTS:Cu,EVENTS:$e,Enums:Da,ImageVolume:ih,ProgressiveRetrieveImages:yp,RenderingEngine:P_,Settings:Yn,StackViewport:Jn,StreamingDynamicImageVolume:eN,StreamingImageVolume:cA,Surface:kA,VideoViewport:kd,Viewport:qf,VolumeViewport:Rn,VolumeViewport3D:M_,WSIViewport:Uv,addImageSlicesToViewports:AA,addVolumesToViewports:LA,cache:ke,canRenderFloatTextures:i5,convertMapperToNotSharedMapper:pA,cornerstoneStreamingDynamicImageVolumeLoader:nue,cornerstoneStreamingImageVolumeLoader:lA,createVolumeActor:Nv,createVolumeMapper:gA,eventTarget:We,geometryLoader:tue,getConfiguration:o5,getEnabledElement:we,getEnabledElementByIds:zr,getEnabledElementByViewportId:An,getEnabledElements:HA,getOrCreateCanvas:Rs,getRenderingEngine:fr,getRenderingEngines:Qi,getShouldUseCPURendering:ld,getWebWorkerManager:Kc,imageLoadPoolManager:ei,imageLoader:kie,imageRetrievalPoolManager:sh,init:wL,isCornerstoneInitialized:xL,metaData:rL,peerImport:CL,registerImageLoader:fd,requestPoolManager:ei,resetInitialization:Nte,resetUseCPURendering:Ate,setConfiguration:kte,setPreferSizeOverAccuracy:Lte,setUseCPURendering:Pte,setVolumesForViewports:R_,triggerEvent:Qe,utilities:cn,volumeLoader:Kie},Symbol.toStringTag,{value:"Module"}));function IN(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++)e[o++]=t[i++],e[o++]=t[i++],e[o++]=t[i++],e[o++]=255;return}e.set(t)}function ON(t,e,r){if(t===void 0)throw new Error("decodeRGB: rgbBuffer must be defined");if(t.length%3!==0)throw new Error(`decodeRGB: rgbBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r)for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++],e[i++]=255;else for(let c=0;c<n;c++)e[i++]=t[o++],e[i++]=t[a++],e[i++]=t[s++]}function MN(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPixel: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPixel: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0;if(r){for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128),e[o++]=255}return}for(let a=0;a<n;a++){const s=t[i++],c=t[i++],l=t[i++];e[o++]=s+1.402*(l-128),e[o++]=s-.34414*(c-128)-.71414*(l-128),e[o++]=s+1.772*(c-128)}}function RN(t,e,r){if(t===void 0)throw new Error("convertYBRFullByPlane: ybrBuffer must be defined");if(t.length%3!==0)throw new Error(`convertYBRFullByPlane: ybrBuffer length ${t.length} must be divisible by 3`);const n=t.length/3;let i=0,o=0,a=n,s=n*2;if(r){for(let c=0;c<n;c++){const l=t[o++],f=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128),e[i++]=255}return}for(let c=0;c<n;c++){const l=t[o++],f=t[a++],u=t[s++];e[i++]=l+1.402*(u-128),e[i++]=l-.34414*(f-128)-.71414*(u-128),e[i++]=l+1.772*(f-128)}}function iue(t,e,r){if(t===void 0)throw new Error("convertYBRFull422ByPixel: ybrBuffer must be defined");if(t.length%2!==0)throw new Error(`convertYBRFull422ByPixel: ybrBuffer length ${t.length} must be divisible by 2`);const n=t.length/2;let i=0,o=0;if(r){for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[o++]=s+1.402*(f-128),e[o++]=s-.34414*(l-128)-.71414*(f-128),e[o++]=s+1.772*(l-128),e[o++]=255,e[o++]=c+1.402*(f-128),e[o++]=c-.34414*(l-128)-.71414*(f-128),e[o++]=c+1.772*(l-128),e[o++]=255}return}for(let a=0;a<n;a+=2){const s=t[i++],c=t[i++],l=t[i++],f=t[i++];e[o++]=s+1.402*(f-128),e[o++]=s-.34414*(l-128)-.71414*(f-128),e[o++]=s+1.772*(l-128),e[o++]=c+1.402*(f-128),e[o++]=c-.34414*(l-128)-.71414*(f-128),e[o++]=c+1.772*(l-128)}}function Jw(t,e){const r=t.length,n=new Uint8ClampedArray(r);for(let i=0;i<r;++i)n[i]=t[i]>>e;return n}function Zw(t,e,r){const n=t[`${e}PaletteColorLookupTableData`];if(n)return Promise.resolve(n);const i=dt("imagePixelModule",t.imageId);return i&&typeof i.then=="function"?i.then(o=>o?o[`${e}PaletteColorLookupTableData`]:r):Promise.resolve(i?i[`${e}PaletteColorLookupTableData`]:r)}function PN(t,e,r){const n=t.columns*t.rows,i=t.pixelData;Promise.all([Zw(t,"red",null),Zw(t,"green",null),Zw(t,"blue",null)]).then(([o,a,s])=>{if(!o||!a||!s)throw new Error("The image does not have a complete color palette. R, G, and B palette data are required.");const c=o.length;let l=0,f=0;const u=t.redPaletteColorLookupTableDescriptor[1],d=t.redPaletteColorLookupTableDescriptor[2]===8?0:8,h=Jw(o,d),g=Jw(a,d),p=Jw(s,d);if(r){for(let v=0;v<n;++v){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[f++]=h[w],e[f++]=g[w],e[f++]=p[w],e[f++]=255}return}for(let v=0;v<n;++v){let w=i[l++];w<u?w=0:w>u+c-1?w=c-1:w-=u,e[f++]=h[w],e[f++]=g[w],e[f++]=p[w]}})}function Qw(t,e){if(!(!t.elements[e]||t.elements[e].length!==6))return[t.uint16(e,0),t.uint16(e,1),t.uint16(e,2)]}function e3(t,e,r){const n=[],i=t.elements[e];for(let o=0;o<r[0];o++)r[2]===16?n[o]=t.uint16(e,o):n[o]=t.byteArray[o+i.dataOffset];return n}function oue(t,e){e.redPaletteColorLookupTableDescriptor=Qw(t,"x00281101"),e.greenPaletteColorLookupTableDescriptor=Qw(t,"x00281102"),e.bluePaletteColorLookupTableDescriptor=Qw(t,"x00281103"),e.redPaletteColorLookupTableDescriptor[0]===0&&(e.redPaletteColorLookupTableDescriptor[0]=65536,e.greenPaletteColorLookupTableDescriptor[0]=65536,e.bluePaletteColorLookupTableDescriptor[0]=65536);const r=e.redPaletteColorLookupTableDescriptor[0],i=t.elements.x00281201.length===r?8:16;e.redPaletteColorLookupTableDescriptor[2]!==i&&(e.redPaletteColorLookupTableDescriptor[2]=i,e.greenPaletteColorLookupTableDescriptor[2]=i,e.bluePaletteColorLookupTableDescriptor[2]=i),e.redPaletteColorLookupTableData=e3(t,"x00281201",e.redPaletteColorLookupTableDescriptor),e.greenPaletteColorLookupTableData=e3(t,"x00281202",e.greenPaletteColorLookupTableDescriptor),e.bluePaletteColorLookupTableData=e3(t,"x00281203",e.bluePaletteColorLookupTableDescriptor)}function aue(t,e){t.uint16("x00280103")===0?(e.smallestPixelValue=t.uint16("x00280106"),e.largestPixelValue=t.uint16("x00280107")):(e.smallestPixelValue=t.int16("x00280106"),e.largestPixelValue=t.int16("x00280107"))}function LN(t){const e={samplesPerPixel:t.uint16("x00280002"),photometricInterpretation:t.string("x00280004"),rows:t.uint16("x00280010"),columns:t.uint16("x00280011"),bitsAllocated:t.uint16("x00280100"),bitsStored:t.uint16("x00280101"),highBit:t.uint16("x00280102"),pixelRepresentation:t.uint16("x00280103"),planarConfiguration:t.uint16("x00280006"),pixelAspectRatio:t.string("x00280034")};return aue(t,e),e.photometricInterpretation==="PALETTE COLOR"&&t.elements.x00281101&&oue(t,e),e}function sue(t,e){let r=e.uint16("x00283002",0);r===0&&(r=65535);let n=0;t===0?n=e.uint16("x00283002",1):n=e.int16("x00283002",1);const i=e.uint16("x00283002",2),o={id:"1",firstValueMapped:n,numBitsPerEntry:i,lut:[]};for(let a=0;a<r;a++)t===0?o.lut[a]=e.uint16("x00283006",a):o.lut[a]=e.int16("x00283006",a);return o}function RC(t,e){if(!e||!e.items||!e.items.length)return;const r=[];for(let n=0;n<e.items.length;n++){const i=e.items[n].dataSet,o=sue(t,i);o&&r.push(o)}return r}function cue(t){const e=t.uint16("x00280103"),r=t.uint16("x00280101");return e===0?0:-1<<r-1}function AN(t){const e=t.string("x00080016");if(e==="1.2.840.10008.5.1.4.1.1.2"||e==="1.2.840.10008.5.1.4.1.1.2.1")return 1;const r=t.floatString("x00281052"),n=t.floatString("x00281053");return r!==void 0&&n!==void 0?cue(t)*n+r<0?1:0:t.elements.x00283000&&t.elements.x00283000.length>0?0:t.uint16("x00280103")}function fs(t,e,r){const n=[],i=t.string(e);if(!i)return;const o=i.split("\\");if(!(r&&o.length<r)){for(let a=0;a<o.length;a++)n.push(parseFloat(o[a]));return n}}var NN={exports:{}};/*! dicom-parser - 1.8.12 - 2023-02-20 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/dicomParser */(function(t,e){(function(r,n){t.exports=n(zs)})(yi,function(r){return i=[function(a,s){a.exports=r},function(a,s,c){c.r(s),c.d(s,"isStringVr",function(){return f}),c.d(s,"isPrivateTag",function(){return u}),c.d(s,"parsePN",function(){return d}),c.d(s,"parseTM",function(){return h}),c.d(s,"parseDA",function(){return p}),c.d(s,"explicitElementToString",function(){return v}),c.d(s,"explicitDataSetToJS",function(){return w}),c.d(s,"createJPEGBasicOffsetTable",function(){return x}),c.d(s,"parseDicomDataSetExplicit",function(){return ee}),c.d(s,"parseDicomDataSetImplicit",function(){return oe}),c.d(s,"readFixedString",function(){return _}),c.d(s,"alloc",function(){return de}),c.d(s,"version",function(){return ue}),c.d(s,"bigEndianByteArrayParser",function(){return me}),c.d(s,"ByteStream",function(){return Ce}),c.d(s,"sharedCopy",function(){return Ee}),c.d(s,"DataSet",function(){return b}),c.d(s,"findAndSetUNElementLength",function(){return T}),c.d(s,"findEndOfEncapsulatedElement",function(){return S}),c.d(s,"findItemDelimitationItemAndSetElementLength",function(){return I}),c.d(s,"littleEndianByteArrayParser",function(){return F}),c.d(s,"parseDicom",function(){return W}),c.d(s,"readDicomElementExplicit",function(){return H}),c.d(s,"readDicomElementImplicit",function(){return M}),c.d(s,"readEncapsulatedImageFrame",function(){return Ie}),c.d(s,"readEncapsulatedPixelData",function(){return je}),c.d(s,"readEncapsulatedPixelDataFromFragments",function(){return Z}),c.d(s,"readPart10Header",function(){return O}),c.d(s,"readSequenceItemsExplicit",function(){return L}),c.d(s,"readSequenceItemsImplicit",function(){return z}),c.d(s,"readSequenceItem",function(){return P}),c.d(s,"readTag",function(){return C});var l={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},f=function(ie){return l[ie]},u=function(ie){if(ie=parseInt(ie[4],16),isNaN(ie))throw"dicomParser.isPrivateTag: cannot parse last character of group";return ie%2==1},d=function(ie){if(ie!==void 0)return ie=ie.split("^"),{familyName:ie[0],givenName:ie[1],middleName:ie[2],prefix:ie[3],suffix:ie[4]}};function h(ie,ae){if(2<=ie.length){var ve=parseInt(ie.substring(0,2),10),se=4<=ie.length?parseInt(ie.substring(2,4),10):void 0,ge=6<=ie.length?parseInt(ie.substring(4,6),10):void 0,Ve=8<=ie.length?ie.substring(7,13):void 0,Ve=Ve?parseInt(Ve,10)*Math.pow(10,6-Ve.length):void 0;if(ae&&(isNaN(ve)||se!==void 0&&isNaN(se)||ge!==void 0&&isNaN(ge)||Ve!==void 0&&isNaN(Ve)||ve<0||23<ve||se&&(se<0||59<se)||ge&&(ge<0||59<ge)||Ve&&(Ve<0||999999<Ve)))throw"invalid TM '".concat(ie,"'");return{hours:ve,minutes:se,seconds:ge,fractionalSeconds:Ve}}if(ae)throw"invalid TM '".concat(ie,"'")}function g(ie,ae,ve){return!isNaN(ve)&&0<ae&&ae<=12&&0<ie&&ie<=function(se,ge){switch(se){case 2:return ge%4==0&&ge%100||ge%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(ae,ve)}function p(ie,ae){if(ie&&ie.length===8){var ve=parseInt(ie.substring(0,4),10),se=parseInt(ie.substring(4,6),10),ge=parseInt(ie.substring(6,8),10);if(ae&&g(ge,se,ve)!==!0)throw"invalid DA '".concat(ie,"'");return{year:ve,month:se,day:ge}}if(ae)throw"invalid DA '".concat(ie,"'")}function v(ie,ae){if(ie===void 0||ae===void 0)throw"dicomParser.explicitElementToString: missing required parameters";if(ae.vr===void 0)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var ve,se=ae.vr,ge=ae.tag;function Ve(it,ut){for(var ot="",Se=0;Se<it;Se++)Se!==0&&(ot+="/"),ot+=ut.call(ie,ge,Se).toString();return ot}if(f(se)===!0)ve=ie.string(ge);else{if(se==="AT"){var re=ie.uint32(ge);return re===void 0?void 0:"x".concat((re=re<0?4294967295+re+1:re).toString(16).toUpperCase())}se==="US"?ve=Ve(ae.length/2,ie.uint16):se==="SS"?ve=Ve(ae.length/2,ie.int16):se==="UL"?ve=Ve(ae.length/4,ie.uint32):se==="SL"?ve=Ve(ae.length/4,ie.int32):se==="FD"?ve=Ve(ae.length/8,ie.double):se==="FL"&&(ve=Ve(ae.length/4,ie.float))}return ve}function w(ie,ae){if(ie===void 0)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";ae=ae||{omitPrivateAttibutes:!0,maxElementLength:128};var ve,se={};for(ve in ie.elements){var ge=ie.elements[ve];if(ae.omitPrivateAttibutes!==!0||!u(ve))if(ge.items){for(var Ve=[],re=0;re<ge.items.length;re++)Ve.push(w(ge.items[re].dataSet,ae));se[ve]=Ve}else{var it=void 0;ge.length<ae.maxElementLength&&(it=v(ie,ge)),se[ve]=it!==void 0?it:{dataOffset:ge.dataOffset,length:ge.length}}}return se}function m(ie,ae){return ie.byteArray[ae]===255&&ie.byteArray[ae+1]===217}function y(ie,ae,ve){for(var se,ge,Ve=ve;Ve<ae.fragments.length;Ve++)if(se=ie,ge=Ve,ge=ae.fragments[ge],!(!m(se,ge.position+ge.length-2)&&!m(se,ge.position+ge.length-3)))return Ve}function x(ie,ae,ve){if(ie===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(ae===void 0)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if(ae.tag!=="x7fe00010")throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(ae.encapsulatedPixelData!==!0||ae.hadUndefinedLength!==!0||ae.basicOffsetTable===void 0||ae.fragments===void 0||ae.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve&&ve.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";ve=ve||ae.fragments;for(var se=[],ge=0;;){se.push(ae.fragments[ge].offset);var Ve=y(ie,ae,ge);if(Ve===void 0||Ve===ae.fragments.length-1)return se;ge=Ve+1}}function C(ve){if(ve===void 0)throw"dicomParser.readTag: missing required parameter 'byteStream'";var ae=256*ve.readUint16()*256,ve=ve.readUint16();return"x".concat("00000000".concat((ae+ve).toString(16)).substr(-8))}function S(ie,ae,ve){if(ie===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(ae===void 0)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(ae.encapsulatedPixelData=!0,ae.basicOffsetTable=[],ae.fragments=[],C(ie)!=="xfffee000")throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var se=ie.readUint32()/4,ge=0;ge<se;ge++){var Ve=ie.readUint32();ae.basicOffsetTable.push(Ve)}for(var re=ie.position;ie.position<ie.byteArray.length;){var it=C(ie),ut=ie.readUint32();if(it==="xfffee0dd")return ie.seek(ut),void(ae.length=ie.position-ae.dataOffset);if(it!=="xfffee000")return ve&&ve.push("unexpected tag ".concat(it," while searching for end of pixel data element with undefined length")),ut>ie.byteArray.length-ie.position&&(ut=ie.byteArray.length-ie.position),ae.fragments.push({offset:ie.position-re-8,position:ie.position,length:ut}),ie.seek(ut),void(ae.length=ie.position-ae.dataOffset);ae.fragments.push({offset:ie.position-re-8,position:ie.position,length:ut}),ie.seek(ut)}ve&&ve.push("pixel data element ".concat(ae.tag," missing sequence delimiter tag xfffee0dd"))}function T(ie,ae){if(ie===void 0)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var ve=ie.byteArray.length-8;ie.position<=ve;)if(ie.readUint16()===65534){var se=ie.readUint16();if(se===57565)return ie.readUint32()!==0&&ie.warnings("encountered non zero length following item delimiter at position ".concat(ie.position-4," while reading element of undefined length with tag ").concat(ae.tag)),void(ae.length=ie.position-ae.dataOffset)}ae.length=ie.byteArray.length-ae.dataOffset,ie.seek(ie.byteArray.length-ie.position)}function _(ie,ae,ve){if(ve<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(ae+ve>ie.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var se,ge="",Ve=0;Ve<ve;Ve++){if((se=ie[ae+Ve])===0)return ae+=ve,ge;ge+=String.fromCharCode(se)}return ge}function E(ie,ae){for(var ve=0;ve<ae.length;ve++){var se=ae[ve];se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(ie,se.key,se)}}function D(ie,ae){return ie.parser!==void 0?ie.parser:ae}var b=function(){function ie(se,ge,Ve){(function(re,it){if(!(re instanceof it))throw new TypeError("Cannot call a class as a function")})(this,ie),this.byteArrayParser=se,this.byteArray=ge,this.elements=Ve}var ae,ve;return ae=ie,(ve=[{key:"uint16",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readUint16(this.byteArray,se.dataOffset+2*ge)}},{key:"int16",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readInt16(this.byteArray,se.dataOffset+2*ge)}},{key:"uint32",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readUint32(this.byteArray,se.dataOffset+4*ge)}},{key:"int32",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readInt32(this.byteArray,se.dataOffset+4*ge)}},{key:"float",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readFloat(this.byteArray,se.dataOffset+4*ge)}},{key:"double",value:function(se,ge){if(se=this.elements[se],ge=ge!==void 0?ge:0,se&&se.length!==0)return D(se,this.byteArrayParser).readDouble(this.byteArray,se.dataOffset+8*ge)}},{key:"numStringValues",value:function(se){if(se=this.elements[se],se&&0<se.length)return se=_(this.byteArray,se.dataOffset,se.length).match(/\\/g),se===null?1:se.length+1}},{key:"string",value:function(se,ge){if(se=this.elements[se],se&&se.Value)return se.Value;if(se&&0<se.length)return se=_(this.byteArray,se.dataOffset,se.length),0<=ge?se.split("\\")[ge].trim():se.trim()}},{key:"text",value:function(se,ge){if(se=this.elements[se],se&&0<se.length)return se=_(this.byteArray,se.dataOffset,se.length),0<=ge?se.split("\\")[ge].replace(/ +$/,""):se.replace(/ +$/,"")}},{key:"floatString",value:function(se,ge){var Ve=this.elements[se];if(Ve&&0<Ve.length&&(ge=this.string(se,ge=ge!==void 0?ge:0),ge!==void 0))return parseFloat(ge)}},{key:"intString",value:function(se,ge){var Ve=this.elements[se];if(Ve&&0<Ve.length&&(ge=this.string(se,ge=ge!==void 0?ge:0),ge!==void 0))return parseInt(ge)}},{key:"attributeTag",value:function(se){var ge=this.elements[se];if(ge&&ge.length===4){var Ve=D(ge,this.byteArrayParser).readUint16,se=this.byteArray,ge=ge.dataOffset;return"x".concat("00000000".concat((256*Ve(se,ge)*256+Ve(se,ge+2)).toString(16)).substr(-8))}}}])&&E(ae.prototype,ve),Object.defineProperty(ae,"prototype",{writable:!1}),ie}();function I(ie,ae){if(ie===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var ve=ie.byteArray.length-8;ie.position<=ve;)if(ie.readUint16()===65534){var se=ie.readUint16();if(se===57357)return ie.readUint32()!==0&&ie.warnings("encountered non zero length following item delimiter at position ".concat(ie.position-4," while reading element of undefined length with tag ").concat(ae.tag)),void(ae.length=ie.position-ae.dataOffset)}ae.length=ie.byteArray.length-ae.dataOffset,ie.seek(ie.byteArray.length-ie.position)}var R=function(ie,ae){return ie.vr!==void 0?ie.vr==="SQ":ae.position+4<=ae.byteArray.length?(ie=C(ae),ae.seek(-4),ie==="xfffee000"||ie==="xfffee0dd"):(ae.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1)};function M(ie,ae,ve){if(ie===void 0)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var se=C(ie),se={tag:se,vr:ve!==void 0?ve(se):void 0,length:ie.readUint32(),dataOffset:ie.position};return se.length===4294967295&&(se.hadUndefinedLength=!0),se.tag===ae||(!R(se,ie)||u(se.tag)&&!se.hadUndefinedLength?se.hadUndefinedLength?I(ie,se):ie.seek(se.length):(z(ie,se,ve),u(se.tag)&&(se.items=void 0))),se}function P(ie){if(ie===void 0)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var ae={tag:C(ie),length:ie.readUint32(),dataOffset:ie.position};if(ae.tag!=="xfffee000")throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(ie.position);return ae}function k(ie,ae){var ve=P(ie);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=function(se,ge){for(var Ve={};se.position<se.byteArray.length;){var re=M(se,void 0,ge);if((Ve[re.tag]=re).tag==="xfffee00d")return new b(se.byteArrayParser,se.byteArray,Ve)}return se.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new b(se.byteArrayParser,se.byteArray,Ve)}(ie,ae),ve.length=ie.position-ve.dataOffset):(ve.dataSet=new b(ie.byteArrayParser,ie.byteArray,{}),oe(ve.dataSet,ie,ie.position+ve.length,{vrCallback:ae})),ve}function z(ie,ae,ve){if(ie===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(ae===void 0)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";ae.items=[],(ae.length===4294967295?function(se,ge,Ve){for(;se.position+4<=se.byteArray.length;){var re=C(se);if(se.seek(-4),re==="xfffee0dd")return ge.length=se.position-ge.dataOffset,se.seek(8);re=k(se,Ve),ge.items.push(re)}se.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),ge.length=se.byteArray.length-ge.dataOffset}:function(se,ge,Ve){for(var re=ge.dataOffset+ge.length;se.position<re;){var it=k(se,Ve);ge.items.push(it)}})(ie,ae,ve)}function A(ie,ae){var ve=P(ie);return ve.length===4294967295?(ve.hadUndefinedLength=!0,ve.dataSet=function(se,ge){for(var Ve={};se.position<se.byteArray.length;){var re=H(se,ge);if((Ve[re.tag]=re).tag==="xfffee00d")return new b(se.byteArrayParser,se.byteArray,Ve)}return ge.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new b(se.byteArrayParser,se.byteArray,Ve)}(ie,ae),ve.length=ie.position-ve.dataOffset):(ve.dataSet=new b(ie.byteArrayParser,ie.byteArray,{}),ee(ve.dataSet,ie,ie.position+ve.length)),ve}function L(ie,ae,ve){if(ie===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(ae===void 0)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";ae.items=[],(ae.length===4294967295?function(se,ge,Ve){for(;se.position+4<=se.byteArray.length;){var re=C(se);if(se.seek(-4),re==="xfffee0dd")return ge.length=se.position-ge.dataOffset,se.seek(8);re=A(se,Ve),ge.items.push(re)}Ve.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),ge.length=se.position-ge.dataOffset}:function(se,ge,Ve){for(var re=ge.dataOffset+ge.length;se.position<re;){var it=A(se,Ve);ge.items.push(it)}})(ie,ae,ve)}var N=function(ie){return ie==="OB"||ie==="OD"||ie==="OL"||ie==="OW"||ie==="SQ"||ie==="OF"||ie==="UC"||ie==="UR"||ie==="UT"||ie==="UN"?4:2};function H(ie,ae,ve){if(ie===void 0)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var se={tag:C(ie),vr:ie.readFixedString(2)};return N(se.vr)===2?se.length=ie.readUint16():(ie.seek(2),se.length=ie.readUint32()),se.dataOffset=ie.position,se.length===4294967295&&(se.hadUndefinedLength=!0),se.tag===ve||(se.vr==="SQ"?L(ie,se,ae):se.length===4294967295?se.tag==="x7fe00010"?S(ie,se,ae):(se.vr==="UN"?z:I)(ie,se):ie.seek(se.length)),se}function ee(ie,ae,ve){var se=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?ae.byteArray.length:ve,ae===void 0)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(ve<ae.position||ve>ae.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var ge=ie.elements;ae.position<ve;){var Ve=H(ae,ie.warnings,se.untilTag);if((ge[Ve.tag]=Ve).tag===se.untilTag)return}if(ae.position>ve)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function oe(ie,ae,ve){var se=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};if(ve=ve===void 0?ie.byteArray.length:ve,ae===void 0)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(ve<ae.position||ve>ae.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var ge=ie.elements;ae.position<ve;){var Ve=M(ae,se.untilTag,se.vrCallback);if((ge[Ve.tag]=Ve).tag===se.untilTag)return}}function de(ie,ae){if(typeof Buffer<"u"&&ie instanceof Buffer)return Buffer.alloc(ae);if(ie instanceof Uint8Array)return new Uint8Array(ae);throw"dicomParser.alloc: unknown type for byteArray"}var ue="1.8.12",me={readUint16:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(ae+2>ie.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(ie[ae]<<8)+ie[ae+1]},readInt16:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(ae+2>ie.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return ae=(ie[ae]<<8)+ie[ae+1],ae=32768&ae?ae-65535-1:ae},readUint32:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(ae+4>ie.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*ie[ae]+ie[ae+1])+ie[ae+2])+ie[ae+3]},readInt32:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(ae+4>ie.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(ie[ae]<<24)+(ie[ae+1]<<16)+(ie[ae+2]<<8)+ie[ae+3]},readFloat:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(ae+4>ie.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[3]=ie[ae],ve[2]=ie[ae+1],ve[1]=ie[ae+2],ve[0]=ie[ae+3],new Float32Array(ve.buffer)[0]},readDouble:function(ie,ae){if(ae<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(ae+8>ie.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[7]=ie[ae],ve[6]=ie[ae+1],ve[5]=ie[ae+2],ve[4]=ie[ae+3],ve[3]=ie[ae+4],ve[2]=ie[ae+5],ve[1]=ie[ae+6],ve[0]=ie[ae+7],new Float64Array(ve.buffer)[0]}};function Ee(ie,ae,ve){if(typeof Buffer<"u"&&ie instanceof Buffer)return ie.slice(ae,ae+ve);if(ie instanceof Uint8Array)return new Uint8Array(ie.buffer,ie.byteOffset+ae,ve);throw"dicomParser.from: unknown type for byteArray"}function _e(ie,ae){for(var ve=0;ve<ae.length;ve++){var se=ae[ve];se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(ie,se.key,se)}}var Ce=function(){function ie(se,ge,Ve){if(function(re,it){if(!(re instanceof it))throw new TypeError("Cannot call a class as a function")}(this,ie),se===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(ge===void 0)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(!(ge instanceof Uint8Array)&&(typeof Buffer>"u"||!(ge instanceof Buffer)))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(Ve<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(Ve>=ge.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=se,this.byteArray=ge,this.position=Ve||0,this.warnings=[]}var ae,ve;return ae=ie,(ve=[{key:"seek",value:function(se){if(this.position+se<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=se}},{key:"readByteStream",value:function(se){if(this.position+se>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var ge=Ee(this.byteArray,this.position,se);return this.position+=se,new ie(this.byteArrayParser,ge)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var se=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,se}},{key:"readUint32",value:function(){var se=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,se}},{key:"readFixedString",value:function(se){var ge=_(this.byteArray,this.position,se);return this.position+=se,ge}}])&&_e(ae.prototype,ve),Object.defineProperty(ae,"prototype",{writable:!1}),ie}(),F={readUint16:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(ae+2>ie.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return ie[ae]+256*ie[ae+1]},readInt16:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(ae+2>ie.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return ae=ie[ae]+(ie[ae+1]<<8),ae=32768&ae?ae-65535-1:ae},readUint32:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(ae+4>ie.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return ie[ae]+256*ie[ae+1]+256*ie[ae+2]*256+256*ie[ae+3]*256*256},readInt32:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(ae+4>ie.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return ie[ae]+(ie[ae+1]<<8)+(ie[ae+2]<<16)+(ie[ae+3]<<24)},readFloat:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(ae+4>ie.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var ve=new Uint8Array(4);return ve[0]=ie[ae],ve[1]=ie[ae+1],ve[2]=ie[ae+2],ve[3]=ie[ae+3],new Float32Array(ve.buffer)[0]},readDouble:function(ie,ae){if(ae<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(ae+8>ie.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var ve=new Uint8Array(8);return ve[0]=ie[ae],ve[1]=ie[ae+1],ve[2]=ie[ae+2],ve[3]=ie[ae+3],ve[4]=ie[ae+4],ve[5]=ie[ae+5],ve[6]=ie[ae+6],ve[7]=ie[ae+7],new Float64Array(ve.buffer)[0]}};function O(ie){var ae=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(ie===void 0)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var ve=ae.TransferSyntaxUID,se=new Ce(F,ie);return function(){var ge=function(){if(se.getSize()<=132&&ve)return!1;if(se.seek(128),se.readFixedString(4)==="DICM")return!0;if(!(ae||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return se.seek(0),!1}(),Ve=[],re={};if(!ge)return se.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:ve}},warnings:Ve};for(;se.position<se.byteArray.length;){var it=se.position,ut=H(se,Ve);if("x0002ffff"<ut.tag){se.position=it;break}ut.parser=F,re[ut.tag]=ut}return(ge=new b(se.byteArrayParser,se.byteArray,re)).warnings=se.warnings,ge.position=se.position,ge}()}var $="1.2.840.10008.1.2.2";function W(ie){var ae=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(ie===void 0)throw new Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var ve,se=function(Ve){if(Ve.elements.x00020010===void 0)throw new Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return Ve=Ve.elements.x00020010,Ve&&Ve.Value||_(ie,Ve.dataOffset,Ve.length)};function ge(ut){var it=se(ut),re=it!=="1.2.840.10008.1.2",it=function(ot,Se){var Ge=Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";if(ot!=="1.2.840.10008.1.2.1.99")return new Ce(ot===$?me:F,ie,Se);if(ae&&ae.inflater)return ot=ae.inflater(ie,Se),new Ce(F,ot,0);if(Ge==!0){var et=c(0),qe=Ee(ie,Se,ie.length-Se),et=et.inflateRawSync(qe),qe=de(ie,et.length+Se);return ie.copy(qe,0,0,Se),et.copy(qe,Se),new Ce(F,qe,0)}if(typeof pako>"u")throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return et=ie.slice(Se),qe=pako.inflateRaw(et),(et=de(ie,qe.length+Se)).set(ie.slice(0,Se),0),et.set(qe,Se),new Ce(F,et,0)}(it,ut.position),ut=new b(it.byteArrayParser,it.byteArray,{});ut.warnings=it.warnings;try{(re?ee:oe)(ut,it,it.byteArray.length,ae)}catch(ot){throw{exception:ot,dataSet:ut}}return ut}return function(Ve,re){for(var it in Ve.elements)Ve.elements.hasOwnProperty(it)&&(re.elements[it]=Ve.elements[it]);return Ve.warnings!==void 0&&(re.warnings=Ve.warnings.concat(re.warnings)),re}(ve=O(ie,ae),ge(ve))}var X=function(ie,ae,ve){for(var se=0,ge=ae;ge<ae+ve;ge++)se+=ie[ge].length;return se};function Z(ie,re,ve,se,ge){if(ge=ge||re.fragments,ie===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(re===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if((se=se||1)===void 0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if(re.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(re.encapsulatedPixelData!==!0||re.hadUndefinedLength!==!0||re.basicOffsetTable===void 0||re.fragments===void 0||re.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(ve>=re.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(se<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(ve+se>re.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var Ve=new Ce(ie.byteArrayParser,ie.byteArray,re.dataOffset),re=P(Ve);if(re.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";Ve.seek(re.length);var it=Ve.position;if(se===1)return Ee(Ve.byteArray,it+ge[ve].offset+8,ge[ve].length);for(var re=X(ge,ve,se),ut=de(Ve.byteArray,re),ot=0,Se=ve;Se<ve+se;Se++)for(var Ge=it+ge[Se].offset+8,et=0;et<ge[Se].length;et++)ut[ot++]=Ve.byteArray[Ge++];return ut}var ne=function(ie,ae){for(var ve=0;ve<ie.length;ve++)if(ie[ve].offset===ae)return ve},xe=function(ie,ae,ve,se){if(ie===ae.length-1)return ve.length-se;for(var ge=ae[ie+1],Ve=se+1;Ve<ve.length;Ve++)if(ve[Ve].offset===ge)return Ve-se;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function Ie(ie,ae,ve,se,ge){if(se=se||ae.basicOffsetTable,ge=ge||ae.fragments,ie===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(ae===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(ve===void 0)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(se===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if(ae.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(ae.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(ae.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(ae.fragments===void 0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(se.length===0)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(ve<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(ve>=se.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var Ve=se[ve],Ve=ne(ge,Ve);if(Ve===void 0)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return Z(ie,ae,Ve,xe(ve,se,ge,Ve),ge)}var Le=!1;function je(ie,ae,ve){if(Le||(Le=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),ie===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(ae===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(ve===void 0)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if(ae.tag!=="x7fe00010")throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(ae.encapsulatedPixelData!==!0||ae.hadUndefinedLength!==!0||ae.basicOffsetTable===void 0||ae.fragments===void 0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(ve<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return ae.basicOffsetTable.length!==0?Ie(ie,ae,ve):Z(ie,ae,0,ae.fragments.length)}s.default={isStringVr:f,isPrivateTag:u,parsePN:d,parseTM:h,parseDA:p,explicitElementToString:v,explicitDataSetToJS:w,createJPEGBasicOffsetTable:x,parseDicomDataSetExplicit:ee,parseDicomDataSetImplicit:oe,readFixedString:_,alloc:de,version:ue,bigEndianByteArrayParser:me,ByteStream:Ce,sharedCopy:Ee,DataSet:b,findAndSetUNElementLength:T,findEndOfEncapsulatedElement:S,findItemDelimitationItemAndSetElementLength:I,littleEndianByteArrayParser:F,parseDicom:W,readDicomElementExplicit:H,readDicomElementImplicit:M,readEncapsulatedImageFrame:Ie,readEncapsulatedPixelData:je,readEncapsulatedPixelDataFromFragments:Z,readPart10Header:O,readSequenceItemsExplicit:L,readSequenceItemsImplicit:z,readSequenceItem:P,readTag:C,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],o={},n.m=i,n.c=o,n.d=function(a,s,c){n.o(a,s)||Object.defineProperty(a,s,{enumerable:!0,get:c})},n.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},n.t=function(a,s){if(1&s&&(a=n(a)),8&s||4&s&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(n.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),2&s&&typeof a!="string")for(var l in a)n.d(c,l,(function(f){return a[f]}).bind(null,l));return c},n.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return n.d(s,"a",s),s},n.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},n.p="",n(n.s=1);function n(a){if(o[a])return o[a].exports;var s=o[a]={i:a,l:!1,exports:{}};return i[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var i,o})})(NN);var kr=NN.exports;function u1(t){const e=t.indexOf(":");let r=t.substring(e+1);const n=r.indexOf("frame=");let i;if(n!==-1){const s=r.substring(n+6);i=parseInt(s,10),r=r.substring(0,n-1)}const o=t.substring(0,e),a=i!==void 0?i-1:void 0;return{scheme:o,url:r,frame:i,pixelDataFrame:a}}let PC={open(t,e){t.open("get",e,!0)},beforeSend(){},beforeProcessing(t){return Promise.resolve(t.response)},imageCreated(){},strict:!1};function kN(t){PC=Object.assign(PC,t)}function f1(){return PC}function m5(t,e,r={},n={}){const i=f1(),o=c=>{if(typeof i.errorInterceptor=="function"){const l=new Error("request failed");l.request=c,l.response=c.response,l.status=c.status,i.errorInterceptor(l)}},a=new XMLHttpRequest,s=new Promise((c,l)=>{i.open(a,t,r,n);const f=i.beforeSend(a,e,r,n);a.responseType="arraybuffer";const u=Object.assign({},r,f);Object.keys(u).forEach(function(d){u[d]!==null&&(d==="Accept"&&t.indexOf("accept=")!==-1||a.setRequestHeader(d,u[d]))}),n.deferred={resolve:c,reject:l},n.url=t,n.imageId=e,a.onloadstart=function(d){i.onloadstart&&i.onloadstart(d,n),Qe(We,"cornerstoneimageloadstart",{url:t,imageId:e})},a.onloadend=function(d){i.onloadend&&i.onloadend(d,n),Qe(We,"cornerstoneimageloadend",{url:t,imageId:e})},a.onreadystatechange=function(d){i.onreadystatechange&&i.onreadystatechange(d,n),a.readyState===4&&(a.status===200||a.status===206?i.beforeProcessing(a).then(c).catch(()=>{o(a),l(a)}):(o(a),l(a)))},a.onprogress=function(d){const h=d.loaded;let g,p;d.lengthComputable&&(g=d.total,p=Math.round(h/g*100)),Qe(We,"cornerstoneimageloadprogress",{url:t,imageId:e,loaded:h,total:g,percentComplete:p}),i.onprogress&&i.onprogress(d,n)},a.onerror=function(){o(a),l(a)},a.onabort=function(){o(a),l(a)},a.send()});return s.xhr=a,s}function lue(t,e,r){if(r+t.length>e.length)return!1;let n=r;for(let i=0;i<t.length;i++)if(t[i]!==e[n++])return!1;return!0}function uue(t){const e=new Uint8Array(t.length);for(let r=0,n=t.length;r<n;r++)e[r]=t.charCodeAt(r);return e}function LC(t,e,r){r=r||0;const n=uue(e);for(let i=r;i<t.length;i++)if(n[0]===t[i]&&lue(n,t,i))return i;return-1}const{ImageQualityStatus:F9}=Da;function z_(t,e,r){r||(r={});const n=new Uint8Array(e),i=!!(r!=null&&r.isPartial);if(t.indexOf("multipart")===-1)return{contentType:t,imageQualityStatus:i?F9.SUBRESOLUTION:F9.FULL_RESOLUTION,pixelData:n};let{tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c}=r;if(o||(o=LC(n,`\r
\r
`)),o===-1)throw new Error("invalid response - no multipart mime header");if(!s&&(a=hue(n,0,o).split(`\r
`),s=fue(a),!s))throw new Error("invalid response - no boundary marker");const l=o+4,f=LC(n,s,l);if(f===-1&&!i)throw new Error("invalid response - terminating boundary not found");return c||(c=due(a)),r.tokenIndex=o,r.boundary=s,r.responseHeaders=a,r.multipartContentType=c,r.isPartial=f===-1,{contentType:c,extractDone:!i||f!==-1,tokenIndex:o,responseHeaders:a,boundary:s,multipartContentType:c,pixelData:e.slice(l,f-2)}}function fue(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,2)==="--")return t[e]}function due(t){for(let e=0;e<t.length;e++)if(t[e].substr(0,13)==="Content-Type:")return t[e].substr(13).trim()}function hue(t,e,r){e=e||0,r=r||t.length-e;let n="";for(let i=e;i<e+r;i++)n+=String.fromCharCode(t[i]);return n}const{ImageQualityStatus:U9}=Da;function $_(t,e=!0){return e?t.imageQualityStatus??U9.FULL_RESOLUTION:U9.SUBRESOLUTION}const{ProgressiveIterator:gue}=cn;function VN(t,e,r={},n={}){const i=f1(),{retrieveOptions:o={},streamingData:a={}}=n,s=o.minChunkSize||128*1024,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}},l=new gue("streamRequest");return l.generate(async(f,u)=>{var g,p;const d=(g=i.beforeSend)==null?void 0:g.call(i,null,t,r,{}),h=Object.assign({},r,d);Object.keys(h).forEach(function(v){h[v]===null&&(h[v]=void 0),v==="Accept"&&t.indexOf("accept=")!==-1&&(h[v]=void 0)});try{const v=await fetch(t,{headers:h,signal:void 0});if(v.status!==200)throw new Error(`Couldn't retrieve ${t} got status ${v.status}`);const w=v.body.getReader(),m=v.headers,y=m.get("content-type"),x=Number(m.get("Content-Length"));let C=!1,S=a.encodedData,T=a.lastSize||0;for(a.isPartial=!0;!C;){const{done:_,value:E}=await w.read();if(S=pue(S,E),!S){if(C)throw new Error(`Done but no image frame available ${e}`);continue}if(C=_||S.byteLength===x,!C&&S.length<T+s)continue;T=S.length,a.isPartial=!_;const D=z_(y,S,a),b=$_(o,C),I={url:t,imageId:e,...D,percentComplete:_?100:((p=D.pixelData)==null?void 0:p.length)*100/x,imageQualityStatus:b,done:C};f.add(I,C)}}catch(v){c(),console.error(v),u(v)}}),l.getNextPromise()}function pue(t,e){if(!t)return e;if(!e)return t;const r=new Uint8Array(t.length+e.length);return r.set(t,0),r.set(e,t.length),r}const mue={xhrRequest:m5,streamRequest:VN,setOptions:kN,getOptions:f1};function vue(t){const e=t.elements.x7fe00010.fragments,r=t.byteArray.length;for(const n of e){const{position:i,length:o}=n;o>r-i&&(console.log(`Truncated fragment, changing fragment length from ${n.length} to ${r-i}`),n.length=r-i)}return t}function yue(t){let e=kr.parseDicom(t,{untilTag:"x7fe00010"});e.elements.x7fe00010||console.warn("Pixel data not found!");let r;try{r=kr.parseDicom(t)}catch(n){console.error(n),console.log("pixel data dataset:",n.dataSet),r=n.dataSet}return e.elements.x7fe00010=r.elements.x7fe00010,e=vue(e),e}async function FN(t,e,r){const n=yue(t),{uri:i,imageId:o,fileTotalLength:a}=r;return n.fetchMore=async function(s){const c=Object.assign({uri:i,imageId:o,fetchedLength:t.length,lengthToFetch:a-t.length},s),{fetchedLength:l,lengthToFetch:f}=c,{arrayBuffer:u}=await e(i,o,{byteRange:`${l}-${l+f}`}),d=new Uint8Array(u),h=new Uint8Array(n.byteArray.length+d.length);return h.set(n.byteArray),h.set(d,n.byteArray.length),FN(h,e,r)},n}function wue(t,e){if(!t)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i}=BN(t);if(n||r>1){const{shared:o,perFrame:a}=UN(n,i,e);return{NumberOfFrames:r,PerFrameFunctionalInformation:a,SharedFunctionalInformation:o}}return{NumberOfFrames:r}}function UN(t,e,r){const n={};(e?Object.values(e.items[0].dataSet.elements):[]).map(o=>n[o.tag]=o);const i={};return(t?Object.values(t.items[r-1].dataSet.elements):[]).map(o=>i[o.tag]=o),{shared:n,perFrame:i}}function BN(t){if(!t)return;const{elements:e,...r}=t,{x52009230:n,x52009229:i,...o}=e;return{NumberOfFrames:t.intString("x00280008"),PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o,otherAttributtes:r}}function xue(t,e){if(!e)return;const{NumberOfFrames:r,PerFrameFunctionalGroupsSequence:n,SharedFunctionalGroupsSequence:i,otherElements:o}=BN(e);if(n||r>1){const{shared:a,perFrame:s}=UN(n,i,t),c={elements:{...o,...a,...s}},l=Object.create(e);return Object.assign(l,c)}return e}let ai={};const Cue=()=>{ai={}};function j_(t){if(ai[t])return ai[t]}function Sue(t){const e=j_(t);return GN(e)}function GN(t){if(!t)return!1;const e=t.intString("x00280008");return e&&e>1}function Tue(t){return t.indexOf("&frame=")}function _ue(t){const e=Tue(t),r=e===-1?t:t.slice(0,e),n=parseInt(t.slice(e+7),10)||1;let i;return ai[r]?i=ai[r].dataSet:i=void 0,{dataSet:i,frame:n}}function Eue(t){const e=[],r=j_(t);if(GN(r)){const n=r.intString("x00280008");for(let i=1;i<=n;i++)e.push(`${t}&frame=${i}`)}else e.push(t);return e}const WN={_get:j_,generateMultiframeWADOURIs:Eue,retrieveMultiframeDataset:_ue,isMultiframeDataset:Sue};let Fd=0,gf={};function Due(t){return ai[t]!==void 0}function bue(t){let e;if(t.includes("&frame=")){const{frame:r,dataSet:n}=WN.retrieveMultiframeDataset(t);e=xue(r,n)}else ai[t]&&(e=ai[t].dataSet);return e}function Iue(t,e){const r=ai[t];if(!r){console.error(`No loaded dataSet for uri ${t}`);return}Fd-=r.dataSet.byteArray.length,r.dataSet=e,Fd+=e.byteArray.length,Qe(We,"datasetscachechanged",{uri:t,action:"updated",cacheInfo:v5()})}function Oue(t,e=m5,r){if(ai[t])return new Promise(o=>{ai[t].cacheCount++,o(ai[t].dataSet)});if(gf[t])return gf[t].cacheCount++,gf[t];const n=e(t,r),i=new Promise((o,a)=>{n.then(async function(s){const c={isPartialContent:!1,fileTotalLength:null};if(!(s instanceof ArrayBuffer)){if(!s.arrayBuffer)return a(new Error("If not returning ArrayBuffer, must return object with `arrayBuffer` parameter"));c.isPartialContent=s.flags.isPartialContent,c.fileTotalLength=s.flags.fileTotalLength,s=s.arrayBuffer}const l=new Uint8Array(s);let f;try{c.isPartialContent?f=await FN(l,e,{uri:t,imageId:r,fileTotalLength:c.fileTotalLength}):f=kr.parseDicom(l)}catch(u){return a(u)}ai[t]={dataSet:f,cacheCount:i.cacheCount},Fd+=f.byteArray.length,o(f),Qe(We,"datasetscachechanged",{uri:t,action:"loaded",cacheInfo:v5()})},a).then(()=>{delete gf[t]},()=>{delete gf[t]})});return i.cacheCount=1,gf[t]=i,i}function Mue(t){ai[t]&&(ai[t].cacheCount--,ai[t].cacheCount===0&&(Fd-=ai[t].dataSet.byteArray.length,delete ai[t],Qe(We,"datasetscachechanged",{uri:t,action:"unloaded",cacheInfo:v5()})))}function v5(){return{cacheSizeInBytes:Fd,numberOfDataSetsCached:Object.keys(ai).length}}function Rue(){Cue(),gf={},Fd=0}const gd={isLoaded:Due,load:Oue,unload:Mue,getInfo:v5,purge:Rue,get:bue,update:Iue};function Pue(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=t.elements[`${n}3000`];if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.byteArray[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:t.uint16(`${n}0010`),columns:t.uint16(`${n}0011`),type:t.string(`${n}0040`),x:t.int16(`${n}0050`,1)-1,y:t.int16(`${n}0050`,0)-1,pixelData:o,description:t.string(`${n}0022`),label:t.string(`${n}1500`),roiArea:t.string(`${n}1301`),roiMean:t.string(`${n}1302`),roiStandardDeviation:t.string(`${n}1303`)})}return{overlays:e}}function ch(t){return t==="RECON TOMO"||t==="RECON GATED TOMO"}function H_(t,e){const r=t.string("x00080008");if(r){const n=r.split("\\");if(n.length>e)return n[e]}}function Lue(t){let e;const r=t.string("x00080060");if(r!=null&&r.includes("NM")){const n=H_(t,2);n&&ch(n)&&t.elements.x00540022&&(e=fs(t.elements.x00540022.items[0].dataSet,"x00200037",6))}return e}function Aue(t){let e;const r=t.string("x00080060");if(r!=null&&r.includes("NM")){const n=H_(t,2);n&&ch(n)&&t.elements.x00540022&&(e=fs(t.elements.x00540022.items[0].dataSet,"x00200032",3))}return e}function B9(t){let e=fs(t,"x00200037",6);return!e&&t.elements.x00209116&&(e=fs(t.elements.x00209116.items[0].dataSet,"x00200037",6)),e||(e=Lue(t)),e}function G9(t){let e=fs(t,"x00200032",3);return!e&&t.elements.x00209113&&(e=fs(t.elements.x00209113.items[0].dataSet,"x00200032",3)),e||(e=Aue(t)),e}function W9(t){let e=fs(t,"x00280030",2);return!e&&t.elements.x00289110&&(e=fs(t.elements.x00289110.items[0].dataSet,"x00280030",2)),e}function z9(t){let e;return t.elements.x00180050?e=t.floatString("x00180050"):t.elements.x00289110&&t.elements.x00289110.items.length&&t.elements.x00289110.items[0].dataSet.elements.x00180050&&(e=t.elements.x00289110.items[0].dataSet.floatString("x00180050")),e}function zN(t,e,r){const n={};for(const i of r)try{const o=e(i,t);if(o){const a={};for(const s in o)if(s in o){const c=Nue(s);a[c]=o[s]}Object.assign(n,a)}}catch(o){console.error(`Error retrieving ${i} data:`,o)}return n}const Nue=t=>t.charAt(0).toUpperCase()+t.slice(1),$N=["multiframeModule","generalSeriesModule","patientStudyModule","imagePlaneModule","nmMultiframeGeometryModule","imagePixelModule","modalityLutModule","voiLutModule","sopCommonModule","petIsotopeModule","overlayPlaneModule","transferSyntax","petSeriesModule","petImageModule"];function $9(t){const e=t.elements.x00186011;return!e||!e.items?[]:e.items.map(n=>{const i=n.dataSet.double("x0018602c"),o=n.dataSet.double("x0018602e"),a=n.dataSet.uint16("x00186024"),s=n.dataSet.uint16("x00186026"),c=n.dataSet.uint16("x0018601a"),l=n.dataSet.uint16("x0018601e"),f=n.dataSet.uint16("x00186018"),u=n.dataSet.uint16("x0018601c"),d=n.dataSet.int32("x00186020")||null,h=n.dataSet.int32("x00186022")||null,g=n.dataSet.uint16("x0018602a"),p=n.dataSet.uint16("x00186028"),v=n.dataSet.uint16("x00186012"),w=n.dataSet.uint16("x00186014"),m=n.dataSet.uint16("x00186016"),y=n.dataSet.uint16("x00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:d,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:v,regionDataType:w,regionFlags:m,transducerFrequency:y}})}function K_(t,e){const{MetadataModules:r}=Da;if(Array.isArray(e))return;const n=u1(e);if(t===r.MULTIFRAME){const a=WN.retrieveMultiframeDataset(n.url);return a.dataSet?wue(a.dataSet,a.frame):void 0}let i=n.url;n.frame&&(i=`${i}&frame=${n.frame}`);const o=gd.get(i);if(o)return jN(t,e,o)}function jN(t,e,r){const{MetadataModules:n}=Da;if(t===n.GENERAL_STUDY)return{studyDescription:r.string("x00081030"),studyDate:kr.parseDA(r.string("x00080020")),studyTime:kr.parseTM(r.string("x00080030")||""),accessionNumber:r.string("x00080050")};if(t===n.GENERAL_SERIES)return{modality:r.string("x00080060"),seriesInstanceUID:r.string("x0020000e"),seriesNumber:r.intString("x00200011"),studyInstanceUID:r.string("x0020000d"),seriesDate:kr.parseDA(r.string("x00080021")),seriesTime:kr.parseTM(r.string("x00080031")||""),acquisitionDate:kr.parseDA(r.string("x00080022")),acquisitionTime:kr.parseTM(r.string("x00080032")||"")};if(t===n.GENERAL_IMAGE)return{sopInstanceUID:r.string("x00080018"),instanceNumber:r.intString("x00200013"),lossyImageCompression:r.string("x00282110"),lossyImageCompressionRatio:r.floatString("x00282112"),lossyImageCompressionMethod:r.string("x00282114")};if(t===n.PATIENT)return{patientID:r.string("x00100020"),patientName:r.string("x00100010")};if(t===n.PATIENT_STUDY)return{patientAge:r.intString("x00101010"),patientSize:r.floatString("x00101020"),patientSex:r.string("x00100040"),patientWeight:r.floatString("x00101030")};if(t===n.NM_MULTIFRAME_GEOMETRY){const i=r.string("x00080060"),o=H_(r,2);return{modality:i,imageType:r.string("x00080008"),imageSubType:o,imageOrientationPatient:B9(r),imagePositionPatient:G9(r),sliceThickness:z9(r),pixelSpacing:W9(r),numberOfFrames:r.uint16("x00280008"),isNMReconstructable:ch(o)&&i.includes("NM")}}if(t===n.IMAGE_PLANE){const i=B9(r),o=G9(r),a=W9(r),s=z9(r);let c=null,l=null;a&&(l=a[0],c=a[1]);let f=null,u=null;return i&&(f=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],u=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]),{frameOfReferenceUID:r.string("x00200052"),rows:r.uint16("x00280010"),columns:r.uint16("x00280011"),imageOrientationPatient:i,rowCosines:f,columnCosines:u,imagePositionPatient:o,sliceThickness:s,sliceLocation:r.floatString("x00201041"),pixelSpacing:a,rowPixelSpacing:l,columnPixelSpacing:c}}if(t===n.CINE)return{frameTime:r.floatString("x00181063")};if(t===n.IMAGE_PIXEL)return LN(r);if(t===n.VOI_LUT){const i=AN(r);return{windowCenter:fs(r,"x00281050",1),windowWidth:fs(r,"x00281051",1),voiLUTSequence:RC(i,r.elements.x00283010),voiLUTFunction:r.string("x00281056")}}if(t===n.MODALITY_LUT)return{rescaleIntercept:r.floatString("x00281052"),rescaleSlope:r.floatString("x00281053"),rescaleType:r.string("x00281054"),modalityLUTSequence:RC(r.uint16("x00280103"),r.elements.x00283000)};if(t===n.SOP_COMMON)return{sopClassUID:r.string("x00080016"),sopInstanceUID:r.string("x00080018")};if(t===n.PET_ISOTOPE){const i=r.elements.x00540016;if(i===void 0)return;const o=i.items[0].dataSet;return{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:kr.parseTM(o.string("x00181072")||""),radionuclideTotalDose:o.floatString("x00181074"),radionuclideHalfLife:o.floatString("x00181075")}}}if(t===n.OVERLAY_PLANE)return Pue(r);if(t==="transferSyntax"){let i;try{i=r.string("x00020010")}catch{}return{transferSyntaxUID:i}}if(t===n.PET_SERIES)return{correctedImage:r.string("x00280051"),units:r.string("x00541001"),decayCorrection:r.string("x00541102")};if(t===n.PET_IMAGE)return{frameReferenceTime:r.floatString(r.string("x00541300")||""),actualFrameDuration:r.intString(r.string("x00181242"))};if(t===n.ULTRASOUND_ENHANCED_REGION)return $9(r);if(t===n.CALIBRATION&&r.string("x00080060")==="US")return{sequenceOfUltrasoundRegions:$9(r)};if(t==="instance")return zN(e,K_,$N)}let y5=[];function kue(t){return`dicomfile:${y5.push(t)-1}`}function Vue(t){return y5[t]}function Fue(t){y5[t]=void 0}function Uue(){y5=[]}const HN={add:kue,get:Vue,remove:Fue,purge:Uue};function Bue(t){const e=t.intString("x00280008"),r=t.elements.x7fe00010;return e!==r.fragments.length}function KN(t,e){if(t.elements.x7fe00010&&t.elements.x7fe00010.basicOffsetTable.length)return kr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e);if(Bue(t)){const l=kr.createJPEGBasicOffsetTable(t,t.elements.x7fe00010);return kr.readEncapsulatedImageFrame(t,t.elements.x7fe00010,e,l)}const r=t.elements.x7fe00010.fragments,n=new kr.ByteStream(t.byteArrayParser,t.byteArray,t.elements.x7fe00010.dataOffset),i=kr.readSequenceItem(n);if(i.tag!=="xfffee000")throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";n.seek(i.length);const o=n.position;if(e+1>r.length)throw"dicomParser.readEncapsulatedPixelData: frame exceeds number of fragments";const s=o+r[e].offset+8,c=r[e].length;return new Uint8Array(n.byteArray.buffer.slice(n.byteArray.byteOffset+s,n.byteArray.byteOffset+s+c))}function Gue(t,e){return t&1<<e}function qN(t,e,r){const n=new Uint8Array(r);for(let i=0;i<r;i++){const o=Math.floor(i/8),a=t[o+e],s=i%8;n[i]=Gue(a,s)?1:0}return n}function XN(t,e){const r=t.elements.x7fe00010||t.elements.x7fe00008,n=t.uint16("x00280100"),i=t.uint16("x00280010"),o=t.uint16("x00280011");let a=t.uint16("x00280002");t.string("x00280004")==="YBR_FULL_422"&&(a=2,console.warn(`Using SamplesPerPixel of 2 for YBR_FULL_422 photometric interpretation.
      See http://dicom.nema.org/medical/dicom/current/output/chtml/part03/sect_C.7.6.3.html for more information.`));const c=r.dataOffset,l=i*o*a;let f;if(n===8){if(f=c+e*l,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l))}else if(n===16){if(f=c+e*l*2,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*2))}else if(n===1){if(f=c+e*l*.125,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return qN(t.byteArray,f,l)}else if(n===32){if(f=c+e*l*4,f>=t.byteArray.length)throw new Error("frame exceeds size of pixelData");return new Uint8Array(t.byteArray.buffer.slice(f,f+l*4))}throw new Error("unsupported pixel format")}function YN(t){const e=u1(t),r=parseInt(e.url,10),n=HN.get(r);return new Promise((i,o)=>{const a=new FileReader;a.onload=s=>{const c=s.target.result;i(c)},a.onerror=o,a.readAsArrayBuffer(n)})}function q_(t,e=0){const r=t.elements.x7fe00010||t.elements.x7fe00008;return r?r.encapsulatedPixelData?KN(t,e):XN(t,e):null}function w5(t){let e=t[0],r=t[0],n;const i=t.length;for(let o=1;o<i;o++)n=t[o],e=Math.min(e,n),r=Math.max(r,n);return{min:e,max:r}}function X_(t,e){let r;return Number.isInteger(t)&&Number.isInteger(e)&&(t>=0?e<=255?r=Uint8Array:e<=65535&&(r=Uint16Array):t>=-128&&e<=127?r=Int8Array:t>=-32768&&e<=32767&&(r=Int16Array)),r||Float32Array}function Wue(t,e,r){return X_(t,e)===r}function t3(t,e,r){t.planarConfiguration===0?IN(t.pixelData,e,r):ON(t.pixelData,e,r)}function zue(t,e,r){t.planarConfiguration===0?MN(t.pixelData,e,r):RN(t.pixelData,e,r)}function JN(t,e,r){if(t.photometricInterpretation==="RGB")t3(t,e,r);else if(t.photometricInterpretation==="YBR_RCT")t3(t,e,r);else if(t.photometricInterpretation==="YBR_ICT")t3(t,e,r);else if(t.photometricInterpretation==="PALETTE COLOR")PN(t,e,r);else if(t.photometricInterpretation==="YBR_FULL_422")iue(t.pixelData,e,r);else if(t.photometricInterpretation==="YBR_FULL")zue(t,e,r);else throw new Error(`No color space conversion for photometric interpretation ${t.photometricInterpretation}`)}function $ue(t){if(t===void 0)return!1;const{rows:e,columns:r,photometricInterpretation:n,pixelDataLength:i,planarConfiguration:o}=t;return i===4*r*e||n==="PALETTE COLOR"?!1:n.endsWith("420")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*e:n.endsWith("422")?i===(3*Math.ceil(r/2)+Math.floor(r/2))*Math.ceil(e/2)+Math.floor(e/2)*r:n!=="RGB"||o===1}function jue(t){return Hue(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(t))))}function Hue(t){let e;try{return decodeURIComponent(escape(t))}catch(r){if(e=r,e instanceof URIError)return t;throw e}}function ZN(t,e,r){const n=new Date().getTime(),i=new Blob([e],{type:"image/jpeg"});return new Promise((o,a)=>{const s=new FileReader;s.readAsBinaryString===void 0?s.readAsArrayBuffer(i):s.readAsBinaryString(i),s.onload=function(){const c=new Image;c.onload=function(){r.height=c.height,r.width=c.width,t.rows=c.height,t.columns=c.width;const l=r.getContext("2d");l.drawImage(this,0,0);const f=l.getImageData(0,0,c.width,c.height),u=new Date().getTime();t.pixelData=new Uint8Array(f.data.buffer),t.imageData=f,t.decodeTimeInMS=u-n;const d=w5(t.pixelData);t.smallestPixelValue=d.min,t.largestPixelValue=d.max,t.pixelDataLength=t.pixelData.length,o(t)},c.onerror=function(l){a(l)},s.readAsBinaryString===void 0?c.src=`data:image/jpeg;base64,${window.btoa(jue(s.result))}`:c.src=`data:image/jpeg;base64,${window.btoa(s.result)}`},s.onerror=c=>{a(c)}})}function xo(t,e,r,n,i){const o={...n};delete o.loader,delete o.streamingData;const a=Kc(),s=o.priority||void 0;return o.transferPixelData&&r.buffer,a.executeTask("dicomImageLoader","decodeTask",{imageFrame:t,transferSyntax:e,pixelData:r,options:o,decodeConfig:i},{priority:s,requestType:o==null?void 0:o.requestType})}function Kue(t,e,r,n,i={},o){switch(e){case"1.2.840.10008.1.2":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.1":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.2":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.1.99":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.5":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.50":return t.bitsAllocated===8&&(t.samplesPerPixel===3||t.samplesPerPixel===4)?ZN(t,r,n):xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.51":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.57":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.70":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.80":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.81":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.90":return xo(t,e,r,i,o);case"1.2.840.10008.1.2.4.91":return xo(t,e,r,i,o);case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":return xo(t,e,r,i,o)}return Promise.reject(new Error(`No decoder for transfer syntax ${e}`))}function QN(t){const e=dt("imagePixelModule",t);return{samplesPerPixel:e.samplesPerPixel,photometricInterpretation:e.photometricInterpretation,planarConfiguration:e.planarConfiguration,rows:e.rows,columns:e.columns,bitsAllocated:e.bitsAllocated,bitsStored:e.bitsStored,pixelRepresentation:e.pixelRepresentation,smallestPixelValue:e.smallestPixelValue,largestPixelValue:e.largestPixelValue,redPaletteColorLookupTableDescriptor:e.redPaletteColorLookupTableDescriptor,greenPaletteColorLookupTableDescriptor:e.greenPaletteColorLookupTableDescriptor,bluePaletteColorLookupTableDescriptor:e.bluePaletteColorLookupTableDescriptor,redPaletteColorLookupTableData:e.redPaletteColorLookupTableData,greenPaletteColorLookupTableData:e.greenPaletteColorLookupTableData,bluePaletteColorLookupTableData:e.bluePaletteColorLookupTableData,pixelData:void 0,imageId:t}}function que(t,e){const r=t.get("modalityLutModule",e)||{},n=t.get("generalSeriesModule",e)||{},{modality:i}=n,o={rescaleSlope:r.rescaleSlope,rescaleIntercept:r.rescaleIntercept,modality:i},a=t.get("scalingModule",e)||{};return{...o,...i==="PT"&&{suvbw:a.suvbw}}}function Y_(t){return t==="RGB"||t==="PALETTE COLOR"||t==="YBR_FULL"||t==="YBR_FULL_422"||t==="YBR_PARTIAL_422"||t==="YBR_PARTIAL_420"||t==="YBR_RCT"||t==="YBR_ICT"}let j9="";function Xue(t){return t!=="1.2.840.10008.5.1.4.1.1.12.1"&&t!=="1.2.840.10008.5.1.4.1.1.12.2.1"}function Yue(t){const e=t.smallestPixelValue,r=t.largestPixelValue,n=X_(e,r);if(n){const i=new n(t.pixelData);t.pixelData=i}else throw new Error("Could not apply a typed array to the pixel data")}function Jue(t,e){const r=t.length/4;let n=0,i=0;for(let o=0;o<r;o++)e[i++]=t[n++],e[i++]=t[n++],e[i++]=t[n++],n++;return e}function x5(t,e,r,n={}){const i=n.useRGBA;if(n.preScale={enabled:n.preScale&&n.preScale.enabled!==void 0?n.preScale.enabled:!0},!(e!=null&&e.length))return Promise.reject(new Error("The pixel data is missing"));const{MetadataModules:o}=Da,a=document.createElement("canvas"),s=QN(t);if(s.decodeLevel=n.decodeLevel,n.allowFloatRendering=i5(),n.preScale.enabled){const u=que(rL,t);n.preScale={...n.preScale,scalingParameters:u}}const{decodeConfig:c}=f1();Object.keys(s).forEach(u=>{(typeof s[u]=="function"||s[u]instanceof Promise)&&delete s[u]});const l=Kue(s,r,e,a,n,c),f=Y_(s.photometricInterpretation);return new Promise((u,d)=>{l.then(function(h){let g=!1;if(n.targetBuffer&&n.targetBuffer.type&&!f){const{arrayBuffer:_,type:E,offset:D=0,length:b}=n.targetBuffer,I=h.pixelDataLength,R=D,M=b??I-R,P={Uint8Array,Uint16Array,Int16Array,Float32Array};if(M!==h.pixelDataLength)throw new Error(`target array for image does not have the same length (${M}) as the decoded image length (${h.pixelDataLength}).`);const k=P[E],z=_?new k(_,R,M):new k(h.pixelData);if(M!==h.pixelDataLength)throw new Error("target array for image does not have the same length as the decoded image length.");h.pixelData=z,g=!0}g||Yue(h);const p=dt(o.IMAGE_PLANE,t)||{},v=dt(o.VOI_LUT,t)||{},w=dt(o.MODALITY_LUT,t)||{},m=dt(o.SOP_COMMON,t)||{},y=dt(o.CALIBRATION,t)||{},{rows:x,columns:C}=h;if(f){if($ue(h)){a.height=h.rows,a.width=h.columns;let D=a.getContext("2d").createImageData(h.columns,h.rows);i||(D={...D,data:new Uint8ClampedArray(3*h.columns*h.rows)}),JN(h,D.data,i),h.imageData=D,h.pixelData=D.data,h.pixelDataLength=D.data.length}else if(!i&&h.pixelDataLength===4*x*C){const E=new Uint8Array(h.pixelData.length/4*3);h.pixelData=Jue(h.pixelData,E),h.pixelDataLength=h.pixelData.length}const _=w5(h.pixelData);h.smallestPixelValue=_.min,h.largestPixelValue=_.max}const S=ls.createImageVoxelManager({scalarData:h.pixelData,width:h.columns,height:h.rows,numberOfComponents:h.samplesPerPixel}),T={imageId:t,dataType:h.pixelData.constructor.name,color:f,calibration:y,columnPixelSpacing:p.columnPixelSpacing,columns:h.columns,height:h.rows,preScale:h.preScale,intercept:w.rescaleIntercept?w.rescaleIntercept:0,slope:w.rescaleSlope?w.rescaleSlope:1,invert:h.photometricInterpretation==="MONOCHROME1",minPixelValue:h.smallestPixelValue,maxPixelValue:h.largestPixelValue,rowPixelSpacing:p.rowPixelSpacing,rows:h.rows,sizeInBytes:h.pixelData.byteLength,width:h.columns,windowCenter:v.windowCenter?v.windowCenter[0]:void 0,windowWidth:v.windowWidth?v.windowWidth[0]:void 0,voiLUTFunction:v.voiLUTFunction?v.voiLUTFunction:void 0,decodeTimeInMS:h.decodeTimeInMS,floatPixelData:void 0,imageFrame:h,voxelManager:S,rgba:f&&i,getPixelData:()=>h.pixelData,getCanvas:void 0,numberOfComponents:h.samplesPerPixel};if(T.color&&(T.getCanvas=function(){if(j9===t)return a;const _=T.columns,E=T.rows;a.height=E,a.width=_;const D=a.getContext("2d"),b=D.createImageData(_,E),I=h.pixelData;if(I.length===_*E*4)for(let R=0;R<I.length;R++)b.data[R]=I[R];else if(I.length===_*E*3){let R=0;for(let M=0;M<I.length;M+=3)b.data[R++]=I[M],b.data[R++]=I[M+1],b.data[R++]=I[M+2],b.data[R++]=255}return h.pixelData=b.data,h.pixelDataLength=b.data.length,h.imageData=b,D.putImageData(h.imageData,0,0),j9=t,a}),w.modalityLUTSequence&&w.modalityLUTSequence.length>0&&Xue(m.sopClassUID)&&(T.modalityLUT=w.modalityLUTSequence[0]),v.voiLUTSequence&&v.voiLUTSequence.length>0&&(T.voiLUT=v.voiLUTSequence[0]),T.color&&(T.windowWidth=256,T.windowCenter=128),T.windowCenter===void 0||T.windowWidth===void 0){const _=T.imageFrame.smallestPixelValue,E=T.imageFrame.largestPixelValue;T.windowWidth=E-_,T.windowCenter=(E+_)/2}u(T)},d)})}function Zue(t,e){t.decache=function(){const r=u1(e);gd.unload(r.url)}}function ek(t,e,r=0,n,i,o){const a=new Date().getTime(),s={cancelFn:void 0,promise:void 0};return s.promise=new Promise((c,l)=>{t.then(f=>{const u=q_(f,r),d=f.string("x00020010"),h=new Date().getTime(),g=x5(e,u,d,i);Zue(s,e),g.then(p=>{p=p,p.data=f,p.sharedCacheKey=n;const v=new Date().getTime();p.loadTimeInMS=h-a,p.totalTimeInMS=v-a,o!==void 0&&o.imageDoneCallback!==void 0&&o.imageDoneCallback(p),c(p)},function(p){l({error:p,dataSet:f})})},function(f){l({error:f})})}),s}function Que(t,e,r=0,n,i){const o=new Date().getTime();return{promise:new Promise((s,c)=>{const l=new Date().getTime();let f;try{const u=q_(t,r),d=t.string("x00020010");f=x5(e,u,d,i)}catch(u){c({error:u,dataSet:t});return}f.then(u=>{u=u,u.data=t,u.sharedCacheKey=n;const d=new Date().getTime();u.loadTimeInMS=l-o,u.totalTimeInMS=d-o,s(u)},c)}),cancelFn:void 0}}function tk(t){if(t==="dicomweb"||t==="wadouri")return m5;if(t==="dicomfile")return YN}function D2(t,e={}){const r=u1(t);e=Object.assign({},e),delete e.loader;const n=tk(r.scheme);if(gd.isLoaded(r.url)){const o=gd.get(r.url,n,t);return Que(o,t,r.pixelDataFrame,r.url,e)}const i=gd.load(r.url,n,t);return ek(i,t,r.frame,r.url,e)}function nk(){fd("dicomweb",D2),fd("wadouri",D2),fd("dicomfile",D2),th(K_)}const efe={getImagePixelModule:LN,getLUTs:RC,getModalityLUTOutputPixelRepresentation:AN,getNumberValues:fs,metaDataProvider:K_,metadataForDataset:jN},tfe={metaData:efe,dataSetCacheManager:gd,fileManager:HN,getEncapsulatedImageFrame:KN,getUncompressedImageFrame:XN,loadFileRequest:YN,loadImageFromPromise:ek,getLoaderForScheme:tk,getPixelData:q_,loadImage:D2,parseImageId:u1,unpackBinaryFrame:qN,register:nk};function Gt(t,e,r){return e=e||0,!t||!t.Value||Array.isArray(t.Value)&&t.Value.length<=e?r:t.Value[e]}function nfe(t,e,r){const n=Gt(t,e,r);if(n!==void 0)return parseFloat(String(n))}function En(t,e){const r=Gt(t,e);if(r!==void 0)return parseFloat(r)}function Hi(t,e){if(!t||!t.Value||!Array.isArray(t.Value)||e&&t.Value.length<e)return;const r=[];for(let n=0;n<t.Value.length;n++)r.push(parseFloat(t.Value[n]));return r}function rfe(t){const e=[];for(let r=0;r<=30;r+=2){let n=`x60${r.toString(16)}`;n.length===4&&(n=`x600${r.toString(16)}`);const i=Gt(t[`${n}3000`]);if(!i)continue;const o=[];for(let a=0;a<i.length;a++)for(let s=0;s<8;s++){const c=t.Value[i.dataOffset+a];o[a*8+s]=c>>s&1}e.push({rows:En(t[`${n}0010`]),columns:En(t[`${n}0011`]),type:Gt(t[`${n}0040`]),x:En(t[`${n}0050`],1)-1,y:En(t[`${n}0050`],0)-1,pixelData:o,description:Gt(t[`${n}0022`]),label:Gt(t[`${n}1500`]),roiArea:Gt(t[`${n}1301`]),roiMean:Gt(t[`${n}1302`]),roiStandardDeviation:Gt(t[`${n}1303`])})}return{overlays:e}}function C5(t){const e=t.indexOf(":");return t.substring(e+1)}function pd(t,e=!0){return t&&t.Value?t.Value[0]&&e?t.Value[0]:t.Value:t}function rk(t,e,r){const n=(e?Object.values(e[0]):[]).map(o=>o[0]).filter(o=>o!==void 0&&typeof o=="object"),i=(t?Object.values(t[r-1]):[]).map(o=>o.Value[0]).filter(o=>o!==void 0&&typeof o=="object");return{shared:n,perFrame:i}}function ik(t){let{52009230:e,52009229:r,"00280008":n,...i}=t;return e=pd(e,!1),r=pd(r,!1),n=pd(n),{PerFrameFunctionalGroupsSequence:e,SharedFunctionalGroupsSequence:r,NumberOfFrames:n,rest:i}}function ife(t,e){const{PerFrameFunctionalGroupsSequence:r,SharedFunctionalGroupsSequence:n,NumberOfFrames:i,rest:o}=ik(e);if(r||i>1){const{shared:a,perFrame:s}=rk(r,n,t),c=Object.assign(e,{frameNumber:t});return[...a,...s].forEach(l=>{Object.entries(l).forEach(([f,u])=>{c[f]=u})}),Object.assign(o,{"00280008":i},c)}return e}let d1=[],Yv={};function ok(t){const e=t.indexOf("/frames/")+8,r=t.slice(0,e),n=parseInt(t.slice(e),10);return{metadata:d1[`${r}1`],frame:n}}function ofe(t){const e=C5(t);return ok(e)}function afe(t){const e=Gt(t["00280008"]);return e&&e>1}function sfe(t,e){const r=C5(t);Object.defineProperty(e,"isMultiframe",{value:afe(e),enumerable:!1}),d1[r]=e}function cfe(t){const e=C5(t),r=d1[e];if(r&&!(r!=null&&r.isMultiframe))return r;const n=Yv[e];if(n)return n;const i=ok(e);if(!i||!i.metadata)return;const{metadata:o,frame:a}=i;if(o){const s=ife(a,o);return Yv[e]=s,s}}function lfe(t){const e=C5(t);d1[e]=void 0,Yv[e]=void 0}function ufe(){d1=[],Yv={}}const J_={add:sfe,get:cfe,remove:lfe,purge:ufe};function ak(t){return Gt(t["00080060"]).includes("NM")}function Z_(t,e){const r=pd(t["00080008"],!1);if(r)return r[e]}function ffe(t){let e;const r=Z_(t,2);if(r&&ch(r)){const n=pd(t["00540022"]);n&&(e=Hi(n["00200037"],6))}return e}function dfe(t){let e;const r=Z_(t,2);if(r&&ch(r)){const n=pd(t["00540022"]);n&&(e=Hi(n["00200032"],3))}return e}function H9(t){let e=Hi(t["00200037"],6);return!e&&ak(t)&&(e=ffe(t)),e}function K9(t){let e=Hi(t["00200032"],3);return!e&&ak(t)&&(e=dfe(t)),e}function ji(t,e){const r=Hi(t[e]);return r?r[0]:null}function hfe(t){var e;return(e=t==null?void 0:t.Value)!=null&&e.length?Array.isArray(t.Value)?t.Value:typeof t.Value=="object"?(console.warn("Warning: Value should be an array, but an object was found. Encapsulating the object in an array."),[t.Value]):[]:[]}function q9(t){const e=hfe(t["00186011"]);return!e||!e.length?null:e.map(n=>{const i=ji(n,"0018602C"),o=ji(n,"0018602E"),a=ji(n,"00186024"),s=ji(n,"00186026"),c=ji(n,"0018601A"),l=ji(n,"0018601E"),f=ji(n,"00186018"),u=ji(n,"0018601C"),d=ji(n,"00186020"),h=ji(n,"00186022"),g=ji(n,"0018602A"),p=ji(n,"00186028"),v=ji(n,"00186012"),w=ji(n,"00186014"),m=ji(n,"00186016"),y=ji(n,"00186030");return{regionLocationMinY0:c,regionLocationMaxY1:l,regionLocationMinX0:f,regionLocationMaxX1:u,referencePixelX0:d,referencePixelY0:h,physicalDeltaX:i,physicalDeltaY:o,physicalUnitsXDirection:a,physicalUnitsYDirection:s,referencePhysicalPixelValueY:g,referencePhysicalPixelValueX:p,regionSpatialFormat:v,regionDataType:w,regionFlags:m,transducerFrequency:y}})}function Q_(t,e){const{MetadataModules:r}=Da;if(t===r.MULTIFRAME){const{metadata:i,frame:o}=ofe(e);if(!i)return;const{PerFrameFunctionalGroupsSequence:a,SharedFunctionalGroupsSequence:s,NumberOfFrames:c}=ik(i);if(a||c>1){const{shared:l,perFrame:f}=rk(a,s,o);return{NumberOfFrames:c,PerFrameFunctionalInformation:f,SharedFunctionalInformation:l}}return{NumberOfFrames:c}}const n=J_.get(e);if(n){if(t===r.GENERAL_STUDY)return{studyDescription:Gt(n["00081030"]),studyDate:kr.parseDA(Gt(n["00080020"])),studyTime:kr.parseTM(Gt(n["00080030"],0,"")),accessionNumber:Gt(n["00080050"])};if(t===r.GENERAL_SERIES)return{modality:Gt(n["00080060"]),seriesInstanceUID:Gt(n["0020000E"]),seriesNumber:En(n["00200011"]),studyInstanceUID:Gt(n["0020000D"]),seriesDate:kr.parseDA(Gt(n["00080021"])),seriesTime:kr.parseTM(Gt(n["00080031"],0,"")),acquisitionDate:kr.parseDA(Gt(n["00080022"])),acquisitionTime:kr.parseTM(Gt(n["00080032"],0,""))};if(t===r.GENERAL_IMAGE)return{sopInstanceUID:Gt(n["00080018"]),instanceNumber:En(n["00200013"]),lossyImageCompression:Gt(n["00282110"]),lossyImageCompressionRatio:En(n["00282112"]),lossyImageCompressionMethod:Gt(n["00282114"])};if(t===r.PATIENT)return{patientID:Gt(n["00100020"]),patientName:Gt(n["00100010"])};if(t===r.PATIENT_STUDY)return{patientAge:En(n["00101010"]),patientSize:En(n["00101020"]),patientSex:Gt(n["00100040"]),patientWeight:En(n["00101030"])};if(t===r.NM_MULTIFRAME_GEOMETRY){const i=Gt(n["00080060"]),o=Z_(n,2);return{modality:i,imageType:Gt(n["00080008"]),imageSubType:o,imageOrientationPatient:H9(n),imagePositionPatient:K9(n),sliceThickness:En(n["00180050"]),spacingBetweenSlices:En(n["00180088"]),pixelSpacing:Hi(n["00280030"],2),numberOfFrames:En(n["00280008"]),isNMReconstructable:ch(o)&&i.includes("NM")}}if(t===r.IMAGE_PLANE){let i=H9(n),o=K9(n);const a=Hi(n["00280030"],2);let s=null,c=null,l=null,f=null,u=!1;return a?(c=a[0],s=a[1]):(u=!0,c=1,s=1),i?(l=[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])],f=[parseFloat(i[3]),parseFloat(i[4]),parseFloat(i[5])]):(l=[0,1,0],f=[0,0,-1],u=!0,i=[...l,...f]),o||(o=[0,0,0],u=!0),{frameOfReferenceUID:Gt(n["00200052"]),rows:En(n["00280010"]),columns:En(n["00280011"]),imageOrientationPatient:i,rowCosines:l,columnCosines:f,imagePositionPatient:o,sliceThickness:En(n["00180050"]),sliceLocation:En(n["00201041"]),pixelSpacing:a,rowPixelSpacing:c,columnPixelSpacing:s,usingDefaultValues:u}}if(t===r.ULTRASOUND_ENHANCED_REGION)return q9(n);if(t===r.CALIBRATION&&Gt(n["00080060"])==="US")return{sequenceOfUltrasoundRegions:q9(n)};if(t===r.IMAGE_URL)return gfe(e,n);if(t===r.CINE)return pfe(e,n);if(t===r.IMAGE_PIXEL)return{samplesPerPixel:En(n["00280002"]),photometricInterpretation:Gt(n["00280004"]),rows:En(n["00280010"]),columns:En(n["00280011"]),bitsAllocated:En(n["00280100"]),bitsStored:En(n["00280101"]),highBit:Gt(n["00280102"]),pixelRepresentation:En(n["00280103"]),planarConfiguration:En(n["00280006"]),pixelAspectRatio:Gt(n["00280034"]),smallestPixelValue:En(n["00280106"]),largestPixelValue:En(n["00280107"]),redPaletteColorLookupTableDescriptor:Hi(n["00281101"]),greenPaletteColorLookupTableDescriptor:Hi(n["00281102"]),bluePaletteColorLookupTableDescriptor:Hi(n["00281103"]),redPaletteColorLookupTableData:Hi(n["00281201"]),greenPaletteColorLookupTableData:Hi(n["00281202"]),bluePaletteColorLookupTableData:Hi(n["00281203"])};if(t===r.VOI_LUT)return{windowCenter:Hi(n["00281050"],1),windowWidth:Hi(n["00281051"],1),voiLUTFunction:Gt(n["00281056"])};if(t===r.MODALITY_LUT)return{rescaleIntercept:En(n["00281052"]),rescaleSlope:En(n["00281053"]),rescaleType:Gt(n["00281054"])};if(t===r.SOP_COMMON)return{sopClassUID:Gt(n["00080016"]),sopInstanceUID:Gt(n["00080018"])};if(t===r.PET_ISOTOPE){const i=Gt(n["00540016"]);return i===void 0?void 0:{radiopharmaceuticalInfo:{radiopharmaceuticalStartTime:kr.parseTM(Gt(i["00181072"],0,"")),radiopharmaceuticalStartDateTime:Gt(i["00181078"],0,""),radionuclideTotalDose:En(i["00181074"]),radionuclideHalfLife:En(i["00181075"])}}}if(t===r.OVERLAY_PLANE)return rfe(n);if(t==="transferSyntax")return sk(e,n);if(t===r.PET_SERIES)return{correctedImage:Gt(n["00280051"]),units:Gt(n["00541001"]),decayCorrection:Gt(n["00541102"])};if(t===r.PET_IMAGE)return{frameReferenceTime:En(n["00541300"]),actualFrameDuration:En(n["00181242"])};if(t==="instance")return zN(e,Q_,$N)}}function gfe(t,e){const{transferSyntaxUID:r}=sk(t,e),n=qA(r),i=t.substring(7),o=i.replace("/frames/","/thumbnail/");let a=i.replace("/frames/","/rendered/");return n&&(a=a.replace("/rendered/1","/rendered")),{isVideo:n,rendered:a,thumbnail:o}}function pfe(t,e){return{cineRate:Gt(e["00180040"]),numberOfFrames:En(e["00280008"])}}function sk(t,e){return{transferSyntaxUID:Gt(e["00020010"])||Gt(e["00083002"])}}function mfe(t,e,r={},n={}){const i=f1(),{retrieveOptions:o={},streamingData:a}=n,s=a.chunkSize||yfe(e,o,"chunkSize")||65536,c=f=>{if(typeof i.errorInterceptor=="function"){const u=new Error("request failed");i.errorInterceptor(u)}else console.warn("rangeRequest:Caught",f)};return new Promise(async(f,u)=>{const d=Object.assign({},r);Object.keys(d).forEach(function(h){(d[h]===null||d[h]===void 0)&&delete d[h]});try{a.encodedData||(a.chunkSize=s,a.rangesFetched=0);const h=wfe(a,o),{encodedData:g,responseHeaders:p}=await vfe(t,d,h,a),v=p.get("content-type"),{totalBytes:w}=a,m=w===g.byteLength,y=z_(v,g,{isPartial:!0}),x=$_(o,m||y.extractDone);f({...y,imageQualityStatus:x,percentComplete:y.extractDone?100:s*100/w})}catch(h){c(h),console.error(h),u(h)}})}async function vfe(t,e,r,n){r&&(e=Object.assign(e,{Range:`bytes=${r[0]}-${r[1]}`}));let{encodedData:i}=n;if(r[1]&&(i==null?void 0:i.byteLength)>r[1])return n;const o=await fetch(t,{headers:e,signal:void 0}),a=await o.arrayBuffer(),s=new Uint8Array(a),{status:c}=o;let l;i?(l=new Uint8Array(i.length+s.length),l.set(i,0),l.set(s,i.length),n.rangesFetched=1):(l=new Uint8Array(s.length),l.set(s,0),n.rangesFetched++),n.encodedData=i=l,n.responseHeaders=o.headers;const f=o.headers.get("Content-Range");return f?n.totalBytes=Number(f.split("/")[1]):c!==206||!r?n.totalBytes=i==null?void 0:i.byteLength:r[1]===""||(i==null?void 0:i.length)<r[1]?n.totalBytes=i.byteLength:n.totalBytes=Number.MAX_SAFE_INTEGER,n}function yfe(t,e,r){const n=e[r];if(typeof n!="function")return n;const i=J_.get(t);return n(i,t)}function wfe(t,e){const{totalBytes:r,encodedData:n,chunkSize:i=65536}=t,{rangeIndex:o=0}=e;return o===-1&&(!r||!n)?[0,""]:o===-1||(n==null?void 0:n.byteLength)>r-i?[(n==null?void 0:n.byteLength)||0,""]:[(n==null?void 0:n.byteLength)||0,i*(o+1)-1]}function e4(t,e,r="application/octet-stream",n){const{streamingData:i,retrieveOptions:o={}}=n||{},a={Accept:r};let s=o.urlArguments?`${t}${t.indexOf("?")===-1?"?":"&"}${o.urlArguments}`:t;if(o.framesPath&&(s=s.replace("/frames/",o.framesPath)),(i==null?void 0:i.url)!==s&&(n.streamingData={url:s}),o.rangeIndex!==void 0)return mfe(s,e,a,n);if(o.streaming)return VN(s,e,a,n);const c=m5(s,e,a),{xhr:l}=c;return c.then(function(f){const u=l.getResponseHeader("Content-Type")||"application/octet-stream",d=z_(u,new Uint8Array(f));return d.imageQualityStatus=$_(o,!0),d})}const{ProgressiveIterator:X9}=cn,{ImageQualityStatus:Y9}=Da,xfe=new Set(["3.2.840.10008.1.2.4.96","1.2.840.10008.1.2.4.202","1.2.840.10008.1.2.4.203"]);function Cfe(t){const e="1.2.840.10008.1.2";if(!t)return e;const r=t.split(";"),n={};r.forEach(o=>{const a=o.split("=");if(a.length!==2)return;const s=a[1].trim().replace(/"/g,"");n[a[0].trim()]=s});const i={"image/jpeg":"1.2.840.10008.1.2.4.50","image/x-dicom-rle":"1.2.840.10008.1.2.5","image/x-jls":"1.2.840.10008.1.2.4.80","image/jls":"1.2.840.10008.1.2.4.80","image/jll":"1.2.840.10008.1.2.4.70","image/jp2":"1.2.840.10008.1.2.4.90","image/jpx":"1.2.840.10008.1.2.4.92","image/jphc":"3.2.840.10008.1.2.4.96","image/jxl":"1.2.840.10008.1.2.4.140"};return n["transfer-syntax"]?n["transfer-syntax"]:t&&!Object.keys(n).length&&i[t]?i[t]:n.type&&i[n.type]?i[n.type]:i[t]?i[t]:e}function Sfe(){return sh}const Tfe="multipart/related; type=application/octet-stream; transfer-syntax=*";function ck(t,e={}){const r=Sfe(),n=new Date().getTime(),i=new X9("decompress");async function o(f,u,d){i.generate(async h=>{var v;const g=X9.as(e4(f,u,d,e));let p=10;for await(const w of g){const{pixelData:m,imageQualityStatus:y=Y9.FULL_RESOLUTION,percentComplete:x,done:C=!0,extractDone:S=!0}=w,T=Cfe(w.contentType);if(!S&&!xfe.has(T))continue;const _=w.decodeLevel??(y===Y9.FULL_RESOLUTION?0:_fe(x,(v=e.retrieveOptions)==null?void 0:v.decodeLevel));if(!(!C&&p<=_))try{const E={...e,decodeLevel:_},D=await x5(u,m,T,E),b=new Date().getTime();D.loadTimeInMS=b-n,D.transferSyntaxUID=T,D.imageQualityStatus=y,h.add(D,C),p=_}catch(E){if(S)throw console.warn("Couldn't decode",E),E}}})}const a=e.requestType||Wt.Interaction,s=e.additionalDetails||{imageId:t},c=e.priority===void 0?5:e.priority,l=t.substring(7);return r.addRequest(o.bind(this,l,t,Tfe),a,s,c),{promise:i.getDonePromise(),cancelFn:void 0}}function _fe(t,e=4){const r=t/100-.02;return r>1/4?Math.min(e,0):r>1/16?Math.min(e,1):r>1/64?Math.min(e,2):Math.min(e,3)}function lk(){fd("wadors",ck),th(Q_)}const Efe={getNumberString:nfe,getNumberValue:En,getNumberValues:Hi,getValue:Gt,metaDataProvider:Q_},Dfe={metaData:Efe,findIndexOfString:LC,getPixelData:e4,loadImage:ck,metaDataManager:J_,register:lk};function bfe(){lk(),nk()}const Ife=()=>new Worker(new URL("/dicm-viewer-test/assets/decodeImageFrameWorker-Cy_vKGpS.js",import.meta.url),{type:"module"});function Ofe(t={}){kN(t),bfe();const e=Kc(),r=(t==null?void 0:t.maxWebWorkers)||Mfe();e.registerWorker("dicomImageLoader",Ife,{maxWorkerInstances:r})}function Mfe(){return typeof navigator<"u"&&navigator.hardwareConcurrency?Math.max(1,Math.floor(navigator.hardwareConcurrency/2)):1}function Rfe(t,e){if(e=e||t.transferSyntax,t.bitsAllocated===8&&e==="1.2.840.10008.1.2.4.50"&&(t.samplesPerPixel===3||t.samplesPerPixel===4))return!0}const Pfe={IMPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2",EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1",DEFLATED_EXPLICIT_VR_LITTLE_ENDIAN:"1.2.840.10008.1.2.1.99",EXPLICIT_VR_BIG_ENDIAN:"1.2.840.10008.1.2.2",JPEG_BASELINE_PROCESS_1:"1.2.840.10008.1.2.4.50",JPEG_EXTENDED_PROCESS_2_4:"1.2.840.10008.1.2.4.51",JPEG_EXTENDED_PROCESSES_3_5:"1.2.840.10008.1.2.4.52",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_6_8:"1.2.840.10008.1.2.4.53",JPEG_SPECTRAL_SELECTION_NONHIERARCHICAL_PROCESSES_7_9:"1.2.840.10008.1.2.4.54",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_10_12:"1.2.840.10008.1.2.4.55",JPEG_FULL_PROGRESSION_NONHIERARCHICAL_PROCESSES_11_13:"1.2.840.10008.1.2.4.56",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_14:"1.2.840.10008.1.2.4.57",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_15:"1.2.840.10008.1.2.4.58",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_16_18:"1.2.840.10008.1.2.4.59",JPEG_EXTENDED_HIERARCHICAL_PROCESSES_17_19:"1.2.840.10008.1.2.4.60",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_20_22:"1.2.840.10008.1.2.4.61",JPEG_SPECTRAL_SELECTION_HIERARCHICAL_PROCESSES_21_23:"1.2.840.10008.1.2.4.62",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_24_26:"1.2.840.10008.1.2.4.63",JPEG_FULL_PROGRESSION_HIERARCHICAL_PROCESSES_25_27:"1.2.840.10008.1.2.4.64",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_28:"1.2.840.10008.1.2.4.65",JPEG_LOSSLESS_NONHIERARCHICAL_PROCESS_29:"1.2.840.10008.1.2.4.66",JPEG_LOSSLESS_NONHIERARCHICAL_FIRST_ORDER_PREDICTION_PROCESS_14:"1.2.840.10008.1.2.4.70",JPEG_LS_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.80",JPEG_LS_LOSSY_NEAR_LOSSLESS_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.81",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.90",JPEG_2000_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.91",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY:"1.2.840.10008.1.2.4.92",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.93",JPIP_REFERENCED:"1.2.840.10008.1.2.4.94",JPIP_REFERENCED_DEFLATE:"1.2.840.10008.1.2.4.95",MPEG2_MAIN_PROFILE_MAIN_LEVEL:"1.2.840.10008.1.2.4.100",MPEG4_AVC_H264_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.101",MPEG4_AVC_H264_BD_COMPATIBLE_HIGH_PROFILE_LEVEL_4_1:"1.2.840.10008.1.2.4.102",MPEG4_AVC_H264_HIGH_PROFILE_FOR_2D_VIDEO:"1.2.840.10008.1.2.4.103",MPEG4_AVC_H264_HIGH_PROFILE_FOR_3D_VIDEO:"1.2.840.10008.1.2.4.104",JPIP_LOSSLESS:"1.2.840.10008.1.2.4.96",JPIP_PART2_MULTICOMPONENT_IMAGE_COMPRESSION:"1.2.840.10008.1.2.4.97",RFC_2557_MIME_ENCAPSULATION:"1.2.840.10008.1.2.6.1",JPEG_XR_IMAGE_COMPRESSION:"1.2.840.10008.1.2.6.2",JPEG_2000_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.90R",JPEG_2000_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.91R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_LOSSLESS_ONLY_RETIRED:"1.2.840.10008.1.2.4.92R",JPEG_2000_PART_2_MULTICOMPONENT_IMAGE_COMPRESSION_RETIRED:"1.2.840.10008.1.2.4.93R"},Lfe=Object.freeze(Object.defineProperty({__proto__:null,transferSyntaxes:Pfe},Symbol.toStringTag,{value:"Module"}));function Afe(t,e){const{rows:r,columns:n,data:i}=t,{rows:o,columns:a,data:s}=e,c=[],l=[],f=[];for(let u=0;u<a;u++){const d=u*(n-1)/(a-1);c[u]=Math.floor(d),l[u]=Math.min(c[u]+1,n-1),f[u]=d-c[u]}for(let u=0;u<o;u++){const d=u*(r-1)/(o-1),h=Math.floor(d)*n,g=Math.min(h+n,(r-1)*n),p=d-Math.floor(d),v=1-p,w=u*a;for(let m=0;m<a;m++){const y=i[h+c[m]],x=i[h+l[m]],C=i[g+c[m]],S=i[g+l[m]],T=1-f[m];s[w+m]=(y*T+x*f[m])*v+(C*T+S*f[m])*p}}return s}function Nfe(t,e){const{rows:r,columns:n,pixelData:i,samplesPerPixel:o=1}=t,{rows:a,columns:s,pixelData:c}=e,l=[];for(let f=0;f<s;f++){const u=f*(n-1)/(s-1);l[f]=Math.floor(u)*o}for(let f=0;f<a;f++){const u=f*(r-1)/(a-1),d=Math.floor(u)*n*o,h=f*s;for(let g=0;g<s;g++)for(let p=0;p<o;p++)c[h+g+p]=i[d+l[g]+p]}return c}async function J9(t,e){let r=e.buffer,n=e.byteOffset;const i=e.length;return t.bitsAllocated===16?(n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2)):t.bitsAllocated===8||t.bitsAllocated===1?t.pixelData=e:t.bitsAllocated===32&&(n%2&&(r=r.slice(n),n=0),t.pixelData=new Float32Array(r,n,i/4)),t}function kfe(t){return(t&255)<<8|t>>8&255}async function Vfe(t,e){if(t.bitsAllocated===16){let r=e.buffer,n=e.byteOffset;const i=e.length;n%2&&(r=r.slice(n),n=0),t.pixelRepresentation===0?t.pixelData=new Uint16Array(r,n,i/2):t.pixelData=new Int16Array(r,n,i/2);for(let o=0;o<t.pixelData.length;o++)t.pixelData[o]=kfe(t.pixelData[o])}else t.bitsAllocated===8&&(t.pixelData=e);return t}async function Ffe(t,e){if(t.bitsAllocated===8)return t.planarConfiguration?Bfe(t,e):Ufe(t,e);if(t.bitsAllocated===16)return Gfe(t,e);throw new Error("unsupported pixel format for RLE")}function Ufe(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let f=0;f<l;++f){c=f;let u=o.getInt32((f+1)*4,!0),d=o.getInt32((f+2)*4,!0);d===0&&(d=r.length);const h=n*l;for(;u<d;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c+=t.samplesPerPixel;else if(g<=-1&&g>=-127){const p=a[u++];for(let v=0;v<-g+1&&c<h;++v)s[c]=p,c+=t.samplesPerPixel}}}return t.pixelData=new Uint8Array(i),t}function Bfe(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i);let c=0;const l=o.getInt32(0,!0);for(let f=0;f<l;++f){c=f*n;let u=o.getInt32((f+1)*4,!0),d=o.getInt32((f+2)*4,!0);d===0&&(d=r.length);const h=n*l;for(;u<d;){const g=a[u++];if(g>=0&&g<=127)for(let p=0;p<g+1&&c<h;++p)s[c]=a[u++],c++;else if(g<=-1&&g>=-127){const p=a[u++];for(let v=0;v<-g+1&&c<h;++v)s[c]=p,c++}}}return t.pixelData=new Uint8Array(i),t}function Gfe(t,e){const r=e,n=t.rows*t.columns,i=new ArrayBuffer(n*t.samplesPerPixel*2),o=new DataView(r.buffer,r.byteOffset),a=new Int8Array(r.buffer,r.byteOffset),s=new Int8Array(i),c=o.getInt32(0,!0);for(let l=0;l<c;++l){let f=0;const u=l===0?1:0;let d=o.getInt32((l+1)*4,!0),h=o.getInt32((l+2)*4,!0);for(h===0&&(h=r.length);d<h;){const g=a[d++];if(g>=0&&g<=127)for(let p=0;p<g+1&&f<n;++p)s[f*2+u]=a[d++],f++;else if(g<=-1&&g>=-127){const p=a[d++];for(let v=0;v<-g+1&&f<n;++v)s[f*2+u]=p,f++}}}return t.pixelRepresentation===0?t.pixelData=new Uint16Array(i):t.pixelData=new Int16Array(i),t}var uk={exports:{}};(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(V,B){a=V,s=B});var c=Object.assign({},o),l="./this.program",f=(V,B)=>{throw B},u=typeof window=="object",d=typeof importScripts=="function",h=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",g="";function p(V){return o.locateFile?o.locateFile(V,g):g+V}var v,w,m;if(h){var y=zs,x=zs;d?g=x.dirname(g)+"/":g=__dirname+"/",v=(V,B)=>(V=Ve(V)?new URL(V):x.normalize(V),y.readFileSync(V,B?void 0:"utf8")),m=V=>{var B=v(V,!0);return B.buffer||(B=new Uint8Array(B)),B},w=(V,B,Q)=>{V=Ve(V)?new URL(V):x.normalize(V),y.readFile(V,function(ce,he){ce?Q(ce):B(he.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(V){if(!(V instanceof Se))throw V}),process.on("unhandledRejection",function(V){throw V}),f=(V,B)=>{throw process.exitCode=V,B},o.inspect=function(){return"[Emscripten Module object]"}}else(u||d)&&(d?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g.indexOf("blob:")!==0?g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):g="",v=V=>{var B=new XMLHttpRequest;return B.open("GET",V,!1),B.send(null),B.responseText},d&&(m=V=>{var B=new XMLHttpRequest;return B.open("GET",V,!1),B.responseType="arraybuffer",B.send(null),new Uint8Array(B.response)}),w=(V,B,Q)=>{var ce=new XMLHttpRequest;ce.open("GET",V,!0),ce.responseType="arraybuffer",ce.onload=()=>{if(ce.status==200||ce.status==0&&ce.response){B(ce.response);return}Q()},ce.onerror=Q,ce.send(null)});var C=o.print||console.log.bind(console),S=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&(l=o.thisProgram),o.quit&&(f=o.quit);var T;o.wasmBinary&&(T=o.wasmBinary);var _=o.noExitRuntime||!0;typeof WebAssembly!="object"&&ve("no native wasm support detected");var E,D=!1;function b(V,B){V||ve(B)}var I=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function R(V,B,Q){for(var ce=B+Q,he=B;V[he]&&!(he>=ce);)++he;if(he-B>16&&V.buffer&&I)return I.decode(V.subarray(B,he));for(var be="";B<he;){var Pe=V[B++];if(!(Pe&128)){be+=String.fromCharCode(Pe);continue}var Oe=V[B++]&63;if((Pe&224)==192){be+=String.fromCharCode((Pe&31)<<6|Oe);continue}var Ne=V[B++]&63;if((Pe&240)==224?Pe=(Pe&15)<<12|Oe<<6|Ne:Pe=(Pe&7)<<18|Oe<<12|Ne<<6|V[B++]&63,Pe<65536)be+=String.fromCharCode(Pe);else{var rt=Pe-65536;be+=String.fromCharCode(55296|rt>>10,56320|rt&1023)}}return be}function M(V,B){return V?R(N,V,B):""}function P(V,B,Q,ce){if(!(ce>0))return 0;for(var he=Q,be=Q+ce-1,Pe=0;Pe<V.length;++Pe){var Oe=V.charCodeAt(Pe);if(Oe>=55296&&Oe<=57343){var Ne=V.charCodeAt(++Pe);Oe=65536+((Oe&1023)<<10)|Ne&1023}if(Oe<=127){if(Q>=be)break;B[Q++]=Oe}else if(Oe<=2047){if(Q+1>=be)break;B[Q++]=192|Oe>>6,B[Q++]=128|Oe&63}else if(Oe<=65535){if(Q+2>=be)break;B[Q++]=224|Oe>>12,B[Q++]=128|Oe>>6&63,B[Q++]=128|Oe&63}else{if(Q+3>=be)break;B[Q++]=240|Oe>>18,B[Q++]=128|Oe>>12&63,B[Q++]=128|Oe>>6&63,B[Q++]=128|Oe&63}}return B[Q]=0,Q-he}function k(V,B,Q){return P(V,N,B,Q)}function z(V){for(var B=0,Q=0;Q<V.length;++Q){var ce=V.charCodeAt(Q);ce<=127?B++:ce<=2047?B+=2:ce>=55296&&ce<=57343?(B+=4,++Q):B+=3}return B}var A,L,N,H,ee,oe,de,ue,me;function Ee(V){A=V,o.HEAP8=L=new Int8Array(V),o.HEAP16=H=new Int16Array(V),o.HEAP32=oe=new Int32Array(V),o.HEAPU8=N=new Uint8Array(V),o.HEAPU16=ee=new Uint16Array(V),o.HEAPU32=de=new Uint32Array(V),o.HEAPF32=ue=new Float32Array(V),o.HEAPF64=me=new Float64Array(V)}o.INITIAL_MEMORY;var _e,Ce=[],F=[],O=[];function $(){return _}function W(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)ne(o.preRun.shift());Ge(Ce)}function X(){Ge(F)}function Z(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)Ie(o.postRun.shift());Ge(O)}function ne(V){Ce.unshift(V)}function xe(V){F.unshift(V)}function Ie(V){O.unshift(V)}var Le=0,je=null;function ie(V){Le++,o.monitorRunDependencies&&o.monitorRunDependencies(Le)}function ae(V){if(Le--,o.monitorRunDependencies&&o.monitorRunDependencies(Le),Le==0&&je){var B=je;je=null,B()}}function ve(V){o.onAbort&&o.onAbort(V),V="Aborted("+V+")",S(V),D=!0,V+=". Build with -sASSERTIONS for more info.";var B=new WebAssembly.RuntimeError(V);throw s(B),B}var se="data:application/octet-stream;base64,";function ge(V){return V.startsWith(se)}function Ve(V){return V.startsWith("file://")}var re;re="libjpegturbowasm_decode.wasm",ge(re)||(re=p(re));function it(V){try{if(V==re&&T)return new Uint8Array(T);if(m)return m(V);throw"both async and sync fetching of the wasm failed"}catch(B){ve(B)}}function ut(){if(!T&&(u||d)){if(typeof fetch=="function"&&!Ve(re))return fetch(re,{credentials:"same-origin"}).then(function(V){if(!V.ok)throw"failed to load wasm binary file at '"+re+"'";return V.arrayBuffer()}).catch(function(){return it(re)});if(w)return new Promise(function(V,B){w(re,function(Q){V(new Uint8Array(Q))},B)})}return Promise.resolve().then(function(){return it(re)})}function ot(){var V={a:ft};function B(Pe,Oe){var Ne=Pe.exports;o.asm=Ne,E=o.asm.K,Ee(E.buffer),_e=o.asm.M,xe(o.asm.L),ae()}ie();function Q(Pe){B(Pe.instance)}function ce(Pe){return ut().then(function(Oe){return WebAssembly.instantiate(Oe,V)}).then(function(Oe){return Oe}).then(Pe,function(Oe){S("failed to asynchronously prepare wasm: "+Oe),ve(Oe)})}function he(){return!T&&typeof WebAssembly.instantiateStreaming=="function"&&!ge(re)&&!Ve(re)&&!h&&typeof fetch=="function"?fetch(re,{credentials:"same-origin"}).then(function(Pe){var Oe=WebAssembly.instantiateStreaming(Pe,V);return Oe.then(Q,function(Ne){return S("wasm streaming compile failed: "+Ne),S("falling back to ArrayBuffer instantiation"),ce(Q)})}):ce(Q)}if(o.instantiateWasm)try{var be=o.instantiateWasm(V,B);return be}catch(Pe){S("Module.instantiateWasm callback failed with error: "+Pe),s(Pe)}return he().catch(s),{}}function Se(V){this.name="ExitStatus",this.message="Program terminated with exit("+V+")",this.status=V}function Ge(V){for(;V.length>0;)V.shift()(o)}function et(V){this.excPtr=V,this.ptr=V-24,this.set_type=function(B){de[this.ptr+4>>2]=B},this.get_type=function(){return de[this.ptr+4>>2]},this.set_destructor=function(B){de[this.ptr+8>>2]=B},this.get_destructor=function(){return de[this.ptr+8>>2]},this.set_refcount=function(B){oe[this.ptr>>2]=B},this.set_caught=function(B){B=B?1:0,L[this.ptr+12>>0]=B},this.get_caught=function(){return L[this.ptr+12>>0]!=0},this.set_rethrown=function(B){B=B?1:0,L[this.ptr+13>>0]=B},this.get_rethrown=function(){return L[this.ptr+13>>0]!=0},this.init=function(B,Q){this.set_adjusted_ptr(0),this.set_type(B),this.set_destructor(Q),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var B=oe[this.ptr>>2];oe[this.ptr>>2]=B+1},this.release_ref=function(){var B=oe[this.ptr>>2];return oe[this.ptr>>2]=B-1,B===1},this.set_adjusted_ptr=function(B){de[this.ptr+16>>2]=B},this.get_adjusted_ptr=function(){return de[this.ptr+16>>2]},this.get_exception_ptr=function(){var B=Fe(this.get_type());if(B)return de[this.excPtr>>2];var Q=this.get_adjusted_ptr();return Q!==0?Q:this.excPtr}}function qe(V,B,Q){var ce=new et(V);throw ce.init(B,Q),V}var st={};function Et(V){for(;V.length;){var B=V.pop(),Q=V.pop();Q(B)}}function ct(V){return this.fromWireType(oe[V>>2])}var bt={},It={},ln={},Pn=48,zt=57;function Tn(V){if(V===void 0)return"_unknown";V=V.replace(/[^a-zA-Z0-9_]/g,"$");var B=V.charCodeAt(0);return B>=Pn&&B<=zt?"_"+V:V}function ui(V,B){return V=Tn(V),new Function("body","return function "+V+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(B)}function Ur(V,B){var Q=ui(B,function(ce){this.name=B,this.message=ce;var he=new Error(ce).stack;he!==void 0&&(this.stack=this.toString()+`
`+he.replace(/^Error(:[^\n]*)?\n/,""))});return Q.prototype=Object.create(V.prototype),Q.prototype.constructor=Q,Q.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},Q}var Ue=void 0;function nt(V){throw new Ue(V)}function Mt(V,B,Q){V.forEach(function(Oe){ln[Oe]=B});function ce(Oe){var Ne=Q(Oe);Ne.length!==V.length&&nt("Mismatched type converter count");for(var rt=0;rt<V.length;++rt)Ci(V[rt],Ne[rt])}var he=new Array(B.length),be=[],Pe=0;B.forEach((Oe,Ne)=>{It.hasOwnProperty(Oe)?he[Ne]=It[Oe]:(be.push(Oe),bt.hasOwnProperty(Oe)||(bt[Oe]=[]),bt[Oe].push(()=>{he[Ne]=It[Oe],++Pe,Pe===be.length&&ce(he)}))}),be.length===0&&ce(he)}function pn(V){var B=st[V];delete st[V];var Q=B.rawConstructor,ce=B.rawDestructor,he=B.fields,be=he.map(Pe=>Pe.getterReturnType).concat(he.map(Pe=>Pe.setterArgumentType));Mt([V],be,Pe=>{var Oe={};return he.forEach((Ne,rt)=>{var lt=Ne.fieldName,mt=Pe[rt],Rt=Ne.getter,Ln=Ne.getterContext,un=Pe[rt+he.length],Mn=Ne.setter,Ti=Ne.setterContext;Oe[lt]={read:No=>mt.fromWireType(Rt(Ln,No)),write:(No,vl)=>{var oa=[];Mn(Ti,No,un.toWireType(oa,vl)),Et(oa)}}}),[{name:B.name,fromWireType:function(Ne){var rt={};for(var lt in Oe)rt[lt]=Oe[lt].read(Ne);return ce(Ne),rt},toWireType:function(Ne,rt){for(var lt in Oe)if(!(lt in rt))throw new TypeError('Missing field:  "'+lt+'"');var mt=Q();for(lt in Oe)Oe[lt].write(mt,rt[lt]);return Ne!==null&&Ne.push(ce,mt),mt},argPackAdvance:8,readValueFromPointer:ct,destructorFunction:ce}]})}function ni(V,B,Q,ce,he){}function Ot(V){switch(V){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+V)}}function Pr(){for(var V=new Array(256),B=0;B<256;++B)V[B]=String.fromCharCode(B);Qt=V}var Qt=void 0;function On(V){for(var B="",Q=V;N[Q];)B+=Qt[N[Q++]];return B}var fi=void 0;function en(V){throw new fi(V)}function Ci(V,B,Q={}){if(!("argPackAdvance"in B))throw new TypeError("registerType registeredInstance requires argPackAdvance");var ce=B.name;if(V||en('type "'+ce+'" must have a positive integer typeid pointer'),It.hasOwnProperty(V)){if(Q.ignoreDuplicateRegistrations)return;en("Cannot register type '"+ce+"' twice")}if(It[V]=B,delete ln[V],bt.hasOwnProperty(V)){var he=bt[V];delete bt[V],he.forEach(be=>be())}}function Zo(V,B,Q,ce,he){var be=Ot(Q);B=On(B),Ci(V,{name:B,fromWireType:function(Pe){return!!Pe},toWireType:function(Pe,Oe){return Oe?ce:he},argPackAdvance:8,readValueFromPointer:function(Pe){var Oe;if(Q===1)Oe=L;else if(Q===2)Oe=H;else if(Q===4)Oe=oe;else throw new TypeError("Unknown boolean type size: "+B);return this.fromWireType(Oe[Pe>>be])},destructorFunction:null})}function tc(V){if(!(this instanceof yo)||!(V instanceof yo))return!1;for(var B=this.$$.ptrType.registeredClass,Q=this.$$.ptr,ce=V.$$.ptrType.registeredClass,he=V.$$.ptr;B.baseClass;)Q=B.upcast(Q),B=B.baseClass;for(;ce.baseClass;)he=ce.upcast(he),ce=ce.baseClass;return B===ce&&Q===he}function ms(V){return{count:V.count,deleteScheduled:V.deleteScheduled,preservePointerOnDelete:V.preservePointerOnDelete,ptr:V.ptr,ptrType:V.ptrType,smartPtr:V.smartPtr,smartPtrType:V.smartPtrType}}function dr(V){function B(Q){return Q.$$.ptrType.registeredClass.name}en(B(V)+" instance already deleted")}var ki=!1;function tn(V){}function Vi(V){V.smartPtr?V.smartPtrType.rawDestructor(V.smartPtr):V.ptrType.registeredClass.rawDestructor(V.ptr)}function Qo(V){V.count.value-=1;var B=V.count.value===0;B&&Vi(V)}function vs(V,B,Q){if(B===Q)return V;if(Q.baseClass===void 0)return null;var ce=vs(V,B,Q.baseClass);return ce===null?null:Q.downcast(ce)}var Fi={};function Oa(){return Object.keys(di).length}function Lo(){var V=[];for(var B in di)di.hasOwnProperty(B)&&V.push(di[B]);return V}var Ui=[];function nc(){for(;Ui.length;){var V=Ui.pop();V.$$.deleteScheduled=!1,V.delete()}}var Bi=void 0;function Ma(V){Bi=V,Ui.length&&Bi&&Bi(nc)}function Zc(){o.getInheritedInstanceCount=Oa,o.getLiveInheritedInstances=Lo,o.flushPendingDeletes=nc,o.setDelayFunction=Ma}var di={};function bu(V,B){for(B===void 0&&en("ptr should not be undefined");V.baseClass;)B=V.upcast(B),V=V.baseClass;return B}function no(V,B){return B=bu(V,B),di[B]}function ea(V,B){(!B.ptrType||!B.ptr)&&nt("makeClassHandle requires ptr and ptrType");var Q=!!B.smartPtrType,ce=!!B.smartPtr;return Q!==ce&&nt("Both smartPtrType and smartPtr must be specified"),B.count={value:1},Pa(Object.create(V,{$$:{value:B}}))}function Ra(V){var B=this.getPointee(V);if(!B)return this.destructor(V),null;var Q=no(this.registeredClass,B);if(Q!==void 0){if(Q.$$.count.value===0)return Q.$$.ptr=B,Q.$$.smartPtr=V,Q.clone();var ce=Q.clone();return this.destructor(V),ce}function he(){return this.isSmartPointer?ea(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:B,smartPtrType:this,smartPtr:V}):ea(this.registeredClass.instancePrototype,{ptrType:this,ptr:V})}var be=this.registeredClass.getActualType(B),Pe=Fi[be];if(!Pe)return he.call(this);var Oe;this.isConst?Oe=Pe.constPointerType:Oe=Pe.pointerType;var Ne=vs(B,this.registeredClass,Oe.registeredClass);return Ne===null?he.call(this):this.isSmartPointer?ea(Oe.registeredClass.instancePrototype,{ptrType:Oe,ptr:Ne,smartPtrType:this,smartPtr:V}):ea(Oe.registeredClass.instancePrototype,{ptrType:Oe,ptr:Ne})}function Pa(V){return typeof FinalizationRegistry>"u"?(Pa=B=>B,V):(ki=new FinalizationRegistry(B=>{Qo(B.$$)}),Pa=B=>{var Q=B.$$,ce=!!Q.smartPtr;if(ce){var he={$$:Q};ki.register(B,he,B)}return B},tn=B=>ki.unregister(B),Pa(V))}function vo(){if(this.$$.ptr||dr(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var V=Pa(Object.create(Object.getPrototypeOf(this),{$$:{value:ms(this.$$)}}));return V.$$.count.value+=1,V.$$.deleteScheduled=!1,V}function ta(){this.$$.ptr||dr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&en("Object already scheduled for deletion"),tn(this),Qo(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ro(){return!this.$$.ptr}function Qc(){return this.$$.ptr||dr(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&en("Object already scheduled for deletion"),Ui.push(this),Ui.length===1&&Bi&&Bi(nc),this.$$.deleteScheduled=!0,this}function na(){yo.prototype.isAliasOf=tc,yo.prototype.clone=vo,yo.prototype.delete=ta,yo.prototype.isDeleted=ro,yo.prototype.deleteLater=Qc}function yo(){}function wo(V,B,Q){if(V[B].overloadTable===void 0){var ce=V[B];V[B]=function(){return V[B].overloadTable.hasOwnProperty(arguments.length)||en("Function '"+Q+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+V[B].overloadTable+")!"),V[B].overloadTable[arguments.length].apply(this,arguments)},V[B].overloadTable=[],V[B].overloadTable[ce.argCount]=ce}}function Iu(V,B,Q){o.hasOwnProperty(V)?(en("Cannot register public name '"+V+"' twice"),wo(o,V,V),o.hasOwnProperty(Q)&&en("Cannot register multiple overloads of a function with the same number of arguments ("+Q+")!"),o[V].overloadTable[Q]=B):o[V]=B}function Ou(V,B,Q,ce,he,be,Pe,Oe){this.name=V,this.constructor=B,this.instancePrototype=Q,this.rawDestructor=ce,this.baseClass=he,this.getActualType=be,this.upcast=Pe,this.downcast=Oe,this.pureVirtualFunctions=[]}function rc(V,B,Q){for(;B!==Q;)B.upcast||en("Expected null or instance of "+Q.name+", got an instance of "+B.name),V=B.upcast(V),B=B.baseClass;return V}function Mu(V,B){if(B===null)return this.isReference&&en("null is not a valid "+this.name),0;B.$$||en('Cannot pass "'+sc(B)+'" as a '+this.name),B.$$.ptr||en("Cannot pass deleted object as a pointer of type "+this.name);var Q=B.$$.ptrType.registeredClass,ce=rc(B.$$.ptr,Q,this.registeredClass);return ce}function Ru(V,B){var Q;if(B===null)return this.isReference&&en("null is not a valid "+this.name),this.isSmartPointer?(Q=this.rawConstructor(),V!==null&&V.push(this.rawDestructor,Q),Q):0;B.$$||en('Cannot pass "'+sc(B)+'" as a '+this.name),B.$$.ptr||en("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&B.$$.ptrType.isConst&&en("Cannot convert argument of type "+(B.$$.smartPtrType?B.$$.smartPtrType.name:B.$$.ptrType.name)+" to parameter type "+this.name);var ce=B.$$.ptrType.registeredClass;if(Q=rc(B.$$.ptr,ce,this.registeredClass),this.isSmartPointer)switch(B.$$.smartPtr===void 0&&en("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:B.$$.smartPtrType===this?Q=B.$$.smartPtr:en("Cannot convert argument of type "+(B.$$.smartPtrType?B.$$.smartPtrType.name:B.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:Q=B.$$.smartPtr;break;case 2:if(B.$$.smartPtrType===this)Q=B.$$.smartPtr;else{var he=B.clone();Q=this.rawShare(Q,gr.toHandle(function(){he.delete()})),V!==null&&V.push(this.rawDestructor,Q)}break;default:en("Unsupporting sharing policy")}return Q}function Lr(V,B){if(B===null)return this.isReference&&en("null is not a valid "+this.name),0;B.$$||en('Cannot pass "'+sc(B)+'" as a '+this.name),B.$$.ptr||en("Cannot pass deleted object as a pointer of type "+this.name),B.$$.ptrType.isConst&&en("Cannot convert argument of type "+B.$$.ptrType.name+" to parameter type "+this.name);var Q=B.$$.ptrType.registeredClass,ce=rc(B.$$.ptr,Q,this.registeredClass);return ce}function ic(V){return this.rawGetPointee&&(V=this.rawGetPointee(V)),V}function Gi(V){this.rawDestructor&&this.rawDestructor(V)}function ys(V){V!==null&&V.delete()}function ws(){hi.prototype.getPointee=ic,hi.prototype.destructor=Gi,hi.prototype.argPackAdvance=8,hi.prototype.readValueFromPointer=ct,hi.prototype.deleteObject=ys,hi.prototype.fromWireType=Ra}function hi(V,B,Q,ce,he,be,Pe,Oe,Ne,rt,lt){this.name=V,this.registeredClass=B,this.isReference=Q,this.isConst=ce,this.isSmartPointer=he,this.pointeeType=be,this.sharingPolicy=Pe,this.rawGetPointee=Oe,this.rawConstructor=Ne,this.rawShare=rt,this.rawDestructor=lt,!he&&B.baseClass===void 0?ce?(this.toWireType=Mu,this.destructorFunction=null):(this.toWireType=Lr,this.destructorFunction=null):this.toWireType=Ru}function el(V,B,Q){o.hasOwnProperty(V)||nt("Replacing nonexistant public symbol"),o[V].overloadTable!==void 0&&Q!==void 0||(o[V]=B,o[V].argCount=Q)}function Si(V,B,Q){var ce=o["dynCall_"+V];return Q&&Q.length?ce.apply(null,[B].concat(Q)):ce.call(null,B)}var La=[];function Cr(V){var B=La[V];return B||(V>=La.length&&(La.length=V+1),La[V]=B=_e.get(V)),B}function Aa(V,B,Q){if(V.includes("j"))return Si(V,B,Q);var ce=Cr(B).apply(null,Q);return ce}function tl(V,B){var Q=[];return function(){return Q.length=0,Object.assign(Q,arguments),Aa(V,B,Q)}}function jn(V,B){V=On(V);function Q(){return V.includes("j")?tl(V,B):Cr(B)}var ce=Q();return typeof ce!="function"&&en("unknown function pointer with signature "+V+": "+B),ce}var oc=void 0;function Na(V){var B=Bt(V),Q=On(B);return Dt(B),Q}function ac(V,B){var Q=[],ce={};function he(be){if(!ce[be]&&!It[be]){if(ln[be]){ln[be].forEach(he);return}Q.push(be),ce[be]=!0}}throw B.forEach(he),new oc(V+": "+Q.map(Na).join([", "]))}function nl(V,B,Q,ce,he,be,Pe,Oe,Ne,rt,lt,mt,Rt){lt=On(lt),be=jn(he,be),Oe&&(Oe=jn(Pe,Oe)),rt&&(rt=jn(Ne,rt)),Rt=jn(mt,Rt);var Ln=Tn(lt);Iu(Ln,function(){ac("Cannot construct "+lt+" due to unbound types",[ce])}),Mt([V,B,Q],ce?[ce]:[],function(un){un=un[0];var Mn,Ti;ce?(Mn=un.registeredClass,Ti=Mn.instancePrototype):Ti=yo.prototype;var No=ui(Ln,function(){if(Object.getPrototypeOf(this)!==vl)throw new fi("Use 'new' to construct "+lt);if(oa.constructor_body===void 0)throw new fi(lt+" has no accessible constructor");var _8=oa.constructor_body[arguments.length];if(_8===void 0)throw new fi("Tried to invoke ctor of "+lt+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(oa.constructor_body).toString()+") parameters instead!");return _8.apply(this,arguments)}),vl=Object.create(Ti,{constructor:{value:No}});No.prototype=vl;var oa=new Ou(lt,No,vl,Rt,Mn,be,Oe,rt),cW=new hi(lt,oa,!0,!1,!1),S8=new hi(lt+"*",oa,!1,!1,!1),T8=new hi(lt+" const*",oa,!1,!0,!1);return Fi[V]={pointerType:S8,constPointerType:T8},el(Ln,No),[cW,S8,T8]})}function Kr(V,B){for(var Q=[],ce=0;ce<V;ce++)Q.push(de[B+ce*4>>2]);return Q}function gi(V,B){if(!(V instanceof Function))throw new TypeError("new_ called with constructor type "+typeof V+" which is not a function");var Q=ui(V.name||"unknownFunctionName",function(){});Q.prototype=V.prototype;var ce=new Q,he=V.apply(ce,B);return he instanceof Object?he:ce}function ra(V,B,Q,ce,he){var be=B.length;be<2&&en("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Pe=B[1]!==null&&Q!==null,Oe=!1,Ne=1;Ne<B.length;++Ne)if(B[Ne]!==null&&B[Ne].destructorFunction===void 0){Oe=!0;break}for(var rt=B[0].name!=="void",lt="",mt="",Ne=0;Ne<be-2;++Ne)lt+=(Ne!==0?", ":"")+"arg"+Ne,mt+=(Ne!==0?", ":"")+"arg"+Ne+"Wired";var Rt="return function "+Tn(V)+"("+lt+`) {
if (arguments.length !== `+(be-2)+`) {
throwBindingError('function `+V+" called with ' + arguments.length + ' arguments, expected "+(be-2)+` args!');
}
`;Oe&&(Rt+=`var destructors = [];
`);var Ln=Oe?"destructors":"null",un=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],Mn=[en,ce,he,Et,B[0],B[1]];Pe&&(Rt+="var thisWired = classParam.toWireType("+Ln+`, this);
`);for(var Ne=0;Ne<be-2;++Ne)Rt+="var arg"+Ne+"Wired = argType"+Ne+".toWireType("+Ln+", arg"+Ne+"); // "+B[Ne+2].name+`
`,un.push("argType"+Ne),Mn.push(B[Ne+2]);if(Pe&&(mt="thisWired"+(mt.length>0?", ":"")+mt),Rt+=(rt?"var rv = ":"")+"invoker(fn"+(mt.length>0?", ":"")+mt+`);
`,Oe)Rt+=`runDestructors(destructors);
`;else for(var Ne=Pe?1:2;Ne<B.length;++Ne){var Ti=Ne===1?"thisWired":"arg"+(Ne-2)+"Wired";B[Ne].destructorFunction!==null&&(Rt+=Ti+"_dtor("+Ti+"); // "+B[Ne].name+`
`,un.push(Ti+"_dtor"),Mn.push(B[Ne].destructorFunction))}rt&&(Rt+=`var ret = retType.fromWireType(rv);
return ret;
`),Rt+=`}
`,un.push(Rt);var No=gi(Function,un).apply(null,Mn);return No}function qr(V,B,Q,ce,he,be){b(B>0);var Pe=Kr(B,Q);he=jn(ce,he),Mt([],[V],function(Oe){Oe=Oe[0];var Ne="constructor "+Oe.name;if(Oe.registeredClass.constructor_body===void 0&&(Oe.registeredClass.constructor_body=[]),Oe.registeredClass.constructor_body[B-1]!==void 0)throw new fi("Cannot register multiple constructors with identical number of parameters ("+(B-1)+") for class '"+Oe.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Oe.registeredClass.constructor_body[B-1]=()=>{ac("Cannot construct "+Oe.name+" due to unbound types",Pe)},Mt([],Pe,function(rt){return rt.splice(1,0,null),Oe.registeredClass.constructor_body[B-1]=ra(Ne,rt,null,he,be),[]}),[]})}function rl(V,B,Q,ce,he,be,Pe,Oe){var Ne=Kr(Q,ce);B=On(B),be=jn(he,be),Mt([],[V],function(rt){rt=rt[0];var lt=rt.name+"."+B;B.startsWith("@@")&&(B=Symbol[B.substring(2)]),Oe&&rt.registeredClass.pureVirtualFunctions.push(B);function mt(){ac("Cannot call "+lt+" due to unbound types",Ne)}var Rt=rt.registeredClass.instancePrototype,Ln=Rt[B];return Ln===void 0||Ln.overloadTable===void 0&&Ln.className!==rt.name&&Ln.argCount===Q-2?(mt.argCount=Q-2,mt.className=rt.name,Rt[B]=mt):(wo(Rt,B,lt),Rt[B].overloadTable[Q-2]=mt),Mt([],Ne,function(un){var Mn=ra(lt,un,rt,be,Pe);return Rt[B].overloadTable===void 0?(Mn.argCount=Q-2,Rt[B]=Mn):Rt[B].overloadTable[Q-2]=Mn,[]}),[]})}var ka=[],hr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function xs(V){V>4&&--hr[V].refcount===0&&(hr[V]=void 0,ka.push(V))}function Wi(){for(var V=0,B=5;B<hr.length;++B)hr[B]!==void 0&&++V;return V}function Pu(){for(var V=5;V<hr.length;++V)if(hr[V]!==void 0)return hr[V];return null}function Va(){o.count_emval_handles=Wi,o.get_first_emval=Pu}var gr={toValue:V=>(V||en("Cannot use deleted val. handle = "+V),hr[V].value),toHandle:V=>{switch(V){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var B=ka.length?ka.pop():hr.length;return hr[B]={refcount:1,value:V},B}}}};function il(V,B){B=On(B),Ci(V,{name:B,fromWireType:function(Q){var ce=gr.toValue(Q);return xs(Q),ce},toWireType:function(Q,ce){return gr.toHandle(ce)},argPackAdvance:8,readValueFromPointer:ct,destructorFunction:null})}function sc(V){if(V===null)return"null";var B=typeof V;return B==="object"||B==="array"||B==="function"?V.toString():""+V}function Lu(V,B){switch(B){case 2:return function(Q){return this.fromWireType(ue[Q>>2])};case 3:return function(Q){return this.fromWireType(me[Q>>3])};default:throw new TypeError("Unknown float type: "+V)}}function Au(V,B,Q){var ce=Ot(Q);B=On(B),Ci(V,{name:B,fromWireType:function(he){return he},toWireType:function(he,be){return be},argPackAdvance:8,readValueFromPointer:Lu(B,ce),destructorFunction:null})}function Fa(V,B,Q){switch(B){case 0:return Q?function(he){return L[he]}:function(he){return N[he]};case 1:return Q?function(he){return H[he>>1]}:function(he){return ee[he>>1]};case 2:return Q?function(he){return oe[he>>2]}:function(he){return de[he>>2]};default:throw new TypeError("Unknown integer type: "+V)}}function ol(V,B,Q,ce,he){B=On(B);var be=Ot(Q),Pe=mt=>mt;if(ce===0){var Oe=32-8*Q;Pe=mt=>mt<<Oe>>>Oe}var Ne=B.includes("unsigned"),rt=(mt,Rt)=>{},lt;Ne?lt=function(mt,Rt){return rt(Rt,this.name),Rt>>>0}:lt=function(mt,Rt){return rt(Rt,this.name),Rt},Ci(V,{name:B,fromWireType:Pe,toWireType:lt,argPackAdvance:8,readValueFromPointer:Fa(B,be,ce!==0),destructorFunction:null})}function cc(V,B,Q){var ce=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],he=ce[B];function be(Pe){Pe=Pe>>2;var Oe=de,Ne=Oe[Pe],rt=Oe[Pe+1];return new he(A,rt,Ne)}Q=On(Q),Ci(V,{name:Q,fromWireType:be,argPackAdvance:8,readValueFromPointer:be},{ignoreDuplicateRegistrations:!0})}function Nu(V,B){B=On(B);var Q=B==="std::string";Ci(V,{name:B,fromWireType:function(ce){var he=de[ce>>2],be=ce+4,Pe;if(Q)for(var Oe=be,Ne=0;Ne<=he;++Ne){var rt=be+Ne;if(Ne==he||N[rt]==0){var lt=rt-Oe,mt=M(Oe,lt);Pe===void 0?Pe=mt:(Pe+="\0",Pe+=mt),Oe=rt+1}}else{for(var Rt=new Array(he),Ne=0;Ne<he;++Ne)Rt[Ne]=String.fromCharCode(N[be+Ne]);Pe=Rt.join("")}return Dt(ce),Pe},toWireType:function(ce,he){he instanceof ArrayBuffer&&(he=new Uint8Array(he));var be,Pe=typeof he=="string";Pe||he instanceof Uint8Array||he instanceof Uint8ClampedArray||he instanceof Int8Array||en("Cannot pass non-string to std::string"),Q&&Pe?be=z(he):be=he.length;var Oe=Ct(4+be+1),Ne=Oe+4;if(de[Oe>>2]=be,Q&&Pe)k(he,Ne,be+1);else if(Pe)for(var rt=0;rt<be;++rt){var lt=he.charCodeAt(rt);lt>255&&(Dt(Ne),en("String has UTF-16 code units that do not fit in 8 bits")),N[Ne+rt]=lt}else for(var rt=0;rt<be;++rt)N[Ne+rt]=he[rt];return ce!==null&&ce.push(Dt,Oe),Oe},argPackAdvance:8,readValueFromPointer:ct,destructorFunction:function(ce){Dt(ce)}})}var al=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ku(V,B){for(var Q=V,ce=Q>>1,he=ce+B/2;!(ce>=he)&&ee[ce];)++ce;if(Q=ce<<1,Q-V>32&&al)return al.decode(N.subarray(V,Q));for(var be="",Pe=0;!(Pe>=B/2);++Pe){var Oe=H[V+Pe*2>>1];if(Oe==0)break;be+=String.fromCharCode(Oe)}return be}function Vu(V,B,Q){if(Q===void 0&&(Q=2147483647),Q<2)return 0;Q-=2;for(var ce=B,he=Q<V.length*2?Q/2:V.length,be=0;be<he;++be){var Pe=V.charCodeAt(be);H[B>>1]=Pe,B+=2}return H[B>>1]=0,B-ce}function Fu(V){return V.length*2}function Uu(V,B){for(var Q=0,ce="";!(Q>=B/4);){var he=oe[V+Q*4>>2];if(he==0)break;if(++Q,he>=65536){var be=he-65536;ce+=String.fromCharCode(55296|be>>10,56320|be&1023)}else ce+=String.fromCharCode(he)}return ce}function Bu(V,B,Q){if(Q===void 0&&(Q=2147483647),Q<4)return 0;for(var ce=B,he=ce+Q-4,be=0;be<V.length;++be){var Pe=V.charCodeAt(be);if(Pe>=55296&&Pe<=57343){var Oe=V.charCodeAt(++be);Pe=65536+((Pe&1023)<<10)|Oe&1023}if(oe[B>>2]=Pe,B+=4,B+4>he)break}return oe[B>>2]=0,B-ce}function sl(V){for(var B=0,Q=0;Q<V.length;++Q){var ce=V.charCodeAt(Q);ce>=55296&&ce<=57343&&++Q,B+=4}return B}function Gu(V,B,Q){Q=On(Q);var ce,he,be,Pe,Oe;B===2?(ce=ku,he=Vu,Pe=Fu,be=()=>ee,Oe=1):B===4&&(ce=Uu,he=Bu,Pe=sl,be=()=>de,Oe=2),Ci(V,{name:Q,fromWireType:function(Ne){for(var rt=de[Ne>>2],lt=be(),mt,Rt=Ne+4,Ln=0;Ln<=rt;++Ln){var un=Ne+4+Ln*B;if(Ln==rt||lt[un>>Oe]==0){var Mn=un-Rt,Ti=ce(Rt,Mn);mt===void 0?mt=Ti:(mt+="\0",mt+=Ti),Rt=un+B}}return Dt(Ne),mt},toWireType:function(Ne,rt){typeof rt!="string"&&en("Cannot pass non-string to C++ string type "+Q);var lt=Pe(rt),mt=Ct(4+lt+B);return de[mt>>2]=lt>>Oe,he(rt,mt+4,lt+B),Ne!==null&&Ne.push(Dt,mt),mt},argPackAdvance:8,readValueFromPointer:ct,destructorFunction:function(Ne){Dt(Ne)}})}function Wu(V,B,Q,ce,he,be){st[V]={name:On(B),rawConstructor:jn(Q,ce),rawDestructor:jn(he,be),fields:[]}}function cl(V,B,Q,ce,he,be,Pe,Oe,Ne,rt){st[V].fields.push({fieldName:On(B),getterReturnType:Q,getter:jn(ce,he),getterContext:be,setterArgumentType:Pe,setter:jn(Oe,Ne),setterContext:rt})}function ll(V,B){B=On(B),Ci(V,{isVoid:!0,name:B,argPackAdvance:0,fromWireType:function(){},toWireType:function(Q,ce){}})}function zu(){throw 1/0}var ul={};function fl(V){var B=ul[V];return B===void 0?On(V):B}function lc(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function dl(V){return V===0?gr.toHandle(lc()):(V=fl(V),gr.toHandle(lc()[V]))}function $u(V){V>4&&(hr[V].refcount+=1)}function hl(V,B){var Q=It[V];return Q===void 0&&en(B+" has unknown type "+Na(V)),Q}function ju(V){for(var B="",Q=0;Q<V;++Q)B+=(Q!==0?", ":"")+"arg"+Q;for(var ce=()=>de,he="return function emval_allocator_"+V+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,Q=0;Q<V;++Q)he+="var argType"+Q+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+Q+`');
var arg`+Q+" = argType"+Q+`.readValueFromPointer(args);
args += argType`+Q+`['argPackAdvance'];
argTypes += 4;
`;return he+="var obj = new constructor("+B+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",he)(hl,o,gr.toHandle,ce)}var uc={};function Hu(V,B,Q,ce){V=gr.toValue(V);var he=uc[B];return he||(he=ju(B),uc[B]=he),he(V,Q,ce)}function Ku(V,B){V=hl(V,"_emval_take_value");var Q=V.readValueFromPointer(B);return gr.toHandle(Q)}function qu(){ve("")}function Xu(V,B,Q){N.copyWithin(V,B,B+Q)}function fc(){return 2147483648}function Yu(V){try{return E.grow(V-A.byteLength+65535>>>16),Ee(E.buffer),1}catch{}}function Ao(V){var B=N.length;V=V>>>0;var Q=fc();if(V>Q)return!1;let ce=(Ne,rt)=>Ne+(rt-Ne%rt)%rt;for(var he=1;he<=4;he*=2){var be=B*(1+.2/he);be=Math.min(be,V+100663296);var Pe=Math.min(Q,ce(Math.max(V,be),65536)),Oe=Yu(Pe);if(Oe)return!0}return!1}var Cs={};function io(){return l||"./this.program"}function ia(){if(!ia.strings){var V=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",B={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:V,_:io()};for(var Q in Cs)Cs[Q]===void 0?delete B[Q]:B[Q]=Cs[Q];var ce=[];for(var Q in B)ce.push(Q+"="+B[Q]);ia.strings=ce}return ia.strings}function gl(V,B,Q){for(var ce=0;ce<V.length;++ce)L[B++>>0]=V.charCodeAt(ce);L[B>>0]=0}function dc(V,B){var Q=0;return ia().forEach(function(ce,he){var be=B+Q;de[V+he*4>>2]=be,gl(ce,be),Q+=ce.length+1}),0}function pl(V,B){var Q=ia();de[V>>2]=Q.length;var ce=0;return Q.forEach(function(he){ce+=he.length+1}),de[B>>2]=ce,0}function Ss(V){$()||(o.onExit&&o.onExit(V),D=!0),f(V,new Se(V))}function ml(V,B){Ss(V)}var J=ml;function te(V){return 52}function pe(V,B,Q,ce,he){return 70}var Re=[null,[],[]];function Be(V,B){var Q=Re[V];B===0||B===10?((V===1?C:S)(R(Q,0)),Q.length=0):Q.push(B)}function Xe(V,B,Q,ce){for(var he=0,be=0;be<Q;be++){var Pe=de[B>>2],Oe=de[B+4>>2];B+=8;for(var Ne=0;Ne<Oe;Ne++)Be(V,N[Pe+Ne]);he+=Oe}return de[ce>>2]=he,0}function Ye(V){var B=o["_"+V];return B}function He(V,B){L.set(V,B)}function Ze(V,B,Q,ce,he){var be={string:un=>{var Mn=0;if(un!=null&&un!==0){var Ti=(un.length<<2)+1;Mn=De(Ti),k(un,Mn,Ti)}return Mn},array:un=>{var Mn=De(un.length);return He(un,Mn),Mn}};function Pe(un){return B==="string"?M(un):B==="boolean"?!!un:un}var Oe=Ye(V),Ne=[],rt=0;if(ce)for(var lt=0;lt<ce.length;lt++){var mt=be[Q[lt]];mt?(rt===0&&(rt=q()),Ne[lt]=mt(ce[lt])):Ne[lt]=ce[lt]}var Rt=Oe.apply(null,Ne);function Ln(un){return rt!==0&&fe(rt),Pe(un)}return Rt=Ln(Rt),Rt}Ue=o.InternalError=Ur(Error,"InternalError"),Pr(),fi=o.BindingError=Ur(Error,"BindingError"),na(),Zc(),ws(),oc=o.UnboundTypeError=Ur(Error,"UnboundTypeError"),Va();var ft={g:qe,A:pn,w:ni,F:Zo,u:nl,t:qr,c:rl,E:il,m:Au,b:ol,a:cc,l:Nu,h:Gu,J:Wu,d:cl,G:ll,x:zu,i:xs,r:dl,p:$u,q:Hu,s:Ku,j:qu,D:Xu,y:Ao,z:dc,B:pl,I:J,C:te,v:pe,k:Xe,o:Je,n:j,H:G,f:tt,e:Ke};ot(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.L).apply(null,arguments)};var Ct=o._malloc=function(){return(Ct=o._malloc=o.asm.N).apply(null,arguments)},Dt=o._free=function(){return(Dt=o._free=o.asm.O).apply(null,arguments)},Bt=o.___getTypeName=function(){return(Bt=o.___getTypeName=o.asm.P).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.Q).apply(null,arguments)};var Y=o._setThrew=function(){return(Y=o._setThrew=o.asm.R).apply(null,arguments)},q=o.stackSave=function(){return(q=o.stackSave=o.asm.S).apply(null,arguments)},fe=o.stackRestore=function(){return(fe=o.stackRestore=o.asm.T).apply(null,arguments)},De=o.stackAlloc=function(){return(De=o.stackAlloc=o.asm.U).apply(null,arguments)},Fe=o.___cxa_is_pointer_type=function(){return(Fe=o.___cxa_is_pointer_type=o.asm.V).apply(null,arguments)};o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.W).apply(null,arguments)};function tt(V,B){var Q=q();try{Cr(V)(B)}catch(ce){if(fe(Q),ce!==ce+0)throw ce;Y(1,0)}}function Je(V,B){var Q=q();try{return Cr(V)(B)}catch(ce){if(fe(Q),ce!==ce+0)throw ce;Y(1,0)}}function Ke(V,B,Q,ce){var he=q();try{Cr(V)(B,Q,ce)}catch(be){if(fe(he),be!==be+0)throw be;Y(1,0)}}function G(V,B,Q,ce){var he=q();try{return Cr(V)(B,Q,ce)}catch(be){if(fe(he),be!==be+0)throw be;Y(1,0)}}function j(V,B,Q){var ce=q();try{return Cr(V)(B,Q)}catch(he){if(fe(ce),he!==he+0)throw he;Y(1,0)}}o.ccall=Ze;var le;je=function V(){le||ye(),le||(je=V)};function ye(V){if(Le>0||(W(),Le>0))return;function B(){le||(le=!0,o.calledRun=!0,!D&&(X(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),Z()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),B()},1)):B()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return ye(),i.ready}})();t.exports=r})(uk);var Wfe=uk.exports;const zfe=Ys(Wfe),$fe=new URL("/dicm-viewer-test/assets/libjpegturbowasm_decode-daqMmuVl.wasm",import.meta.url),b2={codec:void 0,decoder:void 0};function jfe(){if(b2.codec)return Promise.resolve();const t=zfe({locateFile:e=>e.endsWith(".wasm")?$fe.toString():e});return new Promise((e,r)=>{t.then(n=>{b2.codec=n,b2.decoder=new n.JPEGDecoder,e()},r)})}async function Hfe(t,e){await jfe();const r=b2.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer(),a={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},s=Kfe(i,o),c={frameInfo:i};return{...e,pixelData:s,imageInfo:a,encodeOptions:c,...c,...a}}function Kfe(t,e){return t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}const qfe="modulepreload",Xfe=function(t){return"/dicm-viewer-test/"+t},Z9={},fk=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(r.map(s=>{if(s=Xfe(s),s in Z9)return;Z9[s]=!0;const c=s.endsWith(".css"),l=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${l}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":qfe,c||(f.as="script",f.crossOrigin=""),f.href=s,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((u,d)=>{f.addEventListener("load",u),f.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})}))}return i.then(()=>e()).catch(o=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o})},Og={JpegImage:void 0,decodeConfig:{}};function Yfe(t){return Og.decodeConfig=t,Og.JpegImage?Promise.resolve():new Promise((e,r)=>{fk(()=>import("./jpeg-HBGIxCW8.js"),[]).then(n=>{Og.JpegImage=n.default,e()}).catch(r)})}async function Jfe(t,e){if(await Yfe(),typeof Og.JpegImage>"u")throw new Error("No JPEG Baseline decoder loaded");const r=new Og.JpegImage;if(r.parse(e),r.colorTransform=!1,t.bitsAllocated===8)return t.pixelData=r.getData(t.columns,t.rows),t;if(t.bitsAllocated===16)return t.pixelData=r.getData16(t.columns,t.rows),t}const Mg={jpeg:void 0,decodeConfig:{}};function Zfe(t){return Mg.decodeConfig=t,Mg.jpeg?Promise.resolve():new Promise((e,r)=>{fk(async()=>{const{Decoder:n}=await import("./lossless-AbrneU6N.js");return{Decoder:n}},[]).then(({Decoder:n})=>{const i=new n;Mg.jpeg=i,e()},r)})}async function Q9(t,e){if(await Zfe(),typeof Mg.jpeg>"u")throw new Error("No JPEG Lossless decoder loaded");const r=t.bitsAllocated<=8?1:2,n=e.buffer,i=Mg.jpeg.decode(n,e.byteOffset,e.length,r);return t.pixelRepresentation===0?t.bitsAllocated===16?(t.pixelData=new Uint16Array(i.buffer),t):(t.pixelData=new Uint8Array(i.buffer),t):(t.pixelData=new Int16Array(i.buffer),t)}var dk={exports:{}};(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(J,te){a=J,s=te});var c=Object.assign({},o),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",d="";function h(J){return o.locateFile?o.locateFile(J,d):d+J}var g,p,v;if(u){var w=zs,m=zs;f?d=m.dirname(d)+"/":d=__dirname+"/",g=(J,te)=>(J=ie(J)?new URL(J):m.normalize(J),w.readFileSync(J,te?void 0:"utf8")),v=J=>{var te=g(J,!0);return te.buffer||(te=new Uint8Array(te)),te},p=(J,te,pe)=>{J=ie(J)?new URL(J):m.normalize(J),w.readFile(J,function(Re,Be){Re?pe(Re):te(Be.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(J){if(!(J instanceof Ve))throw J}),process.on("unhandledRejection",function(J){throw J}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),n&&(d=n),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",g=J=>{var te=new XMLHttpRequest;return te.open("GET",J,!1),te.send(null),te.responseText},f&&(v=J=>{var te=new XMLHttpRequest;return te.open("GET",J,!1),te.responseType="arraybuffer",te.send(null),new Uint8Array(te.response)}),p=(J,te,pe)=>{var Re=new XMLHttpRequest;Re.open("GET",J,!0),Re.responseType="arraybuffer",Re.onload=()=>{if(Re.status==200||Re.status==0&&Re.response){te(Re.response);return}pe()},Re.onerror=pe,Re.send(null)});o.print||console.log.bind(console);var y=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var x;o.wasmBinary&&(x=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&Ie("no native wasm support detected");var C,S=!1;function T(J,te){J||Ie(te)}var _=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(J,te,pe){for(var Re=te+pe,Be=te;J[Be]&&!(Be>=Re);)++Be;if(Be-te>16&&J.buffer&&_)return _.decode(J.subarray(te,Be));for(var Xe="";te<Be;){var Ye=J[te++];if(!(Ye&128)){Xe+=String.fromCharCode(Ye);continue}var He=J[te++]&63;if((Ye&224)==192){Xe+=String.fromCharCode((Ye&31)<<6|He);continue}var Ze=J[te++]&63;if((Ye&240)==224?Ye=(Ye&15)<<12|He<<6|Ze:Ye=(Ye&7)<<18|He<<12|Ze<<6|J[te++]&63,Ye<65536)Xe+=String.fromCharCode(Ye);else{var ft=Ye-65536;Xe+=String.fromCharCode(55296|ft>>10,56320|ft&1023)}}return Xe}function D(J,te){return J?E(k,J,te):""}function b(J,te,pe,Re){if(!(Re>0))return 0;for(var Be=pe,Xe=pe+Re-1,Ye=0;Ye<J.length;++Ye){var He=J.charCodeAt(Ye);if(He>=55296&&He<=57343){var Ze=J.charCodeAt(++Ye);He=65536+((He&1023)<<10)|Ze&1023}if(He<=127){if(pe>=Xe)break;te[pe++]=He}else if(He<=2047){if(pe+1>=Xe)break;te[pe++]=192|He>>6,te[pe++]=128|He&63}else if(He<=65535){if(pe+2>=Xe)break;te[pe++]=224|He>>12,te[pe++]=128|He>>6&63,te[pe++]=128|He&63}else{if(pe+3>=Xe)break;te[pe++]=240|He>>18,te[pe++]=128|He>>12&63,te[pe++]=128|He>>6&63,te[pe++]=128|He&63}}return te[pe]=0,pe-Be}function I(J,te,pe){return b(J,k,te,pe)}function R(J){for(var te=0,pe=0;pe<J.length;++pe){var Re=J.charCodeAt(pe);Re<=127?te++:Re<=2047?te+=2:Re>=55296&&Re<=57343?(te+=4,++pe):te+=3}return te}var M,P,k,z,A,L,N,H,ee;function oe(J){M=J,o.HEAP8=P=new Int8Array(J),o.HEAP16=z=new Int16Array(J),o.HEAP32=L=new Int32Array(J),o.HEAPU8=k=new Uint8Array(J),o.HEAPU16=A=new Uint16Array(J),o.HEAPU32=N=new Uint32Array(J),o.HEAPF32=H=new Float32Array(J),o.HEAPF64=ee=new Float64Array(J)}o.INITIAL_MEMORY;var de,ue=[],me=[],Ee=[];function _e(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)O(o.preRun.shift());re(ue)}function Ce(){re(me)}function F(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)W(o.postRun.shift());re(Ee)}function O(J){ue.unshift(J)}function $(J){me.unshift(J)}function W(J){Ee.unshift(J)}var X=0,Z=null;function ne(J){X++,o.monitorRunDependencies&&o.monitorRunDependencies(X)}function xe(J){if(X--,o.monitorRunDependencies&&o.monitorRunDependencies(X),X==0&&Z){var te=Z;Z=null,te()}}function Ie(J){o.onAbort&&o.onAbort(J),J="Aborted("+J+")",y(J),S=!0,J+=". Build with -sASSERTIONS for more info.";var te=new WebAssembly.RuntimeError(J);throw s(te),te}var Le="data:application/octet-stream;base64,";function je(J){return J.startsWith(Le)}function ie(J){return J.startsWith("file://")}var ae;ae="charlswasm_decode.wasm",je(ae)||(ae=h(ae));function ve(J){try{if(J==ae&&x)return new Uint8Array(x);if(v)return v(J);throw"both async and sync fetching of the wasm failed"}catch(te){Ie(te)}}function se(){if(!x&&(l||f)){if(typeof fetch=="function"&&!ie(ae))return fetch(ae,{credentials:"same-origin"}).then(function(J){if(!J.ok)throw"failed to load wasm binary file at '"+ae+"'";return J.arrayBuffer()}).catch(function(){return ve(ae)});if(p)return new Promise(function(J,te){p(ae,function(pe){J(new Uint8Array(pe))},te)})}return Promise.resolve().then(function(){return ve(ae)})}function ge(){var J={a:Yu};function te(Ye,He){var Ze=Ye.exports;o.asm=Ze,C=o.asm.z,oe(C.buffer),de=o.asm.C,$(o.asm.A),xe()}ne();function pe(Ye){te(Ye.instance)}function Re(Ye){return se().then(function(He){return WebAssembly.instantiate(He,J)}).then(function(He){return He}).then(Ye,function(He){y("failed to asynchronously prepare wasm: "+He),Ie(He)})}function Be(){return!x&&typeof WebAssembly.instantiateStreaming=="function"&&!je(ae)&&!ie(ae)&&!u&&typeof fetch=="function"?fetch(ae,{credentials:"same-origin"}).then(function(Ye){var He=WebAssembly.instantiateStreaming(Ye,J);return He.then(pe,function(Ze){return y("wasm streaming compile failed: "+Ze),y("falling back to ArrayBuffer instantiation"),Re(pe)})}):Re(pe)}if(o.instantiateWasm)try{var Xe=o.instantiateWasm(J,te);return Xe}catch(Ye){y("Module.instantiateWasm callback failed with error: "+Ye),s(Ye)}return Be().catch(s),{}}function Ve(J){this.name="ExitStatus",this.message="Program terminated with exit("+J+")",this.status=J}function re(J){for(;J.length>0;)J.shift()(o)}function it(J){this.excPtr=J,this.ptr=J-24,this.set_type=function(te){N[this.ptr+4>>2]=te},this.get_type=function(){return N[this.ptr+4>>2]},this.set_destructor=function(te){N[this.ptr+8>>2]=te},this.get_destructor=function(){return N[this.ptr+8>>2]},this.set_refcount=function(te){L[this.ptr>>2]=te},this.set_caught=function(te){te=te?1:0,P[this.ptr+12>>0]=te},this.get_caught=function(){return P[this.ptr+12>>0]!=0},this.set_rethrown=function(te){te=te?1:0,P[this.ptr+13>>0]=te},this.get_rethrown=function(){return P[this.ptr+13>>0]!=0},this.init=function(te,pe){this.set_adjusted_ptr(0),this.set_type(te),this.set_destructor(pe),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var te=L[this.ptr>>2];L[this.ptr>>2]=te+1},this.release_ref=function(){var te=L[this.ptr>>2];return L[this.ptr>>2]=te-1,te===1},this.set_adjusted_ptr=function(te){N[this.ptr+16>>2]=te},this.get_adjusted_ptr=function(){return N[this.ptr+16>>2]},this.get_exception_ptr=function(){var te=pl(this.get_type());if(te)return N[this.excPtr>>2];var pe=this.get_adjusted_ptr();return pe!==0?pe:this.excPtr}}function ut(J,te,pe){var Re=new it(J);throw Re.init(te,pe),J}var ot={};function Se(J){for(;J.length;){var te=J.pop(),pe=J.pop();pe(te)}}function Ge(J){return this.fromWireType(L[J>>2])}var et={},qe={},st={},Et=48,ct=57;function bt(J){if(J===void 0)return"_unknown";J=J.replace(/[^a-zA-Z0-9_]/g,"$");var te=J.charCodeAt(0);return te>=Et&&te<=ct?"_"+J:J}function It(J,te){return J=bt(J),new Function("body","return function "+J+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(te)}function ln(J,te){var pe=It(te,function(Re){this.name=te,this.message=Re;var Be=new Error(Re).stack;Be!==void 0&&(this.stack=this.toString()+`
`+Be.replace(/^Error(:[^\n]*)?\n/,""))});return pe.prototype=Object.create(J.prototype),pe.prototype.constructor=pe,pe.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},pe}var Pn=void 0;function zt(J){throw new Pn(J)}function Tn(J,te,pe){J.forEach(function(He){st[He]=te});function Re(He){var Ze=pe(He);Ze.length!==J.length&&zt("Mismatched type converter count");for(var ft=0;ft<J.length;++ft)Pr(J[ft],Ze[ft])}var Be=new Array(te.length),Xe=[],Ye=0;te.forEach((He,Ze)=>{qe.hasOwnProperty(He)?Be[Ze]=qe[He]:(Xe.push(He),et.hasOwnProperty(He)||(et[He]=[]),et[He].push(()=>{Be[Ze]=qe[He],++Ye,Ye===Xe.length&&Re(Be)}))}),Xe.length===0&&Re(Be)}function ui(J){var te=ot[J];delete ot[J];var pe=te.rawConstructor,Re=te.rawDestructor,Be=te.fields,Xe=Be.map(Ye=>Ye.getterReturnType).concat(Be.map(Ye=>Ye.setterArgumentType));Tn([J],Xe,Ye=>{var He={};return Be.forEach((Ze,ft)=>{var Ct=Ze.fieldName,Dt=Ye[ft],Bt=Ze.getter,Y=Ze.getterContext,q=Ye[ft+Be.length],fe=Ze.setter,De=Ze.setterContext;He[Ct]={read:Fe=>Dt.fromWireType(Bt(Y,Fe)),write:(Fe,tt)=>{var Je=[];fe(De,Fe,q.toWireType(Je,tt)),Se(Je)}}}),[{name:te.name,fromWireType:function(Ze){var ft={};for(var Ct in He)ft[Ct]=He[Ct].read(Ze);return Re(Ze),ft},toWireType:function(Ze,ft){for(var Ct in He)if(!(Ct in ft))throw new TypeError('Missing field:  "'+Ct+'"');var Dt=pe();for(Ct in He)He[Ct].write(Dt,ft[Ct]);return Ze!==null&&Ze.push(Re,Dt),Dt},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:Re}]})}function Ur(J,te,pe,Re,Be){}function Ue(J){switch(J){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+J)}}function nt(){for(var J=new Array(256),te=0;te<256;++te)J[te]=String.fromCharCode(te);Mt=J}var Mt=void 0;function pn(J){for(var te="",pe=J;k[pe];)te+=Mt[k[pe++]];return te}var ni=void 0;function Ot(J){throw new ni(J)}function Pr(J,te,pe={}){if(!("argPackAdvance"in te))throw new TypeError("registerType registeredInstance requires argPackAdvance");var Re=te.name;if(J||Ot('type "'+Re+'" must have a positive integer typeid pointer'),qe.hasOwnProperty(J)){if(pe.ignoreDuplicateRegistrations)return;Ot("Cannot register type '"+Re+"' twice")}if(qe[J]=te,delete st[J],et.hasOwnProperty(J)){var Be=et[J];delete et[J],Be.forEach(Xe=>Xe())}}function Qt(J,te,pe,Re,Be){var Xe=Ue(pe);te=pn(te),Pr(J,{name:te,fromWireType:function(Ye){return!!Ye},toWireType:function(Ye,He){return He?Re:Be},argPackAdvance:8,readValueFromPointer:function(Ye){var He;if(pe===1)He=P;else if(pe===2)He=z;else if(pe===4)He=L;else throw new TypeError("Unknown boolean type size: "+te);return this.fromWireType(He[Ye>>Xe])},destructorFunction:null})}function On(J){if(!(this instanceof vo)||!(J instanceof vo))return!1;for(var te=this.$$.ptrType.registeredClass,pe=this.$$.ptr,Re=J.$$.ptrType.registeredClass,Be=J.$$.ptr;te.baseClass;)pe=te.upcast(pe),te=te.baseClass;for(;Re.baseClass;)Be=Re.upcast(Be),Re=Re.baseClass;return te===Re&&pe===Be}function fi(J){return{count:J.count,deleteScheduled:J.deleteScheduled,preservePointerOnDelete:J.preservePointerOnDelete,ptr:J.ptr,ptrType:J.ptrType,smartPtr:J.smartPtr,smartPtrType:J.smartPtrType}}function en(J){function te(pe){return pe.$$.ptrType.registeredClass.name}Ot(te(J)+" instance already deleted")}var Ci=!1;function Zo(J){}function tc(J){J.smartPtr?J.smartPtrType.rawDestructor(J.smartPtr):J.ptrType.registeredClass.rawDestructor(J.ptr)}function ms(J){J.count.value-=1;var te=J.count.value===0;te&&tc(J)}function dr(J,te,pe){if(te===pe)return J;if(pe.baseClass===void 0)return null;var Re=dr(J,te,pe.baseClass);return Re===null?null:pe.downcast(Re)}var ki={};function tn(){return Object.keys(Ui).length}function Vi(){var J=[];for(var te in Ui)Ui.hasOwnProperty(te)&&J.push(Ui[te]);return J}var Qo=[];function vs(){for(;Qo.length;){var J=Qo.pop();J.$$.deleteScheduled=!1,J.delete()}}var Fi=void 0;function Oa(J){Fi=J,Qo.length&&Fi&&Fi(vs)}function Lo(){o.getInheritedInstanceCount=tn,o.getLiveInheritedInstances=Vi,o.flushPendingDeletes=vs,o.setDelayFunction=Oa}var Ui={};function nc(J,te){for(te===void 0&&Ot("ptr should not be undefined");J.baseClass;)te=J.upcast(te),J=J.baseClass;return te}function Bi(J,te){return te=nc(J,te),Ui[te]}function Ma(J,te){(!te.ptrType||!te.ptr)&&zt("makeClassHandle requires ptr and ptrType");var pe=!!te.smartPtrType,Re=!!te.smartPtr;return pe!==Re&&zt("Both smartPtrType and smartPtr must be specified"),te.count={value:1},di(Object.create(J,{$$:{value:te}}))}function Zc(J){var te=this.getPointee(J);if(!te)return this.destructor(J),null;var pe=Bi(this.registeredClass,te);if(pe!==void 0){if(pe.$$.count.value===0)return pe.$$.ptr=te,pe.$$.smartPtr=J,pe.clone();var Re=pe.clone();return this.destructor(J),Re}function Be(){return this.isSmartPointer?Ma(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:te,smartPtrType:this,smartPtr:J}):Ma(this.registeredClass.instancePrototype,{ptrType:this,ptr:J})}var Xe=this.registeredClass.getActualType(te),Ye=ki[Xe];if(!Ye)return Be.call(this);var He;this.isConst?He=Ye.constPointerType:He=Ye.pointerType;var Ze=dr(te,this.registeredClass,He.registeredClass);return Ze===null?Be.call(this):this.isSmartPointer?Ma(He.registeredClass.instancePrototype,{ptrType:He,ptr:Ze,smartPtrType:this,smartPtr:J}):Ma(He.registeredClass.instancePrototype,{ptrType:He,ptr:Ze})}function di(J){return typeof FinalizationRegistry>"u"?(di=te=>te,J):(Ci=new FinalizationRegistry(te=>{ms(te.$$)}),di=te=>{var pe=te.$$,Re=!!pe.smartPtr;if(Re){var Be={$$:pe};Ci.register(te,Be,te)}return te},Zo=te=>Ci.unregister(te),di(J))}function bu(){if(this.$$.ptr||en(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var J=di(Object.create(Object.getPrototypeOf(this),{$$:{value:fi(this.$$)}}));return J.$$.count.value+=1,J.$$.deleteScheduled=!1,J}function no(){this.$$.ptr||en(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ot("Object already scheduled for deletion"),Zo(this),ms(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ea(){return!this.$$.ptr}function Ra(){return this.$$.ptr||en(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Ot("Object already scheduled for deletion"),Qo.push(this),Qo.length===1&&Fi&&Fi(vs),this.$$.deleteScheduled=!0,this}function Pa(){vo.prototype.isAliasOf=On,vo.prototype.clone=bu,vo.prototype.delete=no,vo.prototype.isDeleted=ea,vo.prototype.deleteLater=Ra}function vo(){}function ta(J,te,pe){if(J[te].overloadTable===void 0){var Re=J[te];J[te]=function(){return J[te].overloadTable.hasOwnProperty(arguments.length)||Ot("Function '"+pe+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+J[te].overloadTable+")!"),J[te].overloadTable[arguments.length].apply(this,arguments)},J[te].overloadTable=[],J[te].overloadTable[Re.argCount]=Re}}function ro(J,te,pe){o.hasOwnProperty(J)?((pe===void 0||o[J].overloadTable!==void 0&&o[J].overloadTable[pe]!==void 0)&&Ot("Cannot register public name '"+J+"' twice"),ta(o,J,J),o.hasOwnProperty(pe)&&Ot("Cannot register multiple overloads of a function with the same number of arguments ("+pe+")!"),o[J].overloadTable[pe]=te):(o[J]=te,pe!==void 0&&(o[J].numArguments=pe))}function Qc(J,te,pe,Re,Be,Xe,Ye,He){this.name=J,this.constructor=te,this.instancePrototype=pe,this.rawDestructor=Re,this.baseClass=Be,this.getActualType=Xe,this.upcast=Ye,this.downcast=He,this.pureVirtualFunctions=[]}function na(J,te,pe){for(;te!==pe;)te.upcast||Ot("Expected null or instance of "+pe.name+", got an instance of "+te.name),J=te.upcast(J),te=te.baseClass;return J}function yo(J,te){if(te===null)return this.isReference&&Ot("null is not a valid "+this.name),0;te.$$||Ot('Cannot pass "'+Wi(te)+'" as a '+this.name),te.$$.ptr||Ot("Cannot pass deleted object as a pointer of type "+this.name);var pe=te.$$.ptrType.registeredClass,Re=na(te.$$.ptr,pe,this.registeredClass);return Re}function wo(J,te){var pe;if(te===null)return this.isReference&&Ot("null is not a valid "+this.name),this.isSmartPointer?(pe=this.rawConstructor(),J!==null&&J.push(this.rawDestructor,pe),pe):0;te.$$||Ot('Cannot pass "'+Wi(te)+'" as a '+this.name),te.$$.ptr||Ot("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&te.$$.ptrType.isConst&&Ot("Cannot convert argument of type "+(te.$$.smartPtrType?te.$$.smartPtrType.name:te.$$.ptrType.name)+" to parameter type "+this.name);var Re=te.$$.ptrType.registeredClass;if(pe=na(te.$$.ptr,Re,this.registeredClass),this.isSmartPointer)switch(te.$$.smartPtr===void 0&&Ot("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:te.$$.smartPtrType===this?pe=te.$$.smartPtr:Ot("Cannot convert argument of type "+(te.$$.smartPtrType?te.$$.smartPtrType.name:te.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:pe=te.$$.smartPtr;break;case 2:if(te.$$.smartPtrType===this)pe=te.$$.smartPtr;else{var Be=te.clone();pe=this.rawShare(pe,hr.toHandle(function(){Be.delete()})),J!==null&&J.push(this.rawDestructor,pe)}break;default:Ot("Unsupporting sharing policy")}return pe}function Iu(J,te){if(te===null)return this.isReference&&Ot("null is not a valid "+this.name),0;te.$$||Ot('Cannot pass "'+Wi(te)+'" as a '+this.name),te.$$.ptr||Ot("Cannot pass deleted object as a pointer of type "+this.name),te.$$.ptrType.isConst&&Ot("Cannot convert argument of type "+te.$$.ptrType.name+" to parameter type "+this.name);var pe=te.$$.ptrType.registeredClass,Re=na(te.$$.ptr,pe,this.registeredClass);return Re}function Ou(J){return this.rawGetPointee&&(J=this.rawGetPointee(J)),J}function rc(J){this.rawDestructor&&this.rawDestructor(J)}function Mu(J){J!==null&&J.delete()}function Ru(){Lr.prototype.getPointee=Ou,Lr.prototype.destructor=rc,Lr.prototype.argPackAdvance=8,Lr.prototype.readValueFromPointer=Ge,Lr.prototype.deleteObject=Mu,Lr.prototype.fromWireType=Zc}function Lr(J,te,pe,Re,Be,Xe,Ye,He,Ze,ft,Ct){this.name=J,this.registeredClass=te,this.isReference=pe,this.isConst=Re,this.isSmartPointer=Be,this.pointeeType=Xe,this.sharingPolicy=Ye,this.rawGetPointee=He,this.rawConstructor=Ze,this.rawShare=ft,this.rawDestructor=Ct,!Be&&te.baseClass===void 0?Re?(this.toWireType=yo,this.destructorFunction=null):(this.toWireType=Iu,this.destructorFunction=null):this.toWireType=wo}function ic(J,te,pe){o.hasOwnProperty(J)||zt("Replacing nonexistant public symbol"),o[J].overloadTable!==void 0&&pe!==void 0?o[J].overloadTable[pe]=te:(o[J]=te,o[J].argCount=pe)}function Gi(J,te,pe){var Re=o["dynCall_"+J];return pe&&pe.length?Re.apply(null,[te].concat(pe)):Re.call(null,te)}var ys=[];function ws(J){var te=ys[J];return te||(J>=ys.length&&(ys.length=J+1),ys[J]=te=de.get(J)),te}function hi(J,te,pe){if(J.includes("j"))return Gi(J,te,pe);var Re=ws(te).apply(null,pe);return Re}function el(J,te){var pe=[];return function(){return pe.length=0,Object.assign(pe,arguments),hi(J,te,pe)}}function Si(J,te){J=pn(J);function pe(){return J.includes("j")?el(J,te):ws(te)}var Re=pe();return typeof Re!="function"&&Ot("unknown function pointer with signature "+J+": "+te),Re}var La=void 0;function Cr(J){var te=Cs(J),pe=pn(te);return io(te),pe}function Aa(J,te){var pe=[],Re={};function Be(Xe){if(!Re[Xe]&&!qe[Xe]){if(st[Xe]){st[Xe].forEach(Be);return}pe.push(Xe),Re[Xe]=!0}}throw te.forEach(Be),new La(J+": "+pe.map(Cr).join([", "]))}function tl(J,te,pe,Re,Be,Xe,Ye,He,Ze,ft,Ct,Dt,Bt){Ct=pn(Ct),Xe=Si(Be,Xe),He&&(He=Si(Ye,He)),ft&&(ft=Si(Ze,ft)),Bt=Si(Dt,Bt);var Y=bt(Ct);ro(Y,function(){Aa("Cannot construct "+Ct+" due to unbound types",[Re])}),Tn([J,te,pe],Re?[Re]:[],function(q){q=q[0];var fe,De;Re?(fe=q.registeredClass,De=fe.instancePrototype):De=vo.prototype;var Fe=It(Y,function(){if(Object.getPrototypeOf(this)!==tt)throw new ni("Use 'new' to construct "+Ct);if(Je.constructor_body===void 0)throw new ni(Ct+" has no accessible constructor");var le=Je.constructor_body[arguments.length];if(le===void 0)throw new ni("Tried to invoke ctor of "+Ct+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Je.constructor_body).toString()+") parameters instead!");return le.apply(this,arguments)}),tt=Object.create(De,{constructor:{value:Fe}});Fe.prototype=tt;var Je=new Qc(Ct,Fe,tt,Bt,fe,Xe,He,ft),Ke=new Lr(Ct,Je,!0,!1,!1),G=new Lr(Ct+"*",Je,!1,!1,!1),j=new Lr(Ct+" const*",Je,!1,!0,!1);return ki[J]={pointerType:G,constPointerType:j},ic(Y,Fe),[Ke,G,j]})}function jn(J,te){for(var pe=[],Re=0;Re<J;Re++)pe.push(N[te+Re*4>>2]);return pe}function oc(J,te){if(!(J instanceof Function))throw new TypeError("new_ called with constructor type "+typeof J+" which is not a function");var pe=It(J.name||"unknownFunctionName",function(){});pe.prototype=J.prototype;var Re=new pe,Be=J.apply(Re,te);return Be instanceof Object?Be:Re}function Na(J,te,pe,Re,Be){var Xe=te.length;Xe<2&&Ot("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Ye=te[1]!==null&&pe!==null,He=!1,Ze=1;Ze<te.length;++Ze)if(te[Ze]!==null&&te[Ze].destructorFunction===void 0){He=!0;break}for(var ft=te[0].name!=="void",Ct="",Dt="",Ze=0;Ze<Xe-2;++Ze)Ct+=(Ze!==0?", ":"")+"arg"+Ze,Dt+=(Ze!==0?", ":"")+"arg"+Ze+"Wired";var Bt="return function "+bt(J)+"("+Ct+`) {
if (arguments.length !== `+(Xe-2)+`) {
throwBindingError('function `+J+" called with ' + arguments.length + ' arguments, expected "+(Xe-2)+` args!');
}
`;He&&(Bt+=`var destructors = [];
`);var Y=He?"destructors":"null",q=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],fe=[Ot,Re,Be,Se,te[0],te[1]];Ye&&(Bt+="var thisWired = classParam.toWireType("+Y+`, this);
`);for(var Ze=0;Ze<Xe-2;++Ze)Bt+="var arg"+Ze+"Wired = argType"+Ze+".toWireType("+Y+", arg"+Ze+"); // "+te[Ze+2].name+`
`,q.push("argType"+Ze),fe.push(te[Ze+2]);if(Ye&&(Dt="thisWired"+(Dt.length>0?", ":"")+Dt),Bt+=(ft?"var rv = ":"")+"invoker(fn"+(Dt.length>0?", ":"")+Dt+`);
`,He)Bt+=`runDestructors(destructors);
`;else for(var Ze=Ye?1:2;Ze<te.length;++Ze){var De=Ze===1?"thisWired":"arg"+(Ze-2)+"Wired";te[Ze].destructorFunction!==null&&(Bt+=De+"_dtor("+De+"); // "+te[Ze].name+`
`,q.push(De+"_dtor"),fe.push(te[Ze].destructorFunction))}ft&&(Bt+=`var ret = retType.fromWireType(rv);
return ret;
`),Bt+=`}
`,q.push(Bt);var Fe=oc(Function,q).apply(null,fe);return Fe}function ac(J,te,pe,Re,Be,Xe){T(te>0);var Ye=jn(te,pe);Be=Si(Re,Be),Tn([],[J],function(He){He=He[0];var Ze="constructor "+He.name;if(He.registeredClass.constructor_body===void 0&&(He.registeredClass.constructor_body=[]),He.registeredClass.constructor_body[te-1]!==void 0)throw new ni("Cannot register multiple constructors with identical number of parameters ("+(te-1)+") for class '"+He.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return He.registeredClass.constructor_body[te-1]=()=>{Aa("Cannot construct "+He.name+" due to unbound types",Ye)},Tn([],Ye,function(ft){return ft.splice(1,0,null),He.registeredClass.constructor_body[te-1]=Na(Ze,ft,null,Be,Xe),[]}),[]})}function nl(J,te,pe,Re,Be,Xe,Ye,He){var Ze=jn(pe,Re);te=pn(te),Xe=Si(Be,Xe),Tn([],[J],function(ft){ft=ft[0];var Ct=ft.name+"."+te;te.startsWith("@@")&&(te=Symbol[te.substring(2)]),He&&ft.registeredClass.pureVirtualFunctions.push(te);function Dt(){Aa("Cannot call "+Ct+" due to unbound types",Ze)}var Bt=ft.registeredClass.instancePrototype,Y=Bt[te];return Y===void 0||Y.overloadTable===void 0&&Y.className!==ft.name&&Y.argCount===pe-2?(Dt.argCount=pe-2,Dt.className=ft.name,Bt[te]=Dt):(ta(Bt,te,Ct),Bt[te].overloadTable[pe-2]=Dt),Tn([],Ze,function(q){var fe=Na(Ct,q,ft,Xe,Ye);return Bt[te].overloadTable===void 0?(fe.argCount=pe-2,Bt[te]=fe):Bt[te].overloadTable[pe-2]=fe,[]}),[]})}var Kr=[],gi=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ra(J){J>4&&--gi[J].refcount===0&&(gi[J]=void 0,Kr.push(J))}function qr(){for(var J=0,te=5;te<gi.length;++te)gi[te]!==void 0&&++J;return J}function rl(){for(var J=5;J<gi.length;++J)if(gi[J]!==void 0)return gi[J];return null}function ka(){o.count_emval_handles=qr,o.get_first_emval=rl}var hr={toValue:J=>(J||Ot("Cannot use deleted val. handle = "+J),gi[J].value),toHandle:J=>{switch(J){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var te=Kr.length?Kr.pop():gi.length;return gi[te]={refcount:1,value:J},te}}}};function xs(J,te){te=pn(te),Pr(J,{name:te,fromWireType:function(pe){var Re=hr.toValue(pe);return ra(pe),Re},toWireType:function(pe,Re){return hr.toHandle(Re)},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:null})}function Wi(J){if(J===null)return"null";var te=typeof J;return te==="object"||te==="array"||te==="function"?J.toString():""+J}function Pu(J,te){switch(te){case 2:return function(pe){return this.fromWireType(H[pe>>2])};case 3:return function(pe){return this.fromWireType(ee[pe>>3])};default:throw new TypeError("Unknown float type: "+J)}}function Va(J,te,pe){var Re=Ue(pe);te=pn(te),Pr(J,{name:te,fromWireType:function(Be){return Be},toWireType:function(Be,Xe){return Xe},argPackAdvance:8,readValueFromPointer:Pu(te,Re),destructorFunction:null})}function gr(J,te,pe,Re,Be,Xe){var Ye=jn(te,pe);J=pn(J),Be=Si(Re,Be),ro(J,function(){Aa("Cannot call "+J+" due to unbound types",Ye)},te-1),Tn([],Ye,function(He){var Ze=[He[0],null].concat(He.slice(1));return ic(J,Na(J,Ze,null,Be,Xe),te-1),[]})}function il(J,te,pe){switch(te){case 0:return pe?function(Be){return P[Be]}:function(Be){return k[Be]};case 1:return pe?function(Be){return z[Be>>1]}:function(Be){return A[Be>>1]};case 2:return pe?function(Be){return L[Be>>2]}:function(Be){return N[Be>>2]};default:throw new TypeError("Unknown integer type: "+J)}}function sc(J,te,pe,Re,Be){te=pn(te);var Xe=Ue(pe),Ye=Dt=>Dt;if(Re===0){var He=32-8*pe;Ye=Dt=>Dt<<He>>>He}var Ze=te.includes("unsigned"),ft=(Dt,Bt)=>{},Ct;Ze?Ct=function(Dt,Bt){return ft(Bt,this.name),Bt>>>0}:Ct=function(Dt,Bt){return ft(Bt,this.name),Bt},Pr(J,{name:te,fromWireType:Ye,toWireType:Ct,argPackAdvance:8,readValueFromPointer:il(te,Xe,Re!==0),destructorFunction:null})}function Lu(J,te,pe){var Re=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Be=Re[te];function Xe(Ye){Ye=Ye>>2;var He=N,Ze=He[Ye],ft=He[Ye+1];return new Be(M,ft,Ze)}pe=pn(pe),Pr(J,{name:pe,fromWireType:Xe,argPackAdvance:8,readValueFromPointer:Xe},{ignoreDuplicateRegistrations:!0})}function Au(J,te){te=pn(te);var pe=te==="std::string";Pr(J,{name:te,fromWireType:function(Re){var Be=N[Re>>2],Xe=Re+4,Ye;if(pe)for(var He=Xe,Ze=0;Ze<=Be;++Ze){var ft=Xe+Ze;if(Ze==Be||k[ft]==0){var Ct=ft-He,Dt=D(He,Ct);Ye===void 0?Ye=Dt:(Ye+="\0",Ye+=Dt),He=ft+1}}else{for(var Bt=new Array(Be),Ze=0;Ze<Be;++Ze)Bt[Ze]=String.fromCharCode(k[Xe+Ze]);Ye=Bt.join("")}return io(Re),Ye},toWireType:function(Re,Be){Be instanceof ArrayBuffer&&(Be=new Uint8Array(Be));var Xe,Ye=typeof Be=="string";Ye||Be instanceof Uint8Array||Be instanceof Uint8ClampedArray||Be instanceof Int8Array||Ot("Cannot pass non-string to std::string"),pe&&Ye?Xe=R(Be):Xe=Be.length;var He=Ao(4+Xe+1),Ze=He+4;if(N[He>>2]=Xe,pe&&Ye)I(Be,Ze,Xe+1);else if(Ye)for(var ft=0;ft<Xe;++ft){var Ct=Be.charCodeAt(ft);Ct>255&&(io(Ze),Ot("String has UTF-16 code units that do not fit in 8 bits")),k[Ze+ft]=Ct}else for(var ft=0;ft<Xe;++ft)k[Ze+ft]=Be[ft];return Re!==null&&Re.push(io,He),He},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:function(Re){io(Re)}})}var Fa=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ol(J,te){for(var pe=J,Re=pe>>1,Be=Re+te/2;!(Re>=Be)&&A[Re];)++Re;if(pe=Re<<1,pe-J>32&&Fa)return Fa.decode(k.subarray(J,pe));for(var Xe="",Ye=0;!(Ye>=te/2);++Ye){var He=z[J+Ye*2>>1];if(He==0)break;Xe+=String.fromCharCode(He)}return Xe}function cc(J,te,pe){if(pe===void 0&&(pe=2147483647),pe<2)return 0;pe-=2;for(var Re=te,Be=pe<J.length*2?pe/2:J.length,Xe=0;Xe<Be;++Xe){var Ye=J.charCodeAt(Xe);z[te>>1]=Ye,te+=2}return z[te>>1]=0,te-Re}function Nu(J){return J.length*2}function al(J,te){for(var pe=0,Re="";!(pe>=te/4);){var Be=L[J+pe*4>>2];if(Be==0)break;if(++pe,Be>=65536){var Xe=Be-65536;Re+=String.fromCharCode(55296|Xe>>10,56320|Xe&1023)}else Re+=String.fromCharCode(Be)}return Re}function ku(J,te,pe){if(pe===void 0&&(pe=2147483647),pe<4)return 0;for(var Re=te,Be=Re+pe-4,Xe=0;Xe<J.length;++Xe){var Ye=J.charCodeAt(Xe);if(Ye>=55296&&Ye<=57343){var He=J.charCodeAt(++Xe);Ye=65536+((Ye&1023)<<10)|He&1023}if(L[te>>2]=Ye,te+=4,te+4>Be)break}return L[te>>2]=0,te-Re}function Vu(J){for(var te=0,pe=0;pe<J.length;++pe){var Re=J.charCodeAt(pe);Re>=55296&&Re<=57343&&++pe,te+=4}return te}function Fu(J,te,pe){pe=pn(pe);var Re,Be,Xe,Ye,He;te===2?(Re=ol,Be=cc,Ye=Nu,Xe=()=>A,He=1):te===4&&(Re=al,Be=ku,Ye=Vu,Xe=()=>N,He=2),Pr(J,{name:pe,fromWireType:function(Ze){for(var ft=N[Ze>>2],Ct=Xe(),Dt,Bt=Ze+4,Y=0;Y<=ft;++Y){var q=Ze+4+Y*te;if(Y==ft||Ct[q>>He]==0){var fe=q-Bt,De=Re(Bt,fe);Dt===void 0?Dt=De:(Dt+="\0",Dt+=De),Bt=q+te}}return io(Ze),Dt},toWireType:function(Ze,ft){typeof ft!="string"&&Ot("Cannot pass non-string to C++ string type "+pe);var Ct=Ye(ft),Dt=Ao(4+Ct+te);return N[Dt>>2]=Ct>>He,Be(ft,Dt+4,Ct+te),Ze!==null&&Ze.push(io,Dt),Dt},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:function(Ze){io(Ze)}})}function Uu(J,te,pe,Re,Be,Xe){ot[J]={name:pn(te),rawConstructor:Si(pe,Re),rawDestructor:Si(Be,Xe),fields:[]}}function Bu(J,te,pe,Re,Be,Xe,Ye,He,Ze,ft){ot[J].fields.push({fieldName:pn(te),getterReturnType:pe,getter:Si(Re,Be),getterContext:Xe,setterArgumentType:Ye,setter:Si(He,Ze),setterContext:ft})}function sl(J,te){te=pn(te),Pr(J,{isVoid:!0,name:te,argPackAdvance:0,fromWireType:function(){},toWireType:function(pe,Re){}})}var Gu={};function Wu(J){var te=Gu[J];return te===void 0?pn(J):te}function cl(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function ll(J){return J===0?hr.toHandle(cl()):(J=Wu(J),hr.toHandle(cl()[J]))}function zu(J){J>4&&(gi[J].refcount+=1)}function ul(J,te){var pe=qe[J];return pe===void 0&&Ot(te+" has unknown type "+Cr(J)),pe}function fl(J){for(var te="",pe=0;pe<J;++pe)te+=(pe!==0?", ":"")+"arg"+pe;for(var Re=()=>N,Be="return function emval_allocator_"+J+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,pe=0;pe<J;++pe)Be+="var argType"+pe+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+pe+`');
var arg`+pe+" = argType"+pe+`.readValueFromPointer(args);
args += argType`+pe+`['argPackAdvance'];
argTypes += 4;
`;return Be+="var obj = new constructor("+te+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",Be)(ul,o,hr.toHandle,Re)}var lc={};function dl(J,te,pe,Re){J=hr.toValue(J);var Be=lc[te];return Be||(Be=fl(te),lc[te]=Be),Be(J,pe,Re)}function $u(J,te){J=ul(J,"_emval_take_value");var pe=J.readValueFromPointer(te);return hr.toHandle(pe)}function hl(){Ie("")}function ju(J,te,pe){k.copyWithin(J,te,te+pe)}function uc(){return 2147483648}function Hu(J){try{return C.grow(J-M.byteLength+65535>>>16),oe(C.buffer),1}catch{}}function Ku(J){var te=k.length;J=J>>>0;var pe=uc();if(J>pe)return!1;let Re=(Ze,ft)=>Ze+(ft-Ze%ft)%ft;for(var Be=1;Be<=4;Be*=2){var Xe=te*(1+.2/Be);Xe=Math.min(Xe,J+100663296);var Ye=Math.min(pe,Re(Math.max(J,Xe),65536)),He=Hu(Ye);if(He)return!0}return!1}function qu(J){var te=o["_"+J];return te}function Xu(J,te){P.set(J,te)}function fc(J,te,pe,Re,Be){var Xe={string:q=>{var fe=0;if(q!=null&&q!==0){var De=(q.length<<2)+1;fe=dc(De),I(q,fe,De)}return fe},array:q=>{var fe=dc(q.length);return Xu(q,fe),fe}};function Ye(q){return te==="string"?D(q):te==="boolean"?!!q:q}var He=qu(J),Ze=[],ft=0;if(Re)for(var Ct=0;Ct<Re.length;Ct++){var Dt=Xe[pe[Ct]];Dt?(ft===0&&(ft=ia()),Ze[Ct]=Dt(Re[Ct])):Ze[Ct]=Re[Ct]}var Bt=He.apply(null,Ze);function Y(q){return ft!==0&&gl(ft),Ye(q)}return Bt=Y(Bt),Bt}Pn=o.InternalError=ln(Error,"InternalError"),nt(),ni=o.BindingError=ln(Error,"BindingError"),Pa(),Lo(),Ru(),La=o.UnboundTypeError=ln(Error,"UnboundTypeError"),ka();var Yu={h:ut,q:ui,r:Ur,w:Qt,p:tl,o:ac,c:nl,v:xs,k:Va,e:gr,b:sc,a:Lu,j:Au,g:Fu,u:Uu,d:Bu,x:sl,i:ra,m:ll,l:zu,y:dl,n:$u,f:hl,t:ju,s:Ku};ge(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.A).apply(null,arguments)};var Ao=o._malloc=function(){return(Ao=o._malloc=o.asm.B).apply(null,arguments)},Cs=o.___getTypeName=function(){return(Cs=o.___getTypeName=o.asm.D).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.E).apply(null,arguments)};var io=o._free=function(){return(io=o._free=o.asm.F).apply(null,arguments)},ia=o.stackSave=function(){return(ia=o.stackSave=o.asm.G).apply(null,arguments)},gl=o.stackRestore=function(){return(gl=o.stackRestore=o.asm.H).apply(null,arguments)},dc=o.stackAlloc=function(){return(dc=o.stackAlloc=o.asm.I).apply(null,arguments)},pl=o.___cxa_is_pointer_type=function(){return(pl=o.___cxa_is_pointer_type=o.asm.J).apply(null,arguments)};o.ccall=fc;var Ss;Z=function J(){Ss||ml(),Ss||(Z=J)};function ml(J){if(X>0||(_e(),X>0))return;function te(){Ss||(Ss=!0,o.calledRun=!0,!S&&(Ce(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),F()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),te()},1)):te()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return ml(),i.ready}})();t.exports=r})(dk);var Qfe=dk.exports;const e0e=Ys(Qfe),t0e=new URL("/dicm-viewer-test/assets/charlswasm_decode-484ovEoR.wasm",import.meta.url),$0={codec:void 0,decoder:void 0,decodeConfig:{}};function n0e(t){return typeof t=="number"?$0.codec.getExceptionMessage(t):t}function r0e(t){if($0.decodeConfig=t,$0.codec)return Promise.resolve();const e=e0e({locateFile:r=>r.endsWith(".wasm")?t0e.toString():r});return new Promise((r,n)=>{e.then(i=>{$0.codec=i,$0.decoder=new i.JpegLSDecoder,r()},n)})}async function eD(t,e){try{await r0e();const r=$0.decoder;r.getEncodedBuffer(t.length).set(t),r.decode();const i=r.getFrameInfo(),o=r.getInterleaveMode(),a=r.getNearLossless(),s=r.getDecodedBuffer(),c={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:e.signed,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},l=i0e(i,s,e.signed),f={nearLossless:a,interleaveMode:o,frameInfo:i};return{...e,pixelData:l,imageInfo:c,encodeOptions:f,...f,...c}}catch(r){throw n0e(r)}}function i0e(t,e,r){return t.bitsPerSample>8?r?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):r?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var hk={exports:{}};(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(i){i=i||{};var o=typeof i<"u"?i:{},a,s;o.ready=new Promise(function(Y,q){a=Y,s=q});var c=Object.assign({},o),l="./this.program",f=typeof window=="object",u=typeof importScripts=="function",d=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",h="";function g(Y){return o.locateFile?o.locateFile(Y,h):h+Y}var p,v,w;if(d){var m=zs,y=zs;u?h=y.dirname(h)+"/":h=__dirname+"/",p=(Y,q)=>(Y=ve(Y)?new URL(Y):y.normalize(Y),m.readFileSync(Y,q?void 0:"utf8")),w=Y=>{var q=p(Y,!0);return q.buffer||(q=new Uint8Array(q)),q},v=(Y,q,fe)=>{Y=ve(Y)?new URL(Y):y.normalize(Y),m.readFile(Y,function(De,Fe){De?fe(De):q(Fe.buffer)})},process.argv.length>1&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",function(Y){if(!(Y instanceof it))throw Y}),process.on("unhandledRejection",function(Y){throw Y}),o.inspect=function(){return"[Emscripten Module object]"}}else(f||u)&&(u?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),n&&(h=n),h.indexOf("blob:")!==0?h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1):h="",p=Y=>{var q=new XMLHttpRequest;return q.open("GET",Y,!1),q.send(null),q.responseText},u&&(w=Y=>{var q=new XMLHttpRequest;return q.open("GET",Y,!1),q.responseType="arraybuffer",q.send(null),new Uint8Array(q.response)}),v=(Y,q,fe)=>{var De=new XMLHttpRequest;De.open("GET",Y,!0),De.responseType="arraybuffer",De.onload=()=>{if(De.status==200||De.status==0&&De.response){q(De.response);return}fe()},De.onerror=fe,De.send(null)});var x=o.print||console.log.bind(console),C=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&(l=o.thisProgram),o.quit&&o.quit;var S;o.wasmBinary&&(S=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&je("no native wasm support detected");var T,_=!1;function E(Y,q){Y||je(q)}var D=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function b(Y,q,fe){for(var De=q+fe,Fe=q;Y[Fe]&&!(Fe>=De);)++Fe;if(Fe-q>16&&Y.buffer&&D)return D.decode(Y.subarray(q,Fe));for(var tt="";q<Fe;){var Je=Y[q++];if(!(Je&128)){tt+=String.fromCharCode(Je);continue}var Ke=Y[q++]&63;if((Je&224)==192){tt+=String.fromCharCode((Je&31)<<6|Ke);continue}var G=Y[q++]&63;if((Je&240)==224?Je=(Je&15)<<12|Ke<<6|G:Je=(Je&7)<<18|Ke<<12|G<<6|Y[q++]&63,Je<65536)tt+=String.fromCharCode(Je);else{var j=Je-65536;tt+=String.fromCharCode(55296|j>>10,56320|j&1023)}}return tt}function I(Y,q){return Y?b(A,Y,q):""}function R(Y,q,fe,De){if(!(De>0))return 0;for(var Fe=fe,tt=fe+De-1,Je=0;Je<Y.length;++Je){var Ke=Y.charCodeAt(Je);if(Ke>=55296&&Ke<=57343){var G=Y.charCodeAt(++Je);Ke=65536+((Ke&1023)<<10)|G&1023}if(Ke<=127){if(fe>=tt)break;q[fe++]=Ke}else if(Ke<=2047){if(fe+1>=tt)break;q[fe++]=192|Ke>>6,q[fe++]=128|Ke&63}else if(Ke<=65535){if(fe+2>=tt)break;q[fe++]=224|Ke>>12,q[fe++]=128|Ke>>6&63,q[fe++]=128|Ke&63}else{if(fe+3>=tt)break;q[fe++]=240|Ke>>18,q[fe++]=128|Ke>>12&63,q[fe++]=128|Ke>>6&63,q[fe++]=128|Ke&63}}return q[fe]=0,fe-Fe}function M(Y,q,fe){return R(Y,A,q,fe)}function P(Y){for(var q=0,fe=0;fe<Y.length;++fe){var De=Y.charCodeAt(fe);De<=127?q++:De<=2047?q+=2:De>=55296&&De<=57343?(q+=4,++fe):q+=3}return q}var k,z,A,L,N,H,ee,oe,de;function ue(Y){k=Y,o.HEAP8=z=new Int8Array(Y),o.HEAP16=L=new Int16Array(Y),o.HEAP32=H=new Int32Array(Y),o.HEAPU8=A=new Uint8Array(Y),o.HEAPU16=N=new Uint16Array(Y),o.HEAPU32=ee=new Uint32Array(Y),o.HEAPF32=oe=new Float32Array(Y),o.HEAPF64=de=new Float64Array(Y)}o.INITIAL_MEMORY;var me,Ee=[],_e=[],Ce=[];function F(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)W(o.preRun.shift());ut(Ee)}function O(){ut(_e)}function $(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)Z(o.postRun.shift());ut(Ce)}function W(Y){Ee.unshift(Y)}function X(Y){_e.unshift(Y)}function Z(Y){Ce.unshift(Y)}var ne=0,xe=null;function Ie(Y){ne++,o.monitorRunDependencies&&o.monitorRunDependencies(ne)}function Le(Y){if(ne--,o.monitorRunDependencies&&o.monitorRunDependencies(ne),ne==0&&xe){var q=xe;xe=null,q()}}function je(Y){o.onAbort&&o.onAbort(Y),Y="Aborted("+Y+")",C(Y),_=!0,Y+=". Build with -sASSERTIONS for more info.";var q=new WebAssembly.RuntimeError(Y);throw s(q),q}var ie="data:application/octet-stream;base64,";function ae(Y){return Y.startsWith(ie)}function ve(Y){return Y.startsWith("file://")}var se;se="openjpegwasm_decode.wasm",ae(se)||(se=g(se));function ge(Y){try{if(Y==se&&S)return new Uint8Array(S);if(w)return w(Y);throw"both async and sync fetching of the wasm failed"}catch(q){je(q)}}function Ve(){if(!S&&(f||u)){if(typeof fetch=="function"&&!ve(se))return fetch(se,{credentials:"same-origin"}).then(function(Y){if(!Y.ok)throw"failed to load wasm binary file at '"+se+"'";return Y.arrayBuffer()}).catch(function(){return ge(se)});if(v)return new Promise(function(Y,q){v(se,function(fe){Y(new Uint8Array(fe))},q)})}return Promise.resolve().then(function(){return ge(se)})}function re(){var Y={a:Re};function q(Je,Ke){var G=Je.exports;o.asm=G,T=o.asm.E,ue(T.buffer),me=o.asm.G,X(o.asm.F),Le()}Ie();function fe(Je){q(Je.instance)}function De(Je){return Ve().then(function(Ke){return WebAssembly.instantiate(Ke,Y)}).then(function(Ke){return Ke}).then(Je,function(Ke){C("failed to asynchronously prepare wasm: "+Ke),je(Ke)})}function Fe(){return!S&&typeof WebAssembly.instantiateStreaming=="function"&&!ae(se)&&!ve(se)&&!d&&typeof fetch=="function"?fetch(se,{credentials:"same-origin"}).then(function(Je){var Ke=WebAssembly.instantiateStreaming(Je,Y);return Ke.then(fe,function(G){return C("wasm streaming compile failed: "+G),C("falling back to ArrayBuffer instantiation"),De(fe)})}):De(fe)}if(o.instantiateWasm)try{var tt=o.instantiateWasm(Y,q);return tt}catch(Je){C("Module.instantiateWasm callback failed with error: "+Je),s(Je)}return Fe().catch(s),{}}function it(Y){this.name="ExitStatus",this.message="Program terminated with exit("+Y+")",this.status=Y}function ut(Y){for(;Y.length>0;)Y.shift()(o)}function ot(Y){this.excPtr=Y,this.ptr=Y-24,this.set_type=function(q){ee[this.ptr+4>>2]=q},this.get_type=function(){return ee[this.ptr+4>>2]},this.set_destructor=function(q){ee[this.ptr+8>>2]=q},this.get_destructor=function(){return ee[this.ptr+8>>2]},this.set_refcount=function(q){H[this.ptr>>2]=q},this.set_caught=function(q){q=q?1:0,z[this.ptr+12>>0]=q},this.get_caught=function(){return z[this.ptr+12>>0]!=0},this.set_rethrown=function(q){q=q?1:0,z[this.ptr+13>>0]=q},this.get_rethrown=function(){return z[this.ptr+13>>0]!=0},this.init=function(q,fe){this.set_adjusted_ptr(0),this.set_type(q),this.set_destructor(fe),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var q=H[this.ptr>>2];H[this.ptr>>2]=q+1},this.release_ref=function(){var q=H[this.ptr>>2];return H[this.ptr>>2]=q-1,q===1},this.set_adjusted_ptr=function(q){ee[this.ptr+16>>2]=q},this.get_adjusted_ptr=function(){return ee[this.ptr+16>>2]},this.get_exception_ptr=function(){var q=Ct(this.get_type());if(q)return ee[this.excPtr>>2];var fe=this.get_adjusted_ptr();return fe!==0?fe:this.excPtr}}function Se(Y,q,fe){var De=new ot(Y);throw De.init(q,fe),Y}var Ge={};function et(Y){for(;Y.length;){var q=Y.pop(),fe=Y.pop();fe(q)}}function qe(Y){return this.fromWireType(H[Y>>2])}var st={},Et={},ct={},bt=48,It=57;function ln(Y){if(Y===void 0)return"_unknown";Y=Y.replace(/[^a-zA-Z0-9_]/g,"$");var q=Y.charCodeAt(0);return q>=bt&&q<=It?"_"+Y:Y}function Pn(Y,q){return Y=ln(Y),new Function("body","return function "+Y+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(q)}function zt(Y,q){var fe=Pn(q,function(De){this.name=q,this.message=De;var Fe=new Error(De).stack;Fe!==void 0&&(this.stack=this.toString()+`
`+Fe.replace(/^Error(:[^\n]*)?\n/,""))});return fe.prototype=Object.create(Y.prototype),fe.prototype.constructor=fe,fe.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},fe}var Tn=void 0;function ui(Y){throw new Tn(Y)}function Ur(Y,q,fe){Y.forEach(function(Ke){ct[Ke]=q});function De(Ke){var G=fe(Ke);G.length!==Y.length&&ui("Mismatched type converter count");for(var j=0;j<Y.length;++j)On(Y[j],G[j])}var Fe=new Array(q.length),tt=[],Je=0;q.forEach((Ke,G)=>{Et.hasOwnProperty(Ke)?Fe[G]=Et[Ke]:(tt.push(Ke),st.hasOwnProperty(Ke)||(st[Ke]=[]),st[Ke].push(()=>{Fe[G]=Et[Ke],++Je,Je===tt.length&&De(Fe)}))}),tt.length===0&&De(Fe)}function Ue(Y){var q=Ge[Y];delete Ge[Y];var fe=q.rawConstructor,De=q.rawDestructor,Fe=q.fields,tt=Fe.map(Je=>Je.getterReturnType).concat(Fe.map(Je=>Je.setterArgumentType));Ur([Y],tt,Je=>{var Ke={};return Fe.forEach((G,j)=>{var le=G.fieldName,ye=Je[j],V=G.getter,B=G.getterContext,Q=Je[j+Fe.length],ce=G.setter,he=G.setterContext;Ke[le]={read:be=>ye.fromWireType(V(B,be)),write:(be,Pe)=>{var Oe=[];ce(he,be,Q.toWireType(Oe,Pe)),et(Oe)}}}),[{name:q.name,fromWireType:function(G){var j={};for(var le in Ke)j[le]=Ke[le].read(G);return De(G),j},toWireType:function(G,j){for(var le in Ke)if(!(le in j))throw new TypeError('Missing field:  "'+le+'"');var ye=fe();for(le in Ke)Ke[le].write(ye,j[le]);return G!==null&&G.push(De,ye),ye},argPackAdvance:8,readValueFromPointer:qe,destructorFunction:De}]})}function nt(Y,q,fe,De,Fe){}function Mt(Y){switch(Y){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+Y)}}function pn(){for(var Y=new Array(256),q=0;q<256;++q)Y[q]=String.fromCharCode(q);ni=Y}var ni=void 0;function Ot(Y){for(var q="",fe=Y;A[fe];)q+=ni[A[fe++]];return q}var Pr=void 0;function Qt(Y){throw new Pr(Y)}function On(Y,q,fe={}){if(!("argPackAdvance"in q))throw new TypeError("registerType registeredInstance requires argPackAdvance");var De=q.name;if(Y||Qt('type "'+De+'" must have a positive integer typeid pointer'),Et.hasOwnProperty(Y)){if(fe.ignoreDuplicateRegistrations)return;Qt("Cannot register type '"+De+"' twice")}if(Et[Y]=q,delete ct[Y],st.hasOwnProperty(Y)){var Fe=st[Y];delete st[Y],Fe.forEach(tt=>tt())}}function fi(Y,q,fe,De,Fe){var tt=Mt(fe);q=Ot(q),On(Y,{name:q,fromWireType:function(Je){return!!Je},toWireType:function(Je,Ke){return Ke?De:Fe},argPackAdvance:8,readValueFromPointer:function(Je){var Ke;if(fe===1)Ke=z;else if(fe===2)Ke=L;else if(fe===4)Ke=H;else throw new TypeError("Unknown boolean type size: "+q);return this.fromWireType(Ke[Je>>tt])},destructorFunction:null})}function en(Y){if(!(this instanceof ro)||!(Y instanceof ro))return!1;for(var q=this.$$.ptrType.registeredClass,fe=this.$$.ptr,De=Y.$$.ptrType.registeredClass,Fe=Y.$$.ptr;q.baseClass;)fe=q.upcast(fe),q=q.baseClass;for(;De.baseClass;)Fe=De.upcast(Fe),De=De.baseClass;return q===De&&fe===Fe}function Ci(Y){return{count:Y.count,deleteScheduled:Y.deleteScheduled,preservePointerOnDelete:Y.preservePointerOnDelete,ptr:Y.ptr,ptrType:Y.ptrType,smartPtr:Y.smartPtr,smartPtrType:Y.smartPtrType}}function Zo(Y){function q(fe){return fe.$$.ptrType.registeredClass.name}Qt(q(Y)+" instance already deleted")}var tc=!1;function ms(Y){}function dr(Y){Y.smartPtr?Y.smartPtrType.rawDestructor(Y.smartPtr):Y.ptrType.registeredClass.rawDestructor(Y.ptr)}function ki(Y){Y.count.value-=1;var q=Y.count.value===0;q&&dr(Y)}function tn(Y,q,fe){if(q===fe)return Y;if(fe.baseClass===void 0)return null;var De=tn(Y,q,fe.baseClass);return De===null?null:fe.downcast(De)}var Vi={};function Qo(){return Object.keys(Bi).length}function vs(){var Y=[];for(var q in Bi)Bi.hasOwnProperty(q)&&Y.push(Bi[q]);return Y}var Fi=[];function Oa(){for(;Fi.length;){var Y=Fi.pop();Y.$$.deleteScheduled=!1,Y.delete()}}var Lo=void 0;function Ui(Y){Lo=Y,Fi.length&&Lo&&Lo(Oa)}function nc(){o.getInheritedInstanceCount=Qo,o.getLiveInheritedInstances=vs,o.flushPendingDeletes=Oa,o.setDelayFunction=Ui}var Bi={};function Ma(Y,q){for(q===void 0&&Qt("ptr should not be undefined");Y.baseClass;)q=Y.upcast(q),Y=Y.baseClass;return q}function Zc(Y,q){return q=Ma(Y,q),Bi[q]}function di(Y,q){(!q.ptrType||!q.ptr)&&ui("makeClassHandle requires ptr and ptrType");var fe=!!q.smartPtrType,De=!!q.smartPtr;return fe!==De&&ui("Both smartPtrType and smartPtr must be specified"),q.count={value:1},no(Object.create(Y,{$$:{value:q}}))}function bu(Y){var q=this.getPointee(Y);if(!q)return this.destructor(Y),null;var fe=Zc(this.registeredClass,q);if(fe!==void 0){if(fe.$$.count.value===0)return fe.$$.ptr=q,fe.$$.smartPtr=Y,fe.clone();var De=fe.clone();return this.destructor(Y),De}function Fe(){return this.isSmartPointer?di(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:q,smartPtrType:this,smartPtr:Y}):di(this.registeredClass.instancePrototype,{ptrType:this,ptr:Y})}var tt=this.registeredClass.getActualType(q),Je=Vi[tt];if(!Je)return Fe.call(this);var Ke;this.isConst?Ke=Je.constPointerType:Ke=Je.pointerType;var G=tn(q,this.registeredClass,Ke.registeredClass);return G===null?Fe.call(this):this.isSmartPointer?di(Ke.registeredClass.instancePrototype,{ptrType:Ke,ptr:G,smartPtrType:this,smartPtr:Y}):di(Ke.registeredClass.instancePrototype,{ptrType:Ke,ptr:G})}function no(Y){return typeof FinalizationRegistry>"u"?(no=q=>q,Y):(tc=new FinalizationRegistry(q=>{ki(q.$$)}),no=q=>{var fe=q.$$,De=!!fe.smartPtr;if(De){var Fe={$$:fe};tc.register(q,Fe,q)}return q},ms=q=>tc.unregister(q),no(Y))}function ea(){if(this.$$.ptr||Zo(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var Y=no(Object.create(Object.getPrototypeOf(this),{$$:{value:Ci(this.$$)}}));return Y.$$.count.value+=1,Y.$$.deleteScheduled=!1,Y}function Ra(){this.$$.ptr||Zo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Qt("Object already scheduled for deletion"),ms(this),ki(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Pa(){return!this.$$.ptr}function vo(){return this.$$.ptr||Zo(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Qt("Object already scheduled for deletion"),Fi.push(this),Fi.length===1&&Lo&&Lo(Oa),this.$$.deleteScheduled=!0,this}function ta(){ro.prototype.isAliasOf=en,ro.prototype.clone=ea,ro.prototype.delete=Ra,ro.prototype.isDeleted=Pa,ro.prototype.deleteLater=vo}function ro(){}function Qc(Y,q,fe){if(Y[q].overloadTable===void 0){var De=Y[q];Y[q]=function(){return Y[q].overloadTable.hasOwnProperty(arguments.length)||Qt("Function '"+fe+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+Y[q].overloadTable+")!"),Y[q].overloadTable[arguments.length].apply(this,arguments)},Y[q].overloadTable=[],Y[q].overloadTable[De.argCount]=De}}function na(Y,q,fe){o.hasOwnProperty(Y)?(Qt("Cannot register public name '"+Y+"' twice"),Qc(o,Y,Y),o.hasOwnProperty(fe)&&Qt("Cannot register multiple overloads of a function with the same number of arguments ("+fe+")!"),o[Y].overloadTable[fe]=q):o[Y]=q}function yo(Y,q,fe,De,Fe,tt,Je,Ke){this.name=Y,this.constructor=q,this.instancePrototype=fe,this.rawDestructor=De,this.baseClass=Fe,this.getActualType=tt,this.upcast=Je,this.downcast=Ke,this.pureVirtualFunctions=[]}function wo(Y,q,fe){for(;q!==fe;)q.upcast||Qt("Expected null or instance of "+fe.name+", got an instance of "+q.name),Y=q.upcast(Y),q=q.baseClass;return Y}function Iu(Y,q){if(q===null)return this.isReference&&Qt("null is not a valid "+this.name),0;q.$$||Qt('Cannot pass "'+Va(q)+'" as a '+this.name),q.$$.ptr||Qt("Cannot pass deleted object as a pointer of type "+this.name);var fe=q.$$.ptrType.registeredClass,De=wo(q.$$.ptr,fe,this.registeredClass);return De}function Ou(Y,q){var fe;if(q===null)return this.isReference&&Qt("null is not a valid "+this.name),this.isSmartPointer?(fe=this.rawConstructor(),Y!==null&&Y.push(this.rawDestructor,fe),fe):0;q.$$||Qt('Cannot pass "'+Va(q)+'" as a '+this.name),q.$$.ptr||Qt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&q.$$.ptrType.isConst&&Qt("Cannot convert argument of type "+(q.$$.smartPtrType?q.$$.smartPtrType.name:q.$$.ptrType.name)+" to parameter type "+this.name);var De=q.$$.ptrType.registeredClass;if(fe=wo(q.$$.ptr,De,this.registeredClass),this.isSmartPointer)switch(q.$$.smartPtr===void 0&&Qt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:q.$$.smartPtrType===this?fe=q.$$.smartPtr:Qt("Cannot convert argument of type "+(q.$$.smartPtrType?q.$$.smartPtrType.name:q.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:fe=q.$$.smartPtr;break;case 2:if(q.$$.smartPtrType===this)fe=q.$$.smartPtr;else{var Fe=q.clone();fe=this.rawShare(fe,Wi.toHandle(function(){Fe.delete()})),Y!==null&&Y.push(this.rawDestructor,fe)}break;default:Qt("Unsupporting sharing policy")}return fe}function rc(Y,q){if(q===null)return this.isReference&&Qt("null is not a valid "+this.name),0;q.$$||Qt('Cannot pass "'+Va(q)+'" as a '+this.name),q.$$.ptr||Qt("Cannot pass deleted object as a pointer of type "+this.name),q.$$.ptrType.isConst&&Qt("Cannot convert argument of type "+q.$$.ptrType.name+" to parameter type "+this.name);var fe=q.$$.ptrType.registeredClass,De=wo(q.$$.ptr,fe,this.registeredClass);return De}function Mu(Y){return this.rawGetPointee&&(Y=this.rawGetPointee(Y)),Y}function Ru(Y){this.rawDestructor&&this.rawDestructor(Y)}function Lr(Y){Y!==null&&Y.delete()}function ic(){Gi.prototype.getPointee=Mu,Gi.prototype.destructor=Ru,Gi.prototype.argPackAdvance=8,Gi.prototype.readValueFromPointer=qe,Gi.prototype.deleteObject=Lr,Gi.prototype.fromWireType=bu}function Gi(Y,q,fe,De,Fe,tt,Je,Ke,G,j,le){this.name=Y,this.registeredClass=q,this.isReference=fe,this.isConst=De,this.isSmartPointer=Fe,this.pointeeType=tt,this.sharingPolicy=Je,this.rawGetPointee=Ke,this.rawConstructor=G,this.rawShare=j,this.rawDestructor=le,!Fe&&q.baseClass===void 0?De?(this.toWireType=Iu,this.destructorFunction=null):(this.toWireType=rc,this.destructorFunction=null):this.toWireType=Ou}function ys(Y,q,fe){o.hasOwnProperty(Y)||ui("Replacing nonexistant public symbol"),o[Y].overloadTable!==void 0&&fe!==void 0||(o[Y]=q,o[Y].argCount=fe)}function ws(Y,q,fe){var De=o["dynCall_"+Y];return fe&&fe.length?De.apply(null,[q].concat(fe)):De.call(null,q)}var hi=[];function el(Y){var q=hi[Y];return q||(Y>=hi.length&&(hi.length=Y+1),hi[Y]=q=me.get(Y)),q}function Si(Y,q,fe){if(Y.includes("j"))return ws(Y,q,fe);var De=el(q).apply(null,fe);return De}function La(Y,q){var fe=[];return function(){return fe.length=0,Object.assign(fe,arguments),Si(Y,q,fe)}}function Cr(Y,q){Y=Ot(Y);function fe(){return Y.includes("j")?La(Y,q):el(q)}var De=fe();return typeof De!="function"&&Qt("unknown function pointer with signature "+Y+": "+q),De}var Aa=void 0;function tl(Y){var q=Ye(Y),fe=Ot(q);return Xe(q),fe}function jn(Y,q){var fe=[],De={};function Fe(tt){if(!De[tt]&&!Et[tt]){if(ct[tt]){ct[tt].forEach(Fe);return}fe.push(tt),De[tt]=!0}}throw q.forEach(Fe),new Aa(Y+": "+fe.map(tl).join([", "]))}function oc(Y,q,fe,De,Fe,tt,Je,Ke,G,j,le,ye,V){le=Ot(le),tt=Cr(Fe,tt),Ke&&(Ke=Cr(Je,Ke)),j&&(j=Cr(G,j)),V=Cr(ye,V);var B=ln(le);na(B,function(){jn("Cannot construct "+le+" due to unbound types",[De])}),Ur([Y,q,fe],De?[De]:[],function(Q){Q=Q[0];var ce,he;De?(ce=Q.registeredClass,he=ce.instancePrototype):he=ro.prototype;var be=Pn(B,function(){if(Object.getPrototypeOf(this)!==Pe)throw new Pr("Use 'new' to construct "+le);if(Oe.constructor_body===void 0)throw new Pr(le+" has no accessible constructor");var mt=Oe.constructor_body[arguments.length];if(mt===void 0)throw new Pr("Tried to invoke ctor of "+le+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Oe.constructor_body).toString()+") parameters instead!");return mt.apply(this,arguments)}),Pe=Object.create(he,{constructor:{value:be}});be.prototype=Pe;var Oe=new yo(le,be,Pe,V,ce,tt,Ke,j),Ne=new Gi(le,Oe,!0,!1,!1),rt=new Gi(le+"*",Oe,!1,!1,!1),lt=new Gi(le+" const*",Oe,!1,!0,!1);return Vi[Y]={pointerType:rt,constPointerType:lt},ys(B,be),[Ne,rt,lt]})}function Na(Y,q){for(var fe=[],De=0;De<Y;De++)fe.push(ee[q+De*4>>2]);return fe}function ac(Y,q){if(!(Y instanceof Function))throw new TypeError("new_ called with constructor type "+typeof Y+" which is not a function");var fe=Pn(Y.name||"unknownFunctionName",function(){});fe.prototype=Y.prototype;var De=new fe,Fe=Y.apply(De,q);return Fe instanceof Object?Fe:De}function nl(Y,q,fe,De,Fe){var tt=q.length;tt<2&&Qt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Je=q[1]!==null&&fe!==null,Ke=!1,G=1;G<q.length;++G)if(q[G]!==null&&q[G].destructorFunction===void 0){Ke=!0;break}for(var j=q[0].name!=="void",le="",ye="",G=0;G<tt-2;++G)le+=(G!==0?", ":"")+"arg"+G,ye+=(G!==0?", ":"")+"arg"+G+"Wired";var V="return function "+ln(Y)+"("+le+`) {
if (arguments.length !== `+(tt-2)+`) {
throwBindingError('function `+Y+" called with ' + arguments.length + ' arguments, expected "+(tt-2)+` args!');
}
`;Ke&&(V+=`var destructors = [];
`);var B=Ke?"destructors":"null",Q=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ce=[Qt,De,Fe,et,q[0],q[1]];Je&&(V+="var thisWired = classParam.toWireType("+B+`, this);
`);for(var G=0;G<tt-2;++G)V+="var arg"+G+"Wired = argType"+G+".toWireType("+B+", arg"+G+"); // "+q[G+2].name+`
`,Q.push("argType"+G),ce.push(q[G+2]);if(Je&&(ye="thisWired"+(ye.length>0?", ":"")+ye),V+=(j?"var rv = ":"")+"invoker(fn"+(ye.length>0?", ":"")+ye+`);
`,Ke)V+=`runDestructors(destructors);
`;else for(var G=Je?1:2;G<q.length;++G){var he=G===1?"thisWired":"arg"+(G-2)+"Wired";q[G].destructorFunction!==null&&(V+=he+"_dtor("+he+"); // "+q[G].name+`
`,Q.push(he+"_dtor"),ce.push(q[G].destructorFunction))}j&&(V+=`var ret = retType.fromWireType(rv);
return ret;
`),V+=`}
`,Q.push(V);var be=ac(Function,Q).apply(null,ce);return be}function Kr(Y,q,fe,De,Fe,tt){E(q>0);var Je=Na(q,fe);Fe=Cr(De,Fe),Ur([],[Y],function(Ke){Ke=Ke[0];var G="constructor "+Ke.name;if(Ke.registeredClass.constructor_body===void 0&&(Ke.registeredClass.constructor_body=[]),Ke.registeredClass.constructor_body[q-1]!==void 0)throw new Pr("Cannot register multiple constructors with identical number of parameters ("+(q-1)+") for class '"+Ke.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Ke.registeredClass.constructor_body[q-1]=()=>{jn("Cannot construct "+Ke.name+" due to unbound types",Je)},Ur([],Je,function(j){return j.splice(1,0,null),Ke.registeredClass.constructor_body[q-1]=nl(G,j,null,Fe,tt),[]}),[]})}function gi(Y,q,fe,De,Fe,tt,Je,Ke){var G=Na(fe,De);q=Ot(q),tt=Cr(Fe,tt),Ur([],[Y],function(j){j=j[0];var le=j.name+"."+q;q.startsWith("@@")&&(q=Symbol[q.substring(2)]),Ke&&j.registeredClass.pureVirtualFunctions.push(q);function ye(){jn("Cannot call "+le+" due to unbound types",G)}var V=j.registeredClass.instancePrototype,B=V[q];return B===void 0||B.overloadTable===void 0&&B.className!==j.name&&B.argCount===fe-2?(ye.argCount=fe-2,ye.className=j.name,V[q]=ye):(Qc(V,q,le),V[q].overloadTable[fe-2]=ye),Ur([],G,function(Q){var ce=nl(le,Q,j,tt,Je);return V[q].overloadTable===void 0?(ce.argCount=fe-2,V[q]=ce):V[q].overloadTable[fe-2]=ce,[]}),[]})}var ra=[],qr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function rl(Y){Y>4&&--qr[Y].refcount===0&&(qr[Y]=void 0,ra.push(Y))}function ka(){for(var Y=0,q=5;q<qr.length;++q)qr[q]!==void 0&&++Y;return Y}function hr(){for(var Y=5;Y<qr.length;++Y)if(qr[Y]!==void 0)return qr[Y];return null}function xs(){o.count_emval_handles=ka,o.get_first_emval=hr}var Wi={toValue:Y=>(Y||Qt("Cannot use deleted val. handle = "+Y),qr[Y].value),toHandle:Y=>{switch(Y){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var q=ra.length?ra.pop():qr.length;return qr[q]={refcount:1,value:Y},q}}}};function Pu(Y,q){q=Ot(q),On(Y,{name:q,fromWireType:function(fe){var De=Wi.toValue(fe);return rl(fe),De},toWireType:function(fe,De){return Wi.toHandle(De)},argPackAdvance:8,readValueFromPointer:qe,destructorFunction:null})}function Va(Y){if(Y===null)return"null";var q=typeof Y;return q==="object"||q==="array"||q==="function"?Y.toString():""+Y}function gr(Y,q){switch(q){case 2:return function(fe){return this.fromWireType(oe[fe>>2])};case 3:return function(fe){return this.fromWireType(de[fe>>3])};default:throw new TypeError("Unknown float type: "+Y)}}function il(Y,q,fe){var De=Mt(fe);q=Ot(q),On(Y,{name:q,fromWireType:function(Fe){return Fe},toWireType:function(Fe,tt){return tt},argPackAdvance:8,readValueFromPointer:gr(q,De),destructorFunction:null})}function sc(Y,q,fe){switch(q){case 0:return fe?function(Fe){return z[Fe]}:function(Fe){return A[Fe]};case 1:return fe?function(Fe){return L[Fe>>1]}:function(Fe){return N[Fe>>1]};case 2:return fe?function(Fe){return H[Fe>>2]}:function(Fe){return ee[Fe>>2]};default:throw new TypeError("Unknown integer type: "+Y)}}function Lu(Y,q,fe,De,Fe){q=Ot(q);var tt=Mt(fe),Je=ye=>ye;if(De===0){var Ke=32-8*fe;Je=ye=>ye<<Ke>>>Ke}var G=q.includes("unsigned"),j=(ye,V)=>{},le;G?le=function(ye,V){return j(V,this.name),V>>>0}:le=function(ye,V){return j(V,this.name),V},On(Y,{name:q,fromWireType:Je,toWireType:le,argPackAdvance:8,readValueFromPointer:sc(q,tt,De!==0),destructorFunction:null})}function Au(Y,q,fe){var De=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Fe=De[q];function tt(Je){Je=Je>>2;var Ke=ee,G=Ke[Je],j=Ke[Je+1];return new Fe(k,j,G)}fe=Ot(fe),On(Y,{name:fe,fromWireType:tt,argPackAdvance:8,readValueFromPointer:tt},{ignoreDuplicateRegistrations:!0})}function Fa(Y,q){q=Ot(q);var fe=q==="std::string";On(Y,{name:q,fromWireType:function(De){var Fe=ee[De>>2],tt=De+4,Je;if(fe)for(var Ke=tt,G=0;G<=Fe;++G){var j=tt+G;if(G==Fe||A[j]==0){var le=j-Ke,ye=I(Ke,le);Je===void 0?Je=ye:(Je+="\0",Je+=ye),Ke=j+1}}else{for(var V=new Array(Fe),G=0;G<Fe;++G)V[G]=String.fromCharCode(A[tt+G]);Je=V.join("")}return Xe(De),Je},toWireType:function(De,Fe){Fe instanceof ArrayBuffer&&(Fe=new Uint8Array(Fe));var tt,Je=typeof Fe=="string";Je||Fe instanceof Uint8Array||Fe instanceof Uint8ClampedArray||Fe instanceof Int8Array||Qt("Cannot pass non-string to std::string"),fe&&Je?tt=P(Fe):tt=Fe.length;var Ke=Be(4+tt+1),G=Ke+4;if(ee[Ke>>2]=tt,fe&&Je)M(Fe,G,tt+1);else if(Je)for(var j=0;j<tt;++j){var le=Fe.charCodeAt(j);le>255&&(Xe(G),Qt("String has UTF-16 code units that do not fit in 8 bits")),A[G+j]=le}else for(var j=0;j<tt;++j)A[G+j]=Fe[j];return De!==null&&De.push(Xe,Ke),Ke},argPackAdvance:8,readValueFromPointer:qe,destructorFunction:function(De){Xe(De)}})}var ol=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function cc(Y,q){for(var fe=Y,De=fe>>1,Fe=De+q/2;!(De>=Fe)&&N[De];)++De;if(fe=De<<1,fe-Y>32&&ol)return ol.decode(A.subarray(Y,fe));for(var tt="",Je=0;!(Je>=q/2);++Je){var Ke=L[Y+Je*2>>1];if(Ke==0)break;tt+=String.fromCharCode(Ke)}return tt}function Nu(Y,q,fe){if(fe===void 0&&(fe=2147483647),fe<2)return 0;fe-=2;for(var De=q,Fe=fe<Y.length*2?fe/2:Y.length,tt=0;tt<Fe;++tt){var Je=Y.charCodeAt(tt);L[q>>1]=Je,q+=2}return L[q>>1]=0,q-De}function al(Y){return Y.length*2}function ku(Y,q){for(var fe=0,De="";!(fe>=q/4);){var Fe=H[Y+fe*4>>2];if(Fe==0)break;if(++fe,Fe>=65536){var tt=Fe-65536;De+=String.fromCharCode(55296|tt>>10,56320|tt&1023)}else De+=String.fromCharCode(Fe)}return De}function Vu(Y,q,fe){if(fe===void 0&&(fe=2147483647),fe<4)return 0;for(var De=q,Fe=De+fe-4,tt=0;tt<Y.length;++tt){var Je=Y.charCodeAt(tt);if(Je>=55296&&Je<=57343){var Ke=Y.charCodeAt(++tt);Je=65536+((Je&1023)<<10)|Ke&1023}if(H[q>>2]=Je,q+=4,q+4>Fe)break}return H[q>>2]=0,q-De}function Fu(Y){for(var q=0,fe=0;fe<Y.length;++fe){var De=Y.charCodeAt(fe);De>=55296&&De<=57343&&++fe,q+=4}return q}function Uu(Y,q,fe){fe=Ot(fe);var De,Fe,tt,Je,Ke;q===2?(De=cc,Fe=Nu,Je=al,tt=()=>N,Ke=1):q===4&&(De=ku,Fe=Vu,Je=Fu,tt=()=>ee,Ke=2),On(Y,{name:fe,fromWireType:function(G){for(var j=ee[G>>2],le=tt(),ye,V=G+4,B=0;B<=j;++B){var Q=G+4+B*q;if(B==j||le[Q>>Ke]==0){var ce=Q-V,he=De(V,ce);ye===void 0?ye=he:(ye+="\0",ye+=he),V=Q+q}}return Xe(G),ye},toWireType:function(G,j){typeof j!="string"&&Qt("Cannot pass non-string to C++ string type "+fe);var le=Je(j),ye=Be(4+le+q);return ee[ye>>2]=le>>Ke,Fe(j,ye+4,le+q),G!==null&&G.push(Xe,ye),ye},argPackAdvance:8,readValueFromPointer:qe,destructorFunction:function(G){Xe(G)}})}function Bu(Y,q,fe,De,Fe,tt){Ge[Y]={name:Ot(q),rawConstructor:Cr(fe,De),rawDestructor:Cr(Fe,tt),fields:[]}}function sl(Y,q,fe,De,Fe,tt,Je,Ke,G,j){Ge[Y].fields.push({fieldName:Ot(q),getterReturnType:fe,getter:Cr(De,Fe),getterContext:tt,setterArgumentType:Je,setter:Cr(Ke,G),setterContext:j})}function Gu(Y,q){q=Ot(q),On(Y,{isVoid:!0,name:q,argPackAdvance:0,fromWireType:function(){},toWireType:function(fe,De){}})}var Wu={};function cl(Y){var q=Wu[Y];return q===void 0?Ot(Y):q}function ll(){return typeof globalThis=="object"?globalThis:function(){return Function}()("return this")()}function zu(Y){return Y===0?Wi.toHandle(ll()):(Y=cl(Y),Wi.toHandle(ll()[Y]))}function ul(Y){Y>4&&(qr[Y].refcount+=1)}function fl(Y,q){var fe=Et[Y];return fe===void 0&&Qt(q+" has unknown type "+tl(Y)),fe}function lc(Y){for(var q="",fe=0;fe<Y;++fe)q+=(fe!==0?", ":"")+"arg"+fe;for(var De=()=>ee,Fe="return function emval_allocator_"+Y+`(constructor, argTypes, args) {
  var HEAPU32 = getMemory();
`,fe=0;fe<Y;++fe)Fe+="var argType"+fe+" = requireRegisteredType(HEAPU32[((argTypes)>>2)], 'parameter "+fe+`');
var arg`+fe+" = argType"+fe+`.readValueFromPointer(args);
args += argType`+fe+`['argPackAdvance'];
argTypes += 4;
`;return Fe+="var obj = new constructor("+q+`);
return valueToHandle(obj);
}
`,new Function("requireRegisteredType","Module","valueToHandle","getMemory",Fe)(fl,o,Wi.toHandle,De)}var dl={};function $u(Y,q,fe,De){Y=Wi.toValue(Y);var Fe=dl[q];return Fe||(Fe=lc(q),dl[q]=Fe),Fe(Y,fe,De)}function hl(Y,q){Y=fl(Y,"_emval_take_value");var fe=Y.readValueFromPointer(q);return Wi.toHandle(fe)}function ju(){je("")}function uc(){return 2147483648}function Hu(){return uc()}function Ku(Y,q,fe){A.copyWithin(Y,q,q+fe)}function qu(Y){try{return T.grow(Y-k.byteLength+65535>>>16),ue(T.buffer),1}catch{}}function Xu(Y){var q=A.length;Y=Y>>>0;var fe=uc();if(Y>fe)return!1;let De=(G,j)=>G+(j-G%j)%j;for(var Fe=1;Fe<=4;Fe*=2){var tt=q*(1+.2/Fe);tt=Math.min(tt,Y+100663296);var Je=Math.min(fe,De(Math.max(Y,tt),65536)),Ke=qu(Je);if(Ke)return!0}return!1}var fc={};function Yu(){return l||"./this.program"}function Ao(){if(!Ao.strings){var Y=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",q={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:Y,_:Yu()};for(var fe in fc)fc[fe]===void 0?delete q[fe]:q[fe]=fc[fe];var De=[];for(var fe in q)De.push(fe+"="+q[fe]);Ao.strings=De}return Ao.strings}function Cs(Y,q,fe){for(var De=0;De<Y.length;++De)z[q++>>0]=Y.charCodeAt(De);z[q>>0]=0}function io(Y,q){var fe=0;return Ao().forEach(function(De,Fe){var tt=q+fe;ee[Y+Fe*4>>2]=tt,Cs(De,tt),fe+=De.length+1}),0}function ia(Y,q){var fe=Ao();ee[Y>>2]=fe.length;var De=0;return fe.forEach(function(Fe){De+=Fe.length+1}),ee[q>>2]=De,0}function gl(Y){return 52}function dc(Y,q,fe,De,Fe){return 70}var pl=[null,[],[]];function Ss(Y,q){var fe=pl[Y];q===0||q===10?((Y===1?x:C)(b(fe,0)),fe.length=0):fe.push(q)}function ml(Y,q,fe,De){for(var Fe=0,tt=0;tt<fe;tt++){var Je=ee[q>>2],Ke=ee[q+4>>2];q+=8;for(var G=0;G<Ke;G++)Ss(Y,A[Je+G]);Fe+=Ke}return ee[De>>2]=Fe,0}function J(Y){var q=o["_"+Y];return q}function te(Y,q){z.set(Y,q)}function pe(Y,q,fe,De,Fe){var tt={string:Q=>{var ce=0;if(Q!=null&&Q!==0){var he=(Q.length<<2)+1;ce=ft(he),M(Q,ce,he)}return ce},array:Q=>{var ce=ft(Q.length);return te(Q,ce),ce}};function Je(Q){return q==="string"?I(Q):q==="boolean"?!!Q:Q}var Ke=J(Y),G=[],j=0;if(De)for(var le=0;le<De.length;le++){var ye=tt[fe[le]];ye?(j===0&&(j=He()),G[le]=ye(De[le])):G[le]=De[le]}var V=Ke.apply(null,G);function B(Q){return j!==0&&Ze(j),Je(Q)}return V=B(V),V}Tn=o.InternalError=zt(Error,"InternalError"),pn(),Pr=o.BindingError=zt(Error,"BindingError"),ta(),nc(),ic(),Aa=o.UnboundTypeError=zt(Error,"UnboundTypeError"),xs();var Re={D:Se,e:Ue,t:nt,B:fi,r:oc,q:Kr,b:gi,A:Pu,l:il,d:Lu,a:Au,k:Fa,f:Uu,g:Bu,c:sl,C:Gu,h:rl,o:zu,m:ul,n:$u,p:hl,i:ju,v:Hu,z:Ku,u:Xu,w:io,x:ia,y:gl,s:dc,j:ml};re(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.F).apply(null,arguments)};var Be=o._malloc=function(){return(Be=o._malloc=o.asm.H).apply(null,arguments)},Xe=o._free=function(){return(Xe=o._free=o.asm.I).apply(null,arguments)},Ye=o.___getTypeName=function(){return(Ye=o.___getTypeName=o.asm.J).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.K).apply(null,arguments)};var He=o.stackSave=function(){return(He=o.stackSave=o.asm.L).apply(null,arguments)},Ze=o.stackRestore=function(){return(Ze=o.stackRestore=o.asm.M).apply(null,arguments)},ft=o.stackAlloc=function(){return(ft=o.stackAlloc=o.asm.N).apply(null,arguments)},Ct=o.___cxa_is_pointer_type=function(){return(Ct=o.___cxa_is_pointer_type=o.asm.O).apply(null,arguments)};o.dynCall_iji=function(){return(o.dynCall_iji=o.asm.P).apply(null,arguments)},o.dynCall_jji=function(){return(o.dynCall_jji=o.asm.Q).apply(null,arguments)},o.dynCall_iiji=function(){return(o.dynCall_iiji=o.asm.R).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.S).apply(null,arguments)},o.ccall=pe;var Dt;xe=function Y(){Dt||Bt(),Dt||(xe=Y)};function Bt(Y){if(ne>0||(F(),ne>0))return;function q(){Dt||(Dt=!0,o.calledRun=!0,!_&&(O(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),$()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),q()},1)):q()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Bt(),i.ready}})();t.exports=r})(hk);var o0e=hk.exports;const a0e=Ys(o0e),s0e=new URL("/dicm-viewer-test/assets/openjpegwasm_decode-C4nnCcr6.wasm",import.meta.url),ug={codec:void 0,decoder:void 0,decodeConfig:{}};function c0e(t){if(ug.decodeConfig=t,ug.codec)return Promise.resolve();const e=a0e({locateFile:r=>r.endsWith(".wasm")?s0e.toString():r});return new Promise((r,n)=>{e.then(i=>{ug.codec=i,ug.decoder=new i.J2KDecoder,r()},n)})}async function tD(t,e){await c0e();const r=ug.decoder,n=r.getEncodedBuffer(t.length);n.set(t),r.decode();const i=r.getFrameInfo(),o=r.getDecodedBuffer();new Uint8Array(o.length).set(o);const s=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,c=r.getNumDecompositions(),l=r.getNumLayers(),f=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],u=r.getIsReversible(),d=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,h=`${r.getTileSize().width} x ${r.getTileSize().height}`,g=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,p=r.getColorSpace(),v=`${o.length.toLocaleString()} bytes`,w=`${(o.length/n.length).toFixed(2)}:1`,m={columns:i.width,rows:i.height,bitsPerPixel:i.bitsPerSample,signed:i.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:i.componentCount},y=l0e(i,o),x={imageOffset:s,numDecompositions:c,numLayers:l,progessionOrder:f,reversible:u,blockDimensions:d,tileSize:h,tileOffset:g,colorTransform:p,decodedSize:v,compressionRatio:w};return{...e,pixelData:y,imageInfo:m,encodeOptions:x,...x,...m}}function l0e(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}var gk={exports:{}};(function(t,e){var r=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var o=typeof o<"u"?o:{},a,s;o.ready=new Promise(function(G,j){a=G,s=j});var c=Object.assign({},o),l=typeof window=="object",f=typeof importScripts=="function",u=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",d="";function h(G){return o.locateFile?o.locateFile(G,d):d+G}var g,p,v;if(u){var w=zs,m=zs;f?d=m.dirname(d)+"/":d=__dirname+"/",g=(G,j)=>(G=ae(G)?new URL(G):m.normalize(G),w.readFileSync(G,j?void 0:"utf8")),v=G=>{var j=g(G,!0);return j.buffer||(j=new Uint8Array(j)),j},p=(G,j,le)=>{G=ae(G)?new URL(G):m.normalize(G),w.readFile(G,function(ye,V){ye?le(ye):j(V.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(G){if(!(G instanceof re))throw G}),process.on("unhandledRejection",function(G){throw G}),o.inspect=function(){return"[Emscripten Module object]"}}else(l||f)&&(f?d=self.location.href:typeof document<"u"&&document.currentScript&&(d=document.currentScript.src),n&&(d=n),d.indexOf("blob:")!==0?d=d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):d="",g=G=>{var j=new XMLHttpRequest;return j.open("GET",G,!1),j.send(null),j.responseText},f&&(v=G=>{var j=new XMLHttpRequest;return j.open("GET",G,!1),j.responseType="arraybuffer",j.send(null),new Uint8Array(j.response)}),p=(G,j,le)=>{var ye=new XMLHttpRequest;ye.open("GET",G,!0),ye.responseType="arraybuffer",ye.onload=()=>{if(ye.status==200||ye.status==0&&ye.response){j(ye.response);return}le()},ye.onerror=le,ye.send(null)});var y=o.print||console.log.bind(console),x=o.printErr||console.warn.bind(console);Object.assign(o,c),c=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit;var C;o.wasmBinary&&(C=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&Le("no native wasm support detected");var S,T=!1;function _(G,j){G||Le(j)}var E=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function D(G,j,le){for(var ye=j+le,V=j;G[V]&&!(V>=ye);)++V;if(V-j>16&&G.buffer&&E)return E.decode(G.subarray(j,V));for(var B="";j<V;){var Q=G[j++];if(!(Q&128)){B+=String.fromCharCode(Q);continue}var ce=G[j++]&63;if((Q&224)==192){B+=String.fromCharCode((Q&31)<<6|ce);continue}var he=G[j++]&63;if((Q&240)==224?Q=(Q&15)<<12|ce<<6|he:Q=(Q&7)<<18|ce<<12|he<<6|G[j++]&63,Q<65536)B+=String.fromCharCode(Q);else{var be=Q-65536;B+=String.fromCharCode(55296|be>>10,56320|be&1023)}}return B}function b(G,j){return G?D(z,G,j):""}function I(G,j,le,ye){if(!(ye>0))return 0;for(var V=le,B=le+ye-1,Q=0;Q<G.length;++Q){var ce=G.charCodeAt(Q);if(ce>=55296&&ce<=57343){var he=G.charCodeAt(++Q);ce=65536+((ce&1023)<<10)|he&1023}if(ce<=127){if(le>=B)break;j[le++]=ce}else if(ce<=2047){if(le+1>=B)break;j[le++]=192|ce>>6,j[le++]=128|ce&63}else if(ce<=65535){if(le+2>=B)break;j[le++]=224|ce>>12,j[le++]=128|ce>>6&63,j[le++]=128|ce&63}else{if(le+3>=B)break;j[le++]=240|ce>>18,j[le++]=128|ce>>12&63,j[le++]=128|ce>>6&63,j[le++]=128|ce&63}}return j[le]=0,le-V}function R(G,j,le){return I(G,z,j,le)}function M(G){for(var j=0,le=0;le<G.length;++le){var ye=G.charCodeAt(le);ye<=127?j++:ye<=2047?j+=2:ye>=55296&&ye<=57343?(j+=4,++le):j+=3}return j}var P,k,z,A,L,N,H,ee,oe;function de(G){P=G,o.HEAP8=k=new Int8Array(G),o.HEAP16=A=new Int16Array(G),o.HEAP32=N=new Int32Array(G),o.HEAPU8=z=new Uint8Array(G),o.HEAPU16=L=new Uint16Array(G),o.HEAPU32=H=new Uint32Array(G),o.HEAPF32=ee=new Float32Array(G),o.HEAPF64=oe=new Float64Array(G)}o.INITIAL_MEMORY;var ue,me=[],Ee=[],_e=[];function Ce(){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)$(o.preRun.shift());it(me)}function F(){it(Ee)}function O(){if(o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;)X(o.postRun.shift());it(_e)}function $(G){me.unshift(G)}function W(G){Ee.unshift(G)}function X(G){_e.unshift(G)}var Z=0,ne=null;function xe(G){Z++,o.monitorRunDependencies&&o.monitorRunDependencies(Z)}function Ie(G){if(Z--,o.monitorRunDependencies&&o.monitorRunDependencies(Z),Z==0&&ne){var j=ne;ne=null,j()}}function Le(G){o.onAbort&&o.onAbort(G),G="Aborted("+G+")",x(G),T=!0,G+=". Build with -sASSERTIONS for more info.";var j=new WebAssembly.RuntimeError(G);throw s(j),j}var je="data:application/octet-stream;base64,";function ie(G){return G.startsWith(je)}function ae(G){return G.startsWith("file://")}var ve;ve="openjphjs.wasm",ie(ve)||(ve=h(ve));function se(G){try{if(G==ve&&C)return new Uint8Array(C);if(v)return v(G);throw"both async and sync fetching of the wasm failed"}catch(j){Le(j)}}function ge(){if(!C&&(l||f)){if(typeof fetch=="function"&&!ae(ve))return fetch(ve,{credentials:"same-origin"}).then(function(G){if(!G.ok)throw"failed to load wasm binary file at '"+ve+"'";return G.arrayBuffer()}).catch(function(){return se(ve)});if(p)return new Promise(function(G,j){p(ve,function(le){G(new Uint8Array(le))},j)})}return Promise.resolve().then(function(){return se(ve)})}function Ve(){var G={a:ml};function j(Q,ce){var he=Q.exports;o.asm=he,S=o.asm.P,de(S.buffer),ue=o.asm.T,W(o.asm.Q),Ie()}xe();function le(Q){j(Q.instance)}function ye(Q){return ge().then(function(ce){return WebAssembly.instantiate(ce,G)}).then(function(ce){return ce}).then(Q,function(ce){x("failed to asynchronously prepare wasm: "+ce),Le(ce)})}function V(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!ie(ve)&&!ae(ve)&&!u&&typeof fetch=="function"?fetch(ve,{credentials:"same-origin"}).then(function(Q){var ce=WebAssembly.instantiateStreaming(Q,G);return ce.then(le,function(he){return x("wasm streaming compile failed: "+he),x("falling back to ArrayBuffer instantiation"),ye(le)})}):ye(le)}if(o.instantiateWasm)try{var B=o.instantiateWasm(G,j);return B}catch(Q){x("Module.instantiateWasm callback failed with error: "+Q),s(Q)}return V().catch(s),{}}function re(G){this.name="ExitStatus",this.message="Program terminated with exit("+G+")",this.status=G}function it(G){for(;G.length>0;)G.shift()(o)}var ut=[];function ot(G){G.add_ref()}function Se(G){var j=new ct(G);return j.get_caught()||j.set_caught(!0),j.set_rethrown(!1),ut.push(j),ot(j),j.get_exception_ptr()}var Ge=0,et=[];function qe(G){var j=et[G];return j||(G>=et.length&&(et.length=G+1),et[G]=j=ue.get(G)),j}function st(G){if(G.release_ref()&&!G.get_rethrown()){var j=G.get_destructor();j&&qe(j)(G.excPtr),te(G.excPtr)}}function Et(){_setThrew(0);var G=ut.pop();st(G),Ge=0}function ct(G){this.excPtr=G,this.ptr=G-24,this.set_type=function(j){H[this.ptr+4>>2]=j},this.get_type=function(){return H[this.ptr+4>>2]},this.set_destructor=function(j){H[this.ptr+8>>2]=j},this.get_destructor=function(){return H[this.ptr+8>>2]},this.set_refcount=function(j){N[this.ptr>>2]=j},this.set_caught=function(j){j=j?1:0,k[this.ptr+12>>0]=j},this.get_caught=function(){return k[this.ptr+12>>0]!=0},this.set_rethrown=function(j){j=j?1:0,k[this.ptr+13>>0]=j},this.get_rethrown=function(){return k[this.ptr+13>>0]!=0},this.init=function(j,le){this.set_adjusted_ptr(0),this.set_type(j),this.set_destructor(le),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var j=N[this.ptr>>2];N[this.ptr>>2]=j+1},this.release_ref=function(){var j=N[this.ptr>>2];return N[this.ptr>>2]=j-1,j===1},this.set_adjusted_ptr=function(j){H[this.ptr+16>>2]=j},this.get_adjusted_ptr=function(){return H[this.ptr+16>>2]},this.get_exception_ptr=function(){var j=ft(this.get_type());if(j)return H[this.excPtr>>2];var le=this.get_adjusted_ptr();return le!==0?le:this.excPtr}}function bt(G){throw Ge||(Ge=G),G}function It(){var G=Ge;if(!G)return Be(0),0;var j=new ct(G);j.set_adjusted_ptr(G);var le=j.get_type();if(!le)return Be(0),G;for(var ye=0;ye<arguments.length;ye++){var V=arguments[ye];if(V===0||V===le)break;var B=j.ptr+16;if(Ze(V,le,B))return Be(V),G}return Be(le),G}function ln(){var G=Ge;if(!G)return Be(0),0;var j=new ct(G);j.set_adjusted_ptr(G);var le=j.get_type();if(!le)return Be(0),G;for(var ye=0;ye<arguments.length;ye++){var V=arguments[ye];if(V===0||V===le)break;var B=j.ptr+16;if(Ze(V,le,B))return Be(V),G}return Be(le),G}function Pn(G,j,le){var ye=new ct(G);throw ye.init(j,le),Ge=G,G}var zt={};function Tn(G){for(;G.length;){var j=G.pop(),le=G.pop();le(j)}}function ui(G){return this.fromWireType(N[G>>2])}var Ur={},Ue={},nt={},Mt=48,pn=57;function ni(G){if(G===void 0)return"_unknown";G=G.replace(/[^a-zA-Z0-9_]/g,"$");var j=G.charCodeAt(0);return j>=Mt&&j<=pn?"_"+G:G}function Ot(G,j){return G=ni(G),new Function("body","return function "+G+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(j)}function Pr(G,j){var le=Ot(j,function(ye){this.name=j,this.message=ye;var V=new Error(ye).stack;V!==void 0&&(this.stack=this.toString()+`
`+V.replace(/^Error(:[^\n]*)?\n/,""))});return le.prototype=Object.create(G.prototype),le.prototype.constructor=le,le.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},le}var Qt=void 0;function On(G){throw new Qt(G)}function fi(G,j,le){G.forEach(function(ce){nt[ce]=j});function ye(ce){var he=le(ce);he.length!==G.length&&On("Mismatched type converter count");for(var be=0;be<G.length;++be)Vi(G[be],he[be])}var V=new Array(j.length),B=[],Q=0;j.forEach((ce,he)=>{Ue.hasOwnProperty(ce)?V[he]=Ue[ce]:(B.push(ce),Ur.hasOwnProperty(ce)||(Ur[ce]=[]),Ur[ce].push(()=>{V[he]=Ue[ce],++Q,Q===B.length&&ye(V)}))}),B.length===0&&ye(V)}function en(G){var j=zt[G];delete zt[G];var le=j.rawConstructor,ye=j.rawDestructor,V=j.fields,B=V.map(Q=>Q.getterReturnType).concat(V.map(Q=>Q.setterArgumentType));fi([G],B,Q=>{var ce={};return V.forEach((he,be)=>{var Pe=he.fieldName,Oe=Q[be],Ne=he.getter,rt=he.getterContext,lt=Q[be+V.length],mt=he.setter,Rt=he.setterContext;ce[Pe]={read:Ln=>Oe.fromWireType(Ne(rt,Ln)),write:(Ln,un)=>{var Mn=[];mt(Rt,Ln,lt.toWireType(Mn,un)),Tn(Mn)}}}),[{name:j.name,fromWireType:function(he){var be={};for(var Pe in ce)be[Pe]=ce[Pe].read(he);return ye(he),be},toWireType:function(he,be){for(var Pe in ce)if(!(Pe in be))throw new TypeError('Missing field:  "'+Pe+'"');var Oe=le();for(Pe in ce)ce[Pe].write(Oe,be[Pe]);return he!==null&&he.push(ye,Oe),Oe},argPackAdvance:8,readValueFromPointer:ui,destructorFunction:ye}]})}function Ci(G,j,le,ye,V){}function Zo(G){switch(G){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+G)}}function tc(){for(var G=new Array(256),j=0;j<256;++j)G[j]=String.fromCharCode(j);ms=G}var ms=void 0;function dr(G){for(var j="",le=G;z[le];)j+=ms[z[le++]];return j}var ki=void 0;function tn(G){throw new ki(G)}function Vi(G,j,le={}){if(!("argPackAdvance"in j))throw new TypeError("registerType registeredInstance requires argPackAdvance");var ye=j.name;if(G||tn('type "'+ye+'" must have a positive integer typeid pointer'),Ue.hasOwnProperty(G)){if(le.ignoreDuplicateRegistrations)return;tn("Cannot register type '"+ye+"' twice")}if(Ue[G]=j,delete nt[G],Ur.hasOwnProperty(G)){var V=Ur[G];delete Ur[G],V.forEach(B=>B())}}function Qo(G,j,le,ye,V){var B=Zo(le);j=dr(j),Vi(G,{name:j,fromWireType:function(Q){return!!Q},toWireType:function(Q,ce){return ce?ye:V},argPackAdvance:8,readValueFromPointer:function(Q){var ce;if(le===1)ce=k;else if(le===2)ce=A;else if(le===4)ce=N;else throw new TypeError("Unknown boolean type size: "+j);return this.fromWireType(ce[Q>>B])},destructorFunction:null})}function vs(G){if(!(this instanceof Lr)||!(G instanceof Lr))return!1;for(var j=this.$$.ptrType.registeredClass,le=this.$$.ptr,ye=G.$$.ptrType.registeredClass,V=G.$$.ptr;j.baseClass;)le=j.upcast(le),j=j.baseClass;for(;ye.baseClass;)V=ye.upcast(V),ye=ye.baseClass;return j===ye&&le===V}function Fi(G){return{count:G.count,deleteScheduled:G.deleteScheduled,preservePointerOnDelete:G.preservePointerOnDelete,ptr:G.ptr,ptrType:G.ptrType,smartPtr:G.smartPtr,smartPtrType:G.smartPtrType}}function Oa(G){function j(le){return le.$$.ptrType.registeredClass.name}tn(j(G)+" instance already deleted")}var Lo=!1;function Ui(G){}function nc(G){G.smartPtr?G.smartPtrType.rawDestructor(G.smartPtr):G.ptrType.registeredClass.rawDestructor(G.ptr)}function Bi(G){G.count.value-=1;var j=G.count.value===0;j&&nc(G)}function Ma(G,j,le){if(j===le)return G;if(le.baseClass===void 0)return null;var ye=Ma(G,j,le.baseClass);return ye===null?null:le.downcast(ye)}var Zc={};function di(){return Object.keys(ta).length}function bu(){var G=[];for(var j in ta)ta.hasOwnProperty(j)&&G.push(ta[j]);return G}var no=[];function ea(){for(;no.length;){var G=no.pop();G.$$.deleteScheduled=!1,G.delete()}}var Ra=void 0;function Pa(G){Ra=G,no.length&&Ra&&Ra(ea)}function vo(){o.getInheritedInstanceCount=di,o.getLiveInheritedInstances=bu,o.flushPendingDeletes=ea,o.setDelayFunction=Pa}var ta={};function ro(G,j){for(j===void 0&&tn("ptr should not be undefined");G.baseClass;)j=G.upcast(j),G=G.baseClass;return j}function Qc(G,j){return j=ro(G,j),ta[j]}function na(G,j){(!j.ptrType||!j.ptr)&&On("makeClassHandle requires ptr and ptrType");var le=!!j.smartPtrType,ye=!!j.smartPtr;return le!==ye&&On("Both smartPtrType and smartPtr must be specified"),j.count={value:1},wo(Object.create(G,{$$:{value:j}}))}function yo(G){var j=this.getPointee(G);if(!j)return this.destructor(G),null;var le=Qc(this.registeredClass,j);if(le!==void 0){if(le.$$.count.value===0)return le.$$.ptr=j,le.$$.smartPtr=G,le.clone();var ye=le.clone();return this.destructor(G),ye}function V(){return this.isSmartPointer?na(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:j,smartPtrType:this,smartPtr:G}):na(this.registeredClass.instancePrototype,{ptrType:this,ptr:G})}var B=this.registeredClass.getActualType(j),Q=Zc[B];if(!Q)return V.call(this);var ce;this.isConst?ce=Q.constPointerType:ce=Q.pointerType;var he=Ma(j,this.registeredClass,ce.registeredClass);return he===null?V.call(this):this.isSmartPointer?na(ce.registeredClass.instancePrototype,{ptrType:ce,ptr:he,smartPtrType:this,smartPtr:G}):na(ce.registeredClass.instancePrototype,{ptrType:ce,ptr:he})}function wo(G){return typeof FinalizationRegistry>"u"?(wo=j=>j,G):(Lo=new FinalizationRegistry(j=>{Bi(j.$$)}),wo=j=>{var le=j.$$,ye=!!le.smartPtr;if(ye){var V={$$:le};Lo.register(j,V,j)}return j},Ui=j=>Lo.unregister(j),wo(G))}function Iu(){if(this.$$.ptr||Oa(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var G=wo(Object.create(Object.getPrototypeOf(this),{$$:{value:Fi(this.$$)}}));return G.$$.count.value+=1,G.$$.deleteScheduled=!1,G}function Ou(){this.$$.ptr||Oa(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&tn("Object already scheduled for deletion"),Ui(this),Bi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function rc(){return!this.$$.ptr}function Mu(){return this.$$.ptr||Oa(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&tn("Object already scheduled for deletion"),no.push(this),no.length===1&&Ra&&Ra(ea),this.$$.deleteScheduled=!0,this}function Ru(){Lr.prototype.isAliasOf=vs,Lr.prototype.clone=Iu,Lr.prototype.delete=Ou,Lr.prototype.isDeleted=rc,Lr.prototype.deleteLater=Mu}function Lr(){}function ic(G,j,le){if(G[j].overloadTable===void 0){var ye=G[j];G[j]=function(){return G[j].overloadTable.hasOwnProperty(arguments.length)||tn("Function '"+le+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+G[j].overloadTable+")!"),G[j].overloadTable[arguments.length].apply(this,arguments)},G[j].overloadTable=[],G[j].overloadTable[ye.argCount]=ye}}function Gi(G,j,le){o.hasOwnProperty(G)?((le===void 0||o[G].overloadTable!==void 0&&o[G].overloadTable[le]!==void 0)&&tn("Cannot register public name '"+G+"' twice"),ic(o,G,G),o.hasOwnProperty(le)&&tn("Cannot register multiple overloads of a function with the same number of arguments ("+le+")!"),o[G].overloadTable[le]=j):(o[G]=j,le!==void 0&&(o[G].numArguments=le))}function ys(G,j,le,ye,V,B,Q,ce){this.name=G,this.constructor=j,this.instancePrototype=le,this.rawDestructor=ye,this.baseClass=V,this.getActualType=B,this.upcast=Q,this.downcast=ce,this.pureVirtualFunctions=[]}function ws(G,j,le){for(;j!==le;)j.upcast||tn("Expected null or instance of "+le.name+", got an instance of "+j.name),G=j.upcast(G),j=j.baseClass;return G}function hi(G,j){if(j===null)return this.isReference&&tn("null is not a valid "+this.name),0;j.$$||tn('Cannot pass "'+cc(j)+'" as a '+this.name),j.$$.ptr||tn("Cannot pass deleted object as a pointer of type "+this.name);var le=j.$$.ptrType.registeredClass,ye=ws(j.$$.ptr,le,this.registeredClass);return ye}function el(G,j){var le;if(j===null)return this.isReference&&tn("null is not a valid "+this.name),this.isSmartPointer?(le=this.rawConstructor(),G!==null&&G.push(this.rawDestructor,le),le):0;j.$$||tn('Cannot pass "'+cc(j)+'" as a '+this.name),j.$$.ptr||tn("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&j.$$.ptrType.isConst&&tn("Cannot convert argument of type "+(j.$$.smartPtrType?j.$$.smartPtrType.name:j.$$.ptrType.name)+" to parameter type "+this.name);var ye=j.$$.ptrType.registeredClass;if(le=ws(j.$$.ptr,ye,this.registeredClass),this.isSmartPointer)switch(j.$$.smartPtr===void 0&&tn("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:j.$$.smartPtrType===this?le=j.$$.smartPtr:tn("Cannot convert argument of type "+(j.$$.smartPtrType?j.$$.smartPtrType.name:j.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:le=j.$$.smartPtr;break;case 2:if(j.$$.smartPtrType===this)le=j.$$.smartPtr;else{var V=j.clone();le=this.rawShare(le,Fa.toHandle(function(){V.delete()})),G!==null&&G.push(this.rawDestructor,le)}break;default:tn("Unsupporting sharing policy")}return le}function Si(G,j){if(j===null)return this.isReference&&tn("null is not a valid "+this.name),0;j.$$||tn('Cannot pass "'+cc(j)+'" as a '+this.name),j.$$.ptr||tn("Cannot pass deleted object as a pointer of type "+this.name),j.$$.ptrType.isConst&&tn("Cannot convert argument of type "+j.$$.ptrType.name+" to parameter type "+this.name);var le=j.$$.ptrType.registeredClass,ye=ws(j.$$.ptr,le,this.registeredClass);return ye}function La(G){return this.rawGetPointee&&(G=this.rawGetPointee(G)),G}function Cr(G){this.rawDestructor&&this.rawDestructor(G)}function Aa(G){G!==null&&G.delete()}function tl(){jn.prototype.getPointee=La,jn.prototype.destructor=Cr,jn.prototype.argPackAdvance=8,jn.prototype.readValueFromPointer=ui,jn.prototype.deleteObject=Aa,jn.prototype.fromWireType=yo}function jn(G,j,le,ye,V,B,Q,ce,he,be,Pe){this.name=G,this.registeredClass=j,this.isReference=le,this.isConst=ye,this.isSmartPointer=V,this.pointeeType=B,this.sharingPolicy=Q,this.rawGetPointee=ce,this.rawConstructor=he,this.rawShare=be,this.rawDestructor=Pe,!V&&j.baseClass===void 0?ye?(this.toWireType=hi,this.destructorFunction=null):(this.toWireType=Si,this.destructorFunction=null):this.toWireType=el}function oc(G,j,le){o.hasOwnProperty(G)||On("Replacing nonexistant public symbol"),o[G].overloadTable!==void 0&&le!==void 0?o[G].overloadTable[le]=j:(o[G]=j,o[G].argCount=le)}function Na(G,j,le){var ye=o["dynCall_"+G];return le&&le.length?ye.apply(null,[j].concat(le)):ye.call(null,j)}function ac(G,j,le){if(G.includes("j"))return Na(G,j,le);var ye=qe(j).apply(null,le);return ye}function nl(G,j){var le=[];return function(){return le.length=0,Object.assign(le,arguments),ac(G,j,le)}}function Kr(G,j){G=dr(G);function le(){return G.includes("j")?nl(G,j):qe(j)}var ye=le();return typeof ye!="function"&&tn("unknown function pointer with signature "+G+": "+j),ye}var gi=void 0;function ra(G){var j=Re(G),le=dr(j);return pe(j),le}function qr(G,j){var le=[],ye={};function V(B){if(!ye[B]&&!Ue[B]){if(nt[B]){nt[B].forEach(V);return}le.push(B),ye[B]=!0}}throw j.forEach(V),new gi(G+": "+le.map(ra).join([", "]))}function rl(G,j,le,ye,V,B,Q,ce,he,be,Pe,Oe,Ne){Pe=dr(Pe),B=Kr(V,B),ce&&(ce=Kr(Q,ce)),be&&(be=Kr(he,be)),Ne=Kr(Oe,Ne);var rt=ni(Pe);Gi(rt,function(){qr("Cannot construct "+Pe+" due to unbound types",[ye])}),fi([G,j,le],ye?[ye]:[],function(lt){lt=lt[0];var mt,Rt;ye?(mt=lt.registeredClass,Rt=mt.instancePrototype):Rt=Lr.prototype;var Ln=Ot(rt,function(){if(Object.getPrototypeOf(this)!==un)throw new ki("Use 'new' to construct "+Pe);if(Mn.constructor_body===void 0)throw new ki(Pe+" has no accessible constructor");var oa=Mn.constructor_body[arguments.length];if(oa===void 0)throw new ki("Tried to invoke ctor of "+Pe+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Mn.constructor_body).toString()+") parameters instead!");return oa.apply(this,arguments)}),un=Object.create(Rt,{constructor:{value:Ln}});Ln.prototype=un;var Mn=new ys(Pe,Ln,un,Ne,mt,B,ce,be),Ti=new jn(Pe,Mn,!0,!1,!1),No=new jn(Pe+"*",Mn,!1,!1,!1),vl=new jn(Pe+" const*",Mn,!1,!0,!1);return Zc[G]={pointerType:No,constPointerType:vl},oc(rt,Ln),[Ti,No,vl]})}function ka(G,j){for(var le=[],ye=0;ye<G;ye++)le.push(H[j+ye*4>>2]);return le}function hr(G,j){if(!(G instanceof Function))throw new TypeError("new_ called with constructor type "+typeof G+" which is not a function");var le=Ot(G.name||"unknownFunctionName",function(){});le.prototype=G.prototype;var ye=new le,V=G.apply(ye,j);return V instanceof Object?V:ye}function xs(G,j,le,ye,V){var B=j.length;B<2&&tn("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var Q=j[1]!==null&&le!==null,ce=!1,he=1;he<j.length;++he)if(j[he]!==null&&j[he].destructorFunction===void 0){ce=!0;break}for(var be=j[0].name!=="void",Pe="",Oe="",he=0;he<B-2;++he)Pe+=(he!==0?", ":"")+"arg"+he,Oe+=(he!==0?", ":"")+"arg"+he+"Wired";var Ne="return function "+ni(G)+"("+Pe+`) {
if (arguments.length !== `+(B-2)+`) {
throwBindingError('function `+G+" called with ' + arguments.length + ' arguments, expected "+(B-2)+` args!');
}
`;ce&&(Ne+=`var destructors = [];
`);var rt=ce?"destructors":"null",lt=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],mt=[tn,ye,V,Tn,j[0],j[1]];Q&&(Ne+="var thisWired = classParam.toWireType("+rt+`, this);
`);for(var he=0;he<B-2;++he)Ne+="var arg"+he+"Wired = argType"+he+".toWireType("+rt+", arg"+he+"); // "+j[he+2].name+`
`,lt.push("argType"+he),mt.push(j[he+2]);if(Q&&(Oe="thisWired"+(Oe.length>0?", ":"")+Oe),Ne+=(be?"var rv = ":"")+"invoker(fn"+(Oe.length>0?", ":"")+Oe+`);
`,ce)Ne+=`runDestructors(destructors);
`;else for(var he=Q?1:2;he<j.length;++he){var Rt=he===1?"thisWired":"arg"+(he-2)+"Wired";j[he].destructorFunction!==null&&(Ne+=Rt+"_dtor("+Rt+"); // "+j[he].name+`
`,lt.push(Rt+"_dtor"),mt.push(j[he].destructorFunction))}be&&(Ne+=`var ret = retType.fromWireType(rv);
return ret;
`),Ne+=`}
`,lt.push(Ne);var Ln=hr(Function,lt).apply(null,mt);return Ln}function Wi(G,j,le,ye,V,B){_(j>0);var Q=ka(j,le);V=Kr(ye,V),fi([],[G],function(ce){ce=ce[0];var he="constructor "+ce.name;if(ce.registeredClass.constructor_body===void 0&&(ce.registeredClass.constructor_body=[]),ce.registeredClass.constructor_body[j-1]!==void 0)throw new ki("Cannot register multiple constructors with identical number of parameters ("+(j-1)+") for class '"+ce.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return ce.registeredClass.constructor_body[j-1]=()=>{qr("Cannot construct "+ce.name+" due to unbound types",Q)},fi([],Q,function(be){return be.splice(1,0,null),ce.registeredClass.constructor_body[j-1]=xs(he,be,null,V,B),[]}),[]})}function Pu(G,j,le,ye,V,B,Q,ce){var he=ka(le,ye);j=dr(j),B=Kr(V,B),fi([],[G],function(be){be=be[0];var Pe=be.name+"."+j;j.startsWith("@@")&&(j=Symbol[j.substring(2)]),ce&&be.registeredClass.pureVirtualFunctions.push(j);function Oe(){qr("Cannot call "+Pe+" due to unbound types",he)}var Ne=be.registeredClass.instancePrototype,rt=Ne[j];return rt===void 0||rt.overloadTable===void 0&&rt.className!==be.name&&rt.argCount===le-2?(Oe.argCount=le-2,Oe.className=be.name,Ne[j]=Oe):(ic(Ne,j,Pe),Ne[j].overloadTable[le-2]=Oe),fi([],he,function(lt){var mt=xs(Pe,lt,be,B,Q);return Ne[j].overloadTable===void 0?(mt.argCount=le-2,Ne[j]=mt):Ne[j].overloadTable[le-2]=mt,[]}),[]})}var Va=[],gr=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function il(G){G>4&&--gr[G].refcount===0&&(gr[G]=void 0,Va.push(G))}function sc(){for(var G=0,j=5;j<gr.length;++j)gr[j]!==void 0&&++G;return G}function Lu(){for(var G=5;G<gr.length;++G)if(gr[G]!==void 0)return gr[G];return null}function Au(){o.count_emval_handles=sc,o.get_first_emval=Lu}var Fa={toValue:G=>(G||tn("Cannot use deleted val. handle = "+G),gr[G].value),toHandle:G=>{switch(G){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var j=Va.length?Va.pop():gr.length;return gr[j]={refcount:1,value:G},j}}}};function ol(G,j){j=dr(j),Vi(G,{name:j,fromWireType:function(le){var ye=Fa.toValue(le);return il(le),ye},toWireType:function(le,ye){return Fa.toHandle(ye)},argPackAdvance:8,readValueFromPointer:ui,destructorFunction:null})}function cc(G){if(G===null)return"null";var j=typeof G;return j==="object"||j==="array"||j==="function"?G.toString():""+G}function Nu(G,j){switch(j){case 2:return function(le){return this.fromWireType(ee[le>>2])};case 3:return function(le){return this.fromWireType(oe[le>>3])};default:throw new TypeError("Unknown float type: "+G)}}function al(G,j,le){var ye=Zo(le);j=dr(j),Vi(G,{name:j,fromWireType:function(V){return V},toWireType:function(V,B){return B},argPackAdvance:8,readValueFromPointer:Nu(j,ye),destructorFunction:null})}function ku(G,j,le,ye,V,B){var Q=ka(j,le);G=dr(G),V=Kr(ye,V),Gi(G,function(){qr("Cannot call "+G+" due to unbound types",Q)},j-1),fi([],Q,function(ce){var he=[ce[0],null].concat(ce.slice(1));return oc(G,xs(G,he,null,V,B),j-1),[]})}function Vu(G,j,le){switch(j){case 0:return le?function(V){return k[V]}:function(V){return z[V]};case 1:return le?function(V){return A[V>>1]}:function(V){return L[V>>1]};case 2:return le?function(V){return N[V>>2]}:function(V){return H[V>>2]};default:throw new TypeError("Unknown integer type: "+G)}}function Fu(G,j,le,ye,V){j=dr(j);var B=Zo(le),Q=Oe=>Oe;if(ye===0){var ce=32-8*le;Q=Oe=>Oe<<ce>>>ce}var he=j.includes("unsigned"),be=(Oe,Ne)=>{},Pe;he?Pe=function(Oe,Ne){return be(Ne,this.name),Ne>>>0}:Pe=function(Oe,Ne){return be(Ne,this.name),Ne},Vi(G,{name:j,fromWireType:Q,toWireType:Pe,argPackAdvance:8,readValueFromPointer:Vu(j,B,ye!==0),destructorFunction:null})}function Uu(G,j,le){var ye=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],V=ye[j];function B(Q){Q=Q>>2;var ce=H,he=ce[Q],be=ce[Q+1];return new V(P,be,he)}le=dr(le),Vi(G,{name:le,fromWireType:B,argPackAdvance:8,readValueFromPointer:B},{ignoreDuplicateRegistrations:!0})}function Bu(G,j){j=dr(j);var le=j==="std::string";Vi(G,{name:j,fromWireType:function(ye){var V=H[ye>>2],B=ye+4,Q;if(le)for(var ce=B,he=0;he<=V;++he){var be=B+he;if(he==V||z[be]==0){var Pe=be-ce,Oe=b(ce,Pe);Q===void 0?Q=Oe:(Q+="\0",Q+=Oe),ce=be+1}}else{for(var Ne=new Array(V),he=0;he<V;++he)Ne[he]=String.fromCharCode(z[B+he]);Q=Ne.join("")}return pe(ye),Q},toWireType:function(ye,V){V instanceof ArrayBuffer&&(V=new Uint8Array(V));var B,Q=typeof V=="string";Q||V instanceof Uint8Array||V instanceof Uint8ClampedArray||V instanceof Int8Array||tn("Cannot pass non-string to std::string"),le&&Q?B=M(V):B=V.length;var ce=J(4+B+1),he=ce+4;if(H[ce>>2]=B,le&&Q)R(V,he,B+1);else if(Q)for(var be=0;be<B;++be){var Pe=V.charCodeAt(be);Pe>255&&(pe(he),tn("String has UTF-16 code units that do not fit in 8 bits")),z[he+be]=Pe}else for(var be=0;be<B;++be)z[he+be]=V[be];return ye!==null&&ye.push(pe,ce),ce},argPackAdvance:8,readValueFromPointer:ui,destructorFunction:function(ye){pe(ye)}})}var sl=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function Gu(G,j){for(var le=G,ye=le>>1,V=ye+j/2;!(ye>=V)&&L[ye];)++ye;if(le=ye<<1,le-G>32&&sl)return sl.decode(z.subarray(G,le));for(var B="",Q=0;!(Q>=j/2);++Q){var ce=A[G+Q*2>>1];if(ce==0)break;B+=String.fromCharCode(ce)}return B}function Wu(G,j,le){if(le===void 0&&(le=2147483647),le<2)return 0;le-=2;for(var ye=j,V=le<G.length*2?le/2:G.length,B=0;B<V;++B){var Q=G.charCodeAt(B);A[j>>1]=Q,j+=2}return A[j>>1]=0,j-ye}function cl(G){return G.length*2}function ll(G,j){for(var le=0,ye="";!(le>=j/4);){var V=N[G+le*4>>2];if(V==0)break;if(++le,V>=65536){var B=V-65536;ye+=String.fromCharCode(55296|B>>10,56320|B&1023)}else ye+=String.fromCharCode(V)}return ye}function zu(G,j,le){if(le===void 0&&(le=2147483647),le<4)return 0;for(var ye=j,V=ye+le-4,B=0;B<G.length;++B){var Q=G.charCodeAt(B);if(Q>=55296&&Q<=57343){var ce=G.charCodeAt(++B);Q=65536+((Q&1023)<<10)|ce&1023}if(N[j>>2]=Q,j+=4,j+4>V)break}return N[j>>2]=0,j-ye}function ul(G){for(var j=0,le=0;le<G.length;++le){var ye=G.charCodeAt(le);ye>=55296&&ye<=57343&&++le,j+=4}return j}function fl(G,j,le){le=dr(le);var ye,V,B,Q,ce;j===2?(ye=Gu,V=Wu,Q=cl,B=()=>L,ce=1):j===4&&(ye=ll,V=zu,Q=ul,B=()=>H,ce=2),Vi(G,{name:le,fromWireType:function(he){for(var be=H[he>>2],Pe=B(),Oe,Ne=he+4,rt=0;rt<=be;++rt){var lt=he+4+rt*j;if(rt==be||Pe[lt>>ce]==0){var mt=lt-Ne,Rt=ye(Ne,mt);Oe===void 0?Oe=Rt:(Oe+="\0",Oe+=Rt),Ne=lt+j}}return pe(he),Oe},toWireType:function(he,be){typeof be!="string"&&tn("Cannot pass non-string to C++ string type "+le);var Pe=Q(be),Oe=J(4+Pe+j);return H[Oe>>2]=Pe>>ce,V(be,Oe+4,Pe+j),he!==null&&he.push(pe,Oe),Oe},argPackAdvance:8,readValueFromPointer:ui,destructorFunction:function(he){pe(he)}})}function lc(G,j,le,ye,V,B){zt[G]={name:dr(j),rawConstructor:Kr(le,ye),rawDestructor:Kr(V,B),fields:[]}}function dl(G,j,le,ye,V,B,Q,ce,he,be){zt[G].fields.push({fieldName:dr(j),getterReturnType:le,getter:Kr(ye,V),getterContext:B,setterArgumentType:Q,setter:Kr(ce,he),setterContext:be})}function $u(G,j){j=dr(j),Vi(G,{isVoid:!0,name:j,argPackAdvance:0,fromWireType:function(){},toWireType:function(le,ye){}})}function hl(G){G>4&&(gr[G].refcount+=1)}function ju(G,j){var le=Ue[G];return le===void 0&&tn(j+" has unknown type "+ra(G)),le}function uc(G,j){G=ju(G,"_emval_take_value");var le=G.readValueFromPointer(j);return Fa.toHandle(le)}function Hu(){Le("")}function Ku(G,j,le){z.copyWithin(G,j,j+le)}function qu(){return 2147483648}function Xu(G){try{return S.grow(G-P.byteLength+65535>>>16),de(S.buffer),1}catch{}}function fc(G){var j=z.length;G=G>>>0;var le=qu();if(G>le)return!1;let ye=(he,be)=>he+(be-he%be)%be;for(var V=1;V<=4;V*=2){var B=j*(1+.2/V);B=Math.min(B,G+100663296);var Q=Math.min(le,ye(Math.max(G,B),65536)),ce=Xu(Q);if(ce)return!0}return!1}function Yu(G){return 52}function Ao(G,j,le,ye,V){return 70}var Cs=[null,[],[]];function io(G,j){var le=Cs[G];j===0||j===10?((G===1?y:x)(D(le,0)),le.length=0):le.push(j)}function ia(G,j,le,ye){for(var V=0,B=0;B<le;B++){var Q=H[j>>2],ce=H[j+4>>2];j+=8;for(var he=0;he<ce;he++)io(G,z[Q+he]);V+=ce}return H[ye>>2]=V,0}function gl(G){return G}function dc(G){var j=o["_"+G];return j}function pl(G,j){k.set(G,j)}function Ss(G,j,le,ye,V){var B={string:lt=>{var mt=0;if(lt!=null&&lt!==0){var Rt=(lt.length<<2)+1;mt=He(Rt),R(lt,mt,Rt)}return mt},array:lt=>{var mt=He(lt.length);return pl(lt,mt),mt}};function Q(lt){return j==="string"?b(lt):j==="boolean"?!!lt:lt}var ce=dc(G),he=[],be=0;if(ye)for(var Pe=0;Pe<ye.length;Pe++){var Oe=B[le[Pe]];Oe?(be===0&&(be=Xe()),he[Pe]=Oe(ye[Pe])):he[Pe]=ye[Pe]}var Ne=ce.apply(null,he);function rt(lt){return be!==0&&Ye(be),Q(lt)}return Ne=rt(Ne),Ne}Qt=o.InternalError=Pr(Error,"InternalError"),tc(),ki=o.BindingError=Pr(Error,"BindingError"),Ru(),vo(),tl(),gi=o.UnboundTypeError=Pr(Error,"UnboundTypeError"),Au();var ml={L:Se,v:Et,c:It,k:ln,i:Pn,f:bt,A:en,D:Ci,I:Qo,y:rl,x:Wi,a:Pu,H:ol,u:al,o:ku,h:Fu,d:Uu,t:Bu,q:fl,p:lc,B:dl,J:$u,N:il,O:hl,n:uc,r:Hu,G:Ku,E:fc,F:Yu,C:Ao,s:ia,b:Dt,z:Ct,w:Fe,e:Y,l:De,m:q,j:fe,K:tt,g:Bt,M:gl};Ve(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.Q).apply(null,arguments)};var J=o._malloc=function(){return(J=o._malloc=o.asm.R).apply(null,arguments)},te=o.___cxa_free_exception=function(){return(te=o.___cxa_free_exception=o.asm.S).apply(null,arguments)},pe=o._free=function(){return(pe=o._free=o.asm.U).apply(null,arguments)},Re=o.___getTypeName=function(){return(Re=o.___getTypeName=o.asm.V).apply(null,arguments)};o.__embind_initialize_bindings=function(){return(o.__embind_initialize_bindings=o.asm.W).apply(null,arguments)};var Be=o.setTempRet0=function(){return(Be=o.setTempRet0=o.asm.X).apply(null,arguments)},Xe=o.stackSave=function(){return(Xe=o.stackSave=o.asm.Y).apply(null,arguments)},Ye=o.stackRestore=function(){return(Ye=o.stackRestore=o.asm.Z).apply(null,arguments)},He=o.stackAlloc=function(){return(He=o.stackAlloc=o.asm._).apply(null,arguments)},Ze=o.___cxa_can_catch=function(){return(Ze=o.___cxa_can_catch=o.asm.$).apply(null,arguments)},ft=o.___cxa_is_pointer_type=function(){return(ft=o.___cxa_is_pointer_type=o.asm.aa).apply(null,arguments)};o.dynCall_ji=function(){return(o.dynCall_ji=o.asm.ba).apply(null,arguments)},o.dynCall_iiji=function(){return(o.dynCall_iiji=o.asm.ca).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.da).apply(null,arguments)};function Ct(G,j,le){var ye=Xe();try{return qe(G)(j,le)}catch(V){if(Ye(ye),V!==V+0)throw V;_setThrew(1,0)}}function Dt(G,j){var le=Xe();try{return qe(G)(j)}catch(ye){if(Ye(le),ye!==ye+0)throw ye;_setThrew(1,0)}}function Bt(G,j,le,ye,V,B,Q,ce,he,be,Pe){var Oe=Xe();try{qe(G)(j,le,ye,V,B,Q,ce,he,be,Pe)}catch(Ne){if(Ye(Oe),Ne!==Ne+0)throw Ne;_setThrew(1,0)}}function Y(G,j){var le=Xe();try{qe(G)(j)}catch(ye){if(Ye(le),ye!==ye+0)throw ye;_setThrew(1,0)}}function q(G,j,le,ye){var V=Xe();try{qe(G)(j,le,ye)}catch(B){if(Ye(V),B!==B+0)throw B;_setThrew(1,0)}}function fe(G,j,le,ye,V){var B=Xe();try{qe(G)(j,le,ye,V)}catch(Q){if(Ye(B),Q!==Q+0)throw Q;_setThrew(1,0)}}function De(G,j,le){var ye=Xe();try{qe(G)(j,le)}catch(V){if(Ye(ye),V!==V+0)throw V;_setThrew(1,0)}}function Fe(G,j,le,ye){var V=Xe();try{return qe(G)(j,le,ye)}catch(B){if(Ye(V),B!==B+0)throw B;_setThrew(1,0)}}function tt(G,j,le,ye,V,B,Q){var ce=Xe();try{qe(G)(j,le,ye,V,B,Q)}catch(he){if(Ye(ce),he!==he+0)throw he;_setThrew(1,0)}}o.ccall=Ss;var Je;ne=function G(){Je||Ke(),Je||(ne=G)};function Ke(G){if(Z>0||(Ce(),Z>0))return;function j(){Je||(Je=!0,o.calledRun=!0,!T&&(F(),a(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),O()))}o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),j()},1)):j()}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return Ke(),o.ready}})();t.exports=r})(gk);var u0e=gk.exports;const f0e=Ys(u0e),d0e=new URL("/dicm-viewer-test/assets/openjphjs-CANpALFP.wasm",import.meta.url),fg={codec:void 0,decoder:void 0,decodeConfig:{}};function h0e(t,e,r){const n={width:e,height:r};for(;t>0;)n.width=Math.ceil(n.width/2),n.height=Math.ceil(n.height/2),t--;return n}function g0e(t){if(fg.decodeConfig=t,fg.codec)return Promise.resolve();const e=f0e({locateFile:r=>r.endsWith(".wasm")?d0e.toString():r});return new Promise((r,n)=>{e.then(i=>{fg.codec=i,fg.decoder=new i.HTJ2KDecoder,r()},n)})}async function p0e(t,e){await g0e();const r=new fg.codec.HTJ2KDecoder,n=r.getEncodedBuffer(t.length);n.set(t);const i=e.decodeLevel||0;r.decodeSubResolution(i);const o=r.getFrameInfo();if(e.decodeLevel>0){const{width:E,height:D}=h0e(e.decodeLevel,o.width,o.height);o.width=E,o.height=D}const a=r.getDecodedBuffer();new Uint8Array(a.length).set(a);const c=`x: ${r.getImageOffset().x}, y: ${r.getImageOffset().y}`,l=r.getNumDecompositions(),f=r.getNumLayers(),u=["unknown","LRCP","RLCP","RPCL","PCRL","CPRL"][r.getProgressionOrder()+1],d=r.getIsReversible(),h=`${r.getBlockDimensions().width} x ${r.getBlockDimensions().height}`,g=`${r.getTileSize().width} x ${r.getTileSize().height}`,p=`${r.getTileOffset().x}, ${r.getTileOffset().y}`,v=`${a.length.toLocaleString()} bytes`,w=`${(a.length/n.length).toFixed(2)}:1`,m={columns:o.width,rows:o.height,bitsPerPixel:o.bitsPerSample,signed:o.isSigned,bytesPerPixel:e.bytesPerPixel,componentsPerPixel:o.componentCount};let y=m0e(o,a);const{buffer:x,byteOffset:C,byteLength:S}=y,T=x.slice(C,C+S);y=new y.constructor(T);const _={imageOffset:c,numDecompositions:l,numLayers:f,progessionOrder:u,reversible:d,blockDimensions:h,tileSize:g,tileOffset:p,decodedSize:v,compressionRatio:w};return{...e,pixelData:y,imageInfo:m,encodeOptions:_,..._,...m}}function m0e(t,e){return t.bitsPerSample>8?t.isSigned?new Int16Array(e.buffer,e.byteOffset,e.byteLength/2):new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2):t.isSigned?new Int8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function v0e(t,e){const r=t.length,{rescaleSlope:n,rescaleIntercept:i,suvbw:o}=e;if(e.modality==="PT"&&typeof o=="number"&&!isNaN(o))for(let a=0;a<r;a++)t[a]=o*(t[a]*n+i);else for(let a=0;a<r;a++)t[a]=t[a]*n+i;return!0}const y0e={bilinear:Afe,replicate:Nfe},w0e={Uint8Array,Uint16Array,Int16Array,Float32Array};function x0e(t,e,r,n){var m,y,x;const i=t.pixelRepresentation!==void 0&&t.pixelRepresentation===1,o=i&&t.bitsStored!==void 0?32-t.bitsStored:void 0;if(i&&o!==void 0)for(let C=0;C<t.pixelData.length;C++)t.pixelData[C]=t.pixelData[C]<<o>>o;let a=t.pixelData;t.pixelDataLength=t.pixelData.length;const{min:s,max:c}=w5(t.pixelData),l=typeof e.allowFloatRendering<"u"?e.allowFloatRendering:!0;let f=Y_(t.photometricInterpretation)&&((m=e.targetBuffer)==null?void 0:m.offset)===void 0;const d=((y=e.preScale)==null?void 0:y.enabled)&&Object.values(e.preScale.scalingParameters).some(C=>typeof C=="number"&&!Number.isInteger(C)),h=!e.preScale.enabled||!l&&d,g=(x=e.targetBuffer)==null?void 0:x.type;if(g&&e.preScale.enabled&&!h){const{rescaleSlope:C,rescaleIntercept:S}=e.preScale.scalingParameters,T=C*s+S,_=C*c+S;f=!Wue(T,_,g)}g&&!f?a=C0e(e,t,w0e,a):e.preScale.enabled&&!h?a=S0e(e,s,c,t):a=pk(s,c,t);let p=s,v=c;if(e.preScale.enabled&&!h){const C=e.preScale.scalingParameters;mk(C);const{rescaleSlope:S,rescaleIntercept:T}=C;if(typeof S=="number"&&typeof T=="number"){v0e(a,C),t.preScale={...e.preScale,scaled:!0};const{rescaleIntercept:E,rescaleSlope:D,suvbw:b}=C;p=D*s+E,v=D*c+E,b&&(p=p*b,v=v*b)}}else h&&(t.preScale={enabled:!0,scaled:!1},p=s,v=c);t.pixelData=a,t.smallestPixelValue=p,t.largestPixelValue=v;const w=new Date().getTime();return t.decodeTimeInMS=w-r,t}function C0e(t,e,r,n){const{arrayBuffer:i,type:o,offset:a=0,length:s,rows:c}=t.targetBuffer,l=r[o];if(!l)throw new Error(`target array ${o} is not supported, or doesn't exist.`);c&&c!=e.rows&&_0e(e,t.targetBuffer,l);const f=e.pixelDataLength,u=a,d=s??f-u,h=e.pixelData;if(d!==h.length)throw new Error(`target array for image does not have the same length (${d}) as the decoded image length (${h.length}).`);const g=i?new l(i,u,d):new l(d);return g.set(h,0),n=g,n}function S0e(t,e,r,n){const i=t.preScale.scalingParameters;mk(i);const{rescaleSlope:o,rescaleIntercept:a}=i,s=typeof o=="number"&&typeof a=="number";let c=e,l=r;return s&&(c=o*e+a,l=o*r+a),pk(c,l,n)}function pk(t,e,r){const n=X_(t,e),i=new n(r.pixelData.length);return i.set(r.pixelData,0),i}function mk(t){if(!t)throw new Error("options.preScale.scalingParameters must be defined if preScale.enabled is true, and scalingParameters cannot be derived from the metadata providers.")}function T0e(t,e,r){const{samplesPerPixel:n}=t,{rows:i,columns:o}=e,a=i*o*n,s=new r(a),c=s.byteLength/a;return{pixelData:s,rows:i,columns:o,frameInfo:{...t.frameInfo,rows:i,columns:o},imageInfo:{...t.imageInfo,rows:i,columns:o,bytesPerPixel:c}}}function _0e(t,e,r){const n=T0e(t,e,r),{scalingType:i="replicate"}=e;return y0e[i](t,n),Object.assign(t,n),t.pixelDataLength=t.pixelData.length,t}async function vk(t,e,r,n,i,o){const a=new Date().getTime();let s=null,c;switch(e){case"1.2.840.10008.1.2":case"1.2.840.10008.1.2.1":s=J9(t,r);break;case"1.2.840.10008.1.2.2":s=Vfe(t,r);break;case"1.2.840.10008.1.2.1.99":s=J9(t,r);break;case"1.2.840.10008.1.2.5":s=Ffe(t,r);break;case"1.2.840.10008.1.2.4.50":c={...t},s=Hfe(r,c);break;case"1.2.840.10008.1.2.4.51":s=Jfe(t,r);break;case"1.2.840.10008.1.2.4.57":s=Q9(t,r);break;case"1.2.840.10008.1.2.4.70":s=Q9(t,r);break;case"1.2.840.10008.1.2.4.80":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=eD(r,c);break;case"1.2.840.10008.1.2.4.81":c={signed:t.pixelRepresentation===1,bytesPerPixel:t.bitsAllocated<=8?1:2,...t},s=eD(r,c);break;case"1.2.840.10008.1.2.4.90":c={...t},s=tD(r,c);break;case"1.2.840.10008.1.2.4.91":c={...t},s=tD(r,c);break;case"3.2.840.10008.1.2.4.96":case"1.2.840.10008.1.2.4.201":case"1.2.840.10008.1.2.4.202":case"1.2.840.10008.1.2.4.203":c={...t},s=p0e(r,c);break;default:throw new Error(`no decoder for transfer syntax ${e}`)}if(!s)throw new Error("decodePromise not defined");const l=await s,f=x0e(l,i,a);return o==null||o(f),f}const E0e={decodeTask({imageFrame:t,transferSyntax:e,decodeConfig:r,options:n,pixelData:i,callbackFn:o}){return vk(t,e,i,r,n,o)}};l_(E0e);const I2={constants:Lfe,convertRGBColorByPixel:IN,convertRGBColorByPlane:ON,convertYBRFullByPixel:MN,convertYBRFullByPlane:RN,convertPALETTECOLOR:PN,wadouri:tfe,wadors:Dfe,init:Ofe,convertColorSpace:JN,createImage:x5,decodeJPEGBaseline8BitColor:ZN,getImageFrame:QN,getPixelData:e4,getMinMax:w5,isColorImage:Y_,isJPEGBaseline8BitColor:Rfe,internal:mue,decodeImageFrame:vk};var Xs;(function(t){t[t.Primary=1]="Primary",t[t.Secondary=2]="Secondary",t[t.Primary_And_Secondary=3]="Primary_And_Secondary",t[t.Auxiliary=4]="Auxiliary",t[t.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",t[t.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",t[t.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",t[t.Fourth_Button=8]="Fourth_Button",t[t.Fifth_Button=16]="Fifth_Button",t[t.Wheel=524288]="Wheel",t[t.Wheel_Primary=524289]="Wheel_Primary"})(Xs||(Xs={}));var ii;(function(t){t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta",t[t.ShiftCtrl=1617]="ShiftCtrl",t[t.ShiftAlt=1618]="ShiftAlt",t[t.ShiftMeta=1691]="ShiftMeta",t[t.CtrlAlt=1718]="CtrlAlt",t[t.CtrlMeta=1791]="CtrlMeta",t[t.AltMeta=1891]="AltMeta"})(ii||(ii={}));var wn;(function(t){t.Active="Active",t.Passive="Passive",t.Enabled="Enabled",t.Disabled="Disabled"})(wn||(wn={}));var AC;(function(t){t.Default="",t.Highlighted="Highlighted",t.Selected="Selected",t.Locked="Locked",t.AutoGenerated="AutoGenerated"})(AC||(AC={}));const Dc=AC;var U;(function(t){t.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",t.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",t.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",t.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",t.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",t.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",t.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",t.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",t.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",t.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",t.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",t.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",t.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",t.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",t.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",t.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",t.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",t.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",t.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",t.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",t.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",t.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",t.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",t.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",t.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",t.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",t.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",t.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",t.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",t.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",t.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",t.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",t.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",t.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",t.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",t.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",t.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",t.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",t.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"})(U||(U={}));var ht;(function(t){t.Labelmap="Labelmap",t.Contour="Contour",t.Surface="Surface"})(ht||(ht={}));var If;(function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"})(If||(If={}));var St;(function(t){t.OnInteractionStart="onInteractionStart",t.OnInteractionEnd="onInteractionEnd",t.Preview="preview",t.RejectPreview="rejectPreview",t.AcceptPreview="acceptPreview",t.Fill="fill",t.StrategyFunction="strategyFunction",t.CreateIsInThreshold="createIsInThreshold",t.Initialize="initialize",t.INTERNAL_setValue="setValue",t.AddPreview="addPreview",t.ComputeInnerCircleRadius="computeInnerCircleRadius",t.GetStatistics="getStatistics"})(St||(St={}));var tr;(function(t){t.Interaction="Interaction",t.HandlesUpdated="HandlesUpdated",t.StatsUpdated="StatsUpdated",t.InitialSetup="InitialSetup",t.Completed="Completed",t.InterpolationUpdated="InterpolationUpdated",t.History="History"})(tr||(tr={}));var NC;(function(t){t.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",t.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",t.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",t.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",t.SURFACE_CLIPPING="Clipping Surfaces"})(NC||(NC={}));const lh=NC,D0e=Object.freeze(Object.defineProperty({__proto__:null,AnnotationStyleStates:Dc,ChangeTypes:tr,Events:U,get KeyboardBindings(){return ii},get MouseBindings(){return Xs},SegmentationRepresentations:ht,StrategyCallbacks:St,get Swipe(){return If},ToolModes:wn,WorkerTypes:lh},Symbol.toStringTag,{value:"Module"}));let t4={};function b0e(){t4={}}const nD={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:t4,enabledElements:[],handleRadius:6};let ze={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:t4,enabledElements:[],handleRadius:6};function I0e(){b0e(),ze={...structuredClone({...nD,svgNodeCache:{}}),svgNodeCache:{...nD.svgNodeCache}}}var O0e="Expected a function",yk="__lodash_hash_undefined__",M0e="[object Function]",R0e="[object GeneratorFunction]",P0e="[object Symbol]",L0e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,A0e=/^\w*$/,N0e=/^\./,k0e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,V0e=/[\\^$.*+?()[\]{}|]/g,F0e=/\\(\\)?/g,U0e=/^\[object .+?Constructor\]$/,B0e=typeof yi=="object"&&yi&&yi.Object===Object&&yi,G0e=typeof self=="object"&&self&&self.Object===Object&&self,n4=B0e||G0e||Function("return this")();function W0e(t,e){return t==null?void 0:t[e]}function z0e(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}var $0e=Array.prototype,j0e=Function.prototype,wk=Object.prototype,n3=n4["__core-js_shared__"],rD=function(){var t=/[^.]+$/.exec(n3&&n3.keys&&n3.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),xk=j0e.toString,r4=wk.hasOwnProperty,Ck=wk.toString,H0e=RegExp("^"+xk.call(r4).replace(V0e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),iD=n4.Symbol,K0e=$0e.splice,q0e=Sk(n4,"Map"),_p=Sk(Object,"create"),oD=iD?iD.prototype:void 0,aD=oD?oD.toString:void 0;function Yf(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function X0e(){this.__data__=_p?_p(null):{}}function Y0e(t){return this.has(t)&&delete this.__data__[t]}function J0e(t){var e=this.__data__;if(_p){var r=e[t];return r===yk?void 0:r}return r4.call(e,t)?e[t]:void 0}function Z0e(t){var e=this.__data__;return _p?e[t]!==void 0:r4.call(e,t)}function Q0e(t,e){var r=this.__data__;return r[t]=_p&&e===void 0?yk:e,this}Yf.prototype.clear=X0e;Yf.prototype.delete=Y0e;Yf.prototype.get=J0e;Yf.prototype.has=Z0e;Yf.prototype.set=Q0e;function uh(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ede(){this.__data__=[]}function tde(t){var e=this.__data__,r=S5(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():K0e.call(e,r,1),!0}function nde(t){var e=this.__data__,r=S5(e,t);return r<0?void 0:e[r][1]}function rde(t){return S5(this.__data__,t)>-1}function ide(t,e){var r=this.__data__,n=S5(r,t);return n<0?r.push([t,e]):r[n][1]=e,this}uh.prototype.clear=ede;uh.prototype.delete=tde;uh.prototype.get=nde;uh.prototype.has=rde;uh.prototype.set=ide;function c0(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ode(){this.__data__={hash:new Yf,map:new(q0e||uh),string:new Yf}}function ade(t){return T5(this,t).delete(t)}function sde(t){return T5(this,t).get(t)}function cde(t){return T5(this,t).has(t)}function lde(t,e){return T5(this,t).set(t,e),this}c0.prototype.clear=ode;c0.prototype.delete=ade;c0.prototype.get=sde;c0.prototype.has=cde;c0.prototype.set=lde;function S5(t,e){for(var r=t.length;r--;)if(xde(t[r][0],e))return r;return-1}function ude(t,e){e=gde(e,t)?[e]:hde(e);for(var r=0,n=e.length;t!=null&&r<n;)t=t[yde(e[r++])];return r&&r==n?t:void 0}function fde(t){if(!_k(t)||mde(t))return!1;var e=Cde(t)||z0e(t)?H0e:U0e;return e.test(wde(t))}function dde(t){if(typeof t=="string")return t;if(o4(t))return aD?aD.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function hde(t){return Tk(t)?t:vde(t)}function T5(t,e){var r=t.__data__;return pde(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Sk(t,e){var r=W0e(t,e);return fde(r)?r:void 0}function gde(t,e){if(Tk(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||o4(t)?!0:A0e.test(t)||!L0e.test(t)||e!=null&&t in Object(e)}function pde(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function mde(t){return!!rD&&rD in t}var vde=i4(function(t){t=Tde(t);var e=[];return N0e.test(t)&&e.push(""),t.replace(k0e,function(r,n,i,o){e.push(i?o.replace(F0e,"$1"):n||r)}),e});function yde(t){if(typeof t=="string"||o4(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function wde(t){if(t!=null){try{return xk.call(t)}catch{}try{return t+""}catch{}}return""}function i4(t,e){if(typeof t!="function"||e&&typeof e!="function")throw new TypeError(O0e);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,n);return r.cache=o.set(i,a),a};return r.cache=new(i4.Cache||c0),r}i4.Cache=c0;function xde(t,e){return t===e||t!==t&&e!==e}var Tk=Array.isArray;function Cde(t){var e=_k(t)?Ck.call(t):"";return e==M0e||e==R0e}function _k(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function Sde(t){return!!t&&typeof t=="object"}function o4(t){return typeof t=="symbol"||Sde(t)&&Ck.call(t)==P0e}function Tde(t){return t==null?"":dde(t)}function _de(t,e,r){var n=t==null?void 0:ude(t,e);return n===void 0?r:n}var Ede=_de;const Dde=Ys(Ede),sD=Symbol("DefinedCursors"),Ek=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class Xi{constructor(e,r){this.name=e+"",this.fallback=r}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:r}=this;return r instanceof Xi?`${e}, ${r.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const r=cD(Xi,sD);let n=r.get(e);if(n instanceof Xi)return n;if(Ek.has(e))return n=new Xi(e),r.set(e,n),n}static setDefinedCursor(e,r){return r instanceof Xi?(cD(Xi,sD).set(e,r),!0):!1}}function cD(t,e){let r=t[e];return r instanceof Map||(r=new Map,Object.defineProperty(t,e,{value:r})),r}const bde=Ek.values(),Ide="image-cursor";class Ep extends Xi{constructor(e,r,n,i,o){super(i||Ep.getUniqueInstanceName(Ide),o),this.url=e,this.x=Number(r)||0,this.y=Number(n)||0}getStyleProperty(){const{url:e,x:r,y:n}=this;let i=`url('${e}')`;return r>=0&&n>=0&&(r>0||n>0)&&(i+=` ${r} ${n}`),this.addFallbackStyleProperty(i)}static getUniqueInstanceName(e){return`${e}-${FA(Ep)}`}}const fn={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="{{color}}" d="M8 16L8 0"></path>
    <path stroke="{{color}}" d="M16 8L0 8"></path>
  `},Co={x:127,y:60},C0=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
`,Tl=`
<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>
<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>
`,_m='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',S0='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',Em='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',_5={Angle:dn(fn,{name:"Angle",iconContent:`<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
    10l50 50q10 10 10 23z" />`,viewBox:{x:1792,y:1792}}),ArrowAnnotate:dn(fn,{name:"ArrowAnnotate",iconContent:`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,viewBox:{x:24,y:24}}),Bidirectional:dn(fn,{name:"Bidirectional",iconContent:`<g fill="{{color}}" stroke-width="3" stroke="{{color}}">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,viewBox:{x:48,y:48}}),CobbAngle:dn(fn,{name:"CobbAngle",iconContent:`<g stroke="{{color}}" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,viewBox:{x:32,y:32}}),CircleROI:dn(fn,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:dn(fn,{name:"EllipticalROI",iconContent:`<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z" />`,viewBox:{x:32,y:32}}),FreehandROI:dn(fn,{name:"FreehandROI",iconContent:`<g fill="{{color}}" stroke="{{color}}" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,viewBox:{x:18,y:18}}),FreehandROISculptor:dn(fn,{name:"FreehandROISculptor",iconContent:`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
  </g>`,viewBox:{x:18,y:18}}),Length:dn(fn,{name:"Length",iconContent:`<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,viewBox:{x:24,y:24}}),Height:dn(fn,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:dn(fn,{name:"Probe",iconContent:`<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z" />`,viewBox:{x:1792,y:1792}}),RectangleROI:dn(fn,{name:"RectangleROI",iconContent:`<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),TextMarker:dn(fn,{name:"TextMarker",iconContent:`<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />`,viewBox:{x:1792,y:1792}}),Crosshairs:dn(fn,{name:"Crosshairs",iconContent:`<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />`,viewBox:{x:1792,y:1792}}),Eraser:dn(fn,{name:"Eraser",iconContent:`<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
    0 69.5 20.5t47.5 54.5z" />`,viewBox:{x:2048,y:1792}}),Magnify:dn(fn,{name:"Magnify",iconContent:`<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />`,viewBox:{x:512,y:512}}),Pan:dn(fn,{name:"Pan",iconContent:`<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />`,viewBox:{x:1792,y:1792}}),Rotate:dn(fn,{name:"Rotate",iconContent:`<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
    39 17 39 59z" />`,viewBox:{x:1792,y:1792}}),StackScroll:dn(fn,{name:"StackScroll",iconContent:`<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />`,viewBox:{x:24,y:28}}),WindowLevelRegion:dn(fn,{name:"WindowLevelRegion",iconContent:`<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z" />`,viewBox:{x:1792,y:1792}}),WindowLevel:dn(fn,{name:"WindowLevel",iconContent:`
    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />`,viewBox:{x:18,y:18}}),Zoom:dn(fn,{name:"Zoom",iconContent:`
  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
    32s176 78.7 176 176-78.7 176-176 176z" />
  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />`,viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:dn(fn,{name:"SegmentationFreeHandEraseInside",iconContent:`${_m} ${C0}`,viewBox:Co}),SegmentationFreeHandFillInside:dn(fn,{name:"SegmentationFreeHandFillInside",iconContent:`${_m} ${Tl}`,viewBox:Co}),SegmentationFreeHandEraseOutside:dn(fn,{name:"SegmentationFreeHandEraseOutside",iconContent:`${_m} ${C0}`,viewBox:Co}),SegmentationFreeHandFillOutside:dn(fn,{name:"SegmentationFreeHandFillOutside",iconContent:`${_m} ${Tl}`,viewBox:Co}),SegmentationRectangleEraseInside:dn(fn,{name:"SegmentationRectangleEraseInside",iconContent:`${S0} ${C0}`,viewBox:Co}),RectangleScissor:dn(fn,{name:"RectangleScissor",iconContent:`${S0} ${Tl}`,viewBox:Co}),"RectangleScissor.FILL_INSIDE":dn(fn,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${S0} ${Tl}`,viewBox:Co}),"RectangleScissor.FILL_OUTSIDE":dn(fn,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${S0} ${Tl}`,viewBox:Co}),"RectangleScissor.ERASE_OUTSIDE":dn(fn,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${S0} ${C0}`,viewBox:Co}),"RectangleScissor.ERASE_INSIDE":dn(fn,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${S0} ${C0}`,viewBox:Co}),CircleScissor:dn(fn,{name:"CircleScissor",iconContent:`${Em} ${Tl}`,viewBox:Co}),"CircleScissor.FILL_INSIDE":dn(fn,{name:"CircleScissor.FILL_INSIDE",iconContent:`${Em} ${Tl}`,viewBox:Co}),"CircleScissor.ERASE_OUTSIDE":dn(fn,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${Em} ${C0}`,viewBox:Co}),"CircleScissor.FILL_OUTSIDE":dn(fn,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${Em} ${Tl}`,viewBox:Co})};function dn(t,e){return Object.assign(Object.create(t),{...e,name:e.name||t.name})}function Ode(t,e,r){_5[t]=dn(fn,{iconContent:e,viewBox:r})}function Mde(t){return _5[t]}const Rde=Object.keys(_5);class Pde{constructor(){const e={color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0};this._initializeConfig(e)}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,r){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=r}setViewportToolStyles(e,r){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=r}setToolGroupToolStyles(e,r){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=r}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,r){const{annotationUID:n,viewportId:i,toolGroupId:o,toolName:a}=r;return this._getToolStyle(e,n,i,o,a)}_getToolStyle(e,r,n,i,o){if(r){const s=this.getAnnotationToolStyles(r);if(s&&s[e]!==void 0)return s[e]}if(n){const s=this.getViewportToolStyles(n);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}if(i){const s=this.getToolGroupToolStyles(i);if(s){if(s[o]&&s[o][e]!==void 0)return s[o][e];if(s.global&&s.global[e]!==void 0)return s.global[e]}}const a=this.getDefaultToolStyles();if(a[o]&&a[o][e]!==void 0)return a[o][e];if(a.global&&a.global[e]!==void 0)return a.global[e]}_initializeConfig(e){const r={};for(const n in e)r[n]=e[n];this.config={default:{global:r}}}}const a4=new Pde;function Lde(t,e,r){const n=[`${t}`];return e&&n.push(`${n[0]}${e}`),r&&n.push(`${n[n.length-1]}${r}`),n}function Ud(t,e,r,n){const i=Lde(t,r,n);for(let o=i.length-1;o>=0;--o){const a=a4.getStyleProperty(i[o],e);if(a!==void 0)return a}}const Ade="color",Nde=Dc.Highlighted,kde=wn.Active;class md extends Ep{constructor(e,r,n,i,o){super(e,r,n,i,o)}static getDefinedCursor(e,r=!1,n){n||(n=Ud(Ade,{},Nde,kde));const i=Vde(e,r,n);let o=super.getDefinedCursor(i);if(!o){const a=Mde(e);a&&(o=Fde(a,i,r,n,super.getDefinedCursor("default")),super.setDefinedCursor(i,o))}return o}}function Dk(t,e){const r=Object(e),n=Object.prototype.hasOwnProperty.bind(r);return(t+"").replace(/\{\{(\w+)\}\}/g,(i,o)=>n(o)?r[o]+"":"")}function Vde(t,e,r){return`${e?"pointer":"cursor"}:${t}/${r}`}function Fde(t,e,r,n,i){const{x:o,y:a}=t.mousePoint;return new md(Ude(t,r,{color:n}),o,a,e,i)}function Ude(t,e,r){const n=Bde(t,e,r);return`${URL.createObjectURL(n)}#${t.name||"unknown"}-${e?"pointer":"cursor"}`}function Bde(t,e,r){const n=(e?Wde:Gde)(t,r);return new Blob([n],{type:"image/svg+xml"})}function Gde(t,e){const{iconContent:r,iconSize:n,viewBox:i}=t,o=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${n}" height="${n}" viewBox="0 0
      ${i.x} ${i.y}">
      ${r}
    </svg>`;return Dk(o,e)}function Wde(t,e){const{iconContent:r,iconSize:n,viewBox:i,mousePointerGroupString:o}=t,a=n/Math.max(i.x,i.y,1),s=16+n,c=`
    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
      width="${s}" height="${s}" viewBox="0 0 ${s} ${s}">
      <g>${o}</g>
      <g transform="translate(16, 16) scale(${a})">${r}</g>
    </svg>`;return Dk(c,e)}const lD=Symbol("ElementCursorsMap");function bk(t,e){Dp(t)[0]=e,h1(t,e)}function h1(t,e){const r=Dp(t);r[1]=r[0],r[0]=e,t.style.cursor=(e instanceof Xi?e:Xi.getDefinedCursor("auto")).getStyleProperty()}function Ut(t){h1(t,Dp(t)[1])}function Tt(t){h1(t,Xi.getDefinedCursor("none"))}function Dp(t){let e=Dp[lD];e instanceof WeakMap||(e=new WeakMap,Object.defineProperty(Dp,lD,{value:e}));let r=e.get(t);return r||(r=[null,null],e.set(t,r)),r}const zde=Object.freeze(Object.defineProperty({__proto__:null,hideElementCursor:Tt,initElementCursor:bk,resetElementCursor:Ut,setElementCursor:h1},Symbol.toStringTag,{value:"Module"}));function $de(t,e){let r=md.getDefinedCursor(e,!0);r||(r=Xi.getDefinedCursor(e)),r||(console.log(`Cursor ${e} is not defined either as SVG or as a standard cursor.`),r=Xi.getDefinedCursor(e)),h1(t,r)}const jde=[...Rde,...bde],Hde=Object.freeze(Object.defineProperty({__proto__:null,CursorNames:jde,CursorSVG:_5,ImageMouseCursor:Ep,MouseCursor:Xi,SVGMouseCursor:md,elementCursor:zde,registerCursor:Ode,setCursorForElement:$de},Symbol.toStringTag,{value:"Module"}));function Li(t){return ze.toolGroups.find(e=>e.id===t)}const{Active:Uh,Passive:r3,Enabled:i3,Disabled:o3}=wn,Kde=[{mouseButton:Xs.Primary}];class s4{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map(({viewportId:e})=>e)}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const r=this._toolInstances[e];if(!r){console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`);return}return r}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,r={}){const n=ze.tools[e],i=typeof e<"u"&&e!=="",o=this.toolOptions[e];if(!i){console.warn("Tool with configuration did not produce a toolName: ",r);return}if(!n){console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);return}if(o){console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);return}const{toolClass:a}=n,s={name:e,toolGroupId:this.id,configuration:r},c=new a(s);this._toolInstances[e]=c}addToolInstance(e,r,n={}){var o;let i=(o=ze.tools[e])==null?void 0:o.toolClass;if(!i){const a=ze.tools[r].toolClass;class s extends a{}s.toolName=e,i=s,ze.tools[e]={toolClass:s}}this.addTool(i.toolName,n)}addViewport(e,r){if(typeof e!="string")throw new Error("viewportId must be defined and be a string");const n=this._findRenderingEngine(e,r);this.viewportsInfo.some(({viewportId:s})=>s===e)||this.viewportsInfo.push({viewportId:e,renderingEngineId:n});const i=this.getActivePrimaryMouseButtonTool();Yn.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(i);const a={toolGroupId:this.id,viewportId:e,renderingEngineId:n};Qe(We,U.TOOLGROUP_VIEWPORT_ADDED,a)}removeViewports(e,r){const n=[];if(this.viewportsInfo.forEach((o,a)=>{let s=!1;o.renderingEngineId===e&&(s=!0,r&&o.viewportId!==r&&(s=!1)),s&&n.push(a)}),n.length)for(let o=n.length-1;o>=0;o--)this.viewportsInfo.splice(n[o],1);const i={toolGroupId:this.id,viewportId:r,renderingEngineId:e};Qe(We,U.TOOLGROUP_VIEWPORT_REMOVED,i)}setActiveStrategy(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`);return}n.setActiveStrategy(r)}setToolMode(e,r,n={}){if(!e){console.warn("setToolMode: toolName must be defined");return}if(r===wn.Active){this.setToolActive(e,n||this.restoreToolOptions[e]);return}if(r===wn.Passive){this.setToolPassive(e);return}if(r===wn.Enabled){this.setToolEnabled(e);return}if(r===wn.Disabled){this.setToolDisabled(e);return}console.warn("setToolMode: mode must be defined")}setToolActive(e,r={}){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}if(!n){console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);return}const i=this.toolOptions[e]?this.toolOptions[e].bindings:[],o=r.bindings?r.bindings:[],s={bindings:[...i,...o].reduce((u,d)=>{const h=d.numTouchPoints!==void 0,g=d.mouseButton!==void 0;return!u.some(p=>a3(p,d))&&(h||g)&&u.push(d),u},[]),mode:Uh};this.toolOptions[e]=s,this._toolInstances[e].mode=Uh;const l=Yn.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(r)&&l)this.setViewportsCursorByToolName(e);else if(!this.getActivePrimaryMouseButtonTool()&&l){const d=Xi.getDefinedCursor("default");this._setCursorForViewports(d)}this._hasMousePrimaryButtonBinding(r)&&(this.prevActivePrimaryToolName===null?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),typeof n.onSetToolActive=="function"&&n.onSetToolActive(),this._renderViewports();const f={toolGroupId:this.id,toolName:e,toolBindingsOptions:r};Qe(We,U.TOOL_ACTIVATED,f),this._triggerToolModeChangedEvent(e,Uh,r)}setToolPassive(e,r){const n=this._toolInstances[e];if(n===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const i=this.getToolOptions(e),o=Object.assign({bindings:i?i.bindings:[]},i,{mode:r3}),a=Array.isArray(r==null?void 0:r.removeAllBindings)?r.removeAllBindings:this.getDefaultPrimaryBindings();o.bindings=o.bindings.filter(c=>(r==null?void 0:r.removeAllBindings)!==!0&&!a.some(l=>a3(c,l)));let s=r3;o.bindings.length!==0&&(s=Uh,o.mode=s),this.toolOptions[e]=o,n.mode=s,typeof n.onSetToolPassive=="function"&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,r3)}setToolEnabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:i3};this.toolOptions[e]=n,r.mode=i3,typeof r.onSetToolEnabled=="function"&&r.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,i3)}setToolDisabled(e){const r=this._toolInstances[e];if(r===void 0){console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);return}const n={bindings:[],mode:o3};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,r.mode=o3,typeof r.onSetToolDisabled=="function"&&r.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,o3)}getToolOptions(e){const r=this.toolOptions[e];if(r!==void 0)return r}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find(e=>{const r=this.toolOptions[e];return r.mode===Uh&&this._hasMousePrimaryButtonBinding(r)})}setViewportsCursorByToolName(e,r){const n=this._getCursor(e,r);this._setCursorForViewports(n)}_getCursor(e,r){let n,i;return r&&(n=`${e}.${r}`,i=md.getDefinedCursor(n,!0),i)||(n=`${e}`,i=md.getDefinedCursor(n,!0),i)||(n=e,i=md.getDefinedCursor(n,!0),i)?i:Xi.getDefinedCursor("default")}_setCursorForViewports(e){this.viewportsInfo.forEach(({renderingEngineId:r,viewportId:n})=>{const i=zr(n,r);if(!i)return;const{viewport:o}=i;bk(o.element,e)})}setToolConfiguration(e,r,n){const i=this._toolInstances[e];if(i===void 0)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let o;return n?o=r:o=Object.assign(i.configuration,r),i.configuration=o,typeof i.onSetToolConfiguration=="function"&&i.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return Xs.Primary}getDefaultPrimaryBindings(){return Kde}getToolConfiguration(e,r){if(this._toolInstances[e]===void 0){console.warn(`Tool ${e} not present, can't set tool configuration.`);return}const n=Dde(this._toolInstances[e].configuration,r)||this._toolInstances[e].configuration;return pa(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const r=this.getCurrentActivePrimaryToolName();this.setToolDisabled(r),this.setToolActive(e,{bindings:[{mouseButton:Xs.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,r=null){let n=Li(e);return n?(console.debug(`ToolGroup ${e} already exists`),n):(n=new s4(e),ze.toolGroups.push(n),r=r??(()=>!0),Object.keys(this._toolInstances).filter(r).forEach(i=>{const o=this._toolInstances[i],a=this.toolOptions[i],s=o.mode;n.addTool(i),n.setToolMode(i,s,{bindings:a.bindings??[]})}),n)}_hasMousePrimaryButtonBinding(e){var n;const r=this.getDefaultPrimaryBindings();return(n=e==null?void 0:e.bindings)==null?void 0:n.some(i=>r.some(o=>a3(i,o)))}_renderViewports(){this.viewportsInfo.forEach(({renderingEngineId:e,viewportId:r})=>{fr(e).renderViewport(r)})}_triggerToolModeChangedEvent(e,r,n){const i={toolGroupId:this.id,toolName:e,mode:r,toolBindingsOptions:n};Qe(We,U.TOOL_MODE_CHANGED,i)}_findRenderingEngine(e,r){const n=Qi();if((n==null?void 0:n.length)===0)throw new Error("No rendering engines found.");if(r)return r;const i=n.filter(o=>o.getViewport(e));if(i.length===0){if(n.length===1)return n[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(i.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return i[0].id}}function a3(t,e){return t.mouseButton!==e.mouseButton||t.numTouchPoints!==e.numTouchPoints?!1:t.modifierKey===e.modifierKey}function qde(t){if(ze.toolGroups.some(n=>n.id===t)){console.warn(`'${t}' already exists.`);return}const r=new s4(t);return ze.toolGroups.push(r),r}function Ik(t){const e=ze.toolGroups.findIndex(r=>r.id===t);e>-1&&ze.toolGroups.splice(e,1)}function Ok(){const t=[...ze.toolGroups];for(const e of t)Ik(e.id);ze.toolGroups=[]}function or(t,e){var n;e||(e=(n=Qi().find(i=>i.getViewports().find(o=>o.id===t)))==null?void 0:n.id);const r=ze.toolGroups.filter(i=>i.viewportsInfo.some(o=>o.renderingEngineId===e&&(!o.viewportId||o.viewportId===t)));if(r.length){if(r.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${e} and viewportId: ${t}. You should only
      have one tool group per viewport in a renderingEngine.`);return r[0]}}function Xde(){return ze.toolGroups}const Yde=[wn.Active,wn.Passive,wn.Enabled];function Mk(t){return ze.toolGroups.filter(({toolOptions:e})=>{const r=Object.keys(e);for(let n=0;n<r.length;n++)if(t===r[n]&&e[t]&&Yde.includes(e[t].mode))return!0;return!1})}const Jde=Object.freeze(Object.defineProperty({__proto__:null,createToolGroup:qde,destroy:Ok,destroyToolGroup:Ik,getAllToolGroups:Xde,getToolGroup:Li,getToolGroupForViewport:or,getToolGroupsWithToolName:Mk},Symbol.toStringTag,{value:"Module"}));function Zde(t,e){const r=we(e),{renderingEngine:n,viewportId:i}=r,o=U.ANNOTATION_ADDED,a={annotation:t,viewportId:i,renderingEngineId:n.id};Qe(We,o,a)}function Qde(t){const{toolName:e}=t.metadata,r=Mk(e);if(!r.length)return;const n=[];r.forEach(a=>{a.viewportsInfo.forEach(s=>{const{renderingEngineId:c,viewportId:l}=s,{FrameOfReferenceUID:f}=zr(l,c);t.metadata.FrameOfReferenceUID===f&&n.push(s)})});const i=U.ANNOTATION_ADDED,o={annotation:t};if(!n.length){Qe(We,i,o);return}n.forEach(({renderingEngineId:a,viewportId:s})=>{o.viewportId=s,o.renderingEngineId=a,Qe(We,i,o)})}function c4(t){const e=U.ANNOTATION_REMOVED;Qe(We,e,t)}function qn(t,e,r=tr.HandlesUpdated){const n=we(e),{viewportId:i,renderingEngineId:o}=n,a=U.ANNOTATION_MODIFIED;Qe(We,a,{annotation:t,viewportId:i,renderingEngineId:o,changeType:r})}function Bn(t){Rk({annotation:t})}function l4(t,e=!1){Rk({annotation:t,contourHoleProcessingEnabled:e})}function Rk(t){const e=U.ANNOTATION_COMPLETED;Qe(We,e,t)}let Pk;function ps(){return Pk}function u4(t){Pk=t}function sn(t,e){const r=ps(),n=r.getGroupKey(e);return r.getAnnotations(n,t)}function xr(t){return ps().getAnnotation(t)}function E5(){return ps().getAllAnnotations()}function f4(t){const{annotationUID:e,parentAnnotationUID:r}=t;if(!r)return;const n=xr(r),i=n.childAnnotationUIDs.indexOf(e);n.childAnnotationUIDs.splice(i,1),t.parentAnnotationUID=void 0}function d4(t,e){const{annotationUID:r}=t,{annotationUID:n}=e;f4(e),t.childAnnotationUIDs||(t.childAnnotationUIDs=[]),!t.childAnnotationUIDs.includes(n)&&(t.childAnnotationUIDs.push(n),e.parentAnnotationUID=r)}function Lk(t){return t.parentAnnotationUID?xr(t.parentAnnotationUID):void 0}function D5(t){var e;return((e=t.childAnnotationUIDs)==null?void 0:e.map(r=>xr(r)))??[]}function Zt(t,e){t.annotationUID||(t.annotationUID=Cn());const r=ps();if(e instanceof HTMLDivElement){const n=r.getGroupKey(e);r.addAnnotation(t,n),Zde(t,e)}else r.addAnnotation(t,void 0),Qde(t);return t.annotationUID}function ehe(t,e){const r=ps(),n=r.getGroupKey(e);return r.getNumberOfAnnotations(n,t)}function hn(t){var n;if(!t)return;const e=ps(),r=e.getAnnotation(t);r&&((n=r.childAnnotationUIDs)==null||n.forEach(i=>hn(i)),e.removeAnnotation(t),c4({annotation:r,annotationManagerUID:e.uid}))}function the(){const t=ps(),e=t.removeAllAnnotations();for(const r of e)c4({annotation:r,annotationManagerUID:t.uid})}function nhe(t,e){const r=ps(),n=r.getGroupKey(e),i=r.removeAnnotations(n,t);for(const o of i)c4({annotation:o,annotationManagerUID:r.uid})}function Ak(t){let e=t;for(;e;)e.invalidated=!0,e=e.parentAnnotationUID?xr(e.parentAnnotationUID):void 0}const rhe=Object.freeze(Object.defineProperty({__proto__:null,addAnnotation:Zt,addChildAnnotation:d4,clearParentAnnotation:f4,getAllAnnotations:E5,getAnnotation:xr,getAnnotationManager:ps,getAnnotations:sn,getChildAnnotations:D5,getNumberOfAnnotations:ehe,getParentAnnotation:Lk,invalidateAnnotation:Ak,removeAllAnnotations:the,removeAnnotation:hn,removeAnnotations:nhe,setAnnotationManager:u4},Symbol.toStringTag,{value:"Module"}));function Nl(t){const e=t.toolName;if(ze.tools[e],!e)throw new Error(`No Tool Found for the ToolClass ${t.name}`);ze.tools[e]={toolClass:t}}function ihe(t){return!!ze.tools[t]}function ohe(t){const e=t.toolName;if(!e)throw new Error(`No tool found for: ${t.name}`);if(!ze.tools[e]!==void 0)delete ze.tools[e];else throw new Error(`${e} cannot be removed because it has not been added`)}function l0(t,e){const r=e||t.currentTarget,{viewport:n}=we(r)||{};if(!n)return;const i=che(t),o=she(t),a=ahe(r,o),s=n.canvasToWorld(a);return{page:o,client:i,canvas:a,world:s}}function ahe(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function she(t){return[t.pageX,t.pageY]}function che(t){return[t.clientX,t.clientY]}function Nk(t){const e=t.currentTarget,{viewportId:r,renderingEngineId:n}=we(e),i=l0(t,e),o={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},a={event:t,eventName:U.MOUSE_DOUBLE_CLICK,viewportId:r,renderingEngineId:n,camera:{},element:e,startPoints:i,lastPoints:i,currentPoints:i,deltaPoints:o};!Qe(e,U.MOUSE_DOUBLE_CLICK,a)&&(t.stopImmediatePropagation(),t.preventDefault())}const uD=U.MOUSE_MOVE;function g1(t){const e=t.currentTarget,r=we(e);if(!r)return;const{renderingEngineId:n,viewportId:i}=r,o=l0(t);!Qe(e,uD,{renderingEngineId:n,viewportId:i,camera:{},element:e,currentPoints:o,eventName:uD,event:t})&&(t.stopImmediatePropagation(),t.preventDefault())}const{MOUSE_DOWN:fD,MOUSE_DOWN_ACTIVATE:lhe,MOUSE_CLICK:uhe,MOUSE_UP:fhe,MOUSE_DRAG:dD}=U,dhe=400,hhe=150,ghe=3,phe={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};let Ft={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};const Jr={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function kk(t){if(Jr.doubleClickTimeout){if(t.buttons===Jr.mouseDownEvent.buttons)return;Jr.mouseDownEvent=t,Jv();return}Jr.doubleClickTimeout=setTimeout(Jv,t.buttons===1?dhe:hhe),Jr.mouseDownEvent=t,Jr.ignoreDoubleClick=!1,Ft.element=t.currentTarget,Ft.mouseButton=t.buttons;const e=we(Ft.element),{renderingEngineId:r,viewportId:n}=e;Ft.renderingEngineId=r,Ft.viewportId=n,Ft.preventClickTimeout=setTimeout(vhe,Ft.clickDelay),Ft.element.removeEventListener("mousemove",g1);const i=l0(t,Ft.element);Ft.startPoints=iu(i),Ft.lastPoints=iu(i),document.addEventListener("mouseup",h4),document.addEventListener("mousemove",Vk)}function mhe(t){const e=b5(Ft.startPoints,Ft.startPoints),r={event:t,eventName:fD,element:Ft.element,mouseButton:Ft.mouseButton,renderingEngineId:Ft.renderingEngineId,viewportId:Ft.viewportId,camera:{},startPoints:Ft.startPoints,lastPoints:Ft.startPoints,currentPoints:Ft.startPoints,deltaPoints:e};Ft.lastPoints=iu(r.lastPoints),Qe(r.element,fD,r)&&Qe(r.element,lhe,r)}function Vk(t){const e=we(Ft.element);if(!(e!=null&&e.viewport))return;const r=l0(t,Ft.element),n=Gk(Ft.element,Ft.lastPoints),i=b5(r,n);if(Jr.doubleClickTimeout)if(Uk(i.canvas))Jv();else return;const o={event:t,eventName:dD,mouseButton:Ft.mouseButton,renderingEngineId:Ft.renderingEngineId,viewportId:Ft.viewportId,camera:{},element:Ft.element,startPoints:iu(Ft.startPoints),lastPoints:iu(n),currentPoints:r,deltaPoints:i};!Qe(Ft.element,dD,o)&&(t.stopImmediatePropagation(),t.preventDefault()),Ft.lastPoints=iu(r)}function h4(t){if(clearTimeout(Ft.preventClickTimeout),Jr.doubleClickTimeout)Jr.mouseUpEvent?kC():(Jr.mouseUpEvent=t,Ft.element.addEventListener("mousemove",Fk));else{const e=Ft.isClickEvent?uhe:fhe,r=l0(t,Ft.element),n=b5(r,Ft.lastPoints),i={event:t,eventName:e,mouseButton:Ft.mouseButton,element:Ft.element,renderingEngineId:Ft.renderingEngineId,viewportId:Ft.viewportId,camera:{},startPoints:iu(Ft.startPoints),lastPoints:iu(Ft.lastPoints),currentPoints:r,deltaPoints:n};Qe(i.element,e,i),kC()}document.removeEventListener("mousemove",Vk)}function Fk(t){const e=l0(t,Ft.element),r=Gk(Ft.element,Ft.lastPoints),n=b5(e,r);Uk(n.canvas)&&(Jv(),g1(t))}function Uk(t){return Math.abs(t[0])+Math.abs(t[1])>ghe}function vhe(){Ft.isClickEvent=!1}function Jv(){Jr.ignoreDoubleClick=!0;const t=Jr.mouseDownEvent,e=Jr.mouseUpEvent;Bk(),mhe(t),e&&h4(e)}function Bk(){Jr.doubleClickTimeout&&(clearTimeout(Jr.doubleClickTimeout),Jr.doubleClickTimeout=null),Jr.mouseDownEvent=null,Jr.mouseUpEvent=null}function kC(){var t,e;document.removeEventListener("mouseup",h4),(t=Ft.element)==null||t.removeEventListener("mousemove",Fk),(e=Ft.element)==null||e.addEventListener("mousemove",g1),Bk(),Ft=JSON.parse(JSON.stringify(phe))}function iu(t){return JSON.parse(JSON.stringify(t))}function Gk(t,e){const{viewport:r}=we(t)||{};if(!r)return e;const n=r.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:n}}function b5(t,e){return!t||!e?{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}:{page:s3(t.page,e.page),client:s3(t.client,e.client),canvas:s3(t.canvas,e.canvas),world:yhe(t.world,e.world)}}function s3(t,e){return[t[0]-e[0],t[1]-e[1]]}function yhe(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function whe(){return Ft.mouseButton}function Wk(t){Jr.ignoreDoubleClick?(Jr.ignoreDoubleClick=!1,t.stopImmediatePropagation(),t.preventDefault()):kC()}function zk(t){t.removeEventListener("dblclick",Nk),t.removeEventListener("mousedown",kk),t.removeEventListener("mousemove",g1),t.removeEventListener("dblclick",Wk,{capture:!0})}function xhe(t){zk(t),t.addEventListener("dblclick",Nk),t.addEventListener("mousedown",kk),t.addEventListener("mousemove",g1),t.addEventListener("dblclick",Wk,{capture:!0})}const $k={enable:xhe,disable:zk},Che=2e3,Bd={mouse:0,touch:1};let hD,gD;function jk(t,e){const r=Date.now();if(t!==hD){if(r-gD<=Che)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1;hD=t}gD=r}const Hk=jk.bind(null,Bd.mouse),Kk=jk.bind(null,Bd.touch);function pD(t,e,r){const n=r?Hk:Kk;e.forEach(function(i){t.addEventListener(i,n,{passive:!1})})}function mD(t,e,r){const n=r?Hk:Kk;e.forEach(function(i){t.removeEventListener(i,n)})}const qk=["mousedown","mouseup","mousemove"],Xk=["touchstart","touchend"];function Yk(t){mD(t,qk,Bd.mouse),mD(t,Xk,Bd.touch)}function She(t){Yk(t),pD(t,qk,Bd.mouse),pD(t,Xk,Bd.touch)}const Jk={enable:She,disable:Yk};function I5(t,e){const r=e||t.currentTarget,n=t.type==="touchend"?t.changedTouches:t.touches;return Object.keys(n).map(i=>{const o=Ehe(n[i]),a=_he(n[i]),s=The(r,a),{viewport:c}=we(r),l=c.canvasToWorld(s);return{page:a,client:o,canvas:s,world:l,touch:{identifier:i,radiusX:n[i].radiusX,radiusY:n[i].radiusY,force:n[i].force,rotationAngle:n[i].rotationAngle}}})}function The(t,e){const r=t.getBoundingClientRect();return[e[0]-r.left-window.pageXOffset,e[1]-r.top-window.pageYOffset]}function _he(t){return[t.pageX,t.pageY]}function Ehe(t){return[t.clientX,t.clientY]}function Zv(t,e){const r=bp(t),n=bp(e);return{page:c3(r.page,n.page),client:c3(r.client,n.client),canvas:c3(r.canvas,n.canvas),world:bhe(r.world,n.world)}}function g4(t,e){const r=bp(t),n=bp(e);return{page:vd(r.page,n.page),client:vd(r.client,n.client),canvas:vd(r.canvas,n.canvas),world:Zk(r.world,n.world)}}function Dhe(t,e){}function Qv(t,e){const r=vD(t),n=vD(e);return{page:r.page-n.page,client:r.client-n.client,canvas:r.canvas-n.canvas,world:r.world-n.world}}function Gs(t){return JSON.parse(JSON.stringify(t))}function VC(t){return JSON.parse(JSON.stringify(t))}function bp(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length]}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function os(t){return t.reduce((e,r)=>({page:[e.page[0]+r.page[0]/t.length,e.page[1]+r.page[1]/t.length],client:[e.client[0]+r.client[0]/t.length,e.client[1]+r.client[1]/t.length],canvas:[e.canvas[0]+r.canvas[0]/t.length,e.canvas[1]+r.canvas[1]/t.length],world:[e.world[0]+r.world[0]/t.length,e.world[1]+r.world[1]/t.length,e.world[2]+r.world[2]/t.length],touch:{identifier:null,radiusX:e.touch.radiusX+r.touch.radiusX/t.length,radiusY:e.touch.radiusY+r.touch.radiusY/t.length,force:e.touch.force+r.touch.force/t.length,rotationAngle:e.touch.rotationAngle+r.touch.rotationAngle/t.length}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function c3(t,e){return[t[0]-e[0],t[1]-e[1]]}function bhe(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function vD(t){const e=[];for(let r=0;r<t.length;r++)for(let n=0;n<t.length;n++)r<n&&e.push({page:vd(t[r].page,t[n].page),client:vd(t[r].client,t[n].client),canvas:vd(t[r].canvas,t[n].canvas),world:Zk(t[r].world,t[n].world)});return e.reduce((r,n)=>({page:r.page+n.page/e.length,client:r.client+n.client/e.length,canvas:r.canvas+n.canvas/e.length,world:r.world+n.world/e.length}),{page:0,client:0,canvas:0,world:0})}function vd(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function Zk(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}const Ihe=Object.freeze(Object.defineProperty({__proto__:null,copyPoints:VC,copyPointsList:Gs,getDeltaDistance:g4,getDeltaDistanceBetweenIPoints:Qv,getDeltaPoints:Zv,getDeltaRotation:Dhe,getMeanPoints:bp,getMeanTouchPoints:os},Symbol.toStringTag,{value:"Module"}));Yn.getRuntimeSettings();const{TOUCH_START:yD,TOUCH_START_ACTIVATE:Ohe,TOUCH_PRESS:wD,TOUCH_DRAG:xD,TOUCH_END:CD,TOUCH_TAP:SD,TOUCH_SWIPE:l3}=U,Ip={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},ey={page:0,client:0,canvas:0,world:0},Qk={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Ip,touch:null}],lastPointsList:[{...Ip,touch:null}],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:ey,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},eV={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[{...Ip,touch:null}],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300};let vt=JSON.parse(JSON.stringify(Qk)),Ar=JSON.parse(JSON.stringify(eV));function pu(t,e,r){return Qe(t,e,r)}function tV(t){vt.element=t.currentTarget;const e=we(vt.element),{renderingEngineId:r,viewportId:n}=e;vt.renderingEngineId=r,vt.viewportId=n,!vt.isTouchStart&&(clearTimeout(vt.pressTimeout),vt.pressTimeout=setTimeout(()=>Mhe(t),vt.pressDelay),Rhe(t),document.addEventListener("touchmove",nV),document.addEventListener("touchend",rV))}function Mhe(t){if(vt.accumulatedDistance.canvas>vt.pressMaxDistance)return;const r={event:t,eventName:wD,renderingEngineId:vt.renderingEngineId,viewportId:vt.viewportId,camera:{},element:vt.element,startPointsList:Gs(vt.startPointsList),lastPointsList:Gs(vt.lastPointsList),startPoints:VC(os(vt.startPointsList)),lastPoints:VC(os(vt.lastPointsList))};pu(r.element,wD,r)}function Rhe(t){vt.isTouchStart=!0,vt.startTime=new Date;const e=I5(t,vt.element),r=os(e),n=Ip,i=ey,o={event:t,eventName:yD,element:vt.element,renderingEngineId:vt.renderingEngineId,viewportId:vt.viewportId,camera:{},startPointsList:e,lastPointsList:e,currentPointsList:e,startPoints:r,lastPoints:r,currentPoints:r,deltaPoints:n,deltaDistance:i};vt.startPointsList=Gs(o.startPointsList),vt.lastPointsList=Gs(o.lastPointsList),pu(o.element,yD,o)&&pu(o.element,Ohe,o)}function nV(t){const e=I5(t,vt.element),r=iV(vt.element,vt.lastPointsList),n=e.length===r.length?Zv(e,r):Ip,i=e.length===r.length?Qv(e,r):ey,o=e.length===r.length?g4(e,vt.lastPointsList):ey;vt.accumulatedDistance={page:vt.accumulatedDistance.page+o.page,client:vt.accumulatedDistance.client+o.client,canvas:vt.accumulatedDistance.canvas+o.canvas,world:vt.accumulatedDistance.world+o.world};const a={event:t,eventName:xD,renderingEngineId:vt.renderingEngineId,viewportId:vt.viewportId,camera:{},element:vt.element,startPoints:os(vt.startPointsList),lastPoints:os(r),currentPoints:os(e),startPointsList:Gs(vt.startPointsList),lastPointsList:Gs(r),currentPointsList:e,deltaPoints:n,deltaDistance:i};pu(vt.element,xD,a),Lhe(t,n),vt.lastPointsList=Gs(e)}function rV(t){clearTimeout(vt.pressTimeout);const e=I5(t,vt.element),r=iV(vt.element,vt.lastPointsList),n=e.length===r.length?Zv(e,r):Zv(e,e),i=e.length===r.length?Qv(e,r):Qv(e,e),o={event:t,eventName:CD,element:vt.element,renderingEngineId:vt.renderingEngineId,viewportId:vt.viewportId,camera:{},startPointsList:Gs(vt.startPointsList),lastPointsList:Gs(r),currentPointsList:e,startPoints:os(vt.startPointsList),lastPoints:os(r),currentPoints:os(e),deltaPoints:n,deltaDistance:i};pu(o.element,CD,o),Phe(t),vt=JSON.parse(JSON.stringify(Qk)),document.removeEventListener("touchmove",nV),document.removeEventListener("touchend",rV)}function Phe(t){const e=new Date().getTime(),r=vt.startTime.getTime();if(e-r>Ar.tapToleranceMs||(Ar.taps===0&&(Ar.element=vt.element,Ar.renderingEngineId=vt.renderingEngineId,Ar.viewportId=vt.viewportId,Ar.startPointsList=vt.startPointsList),Ar.taps>0&&!(Ar.element==vt.element&&Ar.renderingEngineId==vt.renderingEngineId&&Ar.viewportId==vt.viewportId)))return;const n=I5(t,Ar.element);g4(n,Ar.startPointsList).canvas>Ar.tapMaxDistance||(clearTimeout(Ar.tapTimeout),Ar.taps+=1,Ar.tapTimeout=setTimeout(()=>{const o={event:t,eventName:SD,element:Ar.element,renderingEngineId:Ar.renderingEngineId,viewportId:Ar.viewportId,camera:{},currentPointsList:n,currentPoints:os(n),taps:Ar.taps};pu(o.element,SD,o),Ar=JSON.parse(JSON.stringify(eV))},Ar.tapToleranceMs))}function Lhe(t,e){const r=new Date().getTime(),n=vt.startTime.getTime();if(vt.swiped||r-n>vt.swipeToleranceMs)return;const[i,o]=e.canvas,a={event:t,eventName:l3,renderingEngineId:vt.renderingEngineId,viewportId:vt.viewportId,camera:{},element:vt.element,swipe:null};Math.abs(i)>vt.swipeDistanceThreshold&&(a.swipe=i>0?If.RIGHT:If.LEFT,pu(a.element,l3,a),vt.swiped=!0),Math.abs(o)>vt.swipeDistanceThreshold&&(a.swipe=o>0?If.DOWN:If.UP,pu(a.element,l3,a),vt.swiped=!0)}function iV(t,e){const{viewport:r}=we(t);return e.map(n=>{const i=r.canvasToWorld(n.canvas);return{page:n.page,client:n.client,canvas:n.canvas,world:i,touch:n.touch}})}function oV(t){Jk.disable(t),t.removeEventListener("touchstart",tV)}function Ahe(t){oV(t),Jk.enable(t),t.addEventListener("touchstart",tV,{passive:!1})}const aV={enable:Ahe,disable:oV},TD=10,_D=40,ED=800;function Nhe(t){let e=0,r=0,n=0,i=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),n=e*TD,i=r*TD,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||i)&&t.deltaMode&&(t.deltaMode===1?(n*=_D,i*=_D):(n*=ED,i*=ED)),n&&!e&&(e=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:e,spinY:r,pixelX:n,pixelY:i}}function sV(t){const e=t.currentTarget,r=we(e),{renderingEngineId:n,viewportId:i}=r;if(t.deltaY>-1&&t.deltaY<1)return;t.preventDefault();const{spinX:o,spinY:a,pixelX:s,pixelY:c}=Nhe(t),l=a<0?-1:1,f={event:t,eventName:U.MOUSE_WHEEL,renderingEngineId:n,viewportId:i,element:e,camera:{},detail:t,wheel:{spinX:o,spinY:a,pixelX:s,pixelY:c,direction:l},points:l0(t)};Qe(e,U.MOUSE_WHEEL,f)}function khe(t){cV(t),t.addEventListener("wheel",sV,{passive:!1})}function cV(t){t.removeEventListener("wheel",sV)}const lV={enable:khe,disable:cV},Vhe={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};let Gr={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function O5(t){Gr.element=t.currentTarget;const e=we(Gr.element),{renderingEngineId:r,viewportId:n}=e;Gr.renderingEngineId=r,Gr.viewportId=n,Gr.key=t.key,Gr.keyCode=t.keyCode,t.preventDefault();const i={renderingEngineId:Gr.renderingEngineId,viewportId:Gr.viewportId,element:Gr.element,key:Gr.key,keyCode:Gr.keyCode};Qe(i.element,U.KEY_DOWN,i),document.addEventListener("keyup",uV),document.addEventListener("visibilitychange",p4),Gr.element.removeEventListener("keydown",O5)}function p4(){document.removeEventListener("visibilitychange",p4),document.visibilityState==="hidden"&&fV()}function uV(t){const e={renderingEngineId:Gr.renderingEngineId,viewportId:Gr.viewportId,element:Gr.element,key:Gr.key,keyCode:Gr.keyCode};document.removeEventListener("keyup",uV),document.removeEventListener("visibilitychange",p4),Gr.element.addEventListener("keydown",O5),Gr=structuredClone(Vhe),Qe(e.element,U.KEY_UP,e)}function Fhe(){return Gr.keyCode}function fV(){Gr.keyCode=void 0}function Uhe(t){dV(t),t.addEventListener("keydown",O5)}function dV(t){t.removeEventListener("keydown",O5)}const fh={enable:Uhe,disable:dV,getModifierKey:Fhe},{EPSILON:T0}=Cu;function hV(t,e,r=!1){var f;let n=1/0,i=r?-1/0:0,o=1/0,a=r?-1/0:0,s=1/0,c=r?-1/0:0;const l=((f=t[0])==null?void 0:f.length)===3;for(let u=0;u<t.length;u++){const d=t[u];n=Math.min(d[0],n),i=Math.max(d[0],i),o=Math.min(d[1],o),a=Math.max(d[1],a),l&&(s=Math.min(d[2]??s,s),c=Math.max(d[2]??c,c))}return e?(n=Math.max(r?e[0]+T0:0,n),i=Math.min(r?e[0]-T0:e[0]-1,i),o=Math.max(r?e[1]+T0:0,o),a=Math.min(r?e[1]-T0:e[1]-1,a),l&&e.length===3&&(s=Math.max(r?e[2]+T0:0,s),c=Math.min(r?e[2]-T0:e[2]-1,c))):r||(n=Math.max(0,n),i=Math.min(1/0,i),o=Math.max(0,o),a=Math.min(1/0,a),l&&(s=Math.max(0,s),c=Math.min(1/0,c))),l?[[n,i],[o,a],[s,c]]:[[n,i],[o,a],null]}function mu(t,e){return hV(t,e,!1)}function gV(t,e){return hV(t,e,!0)}const Bhe=(t,e)=>JSON.stringify(t)===JSON.stringify(e);function m4(t,e,r,n){const i=r[0]/2,o=r[1]/2,a=r[2]/2,s=new Array(8);s[0]=yr(t,[n[0]-i,n[1]-o,n[2]-a]);const c=[[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];for(let l=0;l<7;l++){const[f,u,d]=c[l];s[l+1]=yr(t,[n[0]+f*i,n[1]+u*o,n[2]+d*a])}return mu(s,e)}function pV(t,e){const{spacing:r}=t,n=t.voxelManager.getScalarDataLength(),i=[];let o=0;for(let a=0;a<e.length;a++){const{imageData:s,spacing:c,dimensions:l,voxelManager:f}=e[a].volume,u=e[a].volume.voxelManager.getScalarDataLength();u===n&&Bhe(c,r)&&(o=a);const d=e[a].lower,h=e[a].upper;i.push({imageData:s,lower:d,upper:h,spacing:c,dimensions:l,volumeSize:u,voxelManager:f})}return{volumeInfoList:i,baseVolumeIdx:o}}const v4=new Map,Ghe=t=>{const e=v4.get(t);e&&(e.isDirty=!0)},Whe=t=>{const e=v4.get(t);return e&&!e.isDirty?e.indices:null},zhe=(t,e)=>{v4.set(t,{indices:e,isDirty:!1})};function Ai(t,e,r){const n={segmentationId:t,modifiedSlicesToUse:e,segmentIndex:r};Ghe(t),Qe(We,U.SEGMENTATION_DATA_MODIFIED,n)}function Ro(t){const e={segmentationId:t};Qe(We,U.SEGMENTATION_MODIFIED,e)}function y4(t){const e={segmentationId:t};Qe(We,U.SEGMENTATION_REMOVED,e)}function Ns(t,e,r){const n={segmentationId:e,type:r,viewportId:t};Qe(We,U.SEGMENTATION_REPRESENTATION_MODIFIED,n)}function FC(t,e,r){const n={viewportId:t,segmentationId:e,type:r};Qe(We,U.SEGMENTATION_REPRESENTATION_REMOVED,n)}const $he=Object.freeze(Object.defineProperty({__proto__:null,triggerSegmentationDataModified:Ai,triggerSegmentationModified:Ro,triggerSegmentationRemoved:y4,triggerSegmentationRepresentationModified:Ns,triggerSegmentationRepresentationRemoved:FC},Symbol.toStringTag,{value:"Module"})),jhe={renderOutline:!0,outlineWidthAutoGenerated:3,outlineWidth:1,outlineWidthInactive:1,outlineOpacity:1,outlineOpacityInactive:.85,outlineDash:void 0,outlineDashInactive:void 0,outlineDashAutoGenerated:"5,3",activeSegmentOutlineWidthDelta:0,renderFill:!0,fillAlpha:.5,fillAlphaInactive:.3,fillAlphaAutoGenerated:.3};function Hhe(){return jhe}const Khe={renderOutline:!0,renderOutlineInactive:!0,outlineWidth:3,outlineWidthInactive:2,activeSegmentOutlineWidthDelta:0,renderFill:!0,renderFillInactive:!0,fillAlpha:.5,fillAlphaInactive:.4,outlineOpacity:1,outlineOpacityInactive:.85};function qhe(){return Khe}class Xhe{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,r){const{viewportId:n,segmentationId:i,type:o,segmentIndex:a}=e,s=this.getStyle(e);let c;if(!n&&!i?c={...s,...r}:c=this.copyActiveToInactiveIfNotProvided({...s,...r},o),!o)throw new Error("Type is required to set a style");if(n){this.config.viewportsStyle[n]||(this.config.viewportsStyle[n]={renderInactiveSegmentations:!1,representations:{}});const l=this.config.viewportsStyle[n].representations;if(i){l[i]||(l[i]={}),l[i][o]||(l[i][o]={});const f=l[i][o];a!==void 0?(f.perSegment||(f.perSegment={}),f.perSegment[a]=c):f.allSegments=c}else{const f="__allSegmentations__";l[f]||(l[f]={}),l[f][o]||(l[f][o]={}),l[f][o].allSegments=c}}else if(i){this.config.segmentations[i]||(this.config.segmentations[i]={}),this.config.segmentations[i][o]||(this.config.segmentations[i][o]={});const l=this.config.segmentations[i][o];a!==void 0?(l.perSegment||(l.perSegment={}),l.perSegment[a]=c):l.allSegments=c}else this.config.global[o]=c}copyActiveToInactiveIfNotProvided(e,r){const n={...e};if(r===ht.Labelmap){const i=n;i.renderOutlineInactive=i.renderOutline,i.outlineWidthInactive=i.outlineWidth,i.renderFillInactive=i.renderFill,i.fillAlphaInactive=i.fillAlpha,i.outlineOpacityInactive=i.outlineOpacity}else if(r===ht.Contour){const i=n;i.outlineWidthInactive=i.outlineWidth,i.outlineOpacityInactive=i.outlineOpacity,i.outlineDashInactive=i.outlineDash,i.renderOutlineInactive=i.renderOutline,i.renderFillInactive=i.renderFill,i.fillAlphaInactive=i.fillAlpha}return n}getStyle(e){var s,c,l,f,u;const{viewportId:r,segmentationId:n,type:i,segmentIndex:o}=e;let a=this.getDefaultStyle(i);if(this.config.global[i]&&(a={...a,...this.config.global[i]}),(s=this.config.segmentations[n])!=null&&s[i]&&(a={...a,...this.config.segmentations[n][i].allSegments},o!==void 0&&((c=this.config.segmentations[n][i].perSegment)!=null&&c[o])&&(a={...a,...this.config.segmentations[n][i].perSegment[o]})),r&&this.config.viewportsStyle[r]){this.config.viewportsStyle[r].renderInactiveSegmentations;const d="__allSegmentations__";(l=this.config.viewportsStyle[r].representations[d])!=null&&l[i]&&(a={...a,...this.config.viewportsStyle[r].representations[d][i].allSegments}),n&&((f=this.config.viewportsStyle[r].representations[n])!=null&&f[i])&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].allSegments},o!==void 0&&((u=this.config.viewportsStyle[r].representations[n][i].perSegment)!=null&&u[o])&&(a={...a,...this.config.viewportsStyle[r].representations[n][i].perSegment[o]}))}return a}getRenderInactiveSegmentations(e){var r;return(r=this.config.viewportsStyle[e])==null?void 0:r.renderInactiveSegmentations}setRenderInactiveSegmentations(e,r){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=r}getDefaultStyle(e){switch(e){case ht.Labelmap:return qhe();case ht.Contour:return Hhe();case ht.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const n=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:n,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:r}=e,n=this.getStyle(e),i=this.getDefaultStyle(r);return!ZA(n,i)}}const jo=new Xhe;function Yhe(t){const e={segmentationId:t};Qe(We,U.SEGMENTATION_ADDED,e)}const DD={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};class Jhe{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,e||(e=Cn()),this.state=Object.freeze(pa(DD)),this.uid=e}getState(){return this.state}updateState(e){const r=pa(this.state);e(r),this.state=Object.freeze(r)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=Object.freeze(pa(DD))}getSegmentation(e){return this.state.segmentations.find(r=>r.segmentationId===e)}updateSegmentation(e,r){this.updateState(n=>{const i=n.segmentations.find(o=>o.segmentationId===e);if(!i){console.warn(`Segmentation with id ${e} not found. Update aborted.`);return}Object.assign(i,r)}),Ro(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState(r=>{const n=pa(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const i=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=i}r.segmentations.push(n)}),Yhe(e.segmentationId)}removeSegmentation(e){this.updateState(r=>{const n=r.segmentations.filter(i=>i.segmentationId!==e);r.segmentations.splice(0,r.segmentations.length,...n)}),y4(e)}addSegmentationRepresentation(e,r,n,i){if(!An(e))return;if(this.getSegmentationRepresentations(e,{type:n,segmentationId:r}).length>0){console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",r);return}this.updateState(s=>{s.viewportSegRepresentations[e]||(s.viewportSegRepresentations[e]=[],jo.setRenderInactiveSegmentations(e,!0)),n!==ht.Labelmap?this.addDefaultSegmentationRepresentation(s,e,r,n,i):this.addLabelmapRepresentation(s,e,r,i)}),Ns(e,r,n)}addDefaultSegmentationRepresentation(e,r,n,i,o){const a=e.segmentations.find(c=>c.segmentationId===n);if(!a)return;const s={};Object.keys(a.segments).forEach(c=>{s[Number(c)]={visible:!0}}),e.viewportSegRepresentations[r].push({segmentationId:n,type:i,active:!0,visible:!0,colorLUTIndex:(o==null?void 0:o.colorLUTIndex)||0,segments:s,config:{...bD(i),...o}}),this._setActiveSegmentation(e,r,n)}addLabelmapRepresentation(e,r,n,i=bD(ht.Labelmap)){if(!An(r))return;const a=this.getSegmentation(n);if(!a)return;const{representationData:s}=a;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,r,n,ht.Labelmap,i);this.processLabelmapRepresentationAddition(r,n),this.addDefaultSegmentationRepresentation(e,r,n,ht.Labelmap,i)}async processLabelmapRepresentationAddition(e,r){const n=An(e);if(!n)return;const i=this.getSegmentation(r);if(!i)return;const o=n.viewport instanceof Xn,{representationData:a}=i,s="volumeId"in a.Labelmap;n.viewport,!o&&!s&&this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,r,n,i){const o=r.getCurrentImageId();let a=!1;for(const s of n)r.isReferenceViewable({referencedImageId:s},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(o,s));return i&&i(r,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(o):void 0}updateLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=An(e).viewport;return this._updateLabelmapSegmentationReferences(r,s,o,null)}_updateAllLabelmapSegmentationImageReferences(e,r){const n=this.getSegmentation(r);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(r)||this._stackLabelmapImageIdReferenceMap.set(r,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const o=this.getLabelmapImageIds(i),s=An(e).viewport;this._updateLabelmapSegmentationReferences(r,s,o,(c,l,f)=>{c.getImageIds().forEach((d,h)=>{for(const g of f)c.isReferenceViewable({referencedImageId:g,sliceIndex:h},{asOverlay:!0,withNavigation:!0})&&this._stackLabelmapImageIdReferenceMap.get(l).set(d,g)})})}getLabelmapImageIds(e){const r=e.Labelmap;let n;if(r.imageIds)n=r.imageIds;else if(!n&&r.volumeId){const i=r.volumeId;n=ke.getVolume(i).imageIds}return n}getCurrentLabelmapImageIdForViewport(e,r){const n=An(e);if(!n||!this._stackLabelmapImageIdReferenceMap.has(r))return;const o=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(r).get(o)}getStackSegmentationImageIdsForViewport(e,r){if(!this.getSegmentation(r))return[];this._updateAllLabelmapSegmentationImageReferences(e,r);const{viewport:i}=An(e),o=i.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(r);return o.map(s=>a.get(s))}removeSegmentationRepresentationsInternal(e,r){const n=[];return this.updateState(i=>{if(!i.viewportSegRepresentations[e])return;const o=i.viewportSegRepresentations[e];let a=!1;if(!r||Object.values(r).every(s=>s===void 0))n.push(...o),delete i.viewportSegRepresentations[e];else{const{segmentationId:s,type:c}=r;i.viewportSegRepresentations[e]=o.filter(l=>{const f=s&&c&&l.segmentationId===s&&l.type===c||s&&!c&&l.segmentationId===s||!s&&c&&l.type===c;return f&&(n.push(l),l.active&&(a=!0)),!f}),i.viewportSegRepresentations[e].length===0?delete i.viewportSegRepresentations[e]:a&&(i.viewportSegRepresentations[e][0].active=!0)}}),n}removeSegmentationRepresentations(e,r){const n=this.removeSegmentationRepresentationsInternal(e,r);n.forEach(o=>{FC(e,o.segmentationId,o.type)});const i=this.getSegmentationRepresentations(e);return i.length>0&&i[0].active&&Ns(e,i[0].segmentationId,i[0].type),n}removeSegmentationRepresentation(e,r,n){const i=this.removeSegmentationRepresentationsInternal(e,r);return n||i.forEach(({segmentationId:o,type:a})=>{FC(e,o,a)}),i}_setActiveSegmentation(e,r,n){const i=e.viewportSegRepresentations[r];i&&i.forEach(o=>{o.active=o.segmentationId===n})}setActiveSegmentation(e,r){this.updateState(n=>{const i=n.viewportSegRepresentations[e];i&&i.forEach(o=>{o.active=o.segmentationId===r})}),Ns(e,r)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const r=this.state.viewportSegRepresentations[e].find(n=>n.active);if(r)return this.getSegmentation(r.segmentationId)}getSegmentationRepresentations(e,r={}){const n=this.state.viewportSegRepresentations[e];return n?!r.type&&!r.segmentationId?n:n.filter(i=>{const o=r.type?i.type===r.type:!0,a=r.segmentationId?i.segmentationId===r.segmentationId:!0;return o&&a}):[]}getSegmentationRepresentation(e,r){return this.getSegmentationRepresentations(e,r)[0]}getSegmentationRepresentationVisibility(e,r){const n=this.getSegmentationRepresentation(e,r);return n==null?void 0:n.visible}setSegmentationRepresentationVisibility(e,r,n){this.updateState(i=>{const o=this.getSegmentationRepresentations(e,r);o&&o.forEach(a=>{a.visible=n,Object.entries(a.segments).forEach(([s,c])=>{c.visible=n})})}),Ns(e,r.segmentationId,r.type)}addColorLUT(e,r){this.updateState(n=>{n.colorLUT[r]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[r]=pa(e)})}removeColorLUT(e){this.updateState(r=>{delete r.colorLUT[e]})}_getStackIdForImageIds(e){return e.map(r=>r.slice(-Math.round(r.length*.15))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map(([e,r])=>({viewportId:e,representations:r}))}getSegmentationRepresentationsBySegmentationId(e){const r=[];return Object.entries(this.state.viewportSegRepresentations).forEach(([n,i])=>{const o=i.filter(a=>a.segmentationId===e);o.length>0&&r.push({viewportId:n,representations:o})}),r}}async function mV({imageIds:t,options:e}){const r=t,n=(e==null?void 0:e.volumeId)||Cn();return await f5(n,r),{volumeId:n}}async function Zhe({segmentationId:t,options:e}){const r=Vn.getSegmentation(t),n=r.representationData.Labelmap,{volumeId:i}=await mV({imageIds:n.imageIds,options:e});r.representationData.Labelmap.volumeId=i}function bD(t){const e=gu.newInstance(),r=Rd.newInstance();return r.addPoint(0,0),t===ht.Labelmap?{cfun:e,ofun:r}:{}}const Vn=new Jhe("DEFAULT");function Mo(t,e={}){return Vn.getSegmentationRepresentations(t,e)}function M5(t,e){const r=Vn;if(!e.segmentationId||!e.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const n=r.getSegmentationRepresentations(t,e);return n==null?void 0:n[0]}function Qhe(t){return Vn.getSegmentationRepresentationsBySegmentationId(t)}function vV(t,e,r){const n=An(t);if(!n)return;const{renderingEngine:i,viewport:o}=n;if(!i||!o)return;const s=o.getActors().filter(r);return s.length>0?s[0]:void 0}function ege(t,e){const r=kc(t,e);return r==null?void 0:r.uid}function kc(t,e){return vV(t,e,r=>{var n;return(n=r.representationUID)==null?void 0:n.startsWith(`${e}-${ht.Labelmap}`)})}function yV(t,e,r){return vV(t,e,n=>{var i;return(i=n.representationUID)==null?void 0:i.startsWith(wV(e,r))})}function tge(t,e,r){const i=yV(t,e,"");return i==null?void 0:i.uid}function wV(t,e){return`${t}-${ht.Surface}-${e}`}function nge(t,e){const r=we(t),{viewport:n}=r,o=n.getActors().filter(a=>a.uid.startsWith(tge(n.id,e)));n.removeActors(o.map(a=>a.uid))}function rge(t,e,r){const n=we(t),{viewport:i}=n,o=yV(i.id,r,e.segmentIndex),a=o==null?void 0:o.actor;if(a){const v=a.getMapper(),w=v.getInputData(),m=e.points,y=e.polys,x=w.getPoints().getData(),C=w.getPolys().getData();if(m.length===x.length&&y.length===C.length)return;const S=Qr.newInstance();S.getPoints().setData(m,3);const T=Kf.newInstance({values:Float32Array.from(y)});S.setPolys(T),v.setInputData(S),v.modified(),i.getRenderer().resetCameraClippingRange();return}const s=e.points,c=e.polys,l=e.color,f=Qr.newInstance();f.getPoints().setData(s,3);const u=Kf.newInstance({values:Float32Array.from(c)});f.setPolys(u);const d=js.newInstance({});let h;d.setInputData(f);const g=qs.newInstance();g.setMapper(d),g.getProperty().setColor(l[0]/255,l[1]/255,l[2]/255),g.getProperty().setLineWidth(2);const p=wV(r,e.segmentIndex);i.addActor({uid:Cn(),actor:g,clippingFilter:h,representationUID:p}),i.resetCamera(),i.getRenderer().resetCameraClippingRange(),i.render()}function jt(t){return Vn.getSegmentation(t)}function p1(t){return Vn.getColorLUT(t)}function ige(t){if("volumeId"in t){if(t=t,!ke.getVolume(t.volumeId))throw new Error(`volumeId of ${t.volumeId} not found in cache, you should load and cache volume before adding segmentation`)}else if("imageIds"in t){if(t=t,!t.imageIds)throw new Error("The segmentationInput.representationData.imageIds is undefined, please provide a valid representationData.imageIds for stack data")}else throw new Error("The segmentationInput.representationData is undefined, please provide a valid representationData")}function oge(t){ige(t)}const age=new Map([[ht.Labelmap,new Set([ht.Surface,ht.Contour])],[ht.Contour,new Set([ht.Labelmap,ht.Surface])],[ht.Surface,new Set([ht.Labelmap])]]);function R5(t,e){const{representationData:r}=jt(t);return sge(r).some(i=>cge(i,e))}function sge(t){const e=[];return Object.keys(t).forEach(r=>{const n=t[r];let i;switch(r){case ht.Labelmap:i=oge;break}if(i)try{i(n),e.push(r)}catch{console.warn(`Validation failed for labelmap of type ${r}`)}else e.push(r)}),e}async function cge(t,e){var r;return((r=age.get(t))==null?void 0:r.has(e))||!1}function xV({segmentationId:t,type:e,data:r}){const n=jt(t);if(!n)throw new Error(`Segmentation ${t} not found`);switch(n.representationData[e]&&console.warn(`Representation data of type ${e} already exists for segmentation ${t}, overwriting it.`),e){case ht.Labelmap:r&&(n.representationData[e]=r);break;case ht.Contour:r&&(n.representationData[e]=r);break;case ht.Surface:r&&(n.representationData[e]=r);break;default:throw new Error(`Invalid representation type ${e}`)}}function w4(t){const e=typeof t;return t!==null&&(e==="object"||e==="function")}function P5(t,e,r){let n,i,o,a,s,c,l=0,f=!1,u=!1,d=!0;const h=!e&&e!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,w4(r)&&(f=!!r.leading,u="maxWait"in r,o=u?Math.max(Number(r.maxWait)||0,e):o,d="trailing"in r?!!r.trailing:d);function g(D){const b=n,I=i;return n=i=void 0,l=D,a=t.apply(I,b),a}function p(D,b){return h?window.requestAnimationFrame(D):setTimeout(D,b)}function v(D){if(h)return window.cancelAnimationFrame(D);clearTimeout(D)}function w(D){return l=D,s=p(x,e),f?g(D):a}function m(D){const b=D-c,I=D-l,R=e-b;return u?Math.min(R,o-I):R}function y(D){const b=D-c,I=D-l;return c===void 0||b>=e||b<0||u&&I>=o}function x(){const D=Date.now();if(y(D))return C(D);s=p(x,m(D))}function C(D){return s=void 0,d&&n?g(D):(n=i=void 0,a)}function S(){s!==void 0&&v(s),l=0,n=c=i=s=void 0}function T(){return s===void 0?a:C(Date.now())}function _(){return s!==void 0}function E(...D){const b=Date.now(),I=y(b);if(n=D,i=this,c=b,I){if(s===void 0)return w(c);if(u)return s=p(x,e),g(c)}return s===void 0&&(s=p(x,e)),a}return E.cancel=S,E.flush=T,E.pending=_,E}let ID=!1;function CV(){if(ID)return;ID=!0;const t=()=>new Worker(new URL("/dicm-viewer-test/assets/polySegConverters-CIH2hSZK.js",import.meta.url),{name:"polySeg",type:"module"}),e=Kc(),r={maxWorkerInstances:1,autoTerminateOnIdle:{enabled:!0,idleTimeThreshold:2e3}};e.registerWorker("polySeg",t,r)}const O2=new Map;async function x4(t,e,r,n,i){CV();const o=await r();xV({segmentationId:t,type:e,data:o}),i==null||i(),O2.has(t)||O2.set(t,[]);const a=O2.get(t);return a.includes(e)||a.push(e),lge(n),Ro(t),o}function lge(t){const e=r=>{uge(r,t)};t._debouncedUpdateFunction=e,We.removeEventListener(U.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction),We.addEventListener(U.SEGMENTATION_DATA_MODIFIED,t._debouncedUpdateFunction)}const uge=P5((t,e)=>{const r=t.detail.segmentationId,n=O2.get(r);!n||!n.length||(e(r),n.length&&Ro(r))},300);function Qs(t){const e=Whe(t);if(e)return e;const r=jt(t);if(!r)throw new Error(`No segmentation found for segmentationId ${t}`);let n;if(r.representationData.Labelmap)n=fge(r,t);else if(r.representationData.Contour)n=gge(r);else if(r.representationData.Surface)n=pge(r);else throw new Error(`Unsupported segmentation type: ${r.representationData}`);return zhe(t,n),n}function fge(t,e){const r=t.representationData[ht.Labelmap],n=new Set;return r.imageIds?hge(n,r.imageIds):dge(n,e),Array.from(n).map(Number).sort((i,o)=>i-o)}function dge(t,e){ke.getVolume(e).voxelManager.forEach(({value:n})=>{n!==0&&t.add(n)})}function hge(t,e){e.forEach(r=>{ke.getImage(r).voxelManager.getScalarData().forEach(o=>{o!==0&&t.add(o)})})}function gge(t){const{annotationUIDsMap:e,geometryIds:r}=t.representationData.Contour||{};if(!r)throw new Error(`No geometryIds found for segmentationId ${t.segmentationId}`);const n=new Set([...e.keys()]);return r.forEach(i=>{const o=ke.getGeometry(i);n.add(o.data.segmentIndex)}),Array.from(n).sort((i,o)=>i-o)}function pge(t){var r;const e=((r=t.representationData.Surface)==null?void 0:r.geometryIds)??[];return Array.from(e.keys()).map(Number).sort((n,i)=>n-i)}const mge=Kc(),u3=(t,e,r)=>{Qe(t,$e.WEB_WORKER_PROGRESS,{progress:e,type:lh.POLYSEG_CONTOUR_TO_SURFACE,id:r})};async function vge(t,e){const{annotationUIDsMap:r}=t,n=[],i=[],o=r.get(e);for(const s of o){const c=xr(s),{polyline:l}=c.data.contour;i.push(l.length),l.forEach(f=>n.push(...f))}u3(We,0,e);const a=await mge.executeTask("polySeg","convertContourToSurface",{polylines:n,numPointsArray:i},{callbacks:[s=>{u3(We,s,e)}]});return u3(We,100,e),a}function SV(){return Vn.getNextColorLUTIndex()}const ty=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]];function Rg(t,e){const r=Vn,n=e??SV();let i=[...t];if(At(i[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),i=[[0,0,0,0],...i]),i=i.map(o=>o.length===3?[o[0],o[1],o[2],255]:o),i.length<255){const o=ty.slice(i.length);i=[...i,...o]}return r.addColorLUT(i,n),n}function yge(t,e){if(!t)throw new Error("addColorLUT: colorLUT is required");return Rg(t,e)}function wge(t,e,r){if(!p1(r))throw new Error(`setColorLUT: could not find colorLUT with index ${r}`);const n=Mo(t,{segmentationId:e});if(!n)throw new Error(`viewport specific state for viewport ${t} does not exist`);n.forEach(i=>{i.colorLUTIndex=r}),Ns(t,e)}function qc(t,e,r){const n=Mo(t,{segmentationId:e});if(!n||n.length===0)return null;const i=n[0],{colorLUTIndex:o}=i,a=p1(o);let s=a[r];if(!s){if(typeof r!="number")throw new Error(`Can't create colour for LUT index ${r}`);s=a[r]=[0,0,0,0]}return s}function TV(t,e,r,n){const i=qc(t,e,r);for(let o=0;o<n.length;o++)i[o]=n[o];Ns(t,e)}const xge=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:yge,getSegmentIndexColor:qc,setColorLUT:wge,setSegmentIndexColor:TV},Symbol.toStringTag,{value:"Module"}));async function _V(t,e,r={}){const n=jt(t),i=new Map,o=Object.keys(e).map(async a=>{const s=e[a],c=s.segmentIndex,l=qc(r.viewport.id,n.segmentationId,c).slice(0,3);if(!l)throw new Error("No color found for segment index, unable to create surface");const f={id:`segmentation_${n.segmentationId}_surface_${c}`,color:l,frameOfReferenceUID:"test-frameOfReferenceUID",points:s.data.points,polys:s.data.polys,segmentIndex:c},u=f.id;return i.set(c,u),bN(u,{type:$f.SURFACE,geometryData:f})});return await Promise.all(o),{geometryIds:i}}async function EV(t){return mV(t)}const Cge=Kc(),f3=(t,e,r)=>{Qe(t,$e.WEB_WORKER_PROGRESS,{progress:e,type:lh.POLYSEG_LABELMAP_TO_SURFACE,id:r})};async function Sge(t,e){let r;if(t.volumeId)r=t.volumeId;else{const{imageIds:f}=t;({volumeId:r}=await EV({imageIds:f}))}const n=ke.getVolume(r),i=n.voxelManager.getCompleteScalarDataArray(),{dimensions:o,spacing:a,origin:s,direction:c}=n;f3(We,0,e);const l=await Cge.executeTask("polySeg","convertLabelmapToSurface",{scalarData:i,dimensions:o,spacing:a,origin:s,direction:c,segmentIndex:e},{callbacks:[f=>{f3(We,f,e)}]});return f3(We,100,e),l}async function Tge(t,e={}){var s;const r=(s=e.segmentIndices)!=null&&s.length?e.segmentIndices:Qs(t);let n;const i=jt(t),o=i.representationData;try{o.Contour?n=await _ge(t,{segmentIndices:r,...e}):o.Labelmap&&(n=await C4(i.segmentationId,{segmentIndices:r,...e}))}catch(c){throw console.error(c),c}if(!n)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await _V(t,n,e)}async function C4(t,e={}){var l;const r=jt(t);if(!((l=r==null?void 0:r.representationData)!=null&&l.Labelmap)){console.warn("Only support surface update from labelmaps");return}const n=r.representationData.Labelmap,i=e.segmentIndices||Qs(t),o=i.map(f=>Sge(n,f)),a=await Promise.allSettled(o),s=a.filter(f=>f.status==="rejected");if(s.length>0)throw console.error(s),new Error("Failed to convert labelmap to surface");return a.map((f,u)=>{if(f.status==="fulfilled")return{segmentIndex:i[u],data:f.value}}).filter(Boolean)}async function _ge(t,e={}){const n=jt(t).representationData.Contour,o=(e.segmentIndices||Qs(t)).map(async s=>{const c=await vge(n,s);return{segmentIndex:s,data:c}});return await Promise.all(o)}function dh(t){const n=Vn.getState().viewportSegRepresentations;return Object.entries(n).filter(([,o])=>o.some(a=>a.segmentationId===t)).map(([o])=>o)}async function Ege(t){const e=await C4(t);if(!e)return;const r=jt(t),n=Qs(t);if(!n.length){r.representationData.Surface.geometryIds.forEach(a=>{const c=ke.getGeometry(a).data;c.points=[],c.polys=[]}),Ro(t);return}const i=e.map(({data:o,segmentIndex:a})=>{const s=`segmentation_${t}_surface_${a}`,c=ke.getGeometry(s);if(c)if(n.includes(a)){const l=c.data;l.points=o.points,l.polys=o.polys}else{const l=c.data;l.points=[],l.polys=[]}else return dh(t).map(f=>[M5(f,{segmentationId:t,type:ht.Surface})].map(d=>(r.representationData.Surface.geometryIds.set(a,s),_V(t,[{segmentIndex:a,data:o}],{segmentationId:d.segmentationId}))))});await Promise.all(i),Ro(t)}function DV(t,e={}){return x4(t,ht.Surface,()=>Tge(t,e),()=>Ege(t))}function Dge(t,e,r=!1){const n=An(t);if(!n)return;const{viewport:i}=n;nge(i.element,e),r&&i.render()}async function bge(t,e){const{segmentationId:r}=e,n=jt(r);if(!n)return;let i=n.representationData[ht.Surface];if(!i&&R5(r,ht.Surface)&&(i=await DV(r,{viewport:t}),!i))throw new Error(`No Surface data found for segmentationId ${r}.`);const{geometryIds:o}=i;o!=null&&o.size||console.warn(`No Surfaces found for segmentationId ${r}. Skipping render.`);const{colorLUTIndex:a}=e,s=p1(a);o.forEach(c=>{const l=ke.getGeometry(c);if(!(l!=null&&l.data)){console.warn(`No Surfaces found for geometryId ${c}. Skipping render.`);return}const f=l.data.segmentIndex,u=l.data,d=s[f];u.color=d.slice(0,3),rge(t.element,u,r)}),t.render()}const bV={render:bge,removeRepresentation:Dge};function Ige(t,e,r,n){const i=t.getViewReference(),{viewPlaneNormal:o,FrameOfReferenceUID:a}=i,s={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:e,viewPlaneNormal:o,FrameOfReferenceUID:a,referencedImageId:Oge(t,r[0],o),...n}};return Zt(s,t.element),s}function Oge(t,e,r){let n;if(t instanceof Jn)n=L5(t,e,r);else if(t instanceof Xn){const i=Mge(t),o=Zs(i),a=ke.getVolume(o);n=$c(a,e,r)}else throw new Error("getReferencedImageId: viewport must be a StackViewport or BaseVolumeViewport");return n}function Mge(t){var r;const e=(r=t.getViewReferenceId)==null?void 0:r.call(t);if(e)return e;if(t instanceof Xn)return`volumeId:${Rge(t)}`;throw new Error("getTargetId: viewport must have a getTargetId method")}function Rge(t){var r;const e=t.getActors();if(e)return(r=e.find(n=>n.actor.getClassName()==="vtkVolume"))==null?void 0:r.uid}function L5(t,e,r){const n=t.getImageIds();if(!n||!n.length)return;const i=n.map(o=>{const{imagePositionPatient:a}=dt("imagePlaneModule",o),s=Pge(e,a,r);return{imageId:o,distance:s}});return i.sort((o,a)=>o.distance-a.distance),i[0].imageId}function Pge(t,e,r){const n=Ae();bn(n,t,e);const i=gt(n,r);return Math.abs(i)}function IV(t,e){const{segmentation:r}=t.data,{segmentation:n}=e.data;return r.segmentationId===n.segmentationId&&r.segmentIndex===n.segmentIndex}function m1(t){var e;return!!((e=t.data)!=null&&e.segmentation)}function Jf(t){if(t.parentAnnotationUID)return;if(!t.data.segmentation)throw new Error("addContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=jt(e);n.representationData.Contour||(n.representationData.Contour={annotationUIDsMap:new Map});let{annotationUIDsMap:i}=n.representationData.Contour;i||(i=new Map);let o=i==null?void 0:i.get(r);o||(o=new Set,i.set(r,o)),i.set(r,o.add(t.annotationUID))}function A5(t){if(!t.data.segmentation)throw new Error("removeContourSegmentationAnnotation: annotation does not have a segmentation data");const{segmentationId:e,segmentIndex:r}=t.data.segmentation,n=jt(e),{annotationUIDsMap:i}=(n==null?void 0:n.representationData.Contour)||{},o=i==null?void 0:i.get(r);o&&(o.delete(t.annotationUID),o.size||i.delete(r))}const Lge=Object.freeze(Object.defineProperty({__proto__:null,addContourSegmentationAnnotation:Jf,areSameSegment:IV,isContourSegmentationAnnotation:m1,removeContourSegmentationAnnotation:A5},Symbol.toStringTag,{value:"Module"}));function Age(t){if(!t)throw new Error(`No contours found for geometryId ${t.id}`);const e=t.id;if(t.type!==$f.CONTOUR)throw new Error(`Geometry type ${t.type} not supported for rendering.`);if(!t.data){console.warn(`No contours found for geometryId ${e}. Skipping render.`);return}}function Nge(t,e,r,n){r.size?t.render():kge(t,e,n)}function kge(t,e,r){const{segmentationId:n}=r,i=new Map;e.forEach(o=>{const a=ke.getGeometry(o);if(!a){console.warn(`No geometry found for geometryId ${o}. Skipping render.`);return}const s=a.data.segmentIndex;Age(a);const c=jo.getStyle({viewportId:t.id,segmentationId:n,type:ht.Contour,segmentIndex:s}),l=a.data,f=t.getCamera().viewPlaneNormal;l.contours.forEach(u=>{const{points:d,color:h,id:g}=u,p=L5(t,d[0],f),v={annotationUID:Cn(),data:{contour:{closed:!0,polyline:d},segmentation:{segmentationId:n,segmentIndex:s,color:h,id:g},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!0,isVisible:!0,metadata:{referencedImageId:p,toolName:"PlanarFreehandContourSegmentationTool",FrameOfReferenceUID:t.getFrameOfReferenceUID(),viewPlaneNormal:t.getCamera().viewPlaneNormal}},w=t.element;Zt(v,w),Jf(v)}),c&&i.set(s,c)}),t.resetCamera(),t.render()}function S4(t,e=5){return parseFloat(t[0]).toFixed(e)+","+parseFloat(t[1]).toFixed(e)+","+parseFloat(t[2]).toFixed(e)+","}const OV=Kc(),UC=new Map,BC=new Map,M2=(t,e)=>{Qe(t,$e.WEB_WORKER_PROGRESS,{progress:e,type:lh.SURFACE_CLIPPING})};async function MV(t,e){var a;CV();const r=(a=e.getSlicesClippingPlanes)==null?void 0:a.call(e);if(!r)return;const n=e.getSliceIndex();r.sort((s,c)=>{const l=Math.abs(s.sliceIndex-n),f=Math.abs(c.sliceIndex-n);return l-f}),M2(We,0),await Vge(t);const i=new Map;t.forEach(s=>{i.set(s.id,BC.get(s.id))});const o=e.getCamera();return await OV.executeTask("polySeg","cutSurfacesIntoPlanes",{surfacesInfo:t,planesInfo:r,surfacesAABB:i},{callbacks:[({progress:s})=>{M2(We,s)},({sliceIndex:s,polyDataResults:c})=>{c.forEach((l,f)=>{const u=Number(f),d=Fge(e,o.viewPlaneNormal,s);Uge(u,d,l)})}]}).catch(s=>{console.error(s)}),M2(We,100),UC}async function Vge(t){const e=t.filter(n=>!BC.has(n.id));if(!e.length)return;(await OV.executeTask("polySeg","getSurfacesAABBs",{surfacesInfo:e},{callbacks:[({progress:n})=>{M2(We,n)}]})).forEach((n,i)=>{BC.set(i,n)})}function Fge(t,e,r){return`${t.id}-${S4(e)}-${r}`}function Uge(t,e,r){const{points:n,lines:i,numberOfCells:o}=r;let a=UC.get(t);a||(a=new Map,UC.set(t,a)),a.set(e,{points:n,lines:i,numberOfCells:o})}function RV(t){const e=new Map;for(const[r,n]of t){const i=Number(r);for(const[o,a]of n)a&&(e.has(i)||e.set(i,[]),e.get(i).push(a))}return e}const{CalibrationTypes:Bh}=Da,cf="px",PV=[1,2,3,4],Bge=["3,3","4,7"],Gge=["4,3","4,7"],GC={0:"px",1:"percent",2:"dB",3:"cm",4:"seconds",5:"hertz",6:"dB/seconds",7:"cm/sec",8:"cm",9:"cm/s",12:"degrees"},Wge=.001,Gh="",Ko=(t,e)=>{const{calibration:r,hasPixelSpacing:n}=t;let i=n?"mm":cf,o=i+Gh,a=1,s="";if(!r||!r.type&&!r.sequenceOfUltrasoundRegions)return{unit:i,areaUnit:o,scale:a};if(r.type===Bh.UNCALIBRATED)return{unit:cf,areaUnit:cf+Gh,scale:a};if(r.sequenceOfUltrasoundRegions){let l,f;if(Array.isArray(e)&&e.length===2)[l,f]=e;else if(typeof e=="function"){const v=e();l=v[0],f=v[1]}let u=r.sequenceOfUltrasoundRegions.filter(v=>l[0]>=v.regionLocationMinX0&&l[0]<=v.regionLocationMaxX1&&l[1]>=v.regionLocationMinY0&&l[1]<=v.regionLocationMaxY1&&f[0]>=v.regionLocationMinX0&&f[0]<=v.regionLocationMaxX1&&f[1]>=v.regionLocationMinY0&&f[1]<=v.regionLocationMaxY1);if(!(u!=null&&u.length))return{unit:i,areaUnit:o,scale:a};if(u=u.filter(v=>PV.includes(v.regionDataType)&&Bge.includes(`${v.physicalUnitsXDirection},${v.physicalUnitsYDirection}`)),!u.length)return{unit:cf,areaUnit:cf+Gh,scale:a};const d=u[0],h=Math.abs(d.physicalDeltaX),g=Math.abs(d.physicalDeltaY);if(At(h,g,Wge))a=1/h,s="US Region",i=GC[d.physicalUnitsXDirection]||"unknown",o=i+Gh;else return{unit:cf,areaUnit:cf+Gh,scale:a}}else r.scale&&(a=r.scale);return[Bh.ERMF,Bh.USER,Bh.ERROR,Bh.PROJECTION].includes(r==null?void 0:r.type)&&(s=r.type),{unit:i+(s?` ${s}`:""),areaUnit:o+(s?` ${s}`:""),scale:a}},ny=(t,e)=>{const[r]=e,{calibration:n}=t;let i=["raw"],o=[null],a="";if(!n||!n.type&&!n.sequenceOfUltrasoundRegions)return{units:i,values:o};if(n.sequenceOfUltrasoundRegions){const s=n.sequenceOfUltrasoundRegions.filter(p=>PV.includes(p.regionDataType)&&Gge.includes(`${p.physicalUnitsXDirection},${p.physicalUnitsYDirection}`));if(!(s!=null&&s.length))return{units:i,values:o};const c=s.find(p=>r[0]>=p.regionLocationMinX0&&r[0]<=p.regionLocationMaxX1&&r[1]>=p.regionLocationMinY0&&r[1]<=p.regionLocationMaxY1);if(!c)return{units:i,values:o};const{referencePixelX0:l=0,referencePixelY0:f=0}=c,{physicalDeltaX:u,physicalDeltaY:d}=c,h=(r[1]-c.regionLocationMinY0-f)*d,g=(r[0]-c.regionLocationMinX0-l)*u;a="US Region",o=[g,h],i=[GC[c.physicalUnitsXDirection],GC[c.physicalUnitsYDirection]]}return{units:i,values:o,calibrationType:a}},T4=t=>{var e;return((e=t.calibration)==null?void 0:e.aspect)||1};function LV(t,e){return t.minX<=e.maxX&&t.maxX>=e.minX&&t.minY<=e.maxY&&t.maxY>=e.minY}function ry(t,e){const r=t.maxX-t.minX,n=t.maxY-t.minY,i=[r,n],o=[t.minX+r/2,t.minY+n/2],a=[Math.abs(e[0]-o[0]),Math.abs(e[1]-o[1])],s=a[0]-i[0]*.5,c=a[1]-i[1]*.5;if(s>0&&c>0)return s*s+c*c;const l=Math.max(s,0)+Math.max(c,0);return l*l}function zge(t,e){return Math.sqrt(ry(t,e))}const $ge=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:zge,distanceToPointSquared:ry,intersectAABB:LV},Symbol.toStringTag,{value:"Module"}));class AV{}const{PointsManager:OD}=cn,Nt=class Nt extends AV{static statsInit(e){e.storePointData||(Nt.pointsInShape=null)}};Nt.max=[-1/0],Nt.min=[1/0],Nt.sum=[0],Nt.count=0,Nt.runMean=[0],Nt.m2=[0],Nt.pointsInShape=OD.create3(1024),Nt.statsCallback=({value:e,pointLPS:r=null})=>{var i;Array.isArray(e)&&e.length>1&&Nt.max.length===1&&(Nt.max.push(Nt.max[0],Nt.max[0]),Nt.min.push(Nt.min[0],Nt.min[0]),Nt.sum.push(Nt.sum[0],Nt.sum[0]),Nt.runMean.push(0,0),Nt.m2.push(Nt.m2[0],Nt.m2[0])),Nt.pointsInShape&&r&&((i=Nt.pointsInShape)==null||i.push(r));const n=Array.isArray(e)?e:[e];Nt.count+=1,Nt.max.map((o,a)=>{const s=n[a],c=s-Nt.runMean[a];Nt.sum[a]+=s,Nt.runMean[a]+=c/Nt.count;const l=s-Nt.runMean[a];Nt.m2[a]+=c*l,Nt.min[a]=Math.min(Nt.min[a],s),Nt.max[a]=Math.max(o,s)})},Nt.getStatistics=e=>{const r=Nt.sum.map(a=>a/Nt.count),n=Nt.m2.map(a=>Math.sqrt(a/Nt.count)),i=(e==null?void 0:e.unit)||null,o={max:{name:"max",label:"Max Pixel",value:Dm(Nt.max),unit:i},min:{name:"min",label:"Min Pixel",value:Dm(Nt.min),unit:i},mean:{name:"mean",label:"Mean Pixel",value:Dm(r),unit:i},stdDev:{name:"stdDev",label:"Standard Deviation",value:Dm(n),unit:i},count:{name:"count",label:"Pixel Count",value:Nt.count,unit:null},pointsInShape:Nt.pointsInShape,array:[]};return o.array.push(o.max,o.mean,o.stdDev,o.stdDev,o.count),Nt.max=[-1/0],Nt.min=[1/0],Nt.sum=[0],Nt.m2=[0],Nt.runMean=[0],Nt.count=0,Nt.pointsInShape=OD.create3(1024),o};let wa=Nt;function Dm(t){return t.length===1?t[0]:t}const jge=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:wa,Calculator:AV},Symbol.toStringTag,{value:"Module"}));function jc(t,e){if(t.length!==e.length)throw Error("Both points should have the same dimensionality");const[r,n,i=0]=t,[o,a,s=0]=e,c=o-r,l=a-n,f=s-i;return c*c+l*l+f*f}function _a(t,e){return Math.sqrt(jc(t,e))}function WC(t,e){const[r,n]=t,[i,o]=e,a=2*i-r,s=2*o-n;return[a,s]}const Hge=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:_a,distanceToPointSquared:jc,mirror:WC},Symbol.toStringTag,{value:"Module"}));function ou(t){const[e,r]=t;return _a(e,r)}function yd(t){const[e,r]=t,n=_a(e,r),i=[e[0]-n,e[1]-n],o=[e[0]+n,e[1]+n];return[i,o]}const Kge=Object.freeze(Object.defineProperty({__proto__:null,getCanvasCircleCorners:yd,getCanvasCircleRadius:ou},Symbol.toStringTag,{value:"Module"}));function N5(t,e,r={}){return r.precalculated||_4(t,r),r.precalculated(e)}const _4=(t,e={})=>{const{xRadius:r,yRadius:n,zRadius:i}=t;(e.invXRadiusSq===void 0||e.invYRadiusSq===void 0||e.invZRadiusSq===void 0)&&(e.invXRadiusSq=r!==0?1/r**2:0,e.invYRadiusSq=n!==0?1/n**2:0,e.invZRadiusSq=i!==0?1/i**2:0);const{invXRadiusSq:o,invYRadiusSq:a,invZRadiusSq:s}=e,{center:c}=t,[l,f,u]=c;return e.precalculated=d=>{const h=d[0]-l;let g=h*h*o;if(g>1)return!1;const p=d[1]-f;if(g+=p*p*a,g>1)return!1;const v=d[2]-u;return g+=v*v*s,g<=1},e};function Pg(t){const[e,r,n,i]=t,o=[n[0],r[1]],a=[i[0],e[1]];return[o,a]}const qge=Object.freeze(Object.defineProperty({__proto__:null,getCanvasEllipseCorners:Pg,pointInEllipse:N5,precalculatePointInEllipse:_4},Symbol.toStringTag,{value:"Module"}));function iy(t,e,r){let n;const i=jc(t,e);if(t[0]===e[0]&&t[1]===e[1]&&(n=t),!n){const o=((r[0]-t[0])*(e[0]-t[0])+(r[1]-t[1])*(e[1]-t[1]))/i;o<0?n=t:o>1?n=e:n=[t[0]+o*(e[0]-t[0]),t[1]+o*(e[1]-t[1])]}return{point:[...n],distanceSquared:jc(r,n)}}function v1(t,e,r){return iy(t,e,r).distanceSquared}function Ii(t,e,r){if(t.length!==2||e.length!==2||r.length!==2)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(v1(t,e,r))}function bm(t){return typeof t=="number"?t?t<0?-1:1:t===t?0:NaN:NaN}function zC(t,e,r,n){const[i,o]=t,[a,s]=e,[c,l]=r,[f,u]=n,d=s-o,h=i-a,g=a*o-i*s,p=d*c+h*l+g,v=d*f+h*u+g;if(p!==0&&v!==0&&bm(p)===bm(v))return;const w=u-l,m=c-f,y=f*l-c*u,x=w*i+m*o+y,C=w*a+m*s+y;if(x!==0&&C!==0&&bm(x)===bm(C))return;const S=d*m-w*h;let T;T=h*y-m*g;const _=T/S;T=w*g-d*y;const E=T/S;return[_,E]}const Wh=.01;function R2(t,e,r){const n=t[0]<=e[0]?t[0]:e[0],i=t[0]>=e[0]?t[0]:e[0],o=t[1]<=e[1]?t[1]:e[1],a=t[1]>=e[1]?t[1]:e[1];if(!(r[0]>=n-Wh&&r[0]<=i+Wh&&r[1]>=o-Wh&&r[1]<=a+Wh))return!1;const c=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return(c>=0?c:-c)<=Wh}const Xge=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:Ii,distanceToPointSquared:v1,distanceToPointSquaredInfo:iy,intersectLine:zC,isPointOnLineSegment:R2},Symbol.toStringTag,{value:"Module"}));function NV(t){if(t.length<3)return!1;const e=t.length,r=t[0],n=t[e-1],i=jc(r,n);return du(0,i)}function Zf(t,e,r={closed:void 0}){if(t.length<3)return!1;const n=t.length;let i=0;const{closed:o,holes:a}=r;if(a!=null&&a.length){for(const l of a)if(Zf(l,e))return!1}const s=!(o===void 0?NV(t):o),c=t.length-(s?1:2);for(let l=0;l<=c;l++){const f=t[l],u=l===n-1?0:l+1,d=t[u],h=f[0]>=d[0]?f[0]:d[0],g=f[1]>=d[1]?f[1]:d[1],p=f[1]<=d[1]?f[1]:d[1];if(e[0]<=h&&e[1]>=p&&e[1]<g){let m=f[0]===d[0];if(!m){const y=(e[1]-f[1])*(d[0]-f[0])/(d[1]-f[1])+f[0];m=e[0]<=y}i+=m?1:0}}return!!(i%2)}function E4(t,e){for(let r=0,n=e.length;r<n;r++)if(!Zf(t,e[r]))return!1;return!0}function Gd(t,e){let r=t;const n=(e==null?void 0:e.numDimensions)||2,i=n===3;if(!Array.isArray(t[0])){const u=t,d=u.length/n;r=new Array(u.length/n);for(let h=0,g=d;h<g;h++)r[h]=[u[h*n],u[h*n+1]],i&&r[h].push(u[h*n+2])}let o=1/0,a=1/0,s=-1/0,c=-1/0,l=1/0,f=-1/0;r=r;for(let u=0,d=r.length;u<d;u++){const[h,g,p]=r[u];o=o<h?o:h,a=a<g?a:g,s=s>h?s:h,c=c>g?c:g,i&&(l=l<p?l:p,f=f>p?f:p)}return i?{minX:o,maxX:s,minY:a,maxY:c,minZ:l,maxZ:f}:{minX:o,maxX:s,minY:a,maxY:c}}function y1(t){const e=t.length;let r=0,n=e-1;for(let i=0;i<e;i++)r+=(t[n][0]+t[i][0])*(t[n][1]-t[i][1]),n=i;return Math.abs(r/2)}function D4(t){if(t.length<3)return 0;const e=t[0];let r=0;for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-e[0],l=o[1]-e[1],f=s[0]-e[0],u=s[1]-e[1];r+=c*u-l*f}return r*=.5,r}function P2(t){return D4(t)>=0?1:-1}function Yge(t){const e=Ae(),r=t[0];for(let n=0,i=t.length;n<i;n++){const o=t[n],a=n===i-1?0:n+1,s=t[a],c=o[0]-r[0],l=o[1]-r[1],f=o[2]-r[2],u=s[0]-r[0],d=s[1]-r[1],h=s[2]-r[2];e[0]+=l*h-f*d,e[1]+=f*u-c*h,e[2]+=c*d-l*u}return mr(e,e,.5),e}function Jge(t){const e=Yge(t);return kn(e,e)}function Op(t){const e=D4(t);return[0,0,e/Math.abs(e)]}function b4(t,e,r,n){let i=!1;const o=t[0]<e[0]?t[0]:e[0],a=t[1]<e[1]?t[1]:e[1],s=t[0]>e[0]?t[0]:e[0],c=t[1]>e[1]?t[1]:e[1],l=r[0]<n[0]?r[0]:n[0],f=r[1]<n[1]?r[1]:n[1],u=r[0]>n[0]?r[0]:n[0],d=r[1]>n[1]?r[1]:n[1];if(o>u||s<l||a>d||c<f)return!1;const h=[Im(t,e,r),Im(t,e,n),Im(r,n,t),Im(r,n,e)];return h[0]!==h[1]&&h[2]!==h[3]?!0:((h[0]===0&&Om(t,r,e)||h[1]===0&&Om(t,n,e)||h[2]===0&&Om(r,t,n)||h[3]===0&&Om(r,e,n))&&(i=!0),i)}function Im(t,e,r){const n=(e[1]-t[1])*(r[0]-e[0])-(e[0]-t[0])*(r[1]-e[1]);return n===0?0:n>0?1:2}function Om(t,e,r){return e[0]<=Math.max(t[0],r[0])&&e[0]>=Math.min(t[0],r[0])&&e[1]<=Math.max(t[1],r[1])&&e[1]>=Math.min(t[1],r[1])}function I4(t,e,r,n=!0){const i=[],o=t.length,a=o-(n?1:2);for(let s=0;s<=a;s++){const c=t[s],l=s===o-1?0:s+1,f=t[l];b4(e,r,c,f)&&i.push([s,l])}return i}const Zge=.01;function kV(t,e,r,n){const i=[e[0]-t[0],e[1]-t[1]],o=[n[0]-r[0],n[1]-r[1]],a=o[1]*i[0]-o[0]*i[1];if((a>=0?a:-a)<Zge){const g=[t[0]<e[0]?t[0]:e[0],t[0]>e[0]?t[0]:e[0],t[1]<e[1]?t[1]:e[1],t[1]>e[1]?t[1]:e[1]],p=[r[0]<n[0]?r[0]:n[0],r[0]>n[0]?r[0]:n[0],r[1]<n[1]?r[1]:n[1],r[1]>n[1]?r[1]:n[1]];if(!(g[0]<=p[1]&&g[1]>=p[0]&&g[2]<=p[3]&&g[3]>=p[2])||!(R2(t,e,r)||R2(t,e,n)||R2(r,n,t)))return;const m=g[0]>p[0]?g[0]:p[0],y=g[1]<p[1]?g[1]:p[1],x=g[2]>p[2]?g[2]:p[2],C=g[3]<p[3]?g[3]:p[3],S=(m+y)*.5,T=(x+C)*.5;return[S,T]}let c=t[1]-r[1],l=t[0]-r[0];const f=o[0]*c-o[1]*l,u=i[0]*c-i[1]*l;c=f/a,l=u/a;const d=t[0]+c*i[0],h=t[1]+c*i[1];return[d,h]}var Nf;(function(t){t[t.Vertex=0]="Vertex",t[t.Intersection=1]="Intersection"})(Nf||(Nf={}));var wd;(function(t){t[t.Outside=-1]="Outside",t[t.Edge=0]="Edge",t[t.Inside=1]="Inside"})(wd||(wd={}));var j0;(function(t){t[t.Exiting=-1]="Exiting",t[t.Unknown=0]="Unknown",t[t.Entering=1]="Entering"})(j0||(j0={}));function MD(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];n.next||(n.next=t[e===r-1?0:e+1])}}function VV(t,e){const r=[],n=[],i=new Map;let a=Zf(e,t[0])?j0.Exiting:j0.Entering;for(let s=0,c=t.length;s<c;s++){const l=t[s],f=Zf(e,l),u={type:Nf.Vertex,coordinates:l,position:f?wd.Inside:wd.Outside,visited:!1,next:null};r.push(u);const d=t[s===c-1?0:s+1],h=I4(e,l,d).map(g=>{const p=g[0],v=e[g[0]],w=e[g[1]],m=kV(l,d,v,w),y=jc(l,m);return{sourceLineSegmentId:p,coordinate:m,targetStartPointDistSquared:y}});h.sort((g,p)=>g.targetStartPointDistSquared-p.targetStartPointDistSquared),h.forEach(g=>{const{sourceLineSegmentId:p,coordinate:v}=g,w={type:Nf.Intersection,coordinates:v,position:wd.Edge,direction:a,visited:!1,next:null},m={...w,direction:j0.Unknown,cloned:!0};a===j0.Entering?w.next=m:m.next=w;let y=i.get(p);y||(y=[],i.set(p,y)),r.push(w),y.push(m),a*=-1})}for(let s=0,c=e.length;s<c;s++){const l=s,f=e[s],u={type:Nf.Vertex,coordinates:f,visited:!1,next:null};n.push(u);const d=i.get(l);d!=null&&d.length&&d.map(h=>({intersectionPoint:h,lineSegStartDistSquared:jc(f,h.coordinates)})).sort((h,g)=>h.lineSegStartDistSquared-g.lineSegStartDistSquared).map(({intersectionPoint:h})=>h).forEach(h=>n.push(h))}return MD(r),MD(n),{targetPolylinePoints:r,sourcePolylinePoints:n}}function FV(t){for(let e=0,r=t.length;e<r;e++){const n=t[e];if(!n.visited&&n.position===wd.Outside)return n}}function UV(t,e){const r=Op(t),n=Op(e),i=gt(n,r);du(1,i)||(e=e.slice().reverse());const{targetPolylinePoints:o}=VV(t,e),a=FV(o);if(!a)return t.slice();const s=[a.coordinates];let c=a.next;for(;c!==a;){if(c.type===Nf.Intersection&&c.cloned){c=c.next;continue}s.push(c.coordinates),c=c.next}return s}function BV(t,e){const r=Op(t),n=Op(e),i=gt(n,r);du(-1,i)||(e=e.slice().reverse());const{targetPolylinePoints:o}=VV(t,e);let a=null;const s=[];for(;a=FV(o);){const c=[a.coordinates];let l=a.next;for(a.visited=!0;l!==a;){if(l.visited=!0,l.type===Nf.Intersection&&l.cloned){l=l.next;continue}c.push(l.coordinates),l=l.next}s.push(c)}return s}function GV(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);for(let a=i;a<t.length;a++){const s=t[o],c=t[a];if(b4(e,r,s,c))return[o,a];o=a}}function WV(t,e){for(let r=0,n=t.length;r<n;r++){const i=t[r],o=r===n-1?0:r+1,a=t[o],s=GV(e,i,a);if((s==null?void 0:s.length)===2)return!0}return!1}const Qge=.1;function zV(t,e=Qge){const r=t.length;if(r<3)return t;const n=e*e,i=[[0,r-1]],o=new Array(r).fill(!1);let a=2;for(o[0]=!0,o[r-1]=!0;i.length;){const[c,l]=i.pop();if(l-c===1)continue;const f=t[c],u=t[l];let d=-1/0,h=-1;for(let g=c+1;g<l;g++){const p=t[g],v=v1(f,u,p);v>d&&(d=v,h=g)}d<n||(o[h]=!0,a++,i.push([h,l]),i.push([c,h]))}const s=new Array(a);for(let c=0,l=0;c<r;c++)o[c]&&(s[l++]=t[c]);return s}function $V(t,e,r,n=!0){const i=[],o=I4(t,e,r,n);for(let a=0;a<o.length;a++){const s=t[o[a][0]],c=t[o[a][1]],l=kV(e,r,s,c);i.push(l)}return i}function epe(t,e,r,n=!0){let i,o;n?(o=t.length-1,i=0):(o=0,i=1);const a=[];for(let f=i;f<t.length;f++){const u=t[o],d=t[f];b4(e,r,u,d)&&a.push([o,f]),o=f}if(a.length===0)return;const s=[];a.forEach(f=>{const u=[t[f[0]],t[f[1]]],d=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2];s.push(ir(d,e))});const c=Math.min(...s),l=s.indexOf(c);return{segment:a[l],distance:c}}const _0=.001,tpe=(t,e)=>{let r,n,i;if(t instanceof Jn){const a=t.getImageData();n=a.direction.slice(0,3),i=a.direction.slice(3,6),r=a.spacing}else{const a=t.getImageData(),{direction:s,spacing:c}=a,{viewPlaneNormal:l,viewUp:f}=t.getCamera(),u=s.slice(0,3),d=s.slice(3,6),h=s.slice(6,9),g=Ae();xn(g,f,l);const p=Math.abs(gt(g,u)),v=Math.abs(gt(g,d)),w=Math.abs(gt(g,h));let m;if(Math.abs(1-p)<_0)m=c[0],n=u;else if(Math.abs(1-v)<_0)m=c[1],n=d;else if(Math.abs(1-w)<_0)m=c[2],n=h;else throw new Error("No support yet for oblique plane planar contours");const y=Math.abs(gt(f,u)),x=Math.abs(gt(f,d)),C=Math.abs(gt(f,h));let S;if(Math.abs(1-y)<_0)S=c[0],i=u;else if(Math.abs(1-x)<_0)S=c[1],i=d;else if(Math.abs(1-C)<_0)S=c[2],i=h;else throw new Error("No support yet for oblique plane planar contours");r=[m,S]}return{spacing:[r[0]/e,r[1]/e],xDir:n,yDir:i}},npe=(t,e,r)=>UT(t,e)<r,rpe=(t,e,r,n)=>{const{xDir:i,yDir:o,spacing:a}=n,s=we(t),{viewport:c}=s;if(!e.length)return e.push(r),console.log(">>>>> !canvasPoints. :: RETURN"),1;const l=c.canvasToWorld(e[e.length-1]),f=c.canvasToWorld(r),u=Ae();yn(u,f,l);const d=Math.abs(gt(u,i)),h=Math.abs(gt(u,o)),g=Math.max(Math.floor(d/a[0]),Math.floor(h/a[0]));if(g>1){const p=e[e.length-1],v=UT(p,r),w=Vt();Sr(w,r,p),ga(w,w[0]/v,w[1]/v);const m=v/g;for(let y=1;y<=g;y++)e.push([p[0]+m*w[0]*y,p[1]+m*w[1]*y])}else e.push(r);return g},ipe=(t,e,r,n)=>{const i=[t[0]-e[0],t[1]-e[1]],o=[r[0]-e[0],r[1]-e[1]],a=i[0]*o[0]+i[1]*o[1];if(a<0)return!1;const s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(s===0)return!1;const c=a/s,l=[o[0]/s,o[1]/s],f=[l[0]*c,l[1]*c],u=[e[0]+f[0],e[1]+f[1]];return!(ir(t,u)>n||ir(e,u)>ir(e,r))},ope=1e-6;function jV(t){let e;const r=JA(t,50);for(let a=0;a<3;a++)if(r.every((s,c,l)=>Math.abs(s[a]-l[0][a])<ope)){e=a;break}if(e===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const n=[],i=(e+1)%3,o=(e+2)%3;for(let a=0;a<t.length;a++)n.push([t[a][i],t[a][o]]);return{sharedDimensionIndex:e,projectedPolyline:n}}function O4(t,e,r={}){const{sharedDimensionIndex:n,projectedPolyline:i}=jV(e),{holes:o}=r,a=[];if(o)for(let c=0;c<o.length;c++){const l=o[c],f=[];for(let u=0;u<l.length;u++)f.push([l[u][(n+1)%3],l[u][(n+2)%3]]);a.push(f)}const s=[t[(n+1)%3],t[(n+2)%3]];return Zf(i,s,{holes:a})}const Tu=Object.freeze(Object.defineProperty({__proto__:null,addCanvasPointsToArray:rpe,containsPoint:Zf,containsPoints:E4,decimate:zV,getAABB:Gd,getArea:y1,getClosestLineSegmentIntersection:epe,getFirstLineSegmentIntersectionIndexes:GV,getLineSegmentIntersectionsCoordinates:$V,getLineSegmentIntersectionsIndexes:I4,getNormal2:Op,getNormal3:Jge,getSignedArea:D4,getSubPixelSpacingAndXYDirections:tpe,getWindingDirection:P2,intersectPolyline:WV,isClosed:NV,isPointInsidePolyline3D:O4,mergePolylines:UV,pointCanProjectOnLine:ipe,pointsAreWithinCloseContourProximity:npe,projectTo2D:jV,subtractPolylines:BV},Symbol.toStringTag,{value:"Module"}));function ape(t,e,r,n){const i=[t,e],o=[t+r,e],a=[t+r,e],s=[t+r,e+n],c=[t+r,e+n],l=[t,e+n],f=[t,e+n];return{top:[i,o],right:[a,s],bottom:[c,l],left:[f,[t,e]]}}function M4(t,e){if(t.length!==4||e.length!==2)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[r,n,i,o]=t;let a=655535;const s=ape(r,n,i,o);return Object.keys(s).forEach(c=>{const[l,f]=s[c],u=Ii(l,f,e);u<a&&(a=u)}),a}const spe=Object.freeze(Object.defineProperty({__proto__:null,distanceToPoint:M4},Symbol.toStringTag,{value:"Module"}));function $C(t,e){let r=[0,0],n=Number.MAX_SAFE_INTEGER;return t.forEach(function(i){const o=cpe(e,i);o<n&&(n=o,r=[...i])}),r}function cpe(t,e){const[r,n]=t,[i,o]=e;return Math.sqrt(Math.pow(r-i,2)+Math.pow(n-o,2))}const jC=1e-6,RD=1,lpe=0;function Mm(t,e,r){const[n,i]=r;if(Math.abs(e)<jC)return t<0;const o=t/e;if(e>0){if(o>i)return 0;o>n&&(r[0]=o)}else{if(o<n)return 0;o<i&&(r[1]=o)}return 1}function dg(t,e,r,n,i){const[o,a]=t,[s,c]=e,l=s-o,f=c-a;if(n===void 0||i===void 0?(n=t,i=e):(n[0]=t[0],n[1]=t[1],i[0]=e[0],i[1]=e[1]),Math.abs(l)<jC&&Math.abs(f)<jC&&o>=r[0]&&o<=r[2]&&a>=r[1]&&a<=r[3])return RD;const u=[0,1];if(Mm(r[0]-o,l,u)&&Mm(o-r[2],-l,u)&&Mm(r[1]-a,f,u)&&Mm(a-r[3],-f,u)){const[d,h]=u;return h<1&&(i[0]=o+h*l,i[1]=a+h*f),d>0&&(n[0]+=d*l,n[1]+=d*f),RD}return lpe}const upe=Object.freeze(Object.defineProperty({__proto__:null,findClosestPoint:$C,liangBarksyClip:dg},Symbol.toStringTag,{value:"Module"})),fpe=Object.freeze(Object.defineProperty({__proto__:null,BasicStatsCalculator:jge,aabb:$ge,circle:Kge,ellipse:qge,lineSegment:Xge,point:Hge,polyline:Tu,rectangle:spe,vec2:upe},Symbol.toStringTag,{value:"Module"})),{EPSILON:dpe}=Cu,hpe=1-dpe;function R4(t,e,r){var c;const{viewPlaneNormal:n}=e,i=t.filter(l=>{let f=l.metadata.viewPlaneNormal;if(!f){const{referencedImageId:d}=l.metadata,{imageOrientationPatient:h}=dt("imagePlaneModule",d),g=xt(h[0],h[1],h[2]),p=xt(h[3],h[4],h[5]);f=Ae(),xn(f,g,p),l.metadata.viewPlaneNormal=f}const u=Math.abs(gt(n,f))>hpe;return f&&u});if(!i.length)return[];const o=r/2,{focalPoint:a}=e,s=[];for(const l of i){const f=l.data,u=f.handles.points[0]||((c=f.contour)==null?void 0:c.polyline[0]);if(!l.isVisible)continue;const d=Ae();if(!u){s.push(l);continue}bn(d,a,u);const h=gt(d,n);Math.abs(h)<o&&s.push(l)}return s}function k5(t,e,r,n){const i=Ae();xn(i,e,t);const o=xt(...r),a=xt(...n),s=Ae();yn(s,o,a);const c=fo(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=gt(s,i)/(c*fo(i)),u=Math.sqrt(1-l*l)*c,d=l*c;return{worldWidth:u,worldHeight:d}}function w1(t,e,r={}){if(t instanceof Rn){const n=t.getCamera(),{spacingInNormalDirection:i}=oh(t,n);return R4(e,n,i)}if(t instanceof Jn){const n=t.getCurrentImageId();if(!n)return[];const i=n.indexOf(":");r.imageURI=n.substring(i+1)}return e.filter(n=>n.isVisible?n.data.isCanvasAnnotation?!0:t.isReferenceViewable(n.metadata,r):!1)}function P4(t,e,r,n,i=.25){const o=L4(t,e,{targetVolumeId:r,stepSize:i});let a;for(const s of o){const c=t.getIntensityFromWorld(s),l=n(c,s);l&&(a=l)}return a}function L4(t,e,{targetVolumeId:r,stepSize:n}){const i=t.getCamera(),{viewPlaneNormal:o}=i,{spacingInNormalDirection:a}=oh(t,i,r),s=a*n||1,c=t.getBounds(),l=[];let f=[...e];for(;PD(f,c);)l.push([...f]),f[0]+=o[0]*s,f[1]+=o[1]*s,f[2]+=o[2]*s;for(f=[...e];PD(f,c);)l.push([...f]),f[0]-=o[0]*s,f[1]-=o[1]*s,f[2]-=o[2]*s;return l}const PD=function(t,e){const[r,n,i,o,a,s]=e,c=10;return t[0]>r+c&&t[0]<n-c&&t[1]>i+c&&t[1]<o-c&&t[2]>a+c&&t[2]<s-c},HV=(t,e,r,n,i,o,a,s)=>{const c=[xt(r,n,i),xt(o,n,i),xt(r,a,i),xt(o,a,i),xt(r,n,s),xt(o,n,s),xt(r,a,s),xt(o,a,s)],l=xt(e[0],e[1],e[2]),f=xt(t[0],t[1],t[2]),u=-gt(l,f);let d=null;for(const h of c){const g=gt(l,h)+u;if(d===null)d=Math.sign(g);else if(Math.sign(g)!==d)return!0}return!1},{EPSILON:gpe}=Cu,ppe=1-gpe;function V5(t,e){const{viewPlaneNormal:r}=e,n=t.filter(i=>{let o=i.metadata.viewPlaneNormal;if(!o){const{referencedImageId:s}=i.metadata,{imageOrientationPatient:c}=dt("imagePlaneModule",s),l=xt(c[0],c[1],c[2]),f=xt(c[3],c[4],c[5]);o=Ae(),xn(o,l,f),i.metadata.viewPlaneNormal=o}const a=Math.abs(gt(r,o))>ppe;return o&&a});return n.length?n:[]}const mpe={filterAnnotationsWithinSlice:R4,getWorldWidthAndHeightFromCorners:k5,filterAnnotationsForDisplay:w1,getPointInLineOfSightWithCriteria:P4,isPlaneIntersectingAABB:HV,filterAnnotationsWithinSamePlane:V5,getPointsInLineOfSight:L4},vpe=Object.freeze(Object.defineProperty({__proto__:null,default:mpe,filterAnnotationsForDisplay:w1,filterAnnotationsWithinSamePlane:V5,filterAnnotationsWithinSlice:R4,getPointInLineOfSightWithCriteria:P4,getPointsInLineOfSight:L4,getWorldWidthAndHeightFromCorners:k5,isPlaneIntersectingAABB:HV},Symbol.toStringTag,{value:"Module"}));function eo(t,e,r){let n=!0,i=!0;if(typeof t!="function")throw new TypeError("Expected a function");return w4(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),P5(t,e,{leading:n,trailing:i,maxWait:e})}function KV(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i];o.getFrameOfReferenceUID()===e&&n.push(o)}return n}const{Active:ype,Passive:wpe,Enabled:xpe}=wn;function F5(t,e){const r=t.length,n=[];for(let i=0;i<r;i++){const o=t[i],a=or(o.id,o.renderingEngineId);if(!a)continue;Cpe(a,e)&&n.push(o)}return n}function Cpe(t,e){const{toolOptions:r}=t,n=r[e];if(!n)return!1;const i=n.mode;return i===ype||i===wpe||i===xpe}function qV(t,e,r=.999){return t.filter(n=>{const i=n.getCamera();return Math.abs(gt(i.viewPlaneNormal,e.viewPlaneNormal))>r})}function pt(t,e,r=!0){const n=we(t),{renderingEngine:i,FrameOfReferenceUID:o}=n;let a=i.getViewports();a=KV(a,o),a=F5(a,e);const s=i.getViewport(n.viewportId);return r&&(a=qV(a,s.getCamera())),a.map(l=>l.id)}const Spe=Object.freeze(Object.defineProperty({__proto__:null,filterViewportsWithFrameOfReferenceUID:KV,filterViewportsWithParallelNormals:qV,filterViewportsWithToolEnabled:F5,getViewportIdsWithToolToRender:pt},Symbol.toStringTag,{value:"Module"})),Tpe="viewport-element";function _pe(t){const e=we(t),{viewportId:r,renderingEngineId:n}=e,i=`${r}:${n}`,o=Epe(t);return Object.keys(ze.svgNodeCache[i]).forEach(a=>{ze.svgNodeCache[i][a].touched=!1}),{svgLayerElement:o,svgNodeCacheForCanvas:ze.svgNodeCache,getSvgNode:Dpe.bind(this,i),appendNode:bpe.bind(this,o,i),setNodeTouched:Ipe.bind(this,i),clearUntouched:Ope.bind(this,o,i)}}function Epe(t){const e=`.${Tpe}`,r=t.querySelector(e);return r==null?void 0:r.querySelector(":scope > .svg-layer")}function Dpe(t,e){if(ze.svgNodeCache[t]&&ze.svgNodeCache[t][e])return ze.svgNodeCache[t][e].domRef}function bpe(t,e,r,n){if(!ze.svgNodeCache[e])return null;ze.svgNodeCache[e][n]={touched:!0,domRef:r},t.appendChild(r)}function Ipe(t,e){ze.svgNodeCache[t]&&ze.svgNodeCache[t][e]&&(ze.svgNodeCache[t][e].touched=!0)}function Ope(t,e){ze.svgNodeCache[e]&&Object.keys(ze.svgNodeCache[e]).forEach(r=>{const n=ze.svgNodeCache[e][r];!n.touched&&n.domRef&&(t.removeChild(n.domRef),delete ze.svgNodeCache[e][r])})}function XV(t,e){const r=_pe(t);e(r),r.clearUntouched()}function Xc(t,e,r){return`${t}::${e}::${r}`}function Ea(t,e){Object.keys(t).forEach(r=>{const n=e.getAttribute(r),i=t[r];i===void 0||i===""?e.removeAttribute(r):n!==i&&e.setAttribute(r,i)})}function Yc(t,e){Object.keys(t).forEach(r=>{const n=t[r];n!==void 0&&n!==""&&e.setAttribute(r,n)})}function ho(t,e,r,n,i,o={},a=""){const{color:s,fill:c,width:l,lineWidth:f,lineDash:u,fillOpacity:d,strokeOpacity:h}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},o),g=f||l,p="http://www.w3.org/2000/svg",v=Xc(e,"circle",r),w=t.getSvgNode(v),m={cx:`${n[0]}`,cy:`${n[1]}`,r:`${i}`,stroke:s,fill:c,"stroke-width":g,"stroke-dasharray":u,"fill-opacity":d,"stroke-opacity":h};if(w)Ea(m,w),t.setNodeTouched(v);else{const y=document.createElementNS(p,"circle");a!==""&&y.setAttribute("data-id",a),Yc(m,y),t.appendNode(y,v)}}function A4(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),f=c||s,u="http://www.w3.org/2000/svg",d=Xc(e,"ellipse",r),h=t.getSvgNode(d),[g,p,v,w]=n,m=Math.hypot(v[0]-w[0],v[1]-w[1]),y=Math.hypot(p[0]-g[0],p[1]-g[1]),x=Math.atan2(v[1]-w[1],v[0]-w[0])*180/Math.PI,C=[(v[0]+w[0])/2,(p[1]+g[1])/2],S=m/2,T=y/2,_={cx:`${C[0]}`,cy:`${C[1]}`,rx:`${S}`,ry:`${T}`,stroke:a,fill:"transparent",transform:`rotate(${x} ${C[0]} ${C[1]})`,"stroke-width":f,"stroke-dasharray":l};if(h)Ea(_,h),t.setNodeTouched(d);else{const E=document.createElementNS(u,"ellipse");o!==""&&E.setAttribute("data-id",o),Yc(_,E),t.appendNode(E,d)}}function Mpe(t,e,r,n,i,o={},a=""){const s=[(n[0]+i[0])/2,n[1]],c=[(n[0]+i[0])/2,i[1]],l=[n[0],(n[1]+i[1])/2],f=[i[0],(n[1]+i[1])/2];A4(t,e,r,[c,s,l,f],o={},a="")}function oy(t,e,r,n,i={},o){const{color:a,handleRadius:s,width:c,lineWidth:l,fill:f,type:u,opacity:d}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),h=l||c,g="http://www.w3.org/2000/svg",p=Xc(e,"handle",`hg-${r}-index-${o}`);let v;if(u==="circle")v={cx:`${n[0]}`,cy:`${n[1]}`,r:s,stroke:a,fill:f,"stroke-width":h,opacity:d};else if(u==="rect"){const y=parseFloat(s)*1.5,x=n[0]-y*.5,C=n[1]-y*.5;v={x:`${x}`,y:`${C}`,width:`${y}`,height:`${y}`,stroke:a,fill:f,"stroke-width":h,rx:`${y*.1}`,opacity:d}}else throw new Error(`Unsupported handle type: ${u}`);const w=t.getSvgNode(p);if(w)Ea(v,w),t.setNodeTouched(p);else{const m=document.createElementNS(g,u);Yc(v,m),t.appendNode(m,p)}}function Kn(t,e,r,n,i={}){n.forEach((o,a)=>{oy(t,e,r,o,i,a)})}function an(t,e,r,n,i,o={},a=""){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s,width:c,lineWidth:l,lineDash:f,shadow:u}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},o),d=l||c,h="http://www.w3.org/2000/svg",g=Xc(e,"line",r),p=t.getSvgNode(g),v=u?`filter:url(#shadow-${t.svgLayerElement.id});`:"",w={x1:`${n[0]}`,y1:`${n[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:s,style:v,"stroke-width":d,"stroke-dasharray":f};if(p)Ea(w,p),t.setNodeTouched(g);else{const m=document.createElementNS(h,"line");a!==""&&m.setAttribute("data-id",a),Yc(w,m),t.appendNode(m,g)}}function YV(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),f=i[0]+(n[0]-i[0])/2,u=[f,n[1]],d=[f,i[1]],h={start:n,end:u},g={start:u,end:d},p={start:d,end:i};an(t,e,"1",h.start,h.end,{color:a,width:s,lineWidth:c}),an(t,e,"2",g.start,g.end,{color:a,width:s,lineWidth:c}),an(t,e,"3",p.start,p.end,{color:a,width:s,lineWidth:c})}function ds(t,e,r,n,i){if(n.length<2)return;const{color:o="rgb(0, 255, 0)",width:a=10,fillColor:s="none",fillOpacity:c=0,lineWidth:l,lineDash:f,closePath:u=!1}=i,d=l||a,h="http://www.w3.org/2000/svg",g=Xc(e,"polyline",r),p=t.getSvgNode(g);let v="";for(const m of n)v+=`${m[0].toFixed(1)}, ${m[1].toFixed(1)} `;if(u){const m=n[0];v+=`${m[0]}, ${m[1]}`}const w={points:v,stroke:o,fill:s,"fill-opacity":c,"stroke-width":d,"stroke-dasharray":f};if(p)Ea(w,p),t.setNodeTouched(g);else{const m=document.createElementNS(h,"polyline");Yc(w,m),t.appendNode(m,g)}}function au(t,e,r,n,i){const a=n.length&&n[0].length&&Array.isArray(n[0][0])?n:[n],{color:s="rgb(0, 255, 0)",width:c=10,fillColor:l="none",fillOpacity:f=0,lineWidth:u,lineDash:d,closePath:h=!1}=i,g=u||c,p="http://www.w3.org/2000/svg",v=Xc(e,"path",r),w=t.getSvgNode(v);let m="";for(let x=0,C=a.length;x<C;x++){const S=a[x],T=S.length;if(!(T<2)){for(let _=0;_<T;_++){const E=S[_];m+=`${_?"L":"M"} ${E[0].toFixed(1)}, ${E[1].toFixed(1)} `}h&&(m+="Z ")}}if(!m)return;const y={d:m,stroke:s,fill:l,"fill-opacity":f,"stroke-width":g,"stroke-dasharray":d};if(w)Ea(y,w),t.setNodeTouched(v);else{const x=document.createElementNS(p,"path");Yc(y,x),t.appendNode(x,v)}}function Qf(t,e,r,n,i,o={}){const a=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},o);return Rpe(t,e,r,n,i,a)}function Rpe(t,e,r,n=[""],i,o){const{padding:a,color:s,fontFamily:c,fontSize:l,background:f}=o;let u;const[d,h]=[i[0]+a,i[1]+a],g="http://www.w3.org/2000/svg",p=Xc(e,"text",r),v=t.getSvgNode(p);if(v){const w=v.querySelector("text"),m=Array.from(w.children);for(let C=0;C<m.length;C++){const S=m[C],T=n[C]||"";S.textContent=T}if(n.length>m.length){for(let C=0;C<n.length-m.length;C++){const S=n[C+m.length],T=LD(S);w.appendChild(T)}v.appendChild(w),t.appendNode(v,p)}const y={fill:s,"font-size":l,"font-family":c},x={transform:`translate(${d} ${h})`};Ea(y,w),Ea(x,v),u=AD(v,f),t.setNodeTouched(p)}else{const w=document.createElementNS(g,"g");w.setAttribute("transform",`translate(${d} ${h})`);const m=Ppe(t,o);for(let y=0;y<n.length;y++){const x=n[y],C=LD(x);m.appendChild(C)}w.appendChild(m),t.appendNode(w,p),u=AD(w,f)}return Object.assign({},u,{x:d,y:h,height:u.height+a,width:u.width+a})}function Ppe(t,e){const{color:r,fontFamily:n,fontSize:i}=e,a=document.createElementNS("http://www.w3.org/2000/svg","text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",c=`filter:url(#shadow-${t.svgLayerElement.id});`,l=`${s}${c}`;return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",r),a.setAttribute("font-family",n),a.setAttribute("font-size",i),a.setAttribute("style",l),a}function LD(t){const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttribute("x","0"),r.setAttribute("dy","1.2em"),r.textContent=t,r}function AD(t,e){let r=t.querySelector("rect.background");if(!e)return r&&t.removeChild(r),t.getBBox();r||(r=document.createElementNS("http://www.w3.org/2000/svg","rect"),r.setAttribute("class","background"),t.insertBefore(r,t.firstChild));const n=t.getBBox(),i={x:`${n.x}`,y:`${n.y}`,width:`${n.width}`,height:`${n.height}`,fill:e};return Ea(i,r),n}function Lpe(t,e,r,n,i,o,a={}){const s=n.length>0?$C(n,i):i,c=Ape(o),l=$C(c,s),f=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},a);an(t,e,`link-${r}`,s,l,f)}function Ape(t){const{x:e,y:r,height:n,width:i}=t,o=i/2,a=n/2,s=[e+o,r],c=[e,r+a],l=[e+o,r+n],f=[e+i,r+a];return[s,c,l,f]}function to(t,e,r,n,i,o,a,s={}){const c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),l=Qf(t,e,r,n,i,c);return Lpe(t,e,r,o,i,l,c),l}function N4(t,e,r,n,i={},o=""){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),f=c||s,u="http://www.w3.org/2000/svg",d=Xc(e,"rect",r),h=t.getSvgNode(d),[g,p,v,w]=n,m=Math.hypot(g[0]-p[0],g[1]-p[1]),y=Math.hypot(g[0]-v[0],g[1]-v[1]),x=[(w[0]+g[0])/2,(w[1]+g[1])/2],C=[(v[0]+g[0])/2,(v[1]+g[1])/2],S=Math.atan2(x[1]-C[1],x[0]-C[0])*180/Math.PI,T={x:`${x[0]-m/2}`,y:`${x[1]-y/2}`,width:`${m}`,height:`${y}`,stroke:a,fill:"transparent",transform:`rotate(${S} ${x[0]} ${x[1]})`,"stroke-width":f,"stroke-dasharray":l};if(h)Ea(T,h),t.setNodeTouched(d);else{const _=document.createElementNS(u,"rect");o!==""&&_.setAttribute("data-id",o),Yc(T,_),t.appendNode(_,d)}}function x1(t,e,r,n,i,o={},a=""){const s=[n[0],n[1]],c=[i[0],n[1]],l=[n[0],i[1]],f=[i[0],i[1]];N4(t,e,r,[s,c,l,f],o,a)}function ay(t,e,r,n,i,o={}){if(isNaN(n[0])||isNaN(n[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o);an(t,e,r,n,i,{color:a,width:s,lineWidth:c,lineDash:l});const f=10,u=Math.atan2(i[1]-n[1],i[0]-n[0]),d={start:[i[0]-f*Math.cos(u-Math.PI/7),i[1]-f*Math.sin(u-Math.PI/7)],end:i},h={start:[i[0]-f*Math.cos(u+Math.PI/7),i[1]-f*Math.sin(u+Math.PI/7)],end:i};an(t,e,"2",d.start,d.end,{color:a,width:s,lineWidth:c}),an(t,e,"3",h.start,h.end,{color:a,width:s,lineWidth:c})}function JV(t,e,r,n,i,o={}){const{color:a,width:s,lineWidth:c,lineDash:l}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},o),f=c||s,u="http://www.w3.org/2000/svg",d=Xc(e,"rect",r),h=t.getSvgNode(d),g=[Math.min(n[0],i[0]),Math.min(n[1],i[1])],p=Math.abs(n[0]-i[0]),v=Math.abs(n[1]-i[1]),w={x:`${g[0]}`,y:`${g[1]}`,width:`${p}`,height:`${v}`,stroke:a,fill:"black","stroke-width":f,"stroke-dasharray":l};if(h)Ea(w,h),t.setNodeTouched(d);else{const m=document.createElementNS(u,"rect");Yc(w,m),t.appendNode(m,d)}}const Npe=Object.freeze(Object.defineProperty({__proto__:null,draw:XV,drawArrow:ay,drawCircle:ho,drawEllipse:Mpe,drawEllipseByCoordinates:A4,drawHandle:oy,drawHandles:Kn,drawHeight:YV,drawLine:an,drawLinkedTextBox:to,drawPath:au,drawPolyline:ds,drawRect:x1,drawRectByCoordinates:N4,drawRedactionRect:JV,drawTextBox:Qf,setAttributesIfNecessary:Ea,setNewAttributesIfValid:Yc},Symbol.toStringTag,{value:"Module"}));function ZV(t,e){const r=we(t),{renderingEngineId:n,viewportId:i}=r,o=or(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l];if(f&&e.includes(f.mode)){const u=o.getToolInstance(l);a.push(u)}}return a}const{Active:kpe,Passive:Vpe,Enabled:Fpe}=wn;class Upe{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let r=0;r<e.length;r++){const n=e[r];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),this._needsRender.size===0))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,r){this._viewportElements.set(e,r)}removeViewportElement(e,r){this._viewportElements.delete(e),this._needsRender.delete(r),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach(r=>{this._needsRender.add(r)}),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const r=[...this._viewportElements.values()];e.forEach(n=>{r.indexOf(n)!==-1&&this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const r=we(e);if(!r)return;if(!fr(r.renderingEngineId)){console.warn("rendering Engine has been destroyed");return}const i=ZV(e,[kpe,Vpe,Fpe]),{renderingEngineId:o,viewportId:a}=r,s={element:e,renderingEngineId:o,viewportId:a};XV(e,c=>{let l=!1;const f=u=>{if(u.renderAnnotation){const d=u.renderAnnotation(r,c);l=l||d}};i.forEach(f),l&&Qe(e,U.ANNOTATION_RENDERED,{...s})})}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}const k4=new Upe;function hh(t){k4.renderViewport(t)}function Me(t){t.length&&t.forEach(e=>{const r=An(e);if(!r){console.warn(`Viewport not available for ${e}`);return}const{viewport:n}=r;if(!n){console.warn(`Viewport not available for ${e}`);return}const i=n.element;hh(i)})}function Bpe(t){var e;return((e=t[0])==null?void 0:e.length)===3}function Gpe(t,e){if(!e||e.length===0||e.length===t.length)return t;const r=e[e.length-1]-e[0]+1,n=jw(e.map(o=>t[o][0])),i=jw(e.map(o=>t[o][1]));if(Bpe(t)){const o=jw(e.map(a=>t[a][2]));return g9(Fh(n,r),Fh(i,r),Fh(o,r))}else return g9(Fh(n,r),Fh(i,r))}function Wpe(t,e){const r=[],[n,i]=e,o=i-n+1,a=Math.floor(o/t);let s=0,c=Math.round((o-1)/(a-1)*s)+n;for(;c<=i;)r.push(c),s++,c=Math.round((o-1)/(a-1)*s)+n;return r}function HC(t,e,r,n){const i=r-e+1,o=Math.floor(n/100*i)??1,a=Math.floor(i/o)??1;if(isNaN(i)||!i||!a||i/a<2)return t;const s=Math.max(0,e),c=Math.min(t.length-1,r),l=t.slice(0,s),f=t.slice(c+1,t.length),u=Wpe(a,[s,c]),d=Gpe(t,u);return[...l,...d,...f]}function U5(t,e){var n,i;return e!=null&&e.autoGenerated?!1:((n=t==null?void 0:t.smoothing)==null?void 0:n.smoothOnAdd)===!0||((i=t==null?void 0:t.smoothing)==null?void 0:i.smoothOnEdit)===!0}function zpe(t,e){return _a(t,e)<.001}function $pe(t,e){return _a(t,e)===0}function jpe(t,e){for(let r=0;r<t.length;r++)for(let n=0;n<e.length;n++)if($pe(t[r],e[n]))return[r,n]}function H0(t,e,r){return(t+e+r)%e}function ND(t,e,r,n){const[,i,o]=t,[,a,s]=e,c=o.length,l=s.length;let f=t[0],u=e[0];if(!o[f]||!s[u]||!o[i]||!s[a])return[void 0,void 0];for(;f!==i&&u!==a;){if(r(s[u],o[f]))return[f,u];f=H0(f,c,n),u=H0(u,l,n)}return[void 0,void 0]}function Hpe(t,e){const[r,n]=jpe(t,e)||[],i=(c,l)=>zpe(c,l)===!1,[o,a]=ND([H0(r,t.length,1),r,t],[H0(n,e.length,1),n,e],i,1),[s]=ND([H0(o,t.length,-1),o,t],[H0(a,e.length,-1),a,e],i,-1);return[o,s]}function B5(t,e,r){const{interpolation:n,smoothing:i}=t,o=e;if(n){const{knotsRatioPercentageOnAdd:a,knotsRatioPercentageOnEdit:s,smoothOnAdd:c=!1,smoothOnEdit:l=!1}=i,f=r?s:a;if(r?l:c){const[d,h]=r?Hpe(e,r):[0,e.length-1];return!e[d]||!e[h]?e:HC(e,d,h,f)}}return o}const gh=t=>{if(t.shiftKey)return t.ctrlKey?ii.ShiftCtrl:t.altKey?ii.ShiftAlt:t.metaKey?ii.ShiftMeta:ii.Shift;if(t.ctrlKey)return t.altKey?ii.CtrlAlt:t.metaKey?ii.CtrlMeta:ii.Ctrl;if(t.altKey)return t.metaKey&&ii.AltMeta||ii.Alt;if(t.metaKey)return ii.Meta};function V4(t,e){const r=t[0],n=t[t.length-1],i=Vt();ga(i,n[0]-r[0],n[1]-r[1]),Oc(i,i);const o=Vt(),a=Vt();ga(o,-i[1],i[0]),ga(a,i[1],-i[0]);const s=[(r[0]+n[0])/2,(r[1]+n[1])/2],c={dist:0,index:null};for(let u=0;u<t.length;u++){const d=t[u],h=UT(d,s);h>c.dist&&(c.dist=h,c.index=u)}return[t[c.index],s].map(e.canvasToWorld)}function Kpe(t,e){const{viewport:r}=t,n=e.data.contour.polyline.map(r.worldToCanvas);return V4(n,r)}var vu;(function(t){t[t.CounterClockwise=-1]="CounterClockwise",t[t.Unknown=0]="Unknown",t[t.Clockwise=1]="Clockwise"})(vu||(vu={}));const{addCanvasPointsToArray:F4,pointsAreWithinCloseContourProximity:QV,getFirstLineSegmentIntersectionIndexes:eF,getSubPixelSpacingAndXYDirections:qpe}=Tu;function Xpe(t,e,r){this.isDrawing=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=we(o),{viewport:c}=s,l=gh(t.detail.event)===this.configuration.contourHoleAdditionModifierKey,{spacing:f,xDir:u,yDir:d}=qpe(c,this.configuration.subPixelResolution);this.drawData={canvasPoints:[a],polylineIndex:0,contourHoleProcessingEnabled:l,newAnnotation:!0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},ze.isInteractingWithTool=!0,o.addEventListener(U.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(U.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(U.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(U.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(U.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(U.TOUCH_TAP,this.mouseUpDrawCallback),Tt(o)}function Ype(t){ze.isInteractingWithTool=!1,t.removeEventListener(U.MOUSE_UP,this.mouseUpDrawCallback),t.removeEventListener(U.MOUSE_DRAG,this.mouseDragDrawCallback),t.removeEventListener(U.MOUSE_CLICK,this.mouseUpDrawCallback),t.removeEventListener(U.TOUCH_END,this.mouseUpDrawCallback),t.removeEventListener(U.TOUCH_DRAG,this.mouseDragDrawCallback),t.removeEventListener(U.TOUCH_TAP,this.mouseUpDrawCallback),Ut(t)}function Jpe(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=we(n),{viewport:s}=a,{annotation:c,viewportIdsToRender:l,xDir:f,yDir:u,spacing:d,movingTextBox:h}=this.commonData,{polylineIndex:g,canvasPoints:p,newAnnotation:v}=this.drawData;this.createMemo(n,c,{newAnnotation:v});const w=p[p.length-1],m=s.canvasToWorld(w),y=Ae();yn(y,i,m);const x=Math.abs(gt(y,f)),C=Math.abs(gt(y,u));if(!(x<=d[0]&&C<=d[1])){if(h){this.isDrawing=!1;const{deltaPoints:S}=e,T=S.world,{textBox:_}=c.data.handles,{worldPosition:E}=_;E[0]+=T[0],E[1]+=T[1],E[2]+=T[2],_.hasMoved=!0}else{const S=this.findCrossingIndexDuringCreate(t);if(S!==void 0)this.applyCreateOnCross(t,S);else{const T=F4(n,p,o,this.commonData);this.drawData.polylineIndex=g+T}}Me(l)}}function Zpe(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1],a=t.detail,{element:s}=a;this.doneEditMemo(),this.drawData.newAnnotation=!1,e&&!QV(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(s,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(s,{contourHoleProcessingEnabled:n})}function Qpe(t,e){this.removeCrossedLinesOnCompleteDraw();const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n,minPointsToSave:i}=e??{};if(i&&r.length<i||this.haltDrawing(t,r))return!1;const{annotation:o,viewportIdsToRender:a}=this.commonData,s=we(t),{viewport:c,renderingEngine:l}=s;F4(t,r,r[0],this.commonData),r.pop();const f=U5(this.configuration,o)?B5(this.configuration,r):r;this.updateContourPolyline(o,{points:f,closed:!0,targetWindingDirection:vu.Clockwise},c);const{textBox:u}=o.data.handles;return u!=null&&u.hasMoved||l4(o,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(a),this.deactivateDraw(t),!0}function e1e(){const{canvasPoints:t}=this.drawData,e=t.length,r=[t[0],t[e-1]],n=t.slice(0,-1).slice(1),i=eF(n,r[0],r[1],!1);if(i){const o=i[1];o===1?this.drawData.canvasPoints=t.splice(1):this.drawData.canvasPoints=t.splice(0,o)}}function t1e(t,e){const{canvasPoints:r}=this.drawData,{contourHoleProcessingEnabled:n}=e??{};if(this.haltDrawing(t,r))return!1;const{annotation:i,viewportIdsToRender:o}=this.commonData,a=we(t),{viewport:s,renderingEngine:c}=a,l=U5(this.configuration,i)?B5(this.configuration,r):r;this.updateContourPolyline(i,{points:l,closed:!1},s);const{textBox:f}=i.data.handles,u=i.data.contour.polyline;return i.data.handles.points=[u[0],u[u.length-1]],i.data.isOpenUShapeContour&&(i.data.openUShapeContourVectorToPeak=V4(r,s)),f.hasMoved||l4(i,n),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(o),this.deactivateDraw(t),!0}function n1e(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{canvasPoints:a}=this.drawData,s=a.slice(0,-1),c=eF(s,i,o,!1);return c===void 0?void 0:c[0]}function r1e(t,e){const r=t.detail,{element:n}=r,{canvasPoints:i,contourHoleProcessingEnabled:o}=this.drawData,{annotation:a,viewportIdsToRender:s}=this.commonData;F4(n,i,i[e],this.commonData),i.pop();const c=i.slice(e),l=y1(c);if(At(l,0)){i.splice(e+1);return}i.splice(0,e);const f={contourHoleProcessingEnabled:o,minPointsToSave:3};this.completeDrawClosedContour(n,f)&&this.activateClosedContourEdit(t,a,s)}function i1e(t){const{allowOpenContours:e}=this.configuration,{canvasPoints:r,contourHoleProcessingEnabled:n}=this.drawData,i=r[0],o=r[r.length-1];e&&!QV(i,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(t,{contourHoleProcessingEnabled:n}):this.completeDrawClosedContour(t,{contourHoleProcessingEnabled:n})}function o1e(t,e){const r=Math.max(e*3,3);return t.length<r}function a1e(t,e){const{subPixelResolution:r}=this.configuration;if(o1e(e,r)){const{annotation:n,viewportIdsToRender:i}=this.commonData;return we(t),hn(n.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,Me(i),this.deactivateDraw(t),!0}return!1}function s1e(t){t.activateDraw=Xpe.bind(t),t.deactivateDraw=Ype.bind(t),t.applyCreateOnCross=r1e.bind(t),t.findCrossingIndexDuringCreate=n1e.bind(t),t.completeDrawOpenContour=t1e.bind(t),t.removeCrossedLinesOnCompleteDraw=e1e.bind(t),t.mouseDragDrawCallback=Jpe.bind(t),t.mouseUpDrawCallback=Zpe.bind(t),t.completeDrawClosedContour=Qpe.bind(t),t.cancelDrawing=i1e.bind(t),t.haltDrawing=a1e.bind(t)}const{addCanvasPointsToArray:c1e,getFirstLineSegmentIntersectionIndexes:e0}=Tu;function l1e(t,e){const r=t.detail,{element:n,currentPoints:i,lastPoints:o}=r,a=i.canvas,s=o.canvas,{editCanvasPoints:c,prevCanvasPoints:l}=this.editData,f=e0(l,a,s,e);if(f)this.editData.startCrossingIndex=f[0],this.removePointsUpUntilFirstCrossing(e);else if(l.length>=2)if(c.length>this.configuration.checkCanvasEditFallbackProximity){const u=c[0],d=[];for(let p=0;p<l.length;p++){const v=l[p],w=ir(v,u);d.push({distance:w,index:p})}d.sort((p,v)=>p.distance-v.distance);const h=[d[0],d[1]],g=Math.min(h[0].index,h[1].index);this.editData.startCrossingIndex=g}else{const u=Vt();Sr(u,c[1],c[0]),Oc(u,u);const d=6,h=[c[0][0]-u[0]*d,c[0][1]-u[1]*d],g=e0(l,h,c[0],e);if(g){const p=[h];c1e(n,p,c[0],this.commonData),c.unshift(...p),this.removePointsUpUntilFirstCrossing(e),this.editData.editIndex=c.length-1,this.editData.startCrossingIndex=g[0]}}}function u1e(t){const{editCanvasPoints:e,prevCanvasPoints:r}=this.editData;let n=0;for(let i=0;i<e.length-1;i++){const o=[e[i],e[i+1]],a=!!e0(r,o[0],o[1],t);if(n++,a)break}e.splice(0,n),this.editData.editIndex=e.length-1}function f1e(t,e){const r=t.detail,{currentPoints:n,lastPoints:i}=r,o=n.canvas,a=i.canvas,{prevCanvasPoints:s}=this.editData;return!!e0(s,o,a,e)}function d1e(t){const{prevCanvasPoints:e,editCanvasPoints:r}=this.editData;for(let n=r.length-1;n>0;n--){const i=[r[n],r[n-1]],o=!!e0(e,i[0],i[1],t);if(r.pop(),o)break}}function h1e(){const{editCanvasPoints:t,prevCanvasPoints:e,startCrossingIndex:r}=this.editData;if(r===void 0)return;const n=t[t.length-1],i=[];for(let a=0;a<e.length;a++){const s=e[a],c=ir(s,n);i.push({distance:c,index:a})}i.sort((a,s)=>a.distance-s.distance);const o=t.slice(0,-1);for(let a=0;a<i.length;a++){const{index:s}=i[a],c=e[s],l=t[t.length-1];if(!e0(o,c,l,!1))return s}return-1}function g1e(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{editCanvasPoints:a}=this.editData,s=a.slice(0,-2),c=e0(s,i,o,!1);if(!c)return;const l=c[0],f=a.length-l;for(let u=0;u<f;u++)a.pop()}function p1e(t){t.checkForFirstCrossing=l1e.bind(t),t.removePointsUpUntilFirstCrossing=u1e.bind(t),t.checkForSecondCrossing=f1e.bind(t),t.findSnapIndex=h1e.bind(t),t.removePointsAfterSecondCrossing=d1e.bind(t),t.checkAndRemoveCrossesOnEditLine=g1e.bind(t)}function Jc(t,e,r,n){var g,p,v;const{canvasToWorld:i,worldToCanvas:o}=r,{data:a}=t,{targetWindingDirection:s}=e;let{points:c}=e,l=P2(c);(g=n==null?void 0:n.decimate)!=null&&g.enabled&&(c=zV(e.points,(p=n==null?void 0:n.decimate)==null?void 0:p.epsilon));let{closed:f}=e;const u=c.length,d=new Array(u);P2(c);const h=Lk(t);if(f===void 0){let w=!1;if(c.length>3){const m=jc(c[0],c[u-1]);w=At(0,m)}f=w}if((n==null?void 0:n.updateWindingDirection)!==!1){let w=h?h.data.contour.windingDirection*-1:s;w===void 0&&(w=l),w!==l&&c.reverse();const m=(((v=a.handles)==null?void 0:v.points)??[]).map(o);m.length>2&&P2(m)!==w&&a.handles.points.reverse(),l=w}for(let w=0;w<u;w++)d[w]=i(c[w]);a.contour.polyline=d,a.contour.closed=f,a.contour.windingDirection=l,Ak(t)}const{getSubPixelSpacingAndXYDirections:m1e,addCanvasPointsToArray:tF,getArea:kD}=Tu;function v1e(t,e,r){this.isEditingClosed=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=we(o);if(!s)return;const{viewport:c}=s,l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:d}=m1e(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0,annotation:e},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},ze.isInteractingWithTool=!0,o.addEventListener(U.MOUSE_UP,this.mouseUpClosedContourEditCallback),o.addEventListener(U.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(U.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),o.addEventListener(U.TOUCH_END,this.mouseUpClosedContourEditCallback),o.addEventListener(U.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),o.addEventListener(U.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Tt(o)}function y1e(t){ze.isInteractingWithTool=!1,t.removeEventListener(U.MOUSE_UP,this.mouseUpClosedContourEditCallback),t.removeEventListener(U.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(U.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),t.removeEventListener(U.TOUCH_END,this.mouseUpClosedContourEditCallback),t.removeEventListener(U.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),t.removeEventListener(U.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Ut(t)}function w1e(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=we(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:g,annotation:p}=this.editData;this.createMemo(n,p);const v=h[h.length-1],w=s.canvasToWorld(v),m=Ae();yn(m,i,w);const y=Math.abs(gt(m,l)),x=Math.abs(gt(m,f));if(y<=u[0]&&x<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const C=tF(n,h,o,this.commonData),S=d+C;if(this.editData.editIndex=S,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!0),this.editData.snapIndex=this.findSnapIndex(),this.editData.snapIndex===-1){this.finishEditAndStartNewEdit(t);return}this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(t),g!==void 0&&this.checkForSecondCrossing(t,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(t)),Me(c)}function x1e(t){const e=t.detail,{element:r}=e,n=we(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Jc(a,{points:c,closed:!0,targetWindingDirection:vu.Clockwise},i),a.autoGenerated&&(a.autoGenerated=!1),qn(a,r);const f=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[f],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0,annotation:a},Me(s)}function C1e(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];tF(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const f=ir(e[c],s[0]),u=ir(e[c],s[s.length-1]),d=ir(e[l],s[0]),h=ir(e[l],s[s.length-1]),g=[];for(let C=0;C<c;C++){const S=e[C];g.push([S[0],S[1]])}let p=f+h,v=u+d;if(p<v)for(let C=0;C<s.length;C++){const S=s[C];g.push([S[0],S[1]])}else for(let C=s.length-1;C>=0;C--){const S=s[C];g.push([S[0],S[1]])}for(let C=l;C<e.length;C++){const S=e[C];g.push([S[0],S[1]])}const w=[];for(let C=c;C<l;C++){const S=e[C];w.push([S[0],S[1]])}if(p=d+u,v=h+f,p<v)for(let C=0;C<s.length;C++){const S=s[C];w.push([S[0],S[1]])}else for(let C=s.length-1;C>=0;C--){const S=s[C];w.push([S[0],S[1]])}const m=kD(g),y=kD(w);return m>y?g:w}function S1e(t){const e=t.detail,{element:r}=e;this.completeClosedContourEdit(r)}function T1e(t){var s;const e=we(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const c=U5(this.configuration,n)?B5(this.configuration,o,a):o,l=((s=this.configuration)==null?void 0:s.decimate)||{};Jc(n,{points:c,closed:!0,targetWindingDirection:vu.Clockwise},r,{decimate:{enabled:!!l.enabled,epsilon:l.epsilon}}),n.autoGenerated&&(n.autoGenerated=!1),qn(n,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateClosedContourEdit(t)}function _1e(t){this.completeClosedContourEdit(t)}function E1e(t){t.activateClosedContourEdit=v1e.bind(t),t.deactivateClosedContourEdit=y1e.bind(t),t.mouseDragClosedContourEditCallback=w1e.bind(t),t.mouseUpClosedContourEditCallback=S1e.bind(t),t.finishEditAndStartNewEdit=x1e.bind(t),t.fuseEditPointsWithClosedContour=C1e.bind(t),t.cancelClosedContourEdit=_1e.bind(t),t.completeClosedContourEdit=T1e.bind(t)}const{addCanvasPointsToArray:nF,getSubPixelSpacingAndXYDirections:D1e}=Tu;function b1e(t,e,r){this.isEditingOpen=!0;const n=t.detail,{currentPoints:i,element:o}=n,a=i.canvas,s=we(o),{viewport:c}=s;this.doneEditMemo();const l=e.data.contour.polyline.map(c.worldToCanvas),{spacing:f,xDir:u,yDir:d}=D1e(c,this.configuration.subPixelResolution);this.editData={prevCanvasPoints:l,editCanvasPoints:[a],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:e,viewportIdsToRender:r,spacing:f,xDir:u,yDir:d,movingTextBox:!1},ze.isInteractingWithTool=!0,o.addEventListener(U.MOUSE_UP,this.mouseUpOpenContourEditCallback),o.addEventListener(U.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(U.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),o.addEventListener(U.TOUCH_END,this.mouseUpOpenContourEditCallback),o.addEventListener(U.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),o.addEventListener(U.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Tt(o)}function I1e(t){ze.isInteractingWithTool=!1,t.removeEventListener(U.MOUSE_UP,this.mouseUpOpenContourEditCallback),t.removeEventListener(U.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(U.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),t.removeEventListener(U.TOUCH_END,this.mouseUpOpenContourEditCallback),t.removeEventListener(U.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),t.removeEventListener(U.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Ut(t)}function O1e(t){const e=t.detail,{currentPoints:r,element:n}=e,i=r.world,o=r.canvas,a=we(n),{viewport:s}=a,{viewportIdsToRender:c,xDir:l,yDir:f,spacing:u}=this.commonData,{editIndex:d,editCanvasPoints:h,startCrossingIndex:g}=this.editData,p=h[h.length-1],v=s.canvasToWorld(p),w=Ae();this.createMemo(n,this.commonData.annotation),yn(w,i,v);const m=Math.abs(gt(w,l)),y=Math.abs(gt(w,f));if(m<=u[0]&&y<=u[1])return;g!==void 0&&this.checkAndRemoveCrossesOnEditLine(t);const x=nF(n,h,o,this.commonData),C=d+x;this.editData.editIndex=C,g===void 0&&h.length>1&&this.checkForFirstCrossing(t,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(t),g!==void 0&&this.checkForSecondCrossing(t,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(t)):this.checkIfShouldOverwriteAnEnd(t)&&this.openContourEditOverwriteEnd(t),Me(c)}function M1e(t){const e=t.detail,{element:r}=e,n=we(r),{viewport:i}=n,{annotation:o,viewportIdsToRender:a}=this.commonData,s=this.fuseEditPointsForOpenContourEndEdit();Jc(o,{points:s,closed:!1},i);const c=o.data.contour.polyline;o.data.handles.points=[c[0],c[c.length-1]],o.data.handles.activeHandleIndex=1,qn(o,r),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.doneEditMemo(),this.deactivateOpenContourEdit(r),this.activateOpenContourEndEdit(t,o,a,null)}function R1e(t){const e=t.detail,{currentPoints:r,lastPoints:n}=e,i=r.canvas,o=n.canvas,{snapIndex:a,prevCanvasPoints:s,startCrossingIndex:c}=this.editData;if(c===void 0||a===void 0)return!1;if(a===-1)return!0;if(a!==0&&a!==s.length-1)return!1;const l=i,f=o,u=s[a],d=Vt(),h=Vt();ga(d,l[0]-f[0],l[1]-f[1]),ga(h,l[0]-u[0],l[1]-u[1]);const g=FT(d,h),p=Math.sqrt(d[0]*d[0]+d[1]*d[1]),v=Math.sqrt(h[0]*h[0]+h[1]*h[1]);return Math.acos(g/(p*v))<Math.PI/2}function P1e(){const{snapIndex:t,prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n}=this.editData,i=[];if(t===0)for(let s=e.length-1;s>=n;s--){const c=e[s];i.push([c[0],c[1]])}else for(let s=0;s<n;s++){const c=e[s];i.push([c[0],c[1]])}const o=ir(e[n],r[0]),a=ir(e[n],r[r.length-1]);if(o<a)for(let s=0;s<r.length;s++){const c=r[s];i.push([c[0],c[1]])}else for(let s=r.length-1;s>=0;s--){const c=r[s];i.push([c[0],c[1]])}return i}function L1e(t){const{prevCanvasPoints:e,editCanvasPoints:r,startCrossingIndex:n,snapIndex:i}=this.editData;if(n===void 0||i===void 0)return;const o=t.detail,{element:a}=o,s=[...r];nF(a,s,e[i],this.commonData),s.length>r.length&&s.pop();let c,l;n>i?(c=i,l=n):(c=n,l=i);const f=ir(e[c],s[0]),u=ir(e[c],s[s.length-1]),d=ir(e[l],s[0]),h=ir(e[l],s[s.length-1]),g=[];for(let w=0;w<c;w++){const m=e[w];g.push([m[0],m[1]])}const p=f+h,v=u+d;if(p<v)for(let w=0;w<s.length;w++){const m=s[w];g.push([m[0],m[1]])}else for(let w=s.length-1;w>=0;w--){const m=s[w];g.push([m[0],m[1]])}for(let w=l;w<e.length;w++){const m=e[w];g.push([m[0],m[1]])}return g}function A1e(t){const e=t.detail,{element:r}=e,n=we(r),{viewport:i,renderingEngine:o}=n,{annotation:a,viewportIdsToRender:s}=this.commonData,{fusedCanvasPoints:c,editCanvasPoints:l}=this.editData;Jc(a,{points:c,closed:!1},i);const f=a.data.contour.polyline;a.data.handles.points=[f[0],f[f.length-1]],qn(a,r);const u=l.pop();this.editData={prevCanvasPoints:c,editCanvasPoints:[u],startCrossingIndex:void 0,editIndex:0},Me(s)}function N1e(t){const e=t.detail,{element:r}=e;this.completeOpenContourEdit(r)}function k1e(t){var s;const e=we(t),{viewport:r}=e,{annotation:n,viewportIdsToRender:i}=this.commonData;this.doneEditMemo();const{fusedCanvasPoints:o,prevCanvasPoints:a}=this.editData;if(o){const c=U5(this.configuration)?B5(this.configuration,o,a):o,l=((s=this.configuration)==null?void 0:s.decimate)||{};Jc(n,{points:c,closed:!1},r,{decimate:{enabled:!!l.enabled,epsilon:l.epsilon}});const f=n.data.contour.polyline;n.data.handles.points=[f[0],f[f.length-1]],n.data.isOpenUShapeContour&&(n.data.openUShapeContourVectorToPeak=V4(o,r)),qn(n,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,Me(i),this.deactivateOpenContourEdit(t)}function V1e(t){this.completeOpenContourEdit(t)}function F1e(t){t.activateOpenContourEdit=b1e.bind(t),t.deactivateOpenContourEdit=I1e.bind(t),t.mouseDragOpenContourEditCallback=O1e.bind(t),t.mouseUpOpenContourEditCallback=N1e.bind(t),t.fuseEditPointsWithOpenContour=L1e.bind(t),t.finishEditOpenOnSecondCrossing=A1e.bind(t),t.checkIfShouldOverwriteAnEnd=R1e.bind(t),t.fuseEditPointsForOpenContourEndEdit=P1e.bind(t),t.openContourEditOverwriteEnd=M1e.bind(t),t.cancelOpenContourEdit=V1e.bind(t),t.completeOpenContourEdit=k1e.bind(t)}const{getSubPixelSpacingAndXYDirections:U1e}=Tu;function B1e(t,e,r,n){this.isDrawing=!0;const i=t.detail,{element:o}=i,a=we(o),{viewport:s}=a,{spacing:c,xDir:l,yDir:f}=U1e(s,this.configuration.subPixelResolution),u=e.data.contour.polyline.map(s.worldToCanvas);e.data.handles.activeHandleIndex===0&&u.reverse();let h=!1;n!=null&&n.worldPosition&&(h=!0),this.drawData={canvasPoints:u,polylineIndex:u.length-1},this.commonData={annotation:e,viewportIdsToRender:r,spacing:c,xDir:l,yDir:f,movingTextBox:h},ze.isInteractingWithTool=!0,o.addEventListener(U.MOUSE_UP,this.mouseUpDrawCallback),o.addEventListener(U.MOUSE_DRAG,this.mouseDragDrawCallback),o.addEventListener(U.MOUSE_CLICK,this.mouseUpDrawCallback),o.addEventListener(U.TOUCH_END,this.mouseUpDrawCallback),o.addEventListener(U.TOUCH_DRAG,this.mouseDragDrawCallback),o.addEventListener(U.TOUCH_TAP,this.mouseUpDrawCallback),Tt(o)}function G1e(t){t.activateOpenContourEndEdit=B1e.bind(t)}function rF(t){return(t.childAnnotationUIDs??[]).map(r=>xr(r).data.contour.polyline)}function C1(t,e){const r=rF(t),n=[];return r.forEach(i=>{const o=i.length,a=new Array(o);for(let s=0;s<o;s++)a[s]=e.worldToCanvas(i[s]);n.push(a)}),n}const{pointsAreWithinCloseContourProximity:W1e}=Tu;function z1e(t,e){const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:t.viewport.id,annotationUID:e.annotationUID},{lineWidth:n,lineDash:i,color:o,fillColor:a,fillOpacity:s}=this.getAnnotationStyle({annotation:e,styleSpecifier:r}),{closed:c}=e.data.contour;return{color:o,width:n,lineDash:i,fillColor:a,fillOpacity:s,closePath:c}}function $1e(t,e,r){var n;(n=t==null?void 0:t.viewport)!=null&&n.getImageData()&&(r.data.contour.closed?this.renderClosedContour(t,e,r):r.data.isOpenUShapeContour?(j1e(t,r),this.renderOpenUShapedContour(t,e,r)):this.renderOpenContour(t,e,r))}function j1e(t,e){e.data.openUShapeContourVectorToPeak||(e.data.openUShapeContourVectorToPeak=Kpe(t,e))}function H1e(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(l=>n.worldToCanvas(l)),a=C1(r,n),s=[o,...a];au(e,r.annotationUID,"1",s,i)}function K1e(t,e,r){var c;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(l=>n.worldToCanvas(l));ds(e,r.annotationUID,"1",o,i);const s=r.data.handles.activeHandleIndex;if(((c=this.configuration.alwaysRenderOpenContourHandles)==null?void 0:c.enabled)===!0){const l=this.configuration.alwaysRenderOpenContourHandles.radius,f="0",u=[o[0],o[o.length-1]];s===0?u.shift():s===1&&u.pop(),Kn(e,r.annotationUID,f,u,{color:i.color,handleRadius:l})}if(s!==null){const l="1",f=s===0?0:o.length-1,u=o[f];Kn(e,r.annotationUID,l,[u],{color:i.color})}}function q1e(t,e,r){const{viewport:n}=t,{openUShapeContourVectorToPeak:i}=r.data,{polyline:o}=r.data.contour;if(this.renderOpenContour(t,e,r),!i)return;const a=n.worldToCanvas(o[0]),s=n.worldToCanvas(o[o.length-1]),c=[n.worldToCanvas(i[0]),n.worldToCanvas(i[1])],l=this._getRenderingOptions(t,r);ds(e,r.annotationUID,"first-to-last",[a,s],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"}),ds(e,r.annotationUID,"midpoint-to-open-contour",[c[0],c[1]],{color:l.color,width:l.width,closePath:!1,lineDash:"2,2"})}function X1e(t,e,r){const n=this._getRenderingOptions(t,r),{allowOpenContours:i}=this.configuration,{canvasPoints:o}=this.drawData;if(n.closePath=!1,ds(e,r.annotationUID,"1",o,n),i){const a=o[0],s=o[o.length-1];W1e(a,s,this.configuration.closeContourProximity)?ds(e,r.annotationUID,"2",[s,a],n):Kn(e,r.annotationUID,"0",[a],{color:n.color,handleRadius:2})}}function Y1e(t,e,r){const{viewport:n}=t,{fusedCanvasPoints:i}=this.editData;if(i===void 0){this.renderClosedContour(t,e,r);return}const o=C1(r,n),a=[i,...o],s=this._getRenderingOptions(t,r),c="preview-1";r.parentAnnotationUID&&s.fillOpacity&&(s.fillOpacity=0),au(e,r.annotationUID,c,a,s)}function J1e(t,e,r){const{fusedCanvasPoints:n}=this.editData;if(n===void 0){this.renderOpenContour(t,e,r);return}const i=this._getRenderingOptions(t,r);ds(e,r.annotationUID,"preview-1",n,i)}function Z1e(t,e,r){if(r.parentAnnotationUID)return;const{viewport:n}=t,i=this._getRenderingOptions(t,r),o=r.data.contour.polyline.map(g=>n.worldToCanvas(g)),a=C1(r,n),s="1",c=o[0],l=6,f=100,u=[];for(let g=0;g<f;g++){const p=g/f*2*Math.PI,v=c[0]+l*Math.cos(p),w=c[1]+l*Math.sin(p);u.push([v,w])}const d=[[c[0]-l*2,c[1]],[c[0]+l*2,c[1]],[c[0],c[1]-l*2],[c[0],c[1]+l*2]];au(e,r.annotationUID,s+"-crosshair_v",[d[0],d[1]],i),au(e,r.annotationUID,s+"-crosshair_h",[d[2],d[3]],i);const h=[u,...a];au(e,r.annotationUID,s,h,i)}function Q1e(t){t.renderContour=$1e.bind(t),t.renderClosedContour=H1e.bind(t),t.renderOpenContour=K1e.bind(t),t.renderPointContourWithMarker=Z1e.bind(t),t.renderOpenUShapedContour=q1e.bind(t),t.renderContourBeingDrawn=X1e.bind(t),t.renderClosedContourBeingEdited=Y1e.bind(t),t.renderOpenContourBeingEdited=J1e.bind(t),t._getRenderingOptions=z1e.bind(t)}function Jo(t){const e=eme(t),r=(e.top[1]+e.bottom[1])/2;return[e.right[0],r]}function eme(t){const e=[t[0],t[1]].sort(a),r=[t[0],t[1]].sort(s),n=e[e.length-1],i=r[0],o=r[r.length-1];return{top:i,bottom:o,right:n};function a(c,l){return c[0]<l[0]?-1:1}function s(c,l){return c[1]<l[1]?-1:1}}const tme=Object.freeze(Object.defineProperty({__proto__:null,getTextBoxCoordsCanvas:Jo},Symbol.toStringTag,{value:"Module"}));function ec(t,e){if(t instanceof Xn){const r=Zs(e),n=ke.getVolume(r);return!!(n!=null&&n.scaling)&&Object.keys(n.scaling).length>0}else if(t instanceof Jn){const{preScale:r}=t.getImageData()||{};return!!(r!=null&&r.scaled)}else return!1}function KC(t,e){let r=0;for(let n=0;n<t.length-1;n++){const i=t[n],o=t[n+1];r+=Math.sqrt(Math.pow(o[0]-i[0],2)+Math.pow(o[1]-i[1],2))}if(e){const n=t[0],i=t[t.length-1];r+=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2))}return r}const{DefaultHistoryMemo:Rm}=A_,Wg=class Wg{constructor(e,r){const n=Wg.mergeDefaultProps(Wg.defaults,r),i=ci(n,e),{configuration:o={},supportedInteractionTypes:a,toolGroupId:s}=i;this.toolGroupId=s,this.supportedInteractionTypes=a||[],this.configuration=Object.assign({},o),this.mode=wn.Disabled}static mergeDefaultProps(e={},r){return r?ci(e,r):e}get toolName(){return this.getToolName()}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,r){var o;const{strategies:n,activeStrategy:i}=this.configuration;return(o=n[i])==null?void 0:o.call(this,e,r)}applyActiveStrategyCallback(e,r,n,...i){var s;const{strategies:o,activeStrategy:a}=this.configuration;if(!o[a])throw new Error(`applyActiveStrategyCallback: active strategy ${a} not found, check tool configuration or spellings`);return(s=o[a][n])==null?void 0:s.call(this,e,r,...i)}setConfiguration(e){this.configuration=ci(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const r=e.split("imageId:")[1],n=wr(r);let i=Bv(n);return!i||!i.length||(i=i.filter(o=>o.getCurrentImageId()===r),!i||!i.length)?void 0:i[0].getImageData()}else if(e.startsWith("volumeId:")){const r=Zs(e),n=a1(r);return!n||!n.length?void 0:n[0].getImageData()}else if(e.startsWith("videoId:")){const r=wr(e),n=Bv(r);return!n||!n.length?void 0:n[0].getImageData()}else throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){var n;const r=(n=e.getViewReferenceId)==null?void 0:n.call(e);if(r)return r;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}undo(){this.doneEditMemo(),Rm.undo()}redo(){Rm.redo()}static createZoomPanMemo(e){const r={pan:e.getPan(),zoom:e.getZoom()},n={restoreMemo:()=>{const i=e.getPan(),o=e.getZoom();e.setZoom(r.zoom),e.setPan(r.pan),e.render(),r.pan=i,r.zoom=o}};return Rm.push(n),n}doneEditMemo(){var e,r;(r=(e=this.memo)==null?void 0:e.commitMemo)!=null&&r.call(e)&&Rm.push(this.memo),this.memo=null}};Wg.defaults={configuration:{strategies:{},defaultStrategy:void 0,activeStrategy:void 0,strategyOptions:{}}};let $r=Wg;$r.toolName="BaseTool";const su=new Set;function iF(t,e=!0){const r=aF();t&&(e?ome(t,su,r):sF(t,su,r)),cF(r,su)}function nme(){const t=aF();ame(su,t),cF(t,su)}function rme(){return Array.from(su)}function jr(t){return su.has(t)}function ime(){return su.size}function oF(t){const e=jr(t);return iF(t,e),e}function aF(){return Object.freeze({added:[],removed:[],locked:[]})}function ome(t,e,r){if(!e.has(t)){e.add(t),r.added.push(t);const n=xr(t);n&&(n.isLocked=!0)}}function sF(t,e,r){if(e.delete(t)){r.removed.push(t);const n=xr(t);n&&(n.isLocked=!1)}}function ame(t,e){t.forEach(r=>{sF(r,t,e)})}function cF(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>void t.locked.push(r)),Qe(We,U.ANNOTATION_LOCK_CHANGE,t))}const sme=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationLocked:oF,getAnnotationsLocked:rme,getAnnotationsLockedCount:ime,isAnnotationLocked:jr,setAnnotationLocked:iF,unlockAllAnnotations:nme},Symbol.toStringTag,{value:"Module"})),ks=new Set;function xa(t,e=!0,r=!1){e?cme(t,r):U4(t)}function cme(t,e=!1){const r=uF();if(!e){fF(ks,r);const n=xr(t);n&&(n.isSelected=!0)}if(t&&!ks.has(t)){ks.add(t),r.added.push(t);const n=xr(t);n&&(n.isSelected=!0)}dF(r,ks)}function U4(t){const e=uF();if(t){if(ks.delete(t)){e.removed.push(t);const r=xr(t);r.isSelected=!1}}else fF(ks,e);dF(e,ks)}function lF(){return Array.from(ks)}function lme(t){return lF().filter(e=>{var n;const r=xr(e);return((n=r==null?void 0:r.metadata)==null?void 0:n.toolName)===t})}function S1(t){return ks.has(t)}function ume(){return ks.size}function uF(){return Object.freeze({added:[],removed:[],selection:[]})}function fF(t,e){t.forEach(r=>{if(t.delete(r)){e.removed.push(r);const n=xr(r);n&&(n.isSelected=!1)}})}function dF(t,e){(t.added.length>0||t.removed.length>0)&&(e.forEach(r=>void t.selection.push(r)),Qe(We,U.ANNOTATION_SELECTION_CHANGE,t))}const fme=Object.freeze(Object.defineProperty({__proto__:null,deselectAnnotation:U4,getAnnotationsSelected:lF,getAnnotationsSelectedByToolName:lme,getAnnotationsSelectedCount:ume,isAnnotationSelected:S1,setAnnotationSelected:xa},Symbol.toStringTag,{value:"Module"}));function hF(t){if(t){if(t.data&&t.highlighted)return Dc.Highlighted;if(S1(t.annotationUID))return Dc.Selected;if(jr(t.annotationUID))return Dc.Locked;if(t.data&&t.autoGenerated)return Dc.AutoGenerated}return Dc.Default}function dme(t,e,r){const n=Ud("textBoxFontSize",t,e,r),i=Ud("textBoxFontFamily",t,e,r);return`${n}px ${i}`}const hme=Object.freeze(Object.defineProperty({__proto__:null,getFont:dme,getState:hF,style:a4},Symbol.toStringTag,{value:"Module"}));class _u extends $r{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:r,imageId:n}=e.detail,i=wr(n),o=ps();o.getFramesOfReference().forEach(s=>{const l=o.getAnnotations(s)[this.getToolName()];!l||!l.length||(l.forEach(f=>{var d;if(!((d=f.metadata)!=null&&d.referencedImageId))return;wr(f.metadata.referencedImageId)===i&&(f.invalidated=!0,f.data.cachedStats={})}),hh(r))})}}filterInteractableAnnotationsForElement(e,r){if(!(r!=null&&r.length))return[];const n=we(e),{viewport:i}=n;return w1(i,r)}createAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n,a=we(i),{viewport:s}=a,c=s.getCamera(),{viewPlaneNormal:l,viewUp:f,position:u}=c,d=this.getReferencedImageId(s,o,l,f),h=s.getViewReference({points:[o]});return{highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),...h,referencedImageId:d,viewUp:f,cameraPosition:u},data:{cachedStats:{},handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}}}getReferencedImageId(e,r,n,i){const o=this.getTargetId(e);let a=o.split(/^[a-zA-Z]+:/)[1];if(e instanceof Xn){const s=Zs(o),c=ke.getVolume(s);a=$c(c,r,n)}return a}getStyle(e,r,n){return Ud(e,r,hF(n),this.mode)}}_u.toolName="AnnotationDisplayTool";const t0=new Set;function gF(t,e=!0){const r=pF();t&&(e?mF(t,t0,r):pme(t,t0,r)),vF(r)}function gme(){const t=pF();t0.forEach(e=>{mF(e,t0,t)}),vF(t)}function ti(t){if(xr(t))return!t0.has(t)}function pF(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function mF(t,e,r){if(e.delete(t)){r.lastVisible.push(t);const n=xr(t);n.isVisible=!0}}function pme(t,e,r){e.has(t)||(e.add(t),S1(t)&&U4(t),r.lastHidden.push(t))}function vF(t){(t.lastHidden.length>0||t.lastVisible.length>0)&&(t0.forEach(e=>void t.hidden.push(e)),Qe(We,U.ANNOTATION_VISIBILITY_CHANGE,t))}function yF(t){const e=!t0.has(t);return gF(t,e),e}const mme=Object.freeze(Object.defineProperty({__proto__:null,checkAndSetAnnotationVisibility:yF,isAnnotationVisible:ti,setAnnotationVisibility:gF,showAllAnnotations:gme},Symbol.toStringTag,{value:"Module"})),{DefaultHistoryMemo:vme}=A_,{PointsManager:yme}=cn;class zn extends _u{static createAnnotation(...e){let r={annotationUID:null,highlighted:!0,invalidated:!0,metadata:{toolName:this.toolName},data:{text:"",handles:{points:new Array,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};for(const n of e)r=ci(r,n);return r}static createAnnotationForViewport(e,...r){return this.createAnnotation({metadata:e.getViewReference()},...r)}static createAndAddAnnotation(e,...r){const n=this.createAnnotationForViewport(e,...r);Zt(n,e.element),qn(n,e.element)}constructor(e,r){var n,i;super(e,r),this.mouseMoveCallback=(o,a)=>{if(!a)return!1;const{element:s,currentPoints:c}=o.detail,l=c.canvas;let f=!1;for(const u of a){if(jr(u.annotationUID)||!ti(u.annotationUID))continue;const{data:d}=u,h=d.handles?d.handles.activeHandleIndex:void 0,g=this._imagePointNearToolOrHandle(s,u,l,6),p=g&&!u.highlighted,v=!g&&u.highlighted;p||v?(u.highlighted=!u.highlighted,f=!0):d.handles&&d.handles.activeHandleIndex!==h&&(f=!0)}return f},this.isSuvScaled=zn.isSuvScaled,(n=e.configuration)!=null&&n.getTextLines&&(this.configuration.getTextLines=e.configuration.getTextLines),(i=e.configuration)!=null&&i.statsCalculator&&(this.configuration.statsCalculator=e.configuration.statsCalculator)}getHandleNearImagePoint(e,r,n,i){const o=we(e),{viewport:a}=o,{data:s}=r,{isCanvasAnnotation:c}=s,{points:l,textBox:f}=s.handles;if(f){const{worldBoundingBox:u}=f;if(u){const d={topLeft:a.worldToCanvas(u.topLeft),topRight:a.worldToCanvas(u.topRight),bottomLeft:a.worldToCanvas(u.bottomLeft),bottomRight:a.worldToCanvas(u.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottomRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottomRight[1])return s.handles.activeHandleIndex=null,f}}for(let u=0;u<(l==null?void 0:l.length);u++){const d=l[u],h=c?d.slice(0,2):a.worldToCanvas(d);if(ir(n,h)<i===!0)return s.handles.activeHandleIndex=u,d}s.handles.activeHandleIndex=null}getLinkedTextBoxStyle(e,r){return{visibility:this.getStyle("textBoxVisibility",e,r),fontFamily:this.getStyle("textBoxFontFamily",e,r),fontSize:this.getStyle("textBoxFontSize",e,r),color:this.getStyle("textBoxColor",e,r),shadow:this.getStyle("textBoxShadow",e,r),background:this.getStyle("textBoxBackground",e,r),lineWidth:this.getStyle("textBoxLinkLineWidth",e,r),lineDash:this.getStyle("textBoxLinkLineDash",e,r)}}static isSuvScaled(e,r,n){var o;if(e instanceof Xn){const a=Zs(r),s=ke.getVolume(a);return((o=s==null?void 0:s.scaling)==null?void 0:o.PT)!==void 0}const i=n&&dt("scalingModule",n);return typeof(i==null?void 0:i.suvbw)=="number"}getAnnotationStyle(e){const{annotation:r,styleSpecifier:n}=e,i=h=>this.getStyle(h,n,r),{annotationUID:o}=r,a=ti(o),s=jr(o),c=i("lineWidth"),l=i("lineDash"),f=i("color"),u=i("shadow"),d=this.getLinkedTextBoxStyle(n,r);return{visibility:a,locked:s,color:f,lineWidth:c,lineDash:l,lineOpacity:1,fillColor:f,fillOpacity:0,shadow:u,textbox:d}}_imagePointNearToolOrHandle(e,r,n,i){if(this.getHandleNearImagePoint(e,r,n,i)||this.isPointNearTool(e,r,n,i,"mouse"))return!0}static createAnnotationState(e,r){const{data:n,annotationUID:i}=e,o={...n,cachedStats:{}};delete o.contour,delete o.spline;const a={annotationUID:i,data:structuredClone(o),deleting:r},s=n.contour;return s&&(a.data.contour={...s,polyline:null,pointsManager:yme.create3(s.polyline.length,s.polyline)}),a}static createAnnotationMemo(e,r,n){if(!r)return;const{newAnnotation:i,deleting:o=i?!1:void 0}=n||{},{annotationUID:a}=r,s=zn.createAnnotationState(r,o),c={restoreMemo:()=>{const l=zn.createAnnotationState(r,o),{viewport:f}=we(e)||{};if(f==null||f.setViewReference(r.metadata),s.deleting===!0){if(s.deleting=!1,Object.assign(r.data,s.data),r.data.contour){const d=r.data;d.contour.polyline=s.data.contour.pointsManager.points,delete s.data.contour.pointsManager,d.segmentation&&Jf(r)}s.data=l.data,Zt(r,e),xa(r.annotationUID,!0),f==null||f.render();return}if(s.deleting===!1){s.deleting=!0,s.data=l.data,xa(r.annotationUID),hn(r.annotationUID),f==null||f.render();return}const u=xr(a);if(!u){console.warn("No current annotation");return}Object.assign(u.data,s.data),u.data.contour&&(u.data.contour.polyline=s.data.contour.pointsManager.points),s.data=l.data,u.invalidated=!0,qn(u,e,tr.History)}};return vme.push(c),c}createMemo(e,r,n){this.memo||(this.memo=zn.createAnnotationMemo(e,r,n))}}zn.toolName="AnnotationTool";class wme extends zn{constructor(e,r){super(e,r)}renderAnnotation(e,r){let n=!1;const{viewport:i}=e,{element:o}=i;if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let a=sn(this.getToolName(),o);if(!(a!=null&&a.length)||(a=this.filterInteractableAnnotationsForElement(o,a),!(a!=null&&a.length)))return n;const s=this.getTargetId(i),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let l=0;l<a.length;l++){const f=a[l];c.annotationUID=f.annotationUID;const u=this.getAnnotationStyle({annotation:f,styleSpecifier:c});if(!u.visibility)continue;const d=this.renderAnnotationInstance({enabledElement:e,targetId:s,annotation:f,annotationStyle:u,svgDrawingHelper:r});n||(n=d),f.invalidated=!1}return n}createAnnotation(e){const r=super.createAnnotation(e);return Object.assign(r.data,{contour:{polyline:[],closed:!1}}),Object.assign(r,{interpolationUID:"",autoGenerated:!1}),r}addAnnotation(e,r){return Zt(e,r)}cancelAnnotation(e){}moveAnnotation(e,r){const{points:n}=e.data.handles;for(let i=0,o=n.length;i<o;i++){const a=n[i];a[0]+=r[0],a[1]+=r[1],a[2]+=r[2]}e.invalidated=!0,D5(e).forEach(i=>this.moveAnnotation(i,r))}updateContourPolyline(e,r,n,i){var a;const o=((a=this.configuration)==null?void 0:a.decimate)||{};Jc(e,r,n,{decimate:{enabled:!!o.enabled,epsilon:o.epsilon},updateWindingDirection:i==null?void 0:i.updateWindingDirection})}getPolylinePoints(e){var r;return((r=e.data.contour)==null?void 0:r.polyline)??e.data.polyline}renderAnnotationInstance(e){const{enabledElement:r,annotationStyle:n,svgDrawingHelper:i}=e,o=e.annotation;if(o.parentAnnotationUID)return;const{annotationUID:a}=o,{viewport:s}=r,{worldToCanvas:c}=s,l=this.getPolylinePoints(o).map(w=>c(w)),{lineWidth:f,lineDash:u,color:d,fillColor:h,fillOpacity:g}=n,p=C1(o,s),v=[l,...p];return au(i,a,"contourPolyline",v,{color:d,lineDash:u,lineWidth:Math.max(.1,f),fillColor:h,fillOpacity:g}),!0}}class wF{constructor(e){this.getGroupKey=r=>{if(typeof r=="string")return r;const i=we(r);if(!i)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return i.FrameOfReferenceUID},this._imageVolumeModifiedHandler=r=>{const n=r.detail,{FrameOfReferenceUID:i}=n,a=this.annotations[i];a&&Object.keys(a).forEach(s=>{a[s].forEach(l=>{l.invalidated!==void 0&&(l.invalidated=!0)})})},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(r,n)=>{const i=this.annotations;return i[r]?n?i[r][n]?i[r][n]:[]:i[r]:[]},this.getAnnotation=r=>{const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];for(const c of s)if(r===c.annotationUID)return c}}},this.getNumberOfAnnotations=(r,n)=>{const i=this.getAnnotations(r,n);if(!i.length)return 0;if(n)return i.length;let o=0;for(const a in i)o+=i[a].length;return o},this.addAnnotation=(r,n)=>{const{metadata:i}=r,{FrameOfReferenceUID:o,toolName:a}=i;n=n||o;const s=this.annotations;let c=s[n];c||(s[n]={},c=s[n]);let l=c[a];l||(c[a]=[],l=c[a]),this.preprocessingFn&&(r=this.preprocessingFn(r)),l.push(r)},this.removeAnnotation=r=>{const{annotations:n}=this;for(const i in n){const o=n[i];for(const a in o){const s=o[a],c=s.findIndex(l=>l.annotationUID===r);c!==-1&&(s.splice(c,1),s.length===0&&delete o[a])}Object.keys(o).length===0&&delete n[i]}},this.removeAnnotations=(r,n)=>{const i=this.annotations,o=[];if(!i[r])return o;if(n){const a=i[r][n];for(const s of a)this.removeAnnotation(s.annotationUID),o.push(s)}else for(const a in i[r]){const s=i[r][a];for(const c of s)this.removeAnnotation(c.annotationUID),o.push(c)}return o},this.saveAnnotations=(r,n)=>{const i=this.annotations;if(r&&n){const o=i[r];if(!o)return;const a=o[n];return structuredClone(a)}else if(r){const o=i[r];return structuredClone(o)}return structuredClone(i)},this.restoreAnnotations=(r,n,i)=>{const o=this.annotations;if(n&&i){let a=o[n];a||(o[n]={},a=o[n]),a[i]=r}else n?o[n]=r:this.annotations=structuredClone(r)},this.getAllAnnotations=()=>Object.values(this.annotations).map(r=>Object.values(r)).flat(2),this.getNumberOfAllAnnotations=()=>{let r=0;const n=this.annotations;for(const i in n){const o=n[i];for(const a in o){const s=o[a];r+=s.length}}return r},this.removeAllAnnotations=()=>{const r=[];for(const n of this.getAllAnnotations())this.removeAnnotation(n.annotationUID),r.push(n);return r},e||(e=Cn()),this.annotations={},this.uid=e,We.addEventListener($e.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const xme=new wF("DEFAULT");class Cme{constructor(){this.annotationUIDs=new Set,this._isVisible=!0,this.visibleFilter=this.unboundVisibleFilter.bind(this)}unboundVisibleFilter(e){return!this._isVisible||!this.annotationUIDs.has(e)}has(e){return this.annotationUIDs.has(e)}setVisible(e=!0,r,n){this._isVisible!==e&&(this._isVisible=e,this.annotationUIDs.forEach(i=>{const o=xr(i);if(!o){this.annotationUIDs.delete(i);return}if(o.isVisible===e||!e&&(n==null?void 0:n(i))===!1)return;o.isVisible=e;const a={...r,annotation:o};Qe(We,U.ANNOTATION_MODIFIED,a)}))}get isVisible(){return this._isVisible}findNearby(e,r){const n=[...this.annotationUIDs];if(n.length===0)return null;if(!e)return n[r===1?0:n.length-1];const i=n.indexOf(e);return i===-1||i+r<0||i+r>=n.length?null:n[i+r]}add(...e){e.forEach(r=>this.annotationUIDs.add(r))}remove(...e){e.forEach(r=>this.annotationUIDs.delete(r))}clear(){this.annotationUIDs.clear()}}const Sme=t=>(t.data||(t.data={}),t.data.handles||(t.data.handles={}),t.data.handles.textBox||(t.data.handles.textBox={}),t),Tme=t=>(t.data||(t.data={}),t.data.cachedStats||(t.data.cachedStats={}),t),B4=xme,_me=t=>{t=Sme(t),t=Tme(t);const e=t.annotationUID,r=oF(e);t.isLocked=r;const n=yF(e);return t.isVisible=n,t};B4.setPreprocessingFn(_me);u4(B4);function Eme(){u4(B4)}const as={...rhe,resetAnnotationManager:Eme},Dme=Object.freeze(Object.defineProperty({__proto__:null,AnnotationGroup:Cme,FrameOfReferenceSpecificAnnotationManager:wF,config:hme,locking:sme,selection:fme,state:as,visibility:mme},Symbol.toStringTag,{value:"Module"})),VD="PlanarFreehandContourSegmentationTool";function G4(t,e=[]){const{viewport:r,sliceData:n,annotation:i}=t,o=new Map,{toolName:a,originalToolName:s}=i.metadata,c=s||a,l=(sn(c,r.element)||[]).filter(f=>!f.metadata.originalToolName||f.metadata.originalToolName===c);if(c!==VD){const f=sn(VD,r.element);f!=null&&f.length&&f.forEach(u=>{const{metadata:d}=u;d.originalToolName===c&&d.originalToolName!==d.toolName&&l.push(u)})}if(!(l!=null&&l.length))return o;for(let f=0;f<n.numberOfSlices;f++){const u=l.filter(h=>h.metadata.sliceIndex===f);if(!(u!=null&&u.length))continue;const d=u.filter(h=>e.every(g=>{const p=g.parentKey?g.parentKey(h):h,v=p==null?void 0:p[g.key];return Array.isArray(v)?v.every((w,m)=>w===g.value[m]):v===g.value}));d.length&&o.set(f,d)}return o}function bme(t,e){const r=G4(t,e),n=[];if(!(r!=null&&r.size))return n;for(const i of r.values())i.forEach(o=>{n.push(o)});return n}function xF(t,e,r){const n=ci({data:{},metadata:{}},r);return Object.assign(n,{highlighted:!1,invalidated:!0,autoGenerated:!0,annotationUID:void 0,cachedStats:{},childAnnotationUIDs:[],parentAnnotationUID:void 0}),Object.assign(n.data,{handles:{points:e.points||e||[],interpolationSources:e.sources,activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},contour:{...r.data.contour,polyline:t}}),n}function Ime(t,e){const r=G4(e,[{key:"interpolationUID",value:e.interpolationUID}]),n=Ome(r);if(!n){console.warn("No annotations found to interpolate",r);return}const i=Mme(r,t.annotationUID),o=[];for(let a=n[0]+1;a<n[1];a++)if(Rme(r,a)){const s=Lme(a,n,r);((s==null?void 0:s[0])===i||(s==null?void 0:s[1])===i)&&Pme(s,o,a)}return{interpolationData:r,interpolationList:o}}function Ome(t){let e=1/0,r=-1/0,n=!1;for(const[i,o]of t.entries())o.length&&(e=Math.min(i,e),r=Math.max(i,r),n=!0);if(n)return[e,r]}function Mme(t,e){for(const[r,n]of t)for(let i=0;i<n.length;i++)if(n[i].annotationUID===e)return r}function Rme(t,e){const r=t.get(e);return!(r!=null&&r.length)||r.length===1&&r[0].autoGenerated}function Pme(t,e,r){const[n]=t;e[n]||(e[n]={pair:t,list:[]}),e[n].list.push(r)}function Lme(t,e,r){const n=[];let i=!0;for(let o=t-1;o>=e[0];o--){const a=r.get(o);if(a!=null&&a.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||!n.length)){for(let o=t+1;o<=e[1];o++){const a=r.get(o);if(a!=null&&a.length){if(a[0].autoGenerated)continue;a.length>1&&(i=!1),n.push(o);break}}if(!(!i||n.length<2))return n}}const{PointsManager:FD}=cn;function Ame(t,e=12){const r=FD.create3(e);r.sources=[];const{sources:n}=r,{length:i,sources:o=[]}=t,a=5;if(i<a*3)return t.subselect(e);const s=Math.floor(Math.max(2*i/e,a*2));o.forEach(()=>n.push(FD.create3(e)));const c=Nme(t,a),l=kme(c,e),f=[];if((l==null?void 0:l.length)>2){let u=-1;const d=s/3;l.forEach(p=>{const[v,,w]=p,m=Math.ceil((v+w)/2);w-u<d||(m-v>2*d?(E0(f,u,v,s,i),u=E0(f,v,m,s,i)):u=E0(f,u,m,s,i),w-u>d&&(u=E0(f,u,w,s,i)))});const h=f[0];qC(h+i-u,i)>2*d&&E0(f,u,h-d,s,i)}else{const u=Math.floor(i/e);E0(f,-1,i-u,u,i)}return f.forEach(u=>{const d=t.getPointArray(u);r.push(d),o.forEach((h,g)=>n[g].push(h.getPoint(u)))}),r}function Nme(t,e=6){const{length:r}=t,n=Ae(),i=Ae(),o=new Float32Array(r);for(let a=0;a<r;a++){const s=t.getPoint(a),c=t.getPoint(a-e),l=t.getPoint((a+e)%r);bn(n,s,c),bn(i,l,s);const f=gt(n,i)/(Md(n)*Md(i));o[a]=f}return o}function kme(t,e){const{max:r,deviation:n}=Vme(t),{length:i}=t;if(n<.01||i<e*3)return[];const o=[];let a=null,s,c=0;for(let l=0;l<i;l++){const f=t[l];f<r-n?a?(a[2]=l,f<s&&(s=f,c=l),a[1]=c):(s=f,c=l,a=[l,l,l]):a&&(o.push(a),a=null)}return a&&(o[0][0]===0?o[0][0]=a[0]:(a[1]=c,a[2]=i-1,o.push(a))),o}function E0(t,e,r,n,i){r<e&&(r+=i);const o=r-e,a=Math.ceil(o/n);if(a<=0)return t[t.length-1]!==r&&t.push(qC(r,i)),r;for(let s=1;s<=a;s++){const c=qC(e+s*o/a,i);t.push(c)}return t[t.length-1]}function qC(t,e){return(Math.round(t)+e)%e}function Vme(t){const{length:e}=t;let r=0,n=1/0,i=-1/0,o=0;for(let s=0;s<e;s++){const c=t[s];r+=c,n=Math.min(n,c),i=Math.max(i,c)}const a=r/e;for(let s=0;s<e;s++){const c=t[s]-a;o+=c*c}return{mean:a,max:i,min:n,sumSq:o,deviation:Math.sqrt(o/e)}}function Fme(t){const{parentAnnotationUID:e,annotationUID:r}=t;if(!e)return t.interpolationUID;const n=as.getAnnotation(e),{interpolationUID:i}=n,o=n.childAnnotationUIDs.indexOf(r);return t.interpolationUID=`${i}-${o}`,t.interpolationUID}const{isEqual:UD}=cn;function CF(t){const{metadata:e}=t;return HA().filter(r=>{if(r.FrameOfReferenceUID===e.FrameOfReferenceUID){const n=r.viewport,{viewPlaneNormal:i,viewUp:o}=n.getCamera();return UD(i,e.viewPlaneNormal)&&(!e.viewUp||UD(o,e.viewUp))}}).map(r=>r.viewport)}const Lg="PlanarFreehandContourSegmentationTool";async function Ume(t){const e=t.detail.annotation;if(!m1(e))return;const r=Bme(e),n=Gme(r,e);if(!n.length)return;const i=G5(e.data.contour.polyline,r),o=Wme(r,i,n);if(!o)return;const{targetAnnotation:a,targetPolyline:s,isContourHole:c}=o;if(c){const{contourHoleProcessingEnabled:l=!1}=t.detail;if(!l)return;TF(r,a,e)}else $me(r,a,s,e,i)}function SF(t,e=!1){const r="PlanarFreehandContourSegmentationTool",n=or(t.id,t.renderingEngineId);let i;return n.hasTool(r)?n.getToolOptions(r)||(i=`Tool ${r} must be in active/passive state`):i=`Tool ${r} not added to ${n.id} toolGroup`,i&&!e&&console.warn(i),!i}function Bme(t){const e=CF(t);return e.find(n=>SF(n,!0))??e[0]}function G5(t,e){const r=t.length,n=new Array(r);for(let i=0;i<r;i++)n[i]=e.worldToCanvas(t[i]);return n}function Gme(t,e){const{annotationUID:r}=e;return E5().filter(i=>i.annotationUID&&i.annotationUID!==r&&m1(i)&&IV(i,e)&&t.isReferenceViewable(i.metadata))}function Wme(t,e,r){const n=Gd(e);for(let i=0;i<r.length;i++){const o=r[i],a=G5(o.data.contour.polyline,t),s=Gd(a),c=LV(n,s),l=c&&WV(e,a),f=c&&!l&&E4(a,e);if(l||f)return{targetAnnotation:o,targetPolyline:a,isContourHole:f}}}function TF(t,e,r){e.data.contour,r.data.contour,d4(e,r),A5(r);const{contour:n}=r.data,i=G5(n.polyline,t);Jc(r,{points:i,closed:n.closed},t);const{element:o}=t,a=new Set([Lg,e.metadata.toolName,r.metadata.toolName]);for(const s of a.values()){const c=pt(o,s);Me(c)}}function zme(t,e){return D5(e).map(r=>{const n=G5(r.data.contour.polyline,t);return{annotation:r,polyline:n}})}function $me(t,e,r,n,i){var y;if(!ihe(Lg)){console.warn(`${Lg} is not registered in cornerstone`);return}if(!SF(t))return;const o=i[0],a=Zf(r,o),s=zme(t,e),c=new Set(s),l=new Map,f=(x,C)=>{let S=l.get(x);S||(S=[],l.set(x,S)),S.push(C),c.delete(C)},u=[];if(a){const x=UV(r,i);u.push(x),Array.from(c.keys()).forEach(C=>f(x,C))}else BV(r,i).forEach(C=>{u.push(C),Array.from(c.keys()).forEach(S=>{E4(C,S.polyline)&&(f(C,S),c.delete(S))})});Array.from(l.values()).forEach(x=>x.forEach(C=>f4(C.annotation)));const{element:d}=t,h=we(d),{metadata:g,data:p}=e,{handles:v,segmentation:w}=p,{textBox:m}=v;hn(n.annotationUID),hn(e.annotationUID);for(let x=0;x<u.length;x++){const C=u[x],S=t.canvasToWorld(C[0]),T=t.canvasToWorld(C[C.length-1]),_={metadata:{...g,toolName:Lg,originalToolName:g.originalToolName||g.toolName},data:{cachedStats:{},handles:{points:[S,T],textBox:m?{...m}:void 0},contour:{polyline:[],closed:!0},spline:e.data.spline,segmentation:{...w}},annotationUID:Cn(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:e.interpolationUID,interpolationCompleted:e.interpolationCompleted};Jc(_,{points:C,closed:!0,targetWindingDirection:vu.Clockwise},t),Zt(_,d),Jf(_),qn(_,t.element),(y=l.get(C))==null||y.forEach(E=>d4(_,E.annotation))}jme(h,e,n)}function jme(t,e,r){const{viewport:n}=t,{element:i}=n,o=new Set([Lg,e.metadata.toolName,r.metadata.toolName]);for(const a of o.values()){const s=pt(i,a);Me(s)}return new Promise(a=>window.requestAnimationFrame(a))}const{PointsManager:zh}=cn,BD=.2;function L2(t){if(!t.annotation)return;const{isInterpolationUpdate:e,annotation:r}=t;queueMicrotask(()=>{try{e&&(r.isInterpolationUpdate=!0,r.autoGenerated=!1),Hme(t)}finally{e&&(r.autoGenerated=!0)}})}function Hme(t){const{annotation:e}=t;Fme(e);const{interpolationData:r,interpolationList:n}=Ime(e,t)||{};if(!r||!n)return;const i={toolName:e.metadata.toolName,toolType:e.metadata.toolName,viewport:t.viewport};for(let l=0;l<n.length;l++)n[l]&&Kme(n[l].list,n[l].pair,r,i);const{id:o,renderingEngineId:a,element:s}=t.viewport,c={annotation:e,element:s,viewportId:o,renderingEngineId:a};n.length&&Qe(t.viewport.element,U.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED,c)}function Kme(t,e,r,n){const i=r.get(e[0])[0],o=r.get(e[1])[0],a=KD(i.data.contour.polyline),s=KD(o.data.contour.polyline),{c1Interp:c,c2Interp:l}=Zme(a,s);c.kIndex=e[0],l.kIndex=e[1],t.forEach(function(f){qme(c,l,f,e,r,a.x.length>s.x.length,n)})}function qme(t,e,r,n,i,o,a){const[s,c]=n,l=(r-s)/(c-s),f=i.get(s)[0],u=i.get(c)[0],d=Jme(t,e,l,o),h=l>.5?u:f,g=Ame(d);i.has(r)?Yme(d,g,r,h,a):Xme(d,g,r,h,a)}function Xme(t,e,r,n,i){var f;const o=t.points,{viewport:a}=i,s=xF(o,e,n),c=a.getViewReference({sliceIndex:r});if(!c)throw new Error(`Can't find slice ${r}`);Object.assign(s.metadata,c),as.addAnnotation(s,a.element),(f=n.onInterpolationComplete)==null||f.call(n,s,n);const{parentAnnotationUID:l}=n;if(l){const u=as.getAnnotation(l),d=_F(u,r,i);TF(a,d,s)}}function _F(t,e,r){const{viewport:n}=r,i=as.getAnnotations(t.metadata.toolName,n.element);for(let o=0;o<i.length;o++){const a=i[o];if(a.interpolationUID===t.interpolationUID&&a.metadata.sliceIndex===e)return a}}function Yme(t,e,r,n,i){const o=_F(n,r,i),a=t.points,s=xF(a,e,o);Object.assign(o,{metadata:s.metadata,data:s.data})}function Jme(t,e,r,n){const i=n?t.I:e.I,o=zh.fromXYZ(t),a=zh.fromXYZ(e),{length:s}=o,c=zh.create3(s),l=Ae(),f=Ae(),u=zh.create3(s);u.kIndex=t.kIndex;const d=zh.create3(s);d.kIndex=e.kIndex;for(let h=0;h<t.x.length;h++)if(i[h]){const g=o.getPoint(h),p=a.getPoint(h);u.push(g),d.push(p),bn(l,p,g),c.push(Xt(f,g,l,r))}return c.sources=[u,d],c}function Zme(t,e){const r=HD(t),n=HD(e),i=Math.max(Math.ceil(r[r.length-1]/BD),Math.ceil(n[n.length-1]/BD)),o=jD(r),a=jD(n),s=i+e.x.length,c=i+t.x.length,l=$D(s,o),f=$D(c,a),u=zD(s-2,t.x.length),d=zD(c-2,e.x.length),h=WD(l,u),g=WD(f,d),p=GD(t,h),v=GD(e,g);return e2e(p,v),Qme(p,v)}function Qme(t,e){const r={x:[],y:[],z:[],I:[]},n={x:[],y:[],z:[],I:[]};for(let i=0;i<t.x.length;i++)(t.I[i]||e.I[i])&&(r.x.push(t.x[i]),r.y.push(t.y[i]),r.z.push(t.z[i]),r.I.push(t.I[i]),n.x.push(e.x[i]),n.y.push(e.y[i]),n.z.push(e.z[i]),n.I.push(e.I[i]));return{c1Interp:r,c2Interp:n}}function e2e(t,e){const r=t.x.length,n={startingNode:0,totalSquaredXYLengths:1/0};for(let o=0;o<r;o++){let a=o,s=0;for(let c=0;c<r;c++)s+=(t.x[a]-e.x[c])**2+(t.y[a]-e.y[c])**2+(t.z[a]-e.z[c])**2,a++,a===r&&(a=0);s<n.totalSquaredXYLengths&&(n.totalSquaredXYLengths=s,n.startingNode=o)}const i=n.startingNode;Pm(t.x,i),Pm(t.y,i),Pm(t.z,i),Pm(t.I,i)}function Pm(t,e){e-=t.length*Math.floor(e/t.length);const r=t.splice(0,e);return t.push(...r),t}function GD(t,e){const r={x:[],y:[],z:[],I:[]};for(let n=0;n<t.x.length-1;n++){r.x.push(t.x[n]),r.y.push(t.y[n]),r.z.push(t.z[n]),r.I.push(!0);const i=(t.x[n+1]-t.x[n])/(e[n]+1),o=(t.y[n+1]-t.y[n])/(e[n]+1),a=(t.z[n+1]-t.z[n])/(e[n]+1);for(let s=0;s<e[n]-1;s++)r.x.push(r.x[r.x.length-1]+i),r.y.push(r.y[r.y.length-1]+o),r.z.push(r.z[r.z.length-1]+a),r.I.push(!1)}return r}function WD(t,e){const r=[];for(let a=0;a<t.length;++a)r[a]=a;r.sort(function(a,s){return t[a]<t[s]?-1:1});const n=[];for(let a=0;a<e.length;a++)n.push(e[r[a]]);const i=n.reduce(function(a,s,c){return s&&a.push(c),a},[]),o=[];for(let a=0;a<i.length-1;a++)o.push(i[a+1]-i[a]);return o}function zD(t,e){const r=new Array(t+e);return r.fill(!1,0,t),r.fill(!0,t,t+e),r}function $D(t,e){const r=1/(t-1),n=[r];for(let i=1;i<t-2;i++)n.push(n[n.length-1]+r);return n.concat(e)}function jD(t){const e=[];for(let r=0;r<t.length;r++)e.push(t[r]/t[t.length-1]);return e}function HD(t){const e=[0];for(let r=1;r<t.x.length;r++){const n=Math.sqrt((t.x[r]-t.x[r-1])**2+(t.y[r]-t.y[r-1])**2+(t.z[r]-t.z[r-1])**2);e.push(e[r-1]+n)}return e}function KD(t){const e={x:[],y:[],z:[]};for(let r=0;r<t.length;r++)e.x[r]=t[r][0],e.y[r]=t[r][1],e.z[r]=t[r][2];return e.x.push(e.x[0]),e.y.push(e.y[0]),e.z.push(e.z[0]),e}function qD(t){const{annotation:e}=t,r=G4(t,[{key:"interpolationUID",value:t.interpolationUID}]),n=e.metadata.sliceIndex;let i=-1,o=t.sliceData.numberOfSlices;for(const[s,c]of r.entries())s===n||!c.find(f=>!f.autoGenerated)||(s<n?i=Math.max(s,i):o=Math.min(s,o));const a=[];for(const[s,c]of r.entries())s<=i||s>=o||s===n||c.forEach(l=>{l.autoGenerated&&(as.removeAnnotation(l.annotationUID),a.push(l))});if(a.length){const s={annotations:a,element:t.viewport.element,viewportId:t.viewport.id,renderingEngineId:t.viewport.getRenderingEngine().id};Qe(t.viewport.element,U.INTERPOLATED_ANNOTATIONS_REMOVED,s)}if(i>=0&&o<t.sliceData.numberOfSlices){const s=r.get(o)[0],c={viewport:t.viewport,sliceData:{numberOfSlices:t.sliceData.numberOfSlices,imageIndex:s.metadata.sliceIndex},annotation:s,interpolationUID:s.interpolationUID};L2(c)}}function A2(t){const e=CF(t);return e.length?e[0]:void 0}const{uuidv4:t2e}=cn,n2e=[tr.HandlesUpdated,tr.InterpolationUpdated],la=class la{static addTool(e){this.toolNames.includes(e)||this.toolNames.push(e)}static acceptAutoGenerated(e,r={}){const{toolNames:n,segmentationId:i,segmentIndex:o,sliceIndex:a}=r;for(const s of n||la.toolNames){const c=as.getAnnotations(s,e);if(c!=null&&c.length)for(const l of c){const{interpolationUID:f,data:u,autoGenerated:d,metadata:h}=l;f&&(l.interpolationCompleted=!0),d&&(o&&o!==u.segmentation.segmentIndex||a!==void 0&&h&&a!==h.sliceIndex||i&&i!==u.segmentation.segmentationId||(Jf(l),l.autoGenerated=!1))}}}};la.toolNames=[],la.handleAnnotationCompleted=e=>{var h;const r=e.detail.annotation;if(!(r!=null&&r.metadata))return;const{toolName:n,originalToolName:i}=r.metadata;if(!la.toolNames.includes(n)&&!la.toolNames.includes(i))return;const o=A2(r);if(!o){console.warn("Unable to find viewport for",r);return}const a=d3(o),s={viewport:o,sliceData:a,annotation:r,interpolationUID:r.interpolationUID},c=!!r.interpolationUID;if(r.autoGenerated=!1,c){qD(s),L2(s);return}const l=[{key:"segmentIndex",value:r.data.segmentation.segmentIndex,parentKey:g=>g.data.segmentation},{key:"viewPlaneNormal",value:r.metadata.viewPlaneNormal,parentKey:g=>g.metadata},{key:"viewUp",value:r.metadata.viewUp,parentKey:g=>g.metadata}];let f=bme(s,l);const{sliceIndex:u}=r.metadata,d=new Set;f.forEach(g=>{if(g.interpolationCompleted||g.metadata.sliceIndex===u){const{interpolationUID:p}=g;d.add(p)}}),f=f.filter(g=>!d.has(g.interpolationUID)),r.interpolationUID=((h=f[0])==null?void 0:h.interpolationUID)||t2e(),s.interpolationUID=r.interpolationUID,L2(s)},la.handleAnnotationUpdate=e=>{const r=e.detail.annotation,{changeType:n=tr.HandlesUpdated}=e.detail;if(!(r!=null&&r.metadata))return;const{toolName:i,originalToolName:o}=r.metadata;if(!la.toolNames.includes(i)&&!la.toolNames.includes(o)||!n2e.includes(n))return;const a=A2(r);if(!a){console.warn("Unable to find matching viewport for annotation interpolation",r);return}r.autoGenerated&&(Jf(r),r.autoGenerated=!1);const s=d3(a),c={viewport:a,sliceData:s,annotation:r,interpolationUID:r.interpolationUID,isInterpolationUpdate:n===tr.InterpolationUpdated};L2(c)},la.handleAnnotationDelete=e=>{const r=e.detail.annotation;if(!(r!=null&&r.metadata))return;const{toolName:n}=r.metadata;if(!la.toolNames.includes(n)||r.autoGenerated)return;const i=A2(r);if(!i){console.warn("No viewport, can't delete interpolated results",r);return}const o=d3(i),a={viewport:i,sliceData:o,annotation:r,interpolationUID:r.interpolationUID};r.autoGenerated=!1,qD(a)};let Ws=la;function d3(t){return{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getCurrentImageIdIndex()}}function EF(t){t.forEach(e=>{const r=Li(e);if(!r){console.warn(`ToolGroup not available for ${e}`);return}r.getViewportsInfo().forEach(i=>{const{renderingEngineId:o,viewportId:a}=i,s=fr(o);if(!s){console.warn(`RenderingEngine not available for ${o}`);return}const c=s.getViewport(a);hh(c.element)})})}function Mp(t){return Vn.getActiveSegmentation(t)}function Po(t){const e=jt(t);if(e){const r=Object.keys(e.segments).find(n=>e.segments[n].active);return r?Number(r):void 0}}function r2e(t,e){const r=jt(t);if(!r)throw new Error(`No segmentation state found for ${t}`);const{segments:n}=r;return n[e].locked}function i2e(t,e,r=!0){const n=jt(t);if(!n)throw new Error(`No segmentation state found for ${t}`);const{segments:i}=n;i[e].locked=r,Ro(t)}function u0(t){const e=jt(t);if(!e)throw new Error(`No segmentation state found for ${t}`);const{segments:r}=e;return Object.keys(r).filter(i=>r[i].locked).map(i=>parseInt(i))}const o2e=Object.freeze(Object.defineProperty({__proto__:null,getLockedSegmentIndices:u0,isSegmentIndexLocked:r2e,setSegmentIndexLocked:i2e},Symbol.toStringTag,{value:"Module"}));function DF(t,e){return Vn.getSegmentationRepresentationVisibility(t,e)}function bF(t,e){const r=M5(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}function IF({segmentationId:t,segmentIndex:e,viewportId:r,autoGenerated:n=!1}){const i=qc(r,t,e),o=DF(r,{segmentationId:t,type:ht.Contour}),a=Mp(r),s=(a==null?void 0:a.segmentationId)===t,l=jo.getStyle({viewportId:r,segmentationId:t,type:ht.Contour,segmentIndex:e});let f=1,u,d=1,h=0;n?(f=l.outlineWidthAutoGenerated??f,u=l.outlineDashAutoGenerated??u,d=l.outlineOpacity??d,h=l.fillAlphaAutoGenerated??h):s?(f=l.outlineWidth??f,u=l.outlineDash??u,d=l.outlineOpacity??d,h=l.fillAlpha??h):(f=l.outlineWidthInactive??f,u=l.outlineDashInactive??u,d=l.outlineOpacityInactive??d,h=l.fillAlphaInactive??h),Po(t)===e&&(f+=l.activeSegmentOutlineWidthDelta),f=l.renderOutline?f:0,h=l.renderFill?h:0;const g=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${d})`,p=`rgb(${i[0]}, ${i[1]}, ${i[2]})`,w=!bF(r,{segmentationId:t,type:ht.Contour}).has(e);return{color:g,fillColor:p,lineWidth:f,fillOpacity:h,lineDash:u,textbox:{color:g},visibility:o&&w}}const v8=class v8 extends wme{constructor(e,r){var n;super(e,r),(n=this.configuration.interpolation)!=null&&n.enabled&&Ws.addTool(this.getToolName())}isContourSegmentationTool(){return!0}createAnnotation(e){const r=e.detail,{element:n}=r,i=we(n);if(!i)return;const{viewport:o}=i,a=super.createAnnotation(e);if(!this.isContourSegmentationTool())return a;const s=Mp(o.id);if(!s)throw new Error("No active segmentation detected, create one before using scissors tool");if(!s.representationData.Contour)throw new Error("A contour segmentation must be active");const{segmentationId:c}=s,l=Po(c);return ci(a,{data:{segmentation:{segmentationId:c,segmentIndex:l}}})}addAnnotation(e,r){const n=super.addAnnotation(e,r);return this.isContourSegmentationTool()&&Jf(e),n}cancelAnnotation(e){this.isContourSegmentationTool()&&A5(e),super.cancelAnnotation(e)}getAnnotationStyle(e){const r=super.getAnnotationStyle(e);if(!this.isContourSegmentationTool())return r;const n=this._getContourSegmentationStyle(e);return ci(r,n)}renderAnnotationInstance(e){const{annotation:r}=e,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n&&this.isContourSegmentationTool()){const{segmentationId:o}=r.data.segmentation;Ai(o);const s=dh(o).map(c=>or(c).id);EF(s)}return i}_getContourSegmentationStyle(e){const r=e.annotation,{segmentationId:n,segmentIndex:i}=r.data.segmentation,{viewportId:o}=e.styleSpecifier,a=Mo(o,{segmentationId:n});if(!(a!=null&&a.length))return{};a.length>1?a.find(v=>v.segmentationId===n&&v.type===ht.Contour):a[0];const{autoGenerated:s}=r,l=u0(n).includes(i),{color:f,fillColor:u,lineWidth:d,fillOpacity:h,lineDash:g,visibility:p}=IF({segmentationId:n,segmentIndex:i,viewportId:o,autoGenerated:s});return{color:f,fillColor:u,lineWidth:d,fillOpacity:h,lineDash:g,textbox:{color:f},visibility:p,locked:l}}};v8.PreviewSegmentIndex=255;let Rp=v8;function Eu(t,e,r){return t==="CT"?"HU":t==="PT"?a2e(e,r):""}function a2e(t,e){if(!e.isPreScaled)return"raw";if(e.isSuvScaled)return"SUV";const r=dt("generalSeriesModule",t);if((r==null?void 0:r.modality)==="PT"){const n=dt("petSeriesModule",t);return(n==null?void 0:n.units)||"unitless"}return"unknown"}const{pointCanProjectOnLine:XD}=Tu,{EPSILON:s2e}=Cu,c2e=1-s2e;class W4 extends Rp{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:ii.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:l2e,statsCalculator:wa}}){super(e,r),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=n=>{const i=n.detail,{element:o}=i,a=this.createAnnotation(n);this.addAnnotation(a,o);const s=pt(o,this.getToolName());return this.activateDraw(n,a,s),n.preventDefault(),Me(s),a},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=pt(s,this.getToolName());this.activateOpenContourEndEdit(n,i,c,o)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o,s=pt(a,this.getToolName());i.data.contour.closed?this.activateClosedContourEdit(n,i,s):this.activateOpenContourEdit(n,i,s),n.preventDefault()},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{polyline:l}=i.data.contour;let f=c.worldToCanvas(l[0]);for(let h=1;h<l.length;h++){const g=f,p=c.worldToCanvas(l[h]);if(XD(o,g,p,a))return!0;f=p}if(!i.data.contour.closed)return!1;const u=c.worldToCanvas(l[0]),d=c.worldToCanvas(l[l.length-1]);return XD(o,u,d,a)},this.cancel=n=>{const i=this.isDrawing,o=this.isEditingOpen,a=this.isEditingClosed;i?this.cancelDrawing(n):o?this.cancelOpenContourEdit(n):a&&this.cancelClosedContourEdit(n)},this._calculateCachedStats=(n,i,o,a)=>{const{data:s}=n,{cachedStats:c}=s,{polyline:l,closed:f}=s.contour,u=Object.keys(c);for(let d=0;d<u.length;d++){const h=u[d],g=this.getTargetImageData(h);if(!g)continue;const{imageData:p,metadata:v}=g,w=l.map(C=>i.worldToCanvas(C)),m={isPreScaled:ec(i,h),isSuvScaled:this.isSuvScaled(i,h,n.metadata.referencedImageId)},y=Eu(v.Modality,n.metadata.referencedImageId,m),x=Ko(g,()=>{const C=s.contour.polyline,S=C.length,T=new Array(S);for(let k=0;k<S;k++)T[k]=i.worldToCanvas(C[k]);const{maxX:_,maxY:E,minX:D,minY:b}=Gd(T),I=i.canvasToWorld([D,b]),R=yr(p,I),M=i.canvasToWorld([_,E]),P=yr(p,M);return[R,P]});f?this.updateClosedCachedStats({targetId:h,viewport:i,canvasCoordinates:w,points:l,imageData:p,metadata:v,cachedStats:c,modalityUnit:y,calibratedScale:x}):this.updateOpenCachedStats({metadata:v,canvasCoordinates:w,targetId:h,cachedStats:c,modalityUnit:y,calibratedScale:x})}return qn(n,a.viewport.element,tr.StatsUpdated),n.invalidated=!1,c},this._renderStats=(n,i,o,a)=>{const{data:s}=n,c=this.getTargetId(i),l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:o.viewport.id},f=this.getLinkedTextBoxStyle(l,n);if(!f.visibility)return;const u=this.configuration.getTextLines(s,c);if(!u||u.length===0)return;const d=s.contour.polyline.map(x=>i.worldToCanvas(x));if(!s.handles.textBox.hasMoved){const x=Jo(d);s.handles.textBox.worldPosition=i.canvasToWorld(x)}const h=i.worldToCanvas(s.handles.textBox.worldPosition),p=to(a,n.annotationUID??"","1",u,h,d,{},f),{x:v,y:w,width:m,height:y}=p;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([v,w]),topRight:i.canvasToWorld([v+m,w]),bottomLeft:i.canvasToWorld([v,w+y]),bottomRight:i.canvasToWorld([v+m,w+y])}},s1e(this),p1e(this),E1e(this),F1e(this),G1e(this),Q1e(this),this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,r){if(!r||!r.length)return;const n=we(e),{viewport:i}=n;let o;if(i instanceof Rn){const a=i.getCamera(),{spacingInNormalDirection:s}=oh(i,a);o=this.filterAnnotationsWithinSlice(r,a,s)}else o=w1(i,r);return o}filterAnnotationsWithinSlice(e,r,n){const{viewPlaneNormal:i}=r,o=e.filter(l=>{const f=l.metadata.viewPlaneNormal,u=Math.abs(gt(i,f))>c2e;return f&&u});if(!o.length)return[];const a=n/2,{focalPoint:s}=r,c=[];for(const l of o){const u=l.data.contour.polyline[0];if(!l.isVisible)continue;const d=Ae();bn(d,s,u);const h=gt(d,i);Math.abs(h)<a&&c.push(l)}return c}isContourSegmentationTool(){return!1}createAnnotation(e){const r=e.detail.currentPoints.world,n=super.createAnnotation(e),i=a=>{a.data.handles.points.length=0};return ci(n,{data:{contour:{polyline:[[...r]]},label:"",cachedStats:{}},onInterpolationComplete:i})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:r,targetId:n,svgDrawingHelper:i}=e,o=e.annotation;let a=!1;const{viewport:s,renderingEngine:c}=r,l=this.isDrawing,f=this.isEditingOpen,u=this.isEditingClosed;if(!(l||f||u))this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);else{const d=this.commonData.annotation.annotationUID;if(o.annotationUID===d)if(l)this.renderContourBeingDrawn(r,i,o);else if(u)this.renderClosedContourBeingEdited(r,i,o);else if(f)this.renderOpenContourBeingEdited(r,i,o);else throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);else this.configuration.displayOnePointAsCrosshairs&&o.data.contour.polyline.length===1?this.renderPointContourWithMarker(r,i,o):this.renderContour(r,i,o);a=!0}if(this.configuration.calculateStats)return this._calculateStatsIfActive(o,n,s,c,r),this._renderStats(o,s,r,i),a}_calculateStatsIfActive(e,r,n,i,o){var s,c,l;const a=(s=this.commonData)==null?void 0:s.annotation.annotationUID;if(!(e.annotationUID===a&&!((c=this.commonData)!=null&&c.movingTextBox))&&!((l=this.commonData)!=null&&l.movingTextBox)){const{data:f}=e;!f.cachedStats[r]||f.cachedStats[r].areaUnit==null?(f.cachedStats[r]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,n,i,o)):e.invalidated&&this._throttledCalculateCachedStats(e,n,i,o)}}updateClosedCachedStats({viewport:e,points:r,imageData:n,metadata:i,cachedStats:o,targetId:a,modalityUnit:s,canvasCoordinates:c,calibratedScale:l}){var de,ue,me;const{scale:f,areaUnit:u,units:d}=l,{voxelManager:h}=e.getImageData(),g=c[0],p=e.canvasToWorld(g),v=e.canvasToWorld([g[0]+1,g[1]]),w=e.canvasToWorld([g[0],g[1]+1]),m=li(p,v),y=li(p,w),x=yr(n,r[0]);x[0]=Math.floor(x[0]),x[1]=Math.floor(x[1]),x[2]=Math.floor(x[2]);let C=x[0],S=x[0],T=x[1],_=x[1],E=x[2],D=x[2];for(let Ee=1;Ee<r.length;Ee++){const _e=yr(n,r[Ee]);_e[0]=Math.floor(_e[0]),_e[1]=Math.floor(_e[1]),_e[2]=Math.floor(_e[2]),C=Math.min(C,_e[0]),S=Math.max(S,_e[0]),T=Math.min(T,_e[1]),_=Math.max(_,_e[1]),E=Math.min(E,_e[2]),D=Math.max(D,_e[2])}const b=yr(n,r[1]);b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]);let I=y1(c)/f/f;I*=m*y;const R=.01*(S-C),M=.01*(_-T),P=.01*(D-E);C=Math.floor(C-R),S=Math.ceil(S+R),T=Math.floor(T-M),_=Math.ceil(_+M),E=Math.floor(E-P),D=Math.ceil(D+P);const k=[[C,S],[T,_],[E,D]],z=n.indexToWorld([S,_,D]),A=e.worldToCanvas(z);let L=0,N=[],H=0;const ee=h.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(Ee,_e)=>{let Ce=!0;const F=e.worldToCanvas(Ee);return F[1]!=L&&(H=0,L=F[1],N=$V(c,F,[A[0],F[1]]),N.sort(function(O){return function($,W){return $[O]===W[O]?0:$[O]<W[O]?-1:1}}(0))),N.length&&F[0]>N[0][0]&&(N.shift(),H++),H%2===0&&(Ce=!1),Ce},boundsIJK:k,returnPoints:this.configuration.storePointData}),oe=this.configuration.statsCalculator.getStatistics();o[a]={Modality:i.Modality,area:I,perimeter:KC(c,closed)/f,mean:(de=oe.mean)==null?void 0:de.value,max:(ue=oe.max)==null?void 0:ue.value,stdDev:(me=oe.stdDev)==null?void 0:me.value,statsArray:oe.array,pointsInShape:ee,areaUnit:u,modalityUnit:s,unit:d}}updateOpenCachedStats({targetId:e,metadata:r,canvasCoordinates:n,cachedStats:i,modalityUnit:o,calibratedScale:a}){const{scale:s,units:c}=a;i[e]={Modality:r.Modality,length:KC(n,!1)/s,modalityUnit:o,getPixelValueUnitunit:c}}}function l2e(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,length:a,perimeter:s,max:c,isEmptyArea:l,unit:f,areaUnit:u,modalityUnit:d}=r||{},h=[];if(n){const g=l?"Area: Oblique not supported":`Area: ${Kt(n)} ${u}`;h.push(g)}return i&&h.push(`Mean: ${Kt(i)} ${d}`),Number.isFinite(c)&&h.push(`Max: ${Kt(c)} ${d}`),o&&h.push(`Std Dev: ${Kt(o)} ${d}`),s&&h.push(`Perimeter: ${Kt(s)} ${f}`),a&&h.push(`${Kt(a)} ${f}`),h}W4.toolName="PlanarFreehandROI";class T1 extends W4{constructor(e){const r=ci({configuration:{calculateStats:!1,allowOpenContours:!1}},e);super(r)}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const r=e.annotation,{invalidated:n}=r,i=super.renderAnnotationInstance(e);if(n){const{segmentationId:o}=r.data.segmentation;Ai(o)}return i}}T1.toolName="PlanarFreehandContourSegmentationTool";function u2e(t,e,r){const n=new Map;for(const[i,o]of t)for(const a of o){const{points:s}=a,{lineSegments:c,linesNumberOfPoints:l}=f2e(a);for(let f=0;f<c.length;f++){const u=c[f],d=[];for(let p=0;p<l[f];p++){const v=u[p];d.push([s[3*v],s[3*v+1],s[3*v+2]])}if(d.length<3)continue;const h={annotationUID:Cn(),data:{contour:{closed:!0,polyline:d},segmentation:{segmentationId:r,segmentIndex:i},handles:{}},handles:{},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:T1.toolName,...e.getViewReference()}};Zt(h,e.element);const g=(n==null?void 0:n.get(i))||new Set;g.add(h.annotationUID),n.set(i,g)}}return n}const f2e=t=>{const{numberOfCells:e,lines:r}=t,n=[],i=[];for(let o=0;o<r.length;){const a=r[o];if(i.push(a),n.push(r.slice(o+1,o+a+1)),o+=a+1,n.length===e)break}return{lineSegments:n,linesNumberOfPoints:i}};async function d2e(t,e={}){var c;const r=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:Qs(t);let n;const o=jt(t).representationData;try{o.Surface?n=await g2e(t,{segmentIndices:r,...e}):o.Labelmap&&(n=await h2e(t,{segmentIndices:r,...e}))}catch(l){throw console.error(l),l}if(!n)throw new Error("Not enough data to convert to contour, currently only support converting volume labelmap to contour if available");const{viewport:a}=e,s=u2e(n,a,t);return jo.setStyle({segmentationId:t,type:ht.Contour},{fillAlpha:0}),{annotationUIDsMap:s}}async function h2e(t,e={}){if(!e.viewport)throw new Error("Viewport is required to compute contour from labelmap");const r=await C4(t,e);if(!(r!=null&&r.length)){console.error("Failed to convert labelmap to surface or labelmap is empty");return}const{viewport:n}=e,i=r.map(s=>({id:s.segmentIndex.toString(),points:s.data.points,polys:s.data.polys,segmentIndex:s.segmentIndex})),o=await MV(i,n);return RV(o)}async function g2e(t,e={}){var u;if(!e.viewport)throw new Error("Viewport is required to compute contour from surface");const{viewport:r}=e,n=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:Qs(t),i=new Map,o=new Map,s=jt(t).representationData.Surface,c=[];s.geometryIds.forEach((d,h)=>{var g;if(n.includes(h)){i.set(h,d);const p=(g=ke.getGeometry(d))==null?void 0:g.data;p&&c.push({id:d,points:p.points,polys:p.polys,segmentIndex:h})}}),i.forEach((d,h)=>{o.set(d,h)});const l=await MV(c,r);return RV(l)}function OF(t,e={}){return x4(t,ht.Contour,()=>d2e(t,e),()=>{})}function p2e(t,e,r=!1){const n=jt(e),{annotationUIDsMap:i}=n.representationData.Contour;i.forEach(o=>{o.forEach(a=>{hn(a)})})}let h3=!1;function m2e(t,e,r=!1){const n=An(t);if(!n)return;const{viewport:i}=n;r&&(p2e(t,e),i.render())}async function v2e(t,e){var o;const{segmentationId:r}=e,n=jt(r);if(!n)return;let i=n.representationData[ht.Contour];!i&&R5(r,ht.Contour)&&!h3&&(h3=!0,i=await OF(r,{viewport:t}),h3=!1),i&&(o=i.geometryIds)!=null&&o.length&&Nge(t,i.geometryIds,i.annotationUIDsMap,e)}const MF={render:v2e,removeRepresentation:m2e};function qo(t,e){return Vn.getCurrentLabelmapImageIdForViewport(t,e)}const YD=new Map,y2e=({cfun:t,ofun:e,actor:r})=>{r.getProperty().setRGBTransferFunction(1,t),r.getProperty().setScalarOpacity(1,e)};async function w2e({viewport:t,volumeInputs:e,segmentationId:r}){var T;const n=t.getDefaultActor(),{actor:i}=n,{uid:o,callback:a}=n,s=t.getVolumeId();if((T=YD.get(o))!=null&&T.added)return{uid:o,actor:i};const c=e,l=ke.getVolume(c[0].volumeId);if(!l)throw new Error(`imageVolume with id: ${l.volumeId} does not exist`);const{volumeId:f}=c[0],u=await S_(f);if(!u)throw new Error(`segImageVolume with id: ${u.volumeId} does not exist`);const d=u.voxelManager,{imageData:h}=u,g=ke.getVolume(s),p=g.voxelManager,v=2,w=new Float32Array(v*g.voxelManager.getScalarDataLength()),m=h.getDimensions();for(let _=0;_<m[2];++_)for(let E=0;E<m[1];++E)for(let D=0;D<m[0];++D){const b=D+m[0]*(E+m[1]*_);w[b*v+0]=p.getAtIndex(b),w[b*v+1]=d.getAtIndex(b)}t.removeActors([o]);const y=i.getMapper(),x=pA(y);i.setMapper(x),x.setBlendMode(zf.LABELMAP_EDGE_PROJECTION_BLEND);const C=x.getInputData().getPointData().getArray(0);C.setData(w),C.setNumberOfComponents(2),i.getProperty().setColorMixPreset(1),i.getProperty().setForceNearestInterpolation(1,!0),i.getProperty().setIndependentComponents(!0),t.addActor({actor:i,uid:o,callback:a,referencedId:s,representationUID:`${r}-${ht.Labelmap}`}),YD.set(o,{added:!0,segmentationRepresentationUID:`${r}`,originalBlendMode:t.getBlendMode()}),i.set({preLoad:y2e});function S(_){const{segmentationId:E,modifiedSlicesToUse:D}=_.detail,{representationData:b}=jt(E),{volumeId:I}=b.Labelmap;if(I!==u.volumeId)return;const M=ke.getVolume(I).voxelManager,P=x.getInputData().getPointData().getArray(0),k=P.getData(),z=2,A=h.getDimensions(),L=D!=null&&D.length?D:Array.from({length:A[2]},(N,H)=>H);for(const N of L)for(let H=0;H<A[1];++H)for(let ee=0;ee<A[0];++ee){const oe=ee+A[0]*(H+A[1]*N);k[oe*z+1]=M.getAtIndex(oe)}P.setData(k)}return We.addEventListener(U.SEGMENTATION_DATA_MODIFIED,S),We.addEventListener(U.SEGMENTATION_REPRESENTATION_REMOVED,async _=>{We.removeEventListener(U.SEGMENTATION_DATA_MODIFIED,S);const E=t.getActor(o),{element:D,id:b}=t;t.removeActors([o]);const I=await Nv({volumeId:o,blendMode:zf.MAXIMUM_INTENSITY_BLEND,callback:({volumeActor:R})=>{E.callback&&E.callback({volumeActor:R,volumeId:f})}},D,b);t.addActor({actor:I,uid:o}),t.render()}),{uid:o,actor:i}}const{uuidv4:RF}=cn;async function x2e(t,e,r,n){const i=we(t),{renderingEngine:o,viewport:a}=i,{id:s}=a,c=!0,l=!1,f=!0;if(a instanceof Xn){const d=C2e(e,r);ke.getVolume(d)||await S2e(e);const h=(n==null?void 0:n.blendMode)??zf.MAXIMUM_INTENSITY_BLEND,g=h===zf.LABELMAP_EDGE_PROJECTION_BLEND,p=[{volumeId:d,visibility:c,representationUID:`${r}-${ht.Labelmap}`,useIndependentComponents:g,blendMode:h}];if(!p[0].useIndependentComponents)await LA(o,p,[s],l,f);else return await w2e({viewport:a,volumeInputs:p,segmentationId:r})}else{const d=[{imageId:qo(a.id,r),representationUID:`${r}-${ht.Labelmap}`}];AA(o,d,[s])}Ai(r)}function C2e(t,e){let{volumeId:r}=t;if(!r){r=RF();const n=jt(e);n.representationData.Labelmap={...n.representationData.Labelmap,volumeId:r},t.volumeId=r,Ro(e)}return r}async function S2e(t){const e=t;if(!(e.imageIds.length>0))throw new Error("cannot create labelmap, no imageIds found for the volume labelmap");return await f5(t.volumeId||RF(),e.imageIds)}function T2e(t,e){const r=we(t),{viewport:n}=r;n.removeActors([ege(n.id,e)])}function _2e(t,e){Vn.setActiveSegmentation(t,e)}function Du(t){return Mp(t)}function E2e(t,e){_2e(t,e)}const D2e=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentation:Du,setActiveSegmentation:E2e},Symbol.toStringTag,{value:"Module"})),PF=Kc(),xd=(t,e)=>{Qe(t,$e.WEB_WORKER_PROGRESS,{progress:e,type:lh.POLYSEG_CONTOUR_TO_LABELMAP})};async function b2e(t,e={}){var p;const r=e.viewport,n=r.getVolumeId();if(!YA(r))throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");const o=Cn(),a=s0(n,{volumeId:o}),{dimensions:s,origin:c,direction:l,spacing:f,voxelManager:u}=a,{segmentIndices:d,annotationUIDsInSegmentMap:h}=LF(t,e);xd(We,0);const g=await PF.executeTask("polySeg","convertContourToVolumeLabelmap",{segmentIndices:d,dimensions:s,scalarData:(p=u.getCompleteScalarDataArray)==null?void 0:p.call(u),origin:c,direction:l,spacing:f,annotationUIDsInSegmentMap:h},{callbacks:[v=>{xd(We,v)}]});return xd(We,100),u.setCompleteScalarDataArray(g),a.modified(),{volumeId:a.volumeId}}async function I2e(t,e={}){if(!e.viewport)throw new Error("No viewport provided, labelmap computation from contour requires viewports");const n=e.viewport.getImageIds();if(!n)throw new Error("No imageIds found, labelmap computation from contour requires viewports with imageIds");n.forEach(u=>{if(!ke.getImageLoadObject(u))throw new Error("ImageIds must be cached before converting contour to labelmap")});const o=(await y_(n)).map(u=>u.imageId),{segmentIndices:a,annotationUIDsInSegmentMap:s}=LF(t,e),c=new Map;o.forEach((u,d)=>{const h=ke.getImage(u),g=dt(Bo.IMAGE_PLANE,u);let{columnCosines:p,rowCosines:v,rowPixelSpacing:w,columnPixelSpacing:m,imagePositionPatient:y}=g;p=p??[0,1,0],v=v??[1,0,0],w=w??1,m=m??1,y=y??[0,0,0];const x=xt(v[0],v[1],v[2]),C=xt(p[0],p[1],p[2]),S=Ae();xn(S,x,C);const T=[...x,...C,...S],_=[w,m,1],E=y;c.set(n[d],{direction:T,spacing:_,origin:E,scalarData:h.voxelManager.getScalarData(),imageId:u,dimensions:[h.width,h.height,1]})}),xd(We,0);const l=await PF.executeTask("polySeg","convertContourToStackLabelmap",{segmentationsInfo:c,annotationUIDsInSegmentMap:s,segmentIndices:a},{callbacks:[u=>{xd(We,u)}]});xd(We,100);const f=[];return l.forEach(({scalarData:u},d)=>{var v,w;const h=c.get(d),{imageId:g}=h,p=ke.getImage(g);p.voxelManager.getScalarData().set(u),(w=(v=p.imageFrame)==null?void 0:v.pixelData)==null||w.set(u),f.push(g)}),{imageIds:f}}function LF(t,e={}){var o;const r=t.annotationUIDsMap,n=(o=e.segmentIndices)!=null&&o.length?e.segmentIndices:Array.from(r.keys()),i=new Map;return n.forEach(a=>{const s=r.get(a);let c=Array.from(s);c=c.filter(f=>!xr(f).parentAnnotationUID);const l=c.map(f=>{var h;const u=xr(f),d=(h=u.childAnnotationUIDs)==null?void 0:h.length;return{polyline:u.data.contour.polyline,referencedImageId:u.metadata.referencedImageId,holesPolyline:d&&u.childAnnotationUIDs.map(g=>xr(g).data.contour.polyline)}});i.set(a,l)}),{segmentIndices:n,annotationUIDsInSegmentMap:i}}const O2e=Kc(),g3=(t,e)=>{Qe(t,$e.WEB_WORKER_PROGRESS,{progress:e,type:lh.POLYSEG_SURFACE_TO_LABELMAP})};async function M2e(t,e){const{geometryIds:r}=t;if(!(r!=null&&r.size))throw new Error("No geometry IDs found for surface representation");const n=new Map;r.forEach((f,u)=>{const h=ke.getGeometry(f).data,g=h.points,p=h.polys;n.set(u,{points:g,polys:p})});const{dimensions:i,direction:o,origin:a,spacing:s,voxelManager:c}=e;g3(We,0);const l=await O2e.executeTask("polySeg","convertSurfacesToVolumeLabelmap",{segmentsInfo:n,dimensions:i,spacing:s,direction:o,origin:a},{callbacks:[f=>{g3(We,f)}]});return g3(We,100),c.setCompleteScalarDataArray(l),e.modified(),{volumeId:e.volumeId}}function R2e(t,e){const{segmentationId:r,config:n}=e,i={colorLUTIndex:P2e(n),...n};Vn.addSegmentationRepresentation(t,r,e.type,i),e.type===ht.Contour&&Me([t]),Ro(r)}function P2e(t){const{colorLUTOrIndex:e}=t||{};return e===void 0?Rg(JSON.parse(JSON.stringify(ty))):typeof e=="number"?e:Array.isArray(e)&&e.every(n=>Array.isArray(n)&&n.length===4)?Rg(e):Rg(JSON.parse(JSON.stringify(ty)))}function ph(t,e){e.map(r=>R2e(t,r))}function AF(t,e){return ph(t,e.map(r=>({...r,type:ht.Contour})))}function L2e(t){const e={};for(const[r,n]of Object.entries(t))e[r]=AF(r,n);return e}function NF(t,e){return ph(t,e.map(r=>({...r,type:ht.Labelmap})))}function A2e(t){for(const[e,r]of Object.entries(t))NF(e,r.map(n=>({...n,type:ht.Labelmap})))}function kF(t,e){return ph(t,e.map(r=>({...r,type:ht.Surface})))}function N2e(t){const e={};for(const[r,n]of Object.entries(t))e[r]=kF(r,n);return e}async function k2e({segmentationId:t,viewportId:e,imageIds:r,options:n}){const i=jt(t);if(n!=null&&n.removeOriginal){const o=i.representationData.Labelmap;ke.getVolume(o.volumeId)&&ke.removeVolumeLoadObject(o.volumeId),i.representationData.Labelmap={imageIds:r}}else i.representationData.Labelmap={...i.representationData.Labelmap,imageIds:r};await ph(e,[{segmentationId:t,type:ht.Labelmap}]),We.addEventListenerOnce(U.SEGMENTATION_RENDERED,()=>Ai(t))}async function V2e({volumeId:t}){return{imageIds:ke.getVolume(t).imageIds}}function F2e({segmentationId:t,options:e}){const r=jt(t);if(!r)return;const{volumeId:n}=r.representationData.Labelmap,i=ke.getVolume(n);return k2e({segmentationId:t,viewportId:e.viewportId,imageIds:i.imageIds,options:e})}async function U2e(t,e={}){var a;const r=(a=e.segmentIndices)!=null&&a.length?e.segmentIndices:Qs(t);let n;const i=jt(t),o=i.representationData;try{o.Contour?n=await B2e(t,{segmentIndices:r,...e}):o.Surface&&(n=await G2e(i.segmentationId,{segmentIndices:r,...e}))}catch(s){throw console.error(s),s}if(!n)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return n}async function B2e(t,e={}){var c;const r=e.viewport?e.viewport instanceof Rn:!0;if(r&&!e.viewport)throw new Error("Cannot compute labelmap from contour segmentation without providing the viewport");const n=(c=e.segmentIndices)!=null&&c.length?e.segmentIndices:Qs(t),o=jt(t).representationData.Contour;return await(r?b2e:I2e)(o,{segmentIndices:n,viewport:e.viewport})}async function G2e(t,e={}){var u;const{viewport:r}=e,n=r?r instanceof Rn:!0,i=(u=e.segmentIndices)!=null&&u.length?e.segmentIndices:Qs(t),o=jt(t),a=new Map;if(o.representationData.Surface.geometryIds.forEach((d,h)=>{i.includes(h)&&a.set(h,d)}),n&&!r)throw new Error("Cannot compute labelmap from surface segmentation without providing the viewport");let c;if(n){const d=r.getVolumeId();c=s0(d)}else{const d=e.viewport.getImageIds(),g=y_(d).map(p=>p.imageId);c=await f5("generatedSegmentationVolumeId",g)}const l=await M2e({geometryIds:a},c);return n?l:await V2e({volumeId:c.volumeId})}async function VF(t,e={}){return x4(t,ht.Labelmap,()=>U2e(t,e),()=>null,()=>{Vn.processLabelmapRepresentationAddition(e.viewport.id,t),setTimeout(()=>{Ai(t)},0)})}const p3=255,Ag=new Map;let m3=!1;function W2e(t,e,r=!1){const n=An(t);if(Ag.forEach((o,a)=>{a.includes(e)&&Ag.delete(a)}),!n)return;const{viewport:i}=n;T2e(i.element,e),r&&i.render()}async function z2e(t,e){const{segmentationId:r,config:n}=e,i=jt(r);if(!i){console.warn("No segmentation found for segmentationId: ",r);return}let o=i.representationData[ht.Labelmap],a=kc(t.id,r);if(!o&&R5(r,ht.Labelmap)&&!m3){if(m3=!0,o=await VF(r,{viewport:t}),!o)throw new Error(`No labelmap data found for segmentationId ${r}.`);m3=!1}if(o){if(t instanceof Rn)a||await ZD(t,o,r,n),a=kc(t.id,r);else{if(!qo(t.id,r))return;a||await ZD(t,o,r,n),a=kc(t.id,r)}a&&$2e(t.id,a,e)}}function $2e(t,e,r){var C;const{segmentationId:n}=r,{cfun:i,ofun:o}=r.config,{colorLUTIndex:a}=r,s=Du(t),c=(s==null?void 0:s.segmentationId)===n,l=jo.getStyle({viewportId:t,type:ht.Labelmap,segmentationId:n}),f=jo.getRenderInactiveSegmentations(t),u=p1(a),d=Math.min(256,u.length),{outlineWidth:h,renderOutline:g,outlineOpacity:p,activeSegmentOutlineWidthDelta:v}=JD(l,c),w=bF(t,{segmentationId:n,type:ht.Labelmap});for(let S=0;S<d;S++){const T=S,_=u[T],D=jo.getStyle({viewportId:t,type:ht.Labelmap,segmentationId:n,segmentIndex:T}),{fillAlpha:b,outlineWidth:I,renderFill:R,renderOutline:M}=JD(l,c,D),{forceOpacityUpdate:P,forceColorUpdate:k}=j2e(t,n,T,{fillAlpha:b,renderFill:R,renderOutline:M,segmentColor:_,outlineWidth:I,segmentsHidden:w,cfun:i,ofun:o});if(k&&i.addRGBPoint(T,_[0]/p3,_[1]/p3,_[2]/p3),P)if(R){const z=w.has(T)?0:_[3]/255*b;o.removePoint(T),o.addPointLong(T,z,.5,1)}else o.addPointLong(T,.01,.5,1)}o.setClamping(!1);const m=e.actor,{preLoad:y}=((C=m.get)==null?void 0:C.call(m,"preLoad"))||{preLoad:null};if(y?y({cfun:i,ofun:o,actor:m}):(m.getProperty().setRGBTransferFunction(0,i),m.getProperty().setScalarOpacity(0,o),m.getProperty().setInterpolationTypeToNearest()),g){m.getProperty().setUseLabelOutline(g),m.getProperty().setLabelOutlineOpacity(p);const S=Po(r.segmentationId),T=new Array(d-1);for(let _=1;_<d;_++){if(w.has(_)){T[_-1]=0;continue}T[_-1]=_===S?h+v:h}m.getProperty().setLabelOutlineThickness(T)}else m.getProperty().setLabelOutlineThickness(new Array(d-1).fill(0));const x=c||f;m.setVisibility(x)}function JD(t,e,r){const i={...t,...r||{}},o=e?i.fillAlpha:i.fillAlphaInactive,a=e?i.outlineWidth:i.outlineWidthInactive,s=e?i.renderFill:i.renderFillInactive,c=e?i.renderOutline:i.renderOutlineInactive,l=e?i.outlineOpacity:i.outlineOpacityInactive,f=i.activeSegmentOutlineWidthDelta;return{fillAlpha:o,outlineWidth:a,renderFill:s,renderOutline:c,outlineOpacity:l,activeSegmentOutlineWidthDelta:f}}function j2e(t,e,r,{fillAlpha:n,renderFill:i,renderOutline:o,segmentColor:a,outlineWidth:s,segmentsHidden:c,cfun:l,ofun:f}){const u=`${t}-${e}-${r}`,d=Ag.get(u);if(!d)return Ag.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:h,renderFill:g,renderOutline:p,outlineWidth:v,segmentColor:w,segmentsHidden:m,cfunMTime:y,ofunMTime:x}=d,C=w[0]!==a[0]||w[1]!==a[1]||w[2]!==a[2],S=w[3]!==a[3]||h!==n||g!==i||p!==o||v!==s||m!==c;return(S||C)&&Ag.set(u,{fillAlpha:n,renderFill:i,renderOutline:o,outlineWidth:s,segmentColor:a.slice(),segmentsHidden:new Set(c),cfunMTime:l.getMTime(),ofunMTime:f.getMTime()}),{forceOpacityUpdate:S,forceColorUpdate:C}}async function ZD(t,e,r,n){return await x2e(t.element,e,r,n)||void 0}const FF={render:z2e,removeRepresentation:W2e},H2e={[ht.Labelmap]:FF,[ht.Contour]:MF,[ht.Surface]:bV},Lm=T1.toolName;class K2e{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>Qi().flatMap(r=>r.getViewports()),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed(),Array.from(this._needsRender).forEach(r=>{this._triggerRender(r)}),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const r=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(r)}renderSegmentation(e){const r=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(r)}_getViewportIdsForSegmentation(e){const r=this._getAllViewports(),n=[];for(const i of r){const o=i.id;if(e){const a=Mo(o,{segmentationId:e});(a==null?void 0:a.length)>0&&n.push(o)}else{const a=Mo(o);(a==null?void 0:a.length)>0&&n.push(o)}}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach(r=>{this._needsRender.add(r)}),this._render()}_render(){this._needsRender.size>0&&this._animationFrameSet===!1&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const r=Mo(e);if(!(r!=null&&r.length))return;const{viewport:n}=An(e)||{};if(!n)return;const i=[],o=r.map(a=>{a.type===ht.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const s=H2e[a.type];try{const c=s.render(n,a);i.push(c)}catch(c){console.error(c)}return Promise.resolve({segmentationId:a.segmentationId,type:a.type})});Promise.allSettled(o).then(a=>{const s=a.filter(f=>f.status==="fulfilled").map(f=>f.value);function c(f){const{element:u,viewportId:d}=f.detail;u.removeEventListener($e.IMAGE_RENDERED,c),s.forEach(h=>{const g={viewportId:d,segmentationId:h.segmentationId,type:h.type};Qe(We,U.SEGMENTATION_RENDERED,{...g})})}n.element.addEventListener($e.IMAGE_RENDERED,c),n.render()})}_addPlanarFreeHandToolIfAbsent(e){Lm in ze.tools||Nl(T1);const r=or(e.id);r.hasTool(Lm)||(r.addTool(Lm),r.setToolPassive(Lm))}}function mh(t){UF.renderSegmentationsForViewport(t)}function W5(t){UF.renderSegmentation(t)}const UF=new K2e;function z5(){return Vn.getState().segmentations}function q2e(t){const{segmentationId:e,representation:r,config:n}=t,{type:i,data:o}=r,a=o?{...o}:{};if(!a)throw new Error("Segmentation representation data may not be undefined");i===ht.Contour&&X2e(a);const s=Y2e(n==null?void 0:n.segments,i,a);return n==null||delete n.segments,{segmentationId:e,label:(n==null?void 0:n.label)??null,cachedStats:(n==null?void 0:n.cachedStats)??{},segments:s,representationData:{[i]:{...a}}}}function X2e(t){t.geometryIds=t.geometryIds??[],t.annotationUIDsMap=t.annotationUIDsMap??new Map}function Y2e(t,e,r){const n={};return t?Object.entries(t).forEach(([i,o])=>{n[i]={segmentIndex:Number(i),label:o.label??`Segment ${i}`,locked:o.locked??!1,cachedStats:o.cachedStats??{},active:o.active??!1}}):e===ht.Surface?J2e(n,r):n[1]=Z2e(),n}function J2e(t,e){const{geometryIds:r}=e;r.forEach(n=>{const i=ke.getGeometry(n);if(i!=null&&i.data){const{segmentIndex:o}=i.data;t[o]={segmentIndex:o}}})}function Z2e(){return{segmentIndex:1,label:"Segment 1",locked:!1,cachedStats:{},active:!0}}function BF(t,e){const r=Vn;t.forEach(n=>{const i=q2e(n);r.addSegmentation(i),e||Ro(i.segmentationId)})}function vh(t,e,r){return WF(t,e,r)}function GF(t,e,r){return WF(t,e,r)}function WF(t,e,r){const{segmentationId:n,type:i}=e;return Q2e(t,n,i,r),Vn.removeSegmentationRepresentations(t,{segmentationId:n,type:i})}function zF(){Vn.getAllViewportSegmentationRepresentations().forEach(({viewportId:e,representations:r})=>{r.forEach(({segmentationId:n,type:i})=>{vh(e,{segmentationId:n,type:i})})}),Vn.resetState()}function $F(t,e,r){vh(t,{segmentationId:e,type:ht.Labelmap},r)}function jF(t,e,r){vh(t,{segmentationId:e,type:ht.Contour},r)}function HF(t,e,r){vh(t,{segmentationId:e,type:ht.Surface},r)}function Q2e(t,e,r,n){Mo(t,{segmentationId:e,type:r}).forEach(a=>{a.type===ht.Labelmap?FF.removeRepresentation(t,a.segmentationId,n):a.type===ht.Contour?MF.removeRepresentation(t,a.segmentationId,n):a.type===ht.Surface&&bV.removeRepresentation(t,a.segmentationId,n)});const{viewport:o}=An(t)||{};o&&o.render()}function z4(t){const e=Vn;e.getAllViewportSegmentationRepresentations().filter(({representations:n})=>n.some(i=>i.segmentationId===t)).map(({viewportId:n})=>n).forEach(n=>{GF(n,{segmentationId:t})}),e.removeSegmentation(t),y4(t)}function KF(){const t=Vn;t.getState().segmentations.map(n=>n.segmentationId).forEach(n=>{z4(n)}),t.resetState()}function eve(t){Vn.removeColorLUT(t)}function qF(t,e){return Vn.getState().viewportSegRepresentations[t].map(s=>(e&&s.type===e,jt(s.segmentationId))).filter(s=>s!==void 0)}function XF(t,e){return Vn.updateLabelmapSegmentationImageReferences(t,e)}function YF(t,e){return Vn.getStackSegmentationImageIdsForViewport(t,e)}function tve(){Vn.resetState()}const nve=Object.freeze(Object.defineProperty({__proto__:null,addColorLUT:Rg,addSegmentations:BF,destroy:tve,getColorLUT:p1,getCurrentLabelmapImageIdForViewport:qo,getNextColorLUTIndex:SV,getSegmentation:jt,getSegmentationRepresentation:M5,getSegmentationRepresentations:Mo,getSegmentationRepresentationsBySegmentationId:Qhe,getSegmentations:z5,getStackSegmentationImageIdsForViewport:YF,getViewportIdsWithSegmentation:dh,getViewportSegmentations:qF,removeAllSegmentationRepresentations:zF,removeAllSegmentations:KF,removeColorLUT:eve,removeContourRepresentation:jF,removeLabelmapRepresentation:$F,removeSegmentation:z4,removeSegmentationRepresentation:vh,removeSurfaceRepresentation:HF,updateLabelmapSegmentationImageReferences:XF},Symbol.toStringTag,{value:"Module"})),rve=function(t){const{segmentationId:e,modifiedSlicesToUse:r}=t.detail,{representationData:n}=jt(e),i=dh(e),o=i.some(c=>{const{viewport:l}=An(c);return l instanceof Rn}),a=i.some(c=>{const{viewport:l}=An(c);return l instanceof Jn}),s=o&&a;i.forEach(c=>{const{viewport:l}=An(c);l instanceof Rn&&ive({modifiedSlicesToUse:s?[]:r,representationData:n,type:ht.Labelmap}),l instanceof Jn&&ove({viewportIds:i,segmentationId:e})})};function ive({modifiedSlicesToUse:t,representationData:e,type:r}){const n=ke.getVolume(e[r].volumeId);if(!n){console.warn("segmentation not found in cache");return}const{imageData:i,vtkOpenGLTexture:o}=n;let a;if((t==null?void 0:t.length)>0)a=t;else{const s=i.getDimensions()[2];a=[...Array(s).keys()]}a.forEach(s=>{o.setUpdatedFrame(s)}),i.modified()}function ove({viewportIds:t,segmentationId:e}){t.forEach(r=>{let n=Mo(r,{segmentationId:e});n=n.filter(i=>i.type===ht.Labelmap),n.forEach(i=>{if(i.segmentationId!==e)return;const o=An(r);if(!o)return;const{viewport:a}=o;if(a instanceof Rn)return;const s=kc(r,e);if(!s)return;const c=s.actor.getMapper().getInputData(),l=qo(r,e),f=ke.getImage(l);c.modified(),d5(c,f)})})}const JF=function(t){const{segmentationId:e}=t.detail,{representationData:r}=jt(e);r.Labelmap&&rve(t),W5(e)},ZF=function(t){const{segmentationId:e}=t.detail;W5(e)},ave=function(t){if(!t)return;const e=we(t);if(!e)return;const{viewport:r}=e;r instanceof Xn||(t.addEventListener($e.STACK_NEW_IMAGE,Pp),t.addEventListener($e.IMAGE_RENDERED,Pp))},sve=function(t){t.removeEventListener($e.STACK_NEW_IMAGE,Pp),t.removeEventListener($e.IMAGE_RENDERED,Pp)};function Pp(t){const e=t.detail,{viewportId:r,renderingEngineId:n}=e,{viewport:i}=zr(r,n),o=Mo(r);if(!(o!=null&&o.length))return;const a=o.filter(l=>l.type===ht.Labelmap),s=i.getActors();a.forEach(l=>{const{segmentationId:f}=l;XF(r,f)});const c=a.map(l=>kc(r,l.segmentationId)).filter(l=>l!==void 0);c.length&&(c.forEach(l=>{a.find(u=>qo(r,u.segmentationId)===l.referencedId)||i.removeActors([l.uid])}),a.forEach(l=>{const{segmentationId:f}=l,u=i.getCurrentImageId(),d=qo(r,f);if(!d)return;const h=ke.getImage(d);if(!h){console.warn("No derived image found in the cache for segmentation representation",l);return}const g=s.find(p=>p.referencedId===d);if(g){const p=g.actor.getMapper().getInputData();p.setDerivedImage?p.setDerivedImage(h):d5(p,h)}else{const{dimensions:p,spacing:v,direction:w}=i.getImageDataMetadata(h),m=ke.getImage(u)||{imageId:u},{origin:y}=i.getImageDataMetadata(m),x=y,C=h.voxelManager.getConstructor(),S=h.voxelManager.getScalarData(),T=Lt.newInstance({name:"Pixels",numberOfComponents:1,values:new C(S)}),_=eh.newInstance();_.setDimensions(p[0],p[1],1),_.setSpacing(v),_.setDirection(w),_.setOrigin(x),_.getPointData().setScalars(T),_.modified(),i.addImages([{imageId:d,representationUID:`${f}-${ht.Labelmap}`,callback:({imageActor:E})=>{E.getMapper().setInputData(_)}}]),mh(r);return}i.render(),t.type===$e.IMAGE_RENDERED&&i.element.removeEventListener($e.IMAGE_RENDERED,Pp)}))}const QF={enable:ave,disable:sve};function cve(t){const e=t.detail.annotation;A5(e)}function eU(t){const e=t.detail.annotation;m1(e)&&Ume(t)}function sy(t){if(!t.detail.removed.length)return;Qi().forEach(n=>{const o=n.getViewports().map(a=>a.id);Me(o)})}function tU(t){const{viewportId:e}=t.detail;Me([e])}function lve(t){const e=t.detail.annotation;m1(e)&&cve(t)}const nU=function(t){hh(t.detail.element)},uve=function(t){t.addEventListener($e.IMAGE_RENDERED,nU)},fve=function(t){t.removeEventListener($e.IMAGE_RENDERED,nU)},rU={enable:uve,disable:fve},{Active:dve}=wn;function yh(t,e,r){if(ze.isInteractingWithTool)return!1;const{renderingEngineId:n,viewportId:i}=r.detail,o=or(i,n);if(!o)return!1;let a;const s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=o.getToolInstance(l);if(f.mode===dve&&typeof u[e]=="function"){a=o.getToolInstance(l);break}}a&&a[e](r)}const iU=yh.bind(null,"Mouse","mouseClickCallback"),oU=yh.bind(null,"Mouse","doubleClickCallback");function aU(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;const l=a.getHandleNearImagePoint(t,c,r,i);if(l){o.push({tool:a,annotation:c,handle:l});break}}}),o}function _1(t,e){const r=[];for(let n=0;n<e.length;n++){const i=e[n];if(!i){console.warn("undefined tool in filterToolsWithAnnotationsForElement");continue}let o=sn(i.constructor.toolName,t);o!=null&&o.length&&(typeof i.filterInteractableAnnotationsForElement=="function"&&(o=i.filterInteractableAnnotationsForElement(t,o)),(o==null?void 0:o.length)>0&&r.push({tool:i,annotations:o}))}return r}function $4(t,e,r,n="mouse"){const i=n==="touch"?36:6,o=[];return e.forEach(({tool:a,annotations:s})=>{for(const c of s){if(c.isLocked||!c.isVisible)continue;if(a.isPointNearTool(t,c,r,i,n)){o.push({tool:a,annotation:c});break}}}),o}const{Active:hve}=wn;function $5(t){const{renderingEngineId:e,viewportId:r,event:n}=t.detail,i=gh(n)||fh.getModifierKey(),o=or(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.buttons??(n==null?void 0:n.buttons)??s;for(let l=0;l<a.length;l++){const f=a[l],u=o.toolOptions[f],d=u.bindings.length&&u.bindings.some(h=>h.mouseButton===c&&h.modifierKey===i);if(u.mode===hve&&d)return o.getToolInstance(f)}}function Wd(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=or(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=r!=null&&f.bindings.length&&f.bindings.some(d=>d.mouseButton===r);if(e.includes(f.mode)&&(!r||u)){const d=o.getToolInstance(l);a.push(d)}}return a}function gve(t,e){var u;const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=or(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary(),c=t.detail.event,l=(c==null?void 0:c.buttons)??s,f=gh(c)||fh.getModifierKey();for(let d=0;d<a.length;d++){const h=a[d],g=o.getToolInstance(h),p=((u=g.configuration)==null?void 0:u.actions)??{},v=Object.values(p);if(!(v!=null&&v.length)||!e.includes(g.mode))continue;const w=v.find(m=>{var y;return((y=m.bindings)==null?void 0:y.length)&&m.bindings.some(x=>x.mouseButton===l&&x.modifierKey===f)});w&&r.set(g,w)}return r}const{Active:pve,Passive:mve}=wn;function vve(t){if(ze.isInteractingWithTool)return!1;const e=t.detail,{element:r}=e,n=we(r),{canvas:i}=e.currentPoints;if(!n)return!1;const o=gve(t,[pve,mve]),a=Array.from(o.keys()),s=_1(r,a),c=$4(r,s,i);if(c.length>0){const{tool:l,annotation:f}=c[0],u=o.get(l);return(typeof u.method=="string"?l[u.method]:u.method).call(l,t,f),!0}return!1}const{Active:yve,Passive:wve}=wn;function sU(t){if(ze.isInteractingWithTool)return;const e=$5(t);if(e&&typeof e.preMouseDownCallback=="function"&&e.preMouseDownCallback(t))return;const r=t.detail.event.buttons===1,n=Wd(t,[yve],t.detail.event.buttons),i=r?Wd(t,[wve]):void 0,o=[...n||[],...i||[]];if(vve(t))return;const s=t.detail,{element:c}=s,l=_1(c,o),f=s.currentPoints.canvas,u=aU(c,l,f,"mouse"),d=!!t.detail.event.shiftKey;if(u.length>0){const{tool:g,annotation:p,handle:v}=QD(u);eb(p.annotationUID,d),g.handleSelectedCallback(t,p,v,"Mouse");return}const h=$4(c,l,f,"mouse");if(h.length>0){const{tool:g,annotation:p}=QD(h);eb(p.annotationUID,d),g.toolSelectedCallback(t,p,"Mouse",f);return}e&&typeof e.postMouseDownCallback=="function"&&e.postMouseDownCallback(t)}function QD(t){if(t.length>1){const e=t.find(r=>{const n=!jr(r.annotation.annotationUID),i=ti(r.annotation.annotationUID);return n&&i});if(e)return e}return t[0]}function eb(t,e=!1){e?S1(t)?xa(t,!1):xa(t,!0,!0):xa(t,!0,!1)}function cU(t){if(ze.isInteractingWithTool)return;const e=$5(t);if(e&&!ze.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"mouse");xa(r.annotationUID)}}function lU(t){if(ze.isInteractingWithTool)return;const e=$5(t);!e||typeof e.mouseDragCallback!="function"||e.mouseDragCallback(t)}const{Active:xve,Passive:Cve}=wn;function uU(t){if(ze.isInteractingWithTool||ze.isMultiPartToolActive)return;const e=Wd(t,[xve,Cve]),r=t.detail,{element:n}=r,i=_1(n,e),o=e.filter(s=>!i.some(l=>l.tool.getToolName()===s.getToolName()));let a=!1;for(const{tool:s,annotations:c}of i)typeof s.mouseMoveCallback=="function"&&(a=s.mouseMoveCallback(t,c)||a);o.forEach(s=>{typeof s.mouseMoveCallback=="function"&&s.mouseMoveCallback(t)}),a===!0&&hh(n)}const fU=yh.bind(null,"Mouse","mouseUpCallback");function dU(t){if(ze.isInteractingWithTool)return;t.detail.buttons=Xs.Wheel|(t.detail.event.buttons||0);const e=$5(t);if(e)return e.mouseWheelCallback(t)}const Sve=function(t){t.addEventListener(U.MOUSE_CLICK,iU),t.addEventListener(U.MOUSE_DOWN,sU),t.addEventListener(U.MOUSE_DOWN_ACTIVATE,cU),t.addEventListener(U.MOUSE_DOUBLE_CLICK,oU),t.addEventListener(U.MOUSE_DRAG,lU),t.addEventListener(U.MOUSE_MOVE,uU),t.addEventListener(U.MOUSE_UP,fU),t.addEventListener(U.MOUSE_WHEEL,dU)},Tve=function(t){t.removeEventListener(U.MOUSE_CLICK,iU),t.removeEventListener(U.MOUSE_DOWN,sU),t.removeEventListener(U.MOUSE_DOWN_ACTIVATE,cU),t.removeEventListener(U.MOUSE_DOUBLE_CLICK,oU),t.removeEventListener(U.MOUSE_DRAG,lU),t.removeEventListener(U.MOUSE_MOVE,uU),t.removeEventListener(U.MOUSE_UP,fU),t.removeEventListener(U.MOUSE_WHEEL,dU)},hU={enable:Sve,disable:Tve},{Active:_ve}=wn;function gU(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=whe(),i=fh.getModifierKey(),o=or(r,e);if(!o)return null;const a=Object.keys(o.toolOptions),s=o.getDefaultMousePrimary();for(let c=0;c<a.length;c++){const l=a[c],f=o.toolOptions[l];if(f.mode!==_ve)continue;if(f.bindings.length&&f.bindings.some(d=>d.mouseButton===(n??s)&&d.modifierKey===i))return o.getToolInstance(l)}}function Eve(t,e){var c;const r=new Map,{renderingEngineId:n,viewportId:i}=t.detail,o=or(i,n);if(!o)return r;const a=Object.keys(o.toolOptions),s=t.detail.key;for(let l=0;l<a.length;l++){const f=a[l],u=o.getToolInstance(f),d=(c=u.configuration)==null?void 0:c.actions;if(!d)continue;const h=Object.values(d);if(!(h!=null&&h.length)||!e.includes(u.mode))continue;const g=h.find(p=>{var v;return(v=p.bindings)==null?void 0:v.some(w=>w.key===s)});g&&r.set(u,g)}return r}function pU(t){const e=gU(t);if(e){const{renderingEngineId:n,viewportId:i}=t.detail,o=or(i,n),a=e.getToolName();Object.keys(o.toolOptions).includes(a)&&o.setViewportsCursorByToolName(a)}const r=Eve(t,[wn.Active]);if(r!=null&&r.size){const{element:n}=t.detail;for(const[i,o]of[...r.entries()])(typeof o.method=="function"?o.method:i[o.method]).call(i,n,o,t)}}function mU(t){const e=gU(t);if(!e)return;const{renderingEngineId:r,viewportId:n}=t.detail,i=or(n,r);fV();const o=e.getToolName();Object.keys(i.toolOptions).includes(o)&&i.setViewportsCursorByToolName(o)}const Dve=function(t){t.addEventListener(U.KEY_DOWN,pU),t.addEventListener(U.KEY_UP,mU)},bve=function(t){t.removeEventListener(U.KEY_DOWN,pU),t.removeEventListener(U.KEY_UP,mU)},vU={enable:Dve,disable:bve},{Active:Ive,Passive:Ove,Enabled:Mve}=wn,yU=function(t){Wd(t,[Ive,Ove,Mve]).forEach(r=>{r.onCameraModified&&r.onCameraModified(t)})},Rve=function(t){t.addEventListener($e.CAMERA_MODIFIED,yU)},Pve=function(t){t.removeEventListener($e.CAMERA_MODIFIED,yU)},wU={enable:Rve,disable:Pve},{Active:Lve,Passive:Ave,Enabled:Nve}=wn,xU=function(t){Wd(t,[Lve,Ave,Nve]).forEach(r=>{r.onImageSpacingCalibrated&&r.onImageSpacingCalibrated(t)})},kve=function(t){t.addEventListener($e.IMAGE_SPACING_CALIBRATED,xU)},Vve=function(t){t.removeEventListener($e.IMAGE_SPACING_CALIBRATED,xU)},CU={enable:kve,disable:Vve},{Active:Fve}=wn;function j4(t){const{renderingEngineId:e,viewportId:r}=t.detail,n=t.detail.event,i=or(r,e);if(!i)return null;const o=Object.keys(i.toolOptions),a=Object.keys(n.touches).length,s=gh(n)||fh.getModifierKey(),c=i.getDefaultMousePrimary();for(let l=0;l<o.length;l++){const f=o[l],u=i.toolOptions[f],d=u.bindings.length&&u.bindings.some(h=>(h.numTouchPoints===a||a===1&&h.mouseButton===c)&&h.modifierKey===s);if(u.mode===Fve&&d)return i.getToolInstance(f)}}function tb(t,e,r){const{renderingEngineId:n,viewportId:i}=t.detail,o=or(i,n);if(!o)return[];const a=[],s=Object.keys(o.toolOptions);for(let c=0;c<s.length;c++){const l=s[c],f=o.toolOptions[l],u=r!=null&&f.bindings.length&&f.bindings.some(d=>d.numTouchPoints===r);if(e.includes(f.mode)&&(!r||u)){const d=o.getToolInstance(l);a.push(d)}}return a}const{Active:Uve,Passive:Bve}=wn;function SU(t){if(ze.isInteractingWithTool)return;const e=j4(t);if(e&&typeof e.preTouchStartCallback=="function"&&e.preTouchStartCallback(t))return;const r=Object.keys(t.detail.event.touches).length===1,n=tb(t,[Uve],Object.keys(t.detail.event.touches).length),i=r?tb(t,[Bve]):void 0,o=[...n||[],...i||[],e],a=t.detail,{element:s}=a,c=_1(s,o),l=a.currentPoints.canvas,f=aU(s,c,l,"touch"),u=!1;if(f.length>0){const{tool:h,annotation:g,handle:p}=nb(f);rb(g.annotationUID,u),h.handleSelectedCallback(t,g,p,"Touch");return}const d=$4(s,c,l,"touch");if(d.length>0){const{tool:h,annotation:g}=nb(d);rb(g.annotationUID,u),h.toolSelectedCallback(t,g,"Touch");return}e&&typeof e.postTouchStartCallback=="function"&&e.postTouchStartCallback(t)}function nb(t){return t.length>1&&t.find(e=>!jr(e.annotation.annotationUID)&&ti(e.annotation.annotationUID))||t[0]}function rb(t,e=!1){e?S1(t)?xa(t,!1):xa(t,!0,!0):xa(t,!0,!1)}function TU(t){if(ze.isInteractingWithTool)return;const e=j4(t);if(e&&!ze.isMultiPartToolActive&&e.addNewAnnotation){const r=e.addNewAnnotation(t,"touch");xa(r.annotationUID)}}function _U(t){if(ze.isInteractingWithTool)return;const e=j4(t);!e||typeof e.touchDragCallback!="function"||e.touchDragCallback(t)}const EU=yh.bind(null,"Touch","touchEndCallback"),Gve=yh.bind(null,"Touch","touchTapCallback"),DU=yh.bind(null,"Touch","touchPressCallback"),Wve=function(t){t.addEventListener(U.TOUCH_START,SU),t.addEventListener(U.TOUCH_START_ACTIVATE,TU),t.addEventListener(U.TOUCH_DRAG,_U),t.addEventListener(U.TOUCH_END,EU),t.addEventListener(U.TOUCH_TAP,Gve),t.addEventListener(U.TOUCH_PRESS,DU)},zve=function(t){t.removeEventListener(U.TOUCH_START,SU),t.removeEventListener(U.TOUCH_START_ACTIVATE,TU),t.removeEventListener(U.TOUCH_DRAG,_U),t.removeEventListener(U.TOUCH_END,EU),t.removeEventListener(U.TOUCH_PRESS,DU)},bU={enable:Wve,disable:zve},$ve=function(){We.addEventListener(U.ANNOTATION_COMPLETED,Ws.handleAnnotationCompleted),We.addEventListener(U.ANNOTATION_MODIFIED,Ws.handleAnnotationUpdate),We.addEventListener(U.ANNOTATION_REMOVED,Ws.handleAnnotationDelete)},jve=function(){We.removeEventListener(U.ANNOTATION_COMPLETED,Ws.handleAnnotationCompleted),We.removeEventListener(U.ANNOTATION_MODIFIED,Ws.handleAnnotationUpdate),We.removeEventListener(U.ANNOTATION_REMOVED,Ws.handleAnnotationDelete)},IU={enable:$ve,disable:jve},{Active:Hve,Passive:Kve,Enabled:qve}=wn,OU=function(t){Wd(t,[Hve,Kve,qve]).forEach(r=>{r.onResetCamera&&r.onResetCamera(t)})},Xve=function(t){t.addEventListener($e.CAMERA_RESET,OU)},Yve=function(t){t.removeEventListener($e.CAMERA_RESET,OU)},MU={enable:Xve,disable:Yve};function RU(t){const{element:e,viewportId:r}=t.detail,n=Jve(r);Zve(e),Qve(n,e),k4.addViewportElement(r,e),$k.enable(e),lV.enable(e),aV.enable(e),fh.enable(e),QF.enable(e),rU.enable(e),wU.enable(e),CU.enable(e),MU.enable(e),hU.enable(e),vU.enable(e),bU.enable(e),ze.enabledElements.push(e)}function Jve(t){const e="http://www.w3.org/2000/svg",r=document.createElementNS(e,"svg"),n=`svg-layer-${t}`;r.classList.add("svg-layer"),r.setAttribute("id",n),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.style.width="100%",r.style.height="100%",r.style.pointerEvents="none",r.style.position="absolute";const i=document.createElementNS(e,"defs"),o=document.createElementNS(e,"filter"),a=document.createElementNS(e,"feOffset"),s=document.createElementNS(e,"feColorMatrix"),c=document.createElementNS(e,"feBlend");return o.setAttribute("id",`shadow-${n}`),o.setAttribute("filterUnits","userSpaceOnUse"),a.setAttribute("result","offOut"),a.setAttribute("in","SourceGraphic"),a.setAttribute("dx","0.5"),a.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),o.appendChild(a),o.appendChild(s),o.appendChild(c),i.appendChild(o),r.appendChild(i),r}function Zve(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;ze.svgNodeCache[n]={}}function Qve(t,e){e.querySelector("div.viewport-element").appendChild(t)}function PU(t,e){const r=[];if(!e&&!t)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let n=0;n<ze.synchronizers.length;n++){const i=ze.synchronizers[n],o=!i.isDisabled(),a=i.hasSourceViewport(e,t),s=i.hasTargetViewport(e,t);o&&(a||s)&&r.push(i)}return r}const eye="viewport-element";function LU(t){const{element:e,viewportId:r}=t.detail;rye(e),iye(e),k4.removeViewportElement(r,e),$k.disable(e),lV.disable(e),aV.disable(e),fh.disable(e),QF.disable(e),rU.disable(e),wU.disable(e),CU.disable(e),MU.disable(e),hU.disable(e),vU.disable(e),bU.disable(e),tye(e),nye(e),oye(e)}const tye=t=>{const e=we(t);PU(e.viewportId,e.renderingEngineId).forEach(n=>{n.remove(e)})},nye=t=>{const{renderingEngineId:e,viewportId:r}=we(t),n=or(r,e);n&&n.removeViewports(e,r)};function rye(t){const{viewportUid:e,renderingEngineUid:r}=t.dataset,n=`${e}:${r}`;delete ze.svgNodeCache[n]}function iye(t){const e=t.querySelector(`div.${eye}`),r=e.querySelector("svg");r&&e.removeChild(r)}const oye=function(t){const e=ze.enabledElements.findIndex(r=>r===t);e>-1&&ze.enabledElements.splice(e,1)};function aye(t){const e=ZV(t,[wn.Active,wn.Passive]),r=_1(t,e);for(const{tool:n}of r){const i=n.cancel(t);if(i)return i}}class AU{constructor(e,r,n,i){this._viewportOptions={},this._onEvent=o=>{var l;if(this._ignoreFiredEvents===!0||!this._targetViewports.length)return;const a=this._eventSource==="element"?we(o.currentTarget):An((l=o.detail)==null?void 0:l.viewportId);if(!a)return;const{renderingEngineId:s,viewportId:c}=a;this._sourceViewports.find(f=>f.viewportId===c)&&this.fireEvent({renderingEngineId:s,viewportId:c},o)},this._enabled=!0,this._eventName=r,this._eventHandler=n,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=i||{},this._eventSource=this._options.eventSource||"element",this._auxiliaryEvents=this._options.auxiliaryEvents||[],this.id=e}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(e,r={}){this._viewportOptions[e]=r}setEnabled(e){this._enabled=e}getOptions(e){return this._viewportOptions[e]}add(e){this.addTarget(e),this.addSource(e)}addSource(e){if(Am(this._sourceViewports,e))return;const{renderingEngineId:r,viewportId:n}=e,i=fr(r).getViewport(n);if(!i){console.warn(`Synchronizer.addSource: No viewport for ${r} ${n}`);return}(this._eventSource==="element"?i.element:We).addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEvents.forEach(({name:a,source:s})=>{(s==="element"?i.element:We).addEventListener(a,this._onEvent.bind(this))}),this._updateDisableHandlers(),this._sourceViewports.push(e)}addTarget(e){Am(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach(e=>this.removeSource(e)),this._targetViewports.forEach(e=>this.removeTarget(e))}remove(e){this.removeTarget(e),this.removeSource(e)}removeSource(e){const r=ib(this._sourceViewports,e);if(r===-1)return;const n=this._eventSource==="element"?this.getViewportElement(e):We;this._sourceViewports.splice(r,1),n.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEvents.forEach(({name:i,source:o})=>{(o==="element"?this.getViewportElement(e):We).removeEventListener(i,this._eventHandler)}),this._updateDisableHandlers()}removeTarget(e){const r=ib(this._targetViewports,e);r!==-1&&(this._targetViewports.splice(r,1),this._updateDisableHandlers())}hasSourceViewport(e,r){return Am(this._sourceViewports,{renderingEngineId:e,viewportId:r})}hasTargetViewport(e,r){return Am(this._targetViewports,{renderingEngineId:e,viewportId:r})}fireEvent(e,r){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const n=[];try{for(let i=0;i<this._targetViewports.length;i++){const o=this._targetViewports[i];if(e.viewportId===o.viewportId)continue;const s=this._eventHandler(this,e,o,r,this._options);s instanceof Promise&&n.push(s)}}catch(i){console.warn(`Synchronizer, for: ${this._eventName}`,i)}finally{n.length?Promise.allSettled(n).then(()=>{this._ignoreFiredEvents=!1}):this._ignoreFiredEvents=!1}}_hasSourceElements(){return this._sourceViewports.length!==0}_updateDisableHandlers(){const e=sye(this._sourceViewports,this._targetViewports),r=this.remove.bind(this),n=i=>{r(i.detail.element)};e.forEach(i=>{const o=this.getEventSource(i);o&&(o.removeEventListener($e.ELEMENT_DISABLED,n),o.addEventListener($e.ELEMENT_DISABLED,n))})}getEventSource(e){return this._eventSource==="element"?this.getViewportElement(e):We}getViewportElement(e){const{renderingEngineId:r,viewportId:n}=e,i=fr(r);if(!i)return null;const o=i.getViewport(n);return o?o.element:null}}function sye(t,e){const r=[],n=t.concat(e);for(let i=0;i<n.length;i++){const o=n[i];r.some(a=>o.renderingEngineId===a.renderingEngineId&&o.viewportId===a.viewportId)||r.push(o)}return r}function ib(t,e){return t.findIndex(r=>e.renderingEngineId===r.renderingEngineId&&e.viewportId===r.viewportId)}function Am(t,e){return t.some(r=>r.renderingEngineId===e.renderingEngineId&&r.viewportId===e.viewportId)}function f0(t,e,r,n){if(ze.synchronizers.some(a=>a.id===t))throw new Error(`Synchronizer with id '${t}' already exists.`);const o=new AU(t,e,r,n);return ze.synchronizers.push(o),o}function cye(){for(;ze.synchronizers.length>0;)ze.synchronizers.pop().destroy()}function lye(t){return ze.synchronizers.find(e=>e.id===t)}function uye(){return ze.synchronizers}function fye(t){const e=ze.synchronizers.findIndex(r=>r.id===t);e>-1&&(ze.synchronizers[e].destroy(),ze.synchronizers.splice(e,1))}const dye=Object.freeze(Object.defineProperty({__proto__:null,createSynchronizer:f0,destroy:cye,destroySynchronizer:fye,getAllSynchronizers:uye,getSynchronizer:lye,getSynchronizersForViewport:PU},Symbol.toStringTag,{value:"Module"})),cy=function(t){const{viewportId:e}=t.detail;mh(e)};let XC=!1;function NU(t={}){XC||(gye(),pye(),XC=!0)}function hye(){kU(),VU(),Ok(),I0e();const t=ps(),e=Vn;t.restoreAnnotations({}),e.resetState(),XC=!1}function gye(){kU();const t=$e.ELEMENT_ENABLED,e=$e.ELEMENT_DISABLED;We.addEventListener(t,RU),We.addEventListener(e,LU),IU.enable()}function kU(){const t=$e.ELEMENT_ENABLED,e=$e.ELEMENT_DISABLED;We.removeEventListener(t,RU),We.removeEventListener(e,LU),IU.disable()}function pye(){VU(),We.addEventListener(U.ANNOTATION_COMPLETED,eU),We.addEventListener(U.ANNOTATION_MODIFIED,tU),We.addEventListener(U.ANNOTATION_SELECTION_CHANGE,sy),We.addEventListener(U.ANNOTATION_SELECTION_CHANGE,sy),We.addEventListener(U.ANNOTATION_REMOVED,lve),We.addEventListener(U.SEGMENTATION_MODIFIED,ZF),We.addEventListener(U.SEGMENTATION_DATA_MODIFIED,JF),We.addEventListener(U.SEGMENTATION_REPRESENTATION_MODIFIED,cy),We.addEventListener(U.SEGMENTATION_REPRESENTATION_ADDED,cy)}function VU(){We.removeEventListener(U.ANNOTATION_COMPLETED,eU),We.removeEventListener(U.ANNOTATION_MODIFIED,tU),We.removeEventListener(U.ANNOTATION_SELECTION_CHANGE,sy),We.removeEventListener(U.ANNOTATION_SELECTION_CHANGE,sy),We.removeEventListener(U.SEGMENTATION_MODIFIED,ZF),We.removeEventListener(U.SEGMENTATION_DATA_MODIFIED,JF),We.removeEventListener(U.SEGMENTATION_REPRESENTATION_MODIFIED,cy),We.removeEventListener(U.SEGMENTATION_REPRESENTATION_ADDED,cy)}const mye=Object.freeze(Object.defineProperty({__proto__:null,COLOR_LUT:ty},Symbol.toStringTag,{value:"Module"}));function vye(t,e,r,n){const{camera:i}=n.detail,o=fr(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId);a.setCamera(i),a.render()}const{CAMERA_MODIFIED:yye}=$e;function wye(t){return f0(t,yye,vye)}function xye(t,e,r,n,i){const o=fr(r.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const a=o.getViewport(r.viewportId),c=o.getViewport(e.viewportId).getViewPresentation(i);a.setViewPresentation(c),a.render()}const{CAMERA_MODIFIED:Cye}=$e;function Sye(t,e){return f0(t,Cye,xye,{viewPresentation:e})}function Tye(t,e,r,n,i){const o=n.detail,{volumeId:a,range:s,invertStateChanged:c,invert:l,colormap:f}=o,u=fr(r.renderingEngineId);if(!u)throw new Error(`Rendering Engine does not exist: ${r.renderingEngineId}`);const d=u.getViewport(r.viewportId),h={voiRange:s};if(i!=null&&i.syncInvertState&&c&&(h.invert=l),i!=null&&i.syncColormap&&f&&(h.colormap=f),d instanceof Xn)d._actors&&d._actors.size>1?d.setProperties(h,a):d.setProperties(h);else if(d instanceof Jn)d.setProperties(h);else throw new Error("Viewport type not supported.");d.render()}function _ye(t,e){return e=Object.assign({syncInvertState:!0,syncColormap:!0},e),f0(t,$e.VOI_MODIFIED,Tye,{auxiliaryEvents:[{name:$e.COLORMAP_MODIFIED}],...e})}function Eye(t,e,r){const n=fr(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=t.getOptions(r.viewportId),o=n.getViewport(r.viewportId),a=n.getViewport(e.viewportId);if((i==null?void 0:i.syncZoom)!==!1){const s=a.getZoom();o.setZoom(s)}if((i==null?void 0:i.syncPan)!==!1){const s=a.getPan();o.setPan(s)}o.render()}const{CAMERA_MODIFIED:Dye}=$e;function bye(t){return f0(t,Dye,Eye)}function Iye(t,e){const{viewPlaneNormal:r}=t.getCamera(),{viewPlaneNormal:n}=e.getCamera(),i=gt(r,n);return Math.abs(i)>.9}const ob=(t,e)=>xp.get("spatialRegistrationModule",t,e);async function Oye(t,e,r){const n=fr(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(e.viewportId),o=t.getOptions(r.viewportId);if(o!=null&&o.disabled)return;const a=n.getViewport(r.viewportId),s=i.getCurrentImageId(),l=dt("imagePlaneModule",s).imagePositionPatient,f=a.getImageIds();if(!Iye(i,a))return;let u=ob(r.viewportId,e.viewportId);if(!u){const p=i.getFrameOfReferenceUID(),v=a.getFrameOfReferenceUID();if(p===v&&(o==null?void 0:o.useInitialPosition)!==!1?u=yt(ba()):(jA(i,a),u=ob(r.viewportId,e.viewportId)),!u)return}const d=Pt(Ae(),l,u),h=Mye(d,f);let g=h.index;a instanceof Rn&&(g=f.length-h.index-1),h.index!==-1&&a.getCurrentImageIdIndex()!==h.index&&await V_(a.element,{imageIndex:g})}function Mye(t,e){return e.reduce((r,n,i)=>{const{imagePositionPatient:o}=dt("imagePlaneModule",n),a=li(o,t);return a<r.distance?{distance:a,index:i}:r},{distance:1/0,index:-1})}const{STACK_NEW_IMAGE:Rye,VOLUME_NEW_IMAGE:wTe}=$e;function FU(t){return f0(t,Rye,Oye,{auxiliaryEvents:[{name:"VOLUME_NEW_IMAGE"}]})}function Pye(t,e,r){var s,c;const n=fr(r.renderingEngineId);if(!n)throw new Error(`No RenderingEngine for Id: ${r.renderingEngineId}`);const i=n.getViewport(r.viewportId),o=n.getViewport(e.viewportId),a=(s=o.getSlabThickness)==null?void 0:s.call(o);a&&((c=i.setSlabThickness)==null||c.call(i,a),i.render())}const{CAMERA_MODIFIED:Lye}=$e;function Aye(t){return f0(t,Lye,Pye)}const Nye=FU,kye=Object.freeze(Object.defineProperty({__proto__:null,createCameraPositionSynchronizer:wye,createImageSliceSynchronizer:FU,createPresentationViewSynchronizer:Sye,createSlabThicknessSynchronizer:Aye,createStackImageSynchronizer:Nye,createVOISynchronizer:_ye,createZoomPanSynchronizer:bye},Symbol.toStringTag,{value:"Module"}));function Vye(t,e,r=5){const n=we(t);if(!n)throw new Error("getAnnotationNearPoint: enabledElement not found");return UU(n,e,r)}function UU(t,e,r){const{renderingEngineId:n,viewportId:i}=t,o=or(i,n);if(!o)return null;const{_toolInstances:a}=o;for(const s in a){const c=Fye(a[s],t,e,r);if(c)return c}return null}function Fye(t,e,r,n){var s,c;const{viewport:i}=e,o=sn(t.constructor.toolName,i==null?void 0:i.element),a=(s=i==null?void 0:i.getCurrentImageId)==null?void 0:s.call(i);if(o!=null&&o.length){const{element:l}=e.viewport;for(const f of o){const u=(c=f.metadata)==null?void 0:c.referencedImageId;if(!(a&&u&&a!==u||!t.isPointNearTool)&&(t.isPointNearTool(l,f,r,n,"")||t.getHandleNearImagePoint(l,f,r,n)))return f}}return null}const{calibratedPixelSpacingMetadataProvider:Uye}=cn;function Bye(t,e,r){typeof r=="number"&&(r={type:av.USER,scale:r}),Uye.add(t,r),e.getStackViewports().forEach(i=>{i.getImageIds().includes(t)&&i.calibrateSpacing(t)})}function BU(t,e){const r=t.findIndex(([n,i])=>n===i);if(r===-1)throw new Error("3D bounding boxes not supported in an oblique plane");return t[r][0]-=e,t[r][1]+=e,t}const Gye=Object.freeze(Object.defineProperty({__proto__:null,extend2DBoundingBoxInViewAxis:BU,getBoundingBoxAroundShape:mu,getBoundingBoxAroundShapeIJK:mu,getBoundingBoxAroundShapeWorld:gV},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:v3}=cn;function GU(t,e,r){const[n,i]=t,o=xt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=li(n,i)/2,{boundsIJK:s,topLeftWorld:c,bottomRightWorld:l}=zye(e,r,t,o,a);return{boundsIJK:s,centerWorld:o,radiusWorld:a,topLeftWorld:c,bottomRightWorld:l}}function WU(t,e){const r=e.getDirection(),n=xt(r[0],r[1],r[2]),i=xt(r[3],r[4],r[5]),o=xt(r[6],r[7],r[8]),a=is(Ae(),o);return GU(t,e,{row:n,column:i,normal:a})}function Wye(t,e,r){if(!r)throw new Error("viewport is required in order to calculate the sphere bounds");const n=r.getCamera(),i=xt(n.viewUp[0],n.viewUp[1],n.viewUp[2]),o=xt(n.viewPlaneNormal[0],n.viewPlaneNormal[1],n.viewPlaneNormal[2]),a=Ae();xn(a,i,o);const s={row:a,normal:o,column:is(Ae(),i)};return GU(t,e,s)}function zye(t,e,r,n,i){const o=t.getDimensions(),{row:a,column:s,normal:c}=e,l=Ae(),f=Ae();Xt(l,n,c,i),Xt(f,n,c,-i),Xt(l,l,s,-i),Xt(f,f,s,i),Xt(l,l,a,-i),Xt(f,f,a,i);const u=v3(t,l),d=v3(t,f),h=r.map(p=>v3(t,p));return{boundsIJK:mu([u,d,...h],o),topLeftWorld:l,bottomRightWorld:f}}const y8=class y8{static imageIdToFrames(e){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const n=r[2].split("-").map(i=>Number(i));return n.length===1?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,r){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const i=this.framesToString(r);return e.replace(this.frameRangeExtractor,`${n[1]}${i}`)}static setFrameRange(e,r,n){const{referencedImageId:i}=e.metadata;e.metadata.referencedImageId=this.framesToImageId(i,r);const o={...n,annotation:e};Qe(We,U.ANNOTATION_MODIFIED,o)}static getFrameRange(e){return this.imageIdToFrames(e.metadata.referencedImageId)}};y8.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let YC=y8;function $ye(t,e){const{viewPlaneNormal:r}=t.metadata,{viewPlaneNormal:n}=e.metadata,i=gt(r,n);if(!du(1,Math.abs(i)))return!1;const{polyline:a}=t.data.contour,{polyline:s}=e.data.contour,c=gt(r,a[0]),l=gt(r,s[0]);return du(c,l)}function zU(t,e,r){let n=-1;if(e.forEach((i,o)=>{n>=0||i.a==t.b&&(n=o)}),n>=0){const i=e[n];return e.splice(n,1),r.push(i.b),r[0]==i.b?{remainingLines:e,contourPoints:r,type:"CLOSED_PLANAR"}:zU(i,e,r)}return{remainingLines:e,contourPoints:r,type:"OPEN_PLANAR"}}function H4(t){if(t.length==0)return[];const e=[],r=t.shift();e.push(r.a),e.push(r.b);const n=zU(r,t,e);if(n.remainingLines.length==0)return[{type:n.type,contourPoints:n.contourPoints}];{const i=H4(n.remainingLines);return i.push({type:n.type,contourPoints:n.contourPoints}),i}}function $U(t){return H4(t)}const jye={findContours:H4,findContoursFromReducedSet:$U};function jU(t,e=!1){const r=t.getPoints(),n=t.getLines(),i=new Array(r.getNumberOfPoints()).fill(0).map((c,l)=>r.getPoint(l).slice()),o=new Array(n.getNumberOfCells()).fill(0).map((c,l)=>{const f=n.getCell(l*3).slice();return{a:f[0],b:f[1]}});if(e)return{points:i,lines:o};const a=[];for(const[c,l]of i.entries()){const f=a.findIndex(u=>u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]);if(f>=0)o.map(u=>(u.a===c&&(u.a=f),u.b===c&&(u.b=f),u));else{const u=a.length;a.push(l),o.map(d=>(d.a===c&&(d.a=u),d.b===c&&(d.b=u),d))}}const s=o.filter(c=>c.a!==c.b);return{points:a,lines:s}}const Hye=(t,e)=>{const r=t[0],n=t[1];let i=!1;for(let o=0,a=e.length-1;o<e.length;a=o++){const s=e[o][0],c=e[o][1],l=e[a][0],f=e[a][1];c>n!=f>n&&r<(l-s)*(n-c)/(f-c)+s&&(i=!i)}return i};function Kye(t,e,r){const n=[];t.contourPoints.forEach(o=>{n.push([r[o][0],r[o][1]])});let i=0;return e.contourPoints.forEach(o=>{Hye([r[o][0],r[o][1]],n)||i++}),i===0}function qye(t,e,r=!0){const n=t.filter(s=>s.type!=="CLOSED_PLANAR"),i=t.filter(s=>s.type==="CLOSED_PLANAR"),o=[];let a=[];return i.forEach((s,c)=>{const l=[];i.forEach((f,u)=>{c!=u&&Kye(s,f,e)&&l.push(u)}),l.length>0?o.push({contour:s,holes:l}):a.push(c)}),r&&(o.forEach(s=>{s.contour.type="CLOSEDPLANAR_XOR",n.push(s.contour),s.holes.forEach(c=>{i[c].type="CLOSEDPLANAR_XOR",n.push(i[c]),a=a.filter(l=>l!==c)})}),a.forEach(s=>{n.push(i[s])})),n}const Xye={processContourHoles:qye};class Yye{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,r){return this.oriented||e<r?.5*(e*r)*(e*r+1)+r:.5*(r*e)*(r*e+1)+e}insertUniqueEdge(e,r,n){const i=this.computeEdgeKey(e,r);let o=this.edgeMap.get(i);return o||(o={key:i,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(i,o)),o}insertEdge(e,r,n){const i=this.computeEdgeKey(e,r),o={key:i,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(i,o),o}isInsertedEdge(e,r){const n=this.computeEdgeKey(e,r);return this.edgeMap.get(n)}static getEdgePointIds(e){const r=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(r+1)*r,i=r-n;return[n,i]}}function Jye(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Yye(t.oriented)}var Zye={newInstance:Jye};const Qye=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],e5e=[[0,1],[1,3],[2,3],[0,2]];function t5e(t){return Qye[t]}function n5e(t){return e5e[t]}var ab={getCase:t5e,getEdge:n5e};const{vtkErrorMacro:sb,vtkDebugMacro:r5e}=K;function i5e(t,e){function r(){let s=0,c=1;return e.slicingMode===1?(s=0,c=2):e.slicingMode===0&&(s=1,c=2),[s,c]}e.classHierarchy.push("vtkImageMarchingSquares"),t.getContourValues=()=>e.contourValues,t.setContourValues=s=>{e.contourValues=s,t.modified()};const n=[],i=[],o=[],a=Zye.newInstance();t.getPixelScalars=(s,c,l,f,u,d)=>{const[h,g,p]=s;n[0]=p*c[1]*c[0]+g*c[0]+h,n[1]=n[0]+f[u],n[2]=n[0]+f[d],n[3]=n[2]+f[u];for(let v=0;v<4;++v)i[v]=l[n[v]]},t.getPixelPoints=(s,c,l,f,u)=>{const d=s[f],h=s[u];o[0]=c[f]+d*l[f],o[1]=c[u]+h*l[u],o[2]=o[0]+l[f],o[3]=o[1],o[4]=o[0],o[5]=o[1]+l[u],o[6]=o[2],o[7]=o[5]},t.produceLines=(s,c,l,f,u,d,h,g,p,v,w)=>{var E;const m=c[e.slicingMode],y=[1,2,8,4],x=[];let C;t.getPixelScalars(c,l,d,p,v,w);let S=0;for(let D=0;D<4;D++)i[D]>=s&&(S|=y[D]);const T=ab.getCase(S);if(T[0]<0)return;t.getPixelPoints(c,f,u,v,w);const _=f[e.slicingMode]+m*u[e.slicingMode];for(let D=0;T[D]>=0;D+=2){g.push(2);for(let b=0;b<2;b++){const I=ab.getEdge(T[D+b]);if(C=void 0,e.mergePoints&&(C=(E=a.isInsertedEdge(n[I[0]],n[I[1]]))==null?void 0:E.value),C===void 0){const R=(s-i[I[0]])/(i[I[1]]-i[I[0]]),M=o.slice(I[0]*2,(I[0]+1)*2),P=o.slice(I[1]*2,(I[1]+1)*2);x[v]=M[0]+R*(P[0]-M[0]),x[w]=M[1]+R*(P[1]-M[1]),x[e.slicingMode]=_,C=h.length/3,h.push(x[0],x[1],x[2]),e.mergePoints&&a.insertEdge(n[I[0]],n[I[1]],C)}g.push(C)}}},t.requestData=(s,c)=>{const l=s[0];if(!l){sb("Invalid or missing input");return}if(e.slicingMode==null||e.slicingMode<0||e.slicingMode>2){sb("Invalid or missing slicing mode");return}console.time("msquares");const f=l.getOrigin(),u=l.getSpacing(),d=l.getDimensions(),h=l.getExtent(),g=l.computeIncrements(h),p=l.getPointData().getScalars().getData(),[v,w]=r(),m=[],y=[];let x=Math.round(e.slice);x>=d[e.slicingMode]&&(x=0);const C=[0,0,0];C[e.slicingMode]=x;for(let T=0;T<e.contourValues.length;++T){for(let _=0;_<d[w]-1;++_){C[w]=_;for(let E=0;E<d[v]-1;++E)C[v]=E,t.produceLines(e.contourValues[T],C,d,f,u,p,m,y,g,v,w)}a.initialize()}const S=Qr.newInstance();S.getPoints().setData(new Float32Array(m),3),S.getLines().setData(new Uint32Array(y)),c[0]=S,r5e("Produced output"),console.timeEnd("msquares")}}const o5e={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function HU(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,o5e,r),K.obj(t,e),K.algo(t,e,1,1),K.setGet(t,e,["slicingMode","slice","mergePoints"]),K.algo(t,e,1,1),i5e(t,e)}const a5e=K.newInstance(HU,"vtkImageMarchingSquares");var s5e={newInstance:a5e,extend:HU};const{Labelmap:c5e}=ht;function KU({segmentations:t}){var d;const{representationData:e,segments:r=[0,1]}=t,{volumeId:n}=e[c5e],i=ke.getVolume(n);if(!i){console.warn(`No volume found for ${n}`);return}const a=i.voxelManager.getCompleteScalarDataArray(),s=i.dimensions[2],c=i.dimensions[0]*i.dimensions[1];for(let h=0;h<s;h++)for(let g=0;g<i.dimensions[1];g++){const p=g*i.dimensions[0]+h*c;a[p]=0,a[p+i.dimensions[0]-1]=0}const l=[],{FrameOfReferenceUID:f}=i.metadata,u=r.length;for(let h=0;h<u;h++){const g=r[h];if(!g)continue;const p=[],v=Lt.newInstance({name:"Scalars",numberOfComponents:1,size:c*s,dataType:"Uint8Array"}),{containedSegmentIndices:w}=g;for(let x=0;x<s;x++){if(l5e(x,a,c,h))continue;const C=x*c;try{for(let b=0;b<c;b++){const I=a[b+C];I===h||w!=null&&w.has(I)?v.setValue(b+C,1):v.setValue(b,0)}const S=s5e.newInstance({slice:x}),T=eh.newInstance();T.shallowCopy(i.imageData),T.getPointData().setScalars(v),S.setInputData(T);const _=[1];S.setContourValues(_),S.setMergePoints(!1);const E=S.getOutputData(),D=jU(E);if((d=D.points)!=null&&d.length){const b=$U(D.lines);p.push({contours:b,polyData:D,FrameNumber:x+1,sliceIndex:x,FrameOfReferenceUID:f})}}catch(S){console.warn(x),console.warn(S)}}const m={FrameOfReferenceUID:f},y={label:g.label,color:g.color,metadata:m,sliceContours:p};l.push(y)}return l}function l5e(t,e,r,n){const i=t*r,o=i+r;for(let a=i;a<o;a++)if(e[a]===n)return!1;return!0}class qU{constructor(){}static getContourSequence(e,r){const{data:n}=e,{projectionPoints:i,projectionPointsImageIds:o}=n.cachedStats;return i.map((a,s)=>{const c=u5e(a),l=f5e(o[s],r);return{NumberOfContourPoints:c.length/3,ContourImageSequence:l,ContourGeometricType:"CLOSED_PLANAR",ContourData:c}})}}qU.toolName="RectangleROIStartEndThreshold";function u5e(t){return[...t[0],...t[1],...t[3],...t[2]].flat().map(i=>i.toFixed(2))}function f5e(t,e){const r=e.get("sopCommonModule",t);return{ReferencedSOPClassUID:r.sopClassUID,ReferencedSOPInstanceUID:r.sopInstanceUID}}function d5e(t){if(!(t!=null&&t.data))throw new Error("Tool data is empty");if(!t.metadata||t.metadata.referencedImageId)throw new Error("Tool data is not associated with any imageId")}const zg=class zg{constructor(){}static convert(e,r,n){d5e(e);const{toolName:i}=e.metadata,o=zg.TOOL_NAMES[i];if(!o)throw new Error(`Unknown tool type: ${i}, cannot convert to RTSSReport`);const a=o.getContourSequence(e,n),s=[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)];return{ReferencedROINumber:r+1,ROIDisplayColor:s,ContourSequence:a}}static register(e){zg.TOOL_NAMES[e.toolName]=e}};zg.TOOL_NAMES={};let ly=zg;ly.register(qU);function h5e(t,e){Ws.acceptAutoGenerated(t,e)}const{isEqual:g5e}=cn;function JC(t,e){const{polyline:r}=t.data.contour,{points:n}=t.data.handles,{length:i}=n;if(e===i)return r.length;if(e<0&&(e=(e+i)%i),e===0)return 0;const o=n[e],a=r.findIndex(c=>g5e(o,c));if(a!==-1)return a;let s=1/0;return r.reduce((c,l,f)=>{const u=EM(l,o);return u<s?(s=u,f):c},-1)}const p5e=Object.freeze(Object.defineProperty({__proto__:null,AnnotationToPointData:ly,acceptAutogeneratedInterpolations:h5e,areCoplanarContours:$ye,calculatePerimeter:KC,contourFinder:jye,detectContourHoles:Xye,findHandlePolylineIndex:JC,generateContourSetsFromLabelmap:KU,getContourHolesDataCanvas:C1,getContourHolesDataWorld:rF,getDeduplicatedVTKPolyDataPoints:jU,updateContourPolyline:Jc},Symbol.toStringTag,{value:"Module"}));function XU(t,e,r){const{imageData:n}=t,{overwrite:i,boundsIJK:o}=r,a=(r==null?void 0:r.overlapType)||0,s=t.voxelManager,c=t.voxelManager.getScalarDataLength();if(i)for(let m=0;m<c;m++)s.setAtIndex(m,0);const{baseVolumeIdx:l,volumeInfoList:f}=pV(t,e);let u,d,h;const g=(m,y,x)=>{const C=({value:R})=>{d=d+1,R>=h.lower&&R<=h.upper&&(u=u+1)},{imageData:S,dimensions:T,lower:_,upper:E}=m,D=m4(S,T,y,x);d=0,u=0,h={lower:_,upper:E};let b=!1;const{voxelManager:I}=S.get("voxelManager");return I.forEach(C,{imageData:S,boundsIJK:D}),a===0?b=u>0:a==1&&(b=u===d),b},p=(m,y)=>{const{imageData:x,lower:C,upper:S}=m,T=x.get("voxelManager").voxelManager,_=T.toIndex(y),E=T.getAtIndex(_);return!(E<=C||E>=S)},v=({index:m,pointIJK:y,pointLPS:x})=>{let C=f.length>0;for(let S=0;S<f.length&&(f[S].volumeSize===c?C=p(f[S],y):C=g(f[S],f[l].spacing,x),!!C);S++);C&&s.setAtIndex(m,r.segmentIndex||1)};return t.voxelManager.forEach(v,{imageData:n,boundsIJK:o}),Ai(t.volumeId),t}const{transformWorldToIndex:cb}=cn,wy=class wy extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,getTextLines:m5e,statsCalculator:wa}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{points:[[...s],[...s],[...s],[...s]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=c.worldToCanvas(f[0]),d=c.worldToCanvas(f[3]),h=this._getRectangleImageCoordinates([u,d]),g=[o[0],o[1]],{left:p,top:v,width:w,height:m}=h;return M4([p,v,w,m],g)<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Tt(a),we(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;o.worldPosition?l=!0:f=c.handles.points.findIndex(d=>d===o);const u=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),Tt(s),we(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),this.doneEditMemo(),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a))},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world,{points:g}=u.handles;g.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=we(o),{worldToCanvas:g,canvasToWorld:p}=h.viewport,v=d.world,{points:w}=u.handles;w[c]=[...v];let m,y,x,C,S,T,_,E;switch(c){case 0:case 3:m=g(w[0]),C=g(w[3]),y=[C[0],m[1]],x=[m[0],C[1]],T=p(y),_=p(x),w[1]=T,w[2]=_;break;case 1:case 2:y=g(w[1]),x=g(w[2]),m=[x[0],y[1]],C=[y[0],x[1]],S=p(m),E=p(C),w[0]=S,w[3]=E;break}a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles,m=v.map(N=>a.worldToCanvas(N));u.annotationUID=g;const{color:y,lineWidth:x,lineDash:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),{viewPlaneNormal:S,viewUp:T}=a.getCamera();if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,S,T,f,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,S,T,f,n),a instanceof Rn)){const{referencedImageId:N}=h.metadata;for(const H in p.cachedStats)H.startsWith("imageId")&&f.getStackViewports().find(de=>{const ue=wr(N),me=de.hasImageURI(ue),Ee=wr(de.getCurrentImageId());return me&&Ee!==ue})&&delete p.cachedStats[H]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let _;if(!ti(g))continue;!jr(g)&&!this.editData&&w!==null&&(_=[m[w]]),_&&Kn(i,g,"0",_,{color:y});const E=`${g}-rect`;N4(i,g,"0",m,{color:y,lineDash:C,lineWidth:x},E),o=!0;const b=this.getLinkedTextBoxStyle(u,h);if(!b.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const I=this.configuration.getTextLines(p,l);if(!I||I.length===0)continue;if(!p.handles.textBox.hasMoved){const N=Jo(m);p.handles.textBox.worldPosition=a.canvasToWorld(N)}const R=a.worldToCanvas(p.handles.textBox.worldPosition),P=to(i,g,"1",I,R,m,{},b),{x:k,y:z,width:A,height:L}=P;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([k,z]),topRight:a.canvasToWorld([k+A,z]),bottomLeft:a.canvasToWorld([k,z+L]),bottomRight:a.canvasToWorld([k+A,z+L])}}return o},this._getRectangleImageCoordinates=n=>{const[i,o]=n;return{left:Math.min(i[0],o[0]),top:Math.min(i[1],o[1]),width:Math.abs(i[0]-o[0]),height:Math.abs(i[1]-o[1])}},this._calculateCachedStats=(n,i,o,a,s)=>{var p,v,w;const{data:c}=n,{viewport:l}=s,{element:f}=l,u=c.handles.points[0],d=c.handles.points[3],{cachedStats:h}=c,g=Object.keys(h);for(let m=0;m<g.length;m++){const y=g[m],x=this.getTargetImageData(y);if(!x)continue;const{dimensions:C,imageData:S,metadata:T,voxelManager:_}=x,E=cb(S,u);E[0]=Math.floor(E[0]),E[1]=Math.floor(E[1]),E[2]=Math.floor(E[2]);const D=cb(S,d);if(D[0]=Math.floor(D[0]),D[1]=Math.floor(D[1]),D[2]=Math.floor(D[2]),this._isInsideVolume(E,D,C)){this.isHandleOutsideImage=!1;const b=Math.min(E[0],D[0]),I=Math.max(E[0],D[0]),R=Math.min(E[1],D[1]),M=Math.max(E[1],D[1]),P=Math.min(E[2],D[2]),k=Math.max(E[2],D[2]),z=[[b,I],[R,M],[P,k]],{worldWidth:A,worldHeight:L}=k5(i,o,u,d),N=[E,D],{scale:H,areaUnit:ee}=Ko(x,N),oe=Math.abs(A*L)/(H*H),de={isPreScaled:ec(l,y),isSuvScaled:this.isSuvScaled(l,y,n.metadata.referencedImageId)},ue=Eu(T.Modality,n.metadata.referencedImageId,de),me=_.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:z,imageData:S,returnPoints:this.configuration.storePointData}),Ee=this.configuration.statsCalculator.getStatistics();h[y]={Modality:T.Modality,area:oe,mean:(p=Ee.mean)==null?void 0:p.value,stdDev:(v=Ee.stdDev)==null?void 0:v.value,max:(w=Ee.max)==null?void 0:w.value,statsArray:Ee.array,pointsInShape:me,areaUnit:ee,modalityUnit:ue}}else this.isHandleOutsideImage=!0,h[y]={Modality:T.Modality}}return n.invalidated=!1,qn(n,f),h},this._isInsideVolume=(n,i,o)=>ur(n,o)&&ur(i,o),this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}};wy.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new wy,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])};let zd=wy;function m5e(t,e){const r=t.cachedStats[e],{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Kt(n)} ${s}`),l.push(`Mean: ${Kt(i)} ${c}`),l.push(`Max: ${Kt(o)} ${c}`),l.push(`Std Dev: ${Kt(a)} ${c}`),l}zd.toolName="RectangleROI";const{transformWorldToIndex:$h}=cn;class K4 extends zd{constructor(e={},r={configuration:{storePointData:!1,numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:v5e,statsCalculator:wa,showTextBox:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u;let g,p,v;if(l instanceof Jn)throw new Error("Stack Viewport Not implemented");{const T=this.getTargetId(l);v=Zs(T),p=ke.getVolume(v),g=$c(p,s,d)}const w=Su(p,d),m=this._getStartCoordinate(s,d),y=this._getEndCoordinate(s,w,d),x=l.getFrameOfReferenceUID(),C={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:x,referencedImageId:g,toolName:this.getToolName(),volumeId:v,spacingInNormal:w},data:{label:"",startCoordinate:m,endCoordinate:y,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[g],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(C,p),Zt(C,a);const S=pt(a,this.getToolName());return this.editData={annotation:C,viewportIdsToRender:S,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(S),C},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o);const u=we(o);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID);const d=this.getTargetId(u.viewport),h=ke.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(a,d,h,u),Me(s),c&&Bn(a)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=sn(this.getToolName(),a.element);if(!(s!=null&&s.length))return o;s=V5(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u,data:d,metadata:h}=f,{startCoordinate:g,endCoordinate:p}=d,{points:v,activeHandleIndex:w}=d.handles,m=v.map(A=>a.worldToCanvas(A));c.annotationUID=u;const y=this.getStyle("lineWidth",c,f),x=this.getStyle("lineDash",c,f),C=this.getStyle("color",c,f),S=a.getCamera().focalPoint,T=a.getCamera().viewPlaneNormal;let _=g,E=p;Array.isArray(g)&&(_=this._getCoordinateForViewplaneNormal(_,T),d.startCoordinate=_,d.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(T)]=_,d.startCoordinate=_,d.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(T)]=_),Array.isArray(p)&&(E=this._getCoordinateForViewplaneNormal(E,T),d.endCoordinate=E,d.endCoordinate=E);const D=Kl(_),b=Kl(E),I=this._getCoordinateForViewplaneNormal(S,T),R=Kl(I);if(R<Math.min(D,b)||R>Math.max(D,b))continue;f.invalidated&&this._throttledCalculateCachedStats(f,n);let M=!1;if((R===D||R===b)&&(M=!0),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let P;if(!ti(u))continue;!jr(u)&&!this.editData&&w!==null&&M&&(P=[m[w]]),P&&Kn(i,u,"0",P,{color:C});let k=x;if(M||(k=2),x1(i,u,"0",m[0],m[3],{color:C,lineDash:k,lineWidth:y}),o=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const A=this.getLinkedTextBoxStyle(c,f);if(!A.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const L=this.configuration.getTextLines(d,{metadata:h});if(!L||L.length===0)continue;if(!d.handles.textBox.hasMoved){const Ee=Jo(m);d.handles.textBox.worldPosition=a.canvasToWorld(Ee)}const N=a.worldToCanvas(d.handles.textBox.worldPosition),ee=to(i,u,"1",L,N,m,{},A),{x:oe,y:de,width:ue,height:me}=ee;d.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([oe,de]),topRight:a.canvasToWorld([oe+ue,de]),bottomLeft:a.canvasToWorld([oe,de+me]),bottomRight:a.canvasToWorld([oe+ue,de+me])}}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{imageData:s}=r,{startCoordinate:c,endCoordinate:l}=n,{points:f}=n.handles,u=$h(s,f[0]),d=$h(s,f[0]),h=Ae();s.indexToWorldVec3(u,h);const g=Ae();s.indexToWorldVec3(d,g),this._getIndexOfCoordinatesForViewplaneNormal(o)==2?(h[2]=c,g[2]=l):this._getIndexOfCoordinatesForViewplaneNormal(o)==0?(h[0]=c,g[0]=l):this._getIndexOfCoordinatesForViewplaneNormal(o)==1&&(h[1]=c,g[1]=l);const p=li(h,g),v=[];for(let w=0;w<p;w+=a)v.push(f.map(m=>{const y=Ae();return Xt(y,m,o,w),Array.from(y)}));n.cachedStats.projectionPoints=v}_computePointsInsideVolume(e,r,n,i){var S,T,_;const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,f=o.cachedStats.projectionPoints,u=[[]],d=this.getTargetImageData(r),h=o.handles.points[0],g=o.handles.points[3],{worldWidth:p,worldHeight:v}=k5(s,c,h,g),w=Ko(d,o.habdles),m=Math.abs(p*v)/(w.scale*w.scale),y={isPreScaled:ec(l,r),isSuvScaled:this.isSuvScaled(l,r,e.metadata.referencedImageId)},x=Eu(a.Modality,e.metadata.referencedImageId,y);for(let E=0;E<f.length;E++){if(!n)continue;const D=f[E][0],{dimensions:b,imageData:I,voxelManager:R}=n,M=$h(I,h),P=$h(I,D),k=this._getIndexOfCoordinatesForViewplaneNormal(s);M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.floor(M[2]),M[k]=P[k];const z=$h(I,g);if(z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]),z[2]=Math.floor(z[2]),z[k]=P[k],this._isInsideVolume(M,z,b)){this.isHandleOutsideImage=!1;const A=Math.min(M[0],z[0]),L=Math.max(M[0],z[0]),N=Math.min(M[1],z[1]),H=Math.max(M[1],z[1]),ee=Math.min(M[2],z[2]),oe=Math.max(M[2],z[2]),de=[[A,L],[N,H],[ee,oe]],ue=R.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:de,imageData:I,returnPoints:this.configuration.storePointData});u.push(ue)}}const C=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:m,mean:(S=C.mean)==null?void 0:S.value,stdDev:(T=C.stdDev)==null?void 0:T.value,max:(_=C.max)==null?void 0:_.value,statsArray:C.array,areaUnit:w.areaUnit,modalityUnit:x}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=ke.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,a,s,r),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,a,s,r),e.invalidated=!1,qn(e,i.element),o}_getStartCoordinate(e,r){const n=e;return this._getCoordinateForViewplaneNormal(n,r)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Ae();return Xt(o,e,n,i*r),this._getCoordinateForViewplaneNormal(o,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function v5e(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Kt(n)} ${s}`),l.push(`Mean: ${Kt(i)} ${c}`),l.push(`Max: ${Kt(o)} ${c}`),l.push(`Std Dev: ${Kt(a)} ${c}`),l}K4.toolName="RectangleROIStartEndThreshold";class q4 extends zd{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getTargetId(l);let p,v;if(l instanceof Jn)p=g.split("imageId:")[1];else{v=Zs(g);const x=ke.getVolume(v);p=$c(x,s,d)}const w=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...d],enabledElement:c,viewUp:[...h],FrameOfReferenceUID:w,referencedImageId:p,toolName:this.getToolName(),volumeId:v},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},segmentationId:null}};Zt(m,a);const y=pt(a,this.getToolName());return this.editData={annotation:m,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(y),m},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{points:g,activeHandleIndex:p}=h.handles,v=g.map(S=>a.worldToCanvas(S));l.annotationUID=d;const w=this.getStyle("lineWidth",l,u),m=this.getStyle("lineDash",l,u),y=this.getStyle("color",l,u);if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;qn(u,s);let x;if(!ti(d))continue;!jr(d)&&!this.editData&&p!==null&&(x=[v[p]]),x&&Kn(i,d,"0",x,{color:y}),x1(i,d,"0",v[0],v[3],{color:y,lineDash:m,lineWidth:w}),o=!0}return o}}}q4.toolName="RectangleROIThreshold";function YU(t,e,r={}){const n=[];return t.forEach(o=>{var h,g;const{data:a}=o,{points:s}=a.handles,{imageData:c,dimensions:l}=e;let f=s;if((h=a.cachedStats)!=null&&h.projectionPoints){const{projectionPoints:p}=a.cachedStats;f=[].concat(...p)}const u=f.map(p=>yr(c,p));let d=mu(u,l);r.numSlicesToProject&&!((g=a.cachedStats)!=null&&g.projectionPoints)&&(d=BU(d,r.numSlicesToProject)),n.push(d)}),n.length===1?n[0]:n.reduce((o,a)=>({iMin:Math.min(o.iMin,a.iMin),jMin:Math.min(o.jMin,a.jMin),kMin:Math.min(o.kMin,a.kMin),iMax:Math.max(o.iMax,a.iMax),jMax:Math.max(o.jMax,a.jMax),kMax:Math.max(o.kMax,a.kMax)}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}function y5e(t,e,r,n){const i=t.map(s=>as.getAnnotation(s));w5e(i);let o;for(let s=0;s<r.length;s++)(r[s].volume.voxelManager.getScalarDataLength()===e.voxelManager.getScalarDataLength()||s===0)&&(o=YU(i,r[s].volume,n));const a=XU(e,r,{...n,boundsIJK:o});return a.modified(),a}function w5e(t){const e=[q4.toolName,K4.toolName];for(const r of t){const n=r.metadata.toolName;if(!e.includes(n))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}function x5e(t,e=1,r="mergedLabelmap"){t.forEach(({direction:c,dimensions:l,origin:f,spacing:u})=>{if(!At(l,t[0].dimensions)||!At(c,t[0].direction)||!At(u,t[0].spacing)||!At(f,t[0].origin))throw new Error("labelmaps must have the same size and shape")});const n=t[0],i=n.voxelManager.getConstructor(),o=new i(n.voxelManager.getScalarDataLength());t.forEach(c=>{const l=c.voxelManager,f=l.getScalarDataLength();for(let u=0;u<f;u++)l.getAtIndex(u)===e&&(o[u]=e)});const a={scalarData:o,metadata:n.metadata,spacing:n.spacing,origin:n.origin,direction:n.direction,dimensions:n.dimensions};return s1(r,a)}async function C5e(t){const{viewportId:e,renderingEngineId:r,options:n}=t;let{segmentationId:i}=t;const o=zr(e,r);if(!o)throw new Error("element disabled");const{viewport:a}=o;if(!(a instanceof Rn))throw new Error("Segmentation only supports VolumeViewport");const{uid:s}=a.getDefaultActor();if(i===void 0&&(i=`${s}-based-segmentation-${(n==null?void 0:n.volumeId)??Cn().slice(0,8)}`),n){const c=structuredClone(n);await s1(i,c)}else{const c=a.getVolumeId();s0(c,{volumeId:i})}return i}function JU(t,e,r={}){const n=r.onFlood,i=r.onBoundary,o=r.equals,a=r.filter,s=r.diagonals||!1,c=C(e),l=S(),f=[],u=[],d=new Set,h=r.bounds;for(f.push({currentArgs:e});f.length>0;)g(f.pop());return{flooded:u};function g(_){const E=_.currentArgs,D=_.previousArgs;p(E)||(v(E),w(E)?(m(E),x(E)):y(D))}function p(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));return d.has(I)}function v(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));d.add(I)}function w(_){const E=C(_);return o?o(E,c):E===c}function m(_){u.push(_),n&&n(..._)}function y(_){const[E,D,b=0]=_,I=E+32768+65536*(D+32768+65536*(b+32768));h==null||h.set(I,_),i&&i(..._)}function x(_){for(let E=0;E<l.length;E+=1){const D=l[E],b=_.slice(0);for(let I=0;I<_.length;I+=1)b[I]+=D[I];(a==null?void 0:a(b))!==!1&&(p(b)||f.push({currentArgs:b,previousArgs:_}))}}function C(_){return t(..._)}function S(){return T(e.length).filter(function(E){const D=S5e(E);return D!==0&&(D===1||s)})}function T(_){const E=[],D=function(b){return b.split("").map(function(I){return parseInt(I,10)-1})};for(let b=0;b<Math.pow(3,_);b+=1){const I=T5e(b.toString(3),"0",_);E.push(D(I))}return E}}function S5e(t){let e=0;for(let r=0;r<t.length;r+=1)t[r]!==0&&(e+=1);return e}function T5e(t,e,r){return(new Array(r+1).join(e)+t).slice(-r)}const _5e={[St.Initialize]:t=>{const{strategySpecificConfiguration:e}=t;if(!e)return;const{centerSegmentIndex:r}=e;r&&(t.segmentIndex=r.segmentIndex)},[St.OnInteractionStart]:t=>{const{segmentIndex:e,previewSegmentIndex:r,segmentationVoxelManager:n,centerIJK:i,strategySpecificConfiguration:o,viewPlaneNormal:a,segmentationImageData:s,preview:c}=t;if(!(o!=null&&o.useCenterSegmentIndex))return;delete o.centerSegmentIndex;let l=!1,f=!1;const u=[...n.getBoundsIJK()];Math.abs(a[0])>.8?u[0]=[i[0],i[0]]:Math.abs(a[1])>.8?u[1]=[i[1],i[1]]:Math.abs(a[2])>.8&&(u[2]=[i[2],i[2]]);const d=({value:g})=>{l||(l=g===e),f||(f=g===r)};if(n.forEach(d,{imageData:s,isInObject:t.isInObject,boundsIJK:u}),!l&&!f)return;let h=n.getAtIJKPoint(i);if(h===r)if(c)h=c.segmentIndex;else return;else f&&(h=null);t.segmentIndex=h,o.centerSegmentIndex={segmentIndex:h}}},E5e={[St.Initialize]:t=>{const{operationName:e,centerIJK:r,strategySpecificConfiguration:n,segmentationVoxelManager:i,imageVoxelManager:o,segmentIndex:a,viewport:s}=t,{THRESHOLD:c}=n;if(!(c!=null&&c.isDynamic)||!r||!a||e===St.RejectPreview||e===St.OnInteractionEnd)return;const l=i.getBoundsIJK(),{threshold:f,dynamicRadius:u=0}=c,d=f?0:u,{viewPlaneNormal:h}=s.getCamera(),g=l.map((m,y)=>{const[x,C]=m;return[Math.max(x,r[y]-d),Math.min(C,r[y]+d)]});Math.abs(h[0])>.8?g[0]=[r[0],r[0]]:Math.abs(h[1])>.8?g[1]=[r[1],r[1]]:Math.abs(h[2])>.8&&(g[2]=[r[2],r[2]]);const p=f||[1/0,-1/0],v=d*d,w=({value:m,pointIJK:y})=>{if(iC(r,y)>v)return;const C=Array.isArray(m)?Md(m):m;p[0]=Math.min(C,p[0]),p[1]=Math.max(C,p[1])};o.forEach(w,{boundsIJK:g}),t.strategySpecificConfiguration.THRESHOLD.threshold=p},[St.OnInteractionStart]:t=>{var n;const{strategySpecificConfiguration:e,preview:r}=t;!((n=e==null?void 0:e.THRESHOLD)!=null&&n.isDynamic)&&!r||(e.THRESHOLD.threshold=null)},[St.ComputeInnerCircleRadius]:t=>{const{configuration:e,viewport:r}=t,{THRESHOLD:{dynamicRadius:n=0}={}}=e.strategySpecificConfiguration||{};if(n===0)return;const i=r.getImageData();if(!i)return;const{spacing:o}=i,a=[r.element.clientWidth/2,r.element.clientHeight/2],s=n*o[0],l=r.canvasToWorld(a).map(g=>g+s),f=r.worldToCanvas(l),u=Math.abs(a[0]-f[0]),{strategySpecificConfiguration:d,activeStrategy:h}=e;d[h]||(d[h]={}),d[h].dynamicRadiusInCanvas=3+u}},D5e={[St.Initialize]:t=>{t.segmentIndex=0}},{isEqual:y3}=cn,lb={toIJK:t=>t,fromIJK:t=>t,type:"acquistion"},b5e={toIJK:([t,e,r])=>[r,t,e],fromIJK:([t,e,r])=>[e,r,t],type:"jk"},I5e={toIJK:([t,e,r])=>[t,r,e],fromIJK:([t,e,r])=>[t,r,e],type:"ik"};function ZU(t,e){if(!(t instanceof Xn))return{...lb,boundsIJKPrime:e};const{viewPlaneNormal:r}=t.getCamera(),n=y3(Math.abs(r[0]),1)&&b5e||y3(Math.abs(r[1]),1)&&I5e||y3(Math.abs(r[2]),1)&&lb;return n?{...n,boundsIJKPrime:n.fromIJK(e)}:{toIJK:null,boundsIJKPrime:null,fromIJK:null,error:`Only mappings orthogonal to acquisition plane are permitted, but requested ${r}`}}const{RLEVoxelMap:O5e,VoxelManager:M5e}=cn,R5e=65535;var Ei;(function(t){t[t.SEGMENT=-1]="SEGMENT",t[t.ISLAND=-2]="ISLAND",t[t.INTERIOR=-3]="INTERIOR",t[t.EXTERIOR=-4]="EXTERIOR",t[t.INTERIOR_SMALL=-5]="INTERIOR_SMALL",t[t.INTERIOR_TEST=-6]="INTERIOR_TEST"})(Ei||(Ei={}));class n0{constructor(e){this.fillInternalEdge=!1,this.maxInternalRemove=128,this.maxInternalRemove=(e==null?void 0:e.maxInternalRemove)??this.maxInternalRemove,this.fillInternalEdge=(e==null?void 0:e.fillInternalEdge)??this.fillInternalEdge}initialize(e,r,n){const i=!!r.sourceVoxelManager,o=i?r.sourceVoxelManager:r,a=i?r:M5e.createRLEHistoryVoxelManager(o),{segmentIndex:s=1,previewSegmentIndex:c=1}=n,l=n.points||a.getPoints();if(!(l!=null&&l.length))return;const f=a.getBoundsIJK().map((x,C)=>[Math.min(x[0],...l.map(S=>S[C])),Math.max(x[1],...l.map(S=>S[C]))]);if(f.find(x=>x[0]<0||x[1]>R5e))return;const{toIJK:u,fromIJK:d,boundsIJKPrime:h,error:g}=ZU(e,f);if(g){console.warn("Not performing island removal for planes not orthogonal to acquisition plane",g);return}const[p,v,w]=d(o.dimensions),m=new O5e(p,v,w),y=(x,C,S)=>{const T=o.toIndex(u([x,C,S])),_=o.getAtIndex(T);if(_===c||_===s)return Ei.SEGMENT};return m.fillFrom(y,h),m.normalizer={toIJK:u,fromIJK:d,boundsIJKPrime:h},this.segmentSet=m,this.previewVoxelManager=a,this.segmentIndex=s,this.previewSegmentIndex=c??s,this.selectedPoints=l,!0}floodFillSegmentIsland(){const{selectedPoints:e,segmentSet:r}=this;let n=0;const{fromIJK:i}=r.normalizer;return e.forEach(o=>{const a=i(o),s=r.toIndex(a),[c,l,f]=a;r.get(s)===Ei.SEGMENT&&(n+=r.floodFill(c,l,f,Ei.ISLAND))}),n}removeExternalIslands(){const{previewVoxelManager:e,segmentSet:r}=this,{toIJK:n}=r.normalizer,i=(o,a)=>{const[,s,c]=r.toIJK(o);if(a.value!==Ei.ISLAND)for(let l=a.start;l<a.end;l++){const f=n([l,s,c]),u=e.getAtIJKPoint(f);e.setAtIJKPoint(f,u===void 0?0:null)}};r.forEach(i,{rowModified:!0})}removeInternalIslands(){const{segmentSet:e,previewVoxelManager:r,previewSegmentIndex:n}=this,{height:i,normalizer:o,width:a}=e,{toIJK:s}=o;return e.forEachRow((c,l)=>{let f;for(const u of[...l])if(u.value===Ei.ISLAND){if(!f){if(this.fillInternalEdge&&u.start>0)for(let d=0;d<u.start;d++)e.set(c+d,Ei.INTERIOR);f=u;continue}for(let d=f.end;d<u.start;d++)e.set(c+d,Ei.INTERIOR);f=u}if(this.fillInternalEdge&&(f==null?void 0:f.end)<a)for(let u=f.end;u<a;u++)e.set(c+u,Ei.INTERIOR)}),e.forEach((c,l)=>{if(l.value!==Ei.INTERIOR)return;const[,f,u]=e.toIJK(c),d=f>0?e.getRun(f-1,u):null,h=f+1<i?e.getRun(f+1,u):null,g=f===i-1,p=f===0,v=n0.covers(l,d)||p&&this.fillInternalEdge,w=n0.covers(l,h)||g&&this.fillInternalEdge;l.end-l.start>2&&(!v||!w)&&e.floodFill(l.start,f,u,Ei.EXTERIOR,{singlePlane:!0})}),e.forEach((c,l)=>{if(l.value!==Ei.INTERIOR)return;const[,f,u]=e.toIJK(c),g=e.floodFill(l.start,f,u,Ei.INTERIOR_TEST)>this.maxInternalRemove?Ei.EXTERIOR:Ei.INTERIOR_SMALL;e.floodFill(l.start,f,u,g)}),e.forEach((c,l)=>{if(l.value===Ei.INTERIOR_SMALL)for(let f=l.start;f<l.end;f++){const u=s(e.toIJK(c+f));r.setAtIJKPoint(u,n)}}),r.getArrayOfModifiedSlices()}static covers(e,r){if(!r)return!1;let{start:n}=e;const{end:i}=e;for(const o of r)if(n>=o.start&&n<o.end&&(n=o.end,n>=i))return!0;return!1}}const P5e={[St.OnInteractionEnd]:t=>{const{strategySpecificConfiguration:e,previewSegmentIndex:r,segmentIndex:n,viewport:i,previewVoxelManager:o,segmentationVoxelManager:a}=t;if(!e.THRESHOLD||n===null)return;const s=new n0,c=o??a;if(!s.initialize(i,c,{previewSegmentIndex:r,segmentIndex:n}))return;s.floodFillSegmentIsland(),s.removeExternalIslands(),s.removeInternalIslands();const l=c.getArrayOfModifiedSlices();l&&Ai(t.segmentationId,l,r)}};function L5e(t,e,r,n,i=.4){return[Math.round(t+(255-t)*i),Math.round(e+(255-e)*i),Math.round(r+(255-r)*i),n]}const A5e={[St.Preview]:function(t){var o,a;const{previewColors:e,strategySpecificConfiguration:r,enabledElement:n}=t;if(!e||!r)return;t.preview&&delete t.preview,delete r.centerSegmentIndex,(o=this.onInteractionStart)==null||o.call(this,n,t);const i=this.fill(n,t);return i&&(i.isPreviewFromHover=!0,t.preview=i,(a=this.onInteractionEnd)==null||a.call(this,n,t)),i},[St.Initialize]:t=>{const{segmentIndex:e,previewSegmentIndex:r,previewColors:n,preview:i,segmentationId:o,segmentationVoxelManager:a}=t;if(n===void 0||!r){t.memo=t.createMemo(o,a);return}if(i&&(i.previewVoxelManager.sourceVoxelManager=t.segmentationVoxelManager,t.previewVoxelManager=i.previewVoxelManager),e===null)return;const s=n==null?void 0:n[e],c=qc(t.viewport.id,t.segmentationId,e);if(!s&&!c)return;const l=s||L5e(...c);TV(t.viewport.id,t.segmentationId,r,l)},[St.AcceptPreview]:t=>{const{segmentationVoxelManager:e,previewVoxelManager:r,previewSegmentIndex:n,segmentationId:i,preview:o}=t||{};if(n===void 0)return;const a=(o==null?void 0:o.segmentIndex)??t.segmentIndex;if(!r||r.modifiedSlices.size===0)return;const s=t.createMemo(i,e);t.memo=s;const{voxelManager:c}=s,l=({index:f,value:u})=>{e.getAtIndex(f)===n&&(e.setAtIndex(f,u),c.setAtIndex(f,a))};r.forEach(l,{}),Ai(t.segmentationId,r.getArrayOfModifiedSlices(),o.segmentIndex),r.clear()},[St.RejectPreview]:t=>{const{previewVoxelManager:e,segmentationVoxelManager:r}=t;if(e.modifiedSlices.size===0)return;const n=({index:i,value:o})=>{r.setAtIndex(i,o)};e.forEach(n),Ai(t.segmentationId,e.getArrayOfModifiedSlices(),0),e.clear()}},N5e={[St.Fill]:t=>{var f;const{segmentsLocked:e,segmentationImageData:r,segmentationVoxelManager:n,previewVoxelManager:i,brushStrategy:o,centerIJK:a}=t,s=(f=o.createIsInThreshold)==null?void 0:f.call(o,t),{setValue:c}=o,l=s?u=>{const{value:d,index:h}=u;e.includes(d)||!s(h)||c(t,u)}:u=>c(t,u);n.forEach(l,{imageData:r,isInObject:t.isInObject,boundsIJK:t.isInObjectBoundsIJK}),i.addPoint(a)}},k5e={[St.INTERNAL_setValue]:(t,{value:e,index:r})=>{const{segmentsLocked:n,segmentIndex:i,previewSegmentIndex:o,segmentationVoxelManager:a,memo:s}=t,c=(s==null?void 0:s.voxelManager)||t.previewVoxelManager,l=a.getAtIndex(r);if(i===null){const u=c.getAtIndex(r);u!==void 0&&c.setAtIndex(r,u);return}if(l===i||n.includes(e))return;if(l===o)if(c.getAtIndex(r)===void 0)a.setAtIndex(r,i);else return;const f=o??i;c.setAtIndex(r,f)}},V5e={[St.CreateIsInThreshold]:t=>{const{imageVoxelManager:e,strategySpecificConfiguration:r,segmentIndex:n}=t;if(!(!r||!n))return i=>{const{THRESHOLD:o,THRESHOLD_INSIDE_CIRCLE:a}=r,s=e.getAtIndex(i),c=Array.isArray(s)?fo(s):s,{threshold:l}=o||a||{};return l!=null&&l.length?l[0]<=c&&c<=l[1]:!0}}},ub=10,w8=class w8 extends wa{static getStatistics(e){const{spacing:r}=e,n=wa.getStatistics(),i=r?"mm":"voxels",o=r?r[0]*r[1]*r[2]*1e3:1;return n.volume={value:Array.isArray(n.count.value)?n.count.value.map(a=>a*o):n.count.value*o,unit:i,name:"volume"},n.maxIJKs=this.maxIJKs,n.array.push(n.volume),this.maxIJKs=[],n}static statsCallback(e){wa.statsCallback(e);const{value:r}=e,{maxIJKs:n}=this,{length:i}=n;if(!(typeof r!="number"||i>=ub&&r<n[0].value)){if(!i||r>=n[i-1].value)n.push(e);else for(let o=0;o<i;o++)if(r<=n[o].value){n.splice(o,0,e);break}i>=ub&&n.splice(0,1)}}};w8.maxIJKs=[];let Vc=w8;function QU({operationData:t,viewport:e}){var s;let r,n,i,o,a;if(e instanceof Xn){const{volumeId:c,referencedVolumeId:l}=t;if(!c){const u=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"No volume id found for the segmentation"},cancelable:!0});return We.dispatchEvent(u),null}const f=ke.getVolume(c);if(!f)return;a=f.voxelManager,l&&(o=ke.getVolume(l).voxelManager),{imageData:r}=f}else{const{segmentationId:c}=t,l=qo(e.id,c);if(!l)return;const f=e.getCurrentImageId();if(!f)return;const u=kc(e.id,c);if(!u)return;const d=ke.getImage(l);r=u.actor.getMapper().getInputData(),a=d.voxelManager;const h=t.imageId,g=ke.getImage(h);if(!g)return;n=(s=g.getPixelData)==null?void 0:s.call(g);const p=ke.getImage(f),v=p?null:e.getImageData();i=(p==null?void 0:p.getPixelData())||v.getScalarData(),o=p==null?void 0:p.voxelManager}return{segmentationImageData:r,segmentationScalarData:n,imageScalarData:i,segmentationVoxelManager:a,imageVoxelManager:o}}const F5e=Math.pow(3*1e3/(4*Math.PI),1/3),U5e={[St.GetStatistics]:function(t,e,r){const{viewport:n}=t;let{indices:i}=r;const{segmentationId:o}=e;i?Array.isArray(i)||(i=[i,255]):i=[Po(o)];const a=i,{segmentationVoxelManager:s,imageVoxelManager:c,segmentationImageData:l}=QU({operationData:e,viewport:n}),f=l.getSpacing(),{boundsIJK:u}=s;if(!u)return Vc.getStatistics({spacing:f});s.forEach(y=>{const{value:x,pointIJK:C}=y;if(a.indexOf(x)===-1)return;const S=c.getAtIJKPoint(C);Vc.statsCallback({value:S,pointIJK:C})});const d=n.getReferenceId(),h={isPreScaled:ec(n,d),isSuvScaled:zn.isSuvScaled(n,d,n.getCurrentImageId())},g=n.getImageData(),p=Eu(g.metadata.Modality,n.getCurrentImageId(),h),v=Vc.getStatistics({spacing:f,unit:p}),{maxIJKs:w}=v;if(!(w!=null&&w.length))return v;if(v.mean.unit=p,v.max.unit=p,v.min.unit=p,p!=="SUV")return;const m=f.map(y=>Math.max(1,Math.round(1.1*F5e/y)));for(const y of w){const x=B5e(y,m,l,c,f);if(!x)continue;const{mean:C}=x;(!v.peakValue||v.peakValue.value<=C.value)&&(v.peakValue={name:"peakValue",label:"Peak Value",value:C.value,unit:p})}return v}};function B5e(t,e,r,n,i){const{pointIJK:o}=t,a=o.map((l,f)=>[l-e[f],l+e[f]]),s=(l,f)=>{const u=(f[0]-o[0])/e[0],d=(f[1]-o[1])/e[1],h=(f[2]-o[2])/e[2];return u*u+d*d+h*h<=1},c=({pointIJK:l,pointLPS:f})=>{const u=n.getAtIJKPoint(l);u!==void 0&&Vc.statsCallback({value:u,pointLPS:f,pointIJK:l})};return Vc.statsInit({storePointData:!1}),c5(r,{pointInShapeFn:s,callback:c,boundsIJK:a}),Vc.getStatistics({spacing:i})}const on={determineSegmentIndex:_5e,dynamicThreshold:E5e,erase:D5e,islandRemoval:P5e,preview:A5e,regionFill:N5e,setValue:k5e,threshold:V5e,labelmapStatistics:U5e},{VoxelManager:G5e}=cn,Cf=class Cf{constructor(e,...r){this._initialize=[],this._fill=[],this._onInteractionStart=[],this.fill=(n,i)=>{const o=this.initialize(n,i,St.Fill);if(!o)return;const{strategySpecificConfiguration:a={},centerIJK:s}=o;if(At(s,a.centerIJK))return i.preview;a.centerIJK=s,this._fill.forEach(h=>h(o));const{segmentationVoxelManager:c,previewVoxelManager:l,previewSegmentIndex:f,segmentIndex:u}=o,d=f&&l.modifiedSlices.size;return Ai(o.segmentationId,c.getArrayOfModifiedSlices(),d?f:u),!f||!l.modifiedSlices.size?(c.resetModifiedSlices(),null):o.preview||o},this.onInteractionStart=(n,i)=>{const{preview:o}=i;if(o!=null&&o.isPreviewFromHover){o.isPreviewFromHover=!1;return}const a=this.initialize(n,i);a&&this._onInteractionStart.forEach(s=>s.call(this,a))},this.addPreview=(n,i)=>{const o=this.initialize(n,i,St.AddPreview);if(o)return o.preview||o},this.configurationName=e,this.compositions=r,r.forEach(n=>{const i=typeof n=="function"?n():n;if(i)for(const o in i){if(!Cf.childFunctions[o])throw new Error(`Didn't find ${o} as a brush strategy`);Cf.childFunctions[o](this,i[o])}}),this.strategyFunction=(n,i)=>this.fill(n,i);for(const n of Object.keys(Cf.childFunctions))this.strategyFunction[n]=this[n]}initialize(e,r,n){var p,v,w;const{viewport:i}=e,o=QU({operationData:r,viewport:i});if(!o)return console.warn("No data found for BrushStrategy"),r.preview;const{imageVoxelManager:a,segmentationVoxelManager:s,segmentationImageData:c}=o,l=((p=r.override)==null?void 0:p.voxelManager)||s,f=((v=r.override)==null?void 0:v.imageData)||c,u=((w=r.preview)==null?void 0:w.previewVoxelManager)||G5e.createRLEHistoryVoxelManager(s),h=!!r.previewColors?255:void 0,g={operationName:n,previewSegmentIndex:h,...r,enabledElement:e,imageVoxelManager:a,segmentationVoxelManager:l,segmentationImageData:f,previewVoxelManager:u,viewport:i,centerWorld:null,isInObject:null,isInObjectBoundsIJK:null,brushStrategy:this};return this._initialize.forEach(m=>m(g)),g}};Cf.COMPOSITIONS=on,Cf.childFunctions={[St.OnInteractionStart]:_l(St.OnInteractionStart,St.Initialize),[St.OnInteractionEnd]:_l(St.OnInteractionEnd,St.Initialize),[St.Fill]:_l(St.Fill),[St.Initialize]:_l(St.Initialize),[St.CreateIsInThreshold]:Nm(St.CreateIsInThreshold),[St.AcceptPreview]:_l(St.AcceptPreview,St.Initialize),[St.RejectPreview]:_l(St.RejectPreview,St.Initialize),[St.INTERNAL_setValue]:Nm(St.INTERNAL_setValue),[St.Preview]:Nm(St.Preview,!1),[St.ComputeInnerCircleRadius]:_l(St.ComputeInnerCircleRadius),[St.AddPreview]:_l(St.AddPreview),[St.GetStatistics]:Nm(St.GetStatistics),compositions:null};let hs=Cf;function _l(t,e){const r=`_${t}`;return(n,i)=>{n[r]||(n[r]=[]),n[r].push(i),n[t]||(n[t]=e?(o,a)=>{const s=n[e](o,a,t);n[r].forEach(c=>c.call(n,s))}:o=>{n[r].forEach(a=>a.call(n,o))})}}function Nm(t,e=!0){return(r,n)=>{if(r[t])throw new Error(`The singleton method ${t} already exists`);r[t]=e?n:(i,o,...a)=>(o.enabledElement=i,n.call(r,o,...a))}}function eB(t,e){const{center:r,radius:n}=t,i=t.radius2||n*n;return(e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1])+(e[2]-r[2])*(e[2]-r[2])<=i}const{transformWorldToIndex:fb,isEqual:w3}=cn,tB={[St.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=xt(0,0,0);e.forEach(d=>{br(i,i,d)}),mr(i,i,1/e.length),t.centerWorld=i,t.centerIJK=fb(n,i);const o=e.map(d=>r.worldToCanvas(d)),[a,s]=Pg(o),c=r.canvasToWorld(a),l=r.canvasToWorld(s),f=e.map(d=>fb(n,d)),u=mu(f,n.getDimensions());t.isInObject=nB({topLeftWorld:c,bottomRightWorld:l,center:i}),t.isInObjectBoundsIJK=u}};function nB(t){const{topLeftWorld:e,bottomRightWorld:r,center:n}=t,i=Math.abs(e[0]-r[0])/2,o=Math.abs(e[1]-r[1])/2,a=Math.abs(e[2]-r[2])/2,s=Math.max(i,o,a);if(w3(i,s)&&w3(o,s)&&w3(a,s)){const f={center:n,radius:s,radius2:s*s};return u=>eB(f,u)}const c={center:n,xRadius:i,yRadius:o,zRadius:a},{precalculated:l}=_4(c,{});return l}const rB=new hs("Circle",on.regionFill,on.setValue,tB,on.determineSegmentIndex,on.preview,on.labelmapStatistics),W5e=new hs("CircleThreshold",on.regionFill,on.setValue,tB,on.determineSegmentIndex,on.dynamicThreshold,on.threshold,on.preview,on.islandRemoval,on.labelmapStatistics),j5=rB.strategyFunction,z5e=W5e.strategyFunction;function $5e(){throw new Error("Not yet implemented")}const{transformWorldToIndex:j5e}=cn,H5e={[St.Initialize]:t=>{const{points:e,viewport:r,segmentationImageData:n}=t;if(!e)return;const i=xt(0,0,0);e.forEach(c=>{br(i,i,c)}),mr(i,i,1/e.length),t.centerWorld=i,t.centerIJK=j5e(n,i);const{boundsIJK:o,topLeftWorld:a,bottomRightWorld:s}=Wye(e.slice(0,2),n,r);t.isInObjectBoundsIJK=o,t.isInObject=nB({topLeftWorld:a,bottomRightWorld:s,center:i})}},H5=new hs("Sphere",on.regionFill,on.setValue,H5e,on.determineSegmentIndex,on.preview,on.labelmapStatistics),iB=H5.strategyFunction,K5e=new hs("SphereThreshold",...H5.compositions,on.dynamicThreshold,on.threshold),q5e=new hs("SphereThreshold",...H5.compositions,on.dynamicThreshold,on.threshold,on.islandRemoval),X5e=K5e.strategyFunction,Y5e=q5e.strategyFunction,J5e=new hs("EraseSphere",on.erase,...H5.compositions),oB=J5e.strategyFunction,Z5e=new hs("EraseCircle",on.erase,...rB.compositions),aB=Z5e.strategyFunction,{VoxelManager:ZC,RLEVoxelMap:Q5e}=cn;function sB(t,e,r){return r?lB(t,r):cB(t,e)}function X4(t){const{segmentationVoxelManager:e,undoVoxelManager:r,redoVoxelManager:n}=this,i=t===!1?n:r;i.forEach(({value:a,pointIJK:s})=>{e.setAtIJKPoint(s,a)});const o=i.getArrayOfModifiedSlices();Ai(this.segmentationId,o)}function cB(t,e){const r=ZC.createRLEHistoryVoxelManager(e);return{segmentationId:t,restoreMemo:X4,commitMemo:uB,segmentationVoxelManager:e,voxelManager:r}}function lB(t,e){const{memo:r,segmentationVoxelManager:n,previewVoxelManager:i}=e;return{segmentationId:t,restoreMemo:X4,commitMemo:uB,segmentationVoxelManager:n,voxelManager:i,memo:r,preview:e}}function uB(){if(this.redoVoxelManager)return!0;if(!this.voxelManager.modifiedSlices.size)return!1;const{segmentationVoxelManager:t}=this,e=ZC.createRLEHistoryVoxelManager(t);Q5e.copyMap(e.map,this.voxelManager.map);for(const n of this.voxelManager.modifiedSlices.keys())e.modifiedSlices.add(n);this.undoVoxelManager=e;const r=ZC.createRLEVolumeVoxelManager({dimensions:this.segmentationVoxelManager.dimensions});return this.redoVoxelManager=r,e.forEach(({index:n,pointIJK:i,value:o})=>{const a=t.getAtIJKPoint(i);a!==o&&r.setAtIndex(n,a)}),!0}const ewe=Object.freeze(Object.defineProperty({__proto__:null,createLabelmapMemo:sB,createPreviewMemo:lB,createRleMemo:cB,restoreMemo:X4},Symbol.toStringTag,{value:"Module"})),{isEqual:km}=cn,twe=xt(1,0,0),nwe=xt(0,1,0),rwe=xt(0,0,1),db=[twe,nwe,rwe];function fB(t){const e=yn(Ae(),t[0],t[1]),r=yn(Ae(),t[0],t[2]),n=hb(e,db),i=hb(r,db);return[...n,...i].every(a=>km(a,0)||km(a,90)||km(a,180)||km(a,270))}function hb(t,e){return e.map(r=>VT(t,r)*180/Math.PI)}const{transformWorldToIndex:dB}=cn,hB={[St.Initialize]:t=>{const{points:e,imageVoxelManager:r,viewport:n,segmentationImageData:i,segmentationVoxelManager:o}=t;if(!e)return;const a=xt(0,0,0);e.forEach(l=>{br(a,a,l)}),mr(a,a,1/e.length),t.centerWorld=a,t.centerIJK=dB(i,a);const{boundsIJK:s,pointInShapeFn:c}=iwe(n,e,i);t.isInObject=c,t.isInObjectBoundsIJK=s}};function iwe(t,e,r){let n=e.map(y=>dB(r,y));n=n.map(y=>y.map(x=>Math.round(x)));const i=mu(n,r.getDimensions()),a=t instanceof Jn||fB(n),s=r.getDirection(),c=r.getSpacing(),{viewPlaneNormal:l}=t.getCamera(),f=Su({direction:s,spacing:c},l),u=gV(e);let[[d,h],[g,p],[v,w]]=u;return d-=f,h+=f,g-=f,p+=f,v-=f,w+=f,{boundsIJK:i,pointInShapeFn:a?()=>!0:y=>{const[x,C,S]=y,T=x>=d&&x<=h,_=C>=g&&C<=p,E=S>=v&&S<=w;return T&&_&&E}}}const owe=new hs("Rectangle",on.regionFill,on.setValue,hB,on.determineSegmentIndex,on.preview,on.labelmapStatistics),awe=new hs("RectangleThreshold",on.regionFill,on.setValue,hB,on.determineSegmentIndex,on.dynamicThreshold,on.threshold,on.preview,on.islandRemoval,on.labelmapStatistics),Y4=owe.strategyFunction,swe=awe.strategyFunction,cwe=Object.freeze(Object.defineProperty({__proto__:null,fillInsideCircle:j5,fillInsideRectangle:Y4,fillOutsideCircle:$5e,thresholdInsideRectangle:swe},Symbol.toStringTag,{value:"Module"})),$g=class $g extends $r{constructor(e,r){super(e,r)}get _previewData(){return $g.previewData}createMemo(e,r,n){return this.memo||(this.memo=sB(e,r,n)),this.memo}createEditData(e){var c,l;const r=we(e),{viewport:n}=r,i=Mp(n.id);if(!i){const f=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return We.dispatchEvent(f),null}const{segmentationId:o}=i,a=u0(o),{representationData:s}=jt(o);if(n instanceof Xn){const{volumeId:f}=s[ht.Labelmap],u=n.getActors();if(n instanceof L5){const v=new CustomEvent($e.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return We.dispatchEvent(v),null}const h=u.map(v=>ke.getVolume(v.referencedId)),g=ke.getVolume(f),p=((c=h.find(v=>At(v.dimensions,g.dimensions)))==null?void 0:c.volumeId)||((l=h[0])==null?void 0:l.volumeId);return{volumeId:f,referencedVolumeId:this.configuration.thresholdVolumeId??p,segmentsLocked:a}}else{const f=qo(n.id,o);if(!f)return;if(this.configuration.activeStrategy.includes("SPHERE")){const u=n.getImageIds();if(!KA(u))throw new Error("Volume is not reconstructable for sphere manipulation");const h=`${o}_${n.id}`,g=ke.getVolume(h);if(g)return{imageId:f,segmentsLocked:a,override:{voxelManager:g.voxelManager,imageData:g.imageData}};{const p=YF(n.id,o);if(!p||p.length===1)return{imageId:f,segmentsLocked:a};const v=T_(h,p);return{imageId:f,segmentsLocked:a,override:{voxelManager:v.voxelManager,imageData:v.imageData}}}}else return{imageId:f,segmentsLocked:a}}}createHoverData(e,r){const n=we(e),{viewport:i}=n,o=i.getCamera(),{viewPlaneNormal:a,viewUp:s}=o,c=[i.id],{segmentIndex:l,segmentationId:f,segmentColor:u}=this.getActiveSegmentationData(i)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...a],viewUp:[...s],FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:u},data:{}},centerCanvas:r,segmentIndex:l,viewport:i,segmentationId:f,segmentColor:u,viewportIdsToRender:c}}getActiveSegmentationData(e){const r=e.id,n=Mp(r);if(!n)return;const{segmentationId:i}=n,o=Po(i);if(!o)return;const a=qc(r,i,o);return{segmentIndex:o,segmentationId:i,segmentColor:a}}getOperationData(e){var u,d,h,g;const r=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:i,brushCursor:o}=this._hoverData||this.createHoverData(e),{data:a,metadata:s={}}=o||{},{viewPlaneNormal:c,viewUp:l}=s;return{...r,points:(u=a==null?void 0:a.handles)==null?void 0:u.points,segmentIndex:n,previewColors:(d=this.configuration.preview)!=null&&d.enabled||this._previewData.preview?(h=this.configuration.preview)==null?void 0:h.previewColors:null,viewPlaneNormal:c,toolGroupId:this.toolGroupId,segmentationId:i,viewUp:l,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration,preview:(g=this._previewData)==null?void 0:g.preview,createMemo:this.createMemo.bind(this)}}addPreview(e=this._previewData.element,r){const{_previewData:n}=this,i=r==null?void 0:r.acceptReject;i===!0?this.acceptPreview(e):i===!1&&this.rejectPreview(e);const o=we(e);return n.preview=this.applyActiveStrategyCallback(o,this.getOperationData(e),St.AddPreview),n.isDrag=!0,n.preview}rejectPreview(e=this._previewData.element){if(!e||!this._previewData.preview)return;const r=we(e);this.applyActiveStrategyCallback(r,this.getOperationData(e),St.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;this.doneEditMemo();const r=we(e);this.applyActiveStrategyCallback(r,this.getOperationData(e),St.AcceptPreview),this._previewData.isDrag=!1,this._previewData.preview=null,this.doneEditMemo()}static viewportContoursToLabelmap(e,r){var v;const n=(r==null?void 0:r.removeContours)??!0,i=E5(),o=w1(e,i);if(!(o!=null&&o.length))return;const a=o.filter(w=>{var m,y;return(y=(m=w.data.contour)==null?void 0:m.polyline)==null?void 0:y.length});if(!a.length)return;const c=new $g({},{configuration:{strategies:{FILL_INSIDE_CIRCLE:j5},activeStrategy:"FILL_INSIDE_CIRCLE"}}).addPreview(e.element),{memo:l,segmentationId:f}=c,u=(l==null?void 0:l.voxelManager)||c.previewVoxelManager,d=u.sourceVoxelManager||u,{dimensions:h}=u,g=e.getDefaultActor().actor.getMapper().getInputData();for(const w of a){const m=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],{polyline:y}=w.data.contour;for(const I of y)g.worldToIndex(I).forEach((M,P)=>{m[P][0]=Math.min(m[P][0],M),m[P][1]=Math.max(m[P][1],M)});m.forEach((I,R)=>{I[0]=Math.round(Math.max(0,I[0])),I[1]=Math.round(Math.min(h[R]-1,I[1]))});const x=Po(f),C=((v=w.data.handles)==null?void 0:v[0])||y[0],S=g.worldToIndex(C).map(Math.round),T=d.getAtIJKPoint(S)||0;let _=!1,E=!1;for(const I of y){const R=g.worldToIndex(I).map(Math.round),M=d.getAtIJKPoint(R);M===T?_=!0:M>=0&&(E=!0)}const b=_&&E?T:T===0?x:0;for(let I=m[0][0];I<=m[0][1];I++)for(let R=m[1][0];R<=m[1][1];R++)for(let M=m[2][0];M<=m[2][1];M++){const P=g.indexToWorld([I,R,M]);O4(P,y)&&u.setAtIJK(I,R,M,b)}n&&hn(w.annotationUID)}const p=u.getArrayOfModifiedSlices();Ai(f,p)}};$g.previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1};let r0=$g;class J4 extends r0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:j5,ERASE_INSIDE_CIRCLE:aB,FILL_INSIDE_SPHERE:iB,ERASE_INSIDE_SPHERE:oB,THRESHOLD_INSIDE_CIRCLE:z5e,THRESHOLD_INSIDE_SPHERE:X5e,THRESHOLD_INSIDE_SPHERE_WITH_ISLAND_REMOVAL:Y5e},strategySpecificConfiguration:{THRESHOLD:{threshold:[-150,-70]}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",thresholdVolumeId:null,brushSize:25,preview:{enabled:!1,previewColors:{},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[St.AcceptPreview]:{method:St.AcceptPreview,bindings:[{key:"Enter"}]}}}}){super(e,r),this.onSetToolPassive=n=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=n=>{this.disableCursor()},this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=we(o);this._editData=this.createEditData(o),this._activateDraw(o),Tt(o),n.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const s=this._hoverData||this.createHoverData(o);Me(s.viewportIdsToRender);const c=this.getOperationData(o);return this.applyActiveStrategyCallback(a,c,St.OnInteractionStart),!0},this.mouseMoveCallback=n=>{if(this.mode===wn.Active){if(this.updateCursor(n),!this.configuration.preview.enabled)return;const{previewTimeMs:i,previewMoveDistance:o,dragMoveDistance:a}=this.configuration.preview,{currentPoints:s,element:c}=n.detail,{canvas:l}=s,{preview:f,startPoint:u,timer:d,timerStart:h,isDrag:g}=this._previewData,p=ir(l,u),v=Date.now()-h;if((p>o||v>i&&p>a)&&(d&&(window.clearTimeout(d),this._previewData.timer=null),f&&!g&&this.rejectPreview(c)),!this._previewData.timer){const w=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:w,startPoint:l,element:c})}}},this.previewCallback=()=>{this._previewData.timer=null,!this._previewData.preview&&(this._previewData.preview=this.applyActiveStrategyCallback(we(this._previewData.element),this.getOperationData(this._previewData.element),St.Preview))},this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=we(o);this.updateCursor(n);const{viewportIdsToRender:c}=this._hoverData;Me(c);const l=ir(a.canvas,this._previewData.startPoint),{dragTimeMs:f,dragMoveDistance:u}=this.configuration.preview;!this._previewData.isDrag&&this._previewData.preview&&Date.now()-this._previewData.timerStart<f&&l<u||(this._previewData.preview=this.applyActiveStrategy(s,this.getOperationData(o)),this._previewData.element=o,this._previewData.timerStart=Date.now()+f,this._previewData.isDrag=!0,this._previewData.startPoint=a.canvas)},this._endCallback=n=>{const i=n.detail,{element:o}=i,a=we(o),s=this.getOperationData(o);!this._previewData.preview&&!this._previewData.isDrag&&this.applyActiveStrategy(a,s),this.doneEditMemo(),this._deactivateDraw(o),Ut(o),this.updateCursor(n),this._editData=null,this.applyActiveStrategyCallback(a,s,St.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(o)},this._activateDraw=n=>{n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}updateCursor(e){const r=e.detail,{element:n}=r,{currentPoints:i}=r,o=i.canvas;this._hoverData=this.createHoverData(n,o),this._calculateCursor(n,o),this._hoverData&&Me(this._hoverData.viewportIdsToRender)}_calculateCursor(e,r){const n=we(e),{viewport:i}=n,{canvasToWorld:o}=i,a=i.getCamera(),{brushSize:s}=this.configuration,c=xt(a.viewUp[0],a.viewUp[1],a.viewUp[2]),l=xt(a.viewPlaneNormal[0],a.viewPlaneNormal[1],a.viewPlaneNormal[2]),f=Ae();xn(f,c,l);const u=o([r[0],r[1]]),d=Ae(),h=Ae(),g=Ae(),p=Ae();for(let x=0;x<=2;x++)d[x]=u[x]-c[x]*s,h[x]=u[x]+c[x]*s,g[x]=u[x]-f[x]*s,p[x]=u[x]+f[x]*s;if(!this._hoverData)return;const{brushCursor:v}=this._hoverData,{data:w}=v;w.handles===void 0&&(w.handles={}),w.handles.points=[d,h,g,p];const m=this.configuration.activeStrategy,y=this.configuration.strategies[m];typeof(y==null?void 0:y.computeInnerCircleRadius)=="function"&&y.computeInnerCircleRadius({configuration:this.configuration,viewport:i}),w.invalidated=!1}getStatistics(e,r){if(!e)return;const n=we(e);return this.applyActiveStrategyCallback(n,this.getOperationData(e),St.GetStatistics,r)}invalidateBrushCursor(){if(this._hoverData===void 0)return;const{data:e}=this._hoverData.brushCursor,{viewport:r}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(r)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,r){var y;if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const o=this._hoverData.brushCursor;if(o.data.invalidated===!0){const{centerCanvas:x}=this._hoverData,{element:C}=n;this._calculateCursor(C,x)}const a=o.metadata;if(!a)return;const s=a.brushCursorUID,c=o.data,{points:l}=c.handles,f=l.map(x=>n.worldToCanvas(x)),u=f[0],d=f[1],h=[Math.floor((u[0]+d[0])/2),Math.floor((u[1]+d[1])/2)],g=Math.abs(u[1]-Math.floor((u[1]+d[1])/2)),p=`rgb(${((y=a.segmentColor)==null?void 0:y.slice(0,3))||[0,0,0]})`;if(!n.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}ho(r,s,"0",h,g,{color:p});const w=this.configuration.activeStrategy,{dynamicRadiusInCanvas:m}=this.configuration.strategySpecificConfiguration[w]||{dynamicRadiusInCanvas:0};m&&ho(r,s,"1",h,m,{color:p})}}J4.toolName="Brush";function wh(t,e){const r=Li(t);if(r===void 0)return;const n=r._toolInstances;return Object.keys(n).length?e&&n[e]?[n[e]]:Object.values(n).filter(o=>o instanceof J4):void 0}function lwe(t,e,r){const n=Li(t);if(n===void 0)return;wh(t,r).forEach(l=>{l.configuration.brushSize=e,l.invalidateBrushCursor()});const o=n.getViewportsInfo(),a=Object.keys(o).map(l=>o[l]);if(!a.length)return;const{renderingEngineId:s}=a[0],c=n.getViewportIds();fr(s),Me(c)}function uwe(t,e){const r=Li(t);if(r===void 0)return;const n=r._toolInstances;if(!Object.keys(n).length)return;const o=wh(t,e)[0];if(o)return o.configuration.brushSize}function fwe(t,e,r={isDynamic:!1}){const n=Li(t);if(n===void 0)return;const i=wh(t),o={...r,...e!==void 0&&{threshold:e}};i.forEach(l=>{l.configuration.strategySpecificConfiguration.THRESHOLD={...l.configuration.strategySpecificConfiguration.THRESHOLD,...o}});const a=n.getViewportsInfo();if(!a.length)return;const{renderingEngineId:s}=a[0],c=n.getViewportIds();fr(s),Me(c)}function dwe(t){const e=Li(t);if(e===void 0)return;const r=e._toolInstances;if(!Object.keys(r).length)return;const i=wh(t)[0];if(i)return i.configuration.strategySpecificConfiguration.THRESHOLD.threshold}function hwe(t,e,r,n){const{baseVolumeIdx:i,volumeInfoList:o}=pV(t,r),{voxelManager:a}=o[i],s=a,c=t.voxelManager.getScalarDataLength(),l=t.voxelManager;return o.forEach(f=>{const{volumeSize:u}=f;u===c?pwe(l,s,e,f):gwe(l,s,e,f,o,i,n)}),Ai(t.volumeId),t}function gwe(t,e,r,n,i,o,a){const{imageData:s,lower:c,upper:l,dimensions:f}=n;let u,d,h;const g=t.getScalarDataLength();for(let p=0;p<g;p++)if(g.getAtIndex(p)===r){const v=m4(s,f,i[o].spacing,i[o].imageData.getPoint(p)),w=({value:y})=>{u=u+1,y>=h.lower&&y<=h.upper&&(d=d+1)};u=0,d=0,h={lower:c,upper:l};let m=!1;t.forEach(w,{imageData:s,boundsIJK:v}),m=a===0?d>0:d===u,t.setAtIndex(p,m?r:0)}return{total:u,range:h,overlaps:d}}function pwe(t,e,r,n){const{lower:i,upper:o}=n,a=t.getScalarDataLength();for(let s=0;s<a;s++)if(t.getAtIndex[s]===r){const c=e.getAtIndex(s);t.setAtIndex(s,c>=i&&c<=o?r:0)}}function gb(t,e,r){const n=r.toIJK(t),i=r.toIJK(e),o=Ae(),{testIJK:a}=r,s=bn(Ae(),n,i),c=Math.round(Math.max(...s.map(Math.abs)));if(c<2)return!0;const l=mr(Ae(),s,1/c);for(let f=1;f<c;f++)if(Xt(o,i,l,f),!a(o))return!1;return!0}function mwe(t,e,r){const n=ke.getVolume(t);if(!n){console.warn(`No volume found for ${t}`);return}const i=n.voxelManager,o=n.dimensions[0],a=o*n.dimensions[1];return{testCenter:(s,c)=>{const l=br(Ae(),s,c).map(v=>v/2),f=n.imageData.worldToIndex(l).map(Math.round),[u,d,h]=f,g=u+d*o+h*a,p=i.getAtIndex(g);return p===e||(r==null?void 0:r.has(p))},toIJK:s=>n.imageData.worldToIndex(s),testIJK:s=>{const[c,l,f]=s,u=Math.round(c)+Math.round(l)*o+Math.round(f)*a,d=i.getAtIndex(u);return d===e||(r==null?void 0:r.has(d))}}}const jh=.01;function vwe(t,e,r){const{sliceContours:n}=t,{segmentIndex:i,containedSegmentIndices:o}=r;let a;const s=mwe(e,i,o);for(const c of n){const l=ywe(c,s,a);l&&(a=l)}return a&&Object.assign(a,r),a}function ywe(t,e,r={maxMajor:0,maxMinor:0}){const{points:n}=t.polyData,{maxMinor:i,maxMajor:o}=r;let a=o*o,s=i*i,c;for(let v=0;v<n.length;v++)for(let w=v+1;w<n.length;w++){const m=n[v],y=n[w],x=iC(m,y);x<a||x-jh<a+jh&&c||e.testCenter(m,y)&&gb(m,y,e)&&(a=x-jh,c=[v,w],s=0)}if(!c)return;a=Math.sqrt(a+jh);const l=n[c[0]],f=n[c[1]],u=bn(Ae(),l,f);mr(u,u,1/a);let d;for(let v=0;v<n.length;v++)for(let w=v+1;w<n.length;w++){const m=n[v],y=n[w],x=iC(m,y);if(x<=s)continue;const C=bn(Ae(),m,y);Math.abs(gt(C,u))/Math.sqrt(x)>jh||e.testCenter(m,y)&&gb(m,y,e)&&(s=x,d=[v,w])}if(!d)return;s=Math.sqrt(s);const h=n[d[0]],g=n[d[1]];return{majorAxis:[l,f],minorAxis:[h,g],maxMajor:a,maxMinor:s,...t}}const{Labelmap:wwe}=ht;function gB(t){const e=KU({segmentations:t});if(!(e!=null&&e.length)||!e[0].sliceContours.length)return;const{representationData:r,segments:n=[null,{label:"Unspecified",color:null,containedSegmentIndices:null}]}=t,{volumeId:i}=r[wwe],o=n.findIndex(a=>!!a);if(o!==-1)return n[o].segmentIndex=o,vwe(e[0],i,n[o])}function pB(t,e){const{majorAxis:r,minorAxis:n,label:i="",sliceIndex:o}=t,[a,s]=r,[c,l]=n,f=[a,s,c,l];return{highlighted:!0,invalidated:!0,metadata:{toolName:"Bidirectional",...e.getViewReference({sliceIndex:o})},data:{handles:{points:f,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:i,cachedStats:{}},isLocked:!1,isVisible:!0}}const{transformWorldToIndex:Vm}=cn;class Z4 extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:xwe}}){super(e,r),this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles;let u=c.worldToCanvas(f[0]),d=c.worldToCanvas(f[1]),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},g=Ii([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]);return g<=a||(u=c.worldToCanvas(f[2]),d=c.worldToCanvas(f[3]),h={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},g=Ii([h.start.x,h.start.y],[h.end.x,h.end.y],[o[0],o[1]]),g<=a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),we(a),Me(s),Tt(a),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,c=i.data;i.highlighted=!0;let l=!1,f;o.worldPosition?l=!0:f=c.handles.points.findIndex(d=>d===o);const u=pt(s,this.getToolName());Tt(s),this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),we(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(!(c&&!l)){if(this.doneEditMemo(),f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.editData.handleIndex!==void 0){const{points:u}=f.handles,d=li(u[0],u[1]);if(li(u[2],u[3])>d){const g=[[...u[2]],[...u[3]]],p=[...u[0]],v=[...u[1]],w=Vt();ga(w,g[1][0]-g[0][0],g[1][1]-g[1][0]);const m=Vt();ga(m,-w[1],w[0]);const y=Vt();ga(y,v[0]-p[0],v[1]-p[0]);let x;FT(y,m)>0?x=[p,v]:x=[v,p],f.handles.points=[g[0],g[1],x[0],x[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a),this.editData=null,this.isDrawing=!1}},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=we(a),{viewport:c}=s,{worldToCanvas:l}=c,{annotation:f,viewportIdsToRender:u,handleIndex:d,newAnnotation:h}=this.editData;this.createMemo(a,f,{newAnnotation:h});const{data:g}=f,p=o.world;g.handles.points[d]=[...p];const v=g.handles.points.map(l),w={longLineSegment:{start:{x:v[0][0],y:v[0][1]},end:{x:v[1][0],y:v[1][1]}},shortLineSegment:{start:{x:v[2][0],y:v[2][1]},end:{x:v[3][0],y:v[3][1]}}},y=ir(v[0],v[1])/3,x=w.longLineSegment.start.x-w.longLineSegment.end.x,C=w.longLineSegment.start.y-w.longLineSegment.end.y,S=Math.sqrt(x*x+C*C),T=x/S,_=C/S,E=(w.longLineSegment.start.x+w.longLineSegment.end.x)/2,D=(w.longLineSegment.start.y+w.longLineSegment.end.y)/2,b=E+y*_,I=D-y*T,R=E-y*_,M=D+y*T;g.handles.points[2]=c.canvasToWorld([b,I]),g.handles.points[3]=c.canvasToWorld([R,M]),f.invalidated=!0,Me(u),this.editData.hasMoved=!0},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragModifyHandle(n),a.invalidated=!0;Me(s)},this._dragModifyHandle=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=we(a),{viewport:c}=s,{annotation:l,handleIndex:f}=this.editData,{data:u}=l,d=o.world,h=[c.worldToCanvas(u.handles.points[0]),c.worldToCanvas(u.handles.points[1]),c.worldToCanvas(u.handles.points[2]),c.worldToCanvas(u.handles.points[3])],g={start:{x:h[0][0],y:h[0][1]},end:{x:h[1][0],y:h[1][1]}},p={start:{x:h[2][0],y:h[2][1]},end:{x:h[3][0],y:h[3][1]}},v=[...d],w=c.worldToCanvas(v);if(f===0||f===1){const y=h[f===0?1:0],x=ga(Vt(),w[0]-y[0],w[1]-y[1]),C=ga(Vt(),h[f][0]-y[0],h[f][1]-y[1]);Oc(x,x),Oc(C,C);const S={start:{x:y[0],y:y[1]},end:{x:w[0],y:w[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(S,p))return;const T=y,_=this._getSignedAngle(C,x);let E=h[2][0],D=h[2][1],b=h[3][0],I=h[3][1];E-=T[0],D-=T[1],b-=T[0],I-=T[1];const R=E*Math.cos(_)-D*Math.sin(_),M=E*Math.sin(_)+D*Math.cos(_),P=b*Math.cos(_)-I*Math.sin(_),k=b*Math.sin(_)+I*Math.cos(_);E=R+T[0],D=M+T[1],b=P+T[0],I=k+T[1];const z=c.canvasToWorld([E,D]),A=c.canvasToWorld([b,I]);u.handles.points[f]=v,u.handles.points[2]=z,u.handles.points[3]=A}else{const m=f===2?3:2,y={longLineSegment:{start:g.start,end:g.end},shortLineSegment:{start:p.start,end:p.end}},x=Sr(Vt(),[y.longLineSegment.end.x,y.longLineSegment.end.y],[y.longLineSegment.start.x,y.longLineSegment.start.y]),C=Oc(Vt(),x),S=Sr(Vt(),[w[0],w[1]],[h[f][0],h[f][1]]),T=mv(S),_=this._getSignedAngle(C,S),E=Math.cos(_)*T,D=Mq(Vt(),[h[m][0],h[m][1]],C,E);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:w[0],y:w[1]},end:{x:D[0],y:D[1]}},{start:{x:y.longLineSegment.start.x,y:y.longLineSegment.start.y},end:{x:y.longLineSegment.end.x,y:y.longLineSegment.end.y}})||!zC([w[0],w[1]],[D[0],D[1]],[g.start.x,g.start.y],[g.end.x,g.end.y]))return;u.handles.points[m]=c.canvasToWorld(D),u.handles.points[f]=v}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!0;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles,m=v.map(ee=>a.worldToCanvas(ee));u.annotationUID=g;const{color:y,lineWidth:x,lineDash:C,shadow:S}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,width:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let T;if(!ti(g))continue;!jr(g)&&!this.editData&&w!==null&&(T=[m[w]]),T&&Kn(i,g,"0",T,{color:y});const _=`${g}-line-1`,E=`${g}-line-2`;an(i,g,"0",m[0],m[1],{color:y,lineDash:C,lineWidth:x,shadow:S},_),an(i,g,"1",m[2],m[3],{color:y,lineDash:C,lineWidth:x,shadow:S},E),o=!0;const I=this.getLinkedTextBoxStyle(u,h);if(!I.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const R=this.configuration.getTextLines(p,l);if(!R||R.length===0)continue;let M;p.handles.textBox.hasMoved||(M=Jo(m),p.handles.textBox.worldPosition=a.canvasToWorld(M));const P=a.worldToCanvas(p.handles.textBox.worldPosition),z=to(i,g,"1",R,P,m,{},I),{x:A,y:L,width:N,height:H}=z;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([A,L]),topRight:a.canvasToWorld([A+N,L]),bottomLeft:a.canvasToWorld([A,L+H]),bottomRight:a.canvasToWorld([A+N,L+H])}}return o},this._movingLongAxisWouldPutItThroughShortAxis=(n,i)=>{const o=Vt();ga(o,i.end.x-i.start.x,i.end.y-i.start.y),Oc(o,o);const a={start:{x:i.start.x-o[0]*10,y:i.start.y-o[1]*10},end:{x:i.end.x+o[0]*10,y:i.end.y+o[1]*10}};return!zC([a.start.x,a.start.y],[a.end.x,a.end.y],[n.start.x,n.start.y],[n.end.x,n.end.y])},this._calculateCachedStats=(n,i,o)=>{const{data:a}=n,{element:s}=o.viewport,c=a.handles.points[0],l=a.handles.points[1],f=a.handles.points[2],u=a.handles.points[3],{cachedStats:d}=a,h=Object.keys(d);for(let g=0;g<h.length;g++){const p=h[g],v=this.getTargetImageData(p);if(!v)continue;const{imageData:w,dimensions:m}=v,y=Vm(w,c),x=Vm(w,l),C=Vm(w,f),S=Vm(w,u),T=[y,x],_=[C,S],{scale:E,unit:D}=Ko(v,T),{scale:b,unit:I}=Ko(v,_),R=this._calculateLength(c,l)/E,M=this._calculateLength(f,u)/b,P=R>M?R:M,k=R>M?M:R,z=R>M?D:I,A=R>M?I:D;this._isInsideVolume(y,x,C,S,m)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,d[p]={length:P,width:k,unit:z,widthUnit:A}}return n.invalidated=!1,qn(n,s),d},this._isInsideVolume=(n,i,o,a,s)=>ur(n,s)&&ur(i,s)&&ur(o,s)&&ur(a,s),this._getSignedAngle=(n,i)=>Math.atan2(n[0]*i[1]-n[1]*i[0],n[0]*i[0]+n[1]*i[1]),this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,o=n.world,a=we(i),{viewport:s,renderingEngine:c}=a;this.isDrawing=!0;const l=s.getCamera(),{viewPlaneNormal:f,viewUp:u}=l,d=this.getReferencedImageId(s,o,f,u),h=s.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...u],FrameOfReferenceUID:h,referencedImageId:d,...s.getViewReference({points:[o]})},data:{handles:{points:[[...o],[...o],[...o],[...o]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};Zt(g,i);const p=pt(i,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),Tt(i),e.preventDefault(),Me(p),g}_calculateLength(e,r){const n=e[0]-r[0],i=e[1]-r[1],o=e[2]-r[2];return Math.sqrt(n*n+i*i+o*o)}}function xwe(t,e){const{cachedStats:r,label:n}=t,{length:i,width:o,unit:a}=r[e],s=[];return n&&s.push(n),i===void 0||s.push(`L: ${Kt(i)} ${a||a}`,`W: ${Kt(o)} ${a}`),s}Z4.toolName="Bidirectional";function Cwe(t,e){const{data:r}=e,n=we(t),i=(r.getSegment||Swe)(n,r);if(!i)return;const o=n.viewport.getFrameOfReferenceUID(),a=z5(),{segmentIndex:s,segmentationId:c}=i,l=as.getAnnotations(this.toolName||Z4.toolName,o);let f=!1;const u=l.filter(h=>{const g=h.data.segment;return g?(g.segmentationId===c&&g.segmentIndex===s&&(f=!0,h.data.segment=g),!0):!1});f||u.push({data:{segment:i}});let d;if(u.forEach(h=>{const g=[],p=h.data.segment,{segmentIndex:v,segmentationId:w}=p;g[v]=p,as.removeAnnotation(h.annotationUID);const m=gB({...a.find(C=>C.segmentationId===w),segments:g});if(!m)return;const y=pB(m,n.viewport);y.annotationUID=h.annotationUID,y.data.segment=p;const x=as.addAnnotation(y,o);if(p.segmentIndex===i.segmentIndex&&p.segmentationId===i.segmentationId){d=m;const{style:C}=i;C&&a4.setAnnotationStyles(x,C)}}),d){const{sliceIndex:h}=d,g=n.viewport.getImageIds();V_(t,{imageIndex:g.length-1-h}),n.viewport.render()}else console.warn("No bidirectional found");return d}function Swe(t,e){var a;const r=z5();if(!r.length)return;const n=e.segmentationId||r[0].segmentationId,i=e.segmentIndex??Po(n);if(!i)return;const o=(a=e.segmentData)==null?void 0:a.get(i);return{label:`Segment ${i}`,segmentIndex:i,segmentationId:n,...o}}function mB(t){const e=Li(t);if(e===void 0)return;wh(t).forEach(a=>{a.invalidateBrushCursor()});const n=e.getViewportsInfo();if(!Object.keys(n).map(a=>n[a]).length)return;const o=e.getViewportIds();Me(o)}function vB(t,e,r={}){const n=jt(t),i=n.representationData,o=(r==null?void 0:r.representationType)??Object.keys(i)[0];if(!o)throw new Error(`Segmentation ${t} does not have any representations`);switch(o){case ht.Labelmap:return Twe(n,e,r);case ht.Contour:return _we(n,e,r);default:return}}function Twe(t,e,{viewport:r}){const n=t.representationData.Labelmap;if(r instanceof Xn){const{volumeId:d}=n,h=ke.getVolume(d);return h?h.imageData.getScalarValueFromWorld(e):void 0}const i=qo(r.id,t.segmentationId);if(!ke.getImage(i))return;const a=kc(r.id,t.segmentationId),s=a==null?void 0:a.actor.getMapper().getInputData(),c=yr(s,e),l=s.getDimensions();return(s.voxelManager||ls.createScalarVolumeVoxelManager({dimensions:l,scalarData:s.getPointData().getScalars().getData()})).getAtIJKPoint(c)}function _we(t,e,{viewport:r}){const n=t.representationData.Contour,i=Array.from(n.annotationUIDsMap.keys()),{viewPlaneNormal:o}=r.getCamera();for(const a of i){const s=n.annotationUIDsMap.get(a);if(s)for(const c of s){const l=xr(c);if(!l)continue;const{polyline:f}=l.data.contour;if(At(o,l.metadata.viewPlaneNormal)&&O4(e,f))return Number(a)}}}function yB(t,e,{viewport:r,searchRadius:n}){const o=jt(t).representationData.Labelmap;if(r instanceof Xn){const{volumeId:p}=o,v=ke.getVolume(p);if(!v)return;const w=v.voxelManager,m=v.imageData,y=yr(m,e),x=w.getAtIJK(y[0],y[1],y[2]),C=r.worldToCanvas(e);return Dwe(C,x,r,m,n)?x:void 0}const a=qo(r.id,t);if(!ke.getImage(a))return;const c=kc(r.id,t),l=c==null?void 0:c.actor.getMapper().getInputData(),f=yr(l,e),u=l.getDimensions(),d=l.voxelManager||ls.createScalarVolumeVoxelManager({dimensions:u,scalarData:l.getPointData().getScalars().getData()}),h=d.getAtIJKPoint(f);return Ewe(f,u,d,h)?h:void 0}function wB(t,e,r=1){const n=Array.from({length:2*r+1},(i,o)=>o-r);for(const i of n)for(const o of n)for(const a of n){if(i===0&&o===0&&a===0)continue;const s=t(i,o,a);if(s!==void 0&&e!==s)return!0}return!1}function Ewe(t,e,r,n,i){return wB((a,s,c)=>{const l=[t[0]+a,t[1]+s,t[2]+c];return r.getAtIJK(l[0],l[1],l[2])},n,i)}function Dwe(t,e,r,n,i){return wB((a,s)=>{const c=[t[0]+a,t[1]+s],l=r.canvasToWorld(c),f=n.get("voxelManager").voxelManager,u=yr(n,l);return f.getAtIJK(u[0],u[1],u[2])},e,i)}function xB(t){const e=jt(t),{annotationUIDsMap:r}=e.representationData.Contour;for(const[n,i]of r.entries())if(Array.from(i).find(a=>xr(a).highlighted))return n}const bwe=`
const MAX_STRENGTH = 65535f;

// Workgroup soze - X*Y*Z must be multiple of 32 for better performance
// otherwise warps are sub allocated and some threads will not process anything
override workGroupSizeX = 1u;
override workGroupSizeY = 1u;
override workGroupSizeZ = 1u;

// Compare the current voxel to neighbors using a 9x9x9 window
override windowSize = 9i;

struct Params {
  size: vec3u,
  iteration: u32,
}

@group(0) @binding(0) var<uniform> params: Params;
@group(0) @binding(1) var<storage> volumePixelData: array<f32>;
@group(0) @binding(2) var<storage, read_write> labelmap: array<u32>;
@group(0) @binding(3) var<storage, read_write> strengthData: array<f32>;
@group(0) @binding(4) var<storage> prevLabelmap: array<u32>;
@group(0) @binding(5) var<storage> prevStrengthData: array<f32>;
@group(0) @binding(6) var<storage, read_write> updatedVoxelsCounter: array<atomic<u32>>;

fn getPixelIndex(ijkPos: vec3u) -> u32 {
  let numPixelsPerSlice = params.size.x * params.size.y;
  return ijkPos.x + ijkPos.y * params.size.x + ijkPos.z * numPixelsPerSlice;
}

@compute @workgroup_size(workGroupSizeX, workGroupSizeY, workGroupSizeZ)
fn main(
  @builtin(global_invocation_id) globalId: vec3u,
) {
  // Make sure it will not get out of bounds for volume with sizes that
  // are not multiple of workGroupSize
  if (
    globalId.x >= params.size.x ||
    globalId.y >= params.size.y ||
    globalId.z >= params.size.z
  ) {
    return;
  }

  let currentCoord = vec3i(globalId);
  let currentPixelIndex = getPixelIndex(globalId);

  let numPixels = arrayLength(&volumePixelData);
  let currentPixelValue = volumePixelData[currentPixelIndex];

  if (params.iteration == 0) {
    // All non-zero initial labels are given maximum strength
    strengthData[currentPixelIndex] = select(MAX_STRENGTH, 0., labelmap[currentPixelIndex] == 0);
    return;
  }

  // It should at least copy the values from previous state
  var newLabel = prevLabelmap[currentPixelIndex];
  var newStrength = prevStrengthData[currentPixelIndex];

  let window = i32(ceil(f32(windowSize - 1) * .5));
  let minWindow = -1i * window;
  let maxWindow = 1i * window;

  for (var k = minWindow; k <= maxWindow; k++) {
    for (var j = minWindow; j <= maxWindow; j++) {
      for (var i = minWindow; i <= maxWindow; i++) {
        // Skip current voxel
        if (i == 0 && j == 0 && k == 0) {
          continue;
        }

        let neighborCoord = currentCoord + vec3i(i, j, k);

        //  Boundary conditions. Do not grow outside of the volume
        if (
          neighborCoord.x < 0i || neighborCoord.x >= i32(params.size.x) ||
          neighborCoord.y < 0i || neighborCoord.y >= i32(params.size.y) ||
          neighborCoord.z < 0i || neighborCoord.z >= i32(params.size.z)
        ) {
          continue;
        }

        let neighborIndex = getPixelIndex(vec3u(neighborCoord));
        let neighborPixelValue = volumePixelData[neighborIndex];
        let prevNeighborStrength = prevStrengthData[neighborIndex];
        let strengthCost = abs(neighborPixelValue - currentPixelValue);
        let takeoverStrength = prevNeighborStrength - strengthCost;

        if (takeoverStrength > newStrength) {
          newLabel = prevLabelmap[neighborIndex];
          newStrength = takeoverStrength;
        }
      }
    }
  }

  if (labelmap[currentPixelIndex] != newLabel) {
    atomicAdd(&updatedVoxelsCounter[params.iteration], 1u);
  }

  labelmap[currentPixelIndex] = newLabel;
  strengthData[currentPixelIndex] = newStrength;
}
`,Iwe=1024*1024*1024,pb=1.99*Iwe,x3={windowSize:3,maxProcessingTime:3e4,inspection:{numCyclesInterval:5,numCyclesBelowThreshold:3,threshold:1e-4}};async function K5(t,e,r=x3){var ue;const n=[8,8,4],{windowSize:i,maxProcessingTime:o}=Object.assign({},x3,r),a=Object.assign({},x3.inspection,r.inspection),s=ke.getVolume(t),c=ke.getVolume(e),[l,f,u]=s.dimensions;if(c.dimensions[0]!==l||c.dimensions[1]!==f||c.dimensions[2]!==u)throw new Error("Volume and labelmap must have the same size");const d=Math.floor(Math.sqrt(f**2+l**2+u**2)/2),h=c.voxelManager.getCompleteScalarDataArray();let g=s.voxelManager.getCompleteScalarDataArray();g instanceof Float32Array||(g=new Float32Array(g));const p={maxStorageBufferBindingSize:pb,maxBufferSize:pb},w=await(await((ue=navigator.gpu)==null?void 0:ue.requestAdapter())).requestDevice({requiredLimits:p}),m=g.byteLength,y=d*Uint32Array.BYTES_PER_ELEMENT,x=w.createShaderModule({code:bwe}),C=3,S=new Uint32Array([l,f,u,0]),T=w.createBuffer({size:S.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),_=w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});w.queue.writeBuffer(_,0,g);const E=[0,1].map(()=>w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}));w.queue.writeBuffer(E[0],0,new Uint32Array(h));const D=[0,1].map(()=>w.createBuffer({size:m,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST})),b=w.createBuffer({size:y,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST}),I=w.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:5,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:6,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),R=[0,1].map(me=>{const Ee=E[me],_e=D[me],Ce=E[(me+1)%2],F=D[(me+1)%2];return w.createBindGroup({layout:I,entries:[{binding:0,resource:{buffer:T}},{binding:1,resource:{buffer:_}},{binding:2,resource:{buffer:Ee}},{binding:3,resource:{buffer:_e}},{binding:4,resource:{buffer:Ce}},{binding:5,resource:{buffer:F}},{binding:6,resource:{buffer:b}}]})}),M=w.createComputePipeline({layout:w.createPipelineLayout({bindGroupLayouts:[I]}),compute:{module:x,entryPoint:"main",constants:{workGroupSizeX:n[0],workGroupSizeY:n[1],workGroupSizeZ:n[2],windowSize:i}}}),P=[Math.ceil(l/n[0]),Math.ceil(f/n[1]),Math.ceil(u/n[2])],k=w.createBuffer({size:y,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});w.createBuffer({size:m,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});const z=o?performance.now()+o:0;let A=a.numCyclesInterval,L=0;for(let me=0;me<d;me++){S[C]=me,w.queue.writeBuffer(T,0,S);const Ee=w.createCommandEncoder(),_e=Ee.beginComputePass();if(_e.setPipeline(M),_e.setBindGroup(0,R[me%2]),_e.dispatchWorkgroups(P[0],P[1],P[2]),_e.end(),Ee.copyBufferToBuffer(b,me*Uint32Array.BYTES_PER_ELEMENT,k,me*Uint32Array.BYTES_PER_ELEMENT,Uint32Array.BYTES_PER_ELEMENT),w.queue.submit([Ee.finish()]),me>0&&!(me%A)){await k.mapAsync(GPUMapMode.READ,0,y);const F=k.getMappedRange(0,y),$=new Uint32Array(F.slice(0))[me]/g.length;if(k.unmap(),me>=1&&$<a.threshold){if(A=1,L++,L===a.numCyclesBelowThreshold)break}else A=a.numCyclesInterval}if(z&&performance.now()>z){console.warn(`Exceeded processing time limit (${o})ms`);break}}const N=w.createCommandEncoder(),H=(d+1)%2,ee=w.createBuffer({size:m,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});N.copyBufferToBuffer(E[H],0,ee,0,m),w.queue.submit([N.finish()]),await ee.mapAsync(GPUMapMode.READ,0,m);const oe=ee.getMappedRange(0,m),de=new Uint32Array(oe);h.set(de),ee.unmap(),c.voxelManager.setCompleteScalarDataArray(h)}const{transformWorldToIndex:Lp}=cn,Owe=254,Mwe=255,Rwe=.1,Pwe=.8;function Lwe(t,e){const{topLeftWorld:r,bottomRightWorld:n}=e,i=Lp(t.imageData,r),o=Lp(t.imageData,n);return{...e,topLeftIJK:i,bottomRightIJK:o}}function Awe(t,e){const r=t.imageData.getDirection(),n=xt(r[3],r[4],r[5]),{center:i,radius:o}=e,a=t.imageData,s=Xt(Ae(),i,n,-o),c=Xt(Ae(),i,n,o),l=WU([c,s],a);return Lwe(t,l)}function Nwe(t,e,r){const n=t.imageData,i=r.getCamera(),{ijkVecRowDir:o,ijkVecColDir:a}=p5(n,i);if([o,a].some(f=>!At(Math.abs(f[0]),1)&&!At(Math.abs(f[1]),1)&&!At(Math.abs(f[2]),1))){console.warn("Oblique view is not supported!");return}const{boundsIJK:c}=Awe(t,e),l={minX:c[0][0],maxX:c[0][1]+1,minY:c[1][0],maxY:c[1][1]+1,minZ:c[2][0],maxZ:c[2][1]+1};return g5(t.volumeId,l,{targetBuffer:{type:"Float32Array"}})}function kwe(t,e,r,n){const i=t.voxelManager.getCompleteScalarDataArray(),o=r.center,[a,s,c]=t.dimensions,l=a*s,f=Lp(t.imageData,o),u=i[f[2]*l+f[1]*a+f[0]],d=n.positiveSeedValue??Owe,h=n.positiveSeedVariance??Rwe,g=Math.abs(u*h),p=u-g,v=u+g,w=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],m=f[2]*l+f[1]*a+f[0];e.voxelManager.setAtIndex(m,d);const y=[f];for(;y.length;){const x=y.shift(),[C,S,T]=x;for(let _=0,E=w.length;_<E;_++){const D=w[_],b=C+D[0],I=S+D[1],R=T+D[2];if(b<0||b>=a||I<0||I>=s||R<0||R>=c)continue;const M=R*l+I*a+b,P=i[M];e.voxelManager.getAtIndex(M)===d||P<p||P>v||(e.voxelManager.setAtIndex(M,d),y.push([b,I,R]))}}}function Vwe(t,e,r,n,i){const o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=a*s,{worldVecRowDir:f,worldVecSliceDir:u}=p5(e.imageData,n.getCamera()),d=Lp(t.imageData,r.center),h=o[d[2]*a*s+d[1]*a+d[0]],g=i.negativeSeedVariance??Pwe,p=(i==null?void 0:i.negativeSeedValue)??Mwe,v=Math.abs(h*g),w=h-v,m=h+v,y=360,x=2*Math.PI/y,C=Ky(hu(),u,x),S=xq(f);for(let T=0;T<y;T++){const _=Xt(Ae(),r.center,S,r.radius),E=Lp(e.imageData,_),[D,b,I]=E;if(_q(S,S,C),D<0||D>=a||b<0||b>=s||I<0||I>=c)continue;const R=D+b*a+I*l,M=o[R];(M<w||M>m)&&e.voxelManager.setAtIndex(R,p)}}async function Fwe(t,e,r,n){const i=await s0(t.volumeId);return kwe(t,i,e,n),Vwe(t,i,e,r,n),i}async function CB(t,e,r,n){const i=ke.getVolume(t),o=Nwe(i,e,r),a=await Fwe(o,e,r,n);return await K5(o.volumeId,a.volumeId),a}const Uwe=254,Bwe=255,Gwe=[-1/0,-995],Wwe=[0,1900];function zwe(t,e,r){const{negativeSeedValue:n=Bwe,negativePixelRange:i=Gwe}=r,o=t.voxelManager.getCompleteScalarDataArray(),[a,s,c]=e.dimensions,l=Math.floor(c/2),f=new Array(a*s).fill(!1),u=l*a*s,d=(g,p)=>{const v=[[g,p]];for(;v.length;){const[w,m]=v.shift(),y=m*a+w;if(w<0||w>=a||m<0||m>=s||f[y])continue;f[y]=!0;const x=u+y,C=o[x];C<i[0]||C>i[1]||(e.voxelManager.setAtIndex(x,n),v.push([w-1,m]),v.push([w+1,m]),v.push([w,m-1]),v.push([w,m+1]))}},h=(g,p,v,w)=>{for(let m=g;m!==p;m+=v){const y=w*a+m,x=u+y,C=o[x];if(C<i[0]||C>i[1])break;f[y]||d(m,w)}};for(let g=0;g<s;g++)h(0,a-1,1,g),h(a-1,0,-1,g)}function $we(t,e,r){const{positiveSeedValue:n=Uwe,positivePixelRange:i=Wwe}=r,o=t.voxelManager.getCompleteScalarDataArray();e.voxelManager.getCompleteScalarDataArray();const[a,s,c]=e.dimensions,l=Math.floor(c/2),f=Math.max(l-3,0),u=Math.max(f+5,c),d=a*s;for(let h=f;h<u;h++){const g=h*d;for(let p=0;p<s;p++){const v=p*a;for(let w=0;w<a;w++){const m=g+v+w,y=o[m];y>=i[0]&&y<=i[1]&&e.voxelManager.setAtIndex(m,n)}}}}async function jwe(t,e){const r=s0(t.volumeId);return $we(t,r,e),zwe(t,r,e),r}async function SB(t,e,r){const{boundingBox:n}=e,{ijkTopLeft:i,ijkBottomRight:o}=n,a={minX:i[0],maxX:o[0],minY:i[1],maxY:o[1],minZ:i[2],maxZ:o[2]},s=g5(t,a,{targetBuffer:{type:"Float32Array"}}),c=await jwe(s,r);return await K5(s.volumeId,c.volumeId),c}const{transformWorldToIndex:Q4,transformIndexToWorld:Hwe}=cn,Kwe=254,qwe=255,Xwe=.1,Ywe=.8,Jwe=.2,Zwe=5;function Qwe(t,e,r){const{dimensions:n}=t,i=bn(Ae(),e.boundingBox.bottomRight,e.boundingBox.topLeft);let o=(r==null?void 0:r.subVolumePaddingPercentage)??Jwe,a=(r==null?void 0:r.subVolumeMinPadding)??Zwe;typeof o=="number"&&(o=[o,o,o]),typeof a=="number"&&(a=[a,a,a]);const s=bM(Ae(),i,o);_M(s,s),f2(s,s,a);const c=Xt(Ae(),i,s,2),l=bn(Ae(),e.boundingBox.topLeft,s),f=br(Ae(),l,c);f2(l,l,[0,0,0]),nC(l,l,n),f2(f,f,[0,0,0]),nC(f,f,n);const u={minX:l[0],maxX:f[0],minY:l[1],maxY:f[1],minZ:l[2],maxZ:f[2]};return g5(t.volumeId,u,{targetBuffer:{type:"Float32Array"}})}function e3e(t,e,r){const[n,i,o]=t.dimensions,a=t.voxelManager.getCompleteScalarDataArray(),s=n*i,c=Q4(t.imageData,e),l=a[c[2]*s+c[1]*n+c[0]],f=r.positiveSeedVariance??Xwe,u=Math.abs(l*f),d=l-u,h=l+u,g=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]];let p=1/0,v=1/0,w=1/0,m=-1/0,y=-1/0,x=-1/0;const C=c[2]*s+c[1]*n+c[0],S=new Set([C]),T=new Set([e]),_=[c];for(;_.length;){const E=_.shift(),[D,b,I]=E;p=E[0]<p?E[0]:p,v=E[1]<v?E[1]:v,w=E[2]<w?E[2]:w,m=E[0]>m?E[0]:m,y=E[1]>y?E[1]:y,x=E[2]>x?E[2]:x;for(let R=0,M=g.length;R<M;R++){const P=g[R],k=D+P[0],z=b+P[1],A=I+P[2];if(k<0||k>=n||z<0||z>=i||A<0||A>=o)continue;const L=A*s+z*n+k,N=a[L];if(S.has(L)||N<d||N>h)continue;const H=[k,z,A],ee=Hwe(t.imageData,H);S.add(L),T.add(ee),_.push(H)}}return{worldVoxels:Array.from(T),boundingBox:{topLeft:[p,v,w],bottomRight:[m,y,x]}}}function t3e(t,e,r){const{dimensions:n}=t,[i,o]=n,a=i*o,s=r.positiveSeedValue??Kwe,{worldVoxels:c}=e;for(let l=0,f=c.length;l<f;l++){const u=c[l],d=Q4(t.imageData,u),h=d[2]*a+d[1]*i+d[0];t.voxelManager.setAtIndex(h,s)}}function n3e(t,e,r,n){const[i,o]=t.dimensions,a=t.voxelManager.getCompleteScalarDataArray(),s=e.voxelManager.getCompleteScalarDataArray(),c=Q4(t.imageData,r),l=a[c[2]*i*o+c[1]*i+c[0]],f=n.negativeSeedVariance??Ywe,u=n.negativeSeedValue??qwe,d=Math.abs(l*f),h=l-d,g=l+d;for(let p=0,v=a.length;p<v;p++){const w=a[p];!s[p]&&(w<h||w>g)&&e.voxelManager.setAtIndex(p,u)}}async function r3e(t,e,r,n){const i=s0(t.volumeId);return t3e(i,e,n),n3e(t,i,r,n),i}async function TB(t,e,r,n){const i=ke.getVolume(t),o=e3e(i,e,n),a=Qwe(i,o,n),s=await r3e(a,o,e,n);return await K5(a.volumeId,s.volumeId),s}const i3e=Object.freeze(Object.defineProperty({__proto__:null,run:K5,runGrowCutForBoundingBox:SB,runGrowCutForSphere:CB,runOneClickGrowCut:TB},Symbol.toStringTag,{value:"Module"})),o3e=Object.freeze(Object.defineProperty({__proto__:null,IslandRemoval:n0,LabelmapMemo:ewe,VolumetricCalculator:Vc,contourAndFindLargestBidirectional:gB,createBidirectionalToolData:pB,createLabelmapVolumeForViewport:C5e,createMergedLabelmapForIndex:x5e,floodFill:JU,getBrushSizeForToolGroup:uwe,getBrushThresholdForToolGroup:dwe,getBrushToolInstances:wh,getHoveredContourSegmentationAnnotation:xB,getSegmentIndexAtLabelmapBorder:yB,getSegmentIndexAtWorldPoint:vB,getUniqueSegmentIndices:Qs,growCut:i3e,invalidateBrushCursor:mB,rectangleROIThresholdVolumeByRange:y5e,segmentContourAction:Cwe,setBrushSizeForToolGroup:lwe,setBrushThresholdForToolGroup:fwe,thresholdSegmentationByRange:hwe,thresholdVolumeByRange:XU,triggerSegmentationRender:mh,triggerSegmentationRenderBySegmentationId:W5},Symbol.toStringTag,{value:"Module"}));function a3e(t){let e="";const r=t[0]<0?"R":"L",n=t[1]<0?"A":"P",i=t[2]<0?"F":"H",o=[Math.abs(t[0]),Math.abs(t[1]),Math.abs(t[2])],a=1e-4;for(let s=0;s<3;s++)if(o[0]>a&&o[0]>o[1]&&o[0]>o[2])e+=r,o[0]=0;else if(o[1]>a&&o[1]>o[0]&&o[1]>o[2])e+=n,o[1]=0;else if(o[2]>a&&o[2]>o[0]&&o[2]>o[1])e+=i,o[2]=0;else if(o[0]>a&&o[1]>a&&o[0]===o[1])e+=r+n,o[0]=0,o[1]=0;else if(o[0]>a&&o[2]>a&&o[0]===o[2])e+=r+i,o[0]=0,o[2]=0;else if(o[1]>a&&o[2]>a&&o[1]===o[2])e+=n+i,o[1]=0,o[2]=0;else break;return e}function s3e(t){let e=t.replace("H","f");return e=e.replace("F","h"),e=e.replace("R","l"),e=e.replace("L","r"),e=e.replace("A","p"),e=e.replace("P","a"),e=e.toUpperCase(),e}const c3e=Object.freeze(Object.defineProperty({__proto__:null,getOrientationStringLPS:a3e,invertOrientationStringLPS:s3e},Symbol.toStringTag,{value:"Module"}));var QC;(function(t){t.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",t.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"})(QC||(QC={}));const N2=QC,e8={};function _B(t,e){const r=we(t),{viewportId:n}=r;e8[n]=e}function t8(t){const e=we(t),{viewportId:r}=e;return e8[r]}function l3e(t){return e8[t]}const{ViewportStatus:EB}=Da,{triggerEvent:C3}=cn,DB=!0,eS=new Map;function u3e(t,e){let r,n;if(t===void 0)throw new Error("playClip: element must not be undefined");const i=we(t);if(!i)throw new Error("playClip: element must be a valid Cornerstone enabled element");e||(e={}),e.dynamicCineEnabled=e.dynamicCineEnabled??!0;const{viewport:o}=i,a=m3e(o,e);let s=t8(t);const c=e.dynamicCineEnabled;if(c&&IB(t),s?tS(t,{stopDynamicCine:!c,viewportId:o.id}):(s={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:e.frameTimeVector??void 0,speed:e.frameTimeVectorSpeedMultiplier??1,reverse:e.reverse??!1,loop:e.loop??!0},_B(t,s)),s.dynamicCineEnabled=e.dynamicCineEnabled,(e.framesPerSecond<0||e.framesPerSecond>0)&&(s.framesPerSecond=Number(e.framesPerSecond),s.reverse=s.framesPerSecond<0,s.ignoreFrameTimeVector=!0),s.ignoreFrameTimeVector!==!0&&s.frameTimeVector&&s.frameTimeVector.length===a.numScrollSteps&&a.frameTimeVectorEnabled){const{timeouts:u,isTimeVarying:d}=f3e(s.frameTimeVector,s.speed);r=u,n=d}const l=()=>{const{numScrollSteps:u,currentStepIndex:d}=a;let h=d+(s.reverse?-1:1);const g=h<0||h>=u;if(!s.loop&&g){tS(t,{stopDynamicCine:!c,viewportId:o.id});const v={element:t};C3(t,N2.CLIP_STOPPED,v);return}h>=u?h=0:h<0&&(h=u-1);const p=h-d;if(p)try{a.scroll(p)}catch(v){console.warn("Play clip not scrolling",v),OB(s),C3(t,N2.CLIP_STOPPED,f);return}};if(c){const u=n8(o);u&&eS.set(u.volumeId,t)}a.play?s.framesPerSecond=a.play(e.framesPerSecond):r&&r.length>0&&n?(s.usingFrameTimeVector=!0,s.intervalId=window.setTimeout(function u(){s.intervalId=window.setTimeout(u,r[a.currentStepIndex]),l()},0)):(s.usingFrameTimeVector=!1,s.intervalId=window.setInterval(l,1e3/Math.abs(s.framesPerSecond)));const f={element:t};C3(t,N2.CLIP_STARTED,f)}function bB(t,e={}){tS(t,{stopDynamicCine:!0,...e})}function tS(t,e={stopDynamicCine:!0,viewportId:void 0}){const{stopDynamicCine:r,viewportId:n}=e,i=we(t);let o;const a=i==null?void 0:i.viewport;if(i){const{viewport:s}=i;o=t8(s.element)}else if(n)o=l3e(n);else return;o&&OB(o),a instanceof kd?a.pause():r&&a instanceof Xn&&IB(t)}function IB(t){const{viewport:e}=we(t);if(e instanceof Rn){const r=n8(e);if(r!=null&&r.isDynamicVolume()){const n=eS.get(r.volumeId);eS.delete(r.volumeId),n&&n!==t&&bB(n)}}}function f3e(t,e){let r,n,i,o=0;const a=t.length,s=[];let c=!1;for((typeof e!="number"||e<=0)&&(e=1),r=1;r<a;r++)i=Number(t[r])/e|0,s.push(i),r===1?n=i:i!==n&&(c=!0),o+=i;return s.length>0&&(c?i=o/s.length|0:i=s[0],s.push(i)),{timeouts:s,isTimeVarying:c}}function OB(t){const e=t.intervalId;typeof e<"u"&&(t.intervalId=void 0,t.usingFrameTimeVector?clearTimeout(e):clearInterval(e))}function n8(t){if(!(t instanceof Rn))return;const e=t.getAllVolumeIds();if(!(e!=null&&e.length))return;const n=e.find(i=>{var o;return(o=ke.getVolume(i))==null?void 0:o.isDynamicVolume()})??e[0];return ke.getVolume(n)}function d3e(t,e){const r=t.getImageIds();return{get numScrollSteps(){return r.length},get currentStepIndex(){return t.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(n){if(this.waitForRenderedCount<=e&&t.viewportStatus!==EB.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,Xf(t,{delta:n,debounceLoading:DB})}}}function h3e(t,e){return{get numScrollSteps(){return t.getNumberOfSlices()},get currentStepIndex(){return t.getSliceIndex()},get frameTimeVectorEnabled(){return!0},waitForRenderedCount:0,scroll(r){if(this.waitForRenderedCount<=e&&t.viewportStatus!==EB.RENDERED){this.waitForRenderedCount++;return}this.waitForRenderedCount=0,Xf(t,{delta:r,debounceLoading:DB})},play(r){return r&&t.setPlaybackRate(r/24),t.play(),t.getFrameRate()}}}function g3e(t,e){const{volumeId:r}=e,n={viewPlaneNormal:Ae(),scrollInfo:null},i=()=>{const o=t.getCamera();if(!n.scrollInfo||!rC(o.viewPlaneNormal,n.viewPlaneNormal)){const s=Lf(t,r);n.viewPlaneNormal=o.viewPlaneNormal,n.scrollInfo=s}return n.scrollInfo};return{get numScrollSteps(){return i().numScrollSteps},get currentStepIndex(){return i().currentStepIndex},get frameTimeVectorEnabled(){const o=t.getCamera(),a=e.direction.slice(6,9).map(c=>-c),s=gt(a,o.viewPlaneNormal);return du(s,1)},scroll(o){i().currentStepIndex+=o,Xf(t,{delta:o})}}}function p3e(t){return{get numScrollSteps(){return t.numTimePoints},get currentStepIndex(){return t.timePointIndex},get frameTimeVectorEnabled(){return!1},scroll(e){t.scroll(e)}}}function m3e(t,e){if(t instanceof Jn)return d3e(t,e.waitForRendered??30);if(t instanceof Rn){const r=n8(t);return e.dynamicCineEnabled&&(r!=null&&r.isDynamicVolume())?p3e(r):g3e(t,r)}if(t instanceof kd)return h3e(t,e.waitForRendered??30);throw new Error("Unknown viewport type")}const v3e=Object.freeze(Object.defineProperty({__proto__:null,Events:N2,addToolState:_B,getToolState:t8,playClip:u3e,stopClip:bB},Symbol.toStringTag,{value:"Module"}));function y3e(t,e){var n,i,o;const r=(e==null?void 0:e.knotsRatioPercentage)||30;return!((o=(i=(n=t==null?void 0:t.data)==null?void 0:n.contour)==null?void 0:i.polyline)!=null&&o.length)||r<=0}function w3e(t,e){const r=ba(),n=br(Ae(),e,t),i=Math.abs(t[0])>.1?xt(-t[1],t[0],0):xt(0,-t[2],t[1]);return kT(r,e,n,i),r}function Fm(t,e=Math.floor(Math.random()*(t.length-1))){if(e===0)return 0;const r=[...t],{length:n}=t;for(let i=0;i<n;i++)t[i]=r[(i+e+n)%n];return e}function MB(t,e){if(y3e(t,e))return!1;const{viewPlaneNormal:r}=t.metadata,{closed:n,polyline:i}=t.data.contour,o=w3e(r,t.data.contour.polyline[0]),a=t.data.contour.polyline.map(f=>{const u=Pt(Ae(),f,o);return[u[0],u[1]]});let s=n?Fm(a):0,c=HC(a,0,a.length,(e==null?void 0:e.knotsRatioPercentage)||30);if(c===a)return!1;Fm(c,-s);for(let f=1;f<(e==null?void 0:e.loop);f++)s=n?Fm(c):0,c=HC(c,0,a.length,(e==null?void 0:e.knotsRatioPercentage)||30),Fm(c,-s);const l=Or(ba(),o);return t.data.contour.polyline=c.map(f=>Pt([0,0,0],[...f,0],l)),!0}const x3e={smoothAnnotation:MB},C3e=Object.freeze(Object.defineProperty({__proto__:null,default:x3e,smoothAnnotation:MB},Symbol.toStringTag,{value:"Module"})),S3e=Object.freeze(Object.defineProperty({__proto__:null,getBoundsIJKFromRectangleAnnotations:YU,isAxisAlignedRectangle:fB},Symbol.toStringTag,{value:"Module"})),RB={};function PB(t,e){const r=we(t),{viewportId:n}=r;RB[n]=e}function xh(t){const e=we(t),{viewportId:r}=e;return RB[r]}const kf=Wt.Prefetch,LB=0;function T3e(t,e){t=Math.round(t)||0,e=Math.round(e)||0;const r=[];let n=e-t+1;if(n<=0)return r;for(;n--;)r[n]=e--;return r}function _3e(t,e){let r=0,n=t.length-1;return t.forEach((i,o)=>{i<e?r=Math.max(o,r):i>e&&(n=Math.min(o,n))}),{low:r,high:n}}function Ch(t){const e=we(t);if(!e)return null;const{viewport:r}=e;return r instanceof Jn?{currentImageIdIndex:r.getCurrentImageIdIndex(),imageIds:r.getImageIds()}:null}function q5(t){return function(e){const r=e.detail;let n;try{n=Ch(t)}catch{return}if(!n||!n.imageIds||n.imageIds.length===0)return;const o=n.imageIds.indexOf(r.imageId);if(o<0)return;const a=xh(t);!a||!a.indicesToRequest||!a.indicesToRequest.length||a.indicesToRequest.push(o)}}const E3e=t=>{const e=new Set(t.imageIds);return r=>r.type!==kf||!e.has(r.additionalDetails.imageId)};let Ng={maxImagesToPrefetch:1/0,preserveExistingPool:!0},nS;const D3e=10;function AB(t){var g,p;const e=xh(t);if(!e)return;const r=e||{},n=Ch(t);if(!((g=n==null?void 0:n.imageIds)!=null&&g.length)){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:i}=n;if(r.enabled=r.enabled&&(((p=r.indicesToRequest)==null?void 0:p.length)??0)>0,r.enabled===!1)return;function o(v){const w=r.indicesToRequest.indexOf(v);w>-1&&r.indicesToRequest.splice(w,1)}if(e.indicesToRequest.sort((v,w)=>v-w),r.indicesToRequest.slice().forEach(function(v){const w=n.imageIds[v];if(!w)return;(Math.abs(i-v)<6?ke.getImageLoadObject(w):ke.isLoaded(w))&&o(v)}),!r.indicesToRequest.length)return;Ng.preserveExistingPool||ei.clearRequestStack(kf);const s=_3e(r.indicesToRequest,n.currentImageIdIndex);let c,l,f=s.low,u=s.high;const d=[];for(;f>=0||u<r.indicesToRequest.length;){const v=n.currentImageIdIndex,w=v-r.indicesToRequest[f]>Ng.maxImagesToPrefetch,m=r.indicesToRequest[u]-v>Ng.maxImagesToPrefetch,y=!w&&f>=0,x=!m&&u<r.indicesToRequest.length;if(!x&&!y)break;y&&(l=r.indicesToRequest[f--],c=n.imageIds[l],d.push(c)),x&&(l=r.indicesToRequest[u++],c=n.imageIds[l],d.push(c))}const h=(v,w)=>us(v,w);d.forEach(v=>{const w={requestType:kf};ei.addRequest(h.bind(null,v,w),kf,{imageId:v},LB)})}function rS(t){clearTimeout(nS),nS=setTimeout(function(){const e=t.target;try{AB(e)}catch{return}},D3e)}function b3e(t){const e=Ch(t);if(!e||!e.imageIds||e.imageIds.length===0){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const r={indicesToRequest:T3e(0,e.imageIds.length-1),enabled:!0,direction:1},n=r.indicesToRequest.indexOf(e.currentImageIdIndex);r.indicesToRequest.splice(n,1),PB(t,r),AB(t),t.removeEventListener($e.STACK_NEW_IMAGE,rS),t.addEventListener($e.STACK_NEW_IMAGE,rS);const i=q5(t);We.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,i),We.addEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,i)}function I3e(t){clearTimeout(nS),t.removeEventListener($e.STACK_NEW_IMAGE,rS);const e=q5(t);We.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,e);const r=xh(t);r&&r.indicesToRequest.length&&(r.enabled=!1,ei.clearRequestStack(kf))}function O3e(){return Ng}function M3e(t){Ng=t}const R3e={enable:b3e,disable:I3e,getConfiguration:O3e,setConfiguration:M3e};let Ap={maxImagesToPrefetch:1/0,minBefore:2,maxAfter:2,directionExtraImages:10,preserveExistingPool:!1},iS;const P3e=5,L3e=t=>{var n;const e=Ch(t);if(!e)return;if(!((n=e.imageIds)!=null&&n.length)){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}i8(t),r8(t),t.removeEventListener($e.STACK_NEW_IMAGE,oS),t.addEventListener($e.STACK_NEW_IMAGE,oS);const r=q5(t);We.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,r),We.addEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,r)};function r8(t){var l,f;const e=Ch(t);if(!e)return;if(!((l=e==null?void 0:e.imageIds)!=null&&l.length)){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const r=xh(t);if(!r)return;const n=r||{};if(n.enabled=n.enabled&&(((f=n.indicesToRequest)==null?void 0:f.length)??0)>0,n.enabled===!1)return;function i(u){const d=n.indicesToRequest.indexOf(u);d>-1&&n.indicesToRequest.splice(d,1)}const o=n.indicesToRequest.slice(),{currentImageIdIndex:a}=e;if(o.forEach(u=>{const d=e.imageIds[u];if(!d)return;(Math.abs(a-u)<6?ke.getImageLoadObject(d):ke.isLoaded(d))&&i(u)}),!n.indicesToRequest.length)return;Ap.preserveExistingPool||ei.filterRequests(E3e(e));function s(u){var v,w;const d=e.imageIds.indexOf(u);i(d);const h=ke.getCachedImageBasedOnImageURI(u),{stats:g}=n,p=((v=h==null?void 0:h.image)==null?void 0:v.decodeTimeInMS)||0;if(p){g.imageIds.set(u,p),g.decodeTimeInMS+=p;const m=((w=h==null?void 0:h.image)==null?void 0:w.loadTimeInMS)||0;g.loadTimeInMS+=m}if(!n.indicesToRequest.length&&h!=null&&h.sizeInBytes){const{sizeInBytes:m}=h,y=ke.getMaxCacheSize()/4/m;if(!n.cacheFill)g.initialTime=Date.now()-g.start,g.initialSize=g.imageIds.size,i8(t,y),r8(t);else if(g.imageIds.size){g.fillTime=Date.now()-g.start;const{size:x}=g.imageIds;g.fillSize=x}}}const c=(u,d)=>us(u,d).then(()=>s(u));n.indicesToRequest.forEach(u=>{const d=e.imageIds[u],h={requestType:kf};ei.addRequest(c.bind(null,d,h),kf,{imageId:d},LB)})}function oS(t){clearTimeout(iS),iS=setTimeout(function(){const e=t.target;try{i8(e),r8(e)}catch{return}},P3e)}const A3e=t=>t<0?-1:1,i8=(t,e)=>{var d;const r=Ch(t);if(!r)return;if(!((d=r.imageIds)!=null&&d.length)){console.warn("CornerstoneTools.stackPrefetch: No images in stack.");return}const{currentImageIdIndex:n}=r;let{maxAfter:i=2,minBefore:o=2}=Ap;const{directionExtraImages:a=10}=Ap,s=xh(t)||{indicesToRequest:[],currentImageIdIndex:n,stackCount:0,enabled:!0,direction:1,stats:{start:Date.now(),imageIds:new Map,decodeTimeInMS:0,loadTimeInMS:0,totalBytes:0}},c=n-s.currentImageIdIndex;if(s.direction=A3e(c),s.currentImageIdIndex=n,s.enabled=!0,s.stackCount<100&&(s.stackCount+=a),Math.abs(c)>i||!c)if(s.stackCount=0,e){const h=n/r.imageIds.length;o=Math.ceil(e*h),i=Math.ceil(e*(1-h)),s.cacheFill=!0}else s.cacheFill=!1;else c<0?(o+=s.stackCount,i=0):(i+=s.stackCount,o=0);const l=Math.max(0,n-o),f=Math.min(r.imageIds.length-1,n+i),u=[];for(let h=n+1;h<=f;h++)u.push(h);for(let h=n-1;h>=l;h--)u.push(h);s.indicesToRequest=u,PB(t,s)};function N3e(t){clearTimeout(iS),t.removeEventListener($e.STACK_NEW_IMAGE,oS);const e=q5(t);We.removeEventListener($e.IMAGE_CACHE_IMAGE_REMOVED,e);const r=xh(t);r&&(r.enabled=!1)}function k3e(){return Ap}function V3e(t){Ap=t}const F3e={enable:L3e,disable:N3e,getConfiguration:k3e,setConfiguration:V3e},U3e=Object.freeze(Object.defineProperty({__proto__:null,isViewportPreScaled:ec},Symbol.toStringTag,{value:"Module"}));function B3e(t,e){let r;const n=e.frameNumbers||[...Array(t.numTimePoints).keys()];if(!e.maskVolumeId&&!e.worldCoordinate)throw new Error("You should provide either maskVolumeId or imageCoordinate");if(e.maskVolumeId&&e.worldCoordinate)throw new Error("You can only use one of maskVolumeId or imageCoordinate");if(e.maskVolumeId){const i=ke.getVolume(e.maskVolumeId);if(!i)throw new Error("Segmentation volume not found");const[o,a]=W3e(n,t,i);return[o,a]}return e.worldCoordinate?G3e(n,e.worldCoordinate,t):r}function G3e(t,e,r){const{dimensions:n,imageData:i}=r,o=i.worldToIndex(e);if(o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.floor(o[2]),!ur(o,n))throw new Error("outside bounds");const a=n[0],s=n[0]*n[1],c=[];return t.forEach(l=>{const f=o[2]*s+o[1]*a+o[0];c.push(r.voxelManager.getAtIndexAndTimePoint(f,l))}),c}function W3e(t,e,r){const{imageData:n}=r,i=r.voxelManager,o=i.getScalarDataLength(),a=[];a.length=o;let s=0;for(let d=0,h=o;d<h;d++)i.getAtIndex(d)!==0&&(a[s++]=d);a.length=s;const c=[],l=e.voxelManager.getScalarDataLength()===o&&JSON.stringify(e.spacing)===JSON.stringify(r.spacing),f=[];if(l){for(let d=0;d<a.length;d++){const h=[],g=a[d];for(let p=0;p<t.length;p++)h.push(e.voxelManager.getAtIndexAndTimePoint(g,t[p]));c.push(h),f.push(i.toIJK(g))}return[c,f]}const u=({pointLPS:d,value:h,pointIJK:g})=>{if(h===0)return;const p=m4(e.imageData,e.dimensions,e.spacing,d);let v=0;const w=new Map;t.forEach(x=>w.set(x,0));const m=({index:x})=>{for(let C=0;C<t.length;C++){const S=e.voxelManager.getAtIndexAndTimePoint(x,t[C]),T=t[C];w.set(T,w.get(T)+S)}v++};e.voxelManager.forEach(m,{imageData:e.imageData,boundsIJK:p});const y=[];w.forEach(x=>{y.push(x/v)}),f.push(g),c.push(y)};return r.voxelManager.forEach(u,{imageData:n}),[c,f]}function NB(t,e){const r=t.getScalarDataLength(),n=new Float32Array(r);for(const i of e){const o=t.getTimePointScalarData(i);for(let a=0;a<r;a++)n[a]+=o[a]}return n}function z3e(t,e){const r=NB(t,e),n=e.length;for(let i=0;i<r.length;i++)r[i]/=n;return r}const kB={[ad.SUM]:(t,e,r)=>{const n=NB(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[ad.AVERAGE]:(t,e,r)=>{const n=z3e(t,e);for(let i=0;i<n.length;i++)r(i,n[i])},[ad.SUBTRACT]:(t,e,r)=>{if(e.length!==2)throw new Error("Please provide only 2 time points for subtraction.");const n=t.getScalarDataLength(),i=t.getTimePointScalarData(e[0]),o=t.getTimePointScalarData(e[1]);for(let a=0;a<n;a++){const s=i[a]-o[a];r(a,s)}}};function $3e(t,e,r){const{frameNumbers:n}=r,i=n||[...Array(t.numTimePoints).keys()];if(i.length<=1)throw new Error("Please provide two or more time points");const o=t.voxelManager,a=o.getScalarDataLength(),s=kB[e];if(!s)throw new Error(`Unsupported operation: ${e}`);const c=new Float32Array(a);return s(o,i,(l,f)=>{c[l]=f}),c}function j3e(t,e,r){const{frameNumbers:n,targetVolume:i}=r;if(!i)throw new Error("A target volume must be provided");const o=n||[...Array(t.numTimePoints).keys()];if(o.length<=1)throw new Error("Please provide two or more time points");const a=t.voxelManager,s=i.voxelManager,c=kB[e];if(!c)throw new Error(`Unsupported operation: ${e}`);c(a,o,(l,f)=>{s.setAtIndex(l,f)}),s.resetModifiedSlices();for(let l=0;l<i.dimensions[2];l++)s.modifiedSlices.add(l)}const H3e=Object.freeze(Object.defineProperty({__proto__:null,generateImageFromTimeData:$3e,getDataInTime:B3e,updateVolumeFromTimeData:j3e},Symbol.toStringTag,{value:"Module"}));function VB(t,e){const r=e*3;if(r<t.length)return xt(t[r],t[r+1],t[r+2])}function FB(t){const e=t.getLines().getData();let r=0;const n=new Map;for(;r<e.length;){const s=e[r++],c=[];for(let l=0;l<s;l++)c.push(e[r+l]);n.set(c[0],c),r+=s}const i=[],o=s=>{for(const[c,l]of s.entries())if(l!==void 0)return c;return-1};let a=o(n);for(;a!==-1;){const s=[a];for(;n.has(a);){const c=n.get(a)[1];n.has(c)&&s.push(c),n.delete(a),a=c}i.push(s),a=o(n)}return i.length?i:void 0}function UB(t){const e=FB(t);if(!e)return;const r=t.getPoints().getData();return e.map(n=>n.map(i=>VB(r,i)))}const K3e=Object.freeze(Object.defineProperty({__proto__:null,getPoint:VB,getPolyDataPointIndexes:FB,getPolyDataPoints:UB},Symbol.toStringTag,{value:"Module"}));var zo;(function(t){t.Top="top",t.Left="left",t.Bottom="bottom",t.Right="right"})(zo||(zo={}));const q3e=Object.freeze(Object.defineProperty({__proto__:null,get ColorbarRangeTextPosition(){return zo}},Symbol.toStringTag,{value:"Module"})),Rc=t=>t&&t.upper>t.lower,uy=t=>!!t&&t.width>0&&t.height>0,Np=(t,e)=>!!t&&!!e&&t.lower===e.lower&&t.upper===e.upper,BB=(t,e)=>!!t&&!!e&&t.width===e.width&&t.height===e.height,X3e=(t,e,r)=>[t[0]*(1-r)+e[0]*r,t[1]*(1-r)+e[1]*r,t[2]*(1-r)+e[2]*r],{clamp:Y3e}=cn;class o8{constructor(e){o8.validateProps(e);const{colormap:r,size:n={width:20,height:100},imageRange:i={lower:0,upper:1},voiRange:o={lower:0,upper:1},container:a,showFullPixelValueRange:s=!1}=e;this._colormap=r,this._imageRange=i,this._voiRange=o,this._showFullImageRange=s,this._canvas=this._createRootElement(n),a&&this.appendTo(a)}get colormap(){return this._colormap}set colormap(e){this._colormap=e,this.render()}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!uy(e)||BB(r,e)||(this._setCanvasSize(r,e),this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!Rc(e)||Np(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!Rc(e)||Np(e,this._voiRange)||(this._voiRange=e,this.render())}get showFullImageRange(){return this._showFullImageRange}set showFullImageRange(e){e!==this._showFullImageRange&&(this._showFullImageRange=e,this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}dispose(){const{_canvas:e}=this,{parentElement:r}=e;r==null||r.removeChild(e)}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!uy(r))throw new Error('Invalid "size"');if(n&&!Rc(n))throw new Error('Invalid "imageRange"');if(i&&!Rc(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createRootElement(e){const r=document.createElement("canvas");return Object.assign(r.style,{position:"absolute",top:"0",left:"0",pointerEvents:"none",boxSizing:"border-box"}),this._setCanvasSize(r,e),r}render(){if(!this._canvas.isConnected)return;const{_colormap:e}=this,{RGBPoints:r}=e,n=r.length/4,i=w=>{const m=4*w;if(!(w<0||w>=n))return{index:w,position:r[m],color:[r[m+1],r[m+2],r[m+3]]}},{width:o,height:a}=this._canvas,s=this._canvas.getContext("2d");if(!s)return;const c=o>a,l=c?o:a,{_voiRange:f}=this,u=this._showFullImageRange?this._imageRange:{...f},{windowWidth:d}=nh(f.lower,f.upper);let h,g=i(0);const p=(u.upper-u.lower)/(l-1);let v=u.lower;for(let w=0;w<l;w++){const m=(v-f.lower)/d;if(g)for(let C=g.index;C<n&&!(m<=g.position);C++)h=g,g=i(C+1);let y;if(!h)y=[...g.color];else if(!g)y=[...h.color];else{const C=(m-h.position)/(g.position-h.position);y=X3e(h.color,g.color,C)}const x=y.map(C=>Y3e(Math.round(C*255),0,255));s.fillStyle=`rgb(${x[0]}, ${x[1]}, ${x[2]})`,c?s.fillRect(w,0,1,a):s.fillRect(0,a-w-1,o,1),v+=p}}}const lf={FONT:"10px Arial",COLOR:"white",TICK_SIZE:5,TICK_WIDTH:1,TICK_LABEL_MARGIN:3,MAX_NUM_TICKS:8,TICKS_STEPS:[1,2.5,5,10]};class a8{constructor(e){a8.validateProps(e);const{top:r=0,left:n=0,size:i={width:20,height:100},imageRange:o={lower:0,upper:1},voiRange:a={lower:0,upper:1},ticks:s,container:c,showFullPixelValueRange:l=!1}=e,{style:f,position:u}=s??{};this._imageRange=o,this._voiRange=a,this._font=(f==null?void 0:f.font)??lf.FONT,this._color=(f==null?void 0:f.color)??lf.COLOR,this._tickSize=(f==null?void 0:f.tickSize)??lf.TICK_SIZE,this._tickWidth=(f==null?void 0:f.tickWidth)??lf.TICK_WIDTH,this._labelMargin=(f==null?void 0:f.labelMargin)??lf.TICK_LABEL_MARGIN,this._maxNumTicks=(f==null?void 0:f.maxNumTicks)??lf.MAX_NUM_TICKS,this._rangeTextPosition=u??zo.Right,this._showFullPixelValueRange=l,this._canvas=this._createCanvasElement(i,r,n),c&&this.appendTo(c)}get size(){const{width:e,height:r}=this._canvas;return{width:e,height:r}}set size(e){const{_canvas:r}=this;!uy(e)||BB(r,e)||(this._setCanvasSize(r,e),this.render())}get top(){return Number.parseInt(this._canvas.style.top)}set top(e){const{_canvas:r}=this,n=this.top;e!==n&&(r.style.top=`${e}px`,this.render())}get left(){return Number.parseInt(this._canvas.style.left)}set left(e){const{_canvas:r}=this,n=this.left;e!==n&&(r.style.left=`${e}px`,this.render())}get imageRange(){return{...this._imageRange}}set imageRange(e){!Rc(e)||Np(e,this._imageRange)||(this._imageRange=e,this.render())}get voiRange(){return{...this._voiRange}}set voiRange(e){!Rc(e)||Np(e,this._voiRange)||(this._voiRange=e,this.render())}get tickSize(){return this._tickSize}set tickSize(e){e!==this._tickSize&&(this._tickSize=e,this.render())}get tickWidth(){return this._tickWidth}set tickWidth(e){e!==this._tickWidth&&(this._tickWidth=e,this.render())}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this.render())}get showFullPixelValueRange(){return this._showFullPixelValueRange}set showFullPixelValueRange(e){e!==this._showFullPixelValueRange&&(this._showFullPixelValueRange=e,this.render())}get visible(){return this._canvas.style.display==="block"}set visible(e){e!==this.visible&&(this._canvas.style.display=e?"block":"none",e&&this.render())}appendTo(e){e.appendChild(this._canvas),this.render()}static validateProps(e){const{size:r,imageRange:n,voiRange:i}=e;if(r&&!uy(r))throw new Error('Invalid "size"');if(n&&!Rc(n))throw new Error('Invalid "imageRange"');if(i&&!Rc(i))throw new Error('Invalid "voiRange"')}_setCanvasSize(e,r){const{width:n,height:i}=r;e.width=n,e.height=i,Object.assign(e.style,{width:`${n}px`,height:`${i}px`})}_createCanvasElement(e,r,n){const i=document.createElement("canvas");return Object.assign(i.style,{display:"none",position:"absolute",boxSizing:"border-box",top:`${r}px`,left:`${n}px`}),this._setCanvasSize(i,e),i}_getTicks(e){const{lower:r,upper:n}=e,o=(n-r)/(this._maxNumTicks-1),a=Math.pow(10,-Math.floor(Math.log10(Math.abs(o)))),s=o*a,l=lf.TICKS_STEPS.find(g=>g>=s)/a,f=Math.ceil(n/l)*l,u=Math.floor(r/l)*l,d=Math.round((f-u)/l)+1,h=[];for(let g=0;g<d;g++)h.push(u+g*l);return{scaleMin:u,scaleMax:f,step:l,ticks:h}}_getLeftTickInfo({position:e,labelMeasure:r}){const{width:n}=this._canvas,o=[n-this.tickSize-r.width-this._labelMargin,e],a={start:[n-this._tickSize,e],end:[n,e]};return{labelPoint:o,tickPoints:a}}_getRightTickInfo({position:e}){const r=[this._tickSize+this._labelMargin,e],n={start:[0,e],end:[this._tickSize,e]};return{labelPoint:r,tickPoints:n}}_getTopTickInfo({position:e,labelMeasure:r}){throw new Error("Not implemented")}_getBottomTickInfo({position:e,labelMeasure:r}){throw new Error("Not implemented")}render(){const{_canvas:e}=this;if(!e.isConnected||!this.visible)return;const{width:r,height:n}=e,i=r>=n,o=i?r:n,a=e.getContext("2d"),{_voiRange:s}=this,c=this._showFullPixelValueRange?this._imageRange:{...s},l=c.upper-c.lower,{ticks:f}=this._getTicks(c);a.clearRect(0,0,r,n),a.font=this._font,a.textBaseline="middle",a.fillStyle=this._color,a.strokeStyle=this._color,a.lineWidth=this.tickWidth,f.forEach(u=>{let d=Math.round(o*((u-c.lower)/l));if(i||(d=n-d),d<0||d>o)return;const h=u.toString(),g=a.measureText(h);let p;i?this._rangeTextPosition===zo.Top?p=this._getTopTickInfo({position:d,labelMeasure:g}):p=this._getBottomTickInfo({position:d,labelMeasure:g}):this._rangeTextPosition===zo.Left?p=this._getLeftTickInfo({position:d,labelMeasure:g}):p=this._getRightTickInfo({position:d});const{labelPoint:v,tickPoints:w}=p,{start:m,end:y}=w;return a.beginPath(),a.moveTo(m[0],m[1]),a.lineTo(y[0],y[1]),a.fillText(h,v[0],v[1]),a.stroke(),d})}}function J3e(t,e,r){return(t>=e?[zo.Top,zo.Bottom]:[zo.Left,zo.Right]).includes(r)}class Z3e{constructor({id:e,container:r}){this._containerResizeCallback=n=>{let i,o;const{contentRect:a,contentBoxSize:s}=n[0];a?(i=a.width,o=a.height):s!=null&&s.length&&(i=s[0].inlineSize,o=s[0].blockSize),this._containerSize={width:i,height:o},this.onContainerResize()},this._id=e,this._containerSize={width:0,height:0},this._rootElement=this.createRootElement(e),this._containerResizeObserver=new ResizeObserver(this._containerResizeCallback),r&&this.appendTo(r)}get id(){return this._id}get rootElement(){return this._rootElement}appendTo(e){const{_rootElement:r,_containerResizeObserver:n}=this,{parentElement:i}=r;!e||e===i||(i&&n.unobserve(i),e.appendChild(r),n.observe(e))}destroy(){const{_rootElement:e,_containerResizeObserver:r}=this,{parentElement:n}=e;n==null||n.removeChild(e),r.disconnect()}get containerSize(){return{...this._containerSize}}createRootElement(e){const r=document.createElement("div");return r.id=e,r.classList.add("widget"),Object.assign(r.style,{width:"100%",height:"100%"}),r}onContainerResize(){}}const Hh={MULTIPLIER:1,RANGE_TEXT_POSITION:zo.Right,TICKS_BAR_SIZE:50};class kp extends Z3e{constructor(e){var r;super(e),this._isMouseOver=!1,this._isInteracting=!1,this._mouseOverCallback=n=>{this._isMouseOver=!0,this.showTicks(),n.stopPropagation()},this._mouseOutCallback=n=>{this._isMouseOver=!1,this.hideTicks(),n.stopPropagation()},this._mouseDownCallback=n=>{this._isInteracting=!0,this.showTicks(),this._addVOIEventListeners(n),n.stopPropagation()},this._mouseDragCallback=(n,i)=>{const o=this.getVOIMultipliers(),a=this._getPointsFromMouseEvent(n),{points:s,voiRange:c}=i,l=ya(Vt(),a.local,s.local),f=l[0]*o[0],u=l[1]*o[1];if(!f&&!u)return;const{lower:d,upper:h}=c;let{windowWidth:g,windowCenter:p}=nh(d,h);g=Math.max(g+f,1),p+=u;const v=ru(g,p);this.voiRange=v,n.stopPropagation(),n.preventDefault()},this._mouseUpCallback=n=>{this._isInteracting=!1,this.hideTicks(),this._removeVOIEventListeners(),n.stopPropagation()},this._eventListenersManager=new VA,this._colormaps=kp.getColormapsMap(e),this._activeColormapName=kp.getInitialColormapName(e),this._canvas=this._createCanvas(e),this._ticksBar=this._createTicksBar(e),this._rangeTextPosition=((r=e.ticks)==null?void 0:r.position)??Hh.RANGE_TEXT_POSITION,this._canvas.appendTo(this.rootElement),this._ticksBar.appendTo(this.rootElement),this._addRootElementEventListeners()}get activeColormapName(){return this._activeColormapName}set activeColormapName(e){if(e===this._activeColormapName)return;const r=this._colormaps.get(e);if(!r){console.warn(`Invalid colormap name (${e})`);return}this._activeColormapName=e,this._canvas.colormap=r}get imageRange(){return this._canvas.imageRange}set imageRange(e){this._canvas.imageRange=e,this._ticksBar.imageRange=e}get voiRange(){return this._canvas.voiRange}set voiRange(e){const{voiRange:r}=this._canvas;!Rc(e)||Np(e,r)||(this._canvas.voiRange=e,this._ticksBar.voiRange=e,this.onVoiChange(e))}get showFullImageRange(){return this._canvas.showFullImageRange}set showFullImageRange(e){this._canvas.showFullImageRange=e,this._ticksBar.showFullPixelValueRange=e}destroy(){super.destroy(),this._eventListenersManager.reset()}createRootElement(){const e=document.createElement("div");return Object.assign(e.style,{position:"relative",fontSize:"0",width:"100%",height:"100%"}),e}onContainerResize(){super.onContainerResize(),this.updateTicksBar(),this._canvas.size=this.containerSize}getVOIMultipliers(){return[Hh.MULTIPLIER,Hh.MULTIPLIER]}onVoiChange(e){}showTicks(){this.updateTicksBar(),this._ticksBar.visible=!0}hideTicks(){this._isInteracting||this._isMouseOver||(this._ticksBar.visible=!1)}static getColormapsMap(e){const{colormaps:r}=e;return r.reduce((n,i)=>n.set(i.Name,i),new Map)}static getInitialColormapName(e){const{activeColormapName:r,colormaps:n}=e;return!!r&&n.some(o=>o.Name===r)?r:n[0].Name}_createCanvas(e){const{imageRange:r,voiRange:n,showFullPixelValueRange:i}=e,o=this._colormaps.get(this._activeColormapName);return new o8({colormap:o,imageRange:r,voiRange:n,showFullPixelValueRange:i})}_createTicksBar(e){const r=e.ticks;return new a8({imageRange:e.imageRange,voiRange:e.voiRange,ticks:r,showFullPixelValueRange:e.showFullPixelValueRange})}_getPointsFromMouseEvent(e){const{rootElement:r}=this,n=[e.clientX,e.clientY],i=[e.pageX,e.pageY],o=r.getBoundingClientRect(),a=[i[0]-o.left-window.pageXOffset,i[1]-o.top-window.pageYOffset];return{client:n,page:i,local:a}}updateTicksBar(){const{width:e,height:r}=this.containerSize;if(e===0&&r===0)return;const{_ticksBar:n,_rangeTextPosition:i}=this,o=e>=r,a=o?e:Hh.TICKS_BAR_SIZE,s=o?Hh.TICKS_BAR_SIZE:r;if(!J3e(e,r,i))throw new Error("Invalid rangeTextPosition value for the current colobar orientation");let c,l;n.size={width:a,height:s},o?(l=0,c=i===zo.Top?-s:r):(c=0,l=i===zo.Left?-a:e),n.top=c,n.left=l}_addRootElementEventListeners(){const{_eventListenersManager:e}=this,{rootElement:r}=this;e.addEventListener(r,"mouseover",this._mouseOverCallback),e.addEventListener(r,"mouseout",this._mouseOutCallback),e.addEventListener(r,"mousedown",this._mouseDownCallback)}_addVOIEventListeners(e){const{_eventListenersManager:r}=this,n=this._getPointsFromMouseEvent(e),i={...this._canvas.voiRange},o={points:n,voiRange:i};this._removeVOIEventListeners(),r.addEventListener(document,"voi.mouseup",this._mouseUpCallback),r.addEventListener(document,"voi.mousemove",a=>this._mouseDragCallback(a,o))}_removeVOIEventListeners(){const{_eventListenersManager:e}=this;e.removeEventListener(document,"voi.mouseup"),e.removeEventListener(document,"voi.mousemove")}}const S3=4;function Q3e(t,e,r){if(QA(t,e)==="PT"){const{clientWidth:i,clientHeight:o}=t.element,a=5/Math.max(i,o),s=ec(t,e),{fixedPTWindowWidth:c=!0}={},l=c?0:a;return s?[l,a]:[l,S3]}return[S3,S3]}const{Events:El}=Da,Um={lower:-1e3,upper:1e3};class K0 extends kp{constructor(e){const{element:r,volumeId:n}=e,i=K0._getImageRange(r,n),o=K0._getVOIRange(r,n);super({...e,imageRange:i,voiRange:o}),this.autoHideTicks=()=>{if(this._hideTicksTimeoutId)return;const a=this._hideTicksTime-Date.now();a<=0?this.hideTicks():this._hideTicksTimeoutId=window.setTimeout(()=>{this._hideTicksTimeoutId=0,this.autoHideTicks()},a)},this._stackNewImageCallback=()=>{this.imageRange=K0._getImageRange(this._element)},this._imageVolumeModifiedCallback=a=>{const{volumeId:s}=a.detail;if(s!==this._volumeId)return;const{_element:c}=this;this.imageRange=K0._getImageRange(c,s)},this._viewportVOIModifiedCallback=a=>{const{viewportId:s,volumeId:c,range:l,colormap:f}=a.detail,{viewport:u}=this.enabledElement;s!==u.id||c!==this._volumeId||(this.voiRange=l,f&&(this.activeColormapName=f.name),this.showAndAutoHideTicks())},this._viewportColormapModifiedCallback=a=>{const{viewportId:s,colormap:c,volumeId:l}=a.detail,{viewport:f}=this.enabledElement;s!==f.id||l!==this._volumeId||(this.activeColormapName=c.name)},this._element=r,this._volumeId=n,this._addCornerstoneEventListener()}get element(){return this._element}get enabledElement(){return we(this._element)}getVOIMultipliers(){const{viewport:e}=this.enabledElement;return Q3e(e,this._volumeId)}onVoiChange(e){super.onVoiChange(e);const{viewport:r}=this.enabledElement;if(r instanceof Jn)r.setProperties({voiRange:e}),r.render();else if(r instanceof Rn){const{_volumeId:n}=this,i=a1(n);r.setProperties({voiRange:e},n),i.forEach(o=>o.render())}}static _getImageRange(e,r){const n=we(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Um;const s=o.getMapper().getInputData().getPointData().getScalars();let c;if(s)c=s.getRange();else{if(!r)throw new Error("volumeId is required when scalarData is not available");const l=ke.getVolume(r),[f,u]=l.voxelManager.getRange();c=[f,u]}return c[0]===0&&c[1]===0?Um:{lower:c[0],upper:c[1]}}static _getVOIRange(e,r){const n=we(e),{viewport:i}=n,o=i.getImageActor(r);if(!o)return Um;const a=o.getProperty().getRGBTransferFunction(0).getRange();return a[0]===0&&a[1]===0?Um:{lower:a[0],upper:a[1]}}showAndAutoHideTicks(e=1e3){this._hideTicksTime=Date.now()+e,this.showTicks(),this.autoHideTicks()}_addCornerstoneEventListener(){const{_element:e}=this;We.addEventListener(El.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.addEventListener(El.STACK_NEW_IMAGE,this._stackNewImageCallback),e.addEventListener(El.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.addEventListener(El.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}destroy(){super.destroy();const{_element:e}=this;We.removeEventListener(El.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedCallback),e.removeEventListener(El.STACK_NEW_IMAGE,this._stackNewImageCallback),e.removeEventListener(El.VOI_MODIFIED,this._viewportVOIModifiedCallback),e.removeEventListener(El.COLORMAP_MODIFIED,this._viewportColormapModifiedCallback)}}const exe=Object.freeze(Object.defineProperty({__proto__:null,Colorbar:kp,Enums:q3e,ViewportColorbar:K0},Symbol.toStringTag,{value:"Module"}));function GB(t,e,r,n,i){const o=[];let a=0;const s=t.scalarData;let c,l,f;if(t.color)for(l=0;l<i;l++)for(f=0;f<n;f++){c=((l+r)*t.columns+(f+e))*4;const u=s[c],d=s[c+1],h=s[c+2];o[a++]=.2126*u+.7152*d+.0722*h}else for(l=0;l<i;l++)for(f=0;f<n;f++)c=(l+r)*t.columns+(f+e),o[a++]=s[c];return o}function WB(t,e,r){const n=t.length;let i=r,o=e,a=0;if(n<2)return{min:i,max:o,mean:(e+r)/2};for(let s=0;s<n;s++){const c=t[s];i=Math.min(i,c),o=Math.max(o,c),a+=c}return{min:i,max:o,mean:a/n}}function zB(t){if(t instanceof Rn)return txe(t);if(t instanceof Jn)return nxe(t);throw new Error("Viewport not supported")}function txe(t){const{scalarData:e,width:r,height:n}=N_(t),{min:i,max:o}=L_(e);return{scalarData:e,minPixelValue:i,maxPixelValue:o,width:r,height:n,rows:r,columns:n}}function nxe(t){const e=t.getImageData(),{scalarData:r}=e,{min:n,max:i}=L_(r),o=e.dimensions[0],a=e.dimensions[1],{rows:s,columns:c,color:l}=t.getCornerstoneImage();return{scalarData:r,width:o,height:a,minPixelValue:n,maxPixelValue:i,rows:s,columns:c,color:l}}const rxe=Object.freeze(Object.defineProperty({__proto__:null,calculateMinMaxMean:WB,extractWindowLevelRegionToolData:zB,getLuminanceFromRegion:GB},Symbol.toStringTag,{value:"Module"})),ixe=Object.freeze(Object.defineProperty({__proto__:null,colorbar:exe,windowLevel:rxe},Symbol.toStringTag,{value:"Module"})),{transformWorldToIndex:aS}=cn;function oxe(t,e,r,n){const{boundsIJK:i,centerWorld:o,radiusWorld:a}=axe(e,t,n),s={center:o,radius:a},c=t.getDimensions();ls.createScalarVolumeVoxelManager({dimensions:c,scalarData:t.getPointData().getScalars().getData()}).forEach(r,{boundsIJK:i,isInObject:f=>eB(s,f),imageData:t})}function axe(t,e,r){const[n,i]=t,o=xt((n[0]+i[0])/2,(n[1]+i[1])/2,(n[2]+i[2])/2),a=li(n,i)/2;let s;if(!r){const c=aS(e,o),l=e.getSpacing(),f=Math.min(...l),u=Math.ceil(a/f);return s=[[c[0]-u,c[0]+u],[c[1]-u,c[1]+u],[c[2]-u,c[2]+u]],{boundsIJK:s,centerWorld:o,radiusWorld:a}}return s=sxe(e,r,t,o,a),{boundsIJK:s,centerWorld:o,radiusWorld:a}}function sxe(t,e,r,n,i){const[o,a]=r,s=t.getDimensions(),c=e.getCamera(),l=xt(c.viewUp[0],c.viewUp[1],c.viewUp[2]),f=xt(c.viewPlaneNormal[0],c.viewPlaneNormal[1],c.viewPlaneNormal[2]),u=Ae();xn(u,l,f);const d=Ae(),h=Ae();Xt(d,a,f,i),Xt(h,o,f,-i),Xt(d,d,u,-i),Xt(h,h,u,i);const g=[aS(t,d),aS(t,h)];return mu(g,s)}const cxe=Kt,lxe=Object.freeze(Object.defineProperty({__proto__:null,IslandRemoval:n0,annotationFrameRange:YC,annotationHydration:Ige,boundingBox:Gye,calibrateImageSpacing:Bye,cine:v3e,contourSegmentation:Lge,contours:p5e,debounce:P5,drawing:tme,dynamicVolume:H3e,getAnnotationNearPoint:Vye,getAnnotationNearPointOnEnabledElement:UU,getCalibratedAspect:T4,getCalibratedLengthUnitsAndScale:Ko,getCalibratedProbeUnitsAndValue:ny,getClosestImageIdForStackViewport:L5,getSphereBoundsInfo:WU,getViewportForAnnotation:A2,isObject:w4,math:fpe,normalizeViewportPlane:ZU,orientation:c3e,planar:vpe,planarFreehandROITool:C3e,pointInSurroundingSphereCallback:oxe,pointToString:S4,polyDataUtils:K3e,rectangleROITool:S3e,roundNumber:cxe,segmentation:o3e,stackContextPrefetch:F3e,stackPrefetch:R3e,throttle:eo,touch:Ihe,triggerAnnotationRender:hh,triggerAnnotationRenderForToolGroupIds:EF,triggerAnnotationRenderForViewportIds:Me,triggerEvent:Qe,viewport:U3e,viewportFilters:Spe,voi:ixe},Symbol.toStringTag,{value:"Module"})),uxe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function $B(t,e){const r=Vn;t.forEach(n=>{r.updateSegmentation(n.segmentationId,n.payload),e||Ro(n.segmentationId)})}function fxe(t,e,r){Vn.setSegmentationRepresentationVisibility(t,e,r)}function dxe(t,e,r){const n=Mo(t,e);n&&n.forEach(i=>{fxe(t,{segmentationId:i.segmentationId,type:i.type},r)})}function hxe(t,e){return DF(t,e)}function gxe(t,e,r,n){const i=Mo(t,e);i&&(i.forEach(o=>{o.segments[r].visible=n}),W5(e.segmentationId),Ns(t,e.segmentationId))}function pxe(t,e,r){return!jB(t,e).has(r)}function jB(t,e){const r=M5(t,e);return r?Object.entries(r.segments).reduce((i,[o,a])=>(a.visible||i.add(Number(o)),i),new Set):new Set}const mxe=Object.freeze(Object.defineProperty({__proto__:null,getHiddenSegmentIndices:jB,getSegmentIndexVisibility:pxe,getSegmentationRepresentationVisibility:hxe,setSegmentIndexVisibility:gxe,setSegmentationRepresentationVisibility:dxe},Symbol.toStringTag,{value:"Module"}));function vxe(t){return jo.getStyle(t)}function yxe(t,e){jo.setStyle(t,e),!t.viewportId&&!t.segmentationId&&z5().forEach(n=>{mh(n.segmentationId)}),Ns(t.viewportId,t.segmentationId,t.type)}function wxe(t,e){jo.setRenderInactiveSegmentations(t,e),mh(t),qF(t).forEach(n=>{Ns(t,n.segmentationId)})}function xxe(t){return jo.getRenderInactiveSegmentations(t)}function Cxe(){jo.resetToGlobalStyle(),mh()}function Sxe(t){return jo.hasCustomStyle(t)}const Txe=Object.freeze(Object.defineProperty({__proto__:null,getRenderInactiveSegmentations:xxe,getStyle:vxe,hasCustomStyle:Sxe,resetToGlobalStyle:Cxe,setRenderInactiveSegmentations:wxe,setStyle:yxe},Symbol.toStringTag,{value:"Module"})),_xe=Object.freeze(Object.defineProperty({__proto__:null,color:xge,style:Txe,visibility:mxe},Symbol.toStringTag,{value:"Module"}));function fy(t,e){const r=jt(t);typeof e=="string"&&(console.warn("segmentIndex is a string, converting to number"),e=Number(e)),Object.values(r.segments).forEach(i=>{i.active=!1}),r.segments[e]||(r.segments[e]={segmentIndex:e,label:"",locked:!1,cachedStats:{},active:!1}),r.segments[e].active!==!0&&(r.segments[e].active=!0,Ro(t));const n=dh(t);n.forEach(i=>{Mo(i,{segmentationId:t}).forEach(a=>{a.segments[e]||(a.segments[e]={visible:!0})})}),n.forEach(i=>{const o=or(i);mB(o.id)})}const Exe=Object.freeze(Object.defineProperty({__proto__:null,getActiveSegmentIndex:Po,setActiveSegmentIndex:fy},Symbol.toStringTag,{value:"Module"}));async function Dxe(t){const e=Zhe(t);return Ro(t.segmentationId),e}const bxe=Object.freeze(Object.defineProperty({__proto__:null,canComputeRequestedRepresentation:R5,computeAndAddContourRepresentation:OF,computeAndAddLabelmapRepresentation:VF,computeAndAddSurfaceRepresentation:DV},Symbol.toStringTag,{value:"Module"}));function HB(t,e){const r=jt(t);if(r.representationData.Labelmap){const{representationData:n}=r,i=n.Labelmap;("imageIds"in i||"volumeId"in i)&&("imageIds"in i?i.imageIds.map(a=>ke.getImage(a)):[ke.getVolume(i.volumeId)]).forEach(a=>{if(!a)return;const{voxelManager:s}=a;s.forEach(({value:c,index:l})=>{c===e&&s.setAtIndex(l,0)})}),Ai(t)}else throw new Error("Invalid segmentation type, only labelmap is supported right now")}function Ixe(t,e,r={setNextSegmentAsActive:!0}){HB(t,e);const n=Po(t)===e,i=jt(t),{segments:o}=i;delete o[e];const a={...o};if($B([{segmentationId:t,payload:{segments:a}}]),n&&r.setNextSegmentAsActive){const c=Object.keys(o).map(Number).sort((d,h)=>d-h),l=c.indexOf(e),f=c[l+1],u=c[l-1];f!==void 0?fy(t,f):u!==void 0&&fy(t,u)}dh(t).forEach(c=>{Mo(c,{segmentationId:t}).forEach(f=>{delete f.segments[e]})})}function Oxe(t){const e=Vn,r=jt(t);return e.getLabelmapImageIds(r.representationData)}const Mxe={clearSegmentValue:HB,convertStackToVolumeLabelmap:Dxe,computeVolumeLabelmapFromStack:EV,convertVolumeToStackLabelmap:F2e},Rxe=Object.freeze(Object.defineProperty({__proto__:null,activeSegmentation:D2e,addContourRepresentationToViewport:AF,addContourRepresentationToViewportMap:L2e,addLabelmapRepresentationToViewport:NF,addLabelmapRepresentationToViewportMap:A2e,addRepresentationData:xV,addSegmentationRepresentations:ph,addSegmentations:BF,addSurfaceRepresentationToViewport:kF,addSurfaceRepresentationToViewportMap:N2e,config:_xe,getLabelmapImageIds:Oxe,helpers:Mxe,polySeg:bxe,removeAllSegmentationRepresentations:zF,removeAllSegmentations:KF,removeContourRepresentation:jF,removeLabelmapRepresentation:$F,removeSegment:Ixe,removeSegmentation:z4,removeSegmentationRepresentation:vh,removeSegmentationRepresentations:GF,removeSurfaceRepresentation:HF,segmentIndex:Exe,segmentLocking:o2e,state:nve,strategies:cwe,triggerSegmentationEvents:$he,updateSegmentations:$B},Symbol.toStringTag,{value:"Module"}));class s8{constructor(e){this._controlPoints=[],this._invalidated=!1,this._length=0,this._controlPoints=[],this._resolution=(e==null?void 0:e.resolution)??20,this._fixedResolution=(e==null?void 0:e.fixedResolution)??!1,this._closed=(e==null?void 0:e.closed)??!1,this._invalidated=!0}get controlPoints(){return this._controlPoints}get numControlPoints(){return this._controlPoints.length}get resolution(){return this._resolution}set resolution(e){this._fixedResolution||this._resolution===e||(this._resolution=e,this.invalidated=!0)}get fixedResolution(){return this._fixedResolution}get closed(){return this._closed}set closed(e){this._closed!==e&&(this._closed=e,this.invalidated=!0)}get aabb(){return this._update(),this._aabb}get length(){return this._update(),this._length}get invalidated(){return this._invalidated}set invalidated(e){this._invalidated=e}hasTangentPoints(){return!1}addControlPoint(e){this._controlPoints.push([e[0],e[1]]),this.invalidated=!0}addControlPoints(e){e.forEach(r=>this.addControlPoint(r))}addControlPointAtU(e){const r=this._getLineSegmentAt(e),{start:n,end:i}=r.points,o=Math.floor(e),a=this._curveSegments[o],s=e-Math.floor(o),c=[n[0]+s*(i[0]-n[0]),n[1]+s*(i[1]-n[1])],l=this._controlPoints.indexOf(a.controlPoints.p1)+1;return this._controlPoints.splice(l,0,c),this.invalidated=!0,{index:l,point:c}}deleteControlPointByIndex(e){const r=this._closed?3:1;return e>=0&&e<this._controlPoints.length&&this._controlPoints.length>r?(this._controlPoints.splice(e,1),this.invalidated=!0,!0):!1}clearControlPoints(){this._controlPoints=[],this.invalidated=!0}setControlPoints(e){this.clearControlPoints(),this.addControlPoints(e)}updateControlPoint(e,r){if(e<0||e>=this._controlPoints.length)throw new Error("Index out of bounds");this._controlPoints[e]=[...r],this.invalidated=!0}getControlPoints(){return this._controlPoints.map(e=>[e[0],e[1]])}getClosestControlPoint(e){const r=this._controlPoints;let n=1/0,i=-1;for(let o=0,a=r.length;o<a;o++){const s=r[o],c=e[0]-s[0],l=e[1]-s[1],f=c*c+l*l;f<n&&(n=f,i=o)}return{index:i,point:i===-1?void 0:[...r[i]],distance:Math.sqrt(n)}}getClosestControlPointWithinDistance(e,r){const n=this.getClosestControlPoint(e);return n.distance<=r?n:void 0}getClosestPoint(e){this._update();const r=this._getCurveSegmmentsDistanceSquaredInfo(e);if(!r.length)return;r.sort((u,d)=>u.distanceSquared-d.distanceSquared);let n,i=-1,o=1/0,a,s;for(let u=0;u<r.length;u++){const d=r[u];if(d.distanceSquared>o)continue;const{curveSegmentIndex:h,curveSegment:g}=d,{lineSegments:p}=g;for(let v=0;v<p.length;v++){const w=p[v],{point:m,distanceSquared:y}=iy(w.points.start,w.points.end,e);y<o&&(s=w,i=h,a=d.curveSegment,n=m,o=y)}}const l=(s.previousLineSegmentsLength+_a(s.points.start,n))/a.length,f=i+l;return{point:n,uValue:f,distance:Math.sqrt(o)}}getClosestPointOnControlPointLines(e){const r=[...this._controlPoints];if(this._closed&&r.push(this._controlPoints[0]),!r.length)return;let n,i=1/0,o=r[0];for(let a=1,s=r.length;a<s;a++){const c=r[a],{point:l,distanceSquared:f}=iy(o,c,e);f<i&&(n=l,i=f),o=c}return{point:n,distance:Math.sqrt(i)}}getPolylinePoints(){return this._update(),this._convertCurveSegmentsToPolyline(this._curveSegments)}getPreviewPolylinePoints(e,r){if(this._closed)return[];this._update();const n=this.getClosestControlPointWithinDistance(e,r),i=(n==null?void 0:n.index)===0,o=this.getPreviewCurveSegments(e,i);return o!=null&&o.length?this._convertCurveSegmentsToPolyline(o):[]}isPointNearCurve(e,r){this._update();const n=this._getCurveSegmmentsWithinDistance(e,r),i=r*r;for(let o=0;o<n.length;o++){const{lineSegments:a}=n[o];for(let s=0;s<a.length;s++){const c=a[s];if(v1(c.points.start,c.points.end,e)<=i)return!0}}return!1}containsPoint(e){if(this._update(),this._controlPoints.length<3)return!1;const n=[...this._curveSegments],i=this._getClosingCurveSegmentWithStraightLineSegment();i&&n.push(i);let o=0;for(let a=0;a<n.length;a++){const s=n[a],{aabb:c}=s;if(!(e[0]<=c.maxX&&e[1]>=c.minY&&e[1]<c.maxY))continue;const{lineSegments:f}=s;for(let u=0;u<f.length;u++){const d=f[u],{aabb:h}=d;if(e[0]<=h.maxX&&e[1]>=h.minY&&e[1]<h.maxY){const{start:p,end:v}=d.points,w=p[0]===v[0],m=(e[1]-p[1])*(v[0]-p[0])/(v[1]-p[1])+p[0];o+=w||e[0]<=m?1:0}}}return o%2===1}_update(){if(!this._invalidated)return;const e=this.getSplineCurves();let r=0,n=1/0,i=1/0,o=-1/0,a=-1/0;for(let s=0,c=e.length;s<c;s++){const{aabb:l,length:f}=e[s];n=n<=l.minX?n:l.minX,i=i<=l.minY?i:l.minY,o=o>=l.maxX?o:l.maxX,a=a>=l.maxY?a:l.maxY,r+=f}this._curveSegments=e,this._aabb={minX:n,minY:i,maxX:o,maxY:a},this._length=r,this._invalidated=!1}_convertCurveSegmentsToPolyline(e){this._update();const r=[];return e.forEach(({lineSegments:n},i)=>{n.forEach((o,a)=>{i===0&&a===0&&r.push([...o.points.start]),r.push([...o.points.end])})}),r}_getCurveSegmmentsDistanceSquaredInfo(e){this._update();const r=[],{_curveSegments:n}=this;for(let i=0;i<n.length;i++){const o=n[i],a=ry(o.aabb,e);r.push({curveSegmentIndex:i,curveSegment:o,distanceSquared:a})}return r}_getCurveSegmmentsWithinDistance(e,r){this._update();const n=r*r;if(ry(this.aabb,e)>n)return[];const i=this._getCurveSegmmentsDistanceSquaredInfo(e),o=[];for(let a=0,s=i.length;a<s;a++){const{curveSegment:c,distanceSquared:l}=i[a];l<=n&&o.push(c)}return o}_getLineSegmentAt(e){this._update();const r=Math.floor(e),n=e-r,i=this._curveSegments[r],{lineSegments:o}=i,a=i.length*n;for(let s=0;s<o.length;s++){const c=o[s],l=c.previousLineSegmentsLength+c.length;if(a>=c.previousLineSegmentsLength&&a<=l)return c}}_getClosingCurveSegmentWithStraightLineSegment(){if(this.closed)return;const e=this._controlPoints,r=e[0],n=e[e.length-1],i={points:{start:[...r],end:[...n]},aabb:{minX:Math.min(r[0],n[0]),minY:Math.min(r[1],n[1]),maxX:Math.max(r[0],n[0]),maxY:Math.max(r[1],n[1])}};return{aabb:{minX:i.aabb.minX,minY:i.aabb.minY,maxX:i.aabb.maxX,maxY:i.aabb.maxY},lineSegments:[i]}}}const Pxe=1e-8;class c8 extends s8{getPreviewCurveSegments(e,r){const n=this._getNumCurveSegments()+1,i=Math.max(0,n-2),o=r?n:n-1,a=this.getTransformMatrix(),s=[...this.controlPoints],c=[];r||s.push(e);for(let l=i;l<=o;l++){const f=this._getCurveSegment(l,a,s,r);c.push(f)}return c}getSplineCurves(){const e=this._getNumCurveSegments(),r=new Array(e);if(e<=0)return[];const n=this.getTransformMatrix();let i=0;for(let o=0;o<e;o++){const a=this._getCurveSegment(o,n);a.previousCurveSegmentsLength=i,r[o]=a,i+=a.length}return r}_getNumCurveSegments(e=this.controlPoints,r=this.closed){return r?e.length:Math.max(0,e.length-1)}_getPoint(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=Math.floor(e);let s=a%o;const c=e-a;if(s<0||s>=o)if(this.closed)s=(o+s)%o;else return;const{p0:f,p1:u,p2:d,p3:h}=this._getCurveSegmentPoints(s,n,i),g=c*c,p=g*c,v=h2(1,c,g,p),w=$l(IM(),v,r);return[JE(w,h2(f[0],u[0],d[0],h[0])),JE(w,h2(f[1],u[1],d[1],h[1]))]}_getCurveSegmentPoints(e,r=this.controlPoints,n=this.closed){const i=this._getNumCurveSegments(r,n),o=e,a=o-1,s=n?(o+1)%i:o+1,c=s+1,l=r[o],f=r[s];let u,d;return a>=0?u=r[a]:u=n?r[r.length-1]:WC(f,l),c<r.length?d=r[c]:d=n?r[0]:WC(l,f),{p0:u,p1:l,p2:f,p3:d}}_getLineSegments(e,r,n=this.controlPoints,i=this.closed){const o=this._getNumCurveSegments(n,i),a=this.resolution+1,s=1/a,c=e;let l=c+1;!i&&e===o-1&&(l-=Pxe);const f=[];let u,d,h=0;for(let g=0,p=c;g<=a;g++,p+=s){p=p>l?l:p;const v=this._getPoint(p,r,n,i);if(!g){u=v;continue}d=v;const w=d[0]-u[0],m=d[1]-u[1],y=Math.sqrt(w**2+m**2),x={minX:u[0]<=d[0]?u[0]:d[0],maxX:u[0]>=d[0]?u[0]:d[0],minY:u[1]<=d[1]?u[1]:d[1],maxY:u[1]>=d[1]?u[1]:d[1]};f.push({points:{start:u,end:d},aabb:x,length:y,previousLineSegmentsLength:h}),u=d,h+=y}return f}_getCurveSegment(e,r=this.getTransformMatrix(),n=this.controlPoints,i=this.closed){const{p0:o,p1:a,p2:s,p3:c}=this._getCurveSegmentPoints(e,n,i),l=this._getLineSegments(e,r,n,i);let f=0,u=1/0,d=1/0,h=-1/0,g=-1/0;return l.forEach(({aabb:p,length:v})=>{u=Math.min(u,p.minX),d=Math.min(d,p.minY),h=Math.max(h,p.maxX),g=Math.max(g,p.maxY),f+=v}),{controlPoints:{p0:o,p1:a,p2:s,p3:c},aabb:{minX:u,minY:d,maxX:h,maxY:g},length:f,previousCurveSegmentsLength:0,lineSegments:l}}}const Lxe=TM(ba(),OT(1,4,1,0,-3,0,3,0,3,-6,3,0,-1,3,-3,1),1/6);class KB extends c8{getTransformMatrix(){return Lxe}}class Vp extends c8{constructor(e){super(e),this._scale=(e==null?void 0:e.scale)??.5,this._fixedScale=(e==null?void 0:e.fixedScale)??!1}get scale(){return this._scale}set scale(e){this._fixedScale||this._scale===e||(this._scale=e,this.invalidated=!0)}get fixedScale(){return this._fixedScale}getTransformMatrix(){const{scale:e}=this,r=2*e;return[0,1,0,0,-e,0,e,0,r,e-3,3-r,-e,-e,2-e,e-2,e]}}class qB extends Vp{constructor(){super({scale:.5,fixedScale:!0})}}class XB extends Vp{constructor(){super({resolution:0,fixedResolution:!0,scale:0,fixedScale:!0})}}class YB extends s8{getSplineCurves(){return[]}getLineSegments(){return[]}getPreviewCurveSegments(e,r){return[]}}const Axe=[1,0,0,-2,2,0,1,-2,1];class Nxe extends YB{hasTangentPoints(){return!0}getTransformMatrix(){return Axe}}const kxe=Object.freeze(Object.defineProperty({__proto__:null,BSpline:KB,CardinalSpline:Vp,CatmullRomSpline:qB,CubicSpline:c8,LinearSpline:XB,QuadraticBezier:Nxe,QuadraticSpline:YB,Spline:s8},Symbol.toStringTag,{value:"Module"}));let JB=class extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:r,deltaPoints:n}=e.detail,i=we(r),o=n.world;if(o[0]===0&&o[1]===0&&o[2]===0)return;const a=i.viewport.getCamera(),{focalPoint:s,position:c}=a,l=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],f=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}};JB.toolName="Pan";let ZB=class extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}}){super(e,r),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o}=i,a=we(o),{viewport:s}=a,f=s.getDefaultActor().actor.getMapper();if(!("getSampleDistance"in f||"getCurrentSampleDistance"in f))return!0;const d=f.getSampleDistance();return this._hasResolutionChanged||(f.setSampleDistance(d*2),this._hasResolutionChanged=!0,this.cleanUp!==null&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{f.setSampleDistance(d),s.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})),!0},this._getViewportsInfo=()=>Li(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const n=()=>{this._getViewportsInfo().forEach(({viewportId:o,renderingEngineId:a})=>{if(!this._resizeObservers.has(o)){const{viewport:s}=zr(o,a)||{viewport:null};if(!s)return;const{element:c}=s,l=new ResizeObserver(()=>{const f=zr(o,a);if(!f)return;const{viewport:u}=f,d=u.getViewPresentation();u.resetCamera(),u.setViewPresentation(d),u.render()});l.observe(c),this._resizeObservers.set(o,l)}})};n(),this._viewportAddedListener=i=>{i.detail.toolGroupId===this.toolGroupId&&n()},We.addEventListener(U.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach((n,i)=>{n.disconnect(),this._resizeObservers.delete(i)}),this._viewportAddedListener&&(We.removeEventListener(U.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(n,i,o,a)=>{const s=n.getVtkActiveCamera(),c=s.getViewUp(),l=s.getFocalPoint(),f=s.getPosition(),u=[0,0,0],d=[0,0,0],h=[0,0,0],g=yt(new Float32Array(16));Wn(g,g,i),Ki(g,g,a,o),Wn(g,g,[-i[0],-i[1],-i[2]]),Pt(u,f,g),Pt(d,l,g),yt(g),Ki(g,g,a,o),Pt(h,c,g),n.setCamera({position:u,viewUp:h,focalPoint:d})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,lastPoints:i}=e.detail,o=n.canvas,a=i.canvas,{rotateIncrementDegrees:s}=this.configuration,c=we(r),{viewport:l}=c,f=l.getCamera(),u=r.clientWidth,d=r.clientHeight,h=[o[0]/u,o[1]/d],g=[a[0]/u,a[1]/d],p=[u*.5,d*.5],v=l.canvasToWorld(p),m=(1+Math.abs([.5,.5][0]))**2,y=[g[0],0,0],x=[h[0],0,0],C=y[0]**2,S=x[0]**2,T=C>m?0:Math.sqrt(m-C),_=S>m?0:Math.sqrt(m-S),E=[y[0],0,T];kt.normalize(E);const D=[x[0],0,_];kt.normalize(D);const b=kt.dot(E,D);if(Math.abs(b)>1e-4){const I=-2*Math.acos(kt.clampValue(b,-1,1))*Math.sign(h[0]-g[0])*s,R=f.viewUp,M=f.viewPlaneNormal,P=[0,0,0],k=[0,0,0];kt.cross(R,M,P),kt.normalize(P),kt.cross(M,P,k),kt.normalize(k),kt.normalize(R),this.rotateCamera(l,v,k,I);const z=(g[1]-h[1])*s;this.rotateCamera(l,v,P,z),l.render()}}};ZB.toolName="TrackballRotate";const T3=4,Vxe=1024,Fxe="PT";let QB=class extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this._getImageDynamicRangeFromMiddleSlice=(n,i)=>{const o=Math.floor(i[2]/2),a=i[0]*i[1];let s,c;n instanceof Float32Array?(s=4,c=Float32Array):n instanceof Uint8Array?(s=1,c=Uint8Array):n instanceof Uint16Array?(s=2,c=Uint16Array):n instanceof Int16Array&&(s=2,c=Int16Array);const l=n.buffer,f=o*a*s,u=new c(l,f,a),{max:d,min:h}=this._getMinMax(u,a);return d-h}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){var g,p;const{element:r,deltaPoints:n}=e.detail,i=we(r),{viewport:o}=i;let a,s,c,l,f,u,d=!1;const h=o.getProperties();if(o instanceof Rn){a=o.getVolumeId(),u=a1(a),{lower:s,upper:c}=h.voiRange;const v=ke.getVolume(a);if(!v)throw new Error("Volume not found "+a);l=v.metadata.Modality,d=v.scaling&&Object.keys(v.scaling).length>0}else if(h.voiRange){l=o.modality,{lower:s,upper:c}=h.voiRange;const{preScale:v={scaled:!1}}=((g=o.getImageData)==null?void 0:g.call(o))||{};d=v.scaled&&((p=v.scalingParameters)==null?void 0:p.suvbw)!==void 0}else throw new Error("Viewport is not a valid type");if(l===Fxe&&d?f=this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:s,upper:c,clientHeight:r.clientHeight,isPreScaled:d,viewport:o,volumeId:a}):f=this.getNewRange({viewport:o,deltaPointsCanvas:n.canvas,volumeId:a,lower:s,upper:c}),!(f.lower>=f.upper)&&(o.setProperties({voiRange:f}),o.render(),o instanceof Rn)){u.forEach(v=>{o!==v&&v.render()});return}}getPTScaledNewRange({deltaPointsCanvas:e,lower:r,upper:n,clientHeight:i,viewport:o,volumeId:a,isPreScaled:s}){let c=T3;s?c=5/i:c=this._getMultiplierFromDynamicRange(o,a)||T3;const f=e[1]*c;return n-=f,n=s?Math.max(n,.1):n,{lower:r,upper:n}}getNewRange({viewport:e,deltaPointsCanvas:r,volumeId:n,lower:i,upper:o}){const a=this._getMultiplierFromDynamicRange(e,n)||T3,s=r[0]*a,c=r[1]*a;let{windowWidth:l,windowCenter:f}=nh(i,o);l+=s,f+=c,l=Math.max(l,1);const u=e.getProperties().VOILUTFunction;return ru(l,f,u)}_getMultiplierFromDynamicRange(e,r){var o;let n;if(r){const a=ke.getVolume(r),{voxelManager:s}=e.getImageData(),l=s.getMiddleSliceData().reduce((d,h)=>[Math.min(d[0],h),Math.max(d[1],h)],[1/0,-1/0]),f=(o=a==null?void 0:a.metadata)==null?void 0:o.BitsStored,u=f?2**f:1/0;n=Math.min(l,u)}else n=this._getImageDynamicRangeFromViewport(e);const i=n/Vxe;return i>1?Math.round(i):i}_getImageDynamicRangeFromViewport(e){const{imageData:r,voxelManager:n}=e.getImageData();if(n!=null&&n.getRange){const s=n.getRange();return s[1]-s[0]}const i=r.getDimensions();if(r.getRange){const s=r.getRange();return s[1]-s[0]}let o;if(r.getScalarData?o=r.getScalarData():o=r.getPointData().getScalars().getData(),i[2]!==1)return this._getImageDynamicRangeFromMiddleSlice(o,i);let a;if(o.getRange)a=o.getRange();else{const{min:s,max:c}=this._getMinMax(o,o.length);a=[s,c]}return a[1]-a[0]}_getMinMax(e,r){let n=1/0,i=-1/0;for(let o=0;o<r;o++){const a=e[o];a<n&&(n=a),a>i&&(i=a)}return{max:i,min:n}}};QB.toolName="WindowLevel";class eG extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c;this.isDrawing=!0;const f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=this.getReferencedImageId(l,s,u,d),g=l.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:g,referencedImageId:h},data:{handles:{points:[[...s],[...s],[...s],[...s]]},cachedStats:{}}};Zt(p,a);const v=pt(a,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v},this._activateDraw(a),Tt(a),n.preventDefault(),Me(v),p},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData;this._deactivateDraw(o),Ut(o),this.editData=null,this.isDrawing=!1,hn(a.annotationUID),Me(s),Bn(a),this.applyWindowLevelRegion(a,o)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{currentPoints:l}=i,f=we(o),{worldToCanvas:u,canvasToWorld:d}=f.viewport,h=l.world,{points:g}=c.handles,p=3;g[p]=[...h];const v=u(g[0]),w=u(g[3]),m=[w[0],v[1]],y=[v[0],w[1]],x=d(m),C=d(y);g[1]=x,g[2]=C,a.invalidated=!0,Me(s)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{points:g}=h.handles,p=g.map(C=>a.worldToCanvas(C));l.annotationUID=d;const{color:v,lineWidth:w,lineDash:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:l});if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const y=`${d}-rect`;x1(i,d,"0",p[0],p[3],{color:v,lineDash:m,lineWidth:w},y),o=!0}return o},this.applyWindowLevelRegion=(n,i)=>{const o=we(i),{viewport:a}=o,s=zB(a),{data:c}=n,{points:l}=c.handles,f=l.map(T=>a.worldToCanvas(T)),u=f[0],d=f[3];let h=Math.min(u[0],d[0]),g=Math.min(u[1],d[1]),p=Math.abs(u[0]-d[0]),v=Math.abs(u[1]-d[1]);h=Wv(h,0,s.width),g=Wv(g,0,s.height),p=Math.floor(Math.min(p,Math.abs(s.width-h))),v=Math.floor(Math.min(v,Math.abs(s.height-g)));const w=GB(s,Math.round(h),Math.round(g),p,v),m=WB(w,s.minPixelValue,s.maxPixelValue);this.configuration.minWindowWidth===void 0&&(this.configuration.minWindowWidth=10);const y=Math.max(Math.abs(m.max-m.min),this.configuration.minWindowWidth),x=m.mean,C=a.getProperties().VOILUTFunction,S=ru(y,x,C);a.setProperties({voiRange:S}),a.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}eG.toolName="WindowLevelRegion";let tG=class extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,r),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:r,viewportId:n,renderingEngineId:i}=e.detail,{viewport:o}=zr(n,i),{debounceIfNotLoaded:a,invert:s,loop:c}=this.configuration,l=r.canvas[1];let f;o instanceof Rn&&(f=o.getVolumeId());const u=this._getPixelPerImage(o),d=l+this.deltaY;if(u)if(Math.abs(d)>=u){const h=Math.round(d/u);Xf(o,{delta:s?-h:h,volumeId:f,debounceLoading:a,loop:c}),this.deltaY=d%u}else this.deltaY=d}_scroll(e){const{wheel:r,element:n}=e.detail,{direction:i}=r,{invert:o}=this.configuration,{viewport:a}=we(n),s=i*(o?-1:1);Xf(a,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:a instanceof Xn?a.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:r}=e,n=e.getNumberOfSlices();return Math.max(2,r.offsetHeight/Math.max(n,8))}};tG.toolName="StackScroll";function Uxe(t,e){const[r,n]=t,[i,o]=e,a=bn(Ae(),n,r),s=bn(Ae(),i,o),c=gt(a,s),l=fo(a),f=fo(s),u=c/(l*f);return Math.acos(u)*180/Math.PI}function Bxe(t,e){const[r,n]=t,[i,o]=e,a=ya(Vt(),n,r),s=ya(Vt(),i,o),c=FT(a,s),l=mv(a),f=mv(s),u=c/(l*f);return Math.acos(u)*(180/Math.PI)}function kg(t,e){return t[0].length===3?Uxe(t,e):Bxe(t,e)}class nG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.mouseWheelCallback=n=>{const{element:i,wheel:o}=n.detail,a=we(i),{viewport:s}=a,{invert:c}=this.configuration,l=o.direction*10*(c?-1:1);this.setAngle(s,l)},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:r,currentPoints:n,startPoints:i}=e.detail,o=n.world,a=i.world,s=we(r),{viewport:c}=s,l=c.getCamera(),f=r.clientWidth,u=r.clientHeight,d=[f*.5,u*.5],h=c.canvasToWorld(d);let g=kg([a,h],[h,o]);const{viewPlaneNormal:p}=l,v=bn(Ae(),h,a),w=bn(Ae(),h,o),m=xn(Ae(),v,w);gt(p,m)>0&&(g=-g),!Number.isNaN(g)&&this.setAngle(c,g)}setAngle(e,r){const{viewPlaneNormal:n,viewUp:i}=e.getCamera();if(e instanceof Xn){const o=(r+360)%360*Math.PI/180,a=yt(new Float32Array(16));Ki(a,a,o,n);const s=Pt(Ae(),i,a);e.setCamera({viewUp:s})}else{const{rotation:o}=e.getViewPresentation();e.setViewPresentation({rotation:(o+r+360)%360})}e.render()}}nG.toolName="PlanarRotate";let rG=class extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=a.world,l=we(o).viewport.getCamera(),{focalPoint:f}=l;this.initialMousePosWorld=s;let u=xt(f[0]-s[0],f[1]-s[1],f[2]-s[2]);return u=kn(Ae(),u),this.dirVec=u,!1},this.preTouchStartCallback=n=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(n)},this._dragParallelProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{parallelScale:u,focalPoint:d,position:h}=o,g=5/f[1],p=l*g*(this.configuration.invert?-1:1),v=(1-p)*u;let w=d,m=h;if(!this.configuration.zoomToCenter){const b=li(d,this.initialMousePosWorld);m=Xt(Ae(),h,this.dirVec,-b*p),w=Xt(Ae(),d,this.dirVec,-b*p)}const y=i.getImageData();let x=[1,1,1];y&&(x=y.spacing);const{minZoomScale:C,maxZoomScale:S}=this.configuration,T=s.clientHeight*x[1]*.5,_=T/v;let E=v,D=!1;y&&(_<C?(E=T/C,D=!0):_>=S&&(E=T/S,D=!0)),i.setCamera({parallelScale:E,focalPoint:D?d:w,position:D?h:m})},this._dragPerspectiveProjection=(n,i,o,a=!1)=>{const{element:s,deltaPoints:c}=n.detail,l=a?n.detail.deltaDistance.canvas:c.canvas[1],f=[s.clientWidth,s.clientHeight],{position:u,focalPoint:d,viewPlaneNormal:h}=o,g=kt.distance2BetweenPoints(u,d),p=Math.sqrt(g)/f[1],v=[-h[0],-h[1],-h[2]],w=this.configuration.invert?l/p:l*p;let m=w*v[0];u[0]+=m,d[0]+=m,m=w*v[1],u[1]+=m,d[1]+=m,m=w*v[2],u[2]+=m,d[2]+=m,i.setCamera({position:u,focalPoint:d})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:n,currentPoints:i}=e.detail,o=we(n),{viewport:a}=o,s=a.getCamera(),c=i.world,{focalPoint:l}=s;this.initialMousePosWorld=c;let f=xt(l[0]-c[0],l[1]-c[1],l[2]-c[2]);f=kn(Ae(),f),this.dirVec=f,s.parallelProjection?this._dragParallelProjection(e,a,s,!0):this._dragPerspectiveProjection(e,a,s,!0),a.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:r}=e.detail,n=we(r),{viewport:i}=n,o=i.getCamera();o.parallelProjection?this._dragParallelProjection(e,i,o):this._dragPerspectiveProjection(e,i,o),i.render()}_panCallback(e){const{element:r,deltaPoints:n}=e.detail,i=we(r),o=n.world,a=i.viewport.getCamera(),{focalPoint:s,position:c}=a,l=[c[0]-o[0],c[1]-o[1],c[2]-o[2]],f=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];i.viewport.setCamera({focalPoint:f,position:l}),i.viewport.render()}};rG.toolName="Zoom";class iG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,r)}mouseClickCallback(e){const{element:r,currentPoints:n}=e.detail,i=we(r),{viewport:o,renderingEngine:a}=i,s=o.getVolumeId();if(!s)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let c=-1/0;const l=(g,p)=>{if(g>c)return c=g,p},f=P4(o,n.world,s,l);if(!f||!f.length)return;const{targetViewportIds:u,toolGroupId:d}=this.configuration;a.getViewports().filter(g=>{if((u==null?void 0:u.indexOf(g.id))>=0)return!0;const p=or(g.id,a.id);return!!(d&&d===(p==null?void 0:p.id))}).forEach(g=>{g instanceof Rn?g.jumpToWorld(f):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")})}}iG.toolName="MIPJumpToClickTool";const{RENDERING_DEFAULTS:_3}=Cu;function Gxe(){return"rgb(0, 200, 0)"}function Wxe(){return!0}function zxe(){return!0}function $xe(){return!0}const Ga={DRAG:1,ROTATE:2,SLAB:3};class oG extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},referenceLinesCenterGapRadius:20,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:zf.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}}){var n,i,o,a;super(e,r),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:s,viewportId:c})=>{const l=zr(c,s),{FrameOfReferenceUID:f,viewport:u}=l,{element:d}=u,{position:h,focalPoint:g,viewPlaneNormal:p}=u.getCamera();let v=this._getAnnotations(l);v=this.filterInteractableAnnotationsForElement(d,v),v!=null&&v.length&&hn(v[0].annotationUID);const w={highlighted:!1,metadata:{cameraPosition:[...h],cameraFocalPoint:[...g],FrameOfReferenceUID:f,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:c}};return Zt(w,d),{normal:p,point:u.canvasToWorld([u.canvas.clientWidth/2,u.canvas.clientHeight/2])}},this._getViewportsInfo=()=>Li(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const s=this._getViewportsInfo();for(const c of s){const{viewportId:l,renderingEngineId:f}=c,u=zr(l,f),d=u.viewport;d.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!0,suppressEvents:!0}),d.resetSlabThickness();const{element:m}=d;let y=this._getAnnotations(u);y=this.filterInteractableAnnotationsForElement(m,y),y.length&&hn(y[0].annotationUID),d.render()}this._computeToolCenter(s)},this.computeToolCenter=()=>{const s=this._getViewportsInfo();this._computeToolCenter(s)},this._computeToolCenter=s=>{if(!s.length||s.length===1){console.warn("For crosshairs to operate, at least two viewports must be given.");return}const[c,l,f]=s,{normal:u,point:d}=this.initializeViewport(c),{normal:h,point:g}=this.initializeViewport(l);let p=[0,0,0],v=Ae();f?{normal:p,point:v}=this.initializeViewport(f):(br(v,d,g),mr(v,v,.5),xn(p,u,h));const w=Nc(u,d),m=Nc(h,g),y=Nc(p,v);this.toolCenter=mA(w,m,y),Me(s.map(({viewportId:x})=>x))},this.addNewAnnotation=s=>{const c=s.detail,{element:l}=c,{currentPoints:f}=c,u=f.world,d=we(l),{viewport:h}=d;this._jump(d,u);const g=this._getAnnotations(d),p=this.filterInteractableAnnotationsForElement(h.element,g),{data:v}=p[0],{rotationPoints:w}=v.handles,m=[];for(let y=0;y<w.length-1;++y){const x=w[y][1],C=this._getReferenceLineControllable(x.id),S=this._getReferenceLineDraggableRotatable(x.id);!C||!S||(m.push(x.id),y++)}return v.activeViewportIds=[...m],v.handles.activeOperation=Ga.DRAG,s.preventDefault(),Tt(l),this._activateModify(l),p[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(s,c)=>{const l=s.detail,{element:f}=l;c.highlighted=!0,this._activateModify(f),Tt(f),s.preventDefault()},this.isPointNearTool=(s,c,l,f)=>!!this._pointNearTool(s,c,l,6),this.toolSelectedCallback=(s,c,l)=>{const f=s.detail,{element:u}=f;c.highlighted=!0,this._activateModify(u),Tt(u),s.preventDefault()},this.onCameraModified=s=>{var E;const c=s.detail,{element:l}=c,f=we(l),{renderingEngine:u}=f,d=f.viewport,h=this._getAnnotations(f),p=this.filterInteractableAnnotationsForElement(l,h)[0];if(!p)return;const v=d.getCamera(),w=p.metadata.cameraPosition,m=[0,0,0];kt.subtract(v.position,w,m);const y=p.metadata.cameraFocalPoint,x=[0,0,0];kt.subtract(v.focalPoint,y,x),p.metadata.cameraPosition=[...v.position],p.metadata.cameraFocalPoint=[...v.focalPoint];const C=this._getReferenceLineControllable(d.id),S=this._getReferenceLineDraggableRotatable(d.id);if(!At(v.position,w,.001)&&C&&S){let D=!1;At(m,x,.001)||(D=!0);const I=Math.abs(kt.dot(m,v.viewPlaneNormal))<.01;!D&&!I&&(this.toolCenter[0]+=m[0],this.toolCenter[1]+=m[1],this.toolCenter[2]+=m[2])}(E=this.configuration.autoPan)!=null&&E.enabled&&or(d.id,u.id).getViewportIds().filter(I=>I!==d.id).forEach(I=>{this._autoPanViewportIfNecessary(I,u)});const _=pt(l,this.getToolName(),!1);Me(_)},this.onResetCamera=s=>{this.resetCrosshairs()},this.mouseMoveCallback=(s,c)=>{const{element:l,currentPoints:f}=s.detail,u=f.canvas;let d=!1;for(let h=0;h<c.length;h++){const g=c[h];if(jr(g.annotationUID))continue;const{data:p,highlighted:v}=g;if(!p.handles)continue;const w=p.handles.activeOperation,m=p.activeViewportIds&&p.activeViewportIds.length>0?[...p.activeViewportIds]:[];p.activeViewportIds=[],p.handles.activeOperation=null;const y=this.getHandleNearImagePoint(l,g,u,6);let x=!1;y?x=!0:x=this._pointNearTool(l,g,u,6),x&&!v||!x&&v?(g.highlighted=!v,d=!0):(p.handles.activeOperation!==w||!this._areViewportIdArraysEqual(p.activeViewportIds,m))&&(d=!0)}return d},this.filterInteractableAnnotationsForElement=(s,c)=>{if(!c||!c.length)return[];const l=we(s),{viewportId:f}=l;return c.filter(d=>d.data.viewportId===f)},this.renderAnnotation=(s,c)=>{let l=!1;const{viewport:f,renderingEngine:u}=s,{element:d}=f,h=this._getAnnotations(s),g=f.getCamera(),v=this.filterInteractableAnnotationsForElement(d,h)[0];if(!(h!=null&&h.length)||!(v!=null&&v.data))return l;const w=v.annotationUID,{clientWidth:m,clientHeight:y}=f.canvas,x=Math.sqrt(m*m+y*y),C=Math.min(m,y),S=v.data,T=f.worldToCanvas(this.toolCenter),_=this._filterAnnotationsByUniqueViewportOrientations(s,h),E=[],D=[0,0,m,y];_.forEach(P=>{const{data:k}=P;k.handles.toolCenter=this.toolCenter;const z=u.getViewport(k.viewportId),A=z.getCamera(),L=this._getReferenceLineControllable(z.id),N=this._getReferenceLineDraggableRotatable(z.id),H=this._getReferenceLineSlabThicknessControlsOn(z.id),{clientWidth:ee,clientHeight:oe}=z.canvas,de=Math.sqrt(ee*ee+oe*oe),ue=[ee*.5,oe*.5],me=z.canvasToWorld(ue),Ee=[0,0,0];kt.cross(g.viewPlaneNormal,A.viewPlaneNormal,Ee),kt.normalize(Ee),kt.multiplyScalar(Ee,de);const _e=[0,0,0];kt.add(me,Ee,_e);const Ce=[0,0,0];kt.subtract(me,Ee,Ce);const F=f.worldToCanvas(_e),O=f.worldToCanvas(me),$=Vt();Sr($,F,O),Oc($,$);const W=Vt();_c(W,$,x*100);const X=Vt();_c(X,$,C*.4);const Z=Vt();_c(Z,$,C*.2);const ne=Vt(),xe=this.configuration.referenceLinesCenterGapRadius;_c(ne,$,_.length===2?xe:0);const Ie=Vt(),Le=Vt(),je=Vt(),ie=Vt();let ae=j1(T);(!N||!L)&&(ae=j1(O)),Di(Ie,ae,ne),Di(Le,ae,W),Sr(je,ae,ne),Sr(ie,ae,W),dg(Ie,Le,D),dg(je,ie,D);const ve=Vt();Sr(ve,T,X);const se=Vt();Di(se,T,X);let ge=j1(T);!N&&H&&(ge=j1(O));let Ve=[...this.toolCenter];!N&&H&&(Ve=[...me]);const re=[0,0,0];kt.subtract(_e,Ce,re),kt.normalize(re);const{viewPlaneNormal:it}=g,{matrix:ut}=wi.buildFromDegree().rotate(90,it),ot=[0,0,0];Pt(ot,re,ut);const Se=z.getSlabThickness(),Ge=[...ot];kt.multiplyScalar(Ge,Se);const et=[0,0,0];kt.add(Ve,Ge,et);const qe=f.worldToCanvas(et),st=Vt();Sr(st,ge,qe);const Et=Vt();Sr(Et,ge,W),Di(Et,Et,st);const ct=Vt();Di(ct,ge,W),Di(ct,ct,st),dg(Et,ct,D);const bt=Vt();Di(bt,ge,W),Sr(bt,bt,st);const It=Vt();Sr(It,ge,W),Sr(It,It,st),dg(bt,It,D);const ln=Vt(),Pn=Vt(),zt=Vt(),Tn=Vt();Sr(ln,ge,Z),Di(ln,ln,st),Di(Pn,ge,Z),Di(Pn,Pn,st),Sr(zt,ge,Z),Sr(zt,zt,st),Di(Tn,ge,Z),Sr(Tn,Tn,st),E.push([z,Ie,Le,je,ie,Et,ct,bt,It,ve,se,ln,Pn,zt,Tn])});const b=[],I=[],R=this._getReferenceLineColor(f.id),M=R!==void 0?R:"rgb(200, 200, 200)";if(E.forEach((P,k)=>{var Ee,_e,Ce,F,O,$,W,X,Z,ne,xe,Ie,Le,je,ie,ae,ve,se,ge;const z=P[0],A=this._getReferenceLineColor(z.id),L=this._getReferenceLineControllable(z.id),N=this._getReferenceLineDraggableRotatable(z.id)||((Ee=this.configuration.mobile)==null?void 0:Ee.enabled),H=this._getReferenceLineSlabThicknessControlsOn(z.id)||((_e=this.configuration.mobile)==null?void 0:_e.enabled),ee=S.activeViewportIds.find(Ve=>Ve===z.id);let oe=A!==void 0?A:"rgb(200, 200, 200)",de=1;const ue=S.handles.activeOperation!==null&&S.handles.activeOperation===Ga.DRAG&&ee;ue&&(de=2.5);let me=`${k}`;if(L&&N?(me=`${k}One`,an(c,w,me,P[1],P[2],{color:oe,lineWidth:de}),me=`${k}Two`,an(c,w,me,P[3],P[4],{color:oe,lineWidth:de})):an(c,w,me,P[2],P[4],{color:oe,lineWidth:de}),L){oe=A!==void 0?A:"rgb(200, 200, 200)";const Ve=S.handles.activeOperation===Ga.ROTATE,re=[P[9],P[10]],it=[f.canvasToWorld(P[9]),z,P[1],P[2]],ut=[f.canvasToWorld(P[10]),z,P[3],P[4]];b.push(it,ut);const ot=S.handles.activeOperation===Ga.SLAB,Se=[P[11],P[12],P[13],P[14]],Ge=[f.canvasToWorld(P[11]),z,P[5],P[6]],et=[f.canvasToWorld(P[12]),z,P[5],P[6]],qe=[f.canvasToWorld(P[13]),z,P[7],P[8]],st=[f.canvasToWorld(P[14]),z,P[7],P[8]];if(I.push(Ge,et,qe,st),(ue||(Ce=this.configuration.mobile)!=null&&Ce.enabled)&&!Ve&&!ot&&N&&H){let ct=`${k}One`;Kn(c,w,ct,re,{color:oe,handleRadius:(F=this.configuration.mobile)!=null&&F.enabled?(O=this.configuration.mobile)==null?void 0:O.handleRadius:3,opacity:($=this.configuration.mobile)!=null&&$.enabled?(W=this.configuration.mobile)==null?void 0:W.opacity:1,type:"circle"}),ct=`${k}Two`,Kn(c,w,ct,Se,{color:oe,handleRadius:(X=this.configuration.mobile)!=null&&X.enabled?(Z=this.configuration.mobile)==null?void 0:Z.handleRadius:3,opacity:(ne=this.configuration.mobile)!=null&&ne.enabled?(xe=this.configuration.mobile)==null?void 0:xe.opacity:1,type:"rect"})}else if(ue&&!Ve&&!ot&&N){const ct=`${k}`;Kn(c,w,ct,re,{color:oe,handleRadius:(Ie=this.configuration.mobile)!=null&&Ie.enabled?(Le=this.configuration.mobile)==null?void 0:Le.handleRadius:3,opacity:(je=this.configuration.mobile)!=null&&je.enabled?(ie=this.configuration.mobile)==null?void 0:ie.opacity:1,type:"circle"})}else if(ee&&!Ve&&!ot&&H){const ct=`${k}`;Kn(c,w,ct,Se,{color:oe,handleRadius:(ae=this.configuration.mobile)!=null&&ae.enabled?(ve=this.configuration.mobile)==null?void 0:ve.handleRadius:3,opacity:(se=this.configuration.mobile)!=null&&se.enabled?(ge=this.configuration.mobile)==null?void 0:ge.opacity:1,type:"rect"})}else if(Ve&&N){const ct=`${k}`;Kn(c,w,ct,re,{color:oe,handleRadius:2,fill:oe,type:"circle"})}else ot&&ee&&H&&Kn(c,w,me,Se,{color:oe,handleRadius:2,fill:oe,type:"rect"});z.getSlabThickness()>.5&&H&&(me=`${k}STOne`,an(c,w,me,P[5],P[6],{color:oe,width:1,lineDash:[2,3]}),me=`${k}STTwo`,an(c,w,me,P[7],P[8],{color:oe,width:P,lineDash:[2,3]}))}}),l=!0,S.handles.rotationPoints=b,S.handles.slabThicknessPoints=I,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:P}=this.configuration,k=(P==null?void 0:P.xOffset)||.95,z=(P==null?void 0:P.yOffset)||.05,A=[m*k,y*z],L=(P==null?void 0:P.circleRadius)||x*.01;ho(c,w,"0",A,L,{color:M,fill:M})}return l},this._getAnnotations=s=>{const{viewport:c}=s,l=sn(this.getToolName(),c.element)||[],f=this._getViewportsInfo().map(({viewportId:d})=>d);return l.filter(d=>{const{data:h}=d;return f.includes(h.viewportId)})},this._onNewVolume=()=>{const s=this._getViewportsInfo();this._computeToolCenter(s)},this._areViewportIdArraysEqual=(s,c)=>s.length!==c.length?!1:(s.forEach(l=>{let f=!1;for(let u=0;u<c.length;++u)if(l===c[u]){f=!0;break}if(f===!1)return!1}),!0),this._getAnnotationsForViewportsWithDifferentCameras=(s,c)=>{const{viewportId:l,renderingEngine:f,viewport:u}=s,d=c.filter(w=>w.data.viewportId!==l);if(!d||!d.length)return[];const h=u.getCamera(),{viewPlaneNormal:g,position:p}=h;return d.filter(w=>{const{viewportId:m}=w.data,x=f.getViewport(m).getCamera();return!(At(x.viewPlaneNormal,g,.01)&&At(x.position,p,1))})},this._filterViewportWithSameOrientation=(s,c,l)=>{const{renderingEngine:f}=s,{data:u}=c,d=f.getViewport(u.viewportId),h=l.filter(w=>{const{data:m}=w,y=f.getViewport(m.viewportId);return this._getReferenceLineControllable(y.id)===!0});if(!h||!h.length)return[];const g=d.getCamera(),p=g.viewPlaneNormal;return kt.normalize(p),h.filter(w=>{const{viewportId:m}=w.data,x=f.getViewport(m).getCamera(),C=x.viewPlaneNormal;return kt.normalize(C),At(p,C,.01)&&At(g.viewUp,x.viewUp,.01)})},this._filterAnnotationsByUniqueViewportOrientations=(s,c)=>{const{renderingEngine:l,viewport:f}=s,d=f.getCamera().viewPlaneNormal;kt.normalize(d);const h=c.filter(w=>{const{data:m}=w,y=l.getViewport(m.viewportId),x=this._getReferenceLineControllable(y.id);return f!==y&&x===!0}),g=[];for(let w=0;w<h.length;++w){const m=h[w],{viewportId:y}=m.data,C=l.getViewport(y).getCamera(),S=C.viewPlaneNormal;if(kt.normalize(S),At(d,S,.01)||lg(d,S,.01))continue;let T=!1;for(let _=0;_<g.length;++_){const E=g[_],{viewportId:D}=E.data,I=l.getViewport(D).getCamera();At(I.viewPlaneNormal,C.viewPlaneNormal,.01)&&At(I.position,C.position,1)&&(T=!0)}T||g.push(m)}const p=c.filter(w=>{const{data:m}=w,y=l.getViewport(m.viewportId),x=this._getReferenceLineControllable(y.id);return f!==y&&x!==!0});for(let w=0;w<p.length;++w){const m=p[w],{viewportId:y}=m.data,C=l.getViewport(y).getCamera(),S=C.viewPlaneNormal;if(kt.normalize(S),At(d,S,.01)||lg(d,S,.01))continue;let T=!1;for(let _=0;_<g.length;++_){const E=g[_],{viewportId:D}=E.data,I=l.getViewport(D).getCamera();At(I.viewPlaneNormal,C.viewPlaneNormal,.01)&&At(I.position,C.position,1)&&(T=!0)}T||g.push(m)}const v=this._getAnnotationsForViewportsWithDifferentCameras(s,c);for(let w=0;w<v.length;++w){const m=v[w];if(g.some(_=>_===m))continue;const{viewportId:y}=m.data,C=l.getViewport(y).getCamera(),S=C.viewPlaneNormal;if(kt.normalize(S),At(d,S,.01)||lg(d,S,.01))continue;let T=!1;for(let _=0;_<g.length;++_){const E=g[_],{viewportId:D}=E.data,I=l.getViewport(D).getCamera();At(I.viewPlaneNormal,C.viewPlaneNormal,.01)&&At(I.position,C.position,1)&&(T=!0)}T||g.push(m)}return g},this._checkIfViewportsRenderingSameScene=(s,c)=>{const l=s.getAllVolumeIds(),f=c.getAllVolumeIds();return l.length===f.length&&l.every(u=>f.includes(u))},this._jump=(s,c)=>{ze.isInteractingWithTool=!0;const{viewport:l,renderingEngine:f}=s,u=this._getAnnotations(s),d=[0,0,0];kt.subtract(c,this.toolCenter,d);const g=this._getAnnotationsForViewportsWithDifferentCameras(s,u).filter(p=>{const{data:v}=p,w=f.getViewport(v.viewportId),m=this._checkIfViewportsRenderingSameScene(l,w);return this._getReferenceLineControllable(w.id)&&this._getReferenceLineDraggableRotatable(w.id)&&m});return g.length===0?(ze.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(f,g,d),ze.isInteractingWithTool=!1,!0)},this._activateModify=s=>{var c;ze.isInteractingWithTool=!((c=this.configuration.mobile)!=null&&c.enabled),s.addEventListener(U.MOUSE_UP,this._endCallback),s.addEventListener(U.MOUSE_DRAG,this._dragCallback),s.addEventListener(U.MOUSE_CLICK,this._endCallback),s.addEventListener(U.TOUCH_END,this._endCallback),s.addEventListener(U.TOUCH_DRAG,this._dragCallback),s.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=s=>{ze.isInteractingWithTool=!1,s.removeEventListener(U.MOUSE_UP,this._endCallback),s.removeEventListener(U.MOUSE_DRAG,this._dragCallback),s.removeEventListener(U.MOUSE_CLICK,this._endCallback),s.removeEventListener(U.TOUCH_END,this._endCallback),s.removeEventListener(U.TOUCH_DRAG,this._dragCallback),s.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._endCallback=s=>{const c=s.detail,{element:l}=c;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(l),Ut(l),this.editData=null;const u=pt(l,this.getToolName(),!1);Me(u)},this._dragCallback=s=>{const c=s.detail,l=c.deltaPoints.world;if(Math.abs(l[0])<.001&&Math.abs(l[1])<.001&&Math.abs(l[2])<.001)return;const{element:f}=c,u=we(f),{renderingEngine:d,viewport:h}=u,g=this._getAnnotations(u),v=this.filterInteractableAnnotationsForElement(f,g)[0];if(!v)return;const{handles:w}=v.data,{currentPoints:m}=s.detail,y=m.canvas;if(w.activeOperation===Ga.DRAG){const C=this._getAnnotationsForViewportsWithDifferentCameras(u,g).filter(S=>{const{data:T}=S,_=d.getViewport(T.viewportId),E=this._getReferenceLineControllable(_.id),D=this._getReferenceLineDraggableRotatable(_.id);return E===!0&&D===!0&&v.data.activeViewportIds.find(b=>b===_.id)});this._applyDeltaShiftToSelectedViewportCameras(d,C,l)}else if(w.activeOperation===Ga.ROTATE){const C=this._getAnnotationsForViewportsWithDifferentCameras(u,g).filter(k=>{const{data:z}=k,A=d.getViewport(z.viewportId),L=this._getReferenceLineControllable(A.id),N=this._getReferenceLineDraggableRotatable(A.id);return L===!0&&N===!0}),S=Vt(),T=Vt(),_=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],E=h.worldToCanvas(_),D=c.currentPoints.canvas,b=Vt();ya(b,D,c.deltaPoints.canvas),ya(S,b,E),ya(T,D,E);let I=Rq(S,T);this._isClockWise(E,b,D)&&(I*=-1),I=Math.round(I*100)/100;const R=h.getCamera().viewPlaneNormal,{matrix:M}=wi.buildFromRadian().translate(_[0],_[1],_[2]).rotate(I,R).translate(-_[0],-_[1],-_[2]),P=[];C.forEach(k=>{const{data:z}=k;z.handles.toolCenter=_;const A=d.getViewport(z.viewportId),L=A.getCamera(),{viewUp:N,position:H,focalPoint:ee}=L;N[0]+=H[0],N[1]+=H[1],N[2]+=H[2],Pt(ee,ee,M),Pt(H,H,M),Pt(N,N,M),N[0]-=H[0],N[1]-=H[1],N[2]-=H[2],A.setCamera({position:H,viewUp:N,focalPoint:ee}),P.push(A.id)}),d.renderViewports(P)}else if(w.activeOperation===Ga.SLAB){const C=this._getAnnotationsForViewportsWithDifferentCameras(u,g).filter(_=>{const{data:E}=_,D=d.getViewport(E.viewportId),b=this._getReferenceLineControllable(D.id),I=this._getReferenceLineSlabThicknessControlsOn(D.id);return b===!0&&I===!0&&v.data.activeViewportIds.find(R=>R===D.id)});if(C.length===0)return;const S=this._filterViewportWithSameOrientation(u,C[0],g),T=[];T.push(h.id),S.forEach(_=>{const{data:E}=_,D=d.getViewport(E.viewportId),I=D.getCamera().viewPlaneNormal,R=kt.dot(l,I),M=[...I];if(kt.multiplyScalar(M,R),Math.abs(M[0])>.001||Math.abs(M[1])>.001||Math.abs(M[2])>.001){const P=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2]),k=c.lastPoints.world,z=[0,0,0],A=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(D.id)){const{rotationPoints:_e}=this.editData.annotation.data.handles,Ce=_e.filter(F=>F[1].uid===D.id);if(Ce.length===2){const F=h.canvasToWorld(Ce[0][3]),O=h.canvasToWorld(Ce[1][3]);kt.add(F,O,A),kt.multiplyScalar(A,.5)}}kt.subtract(k,A,z);const N=kt.dot(z,I),H=[...I];kt.multiplyScalar(H,N);const ee=[H[0],H[1],H[2]];kn(ee,ee);const oe=[M[0],M[1],M[2]];kn(oe,oe);let de=D.getSlabThickness();lg(ee,oe,.001)?de-=P:de+=P,de=Math.abs(de),de=Math.max(_3.MINIMUM_SLAB_THICKNESS,de),this._pointNearReferenceLine(v,y,6,D)&&(de=_3.MINIMUM_SLAB_THICKNESS),or(D.id,d.id).getToolInstance(this.getToolName()).setSlabThickness(D,de),T.push(D.id)}}),d.renderViewports(T)}},this._pointNearReferenceLine=(s,c,l,f)=>{const{data:u}=s,{rotationPoints:d}=u.handles;for(let h=0;h<d.length-1;++h){const g=d[h][1];if(g.id!==f.id||!this._getReferenceLineControllable(g.id))continue;const v={start:{x:d[h][2][0],y:d[h][2][1]},end:{x:d[h][3][0],y:d[h][3][1]}},w=Ii([v.start.x,v.start.y],[v.end.x,v.end.y],[c[0],c[1]]),m={start:{x:d[h+1][2][0],y:d[h+1][2][1]},end:{x:d[h+1][3][0],y:d[h+1][3][1]}},y=Ii([m.start.x,m.start.y],[m.end.x,m.end.y],[c[0],c[1]]);if(w<=l||y<=l)return!0;h++}return!1},this._getReferenceLineColor=((n=e.configuration)==null?void 0:n.getReferenceLineColor)||Gxe,this._getReferenceLineControllable=((i=e.configuration)==null?void 0:i.getReferenceLineControllable)||Wxe,this._getReferenceLineDraggableRotatable=((o=e.configuration)==null?void 0:o.getReferenceLineDraggableRotatable)||zxe,this._getReferenceLineSlabThicknessControlsOn=((a=e.configuration)==null?void 0:a.getReferenceLineSlabThicknessControlsOn)||$xe}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach(({renderingEngineId:r,viewportId:n})=>{const i=zr(n,r);if(!i)return;const o=this._getAnnotations(i);o!=null&&o.length&&o.forEach(a=>{hn(a.annotationUID)})})}getHandleNearImagePoint(e,r,n,i){const o=we(e),{viewport:a}=o;let s=this._getRotationHandleNearImagePoint(a,r,n,i);if(s!==null||(s=this._getSlabThicknessHandleNearImagePoint(a,r,n,i),s!==null))return s}_unsubscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=zr(r,n),{element:o}=i;o.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_subscribeToViewportNewVolumeSet(e){e.forEach(({viewportId:r,renderingEngineId:n})=>{const{viewport:i}=zr(r,n),{element:o}=i;o.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)})}_autoPanViewportIfNecessary(e,r){const n=r.getViewport(e),{clientWidth:i,clientHeight:o}=n.canvas,a=n.worldToCanvas(this.toolCenter),s=this.configuration.autoPan.panSize,c=[a[0],a[1]];if(a[0]<0?c[0]=s:a[0]>i&&(c[0]=i-s),a[1]<0?c[1]=s:a[1]>o&&(c[1]=o-s),c[0]===a[0]&&c[1]===a[1])return;const l=n.canvasToWorld(c),f=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],u=n.getCamera(),{focalPoint:d,position:h}=u,g=[h[0]-f[0],h[1]-f[1],h[2]-f[2]],p=[d[0]-f[0],d[1]-f[1],d[2]-f[2]];n.setCamera({focalPoint:p,position:g}),n.render()}setSlabThickness(e,r){let n;const{filterActorUIDsToSetSlabThickness:i}=this.configuration;i&&i.length>0&&(n=i);let o=this.configuration.slabThicknessBlendMode;r===_3.MINIMUM_SLAB_THICKNESS&&(o=zf.COMPOSITE),e.setBlendMode(o,n,!1),e.setSlabThickness(r,n)}_isClockWise(e,r,n){return(r[0]-e[0])*(n[1]-e[1])-(r[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,r,n){r.forEach(i=>{this._applyDeltaShiftToViewportCamera(e,i,n)})}_applyDeltaShiftToViewportCamera(e,r,n){const{data:i}=r,o=e.getViewport(i.viewportId),a=o.getCamera(),s=a.viewPlaneNormal,c=kt.dot(n,s),l=[...s];if(kt.multiplyScalar(l,c),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const f=[0,0,0],u=[0,0,0];kt.add(a.focalPoint,l,f),kt.add(a.position,l,u),o.setCamera({focalPoint:f,position:u}),o.render()}}_getRotationHandleNearImagePoint(e,r,n,i){const{data:o}=r,{rotationPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineDraggableRotatable(l.id))continue;const d=e.worldToCanvas(c);if(ir(n,d)<i)return o.handles.activeOperation=Ga.ROTATE,this.editData={annotation:r},c}return null}_getSlabThicknessHandleNearImagePoint(e,r,n,i){const{data:o}=r,{slabThicknessPoints:a}=o.handles;for(let s=0;s<a.length;s++){const c=a[s][0],l=a[s][1];if(!this._getReferenceLineControllable(l.id)||!this._getReferenceLineSlabThicknessControlsOn(l.id))continue;const d=e.worldToCanvas(c);if(ir(n,d)<i)return o.handles.activeOperation=Ga.SLAB,o.activeViewportIds=[l.id],this.editData={annotation:r},c}return null}_pointNearTool(e,r,n,i){const o=we(e),{viewport:a}=o,{clientWidth:s,clientHeight:c}=a.canvas,l=Math.sqrt(s*s+c*c),{data:f}=r,{rotationPoints:u}=f.handles,{slabThicknessPoints:d}=f.handles,h=[];for(let g=0;g<u.length-1;++g){const p=u[g][1],v=this._getReferenceLineControllable(p.id),w=this._getReferenceLineDraggableRotatable(p.id);if(!v||!w)continue;const m={start:{x:u[g][2][0],y:u[g][2][1]},end:{x:u[g][3][0],y:u[g][3][1]}},y=Ii([m.start.x,m.start.y],[m.end.x,m.end.y],[n[0],n[1]]),x={start:{x:u[g+1][2][0],y:u[g+1][2][1]},end:{x:u[g+1][3][0],y:u[g+1][3][1]}},C=Ii([x.start.x,x.start.y],[x.end.x,x.end.y],[n[0],n[1]]);(y<=i||C<=i)&&(h.push(p.id),f.handles.activeOperation=Ga.DRAG),g++}for(let g=0;g<d.length-1;++g){const p=d[g][1];if(h.find(R=>R===p.id))continue;const v=this._getReferenceLineControllable(p.id),w=this._getReferenceLineSlabThicknessControlsOn(p.id);if(!v||!w)continue;const m=d[g][2],y=d[g][3],x=Vt();Di(x,m,y),_c(x,x,.5);const C=Vt();Sr(C,m,x),Oc(C,C);const S=Vt();_c(S,C,l*.05);const T=Vt(),_=Vt();Di(T,x,S),Sr(_,x,S);const E={start:{x:T[0],y:T[1]},end:{x:m[0],y:m[1]}},D=Ii([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]),b={start:{x:_[0],y:_[1]},end:{x:y[0],y:y[1]}},I=Ii([b.start.x,b.start.y],[b.end.x,b.end.y],[n[0],n[1]]);(D<=i||I<=i)&&(h.push(p.id),f.handles.activeOperation=null),g++}return f.activeViewportIds=[...h],this.editData={annotation:r},f.handles.activeOperation===Ga.DRAG}}oG.toolName="Crosshairs";const Bm="magnify-viewport";class aG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,r),this._hasBeenRemoved=!1,this.preMouseDownCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,s=we(o),{viewport:c,renderingEngine:l}=s;if(!(c instanceof Jn))throw new Error("MagnifyTool only works on StackViewports");const f=this._getReferencedImageId(c);if(!f)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const u=pt(o,this.getToolName());return this.editData={referencedImageId:f,viewportIdsToRender:u,enabledElement:s,renderingEngine:l,currentPoints:a},this._createMagnificationViewport(),this._activateDraw(o),Tt(o),n.preventDefault(),Me(u),!0},this.preTouchStartCallback=n=>{this.preMouseDownCallback(n)},this._createMagnificationViewport=()=>{const{enabledElement:n,referencedImageId:i,viewportIdsToRender:o,renderingEngine:a,currentPoints:s}=this.editData,{viewport:c}=n,{element:l}=c,f=c.getProperties(),{canvas:u,world:d}=s;let h;if(h=l.querySelector(".magnifyTool"),h===null){const p=document.createElement("div");p.classList.add("magnifyTool"),p.style.display="block",p.style.width=`${this.configuration.magnifyWidth}px`,p.style.height=`${this.configuration.magnifyHeight}px`,p.style.position="absolute",h=p,l.querySelector(".viewport-element").appendChild(p);const w={viewportId:Bm,type:Hn.STACK,element:h};a.enableElement(w)}h.style.top=`${u[1]-this.configuration.magnifyHeight/2}px`,h.style.left=`${u[0]-this.configuration.magnifyWidth/2}px`;const g=a.getViewport(Bm);g.setStack([i]).then(()=>{if(this._hasBeenRemoved)return;g.setProperties(f);const{parallelScale:p}=c.getCamera(),{focalPoint:v,position:w,viewPlaneNormal:m}=g.getCamera(),y=Math.sqrt(Math.pow(v[0]-w[0],2)+Math.pow(v[1]-w[1],2)+Math.pow(v[2]-w[2],2)),x=[d[0],d[1],d[2]],C=[x[0]+y*m[0],x[1]+y*m[1],x[2]+y*m[2]];g.setCamera({parallelScale:p*(1/this.configuration.magnifySize),focalPoint:x,position:C}),g.render()}),h.style.display="block",Me(o)},this._dragCallback=n=>{const i=n.detail,{deltaPoints:o,element:a,currentPoints:s}=i,c=o.world,l=s.canvas,f=we(a),{renderingEngine:u}=f,d=u.getViewport(Bm),h=a.querySelector(".magnifyTool");if(!h)return;h.style.top=`${l[1]-this.configuration.magnifyHeight/2}px`,h.style.left=`${l[0]-this.configuration.magnifyWidth/2}px`;const{focalPoint:g,position:p}=d.getCamera(),v=[p[0]+c[0],p[1]+c[1],p[2]+c[2]],w=[g[0]+c[0],g[1]+c[1],g[2]+c[2]];d.setCamera({focalPoint:w,position:v}),d.render()},this._dragEndCallback=n=>{const{element:i}=n.detail,o=we(i),{renderingEngine:a}=o;a.disableElement(Bm);const s=i.querySelector(".viewport-element"),c=s.querySelector(".magnifyTool");s.removeChild(c),this._deactivateDraw(i),Ut(i),this._hasBeenRemoved=!0},this._activateDraw=n=>{ze.isInteractingWithTool=!0,this._hasBeenRemoved=!1,n.addEventListener(U.MOUSE_UP,this._dragEndCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._dragEndCallback),n.addEventListener(U.TOUCH_END,this._dragEndCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._dragEndCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._dragEndCallback),n.removeEventListener(U.TOUCH_END,this._dragEndCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const r=this.getTargetId(e);let n;return e instanceof Jn&&(n=r.split("imageId:")[1]),n}}aG.toolName="Magnify";const jxe="advancedMagnifyTool",Hxe=125,{Events:Dl}=Da,mb=t=>t.uid!==t.referencedId;var sS;(function(t){t.ShowZoomFactorsList="showZoomFactorsList"})(sS||(sS={}));const Kxe="AdvancedMagnify",qxe=1-cs,x8=class x8 extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:Xs.Secondary,modifierKey:ii.Shift}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=we(a),{viewport:c,renderingEngine:l}=s,f=o.world,u=o.canvas,{magnifyingGlass:d}=this.configuration,{radius:h,zoomFactor:g,autoPan:p}=d,v=this._getCanvasHandlePoints(u,h),w=c.getCamera(),{viewPlaneNormal:m,viewUp:y}=w,x=this.getReferencedImageId(c,f,m,y),C=Cn(),S=Cn(),T=c.getFrameOfReferenceUID(),_={annotationUID:C,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...m],viewUp:[...y],FrameOfReferenceUID:T,referencedImageId:x},data:{sourceViewportId:c.id,magnifyViewportId:S,zoomFactor:g,isCanvasAnnotation:!0,handles:{points:v,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(_,{magnifyViewportId:S,sourceEnabledElement:s,position:u,radius:h,zoomFactor:g,autoPan:{enabled:p.enabled,padding:p.padding,callback:D=>{const b=_.data.handles.points,{canvas:I}=D.delta;for(let R=0,M=b.length;R<M;R++){const P=b[R];P[0]+=I[0],P[1]+=I[1],_.invalidated=!0}}}}),Zt(_,a);const E=pt(a,this.getToolName());return n.preventDefault(),Me(E),_},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose(),E5().forEach(i=>{i.metadata.toolName===this.getToolName()&&hn(i.annotationUID)})},this.isPointNearTool=(n,i,o,a)=>{const{data:s}=i,{points:c}=s.handles,l=c,f=l[0],u=l[2],d=l[3],h=Math.abs(u[1]-f[1])*.5,g=[d[0]+h,f[1]+h],p=ou([g,o]);return Math.abs(p-h)<a*2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},Tt(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;const{points:l}=c.handles,f=l.findIndex(d=>d===o),u=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f},this._activateModify(s),Tt(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{data:l}=a;l.handles.activeHandleIndex=null,this._deactivateModify(o),Ut(o),this.editData=null,this.isDrawing=!1,Me(s),c&&Bn(a)},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{deltaPoints:o}=i,a=(o==null?void 0:o.canvas)??[0,0,0],{annotation:s,viewportIdsToRender:c}=this.editData,{points:l}=s.data.handles;l.forEach(f=>{f[0]+=a[0],f[1]+=a[1]}),s.invalidated=!0,this.editData.hasMoved=!0,Me(c)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{annotation:o,viewportIdsToRender:a,handleIndex:s}=this.editData,{data:c}=o;if(s===void 0){const{deltaPoints:l}=i,f=l.canvas;c.handles.points.forEach(d=>{d[0]+=f[0],d[1]+=f[1]}),o.invalidated=!0}else this._dragHandle(n),o.invalidated=!0;Me(a)},this._dragHandle=n=>{const i=n.detail,{annotation:o}=this.editData,{data:a}=o,{points:s}=a.handles,c=s,l=c[0],f=c[2],u=c[3],d=Math.abs(f[1]-l[1])*.5,h=[u[0]+d,l[1]+d],{currentPoints:g}=i,p=g.canvas,v=ou([h,p]),w=this._getCanvasHandlePoints(h,v);s[0]=w[0],s[1]=w[1],s[2]=w[2],s[3]=w[3]},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length))return o;c=c==null?void 0:c.filter(u=>u.data.sourceViewportId===a.id);const l=this.filterInteractableAnnotationsForElement(s,c);if(!(l!=null&&l.length))return o;const f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let u=0;u<l.length;u++){const d=l[u],{annotationUID:h,data:g}=d,{magnifyViewportId:p,zoomFactor:v,handles:w}=g,{points:m,activeHandleIndex:y}=w;f.annotationUID=h,this.getStyle("lineWidth",f,d),this.getStyle("lineDash",f,d);const x=this.getStyle("color",f,d),C=m,S=C[0],T=C[2],_=C[3],E=Math.abs(T[1]-S[1])*.5,D=[_[0]+E,S[1]+E];if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let b;if(!ti(h))continue;!jr(h)&&!this.editData&&y!==null&&(b=[C[y]]),b&&Kn(i,h,"0",b,{color:x});const I=`${h}-advancedMagnify`;ho(i,h,"0",D,E,{color:x,lineWidth:5},I);const M=this.magnifyViewportManager.getViewport(p);M.position=D,M.radius=E,M.zoomFactor=v,M.update(),o=!0}return o},this._getCanvasHandlePoints=(n,i)=>[[n[0],n[1]-i,0],[n[0]+i,n[1],0],[n[0],n[1]+i,0],[n[0]-i,n[1],0]],this.magnifyViewportManager=q0.getInstance()}showZoomFactorsList(e,r){const{element:n,currentPoints:i}=e.detail,o=we(n),{viewport:a}=o,{canvas:s}=i,c=n.querySelector(":scope .viewport-element"),l=r.data.zoomFactor,f=()=>u.parentElement.removeChild(u),u=this._getZoomFactorsListDropdown(l,d=>{d!==void 0&&(r.data.zoomFactor=Number.parseFloat(d),r.invalidated=!0),f(),a.render()});Object.assign(u.style,{left:`${s[0]}px`,top:`${s[1]}px`}),c.appendChild(u),u.focus()}_getZoomFactorsListDropdown(e,r){const{zoomFactorList:n}=this.configuration.magnifyingGlass,i=document.createElement("select");return i.size=5,Object.assign(i.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach(o=>{i.addEventListener(o,a=>a.stopPropagation())}),i.addEventListener("change",o=>{o.stopPropagation(),r(i.value)}),i.addEventListener("keydown",o=>{var s;((o.keyCode??o.which===27)||((s=o.key)==null?void 0:s.toLowerCase())==="escape")&&(o.stopPropagation(),r())}),n.forEach(o=>{const a=document.createElement("option");a.label=o,a.title=`Zoom factor ${o.toFixed(1)}`,a.value=o,a.defaultSelected=o===e,i.add(a)}),i}};x8.Actions=sS;let Fp=x8;class q0{constructor(){this.createViewport=(e,r)=>{const{magnifyViewportId:n,sourceEnabledElement:i,position:o,radius:a,zoomFactor:s,autoPan:c}=r,{viewport:l}=i,{element:f}=l,u=new Xxe({magnifyViewportId:n,sourceEnabledElement:i,radius:a,position:o,zoomFactor:s,autoPan:c});return this._addSourceElementEventListener(f),this._magnifyViewportsMap.set(u.viewportId,{annotation:e,magnifyViewport:u,magnifyViewportInfo:r}),u},this._annotationRemovedCallback=e=>{const{annotation:r}=e.detail;r.metadata.toolName===Kxe&&this.destroyViewport(r.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:r,imageId:n}=e.detail,i=this._getMagnifyViewportsMapEntriesBySourceViewportId(r),{viewport:o}=An(r);o.stackActorReInitialized&&this._reset(r),i.forEach(({annotation:a})=>{a.metadata.referencedImageId=n,a.invalidated=!0})},this._newVolumeImageCallback=e=>{const{renderingEngineId:r,viewportId:n}=e.detail,o=fr(r).getViewport(n),{viewPlaneNormal:a}=o.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach(({annotation:c})=>{const{viewPlaneNormal:l}=c.metadata;if(!(Math.abs(gt(l,a))>qxe))return;const{handles:u}=c.data,d=o.canvasToWorld([0,0]),h=bn(Ae(),d,u.points[0]),g=gt(h,a),p=mr(Ae(),a,g);for(let v=0,w=u.points.length;v<w;v++){const m=u.points[v];m[0]+=p[0],m[1]+=p[1],m[2]+=p[2]}c.invalidated=!0})},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return q0._singleton=q0._singleton??new q0,q0._singleton}getViewport(e){var r;return(r=this._magnifyViewportsMap.get(e))==null?void 0:r.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const r=this._magnifyViewportsMap.get(e);if(r){const{magnifyViewport:n}=r,{viewport:i}=n.sourceEnabledElement,{element:o}=i;this._removeSourceElementEventListener(o),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach(r=>this.destroyViewport(r))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter(({magnifyViewport:n})=>{const{viewport:i}=n.sourceEnabledElement;return i.id===e})}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach(({magnifyViewport:n,annotation:i,magnifyViewportInfo:o})=>{this.destroyViewport(n.viewportId);const a=An(e);this.createViewport(i,{...o,sourceEnabledElement:{...a}})})}_addEventListeners(){We.addEventListener(U.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){We.removeEventListener(U.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(Dl.STACK_NEW_IMAGE,this._newStackImageCallback);const r=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(Dl.VIEWPORT_NEW_IMAGE_SET,r);const n=i=>{const{viewportId:o}=i.detail;this._reset(o)};e.addEventListener(Dl.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(Dl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=r,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(Dl.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(Dl.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(Dl.VIEWPORT_NEW_IMAGE_SET,e.newStackHandler),e.removeEventListener(Dl.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}class Xxe{constructor({magnifyViewportId:e,sourceEnabledElement:r,radius:n=Hxe,position:i=[0,0],zoomFactor:o,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??Cn(),this._sourceEnabledElement=r,this._autoPan=a,this.radius=n,this.position=i,this.zoomFactor=o,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=P5(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:r,visible:n}=this,{viewport:i}=this._enabledElement,{element:o}=i,a=2*e,[s,c]=r;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(o.style,{display:n?"block":"hidden",width:`${a}px`,height:`${a}px`,left:`${-e}px`,top:`${-e}px`,transform:`translate(${s}px, ${c}px)`}),this._isViewportReady&&(this._syncViewports(),i.render())}dispose(){const{viewport:e}=this._enabledElement,{element:r}=e,n=e.getRenderingEngine();this._removeEventListeners(r),n.disableElement(e.id),r.parentNode&&r.parentNode.removeChild(r)}_handleToolModeChanged(e){var s;const{_magnifyToolGroup:r}=this,{toolGroupId:n,toolName:i,mode:o,toolBindingsOptions:a}=e.detail;if(((s=this._sourceToolGroup)==null?void 0:s.id)===n)switch(o){case wn.Active:r.setToolActive(i,a);break;case wn.Passive:r.setToolPassive(i);break;case wn.Enabled:r.setToolEnabled(i);break;case wn.Disabled:r.setToolDisabled(i);break;default:throw new Error(`Unknow tool mode (${o})`)}}_inheritBorderRadius(e){const r=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");r.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:r}=this,n=r*2;return e.classList.add(jxe),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:`${-r}px`,top:`${-r}px`,transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,r,n){const{parallelScale:i}=e.getCamera(),o=r.canvas.offsetWidth/e.canvas.offsetWidth;return i*(1/n)*o}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,r){const n=e.getActors(),i=`${r.id}-toolGroup`,o=or(e.id,e.renderingEngineId),a=o.clone(i,s=>{const c=o.getToolInstance(s);return c instanceof zn&&!(c instanceof Fp)});return a.addViewport(r.id,r.renderingEngineId),n.filter(mb).forEach(s=>{ph(this.viewportId,[{segmentationId:s.referencedId,type:ht.Labelmap}])}),{sourceToolGroup:o,magnifyToolGroup:a}}_cloneStack(e,r){const n=e.getImageIds();r.setStack(n).then(()=>{this._isViewportReady=!0,this.update()})}_cloneVolumes(e,r){const i=e.getActors().filter(o=>!mb(o)).map(o=>({volumeId:o.uid}));return r.setVolumes(i).then(()=>{this._isViewportReady=!0,this.update()}),r}_cloneViewport(e,r){const{viewportId:n}=this,i=e.getRenderingEngine(),{options:o}=e,a={element:r,viewportId:n,type:e.type,defaultOptions:{...o}};i.enableElement(a);const s=i.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,s):this._isVolumeViewport(e)&&this._cloneVolumes(e,s),this._inheritBorderRadius(r);const c=this._cloneToolGroups(e,s);this._sourceToolGroup=c.sourceToolGroup,this._magnifyToolGroup=c.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:r}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),r.addEventListener("mouseup",this._cancelMouseEventCallback),r.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){var n;const{element:r}=this._enabledElement.viewport;this._canAutoPan=!!((n=e.target)!=null&&n.closest(".advancedMagnifyTool")),document.addEventListener("mouseup",this._browserMouseUpCallback),r.removeEventListener("mouseup",this._cancelMouseEventCallback),r.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!ze.isInteractingWithTool)return;const{_autoPan:r}=this;if(!r.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:i}=this._enabledElement,{canvasToWorld:o}=i,{canvas:a}=n,{radius:s}=this,c=[s,s],l=_a(c,a),f=s-r.padding;if(l<=f)return;const u=l-f,d=ya(Vt(),a,c);Oc(d,d),_c(d,d,u);const h=Di(Vt(),this.position,d),g=o(this.position),p=o(h),v=bn(Ae(),p,g),w={points:{currentPosition:{canvas:this.position,world:g},newPosition:{canvas:h,world:p}},delta:{canvas:d,world:v}};r.callback(w)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){We.addEventListener(U.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(U.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(U.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){We.removeEventListener(U.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(U.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(U.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:r}=e,{canvas:n}=r,i=this._createViewportNode();n.parentNode.appendChild(i),this._addEventListeners(i),this._cloneViewport(r,i),this._enabledElement=we(i)}_syncViewportsCameras(e,r){const n=e.canvasToWorld(this.position),i=this._convertZoomFactorToParallelScale(e,r,this.zoomFactor),{focalPoint:o,position:a,viewPlaneNormal:s}=r.getCamera(),c=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2)+Math.pow(o[2]-a[2],2)),l=[n[0],n[1],n[2]],f=[l[0]+c*s[0],l[1]+c*s[1],l[2]+c*s[2]];r.setCamera({parallelScale:i,focalPoint:l,position:f})}_syncStackViewports(e,r){r.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:r}=this._enabledElement,n=e.getProperties();r.getImageData()&&(r.setProperties(n),this._syncViewportsCameras(e,r),this._isStackViewport(e)&&this._syncStackViewports(e,r),this._syncViewportsCameras(e,r),r.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}Fp.toolName="AdvancedMagnify";const{EPSILON:E3}=Cu;class sG extends _u{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",enforceSameFrameOfReference:!0,showFullDimension:!1}}){super(e,r),this.editData=null,this._init=()=>{var h;const i=Qi()[0];if(!i)return;let o=i.getViewports();o=F5(o,this.getToolName());const a=i.getViewport(this.configuration.sourceViewportId);if(!(a!=null&&a.getImageData()))return;const{element:s}=a,{viewUp:c,viewPlaneNormal:l}=a.getCamera(),f=Gv(a);let u=(h=this.editData)==null?void 0:h.annotation;const d=a.getFrameOfReferenceUID();if(u)this.editData.annotation.data.handles.points=f;else{const g={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...c],FrameOfReferenceUID:d,referencedImageId:null},data:{handles:{points:f}}};Zt(g,s),u=g}this.editData={sourceViewportId:a.id,renderingEngine:i,annotation:u},Me(o.filter(g=>g.id!==a.id).map(g=>g.id))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{var N,H;const{viewport:o}=n;if(!this.editData)return!1;const{annotation:a,sourceViewportId:s}=this.editData;let c=!1;const{viewport:l}=An(s)||{};if(!l||l.id===o.id||!a||!((H=(N=a==null?void 0:a.data)==null?void 0:N.handles)!=null&&H.points)||this.configuration.enforceSameFrameOfReference&&l.getFrameOfReferenceUID()!==o.getFrameOfReferenceUID())return c;const f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=a.data.handles.points[0],d=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],{focalPoint:p,viewPlaneNormal:v,viewUp:w}=o.getCamera(),{viewPlaneNormal:m}=l.getCamera();if(this.isParallel(v,m))return c;const y=Nc(v,p),x=[u,h,d,g],C=[u,d,h,g];let S=x,T=yn(Ae(),x[0],x[1]);T=kn(Ae(),T);let _=yn(Ae(),x[2],x[0]);_=kn(Ae(),_);const E=xn(Ae(),T,_);if(this.isParallel(E,v))return c;this.isPerpendicular(T,v)&&(S=C);const D=Ad(S[0],S[1],y),b=Ad(S[2],S[3],y),{annotationUID:I}=a;f.annotationUID=I;const R=this.getStyle("lineWidth",f,a),M=this.getStyle("lineDash",f,a),P=this.getStyle("color",f,a),k=this.getStyle("shadow",f,a);let z=[D,b].map(ee=>o.worldToCanvas(ee));if(this.configuration.showFullDimension&&(z=this.handleFullDimension(o,D,v,w,b,z)),z.length<2)return c;const A=`${I}-line`;return an(i,I,"1",z[0],z[1],{color:P,width:R,lineDash:M,shadow:k},A),c=!0,c},this.isPerpendicular=(n,i)=>{const o=gt(n,i);return Math.abs(o)<E3}}handleFullDimension(e,r,n,i,o,a){e.getRenderingEngine();const s=this.getTargetId(e),c=this.getTargetImageData(s),l=this.getReferencedImageId(e,r,n,i);if(l&&c)try{const{imageData:f,dimensions:u}=c,[d,h,g,p]=[f.indexToWorld([0,0,0]),f.indexToWorld([u[0]-1,0,0]),f.indexToWorld([u[0]-1,u[1]-1,0]),f.indexToWorld([0,u[1]-1,0])].map(m=>EC(l,m)),[v,w]=[r,o].map(m=>EC(l,m));a=[[d,h],[h,g],[p,g],[d,p]].map(([m,y])=>this.intersectInfiniteLines(m,y,v,w)).filter(m=>m&&this.isInBound(m,u)).map(m=>{const y=zA(l,m);return e.worldToCanvas(y)})}catch(f){console.log(f)}return a}intersectInfiniteLines(e,r,n,i){const[o,a]=e,[s,c]=r,[l,f]=n,[u,d]=i,h=c-a,g=o-s,p=s*a-o*c,v=d-f,w=l-u,m=u*f-l*d;if(Math.abs(h*w-v*g)<E3)return;const y=(g*m-w*p)/(h*w-v*g),x=(v*p-h*m)/(h*w-v*g);return[y,x]}isParallel(e,r){return Math.abs(gt(e,r))>1-E3}isInBound(e,r){return e[0]>=0&&e[0]<=r[0]&&e[1]>=0&&e[1]<=r[1]}}sG.toolName="ReferenceLines";const{EPSILON:vb}=Cu;class cG extends _u{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,r),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const n=this.configuration.sourceImageIds;if(!(n!=null&&n.length)){console.warn("OverlayGridTool: No sourceImageIds provided in configuration");return}const i=dt("imagePlaneModule",n[0]);if(!i){console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");return}const{frameOfReferenceUID:o}=i,a=Li(this.toolGroupId).viewportsInfo;if(!(a!=null&&a.length)){console.warn("OverlayGridTool: No viewports found");return}const s=sn(this.getToolName(),o);if(!(s!=null&&s.length)){const c=n.map(f=>this.calculateImageIdPointSets(f)),l={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{viewportData:new Map,pointSets:c}};Zt(l,o)}Me(a.map(({viewportId:c})=>c))},this.calculateImageIdPointSets=n=>{const{imagePositionPatient:i,rows:o,columns:a,rowCosines:s,columnCosines:c,rowPixelSpacing:l,columnPixelSpacing:f}=dt("imagePlaneModule",n),u=[...i],d=[...i],h=[...i],g=[...i];return Xt(d,i,c,a*f),Xt(h,i,s,o*l),Xt(g,h,c,a*f),{pointSet1:[u,h,d,g],pointSet2:[u,d,h,g]}},this.renderAnnotation=(n,i)=>{const o=this.configuration.sourceImageIds;let a=!1;if(!(o!=null&&o.length))return a;const{viewport:s,FrameOfReferenceUID:c}=n;if(s.getImageIds().length<2)return a;const f=sn(this.getToolName(),c);if(!(f!=null&&f.length))return a;const u=f[0],{annotationUID:d}=u,{focalPoint:h,viewPlaneNormal:g}=s.getCamera(),p={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},v=this.getImageIdNormal(o[0]);if(this.isParallel(g,v))return a;const w=Nc(g,h),m=u.data.pointSets,y=u.data.viewportData;for(let x=0;x<o.length;x++){const{pointSet1:C,pointSet2:S}=m[x],T=y.get(s.id)||this.initializeViewportData(y,s.id);if(!T.pointSetsToUse[x]){let z=C,A=yn(Ae(),C[0],C[1]);A=kn(Ae(),A),this.isPerpendicular(A,g)&&(z=S),T.pointSetsToUse[x]=z,T.lineStartsWorld[x]=Ad(z[0],z[1],w),T.lineEndsWorld[x]=Ad(z[2],z[3],w)}const _=T.lineStartsWorld[x],E=T.lineEndsWorld[x];p.annotationUID=d;const D=this.getStyle("lineWidth",p,u),b=this.getStyle("lineDash",p,u),I=this.getStyle("color",p,u),R=this.getStyle("shadow",p,u),M=[_,E].map(z=>s.worldToCanvas(z)),P=`${d}-line`,k=`${x}`;an(i,d,k,M[0],M[1],{color:I,width:D,lineDash:b,shadow:R},P)}return a=!0,a},this.initializeViewportData=(n,i)=>(n.set(i,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),n.get(i)),this.isPerpendicular=(n,i)=>{const o=gt(n,i);return Math.abs(o)<vb}}isParallel(e,r){return Math.abs(gt(e,r))>1-vb}getImageIdNormal(e){const{imageOrientationPatient:r}=dt("imagePlaneModule",e),n=xt(r[0],r[1],r[2]),i=xt(r[3],r[4],r[5]);return xn(Ae(),n,i)}}cG.toolName="OverlayGrid";class lG extends _u{constructor(e={},r={configuration:{opacity:.5}}){super(e,r),this._init=()=>{var s;const n=Li(this.toolGroupId).viewportsInfo;if(!(n!=null&&n.length)){console.warn(this.getToolName()+"Tool: No viewports found");return}const i=(s=fr(n[0].renderingEngineId))==null?void 0:s.getViewport(n[0].viewportId);if(!i)return;const o=i.getFrameOfReferenceUID(),a=sn(this.getToolName(),o);if(!(a!=null&&a.length)){const c=new Map;Yxe(c,n);const l={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:o,referencedImageId:null},data:{actorsWorldPointsMap:c}};Zt(l,o)}Me(n.map(({viewportId:c})=>c))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this._init()},this.renderAnnotation=(n,i)=>{const{viewport:o,FrameOfReferenceUID:a}=n;let s=!1;const c=sn(this.getToolName(),a);if(!(c!=null&&c.length))return s;const l=c[0],{annotationUID:f}=l,u=l.data.actorsWorldPointsMap;uG(u,o);const d=o.getActors(),h=fG(o);return d.forEach(g=>{if(!(g!=null&&g.clippingFilter))return;const p=u.get(g.uid);if(!p||!p.get(h))return;let v=1;const{worldPointsSet:w,color:m}=p.get(h);for(let y=0;y<w.length;y++){const C=w[y].map(_=>o.worldToCanvas(_)),S={color:m,fillColor:m,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},T=g.uid+"#"+v;au(i,f,T,C,S),v++}}),s=!0,s}}}function Yxe(t,e){e.forEach(({viewportId:r,renderingEngineId:n})=>{var o;const i=(o=fr(n))==null?void 0:o.getViewport(r);uG(t,i)})}function uG(t,e){const r=e.getActors(),n=fG(e);r.forEach(i=>{if(!(i!=null&&i.clippingFilter))return;let o=t.get(i.uid);if(o||(o=new Map,t.set(i.uid,o)),!o.get(n)){const a=i.clippingFilter.getOutputData(),s=UB(a);if(!s)return;const c=i.actor.getProperty().getColor(),l=Jxe(c);o.set(n,{worldPointsSet:s,color:l})}})}function fG(t){const{viewPlaneNormal:e}=t.getCamera(),r=t.getCurrentImageIdIndex();return`${t.id}-${S4(e)}-${r}`}function Jxe(t){function e(r){let n=Math.floor(r*255).toString(16);return n.length===1&&(n="0"+n),n}return"#"+e(t[0])+e(t[1])+e(t[2])}lG.toolName="SegmentationIntersection";class dG extends _u{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,r),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=n=>{const{detail:i}=n,{element:o,currentPoints:a}=i;this._currentCursorWorldPosition=a.world,this._currentCanvasPosition=a.canvas,this._elementWithCursor=o;const s=this.getActiveAnnotation(o);return s===null?(this.createInitialAnnotation(a.world,o),!1):(this.updateAnnotationPosition(o,s),!1)},this.createInitialAnnotation=(n,i)=>{const o=we(i);if(!o)throw new Error("No enabled element found");const{viewport:a,renderingEngine:s}=o;this.isDrawing=!0;const c=a.getCamera(),{viewPlaneNormal:l,viewUp:f}=c;if(!l||!f)throw new Error("Camera not found");const u=this.getReferencedImageId(a,n,l,f),d=a.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...f],FrameOfReferenceUID:d,referencedImageId:u},data:{label:"",handles:{points:[[...n]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if(sn(this.getToolName(),i).length>0)return null;if(Zt(h,i)===null)return;const v=pt(i,this.getToolName(),!1);Me(v)},this.onCameraModified=n=>{const i=n.detail,{element:o,previousCamera:a,camera:s}=i,l=we(o).viewport;if(o!==this._elementWithCursor)return;const f=a.focalPoint,u=s.viewPlaneNormal,d=s.focalPoint,h=[0,0,0];if(kt.subtract(d,f,h),h.reduce((v,w)=>v+w,0)===0)return;const g=kt.dot(h,u);if(Math.abs(g)<.01||!this._currentCanvasPosition)return;const p=l.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=p,this.updateAnnotationPosition(o,this.getActiveAnnotation(o))},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a,FrameOfReferenceUID:s}=n,c=this._elementWithCursor===a.element;this.configuration.positionSync&&!c&&this.updateViewportImage(a);const{element:l}=a;let f=sn(this.getToolName(),l);if(!(f!=null&&f.length)||(f=this.filterInteractableAnnotationsForElement(l,f),!(f!=null&&f.length)))return o;const u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<f.length;d++){const h=f[d],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w}=v;if(!g)return o;u.annotationUID=g;const m=parseFloat(this.getStyle("lineWidth",u,h)),y=m,x=this.getStyle("lineDash",u,h),C=this.getStyle("color",u,h);if(w[0].some(I=>isNaN(I)))return o;const S=w.map(I=>a.worldToCanvas(I));if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!ti(g))continue;const T={upper:"upper",right:"right",lower:"lower",left:"left"},[_,E]=S[0],D=c?20:7,b=c?5:7;an(i,g,T.upper,[_,E-(D/2+b)],[_,E-D/2],{color:C,lineDash:x,lineWidth:y}),an(i,g,T.lower,[_,E+(D/2+b)],[_,E+D/2],{color:C,lineDash:x,lineWidth:y}),an(i,g,T.right,[_+(D/2+b),E],[_+D/2,E],{color:C,lineDash:x,lineWidth:y}),an(i,g,T.left,[_-(D/2+b),E],[_-D/2,E],{color:C,lineDash:x,lineWidth:y}),o=!0}return o},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=Li(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>zr(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&Tt(n.viewport.element)})}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=Li(this.toolGroupId).viewportsInfo;if(!e)return;e.map(n=>zr(n.viewportId,n.renderingEngineId)).forEach(n=>{n&&Ut(n.viewport.element)})}getActiveAnnotation(e){const r=sn(this.getToolName(),e);return r.length?r[0]:null}updateAnnotationPosition(e,r){var a,s;const n=this._currentCursorWorldPosition;if(!n||!((s=(a=r.data)==null?void 0:a.handles)!=null&&s.points))return;r.data.handles.points=[[...n]],r.invalidated=!0;const i=pt(e,this.getToolName(),!1);we(e)&&Me(i)}filterInteractableAnnotationsForElement(e,r){var d,h,g;if(!(r instanceof Array)||r.length===0)return[];const n=r[0],i=(d=we(e))==null?void 0:d.viewport;if(!i)return[];const o=i.getCamera(),{viewPlaneNormal:a,focalPoint:s}=o;if(!a||!s)return[];const c=(g=(h=n.data)==null?void 0:h.handles)==null?void 0:g.points;if(!(c instanceof Array)||c.length!==1)return[];const l=c[0],f=Nc(a,s);return Vv(f,l)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const r=this._currentCursorWorldPosition;if(!(!r||r.some(n=>isNaN(n)))){if(e instanceof Jn){const n=$A(r,e);if(n===null)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof Rn){const{focalPoint:n,viewPlaneNormal:i}=e.getCamera();if(!n||!i)return;const o=Nc(i,n),a=Vv(o,r,!0);if(Math.abs(a)<.5)return;const s=kn(Ae(),xt(...i)),c=mr(Ae(),s,a),l=br(Ae(),xt(...n),c);{e.setCamera({focalPoint:l});const f=e.getRenderingEngine();f&&f.renderViewport(e.id)}}}}}dG.toolName="ReferenceCursors";const yb=[];class hG extends _u{constructor(e={},r={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,r),this.editData=null,this._init=()=>{var g,p;const i=Qi()[0];if(!i)return;const o=Li(this.toolGroupId).viewportsInfo;if(!o)return;const a=o.map(v=>zr(v.viewportId,v.renderingEngineId));let{viewport:s}=a[0];const{FrameOfReferenceUID:c}=a[0];if(this.configuration.viewportId&&a.forEach(v=>{v.viewport.id==this.configuration.viewportId&&(s=v.viewport)}),!s)return;const{viewUp:l,viewPlaneNormal:f}=s.getCamera(),u=Gv(s);let d=(g=this.editData)==null?void 0:g.annotation;const h=sn(this.getToolName(),s.element);h.length&&(d=h.filter(v=>v.data.viewportId==s.id)[0]),a.forEach(v=>{const{viewport:w}=v;if(!yb.includes(w.id)){const m={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...f],viewUp:[...l],FrameOfReferenceUID:c,referencedImageId:null},data:{handles:{points:Gv(w)},viewportId:w.id}};yb.push(w.id),Zt(m,w.element),d=m}}),(p=this.editData)!=null&&p.annotation&&this.editData.annotation.data.viewportId==s.id&&(this.editData.annotation.data.handles.points=u,this.editData.annotation.data.viewportId=s.id),this.editData={viewport:s,renderingEngine:i,annotation:d}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=n=>{this.configuration.viewportId=n.detail.viewportId,this._init()},this.computeScaleSize=(n,i,o)=>{const a=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let s;return o=="top"||o=="bottom"?s=a.filter(c=>c<n*.6&&c>n*.2):s=a.filter(c=>c<i*.6&&c>i*.2),s[0]},this.computeEndScaleTicks=(n,i)=>{const o={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]},a=[[n[1][0]+o[i][0][0],n[1][1]+o[i][0][0]],[n[1][0]+o[i][1][0],n[1][1]+o[i][1][1]]],s=[[n[0][0]+o[i][0][0],n[0][1]+o[i][0][0]],[n[0][0]+o[i][1][0],n[0][1]+o[i][1][1]]];return{endTick1:a,endTick2:s}},this.computeInnerScaleTicks=(n,i,o,a,s)=>{let c;i=="bottom"||i=="top"?c=s[0][0]-a[0][0]:(i=="left"||i=="right")&&(c=s[0][1]-a[0][1]);const l=[],f=[],u=[];let d=n;n>=50&&(d=n/10);const h=c/d;for(let g=0;g<d-1;g++){const p={bottom:[[h*(g+1),0],[h*(g+1),5]],top:[[h*(g+1),0],[h*(g+1),-5]],left:[[0,h*(g+1)],[-5,h*(g+1)]],right:[[0,h*(g+1)],[5,h*(g+1)]]};l.push(`${o}-tick${g}`),f.push(`tick${g}`),(g+1)%5==0?u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][0][0],a[1][1]+p[i][0][1]]]):u.push([[a[0][0]+p[i][0][0],a[0][1]+p[i][0][1]],[a[1][0]+p[i][1][0],a[1][1]+p[i][1][1]]])}return{tickIds:l,tickUIDs:f,tickCoordinates:u}},this.computeWorldScaleCoordinates=(n,i,o)=>{let a,s=yn(Ae(),o[0],o[1]);s=kn(Ae(),s);let c=yn(Ae(),o[2],o[0]);c=kn(Ae(),c);const l={bottom:[o[1],o[2]],top:[o[0],o[3]],right:[o[2],o[3]],left:[o[0],o[1]]},f=br(Ae(),l[i][0],l[i][0]).map(d=>d/2),u=n/2/Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2));return i=="top"||i=="bottom"?a=[yn(Ae(),f,c.map(d=>d*u)),br(Ae(),f,c.map(d=>d*u))]:(i=="left"||i=="right")&&(a=[br(Ae(),f,s.map(d=>d*u)),yn(Ae(),f,s.map(d=>d*u))]),a},this.computeCanvasScaleCoordinates=(n,i,o,a,s)=>{let c;if(s=="top"||s=="bottom"){const l=i[0][0]-i[1][0];c=[[n.width/2-l/2,o.height],[n.width/2+l/2,o.height]]}else if(s=="left"||s=="right"){const l=i[0][1]-i[1][1];c=[[a.width,n.height/2-l/2],[a.width,n.height/2+l/2]]}return c},this.computeScaleBounds=(n,i,o,a)=>{const s=i*Math.min(1e3,n.width),c=o*Math.min(1e3,n.height),l={bottom:[-c,-s],top:[c,s],left:[c,s],right:[-c,-s]},f={bottom:[n.height,n.width],top:[0,n.width],left:[n.height,0],right:[n.height,n.width]};return{height:f[a][0]+l[a][0],width:f[a][1]+l[a][1]}}}renderAnnotation(e,r){if(!this.editData||!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:i}=e,a=sn(this.getToolName(),i.element).filter(me=>me.data.viewportId==i.id)[0],s=e.viewport.canvas,c=!1;if(!i)return c;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},f={width:s.width/window.devicePixelRatio||1,height:s.height/window.devicePixelRatio||1},u=a.data.handles.points[0],d=a.data.handles.points[1],h=a.data.handles.points[2],g=a.data.handles.points[3],p=[u,h,d,g],v=li(h,g),w=li(u,h),m=this.computeScaleBounds(f,.05,.05,n),y=this.computeScaleBounds(f,.05,.05,n),x=this.computeScaleSize(v,w,n),C=this.computeWorldScaleCoordinates(x,n,p).map(me=>i.worldToCanvas(me)),S=this.computeCanvasScaleCoordinates(f,C,y,m,n),T=this.computeEndScaleTicks(S,n),{annotationUID:_}=a;l.annotationUID=_;const E=this.getStyle("lineWidth",l,a),D=this.getStyle("lineDash",l,a),b=this.getStyle("color",l,a),I=this.getStyle("shadow",l,a),R=`${_}-scaleline`;an(r,_,"1",S[0],S[1],{color:b,width:E,lineDash:D,shadow:I},R);const P=`${_}-left`;an(r,_,"2",T.endTick1[0],T.endTick1[1],{color:b,width:E,lineDash:D,shadow:I},P);const z=`${_}-right`;an(r,_,"3",T.endTick2[0],T.endTick2[1],{color:b,width:E,lineDash:D,shadow:I},z);const L={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},N=[S[0][0]+L[n][0],S[0][1]+L[n][1]],H=this._getTextLines(x),{tickIds:ee,tickUIDs:oe,tickCoordinates:de}=this.computeInnerScaleTicks(x,n,_,T.endTick1,T.endTick2);for(let me=0;me<oe.length;me++)an(r,_,oe[me],de[me][0],de[me][1],{color:b,width:E,lineDash:D,shadow:I},ee[me]);return Qf(r,_,"text0",H,[N[0],N[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:b}),c}_getTextLines(e){let r,n;return e>=50?(r=e/10,n=" cm"):(r=e,n=" mm"),[r.toString().concat(n)]}}hG.toolName="ScaleOverlay";const gG=(t,e,r)=>{var a,s,c;if(!((c=(s=(a=e==null?void 0:e.data)==null?void 0:a.contour)==null?void 0:s.polyline)!=null&&c.length))return;const{polyline:n}=e.data.contour,{length:i}=n;let o=1/0;for(let l=0;l<i;l++){const f=t.worldToCanvas(n[l]),u=_a(f,r);o=Math.min(o,u)}if(!(o===1/0||isNaN(o)))return o},C8=class C8{constructor(){this.toolInfo={toolSize:null,maxToolSize:null}}renderShape(e,r,n){ho(e,"SculptorTool","0",r,this.toolInfo.toolSize,n)}pushHandles(e,r){const{points:n,mouseCanvasPoint:i}=r,o={first:void 0,last:void 0};for(let a=0;a<n.length;a++){const s=e.worldToCanvas(n[a]),c=_a(s,i);c>this.toolInfo.toolSize||(this.pushOneHandle(a,c,r),o.first===void 0&&(o.first=a),o.last=a)}return o}configureToolSize(e){const r=this.toolInfo;if(r.toolSize&&r.maxToolSize)return;const i=e.detail.element,a=Math.min(i.clientWidth,i.clientHeight)/12;r.toolSize=a,r.maxToolSize=a}updateToolSize(e,r,n){const i=this.toolInfo,o=gG(r,n,e);o>0&&(i.toolSize=Math.min(i.maxToolSize,o))}getMaxSpacing(e){return Math.max(this.toolInfo.toolSize/4,e)}getInsertPosition(e,r,n){let i;const{points:o,element:a,mouseCanvasPoint:s}=n,c=this.toolInfo.toolSize,l=we(a),{viewport:f}=l,u=f.worldToCanvas(o[e]),d=f.worldToCanvas(o[r]),h=[(u[0]+d[0])/2,(u[1]+d[1])/2],g=_a(s,h);if(g<c){const v={x:(h[0]-s[0])/g,y:(h[1]-s[1])/g};i=[s[0]+c*v.x,s[1]+c*v.y]}else i=h;return f.canvasToWorld(i)}pushOneHandle(e,r,n){const{points:i,mousePoint:o}=n,a=this.toolInfo.toolSize,s=i[e],c={x:(s[0]-o[0])/r,y:(s[1]-o[1])/r,z:(s[2]-o[2])/r},l={x:o[0]+a*c.x,y:o[1]+a*c.y,z:o[2]+a*c.z};s[0]=l.x,s[1]=l.y,s[2]=l.z}};C8.shapeName="Circle";let Vg=C8;class pG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,r),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0},this.preMouseDownCallback=n=>{const i=n.detail,o=i.element;if(this.configureToolSize(n),this.selectFreehandTool(i),this.commonData.activeAnnotationUID!==null)return this.isActive=!0,Tt(o),this.activateModify(o),!0},this.mouseMoveCallback=n=>{this.mode===wn.Active?(this.configureToolSize(n),this.updateCursor(n)):this.commonData.canvasLocation=void 0},this.endCallback=n=>{const i=n.detail,{element:o}=i,a=this.configuration,s=we(o);this.isActive=!1,this.deactivateModify(o),Ut(o);const{renderingEngineId:c,viewportId:l}=s,u=or(l,c).getToolInstance(a.referencedToolName),h=this.filterSculptableAnnotationsForElement(o).find(g=>g.annotationUID===this.commonData.activeAnnotationUID);u.configuration.calculateStats&&(h.invalidated=!0),qn(h,o)},this.dragCallback=n=>{const i=n.detail,o=i.element;this.updateCursor(n);const a=this.filterSculptableAnnotationsForElement(o),s=a.find(l=>l.annotationUID===this.commonData.activeAnnotationUID);if(!(a!=null&&a.length)||!this.isActive)return;const c=s.data.contour.polyline;this.sculpt(i,c)},this.registerShapes(Vg.shapeName,Vg),this.setToolShape(this.configuration.toolShape)}registerShapes(e,r){const n=new r;this.registeredShapes.set(e,n)}sculpt(e,r){const n=this.configuration,i=e.element,o=we(i),{viewport:a}=o,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:r,maxSpacing:s.getMaxSpacing(n.minSpacing),element:i};const c=s.pushHandles(a,this.sculptData);c.first!==void 0&&this.insertNewHandles(c)}interpolatePointsWithinMaxSpacing(e,r,n,i){const{element:o}=this.sculptData,a=we(o),{viewport:s}=a,c=wb(e+1,r.length),l=s.worldToCanvas(r[e]),f=s.worldToCanvas(r[c]);_a(l,f)>i&&n.push(e)}updateCursor(e){const r=e.detail,n=r.element,i=we(n),{renderingEngine:o,viewport:a}=i;this.commonData.viewportIdsToRender=[a.id];const s=this.filterSculptableAnnotationsForElement(n);if(!(s!=null&&s.length))return;const c=s.find(l=>l.annotationUID===this.commonData.activeAnnotationUID);if(this.commonData.canvasLocation=r.currentPoints.canvas,this.isActive)c.highlighted=!0;else{const l=this.registeredShapes.get(this.selectedShape),f=r.currentPoints.canvas;l.updateToolSize(f,a,c)}Me(this.commonData.viewportIdsToRender)}filterSculptableAnnotationsForElement(e){const r=this.configuration,n=we(e),{renderingEngineId:i,viewportId:o}=n,a=[],c=or(o,i).getToolInstance(r.referencedToolName);return r.referencedToolNames.forEach(l=>{const f=sn(l,e);f&&a.push(...f)}),c.filterInteractableAnnotationsForElement(e,a)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}insertNewHandles(e){const r=this.findNewHandleIndices(e);let n=0;for(let i=0;i<(r==null?void 0:r.length);i++){const o=r[i]+1+n;this.insertHandleRadially(o),n++}}findNewHandleIndices(e){const{points:r,maxSpacing:n}=this.sculptData,i=[];for(let o=e.first;o<=e.last;o++)this.interpolatePointsWithinMaxSpacing(o,r,i,n);return i}insertHandleRadially(e){const{points:r}=this.sculptData;if(e>r.length-1&&this.commonData.isEditingOpenContour)return;const n=this.registeredShapes.get(this.selectedShape),i=e-1,o=wb(e,r.length),s=n.getInsertPosition(i,o,this.sculptData);r.splice(e,0,s)}selectFreehandTool(e){const r=this.getClosestFreehandToolOnElement(e);r!==void 0&&(this.commonData.activeAnnotationUID=r)}getClosestFreehandToolOnElement(e){const{element:r}=e,n=we(r),{viewport:i}=n,o=this.configuration,a=this.filterSculptableAnnotationsForElement(r);if(!(a!=null&&a.length))return;const s=e.currentPoints.canvas,c={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let l=0;l<(a==null?void 0:a.length);l++){if(a[l].isLocked||!a[l].isVisible)continue;const f=gG(i,a[l],s);f!==-1&&f<c.distance&&(c.distance=f,c.toolIndex=l,c.annotationUID=a[l].annotationUID)}return this.commonData.isEditingOpenContour=!a[c.toolIndex].data.contour.closed,o.referencedToolName=a[c.toolIndex].metadata.toolName,c.annotationUID}activateModify(e){e.addEventListener(U.MOUSE_UP,this.endCallback),e.addEventListener(U.MOUSE_CLICK,this.endCallback),e.addEventListener(U.MOUSE_DRAG,this.dragCallback),e.addEventListener(U.TOUCH_TAP,this.endCallback),e.addEventListener(U.TOUCH_END,this.endCallback),e.addEventListener(U.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(U.MOUSE_UP,this.endCallback),e.removeEventListener(U.MOUSE_CLICK,this.endCallback),e.removeEventListener(U.MOUSE_DRAG,this.dragCallback),e.removeEventListener(U.TOUCH_TAP,this.endCallback),e.removeEventListener(U.TOUCH_END,this.endCallback),e.removeEventListener(U.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??Vg.shapeName}renderAnnotation(e,r){const{viewport:n}=e,{element:i}=n,o=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==wn.Active||!o.includes(n.id))return;const a=this.filterSculptableAnnotationsForElement(i);if(!(a!=null&&a.length))return;const s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let c=Ud("color",s,Dc.Default,this.mode);this.isActive&&(c=Ud("color",s,Dc.Highlighted,this.mode)),this.registeredShapes.get(this.selectedShape).renderShape(r,this.commonData.canvasLocation,{color:c})}}const wb=(t,e)=>(t+e)%e;pG.toolName="SculptorTool";const Zxe={X:[1,0,0],Y:[0,1,0],Z:[0,0,1],CUSTOM:[]};class mG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:Zxe.Z,rotateIncrementDegrees:30}}){super(e,r)}mouseWheelCallback(e){const{element:r,wheel:n}=e.detail,i=we(r),{viewport:o}=i,{direction:a,rotateIncrementDegrees:s}=this.configuration,c=o.getCamera(),{viewUp:l,position:f,focalPoint:u}=c,{direction:d}=n,[h,g,p]=u,[v,w,m]=a,y=d*(s*Math.PI)/180,x=[0,0,0],C=[0,0,0],S=[0,0,0],T=yt(new Float32Array(16));Wn(T,T,[h,g,p]),Ki(T,T,y,[v,w,m]),Wn(T,T,[-h,-g,-p]),Pt(x,f,T),Pt(C,u,T),yt(T),Ki(T,T,y,[v,w,m]),Pt(S,l,T),o.setCamera({position:x,viewUp:S,focalPoint:C}),o.render()}}mG.toolName="VolumeRotateMouseWheel";const{transformWorldToIndex:xb}=cn;var Vf;let vG=(Vf=class extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:Qxe,actions:{undo:{method:"undo",bindings:[{key:"z"}]},redo:{method:"redo",bindings:[{key:"y"}]}}}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c;Tt(a),this.isDrawing=!0;const{viewPlaneNormal:f,viewUp:u,position:d}=l.getCamera(),h=this.getReferencedImageId(l,s,f,u),g={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[s]}),toolName:this.getToolName(),referencedImageId:h,viewUp:u,cameraPosition:d},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};Zt(g,a);const p=pt(a,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(p),g},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ii([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Tt(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),this.doneEditMemo(),c&&Bn(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=d.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:x,shadow:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=v.map(L=>a.worldToCanvas(L));if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let T;if(!ti(g))continue;!jr(g)&&!this.editData&&w!==null&&(T=[S[w]]),T&&Kn(i,g,"0",S,{color:m,lineDash:x,lineWidth:y});const _=`${g}-line`;if(an(i,g,"1",S[0],S[1],{color:m,width:y,lineDash:x,shadow:C},_),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const D=this.getLinkedTextBoxStyle(u,h);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const b=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const L=Jo(S);p.handles.textBox.worldPosition=a.canvasToWorld(L)}const I=a.worldToCanvas(p.handles.textBox.worldPosition),M=to(i,g,"1",b,I,S,{},D),{x:P,y:k,width:z,height:A}=M;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([P,k]),topRight:a.canvasToWorld([P+z,k]),bottomLeft:a.canvasToWorld([P,k+A]),bottomRight:a.canvasToWorld([P+z,k+A])}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=pt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),Tt(o),Me(l),e.preventDefault()}_calculateLength(e,r){const n=e[0]-r[0],i=e[1]-r[1],o=e[2]-r[2];return Math.sqrt(n*n+i*i+o*o)}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,a=i.handles.points[0],s=i.handles.points[1],{cachedStats:c}=i,l=Object.keys(c);for(let f=0;f<l.length;f++){const u=l[f],d=this.getTargetImageData(u);if(!d)continue;const{imageData:h,dimensions:g}=d,p=xb(h,a),v=xb(h,s),w=[p,v],{scale:m,unit:y}=Ko(d,w),x=this._calculateLength(a,s)/m;this._isInsideVolume(p,v,g)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,c[u]={length:x,unit:y}}return e.invalidated=!1,qn(e,o),c}_isInsideVolume(e,r,n){return ur(e,n)&&ur(r,n)}},Vf.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new Vf,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])},Vf);function Qxe(t,e){const r=t.cachedStats[e],{length:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Kt(n)} ${i}`]}vG.toolName="Length";const{transformWorldToIndex:Cb}=cn;class yG extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:eCe}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;Tt(a),this.isDrawing=!0;const{viewPlaneNormal:u,viewUp:d,position:h}=l.getCamera(),g=this.getReferencedImageId(l,s,u,d),p={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[s]}),toolName:this.getToolName(),referencedImageId:g,viewUp:d,cameraPosition:h},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};Zt(p,a);const v=pt(a,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(v),p},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ii([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Tt(a),we(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l}=this.editData,{data:f}=a;if(l){const{deltaPoints:u}=i,d=u.world,{textBox:h}=f.handles,{worldPosition:g}=h;g[0]+=d[0],g[1]+=d[1],g[2]+=d[2],h.hasMoved=!0}else if(c===void 0){const{deltaPoints:u}=i,d=u.world;f.handles.points.forEach(g=>{g[0]+=d[0],g[1]+=d[1],g[2]+=d[2]}),a.invalidated=!0}else{const{currentPoints:u}=i,d=u.world;f.handles.points[c]=[...d],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,we(n),Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:v,activeHandleIndex:w}=p.handles;u.annotationUID=g;const{color:m,lineWidth:y,lineDash:x,shadow:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=v.map(A=>a.worldToCanvas(A));let T;if(!p.cachedStats[l]||p.cachedStats[l].unit==null?(p.cachedStats[l]={length:null,unit:null},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!ti(g))continue;if(!jr(g)&&!this.editData&&w!==null&&(T=[S[w]]),T&&Kn(i,g,"0",S,{color:m,lineDash:x,lineWidth:y}),YV(i,g,"0",S[0],S[1],{color:m,width:y,lineDash:x}),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;const E=this.getLinkedTextBoxStyle(u,h);if(!E.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const D=this.configuration.getTextLines(p,l);if(!p.handles.textBox.hasMoved){const A=Jo(S);p.handles.textBox.worldPosition=a.canvasToWorld(A)}const b=a.worldToCanvas(p.handles.textBox.worldPosition),R=to(i,g,"1",D,b,S,{},E),{x:M,y:P,width:k,height:z}=R;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([M,P]),topRight:a.canvasToWorld([M+k,P]),bottomLeft:a.canvasToWorld([M,P+z]),bottomRight:a.canvasToWorld([M+k,P+z])}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=pt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),Tt(o),we(o),Me(l),e.preventDefault()}_calculateHeight(e,r){const n=r[0]-e[0],i=r[1]-e[1],o=r[2]-e[2];if(n==0)return i!=0?Math.abs(o):0;if(i==0)return Math.abs(o);if(o==0)return Math.abs(i)}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport,a=i.handles.points[0],s=i.handles.points[1],{cachedStats:c}=i,l=Object.keys(c);for(let f=0;f<l.length;f++){const u=l[f],d=this.getTargetImageData(u);if(!d)continue;const{imageData:h,dimensions:g}=d,p=Cb(h,a),v=Cb(h,s),w=[p,v],{scale:m,unit:y}=Ko(d,w),x=this._calculateHeight(a,s)/m,C=this._isInsideVolume(p,v,g);this.isHandleOutsideImage=C,c[u]={height:x,unit:y}}return e.invalidated=!1,qn(e,o),c}_isInsideVolume(e,r,n){return ur(e,n)&&ur(r,n)}}function eCe(t,e){const r=t.cachedStats[e],{height:n,unit:i}=r;return n==null||isNaN(n)?void 0:[`${Kt(n)} ${i}`]}yG.toolName="Height";const{transformWorldToIndex:tCe}=cn,Z0=class Z0 extends zn{constructor(e={},r){super(e,zn.mergeDefaultProps(Z0.probeDefaults,r)),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c;this.isDrawing=!0;const f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=this.getReferencedImageId(l,s,u),g=l.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:g,referencedImageId:h},data:{label:"",handles:{points:[[...s]]},cachedStats:{}}};Zt(p,a);const v=pt(a,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:v},this._activateModify(a),Tt(a),n.preventDefault(),Me(v),p},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c}=this.editData,{viewportId:l,renderingEngine:f}=we(o);this.eventDispatchDetail={viewportId:l,renderingEngineId:f.id},this._deactivateModify(o),Ut(o),c&&this.createMemo(o,a,{newAnnotation:c}),this.editData=null,this.isDrawing=!1,this.doneEditMemo(),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,{annotation:c,viewportIdsToRender:l,newAnnotation:f}=this.editData,{data:u}=c;this.createMemo(a,c,{newAnnotation:f}),u.handles.points[0]=[...s],c.invalidated=!0,Me(l)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],g=h.annotationUID,p=h.data,v=p.handles.points[0],w=a.worldToCanvas(v);u.annotationUID=g;const{color:m,lineWidth:y}=this.getAnnotationStyle({annotation:h,styleSpecifier:u});if(p.cachedStats||(p.cachedStats={}),!p.cachedStats[l]||p.cachedStats[l].value===null)p.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(h,f,n,tr.StatsUpdated);else if(h.invalidated&&(this._calculateCachedStats(h,f,n),a instanceof Rn)){const{referencedImageId:T}=h.metadata;for(const _ in p.cachedStats)_.startsWith("imageId")&&f.getStackViewports().find(b=>{const I=wr(T),R=b.hasImageURI(I),M=wr(b.getCurrentImageId());return R&&M!==I})&&delete p.cachedStats[_]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;Kn(i,g,"0",[w],{color:m,lineWidth:y}),o=!0;const C=this.getLinkedTextBoxStyle(u,h);if(!C.visibility)continue;const S=this.configuration.getTextLines(p,l);if(S){const T=[w[0]+6,w[1]-6];Qf(i,g,"0",S,[T[0],T[1]],C)}}return o}}isPointNearTool(e,r,n,i){const o=we(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);return ir(n,l)<i}toolSelectedCallback(){}getHandleNearImagePoint(e,r,n,i){const o=we(e),{viewport:a}=o,{data:s}=r,c=s.handles.points[0],l=a.worldToCanvas(c);if(ir(n,l)<i===!0)return c}handleSelectedCallback(e,r){const n=e.detail,{element:i}=n;r.highlighted=!0;const o=pt(i,this.getToolName());this.editData={annotation:r,viewportIdsToRender:o},this._activateModify(i),Tt(i),Me(o),e.preventDefault()}_calculateCachedStats(e,r,n,i=tr.StatsUpdated){const o=e.data,{renderingEngineId:a,viewport:s}=n,{element:c}=s,l=o.handles.points[0],{cachedStats:f}=o,u=Object.keys(f);for(let d=0;d<u.length;d++){const h=u[d],g={isPreScaled:ec(s,h),isSuvScaled:this.isSuvScaled(s,h,e.metadata.referencedImageId)},p=this.getTargetImageData(h);if(!p)continue;const{dimensions:v,imageData:w,metadata:m,voxelManager:y}=p,x=m.Modality;let C=tCe(w,l);if(C=_M(C,C),ur(C,v)){this.isHandleOutsideImage=!1;let S=y.getAtIJKPoint(C);if(h.startsWith("imageId:")){const _=h.split("imageId:")[1],E=wr(_),b=Bv(E)[0];C[2]=b.getCurrentImageIdIndex()}let T;if(x==="US"){const _=ny(p,[C]),E=_.values.every(D=>D!==null);S=E?_.values:S,T=E?_.units:"raw"}else T=Eu(x,e.metadata.referencedImageId,g);f[h]={index:C,value:S,Modality:x,modalityUnit:T}}else this.isHandleOutsideImage=!0,f[h]={index:C,Modality:x};e.invalidated=!1,qn(e,c,i)}return f}};Z0.probeDefaults={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:nCe}},Z0.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new Z0,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])};let Up=Z0;function nCe(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0||!n)return;const a=[];if(a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),i instanceof Array&&o instanceof Array)for(let s=0;s<i.length;s++)a.push(`${Kt(i[s])} ${o[s]}`);else a.push(`${Kt(i)} ${o}`);return a}Up.toolName="Probe";class wG extends Up{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:rCe}}){super(e,r),this.postMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:g},data:{label:"",handles:{points:[[...s]]},cachedStats:{}}},v=pt(a,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:v},this._activateModify(a),Tt(a),n.preventDefault(),Me(v),p},this.postTouchStartCallback=n=>this.postMouseDownCallback(n),this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;if(!this.editData)return o;const s=this.filterInteractableAnnotationsForElement(a.element,[this.editData.annotation]);if(!(s!=null&&s.length))return o;const c=this.getTargetId(a),l=a.getRenderingEngine(),f={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},u=this.editData.annotation,d=u.annotationUID,h=u.data,g=h.handles.points[0],p=a.worldToCanvas(g);f.annotationUID=d;const{color:v}=this.getAnnotationStyle({annotation:u,styleSpecifier:f});if(!h.cachedStats[c]||h.cachedStats[c].value===null?(h.cachedStats[c]={Modality:null,index:null,value:null},this._calculateCachedStats(u,l,n)):u.invalidated&&this._calculateCachedStats(u,l,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;Kn(i,d,"0",[p],{color:v}),o=!0;const m=this.configuration.getTextLines(h,c);if(m){const y=[p[0]+6,p[1]-6];Qf(i,d,"0",m,[y[0],y[1]],this.getLinkedTextBoxStyle(f,u))}return o}}}function rCe(t,e){const r=t.cachedStats[e],{index:n,value:i,modalityUnit:o}=r;if(i===void 0)return;const a=[];return a.push(`(${n[0]}, ${n[1]}, ${n[2]})`),a.push(`${i.toFixed(2)} ${o}`),a}wG.toolName="DragProbe";function X5(t,e,r,n){const i=Ae();xn(i,e,t);const o=xt(...r),a=xt(...n),s=Ae();yn(s,o,a);const c=fo(s);if(c<1e-4)return{worldWidth:0,worldHeight:0};const l=gt(s,i)/(c*fo(i)),u=Math.sqrt(1-l*l)*c,d=l*c;return{worldWidth:u,worldHeight:d}}const{transformWorldToIndex:Sb}=cn,xy=class xy extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:iCe,statsCalculator:wa}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world;o.canvas;const c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},cachedStats:{},initialRotation:l.getRotation()}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,centerWorld:s,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=f.map(y=>c.worldToCanvas(y)),d=Pg(u),[h,g]=d,p={left:Math.min(h[0],g[0])+a/2,top:Math.min(h[1],g[1])+a/2,width:Math.abs(h[0]-g[0])-a,height:Math.abs(h[1]-g[1])-a},v={left:Math.min(h[0],g[0])-a/2,top:Math.min(h[1],g[1])-a/2,width:Math.abs(h[0]-g[0])+a,height:Math.abs(h[1]-g[1])+a},w=this._pointInEllipseCanvas(p,o);return!!(this._pointInEllipseCanvas(v,o)&&!w)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},Tt(a),this._activateModify(a),we(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f,u,d,h,g,p;if(o.worldPosition)l=!0;else{const{points:w}=c.handles,{viewport:m}=we(s),{worldToCanvas:y,canvasToWorld:x}=m;f=w.findIndex(S=>S===o);const C=w.map(y);p=C[f],h=Math.abs(C[2][0]-C[3][0]),g=Math.abs(C[0][1]-C[1][1]),u=[(C[2][0]+C[3][0])/2,(C[0][1]+C[1][1])/2],d=x(u)}const v=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:v,handleIndex:f,canvasWidth:h,canvasHeight:g,centerWorld:d,originalHandleCanvas:p,movingTextBox:l},this._activateModify(s),Tt(s),Me(v),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=we(o),{viewport:l}=c,{canvasToWorld:f}=l,{annotation:u,viewportIdsToRender:d,centerWorld:h,newAnnotation:g}=this.editData;this.createMemo(o,u,{newAnnotation:g});const p=l.worldToCanvas(h),{data:v}=u,w=Math.abs(s[0]-p[0]),m=Math.abs(s[1]-p[1]),y=[p[0],p[1]-m],x=[p[0],p[1]+m],C=[p[0]-w,p[1]],S=[p[0]+w,p[1]];v.handles.points=[f(y),f(x),f(C),f(S)],u.invalidated=!0,this.editData.hasMoved=!0,Me(d)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;we(o),Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,{viewport:a}=we(o),{canvasToWorld:s,worldToCanvas:c}=a,{annotation:l,canvasWidth:f,canvasHeight:u,handleIndex:d,centerWorld:h,originalHandleCanvas:g}=this.editData,p=a.worldToCanvas(h),{data:v}=l,{points:w}=v.handles,{currentPoints:m}=i,y=m.canvas;if(d===0||d===1){const x=Math.abs(y[1]-p[1]),C=[p[0],p[1]-x],S=[p[0],p[1]+x];w[0]=s(C),w[1]=s(S);const T=y[0]-g[0],_=f/2+T,E=[p[0]-_,p[1]],D=[p[0]+_,p[1]];w[2]=s(E),w[3]=s(D)}else{const x=Math.abs(y[0]-p[0]),C=[p[0]-x,p[1]],S=[p[0]+x,p[1]];w[2]=s(C),w[3]=s(S);const T=y[1]-g[1],_=u/2+T,E=[p[0],p[1]-_],D=[p[0],p[1]+_];w[0]=s(E),w[1]=s(D)}},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w,activeHandleIndex:m}=v;u.annotationUID=g;const{color:y,lineWidth:x,lineDash:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=w.map(ee=>a.worldToCanvas(ee)),T=Pg(S),{centerPointRadius:_}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(h,a,f);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,f,n),a instanceof Rn)){const{referencedImageId:ee}=h.metadata;for(const oe in p.cachedStats)oe.startsWith("imageId")&&f.getStackViewports().find(me=>{const Ee=wr(ee),_e=me.hasImageURI(Ee),Ce=wr(me.getCurrentImageId());return _e&&Ce!==Ee})&&delete p.cachedStats[oe]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let E;if(!ti(g))continue;!jr(g)&&!this.editData&&m!==null&&(E=[S[m]]),E&&Kn(i,g,"0",E,{color:y});const D=`${g}-ellipse`,b="0";if(A4(i,g,b,S,{color:y,lineDash:C,lineWidth:x},D),_>0&&Math.min(Math.abs(T[0][0]-T[1][0])/2,Math.abs(T[0][1]-T[1][1])/2)>3*_){const oe=this._getCanvasEllipseCenter(S);ho(i,g,`${b}-center`,oe,_,{color:y,lineDash:C,lineWidth:x})}o=!0;const I=this.getLinkedTextBoxStyle(u,h);if(!I.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const R=this.configuration.getTextLines(p,l);if(!R||R.length===0)continue;let M;p.handles.textBox.hasMoved||(M=Jo(T),p.handles.textBox.worldPosition=a.canvasToWorld(M));const P=a.worldToCanvas(p.handles.textBox.worldPosition),z=to(i,g,"1",R,P,S,{},I),{x:A,y:L,width:N,height:H}=z;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([A,L]),topRight:a.canvasToWorld([A+N,L]),bottomLeft:a.canvasToWorld([A,L+H]),bottomRight:a.canvasToWorld([A+N,L+H])}}return o},this._calculateCachedStats=(n,i,o)=>{var x,C,S;const a=n.data,{element:s}=i,{points:c}=a.handles,l=c.map(T=>i.worldToCanvas(T)),{viewPlaneNormal:f,viewUp:u}=i.getCamera(),[d,h]=Pg(l),g=i.canvasToWorld(d),p=i.canvasToWorld(h),{cachedStats:v}=a,w=Object.keys(v),m=g,y=p;for(let T=0;T<w.length;T++){const _=w[T],E=this.getTargetImageData(_);if(!E)continue;const{dimensions:D,imageData:b,metadata:I,voxelManager:R}=E,M=Sb(b,m);M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.floor(M[2]);const P=Sb(b,y);P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),P[2]=Math.floor(P[2]),this.isHandleOutsideImage=!this._isInsideVolume(M,P,D);const k=Math.min(M[0],P[0]),z=Math.max(M[0],P[0]),A=Math.min(M[1],P[1]),L=Math.max(M[1],P[1]),N=Math.min(M[2],P[2]),H=Math.max(M[2],P[2]),ee=[[k,z],[A,L],[N,H]],de={center:[(g[0]+p[0])/2,(g[1]+p[1])/2,(g[2]+p[2])/2],xRadius:Math.abs(g[0]-p[0])/2,yRadius:Math.abs(g[1]-p[1])/2,zRadius:Math.abs(g[2]-p[2])/2},{worldWidth:ue,worldHeight:me}=X5(f,u,m,y),Ee=ue===0&&me===0,_e=[M,P],{scale:Ce,areaUnit:F}=Ko(E,_e),O=Math.abs(Math.PI*(ue/2)*(me/2))/Ce/Ce,$={isPreScaled:ec(i,_),isSuvScaled:this.isSuvScaled(i,_,n.metadata.referencedImageId)},W=Eu(I.Modality,n.metadata.referencedImageId,$),X=R.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:ee,imageData:b,isInObject:ne=>N5(de,ne,{fast:!0}),returnPoints:this.configuration.storePointData}),Z=this.configuration.statsCalculator.getStatistics();v[_]={Modality:I.Modality,area:O,mean:(x=Z.mean)==null?void 0:x.value,max:(C=Z.max)==null?void 0:C.value,stdDev:(S=Z.stdDev)==null?void 0:S.value,statsArray:Z.array,pointsInShape:X,isEmptyArea:Ee,areaUnit:F,modalityUnit:W}}return n.invalidated=!1,qn(n,s),v},this._isInsideVolume=(n,i,o)=>ur(n,o)&&ur(i,o),this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,r){const n=e.width/2,i=e.height/2;if(n<=0||i<=0)return!1;const o=[e.left+n,e.top+i],a=[r[0]-o[0],r[1]-o[1]];return a[0]*a[0]/(n*n)+a[1]*a[1]/(i*i)<=1}_getCanvasEllipseCenter(e){const[r,n,i,o]=e,a=[i[0],n[1]],s=[o[0],r[1]];return[(a[0]+s[0])/2,(a[1]+s[1])/2]}};xy.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new xy,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r,activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])};let dy=xy;function iCe(t,e){const r=t.cachedStats[e],{area:n,mean:i,stdDev:o,max:a,isEmptyArea:s,areaUnit:c,modalityUnit:l}=r,f=[];if(n){const u=s?"Area: Oblique not supported":`Area: ${Kt(n)} ${c}`;f.push(u)}return i&&f.push(`Mean: ${Kt(i)} ${l}`),a&&f.push(`Max: ${Kt(a)} ${l}`),o&&f.push(`Std Dev: ${Kt(o)} ${l}`),f}dy.toolName="EllipticalROI";const{transformWorldToIndex:Tb}=cn,Cy=class Cy extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:oCe,statsCalculator:wa}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s]],activeHandleIndex:null},cachedStats:{}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=f.map(g=>c.worldToCanvas(g)),d=ou(u),h=ou([u[0],o]);return Math.abs(h-d)<a/2},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},Tt(a),this._activateModify(a),we(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:d}=c.handles;f=d.findIndex(h=>h===o)}const u=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),Tt(s),we(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(this.doneEditMemo(),a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=we(o),{viewport:l}=c,{canvasToWorld:f}=l,{annotation:u,viewportIdsToRender:d,newAnnotation:h}=this.editData;this.createMemo(o,u,{newAnnotation:h});const{data:g}=u;g.handles.points=[g.handles.points[0],f(s)],u.invalidated=!0,this.editData.hasMoved=!0,Me(d)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else this._dragHandle(n),a.invalidated=!0;we(o),Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=we(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l,handleIndex:f}=this.editData,{data:u}=l,{points:d}=u.handles,h=d.map(v=>c(v)),{currentPoints:g}=i,p=g.canvas;if(f===0){const v=p[0]-h[0][0],w=p[1]-h[0][1],m=p,y=[h[1][0]+v,h[1][1]+w];d[0]=s(m),d[1]=s(y)}else d[1]=s(p)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{handles:v}=p,{points:w,activeHandleIndex:m}=v;u.annotationUID=g;const{color:y,lineWidth:x,lineDash:C}=this.getAnnotationStyle({annotation:h,styleSpecifier:u}),S=w.map(de=>a.worldToCanvas(de)),T=S[0],_=ou(S),E=yd(S),{centerPointRadius:D}=this.configuration;if(!p.cachedStats[l]||p.cachedStats[l].areaUnit==null)p.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(h,a,f,n);else if(h.invalidated&&(this._throttledCalculateCachedStats(h,a,f,n),a instanceof Rn)){const{referencedImageId:de}=h.metadata;for(const ue in p.cachedStats)ue.startsWith("imageId")&&f.getStackViewports().find(_e=>{const Ce=wr(de),F=_e.hasImageURI(Ce),O=wr(_e.getCurrentImageId());return F&&O!==Ce})&&delete p.cachedStats[ue]}if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let b;if(!ti(g))continue;!jr(g)&&!this.editData&&m!==null&&(b=[S[m]]),b&&Kn(i,g,"0",b,{color:y});const I=`${g}-circle`,R="0";ho(i,g,R,T,_,{color:y,lineDash:C,lineWidth:x},I),D>0&&_>3*D&&ho(i,g,`${R}-center`,T,D,{color:y,lineDash:C,lineWidth:x}),o=!0;const M=this.getLinkedTextBoxStyle(u,h);if(!M.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const P=this.configuration.getTextLines(p,l);if(!P||P.length===0)continue;let k;p.handles.textBox.hasMoved||(k=Jo(E),p.handles.textBox.worldPosition=a.canvasToWorld(k));const z=a.worldToCanvas(p.handles.textBox.worldPosition),L=to(i,g,"1",P,z,S,{},M),{x:N,y:H,width:ee,height:oe}=L;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([N,H]),topRight:a.canvasToWorld([N+ee,H]),bottomLeft:a.canvasToWorld([N,H+oe]),bottomRight:a.canvasToWorld([N+ee,H+oe])}}return o},this._calculateCachedStats=(n,i,o,a)=>{var C,S,T;const s=n.data,{element:c}=i,{points:l}=s.handles,f=l.map(_=>i.worldToCanvas(_)),{viewPlaneNormal:u,viewUp:d}=i.getCamera(),[h,g]=yd(f),p=i.canvasToWorld(h),v=i.canvasToWorld(g),{cachedStats:w}=s,m=Object.keys(w),y=p,x=v;for(let _=0;_<m.length;_++){const E=m[_],D=this.getTargetImageData(E);if(!D)continue;const{dimensions:b,imageData:I,metadata:R,voxelManager:M}=D,P=Tb(I,y);P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),P[2]=Math.floor(P[2]);const k=Tb(I,x);if(k[0]=Math.floor(k[0]),k[1]=Math.floor(k[1]),k[2]=Math.floor(k[2]),this._isInsideVolume(P,k,b)){const z=Math.min(P[0],k[0]),A=Math.max(P[0],k[0]),L=Math.min(P[1],k[1]),N=Math.max(P[1],k[1]),H=Math.min(P[2],k[2]),ee=Math.max(P[2],k[2]),oe=[[z,A],[L,N],[H,ee]],ue={center:[(p[0]+v[0])/2,(p[1]+v[1])/2,(p[2]+v[2])/2],xRadius:Math.abs(p[0]-v[0])/2,yRadius:Math.abs(p[1]-v[1])/2,zRadius:Math.abs(p[2]-v[2])/2},{worldWidth:me,worldHeight:Ee}=X5(u,d,y,x),_e=me===0&&Ee===0,Ce=[P,k],{scale:F,unit:O,areaUnit:$}=Ko(D,Ce),W=T4(D),X=Math.abs(Math.PI*(me/F/2)*(Ee/W/F/2)),Z={isPreScaled:ec(i,E),isSuvScaled:this.isSuvScaled(i,E,n.metadata.referencedImageId)},ne=Eu(R.Modality,n.metadata.referencedImageId,Z),xe=M.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:Le=>N5(ue,Le,{fast:!0}),boundsIJK:oe,imageData:I,returnPoints:this.configuration.storePointData}),Ie=this.configuration.statsCalculator.getStatistics();w[E]={Modality:R.Modality,area:X,mean:(C=Ie.mean)==null?void 0:C.value,max:(S=Ie.max)==null?void 0:S.value,pointsInShape:xe,stdDev:(T=Ie.stdDev)==null?void 0:T.value,statsArray:Ie.array,isEmptyArea:_e,areaUnit:$,radius:me/2/F,radiusUnit:O,perimeter:2*Math.PI*(me/2)/F,modalityUnit:ne}}else this.isHandleOutsideImage=!0,w[E]={Modality:R.Modality}}return n.invalidated=!1,qn(n,c),w},this._isInsideVolume=(n,i,o)=>ur(n,o)&&ur(i,o),this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}};Cy.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new Cy,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])};let Bp=Cy;function oCe(t,e){const r=t.cachedStats[e],{radius:n,radiusUnit:i,area:o,mean:a,stdDev:s,max:c,isEmptyArea:l,areaUnit:f,modalityUnit:u}=r,d=[];if(n){const h=l?"Radius: Oblique not supported":`Radius: ${Kt(n)} ${i}`;d.push(h)}if(o){const h=l?"Area: Oblique not supported":`Area: ${Kt(o)} ${f}`;d.push(h)}return a&&d.push(`Mean: ${Kt(a)} ${u}`),c&&d.push(`Max: ${Kt(c)} ${u}`),s&&d.push(`Std Dev: ${Kt(s)} ${u}`),d}Bp.toolName="CircleROI";const Gm=5;class xG extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,degrees:[45,135,225,315],diameters:[10,30,60]}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{label:"",handles:{points:[[...s]]}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,newAnnotation:!0},this._activateDraw(a),Tt(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{points:f}=l.handles,u=c.worldToCanvas(f[0]),d=ou([u,o]);return Math.abs(d)<a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},Tt(a),this._activateModify(a),we(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s},this._activateModify(a),Tt(a),we(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a))},this._dragDrawCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=we(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h}=this.editData,{data:g}=d;g.handles.points=[u(s),u(s)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._dragModifyCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s}=this.editData,{data:c}=a,{deltaPoints:l}=i,f=l.world;c.handles.points.forEach(d=>{d[0]+=f[0],d[1]+=f[1],d[2]+=f[2]}),a.invalidated=!0,we(o),Me(s)},this._dragHandle=n=>{const i=n.detail,{element:o}=i,a=we(o),{canvasToWorld:s,worldToCanvas:c}=a.viewport,{annotation:l}=this.editData,{data:f}=l,{points:u}=f.handles,d=u.map(y=>c(y)),{currentPoints:h}=i,g=h.canvas,p=g[0]-d[0][0],v=g[1]-d[0][1],w=g,m=[d[1][0]+p,d[1][1]+v];u[0]=s(w),u[1]=s(m)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,we(n),Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragModifyCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragModifyCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.addEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragDrawCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragDrawCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragDrawCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{handles:g}=h,{points:p}=g;l.annotationUID=d;const{color:v,lineWidth:w,lineDash:m}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),x=p.map(b=>a.worldToCanvas(b))[0];if(!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!ti(d))continue;let C=`${d}-crosshair-vertical`,S=[x[0],x[1]+Gm],T=[x[0],x[1]-Gm];an(i,d,C,S,T,{color:v,lineDash:m,lineWidth:w}),C=`${d}-crosshair-horizontal`,S=[x[0]+Gm,x[1]],T=[x[0]-Gm,x[1]],an(i,d,C,S,T,{color:v,lineDash:m,lineWidth:w});const _=this.configuration.diameters.map(b=>this.worldMeasureToCanvas(b,a));for(let b=0;b<_.length;b++){const I=`${d}-circle-${b}`,R=`${d}-circle-${b}`;ho(i,d,R,x,_[b]/2,{color:v,lineDash:m,lineWidth:w},I)}const E=b=>b*Math.PI/180,D=this.configuration.degrees.map(b=>E(b));for(let b=0;b<D.length;b++){const I=`${d}-line-${b}`,R=[Math.cos(D[b])*_[0]/2+x[0],Math.sin(D[b])*_[0]/2+x[1]],M=[Math.cos(D[b])*_[2]/2+x[0],Math.sin(D[b])*_[2]/2+x[1]];an(i,d,I,R,M,{color:v,lineDash:m,lineWidth:w})}o=!0}return o}}worldMeasureToCanvas(e,r){const n=r.canvasToWorld([r.canvas.width/2,r.canvas.height/2]),{viewUp:i}=r.getCamera(),o=Xt(Ae(),n,i,e),a=r.worldToCanvas(n),s=r.worldToCanvas(o);return Math.sqrt(Math.pow(s[0]-a[0],2)+Math.pow(s[1]-a[1],2))}}xG.toolName="ETDRSGrid";const _b=3,Eb=10,aCe={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var Cc;(function(t){t.Cardinal="CARDINAL",t.Linear="LINEAR",t.CatmullRom="CATMULLROM",t.BSpline="BSPLINE"})(Cc||(Cc={}));var Fg;(function(t){t.AddControlPoint="addControlPoint",t.DeleteControlPoint="deleteControlPoint"})(Fg||(Fg={}));const Q0=class Q0 extends Rp{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:sCe,contourHoleAdditionModifierKey:ii.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[Cc.Cardinal]:{Class:Vp,scale:.5},[Cc.CatmullRom]:{Class:qB},[Cc.Linear]:{Class:XB},[Cc.BSpline]:{Class:KB,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:Cc.CatmullRom,drawPreviewEnabled:!0,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[Fg.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:Xs.Primary,modifierKey:ii.Shift}]},[Fg.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:Xs.Primary,modifierKey:ii.Ctrl}]}}}}){super(e,r),this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(n,i,o,a)=>{const{instance:s}=i.data.spline;return s.isPointNearCurve(o,a)},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:d}=c.handles;f=d.findIndex(h=>h===o)}const u=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),Me(u),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,contourHoleProcessingEnabled:l}=this.editData,{data:f}=a;a.autoGenerated=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o);const u=we(o),d=this.getTargetImageData(this.getTargetId(u.viewport)),{imageData:h,dimensions:g}=d;this.isHandleOutsideImage=f.handles.points.map(v=>yr(h,v)).some(v=>!ur(v,g)),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID);const p=c?tr.Completed:tr.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=a.annotationUID,this.fireChangeOnUpdate.changeType=p):this.fireChangeOnUpdate={annotationUID:a.annotationUID,changeType:p,contourHoleProcessingEnabled:l},Me(s),this.doneEditMemo(),this.editData=null,this.isDrawing=!1},this._keyDownCallback=n=>{const i=n.detail,{element:o}=i,a=i.key??"",{lastControlPointDeletionKeys:s}=this.configuration.spline;if(!s.includes(a))return;const{annotation:l}=this.editData,{data:f}=l;if(f.handles.points.length===_b){this.cancel(o);return}else{const u=f.handles.points.length-1;this._deleteControlPointByIndex(o,l,u)}n.preventDefault()},this._mouseMoveCallback=n=>{const{drawPreviewEnabled:i}=this.configuration.spline;if(!i)return;const{element:o}=n.detail;we(o);const a=pt(o,this.getToolName());this.editData.lastCanvasPoint=n.detail.currentPoints.canvas,Me(a),n.preventDefault()},this._mouseDownCallback=n=>{const i=n.type===U.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a}=this.editData,{data:s}=o;if(s.contour.closed)return;this.doneEditMemo();const c=n.detail,{currentPoints:l,element:f}=c,{canvas:u,world:d}=l;let h=s.handles.points.length>=2&&i,g=!0;if(s.handles.points.length&&this.createMemo(f,o,{newAnnotation:s.handles.points.length===1}),s.handles.points.length>=3){this.createMemo(f,o);const{instance:p}=s.spline,v=p.getClosestControlPointWithinDistance(u,Eb);(v==null?void 0:v.index)===0&&(g=!1,h=!0)}g&&s.handles.points.push(d),s.contour.closed=s.contour.closed||h,o.invalidated=!0,Me(a),s.contour.closed&&this._endCallback(n),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData,{data:u}=a;if(this.createMemo(o,a,{newAnnotation:f}),l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;this.moveAnnotation(a,h)}else{const{currentPoints:d}=i,h=d.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.triggerAnnotationCompleted=(n,i)=>{const o=U.ANNOTATION_COMPLETED,a={annotation:n,changeType:tr.Completed,contourHoleProcessingEnabled:i};Qe(We,o,a)},this.triggerAnnotationModified=(n,i,o=tr.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=U.ANNOTATION_MODIFIED;Qe(We,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this.triggerChangeEvent=(n,i,o=tr.StatsUpdated,a)=>{o===tr.Completed?this.triggerAnnotationCompleted(n,a):this.triggerAnnotationModified(n,i,o)},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.KEY_DOWN,this._keyDownCallback),n.addEventListener(U.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(U.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(U.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(U.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.KEY_DOWN,this._keyDownCallback),n.removeEventListener(U.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(U.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(U.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(U.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.spline.instance.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const f=s.handles.points.map(m=>i.worldToCanvas(m));if(!s.handles.textBox.hasMoved){const m=Jo(f);s.handles.textBox.worldPosition=i.canvasToWorld(m)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=to(o,n.annotationUID??"","textBox",l,u,f,{},a),{x:g,y:p,width:v,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+v,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+v,p+w])}},this.addControlPointCallback=(n,i)=>{const{data:o}=i,a=o.spline.type,s=this._getSplineConfig(a),c=s.controlPointAdditionDistance;if(s.controlPointAdditionEnabled===!1)return;const l=n.detail,{element:f}=l,u=we(f),{renderingEngine:d,viewport:h}=u,{canvasToWorld:g}=h,{instance:p}=o.spline,v=n.detail.currentPoints.canvas,w=p.getClosestPoint(v);if(w.distance>c)return;const{index:m,point:y}=p.addControlPointAtU(w.uValue);o.handles.points.splice(m,0,g(y)),i.invalidated=!0;const x=pt(f,this.getToolName());Me(x)},this.deleteControlPointCallback=(n,i)=>{const o=i.data.spline.type,a=this._getSplineConfig(o),s=a.controlPointDeletionDistance;if(a.controlPointDeletionEnabled===!1)return;const c=n.detail,{element:l,currentPoints:f}=c,{canvas:u}=f,{instance:d}=i.data.spline,h=d.getClosestControlPointWithinDistance(u,s);h&&this._deleteControlPointByIndex(l,i,h.index)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=we(i);if(!a)return;const{viewport:s}=a,{cachedStats:c}=o,{polyline:l}=o.contour,f=Object.keys(c);for(let u=0;u<f.length;u++){const d=f[u],h=this.getTargetImageData(d);if(!h)continue;const{metadata:g}=h,p=l.map(D=>s.worldToCanvas(D)),v=p[0],w=s.canvasToWorld(v),m=s.canvasToWorld([v[0]+1,v[1]]),y=s.canvasToWorld([v[0],v[1]+1]),x=li(w,m),C=li(w,y),{imageData:S}=h,{scale:T,areaUnit:_}=Ko(h,()=>{const{maxX:D,maxY:b,minX:I,minY:R}=Gd(p),M=s.canvasToWorld([I,R]),P=yr(S,M),k=s.canvasToWorld([D,b]),z=yr(S,k);return[P,z]});let E=y1(p)/T/T;E*=x*C,c[d]={Modality:g.Modality,area:E,areaUnit:_}}return this.triggerAnnotationModified(n,a,tr.StatsUpdated),c},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{canvas:o}=n,a=gh(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;we(i);const s=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(s,i);const c=pt(i,this.getToolName());return this.editData={annotation:s,viewportIdsToRender:c,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:o,contourHoleProcessingEnabled:a},this._activateDraw(i),e.preventDefault(),Me(c),s}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),Ut(e);const{annotation:r,viewportIdsToRender:n,newAnnotation:i}=this.editData;return i&&hn(r.annotationUID),super.cancelAnnotation(r),we(e),Me(n),this.editData=null,r.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){var M,P,k;const{enabledElement:r,targetId:n,svgDrawingHelper:i,annotationStyle:o}=e,{viewport:a}=r,{worldToCanvas:s}=a,{element:c}=a,l=e.annotation,{annotationUID:f,data:u,highlighted:d}=l,{handles:h}=u,{points:g,activeHandleIndex:p}=h,v=(M=this.editData)==null?void 0:M.newAnnotation,{lineWidth:w,lineDash:m,color:y,locked:x}=o,C=g.map(z=>s(z)),{drawPreviewEnabled:S}=this.configuration.spline,T=l.data.spline.type,_=this._getSplineConfig(T),E=l.data.spline.instance,D=D5(l);if(D.findIndex(z=>!z)!==-1)throw new Error(`Can't find annotation for child ${l.childAnnotationUIDs.join()}`);[l,...D].filter(z=>this._isSplineROIAnnotation(z)).forEach(z=>{const L=this._updateSplineInstance(c,z).getPolylinePoints();this.updateContourPolyline(z,{points:L,closed:u.contour.closed,targetWindingDirection:vu.Clockwise},a,{updateWindingDirection:u.contour.closed})}),super.renderAnnotationInstance(e),!u.cachedStats[n]||u.cachedStats[n].areaUnit==null?(u.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(l,c)):l.invalidated&&this._throttledCalculateCachedStats(l,c);let R;if(!x&&!this.editData&&p!==null&&(R=[C[p]]),(R||v||d)&&Kn(i,f,"0",C,{color:y,lineWidth:w,handleRadius:"3"}),S&&E.numControlPoints>1&&((P=this.editData)!=null&&P.lastCanvasPoint)&&!E.closed){const{lastCanvasPoint:z}=this.editData,A=E.getPreviewPolylinePoints(z,Eb);ds(i,f,"previewSplineChange",A,{color:"#9EA0CA",lineDash:m,lineWidth:1})}if(_.showControlPointsConnectors){const z=[...C];E.closed&&z.push(C[0]),ds(i,f,"controlPointsConnectors",z,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(l,a,i,o.textbox),((k=this.fireChangeOnUpdate)==null?void 0:k.annotationUID)===f&&(this.triggerChangeEvent(l,r,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),l.invalidated=!1,!0}createInterpolatedSplineControl(e){var o;if((o=e.data.handles.points)!=null&&o.length)return;const{polyline:r}=e.data.contour;if(!r||!r.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,i=Math.max(10,Math.floor(r.length/20));for(let a=0;a<r.length-i;a+=i)n.push(r[a]);n.push(r[r.length-1])}createAnnotation(e){var l;const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:i}=this.configuration.spline,o=this._getSplineConfig(i),a=new o.Class,s=()=>({type:o.type,instance:a,resolution:o.resolution});let c;return(l=this.configuration.interpolation)!=null&&l.enabled&&(c=f=>{var u;(u=f.data).spline||(u.spline=s()),this.createInterpolatedSplineControl(f)}),ci(r,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:c})}_deleteControlPointByIndex(e,r,n){we(e);const{points:i}=r.data.handles;i.length===3?hn(r.annotationUID):i.splice(n,1);const o=pt(e,this.getToolName());r.invalidated=!0,Me(o)}_isSplineROIAnnotation(e){var r;return!!((r=e.data)!=null&&r.spline)}_getSplineConfig(e){const{configuration:r}=this,n=r.spline.configuration;return Object.assign({type:e},aCe,n[e])}_updateSplineInstance(e,r){const n=we(e),{viewport:i}=n,{worldToCanvas:o}=i,{data:a}=r,{type:s,instance:c}=r.data.spline,l=this._getSplineConfig(s),u=a.handles.points.map(o),d=l.resolution!==void 0?parseInt(l.resolution):void 0,h=l.scale!==void 0?parseFloat(l.scale):void 0;return c.setControlPoints(u),c.closed=!!a.contour.closed,!c.fixedResolution&&d!==void 0&&c.resolution!==d&&(c.resolution=d,r.invalidated=!0),c instanceof Vp&&!c.fixedScale&&h!==void 0&&c.scale!==h&&(c.scale=h,r.invalidated=!0),c}};Q0.SplineTypes=Cc,Q0.Actions=Fg,Q0.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;if(r.length<_b){console.warn("Spline requires at least 3 control points");return}const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new Q0,f=l.getReferencedImageId(o,r[0],s,c),u=(n==null?void 0:n.splineType)||Cc.CatmullRom,h=l._getSplineConfig(u).Class,g=new h,p=r.map(y=>o.worldToCanvas(y));g.setControlPoints(p);const w=g.getPolylinePoints().map(y=>o.canvasToWorld(y)),m={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r},label:"",cachedStats:{},spline:{type:u,instance:g},contour:{closed:!0,polyline:w}},highlighted:!1,autoGenerated:!1,invalidated:!0,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(m,o.element),Me([o.id])};let Gp=Q0;function sCe(t,e){const r=t.cachedStats[e],{area:n,isEmptyArea:i,areaUnit:o}=r,a=[];if(n){const s=i?"Area: Oblique not supported":`Area: ${Kt(n)} ${o}`;a.push(s)}return a}Gp.toolName="SplineROI";class CG extends Gp{constructor(e){const r=ci({configuration:{calculateStats:!1}},e);super(r)}isContourSegmentationTool(){return!0}}CG.toolName="SplineContourSegmentationTool";class cCe{constructor({numBits:e,getPriority:r,areEqual:n}){this._bucketCount=1<<e,this._mask=this._bucketCount-1,this._size=0,this._currentBucketIndex=0,this._buckets=this._buildArray(this._bucketCount),this._getPriority=typeof r<"u"?r:i=>i,this._areEqual=typeof n=="function"?n:(i,o)=>i===o}push(e){const r=this._getBucketIndex(e),n=this._buckets[r],i={value:e,next:n};this._buckets[r]=i,this._size++}pop(){if(this._size===0)throw new Error("Cannot pop because the queue is empty.");for(;this._buckets[this._currentBucketIndex]===null;)this._currentBucketIndex=(this._currentBucketIndex+1)%this._bucketCount;const e=this._buckets[this._currentBucketIndex];return this._buckets[this._currentBucketIndex]=e.next,this._size--,e.value}remove(e){if(!e)return!1;const r=this._getBucketIndex(e),n=this._buckets[r];let i=n,o;for(;i!==null&&!this._areEqual(e,i.value);)o=i,i=i.next;return i===null?!1:(i===n?this._buckets[r]=i.next:o.next=i.next,this._size--,!0)}isEmpty(){return this._size===0}_getBucketIndex(e){return this._getPriority(e)&this._mask}_buildArray(e){const r=new Array(e);return r.fill(null),r}}const D3=4294967295,lCe=2/(3*Math.PI);class hy{constructor(e,r,n){this._getPointIndex=(o,a)=>{const{width:s}=this;return o*s+a},this._getPointCoordinate=o=>{const a=o%this.width,s=Math.floor(o/this.width);return[a,s]},this._getPointCost=o=>Math.round(this.searchGranularity*this.costs[o]);const i=e.length;this.searchGranularityBits=8,this.searchGranularity=1<<this.searchGranularityBits,this.width=r,this.height=n,this.grayscalePixelData=e,this.laplace=null,this.gradXNew=null,this.gradYNew=null,this.laplace=this._computeLaplace(),this.gradMagnitude=this._computeGradient(),this.gradXNew=this._computeGradientX(),this.gradYNew=this._computeGradientY(),this.visited=new Array(i),this.parents=new Uint32Array(i),this.costs=new Float32Array(i)}startSearch(e){const r=this._getPointIndex(e[1],e[0]);this.startPoint=null,this.visited.fill(!1),this.parents.fill(D3),this.costs.fill(1/0),this.priorityQueueNew=new cCe({numBits:this.searchGranularityBits,getPriority:this._getPointCost}),this.startPoint=e,this.costs[r]=0,this.priorityQueueNew.push(r)}findMinNearby(e,r=2){const[n,i]=e,{costs:o}=this,a=[Math.max(0,n-r),Math.min(n+r+1,this.width)],s=[Math.max(0,i-r),Math.min(i+r+1,this.height)];let c=o[this._getPointIndex(i,n)]*.8,l=e;for(let f=a[0];f<a[1];f++)for(let u=s[0];u<s[1];u++){const d=1-(Math.abs(f-e[0])+Math.abs(u-e[1]))/r/2,g=o[this._getPointIndex(u,f)]*.8+d*.2;g<c&&(l=[f,u],c=g)}return l}findPathToPoint(e){if(!this.startPoint)throw new Error("There is no search in progress");const{startPoint:r,_getPointIndex:n,_getPointCoordinate:i}=this,o=n(r[1],r[0]),a=n(e[1],e[0]),{visited:s,parents:c,costs:l,priorityQueueNew:f}=this;if(a===o)return[];for(;!f.isEmpty()&&c[a]===D3;){const h=f.pop();if(s[h])continue;const g=i(h),p=this._getNeighborPoints(g);s[h]=!0;for(let v=0,w=p.length;v<w;v++){const m=p[v],y=n(m[1],m[0]),x=this._getWeightedDistance(g,m),C=l[h]+x;C<l[y]&&(l[y]!==1/0&&f.remove(y),l[y]=C,c[y]=h,f.push(y))}}const u=[];let d=a;for(;d!==D3;)u.push(i(d)),d=c[d];return u.reverse()}_getDeltaX(e,r){const{grayscalePixelData:n,width:i}=this;let o=this._getPointIndex(r,e);return e+1===i&&o--,n[o+1]-n[o]}_getDeltaY(e,r){const{grayscalePixelData:n,width:i,height:o}=this;let a=this._getPointIndex(r,e);return r+1===o&&(a-=i),n[a]-n[a+i]}_getGradientMagnitude(e,r){const n=this._getDeltaX(e,r),i=this._getDeltaY(e,r);return Math.sqrt(n*n+i*i)}_getLaplace(e,r){const{grayscalePixelData:n,_getPointIndex:i}=this,o=n[i(r-2,e)],a=n[i(r-1,e-1)],s=n[i(r-1,e)],c=n[i(r-1,e+1)],l=n[i(r,e-2)],f=n[i(r,e-1)],u=n[i(r,e)],d=n[i(r,e+1)],h=n[i(r,e+2)],g=n[i(r+1,e-1)],p=n[i(r+1,e)],v=n[i(r+1,e+1)],w=n[i(r+2,e)];let m=o;return m+=a+2*s+c,m+=l+2*f-16*u+2*d+h,m+=g+2*p+v,m+=w,m}_computeGradient(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0,o=0,a=0,s=0;for(s=0;s<r-1;s++){for(a=0;a<e-1;a++)n[i]=this._getGradientMagnitude(a,s),o=Math.max(n[i],o),i++;n[i]=n[i-1],i++}for(let c=n.length;i<c;i++)n[i]=n[i-e];for(let c=0,l=n.length;c<l;c++)n[c]=1-n[c]/o;return n}_computeLaplace(){const{width:e,height:r,_getPointIndex:n}=this,i=new Float32Array(e*r);i.fill(1,0,n(2,0));for(let o=2;o<r-2;o++){i[n(o,0)]=1,i[n(o,1)]=1;for(let a=2;a<e-2;a++)i[n(o,a)]=this._getLaplace(a,o)>.33?0:1;i[n(o,e-2)]=1,i[n(o,e-1)]=1}return i.fill(1,n(r-2,0)),i}_computeGradientX(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaX(a,o);return n}_computeGradientY(){const{width:e,height:r}=this,n=new Float32Array(e*r);let i=0;for(let o=0;o<r;o++)for(let a=0;a<e;a++)n[i++]=this._getDeltaY(a,o);return n}_getGradientUnitVector(e,r){const{gradXNew:n,gradYNew:i,_getPointIndex:o}=this,a=n[o(r,e)],s=i[o(r,e)];let c=Math.sqrt(a*a+s*s);return c=Math.max(c,1e-100),[a/c,s/c]}_getGradientDirection(e,r,n,i){const o=this._getGradientUnitVector(e,r),a=this._getGradientUnitVector(n,i);let s=o[1]*(n-e)-o[0]*(i-r),c=a[1]*(n-e)-a[0]*(i-r);s<0&&(s=-s,c=-c),e!==n&&r!==i&&(s*=Math.SQRT1_2,c*=Math.SQRT1_2),c=Math.min(Math.max(c,-1),1);const l=lCe*(Math.acos(Math.min(s,1))+Math.acos(c));return isNaN(l)||!isFinite(l)?(console.warn("Found non-direction:",e,r,n,i,s,c,l),1):l}getCost(e,r){return this._getWeightedDistance(e,r)}_getWeightedDistance(e,r){const{_getPointIndex:n,width:i,height:o}=this,[a,s]=e,[c,l]=r;if(c<0||c>=i||l<0||l>=o)return 1;if(a<0||s<0||a>=i||s>=o)return 0;const f=n(l,c);let u=this.gradMagnitude[f];(a===c||s===l)&&(u*=Math.SQRT1_2);const d=this.laplace[f],h=this._getGradientDirection(a,s,c,l);return .43*u+.43*d+.11*h}_getNeighborPoints(e){const{width:r,height:n}=this,i=[],o=Math.max(e[0]-1,0),a=Math.max(e[1]-1,0),s=Math.min(e[0]+1,r-1),c=Math.min(e[1]+1,n-1);for(let l=a;l<=c;l++)for(let f=o;f<=s;f++)(f!==e[0]||l!==e[1])&&i.push([f,l]);return i}static createInstanceFromRawPixelData(e,r,n,i){const o=e.length,a=new Float32Array(o),{lower:s,upper:c}=i,l=c-s;for(let f=0,u=e.length;f<u;f++)a[f]=Math.max(0,Math.min(1,(e[f]-s)/l));return new hy(a,r,n)}}class yc{constructor(e,r){this.pointArray=e?e.slice():[],this._controlPointIndexes=r?r.slice():[]}getPoint(e){return this.pointArray[e]}getLastPoint(){return this.pointArray[this.pointArray.length-1]}isControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)return this._controlPointIndexes.indexOf(r)!==-1;throw new Error("Error: isControlPoint called with not in list point.")}addPoint(e){this.pointArray.push(e)}addControlPoint(e){const r=this.pointArray.indexOf(e);if(r!==-1)this._controlPointIndexes.push(r);else throw new Error("Cannot mark a non registered point as control point.")}getControlPoints(){return this._controlPointIndexes.map(e=>this.pointArray[e])}getNumControlPoints(){return this._controlPointIndexes.length}removeLastControlPoint(){this._controlPointIndexes.length&&this._controlPointIndexes.pop()}getLastControlPoint(){if(this._controlPointIndexes.length)return this.pointArray[this._controlPointIndexes[this._controlPointIndexes.length-1]]}removeLastPoints(e){this.pointArray.splice(this.pointArray.length-e,e)}addPoints(e){this.pointArray=this.pointArray.concat(e)}prependPath(e){const r=e.pointArray.length,n=[];this.pointArray=e.pointArray.concat(this.pointArray);for(let i=0;i<this._controlPointIndexes.length;++i)n[i]=this._controlPointIndexes[i]+r;this._controlPointIndexes=e._controlPointIndexes.concat(n)}appendPath(e){this.addPoints(e.pointArray),e._controlPointIndexes.forEach(r=>this._controlPointIndexes.push(r))}}const uCe=10**2;class l8 extends Rp{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextLines:fCe,calculateStats:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:ii.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{cancelInProgress:{method:"cancelInProgress",bindings:[{key:"Escape"}]}}}}){super(e,r),this.isHandleOutsideImage=!1,this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,l=a*a,f=i.data.contour.polyline.map(d=>c.worldToCanvas(d));let u=f[f.length-1];for(let d=0;d<f.length;d++){const h=f[d];if(v1(u,h,o)<=l)return!0;u=h}return!1},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},we(a),this._activateModify(a),Me(s),n.preventDefault()},this.handleSelectedCallback=(n,i,o)=>{const a=n.detail,{element:s}=a,{data:c}=i;i.highlighted=!0;let l=!1,f;if(o.worldPosition)l=!0;else{const{points:d}=c.handles;f=d.findIndex(h=>h===o)}const u=pt(s,this.getToolName());this.editData={annotation:i,viewportIdsToRender:u,handleIndex:f,movingTextBox:l},this._activateModify(s),we(s),Me(u),n.preventDefault()},this._endCallback=(n,i=!1)=>{const o=n.detail,{element:a}=o,{annotation:s,viewportIdsToRender:c,newAnnotation:l,contourHoleProcessingEnabled:f}=this.editData,{data:u}=s;this.doneEditMemo(),u.handles.activeHandleIndex=null,this._deactivateModify(a),this._deactivateDraw(a),Ut(a);const d=we(a);if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||i){hn(s.annotationUID),this.clearEditData(),Me(c);return}Me(c);const h=l?tr.Completed:tr.HandlesUpdated;this.triggerChangeEvent(s,d,h,f),this.clearEditData()},this.triggerChangeEvent=(n,i,o=tr.StatsUpdated,a=!1)=>{o===tr.Completed?l4(n,a):qn(n,i.viewport.element,o)},this._mouseDownCallback=n=>{const i=n.type===U.MOUSE_DOUBLE_CLICK,{annotation:o,viewportIdsToRender:a,worldToSlice:s,sliceToWorld:c,newAnnotation:l}=this.editData;if(this.editData.closed)return;const f=n.detail,{element:u}=f,{currentPoints:d}=f,{canvas:h,world:g}=d;let p=g;const v=we(u),{viewport:w,renderingEngine:m}=v,y=this.editData.currentPath.getControlPoints();let x=y.length>=2&&i;if(this.doneEditMemo(),this.createMemo(u,o,{newAnnotation:l&&y.length===1}),y.length>=2){const T={index:-1,distSquared:1/0};for(let _=0,E=y.length;_<E;_++){const D=y[_],b=c(D),I=w.worldToCanvas(b),R=jc(h,I);R<=uCe&&R<T.distSquared&&(T.distSquared=R,T.index=_)}T.index===0&&(x=!0)}const{snapHandleNearby:C}=this.configuration;if(C&&!this.editData.closed){const T=new yc,_=this.scissors.findMinNearby(s(g),1),E=this.scissors.findPathToPoint(_);T.addPoints(E),T.prependPath(this.editData.confirmedPath),p=c(_),this.editData.currentPath=T}this.editData.closed=this.editData.closed||x,this.editData.confirmedPath=this.editData.currentPath;const S=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(S),o.data.handles.points.push(c(S)),this.scissors.startSearch(s(p)),o.invalidated=!0,Me(a),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(n)),n.preventDefault()},this._mouseMoveCallback=n=>{const{element:i,currentPoints:o}=n.detail,{world:a,canvas:s}=o;we(i);const c=pt(i,this.getToolName());this.editData.lastCanvasPoint=s;const{width:l,height:f}=this.scissors,{worldToSlice:u}=this.editData,d=u(a);if(d[0]<0||d[1]<0||d[0]>=l||d[1]>=f)return;const h=this.scissors.findPathToPoint(d),g=new yc;g.addPoints(h),g.prependPath(this.editData.confirmedPath),this.editData.currentPath=g,Me(c),n.preventDefault()},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,movingTextBox:c,handleIndex:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(c){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(l===void 0)console.warn("Drag annotation not implemented");else{const{currentPoints:d}=i,h=d.world;this.editHandle(h,o,a,l)}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData;return a&&hn(i.annotationUID),Me(o),this.doneEditMemo(),this.scissors=null,i.annotationUID},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_MOVE,this._mouseMoveCallback),n.addEventListener(U.MOUSE_DOWN,this._mouseDownCallback),n.addEventListener(U.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.addEventListener(U.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_MOVE,this._mouseMoveCallback),n.removeEventListener(U.MOUSE_DOWN,this._mouseDownCallback),n.removeEventListener(U.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),n.removeEventListener(U.TOUCH_TAP,this._mouseDownCallback)},this._calculateCachedStats=(n,i)=>{if(!this.configuration.calculateStats)return;const o=n.data;if(!o.contour.closed)return;const a=we(i),{viewport:s,renderingEngine:c}=a,{cachedStats:l}=o,{polyline:f}=o.contour,u=Object.keys(l);for(let d=0;d<u.length;d++){const h=u[d],g=this.getTargetImageData(h);if(!g)continue;const{metadata:p}=g,v=f.map(b=>s.worldToCanvas(b)),w=v[0],m=s.canvasToWorld(w),y=s.canvasToWorld([w[0]+1,w[1]]),x=s.canvasToWorld([w[0],w[1]+1]),C=li(m,y),S=li(m,x),{imageData:T}=g,{scale:_,areaUnit:E}=Ko(g,()=>{const{maxX:b,maxY:I,minX:R,minY:M}=Gd(v),P=s.canvasToWorld([R,M]),k=yr(T,P),z=s.canvasToWorld([b,I]),A=yr(T,z);return[k,A]});let D=y1(v)/_/_;D*=C*S,l[h]={Modality:p.Modality,area:D,areaUnit:E}}return this.triggerAnnotationModified(n,a,tr.StatsUpdated),l},this._renderStats=(n,i,o,a)=>{const s=n.data,c=this.getTargetId(i);if(!s.contour.closed||!a.visibility)return;const l=this.configuration.getTextLines(s,c);if(!l||l.length===0)return;const f=s.handles.points.map(m=>i.worldToCanvas(m));if(!s.handles.textBox.hasMoved){const m=Jo(f);s.handles.textBox.worldPosition=i.canvasToWorld(m)}const u=i.worldToCanvas(s.handles.textBox.worldPosition),h=to(o,n.annotationUID??"","textBox",l,u,f,{},a),{x:g,y:p,width:v,height:w}=h;s.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([g,p]),topRight:i.canvasToWorld([g+v,p]),bottomLeft:i.canvasToWorld([g,p+w]),bottomRight:i.canvasToWorld([g+v,p+w])}},this.triggerAnnotationModified=(n,i,o=tr.StatsUpdated)=>{const{viewportId:a,renderingEngineId:s}=i,c=U.ANNOTATION_MODIFIED;Qe(We,c,{annotation:n,viewportId:a,renderingEngineId:s,changeType:o})},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}setupBaseEditData(e,r,n,i,o){var T,_;const a=we(r),{viewport:s}=a;this.isDrawing=!0;const c=s.getImageData(),{imageData:l}=c;let f,u,d,h,g;if(!(s instanceof Rn))d=c.dimensions[0],h=c.dimensions[1],f=E=>{const D=yr(l,E);return[D[0],D[1]]},u=E=>Nd(l,[E[0],E[1],0]),g=c.scalarData;else if(s instanceof Rn){const E=N_(s),{sliceToIndexMatrix:D,indexToSliceMatrix:b}=E;f=I=>{const R=yr(l,I),M=Pt([0,0,0],R,b);return[M[0],M[1]]},u=I=>{const R=Pt([0,0,0],[I[0],I[1],0],D);return Nd(l,R)},g=E.scalarData,d=E.width,h=E.height}else throw new Error("Viewport not supported");g=XA(g,d,h);const{voiRange:p}=s.getProperties(),v=f(e);this.scissors=hy.createInstanceFromRawPixelData(g,d,h,p),i&&(this.scissorsNext=hy.createInstanceFromRawPixelData(g,d,h,p),this.scissorsNext.startSearch(f(i))),this.scissors.startSearch(v);const w=!i,m=new yc,y=new yc,x=w?void 0:new yc;m.addPoint(v),m.addControlPoint(v);const C=pt(r,this.getToolName()),S=s.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:C,newAnnotation:w,hasMoved:!1,lastCanvasPoint:S,confirmedPath:m,currentPath:y,confirmedPathNext:x,closed:!1,handleIndex:((T=this.editData)==null?void 0:T.handleIndex)??((_=n.handles)==null?void 0:_.activeHandleIndex),worldToSlice:f,sliceToWorld:u,contourHoleProcessingEnabled:o}}addNewAnnotation(e){const r=e.detail,{currentPoints:n,element:i}=r,{world:o}=n,a=this.createAnnotation(e),s=gh(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(o,i,a,void 0,s),this.addAnnotation(a,i),this._activateDraw(i),e.preventDefault(),Me(this.editData.viewportIdsToRender),a}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,r,n,i){var y;const{data:o}=n,{points:a}=o.handles,{length:s}=a,c=a[(i-1+s)%s],l=a[(i+1)%s];if(!((y=this.editData)!=null&&y.confirmedPathNext)){this.setupBaseEditData(c,r,n,l);const{polyline:x}=o.contour,C=new yc,S=new yc,{worldToSlice:T}=this.editData,_=JC(n,i-1),E=JC(n,i+1);if(E===-1||_===-1)throw new Error(`Can't find handle index ${E===-1&&l} ${_===-1&&c}`);i===0?S.addPoints(x.slice(E+1,_).map(T)):(C.addPoints(x.slice(0,_+1).map(T)),S.addPoints(x.slice(E,x.length).map(T))),this.editData.confirmedPath=C,this.editData.confirmedPathNext=S}const{editData:f,scissors:u}=this,{worldToSlice:d,sliceToWorld:h}=f,{activeHandleIndex:g}=o.handles;if(g==null)o.handles.activeHandleIndex=i;else if(g!==i)throw new Error(`Trying to edit a different handle than the one currently being edited ${i}!==${o.handles.activeHandleIndex}`);const p=d(e);if(p[0]<0||p[0]>=u.width||p[1]<0||p[1]>=u.height)return;a[i]=h(p);const v=u.findPathToPoint(p),w=this.scissorsNext.findPathToPoint(p),m=new yc;m.prependPath(f.confirmedPath),i!==0&&m.addPoints(v),m.addPoints(w.reverse()),m.appendPath(f.confirmedPathNext),i===0&&m.addPoints(v),f.currentPath=m,n.invalidated=!0,f.hasMoved=!0,f.closed=!0}renderAnnotation(e,r){var n;return this.updateAnnotation((n=this.editData)==null?void 0:n.currentPath),super.renderAnnotation(e,r)}isContourSegmentationTool(){return!1}createAnnotation(e){const r=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return ci(r,{data:{handles:{points:[[...n]]}}})}cancelInProgress(e,r,n){if(!this.editData){this.undo();return}this._endCallback(n,!0)}renderAnnotationInstance(e){var m,y,x,C;const{annotation:r,enabledElement:n,svgDrawingHelper:i,annotationStyle:o,targetId:a}=e,{viewport:s}=n,{element:c}=s,{worldToCanvas:l}=s,{annotationUID:f,data:u,highlighted:d}=r,{handles:h}=u,g=(m=this.editData)==null?void 0:m.newAnnotation,{lineWidth:p,lineDash:v,color:w}=o;if(d||g&&r.annotationUID===((x=(y=this.editData)==null?void 0:y.annotation)==null?void 0:x.annotationUID)){const S="0",T=h.points.map(l);Kn(i,f,S,T,{color:w,lineDash:v,lineWidth:p})}return super.renderAnnotationInstance(e),!u.cachedStats[a]||((C=u.cachedStats[a])==null?void 0:C.areaUnit)===null?(u.cachedStats[a]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(r,c)):r.invalidated&&this._throttledCalculateCachedStats(r,c),this._renderStats(r,s,i,o.textbox),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:r,sliceToWorld:n,worldToSlice:i,closed:o,newAnnotation:a}=this.editData;let{pointArray:s}=e;s.length>1&&(s=[...s,s[0]]);const c=a&&o?vu.Clockwise:void 0;this.updateContourPolyline(r,{points:s,closed:o,targetWindingDirection:c},{canvasToWorld:n,worldToCanvas:i})}}l8.toolName="LivewireContour";function fCe(t,e){const r=t.cachedStats[e],{area:n,areaUnit:i}=r,o=[];if(n){const a=`Area: ${Kt(n)} ${i}`;o.push(a)}return o}class SG extends l8{updateInterpolatedAnnotation(e,r){this.editData||!e.invalidated||!e.data.handles.interpolationSources||(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask(()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:i}=r.viewport;this.setupBaseEditData(n[0],i,e);const{length:o}=n,{scissors:a}=this,{nearestEdge:s,repeatInterpolation:c}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:l,sliceToWorld:f}=this.editData,u=[];if(s){let h=l(n[n.length-1]);n.forEach((g,p)=>{const v=l(g);h=v,u.push(v),a.startSearch(h),a.findPathToPoint(v),a.findPathToPoint(l(n[(p+3)%n.length]));const w=a.findMinNearby(v,s);At(v,w)||(u[p]=w,h=w,n[p]=f(w))})}const d=new yc;for(let h=0;h<o;h++){a.startSearch(l(n[h]));const g=a.findPathToPoint(l(n[(h+1)%o]));d.addPoints(g)}this.updateAnnotation(d),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,c&&qn(e,r.viewport.element,tr.InterpolationUpdated)}))}renderAnnotationInstance(e){var u;const{enabledElement:r,svgDrawingHelper:n}=e,i=e.annotation,{annotationUID:o}=i,{viewport:a}=r,{worldToCanvas:s}=a,{showInterpolationPolyline:c}=this.configuration.interpolation||{};(u=this.updateInterpolatedAnnotation)==null||u.call(this,i,r);const{originalPolyline:l}=i.data.contour,f=super.renderAnnotationInstance(e);if(c&&l&&i.autoGenerated){const d=l.map(s);d.push(d[0]),ds(n,o,"interpolationContour-0",d,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return f}isContourSegmentationTool(){return!0}}SG.toolName="LivewireContourSegmentationTool";const Sy=class Sy extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:dCe,changeTextCallback:hCe,preventHandleOutsideImage:!1,arrowFirst:!0}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;Tt(a),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),{arrowFirst:p}=this.configuration,v=l.getFrameOfReferenceUID(),w={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:v,referencedImageId:g,...l.getViewReference({points:[s]})},data:{text:"",handles:{points:[[...s],[...s]],activeHandleIndex:null,arrowFirst:p,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};Zt(w,a);const m=pt(a,this.getToolName());return this.editData={annotation:w,viewportIdsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(m),w},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,[f,u]=l.handles.points,d=c.worldToCanvas(f),h=c.worldToCanvas(u),g={start:{x:d[0],y:d[1]},end:{x:h[0],y:h[1]}};return Ii([g.start.x,g.start.y],[g.end.x,g.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Tt(a),we(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;c&&!l||(f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),c?this.configuration.getTextCallback(u=>{if(!u){hn(a.annotationUID),Me(s),this.editData=null,this.isDrawing=!1;return}a.data.text=u,Bn(a),this.createMemo(o,a,{newAnnotation:!!this.memo}),Me(s)}):qn(a,o),this.doneEditMemo(),this.editData=null,this.isDrawing=!1)},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,newAnnotation:f}=this.editData;this.createMemo(o,a,{newAnnotation:f});const{data:u}=a;if(l){const{deltaPoints:d}=i,h=d.world,{textBox:g}=u.handles,{worldPosition:p}=g;p[0]+=h[0],p[1]+=h[1],p[2]+=h[2],g.hasMoved=!0}else if(c===void 0){const{deltaPoints:d}=i,h=d.world;u.handles.points.forEach(p=>{p[0]+=h[0],p[1]+=h[1],p[2]+=h[2]}),a.invalidated=!0}else{const{currentPoints:d}=i,h=d.world;u.handles.points[c]=[...h],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.touchTapCallback=n=>{n.detail.taps==2&&this.doubleClickCallback(n)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=sn(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!(a!=null&&a.length))return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.editData=null,this.isDrawing=!1,n.stopImmediatePropagation(),n.preventDefault()},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_END,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d,data:h}=u,{handles:g,text:p}=h,{points:v,activeHandleIndex:w}=g;l.annotationUID=d;const{color:m,lineWidth:y,lineDash:x}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),C=v.map(k=>a.worldToCanvas(k));let S;if(!jr(d)&&!this.editData&&w!==null&&(S=[C[w]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!ti(d))continue;S&&Kn(i,d,"0",C,{color:m,lineWidth:y});const T="1";if(this.configuration.arrowFirst?ay(i,d,T,C[1],C[0],{color:m,width:y,lineDash:x}):ay(i,d,T,C[0],C[1],{color:m,width:y,lineDash:x}),o=!0,!p)continue;const _=this.getLinkedTextBoxStyle(l,u);if(!_.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!h.handles.textBox.hasMoved){const k=C[1];h.handles.textBox.worldPosition=a.canvasToWorld(k)}const E=a.worldToCanvas(h.handles.textBox.worldPosition),b=to(i,d,"1",[p],E,C,{},_),{x:I,y:R,width:M,height:P}=b;h.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([I,R]),topRight:a.canvasToWorld([I+M,R]),bottomLeft:a.canvasToWorld([I,R+P]),bottomRight:a.canvasToWorld([I+M,R+P])}}return o}}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=pt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),Tt(o),we(o),Me(l),e.preventDefault()}_doneChangingTextCallback(e,r,n){r.data.text=n,we(e);const i=pt(e,this.getToolName());Me(i),qn(r,e)}_isInsideVolume(e,r,n){return ur(e,n)&&ur(r,n)}};Sy.hydrate=(e,r,n,i)=>{const o=An(e);if(!o)return;const{viewport:a}=o,s=a.getFrameOfReferenceUID(),{viewPlaneNormal:c,viewUp:l}=a.getCamera(),f=new Sy,u=f.getReferencedImageId(a,r[0],c,l),d={annotationUID:(i==null?void 0:i.annotationUID)||Cn(),data:{text:n||"",handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:f.getToolName(),viewPlaneNormal:c,FrameOfReferenceUID:s,referencedImageId:u,...i}};Zt(d,a.element),Me([a.id])};let gy=Sy;function dCe(t){return t(prompt("Enter your annotation:"))}function hCe(t,e,r){return r(prompt("Enter your annotation:"))}gy.toolName="ArrowAnnotate";const Ty=class Ty extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:gCe}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;Tt(a),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,[f,u,d]=l.handles.points,h=c.worldToCanvas(f),g=c.worldToCanvas(u),p={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}};if(Ii([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]])<=a)return!0;if(!d)return!1;const w=c.worldToCanvas(d),m={start:{x:g[0],y:g[1]},end:{x:w[0],y:w[1]}};return Ii([m.start.x,m.start.y],[m.end.x,m.end.y],[o[0],o[1]])<=a},this.toolSelectedCallback=(n,i)=>{const o=n.detail,{element:a}=o;i.highlighted=!0;const s=pt(a,this.getToolName());this.editData={annotation:i,viewportIdsToRender:s,movingTextBox:!1},this._activateModify(a),Tt(a),we(a),Me(s),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(!(c&&!l)){if(this.angleStartedNotYetCompleted&&f.handles.points.length===2){this.editData.handleIndex=2;return}this.angleStartedNotYetCompleted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a),this.editData=null,this.isDrawing=!1}},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l}=this.editData,{data:f}=a;if(l){const{deltaPoints:u}=i,d=u.world,{textBox:h}=f.handles,{worldPosition:g}=h;g[0]+=d[0],g[1]+=d[1],g[2]+=d[2],h.hasMoved=!0}else if(c===void 0){const{deltaPoints:u}=i,d=u.world;f.handles.points.forEach(g=>{g[0]+=d[0],g[1]+=d[1],g[2]+=d[2]}),a.invalidated=!0}else{const{currentPoints:u}=i,d=u.world;f.handles.points[c]=[...d],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{var d;let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let h=0;h<c.length;h++){const g=c[h],{annotationUID:p,data:v}=g,{points:w,activeHandleIndex:m}=v.handles;u.annotationUID=p;const{color:y,lineWidth:x,lineDash:C}=this.getAnnotationStyle({annotation:g,styleSpecifier:u}),S=w.map(A=>a.worldToCanvas(A));!v.cachedStats[l]||v.cachedStats[l].angle==null?(v.cachedStats[l]={angle:null},this._calculateCachedStats(g,f,n)):g.invalidated&&this._throttledCalculateCachedStats(g,f,n);let T;if(!jr(g.annotationUID)&&!this.editData&&m!==null&&(T=[S[m]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!ti(p))continue;T&&Kn(i,p,"0",S,{color:y,lineDash:C,lineWidth:x});let _="1";if(an(i,p,_,S[0],S[1],{color:y,width:x,lineDash:C}),o=!0,S.length!==3)return o;if(_="2",an(i,p,_,S[1],S[2],{color:y,width:x,lineDash:C}),!((d=v.cachedStats[l])!=null&&d.angle))continue;const E=this.getLinkedTextBoxStyle(u,g);if(!E.visibility){v.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const D=this.configuration.getTextLines(v,l);if(!v.handles.textBox.hasMoved){const A=S[1];v.handles.textBox.worldPosition=a.canvasToWorld(A)}const b=a.worldToCanvas(v.handles.textBox.worldPosition),R=to(i,p,"1",D,b,S,{},E),{x:M,y:P,width:k,height:z}=R;v.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([M,P]),topRight:a.canvasToWorld([M+k,P]),bottomLeft:a.canvasToWorld([M,P+z]),bottomRight:a.canvasToWorld([M+k,P+z])}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;let s=!1,c;n.worldPosition?s=!0:c=a.handles.points.findIndex(f=>f===n);const l=pt(o,this.getToolName());this.editData={annotation:r,viewportIdsToRender:l,handleIndex:c,movingTextBox:s},this._activateModify(o),Tt(o),we(o),Me(l),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==3)return;const a=i.handles.points[0],s=i.handles.points[1],c=i.handles.points[2],{cachedStats:l}=i,f=Object.keys(l);for(let u=0;u<f.length;u++){const d=f[u],h=kg([a,s],[s,c]),{dimensions:g,imageData:p}=this.getTargetImageData(d);this.isHandleOutsideImage=[a,s,c].map(v=>yr(p,v)).some(v=>!ur(v,g)),l[d]={angle:isNaN(h)?"Incomplete Angle":h}}return e.invalidated=!1,qn(e,o),l}};Ty.hydrate=(e,r,n)=>{const i=An(e);if(!i)return;const{viewport:o}=i,a=o.getFrameOfReferenceUID(),{viewPlaneNormal:s,viewUp:c}=o.getCamera(),l=new Ty,f=l.getReferencedImageId(o,r[0],s,c),u={annotationUID:(n==null?void 0:n.annotationUID)||Cn(),data:{handles:{points:r}},highlighted:!1,autoGenerated:!1,invalidated:!1,isLocked:!1,isVisible:!0,metadata:{toolName:l.getToolName(),viewPlaneNormal:s,FrameOfReferenceUID:a,referencedImageId:f,...n}};Zt(u,o.element),Me([o.id])};let py=Ty;function gCe(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:isNaN(n)?[`${n}`]:[`${Kt(n)} `]}py.toolName="Angle";const pCe=(...t)=>{const e=t[0].length===2?[0,0]:[0,0,0],r=t.length;for(const n of t)e[0]+=n[0]/r,e[1]+=n[1]/r,e.length===3&&(e[2]+=n[2]/r);return e},vc=pCe;class TG extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:mCe,showArcLines:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;Tt(a),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[s]})},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>{const s=we(n),{viewport:c}=s,{data:l}=i,{distanceToPoint:f,distanceToPoint2:u}=this.distanceToLines({viewport:c,points:l.handles.points,canvasCoords:o,proximity:a});return f<=a||u<=a},this.toolSelectedCallback=(n,i,o,a,s=6)=>{const c=n.detail,{element:l}=c;i.highlighted=!0;const f=pt(l,this.getToolName()),u=we(l),{renderingEngine:d,viewport:h}=u,{isNearFirstLine:g,isNearSecondLine:p}=this.distanceToLines({viewport:h,points:i.data.handles.points,canvasCoords:a,proximity:s});this.editData={annotation:i,viewportIdsToRender:f,movingTextBox:!1,isNearFirstLine:g,isNearSecondLine:p},this._activateModify(l),Tt(l),Me(f),n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(!(c&&!l)){if(this.doneEditMemo(),this.angleStartedNotYetCompleted&&f.handles.points.length<4){Ut(o),this.editData.handleIndex=f.handles.points.length;return}this.angleStartedNotYetCompleted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a),this.editData=null,this.isDrawing=!1}},this._mouseDownCallback=n=>{const{annotation:i,handleIndex:o}=this.editData,a=n.detail,{element:s,currentPoints:c}=a,l=c.world,{data:f}=i;if(o===1){f.handles.points[1]=l,this.editData.hasMoved=f.handles.points[1][0]!==f.handles.points[0][0]||f.handles.points[1][1]!==f.handles.points[0][0];return}if(o===3){f.handles.points[3]=l,this.editData.hasMoved=f.handles.points[3][0]!==f.handles.points[2][0]||f.handles.points[3][1]!==f.handles.points[2][0],this.angleStartedNotYetCompleted=!1;return}this.editData.hasMoved=!1,Tt(s),f.handles.points[2]=f.handles.points[3]=l,this.editData.handleIndex=f.handles.points.length-1},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l,isNearFirstLine:f,isNearSecondLine:u,newAnnotation:d}=this.editData;this.createMemo(o,a,{newAnnotation:d});const{data:h}=a;if(l){const{deltaPoints:g}=i,p=g.world,{textBox:v}=h.handles,{worldPosition:w}=v;w[0]+=p[0],w[1]+=p[1],w[2]+=p[2],v.hasMoved=!0}else if(c===void 0&&(f||u)){const{deltaPoints:g}=i,p=g.world,v=h.handles.points;f?[v[0],v[1]].forEach(m=>{m[0]+=p[0],m[1]+=p[1],m[2]+=p[2]}):u&&[v[2],v[3]].forEach(m=>{m[0]+=p[0],m[1]+=p[1],m[2]+=p[2]}),a.invalidated=!0}else{const{currentPoints:g}=i,p=g.world;h.handles.points[c]=[...p],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return s.handles.points.length<4&&hn(i.annotationUID),i.highlighted=!1,s.handles.activeHandleIndex=null,we(n),Me(o),a&&Bn(i),this.editData=null,this.angleStartedNotYetCompleted=!1,i.annotationUID},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.MOUSE_DOWN,this._mouseDownCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.MOUSE_DOWN,this._mouseDownCallback)},this.renderAnnotation=(n,i)=>{var d;let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let h=0;h<c.length;h++){const g=c[h],{annotationUID:p,data:v}=g,{points:w,activeHandleIndex:m}=v.handles;u.annotationUID=p;const{color:y,lineWidth:x,lineDash:C}=this.getAnnotationStyle({annotation:g,styleSpecifier:u}),S=w.map(_e=>a.worldToCanvas(_e));!v.cachedStats[l]||v.cachedStats[l].angle==null?(v.cachedStats[l]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(g,f,n)):g.invalidated&&this._throttledCalculateCachedStats(g,f,n);let T;if(!jr(p)&&!this.editData&&m!==null&&(T=[S[m]]),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;if(!ti(p))continue;T&&Kn(i,p,"0",S,{color:y,lineDash:C,lineWidth:x});const _=[S[0],S[1]],E=[S[2],S[3]];let D="line1";if(an(i,p,D,_[0],_[1],{color:y,width:x,lineDash:C}),o=!0,S.length<4)return o;D="line2",an(i,p,D,E[0],E[1],{color:y,width:x,lineDash:C}),D="linkLine";const b=vc(_[0],_[1]),I=vc(E[0],E[1]);an(i,p,D,b,I,{color:y,lineWidth:"1",lineDash:"1,4"});const{arc1Start:R,arc1End:M,arc2End:P,arc2Start:k}=v.cachedStats[l].points.canvas,{arc1Angle:z,arc2Angle:A}=v.cachedStats[l];if(this.configuration.showArcLines&&(D="arc1",an(i,p,D,R,M,{color:y,lineWidth:"1"}),D="arc2",an(i,p,D,k,P,{color:y,lineWidth:"1"})),!((d=v.cachedStats[l])!=null&&d.angle))continue;const L=this.getLinkedTextBoxStyle(u,g);if(!L.visibility){v.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const N=this.configuration.getTextLines(v,l);if(!v.handles.textBox.hasMoved){const _e=Jo(S);v.handles.textBox.worldPosition=a.canvasToWorld(_e)}const H=a.worldToCanvas(v.handles.textBox.worldPosition),oe=to(i,p,"cobbAngleText",N,H,S,{},L),{x:de,y:ue,width:me,height:Ee}=oe;if(v.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([de,ue]),topRight:a.canvasToWorld([de+me,ue]),bottomLeft:a.canvasToWorld([de,ue+Ee]),bottomRight:a.canvasToWorld([de+me,ue+Ee])},this.configuration.showArcLines){const _e="arcAngle1",Ce=[`${z.toFixed(2)} `],F=vc(R,M);Qf(i,p,_e,Ce,F,{...L,padding:3});const O="arcAngle2",$=[`${A.toFixed(2)} `],W=vc(k,P);Qf(i,p,O,$,W,{...L,padding:3})}}return o},this.distanceToLines=({viewport:n,points:i,canvasCoords:o,proximity:a})=>{const[s,c,l,f]=i,u=n.worldToCanvas(s),d=n.worldToCanvas(c),h=n.worldToCanvas(l),g=n.worldToCanvas(f),p={start:{x:u[0],y:u[1]},end:{x:d[0],y:d[1]}},v={start:{x:h[0],y:h[1]},end:{x:g[0],y:g[1]}},w=Ii([p.start.x,p.start.y],[p.end.x,p.end.y],[o[0],o[1]]),m=Ii([v.start.x,v.start.y],[v.end.x,v.end.y],[o[0],o[1]]);let y=!1,x=!1;return w<=a?y=!0:m<=a&&(x=!0),{distanceToPoint:w,distanceToPoint2:m,isNearFirstLine:y,isNearSecondLine:x}},this.getArcsStartEndPoints=({firstLine:n,secondLine:i,mid1:o,mid2:a})=>{const s=[o,a],c=kg(n,s),l=kg(i,s),f=c>90?1:0,u=l>90?0:1,d=vc(s[0],s[1]),h=Math.sqrt((s[1][0]-s[0][0])**2+(s[1][1]-s[0][1])**2),g=.1,p=vc(n[0],n[1]),v=vc(i[0],i[1]),w=[n[f][0]-p[0],n[f][1]-p[1]],m=Math.sqrt(w[0]**2+w[1]**2),y=[w[0]/m,w[1]/m],x=[p[0]+y[0]*h*g,p[1]+y[1]*h*g],C=[d[0]-o[0],d[1]-o[1]],S=Math.sqrt(C[0]**2+C[1]**2),T=[C[0]/S,C[1]/S],_=[o[0]+T[0]*h*g,o[1]+T[1]*h*g],E=[i[u][0]-v[0],i[u][1]-v[1]],D=Math.sqrt(E[0]**2+E[1]**2),b=[E[0]/D,E[1]/D],I=[v[0]+b[0]*h*g,v[1]+b[1]*h*g],R=[d[0]-a[0],d[1]-a[1]],M=Math.sqrt(R[0]**2+R[1]**2),P=[R[0]/M,R[1]/M],k=[a[0]+P[0]*h*g,a[1]+P[1]*h*g];return{arc1Start:x,arc1End:_,arc2Start:I,arc2End:k,arc1Angle:c>90?180-c:c,arc2Angle:l>90?180-l:l}},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,r,n,i="mouse"){const o=e.detail,{element:a}=o,{data:s}=r;r.highlighted=!0;let c=!1,l;n.worldPosition?c=!0:l=s.handles.points.findIndex(u=>u===n);const f=pt(a,this.getToolName());this.editData={annotation:r,viewportIdsToRender:f,handleIndex:l,movingTextBox:c},this._activateModify(a),Tt(a),Me(f),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data;if(i.handles.points.length!==4)return;const o=[null,null],a=[null,null];let s=Number.MAX_VALUE;for(let T=0;T<2;T+=1)for(let _=2;_<4;_+=1){const E=li(i.handles.points[T],i.handles.points[_]);E<s&&(s=E,o[1]=i.handles.points[T],o[0]=i.handles.points[(T+1)%2],a[0]=i.handles.points[_],a[1]=i.handles.points[2+(_-1)%2])}const{viewport:c}=n,{element:l}=c,f=i.handles.points.map(T=>c.worldToCanvas(T)),u=[f[0],f[1]],d=[f[2],f[3]],h=vc(u[0],u[1]),g=vc(d[0],d[1]),{arc1Start:p,arc1End:v,arc2End:w,arc2Start:m,arc1Angle:y,arc2Angle:x}=this.getArcsStartEndPoints({firstLine:u,secondLine:d,mid1:h,mid2:g}),{cachedStats:C}=i,S=Object.keys(C);for(let T=0;T<S.length;T++){const _=S[T];C[_]={angle:kg(o,a),arc1Angle:y,arc2Angle:x,points:{canvas:{arc1Start:p,arc1End:v,arc2End:w,arc2Start:m},world:{arc1Start:c.canvasToWorld(p),arc1End:c.canvasToWorld(v),arc2End:c.canvasToWorld(w),arc2Start:c.canvasToWorld(m)}}}}return e.invalidated=!1,qn(e,l),C}}function mCe(t,e){const r=t.cachedStats[e],{angle:n}=r;return n===void 0?void 0:[`${n.toFixed(2)} `]}TG.toolName="CobbAngle";const{transformWorldToIndex:Db}=cn;class _G extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:vCe,displayBothAxesDistances:!1}}){super(e,r),this.addNewAnnotation=n=>{if(this.startedDrawing)return;this.startedDrawing=!0;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;if(!(l instanceof Jn))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");Tt(a),this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=this.getReferencedImageId(l,s,d,h),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:p,referencedImageId:g},data:{handles:{points:[[...s],[...s]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};Zt(v,a);const w=pt(a,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:w,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),n.preventDefault(),Me(w),v},this.isPointNearTool=(n,i,o,a)=>!1,this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(!(c&&!l)){if(this.startedDrawing&&f.handles.points.length===1){this.editData.handleIndex=1;return}this.startedDrawing=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o),we(o),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID),Me(s),c&&Bn(a),this.editData=null,this.isDrawing=!1}},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c,movingTextBox:l}=this.editData,{data:f}=a;if(l){const{deltaPoints:u}=i,d=u.world,{textBox:h}=f.handles,{worldPosition:g}=h;g[0]+=d[0],g[1]+=d[1],g[2]+=d[2],h.hasMoved=!0}else if(c===void 0){const{deltaPoints:u}=i,d=u.world;f.handles.points.forEach(g=>{g[0]+=d[0],g[1]+=d[1],g[2]+=d[2]}),a.invalidated=!0}else{const{currentPoints:u}=i,d=u.world;f.handles.points[c]=[...d],a.invalidated=!0}this.editData.hasMoved=!0,we(o),Me(s)},this.cancel=n=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(n),this._deactivateModify(n),Ut(n);const{annotation:i,viewportIdsToRender:o,newAnnotation:a}=this.editData,{data:s}=i;return i.highlighted=!1,s.handles.activeHandleIndex=null,Me(o),a&&Bn(i),this.editData=null,this.startedDrawing=!1,i.annotationUID}},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this._activateDraw=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l=this.getTargetId(a),f=a.getRenderingEngine(),u={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let d=0;d<c.length;d++){const h=c[d],{annotationUID:g,data:p}=h,{points:v}=p.handles;u.annotationUID=g;const w=this.getStyle("color",u,h),m=v.map(M=>a.worldToCanvas(M));if(!p.cachedStats[l]||p.cachedStats[l].xValues==null?(p.cachedStats[l]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(h,f,n)):h.invalidated&&this._throttledCalculateCachedStats(h,f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let y="0";if(oy(i,g,y,m[0],{color:w},0),o=!0,m.length!==2)return o;if(y="1",oy(i,g,y,m[1],{color:w},1),p.cachedStats[l].isUnitless){const M=`${g}-line-1`;an(i,g,"1",m[0],m[1],{color:w,width:1,shadow:this.configuration.shadow},M)}else{const M=m[0],P=m[1],k=P[1]-M[1],z=P[0]-M[0],A=p.cachedStats[l].isHorizontal;let L=[0,0];A?L=[M[0]+z,M[1]]:L=[M[0],M[1]+k];let N=`${g}-line-1`,H="1";an(i,g,H,m[0],L,{color:w,width:1,shadow:this.configuration.shadow},N),N=`${g}-line-2`,H="2",an(i,g,H,m[1],L,{color:w,width:1,lineDash:[1,1],shadow:this.configuration.shadow},N)}const C=this.getLinkedTextBoxStyle(u,h);if(!C.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const S=this.configuration.getTextLines(p,l,this.configuration);if(!p.handles.textBox.hasMoved){const M=m[1];p.handles.textBox.worldPosition=a.canvasToWorld(M)}const T=a.worldToCanvas(p.handles.textBox.worldPosition),E=to(i,g,"1",S,T,m,{},C),{x:D,y:b,width:I,height:R}=E;p.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([D,b]),topRight:a.canvasToWorld([D+I,b]),bottomLeft:a.canvasToWorld([D,b+R]),bottomRight:a.canvasToWorld([D+I,b+R])}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,r,n,i){}handleSelectedCallback(e,r,n){const i=e.detail,{element:o}=i,{data:a}=r;r.highlighted=!0;const s=pt(o,this.getToolName());let c;n.worldPosition||(c=a.handles.points.findIndex(l=>l===n)),this.editData={handleIndex:c,annotation:r,viewportIdsToRender:s},this._activateModify(o),Tt(o),we(o),Me(s),e.preventDefault()}_calculateCachedStats(e,r,n){const i=e.data,{element:o}=n.viewport;if(i.handles.points.length!==2)return;const{cachedStats:a}=i,s=Object.keys(a);for(let c=0;c<s.length;c++){const l=s[c],f=this.getTargetImageData(l);if(!f)continue;const{imageData:u}=f,d=i.handles.points[0],h=i.handles.points[1],g=Db(u,d),p=Db(u,h),{values:v,units:w}=ny(f,[g]),{values:m,units:y}=ny(f,[p]);let x,C,S,T,_=!1;if(w[0]!==y[0]||w[1]!==y[1]||w[0]==="raw"&&y[0]==="raw"){const E=_a(d,h);x=[E,0],C=[E,0],S=["px"],_=!0}else{const E=n.viewport.worldToCanvas(d),D=n.viewport.worldToCanvas(h),b=D[1]-E[1],I=D[0]-E[0];T=Math.abs(I)>Math.abs(b),x=[v[0],m[0]],C=[v[1],m[1]],S=[w[0],w[1]]}a[l]={xValues:x,yValues:C,isHorizontal:T,units:S,isUnitless:_}}return e.invalidated=!1,qn(e,o),a}}function vCe(t,e,r){const n=t.cachedStats[e],{xValues:i,yValues:o,units:a,isUnitless:s,isHorizontal:c}=n;if(s)return[`${Kt(i[0])} px`];if(r.displayBothAxesDistances){const l=Math.abs(i[1]-i[0]),f=Math.abs(o[1]-o[0]);return[`${Kt(l)} ${a[0]}`,`${Kt(f)} ${a[1]}`]}if(c){const l=Math.abs(i[1]-i[0]);return[`${Kt(l)} ${a[0]}`]}else{const l=Math.abs(o[1]-o[0]);return[`${Kt(l)} ${a[1]}`]}}_G.toolName="UltrasoundDirectionalTool";class Y5 extends zn{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:yCe,changeTextCallback:wCe,canvasPosition:[10,10],canvasSize:10}}){super(e,r),this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c,f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=this.getReferencedImageId(l,s,u,d),g=Y5.createAnnotation({metadata:{...l.getViewReference(),referencedImageId:h}});Zt(g,a);const p=pt(a,this.getToolName());return n.preventDefault(),Me(p),this.configuration.getTextCallback(v=>{if(!v){hn(g.annotationUID),Me(p),this.isDrawing=!1;return}g.data.text=v,Bn(g),Me(p)}),this.createMemo(a,g,{newAnnotation:!0}),g},this.isPointNearTool=(n,i,o,a)=>{we(n);const{canvasPosition:s,canvasSize:c}=this.configuration;return s!=null&&s.length?Math.abs(o[0]-s[0]+c/2)<=c/2&&Math.abs(o[1]-s[1]+c/2)<=c/2:!1},this.toolSelectedCallback=(n,i)=>{i.highlighted=!0,n.preventDefault()},this._endCallback=n=>{const i=n.detail,{element:o}=i;this.doneEditMemo(),this._deactivateModify(o),Ut(o)},this.doubleClickCallback=n=>{const i=n.detail,{element:o}=i;let a=sn(this.getToolName(),o);if(a=this.filterInteractableAnnotationsForElement(o,a),!(a!=null&&a.length))return;const s=a.find(l=>this.isPointNearTool(o,l,i.currentPoints.canvas,6));if(!s)return;const c=s;this.createMemo(o,c),this.configuration.changeTextCallback(s,n.detail,this._doneChangingTextCallback.bind(this,o,c)),this.isDrawing=!1,this.doneEditMemo(),n.stopImmediatePropagation(),n.preventDefault()},this._activateModify=n=>{ze.isInteractingWithTool=!0,n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback)},this._deactivateModify=n=>{ze.isInteractingWithTool=!1,n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n,{element:s}=a;let c=sn(this.getToolName(),s);if(!(c!=null&&c.length)||(c=this.filterInteractableAnnotationsForElement(s,c),!(c!=null&&c.length)))return o;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let f=0;f<c.length;f++){const u=c[f],{annotationUID:d}=u;l.annotationUID=d;const{color:h}=this.getAnnotationStyle({annotation:u,styleSpecifier:l}),{canvasPosition:g,canvasSize:p}=this.configuration;if(g!=null&&g.length&&ay(i,d,"1",g.map(w=>w+p),g,{color:h,width:1}),o=!0,!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o}return o}}cancel(){}handleSelectedCallback(e,r,n){}_doneChangingTextCallback(e,r,n){r.data.text=n,we(e);const i=pt(e,this.getToolName());Me(i),qn(r,e)}_isInsideVolume(e,r,n){return ur(e,n)&&ur(r,n)}}function yCe(t){return t(prompt("Enter your annotation:"))}function wCe(t,e,r){return r(prompt("Enter your annotation:"))}Y5.toolName="KeyImage";class EG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>this._deleteNearbyAnnotations(n,"mouse"),this.preTouchStartCallback=n=>this._deleteNearbyAnnotations(n,"touch")}_deleteNearbyAnnotations(e,r){const{renderingEngineId:n,viewportId:i,element:o,currentPoints:a}=e.detail,s=or(i,n);if(!s)return!1;const c=s._toolInstances,l=[];for(const f in c){const u=c[f];if(typeof u.isPointNearTool!="function"||typeof u.filterInteractableAnnotationsForElement!="function")continue;const d=sn(f,o),h=u.filterInteractableAnnotationsForElement(o,d);if(h)for(const g of h)u.isPointNearTool(o,g,a.canvas,10,r)&&l.push(g.annotationUID)}for(const f of l){xa(f);const u=xr(f);zn.createAnnotationMemo(o,u,{deleting:!0}),hn(f)}return e.preventDefault(),!0}}EG.toolName="Eraser";const{transformWorldToIndex:bb,transformIndexToWorld:xCe}=cn,jg=class jg extends $r{constructor(e,r){const n=ci({configuration:{positiveSeedVariance:.1,negativeSeedVariance:.9,shrinkExpandIncrement:.05,islandRemoval:{enabled:!1}}},r);super(e,n)}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=we(n),{viewport:s,renderingEngine:c}=a,{viewUp:l}=s.getCamera(),{segmentationId:f,segmentIndex:u,labelmapVolumeId:d,referencedVolumeId:h}=await this.getLabelmapSegmentationData(s);if(!this._isOrthogonalView(s,h))throw new Error("Oblique view is not supported yet");return this.growCutData={metadata:{...s.getViewReference({points:[o]}),viewUp:l},segmentation:{segmentationId:f,segmentIndex:u,labelmapVolumeId:d,referencedVolumeId:h},viewportId:s.id,renderingEngineId:c.id},e.preventDefault(),!0}shrink(){this._runLastCommand({shrinkExpandAmount:-this.configuration.shrinkExpandIncrement})}expand(){this._runLastCommand({shrinkExpandAmount:this.configuration.shrinkExpandIncrement})}refresh(){this._runLastCommand()}async getGrowCutLabelmap(e){throw new Error("Not implemented")}async runGrowCut(){const{growCutData:e,configuration:r}=this,{segmentation:{segmentationId:n,segmentIndex:i,labelmapVolumeId:o}}=e,a=r.positiveSeedVariance!==void 0&&r.negativeSeedVariance!==void 0,s=ke.getVolume(o);let c=0;const l=async({shrinkExpandAmount:f=0}={})=>{const{positiveSeedVariance:u,negativeSeedVariance:d}=r;let h,g;c+=f,a&&(h=u+c,g=d+c);const p=Object.assign({},e,{options:{positiveSeedValue:i,negativeSeedValue:255,positiveSeedVariance:h,negativeSeedVariance:g}}),v=await this.getGrowCutLabelmap(p);this.applyGrowCutLabelmap(n,i,s,v),this._removeIslands(e)};await l(),a&&(jg.lastGrowCutCommand=l),this.growCutData=null}applyGrowCutLabelmap(e,r,n,i){const o=i.voxelManager.getCompleteScalarDataArray(),a=n.voxelManager,[s,c,l]=i.dimensions,[f,u]=n.dimensions,d=s*c,h=f*u;for(let g=0;g<l;g++)for(let p=0;p<c;p++){const v=[0,p,g],w=xCe(i.imageData,v),m=bb(n.imageData,w),[y,x,C]=m,S=p*s+g*d,T=y+x*f+C*h;for(let _=0;_<s;_++){const E=o[S+_]===r?r:0;a.setAtIndex(T+_,E)}}Ai(e)}_runLastCommand({shrinkExpandAmount:e=0}={}){const r=jg.lastGrowCutCommand;r&&r({shrinkExpandAmount:e})}async getLabelmapSegmentationData(e){const r=Du(e.id);if(!r)throw new Error("No active segmentation found");const{segmentationId:n}=r,i=Po(n),{representationData:o}=jt(n),a=o[ht.Labelmap],{volumeId:s,referencedVolumeId:c}=a;if(!s)throw new Error("Labelmap volume id not found - not implemented");return{segmentationId:n,segmentIndex:i,labelmapVolumeId:s,referencedVolumeId:c}}_isOrthogonalView(e,r){const i=ke.getVolume(r).imageData,o=e.getCamera(),{ijkVecColDir:a,ijkVecSliceDir:s}=p5(i,o);return[a,s].every(c=>At(Math.abs(c[0]),1)||At(Math.abs(c[1]),1)||At(Math.abs(c[2]),1))}getRemoveIslandData(e){}_removeIslands(e){const{islandRemoval:r}=this.configuration;if(!r.enabled)return;const{segmentation:{segmentIndex:n,labelmapVolumeId:i},renderingEngineId:o,viewportId:a}=e,s=ke.getVolume(i),c=this.getRemoveIslandData(e);if(!c)return;const[l,f]=s.dimensions,u=l*f,{worldIslandPoints:d=[],islandPointIndexes:h=[]}=c;let g=[...(c==null?void 0:c.ijkIslandPoints)??[]];const v=fr(o).getViewport(a),{voxelManager:w}=s,m=new n0;g=g.concat(d.map(y=>bb(s.imageData,y))),g=g.concat(h.map(y=>{const x=y%l,C=Math.floor(y/l)%f,S=Math.floor(y/u);return[x,C,S]})),m.initialize(v,w,{points:g,previewSegmentIndex:n,segmentIndex:n}),m.floodFillSegmentIsland(),m.removeExternalIslands(),m.removeInternalIslands()}getSegmentStyle({segmentationId:e,viewportId:r,segmentIndex:n}){return IF({segmentationId:e,segmentIndex:n,viewportId:r})}};jg.lastGrowCutCommand=null;let $d=jg;$d.toolName="GrowCutBaseTool";class DG extends $d{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{positiveSeedVariance:.5,negativeSeedVariance:.9}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=we(o),{viewport:l}=c;this.growCutData.circleBorderPoint=s,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=we(o),{viewport:s}=a;this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Ut(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=we(n),{viewport:s,renderingEngine:c}=a;return await super.preMouseDownCallback(e),Object.assign(this.growCutData,{circleCenterPoint:o,circleBorderPoint:o}),this._activateDraw(n),Tt(n),Me([s.id]),!0}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},renderingEngineId:n,viewportId:i,circleCenterPoint:o,circleBorderPoint:a,options:s}=e,l=fr(n).getViewport(i),f=Md(bn(Ae(),o,a));return CB(r,{center:o,radius:f},l,s)}_activateDraw(e){e.addEventListener(U.MOUSE_UP,this._endCallback),e.addEventListener(U.MOUSE_DRAG,this._dragCallback),e.addEventListener(U.MOUSE_CLICK,this._endCallback)}renderAnnotation(e,r){if(!this.growCutData)return;const{viewport:n}=e,{segmentation:i,circleCenterPoint:o,circleBorderPoint:a}=this.growCutData,s=n.worldToCanvas(o),c=n.worldToCanvas(a),l=ya(Vt(),c,s),f=Pq(l);if(At(f,0))return;const u="growcut",d="0",{color:h}=this.getSegmentStyle({segmentationId:i.segmentationId,segmentIndex:i.segmentIndex,viewportId:n.id});ho(r,u,d,s,f,{color:h})}}DG.toolName="RegionSegment";class bG extends $d{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{positiveSeedVariance:.4,negativeSeedVariance:.9,subVolumePaddingPercentage:.1,islandRemoval:{enabled:!0}}}){super(e,r)}async preMouseDownCallback(e){const r=e.detail,{currentPoints:n}=r,{world:i}=n;return await super.preMouseDownCallback(e),this.growCutData=ci(this.growCutData,{worldPoint:i,islandRemoval:{worldIslandPoints:[i]}}),this.growCutData.worldPoint=i,this.growCutData.islandRemoval={worldIslandPoints:[i]},this.runGrowCut(),!0}getRemoveIslandData(e){const{worldPoint:r}=e;return{worldIslandPoints:[r]}}async getGrowCutLabelmap(e){const{segmentation:{referencedVolumeId:r},renderingEngineId:n,viewportId:i,worldPoint:o,options:a}=e,c=fr(n).getViewport(i),{subVolumePaddingPercentage:l}=this.configuration,f={...a,subVolumePaddingPercentage:l};return TB(r,o,c,f)}}bG.toolName="RegionSegmentPlus";const CCe=[-1/0,-995],SCe=[0,1900],TCe=[1e3,1900],{transformWorldToIndex:Wm,transformIndexToWorld:b3}=cn;class IG extends $d{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{positivePixelRange:SCe,negativePixelRange:CCe,islandRemoval:{enabled:!0,islandPixelRange:TCe}}}){super(e,r),this._dragCallback=n=>{const i=n.detail,{element:o,currentPoints:a}=i,{world:s}=a,c=we(o),{viewport:l}=c,f=this._getHorizontalLineWorldPoints(c,s);this.growCutData.horizontalLines[1]=f,Me([l.id])},this._endCallback=async n=>{const i=n.detail,{element:o}=i,a=we(o),{viewport:s}=a;await this.runGrowCut(),this._deactivateDraw(o),this.growCutData=null,Ut(o),Me([s.id])},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback)}}async preMouseDownCallback(e){const r=e.detail,{element:n,currentPoints:i}=r,{world:o}=i,a=we(n),{viewport:s,renderingEngine:c}=a,l=this._getHorizontalLineWorldPoints(a,o);return await super.preMouseDownCallback(e),this.growCutData.horizontalLines=[l,l],this._activateDraw(n),Tt(n),Me([s.id]),!0}renderAnnotation(e,r){if(!this.growCutData)return;const{segmentation:n,horizontalLines:i}=this.growCutData;if(i.length!==2)return;const{viewport:o}=e,{segmentationId:a,segmentIndex:s}=n,[c,l]=i,[f,u]=c,[d,h]=l,g=[f,u,h,d].map(S=>o.worldToCanvas(S)),p="growCutRect",v="0",{color:w,fillColor:m,lineWidth:y,fillOpacity:x,lineDash:C}=this.getSegmentStyle({segmentationId:a,segmentIndex:s,viewportId:o.id});ds(r,p,v,g,{color:w,fillColor:m,fillOpacity:x,lineWidth:y,lineDash:C,closePath:!0})}async getGrowCutLabelmap(e){const{segmentation:{segmentIndex:r,referencedVolumeId:n},renderingEngineId:i,viewportId:o,horizontalLines:a}=e,c=fr(i).getViewport(o),[l,f]=a,u=[l[0],l[1],f[1],f[0]],d=ke.getVolume(n),{topLeft:h,bottomRight:g}=this._getWorldBoundingBoxFromProjectedSquare(c,u),p=Wm(d.imageData,h),v=Wm(d.imageData,g),w={boundingBox:{ijkTopLeft:p,ijkBottomRight:v}},m=this.configuration,y={positiveSeedValue:r,negativeSeedValue:255,negativePixelRange:m.negativePixelRange,positivePixelRange:m.positivePixelRange};return SB(n,w,y)}getRemoveIslandData(){const{segmentation:{segmentIndex:e,referencedVolumeId:r,labelmapVolumeId:n}}=this.growCutData,i=ke.getVolume(r),o=ke.getVolume(n),a=i.voxelManager.getCompleteScalarDataArray(),s=o.voxelManager.getCompleteScalarDataArray(),{islandPixelRange:c}=this.configuration.islandRemoval,l=[];for(let f=0,u=s.length;f<u;f++){if(s[f]!==e)continue;const d=a[f];d>=c[0]&&d<=c[1]&&l.push(f)}return{islandPointIndexes:l}}_activateDraw(e){e.addEventListener(U.MOUSE_UP,this._endCallback),e.addEventListener(U.MOUSE_DRAG,this._dragCallback),e.addEventListener(U.MOUSE_CLICK,this._endCallback)}_projectWorldPointAcrossSlices(e,r,n){const i=this._getViewportVolume(e),{dimensions:o}=i,a=Wm(i.imageData,r),s=n.findIndex(f=>At(Math.abs(f),1));if(s===-1)throw new Error("Non-orthogonal direction vector");const c=[...a],l=[...a];return c[s]=0,l[s]=o[s]-1,[c,l]}_getCuboidIJKEdgePointsFromProjectedWorldPoint(e,r){const{viewPlaneNormal:n}=e.getCamera();return this._projectWorldPointAcrossSlices(e,r,n)}_getWorldCuboidCornerPoints(e,r){const n=[],i=this._getViewportVolume(e);return r.forEach(o=>{const s=this._getCuboidIJKEdgePointsFromProjectedWorldPoint(e,o).map(c=>b3(i.imageData,c));n.push(...s)}),n}_getWorldBoundingBoxFromProjectedSquare(e,r){const n=this._getWorldCuboidCornerPoints(e,r),i=[...n[0]],o=[...n[0]];return n.forEach(a=>{nC(i,i,a),f2(o,o,a)}),{topLeft:i,bottomRight:o}}_getViewportVolume(e){if(!(e instanceof Xn))throw new Error("Viewport is not a BaseVolumeViewport");const r=e.getAllVolumeIds()[0];return ke.getVolume(r)}_getHorizontalLineIJKPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),{dimensions:o}=i,a=Wm(i.imageData,r),{viewUp:s,viewPlaneNormal:c}=n.getCamera(),f=xn(Ae(),s,c).findIndex(h=>At(Math.abs(h),1)),u=[...a],d=[...a];return u[f]=0,d[f]=o[f]-1,[u,d]}_getHorizontalLineWorldPoints(e,r){const{viewport:n}=e,i=this._getViewportVolume(n),[o,a]=this._getHorizontalLineIJKPoints(e,r),s=b3(i.imageData,o),c=b3(i.imageData,a);return[s,c]}}IG.toolName="WholeBodySegment";function _Ce(t,e,r=!0){const n=Object.assign({},e,{segmentIndex:0});Y4(t,n)}function ECe(t,e){_Ce(t,e,!0)}class OG extends r0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:Y4,ERASE_INSIDE:ECe},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c;this.isDrawing=!0;const f=l.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=Du(l.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:g}=h,p=Po(g),v=u0(g),w=qc(l.id,g,p),{representationData:m}=jt(g),y=m[ht.Labelmap],x={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],viewUp:[...d],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:w},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null}}},C=pt(a,this.getToolName());if(this.editData={annotation:x,segmentIndex:p,segmentationId:g,segmentsLocked:v,segmentColor:w,viewportIdsToRender:C,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof Xn){const{volumeId:S}=y,T=ke.getVolume(S);this.editData={...this.editData,volumeId:S,referencedVolumeId:T.referencedVolumeId}}else{const S=qo(l.id,g);this.editData={...this.editData,imageId:S}}return this._activateDraw(a),Tt(a),n.preventDefault(),Me(C),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,handleIndex:c}=this.editData,{data:l}=a,{currentPoints:f}=i,u=we(o),{worldToCanvas:d,canvasToWorld:h}=u.viewport,g=f.world,{points:p}=l.handles;p[c]=[...g];let v,w,m,y,x,C,S,T;switch(c){case 0:case 3:v=d(p[0]),y=d(p[3]),w=[y[0],v[1]],m=[v[0],y[1]],C=h(w),S=h(m),p[1]=C,p[2]=S;break;case 1:case 2:w=d(p[1]),m=d(p[2]),v=[m[0],w[1]],y=[w[0],m[1]],x=h(v),T=h(y),p[0]=x,p[3]=T;break}a.invalidated=!0,this.editData.hasMoved=!0,Me(s)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Ut(o);const f=we(o),u={...this.editData,points:l.handles.points,strategySpecificConfiguration:{},createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(f,u),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{annotation:s}=this.editData,c=s.metadata,l=s.annotationUID,f=s.data,{points:u}=f.handles,d=u.map(p=>a.worldToCanvas(p)),h=`rgb(${c.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(x1(i,l,"0",d[0],d[3],{color:h}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}OG.toolName="RectangleScissor";class MG extends r0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:j5,ERASE_INSIDE:aB},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=we(a),{viewport:f}=l;this.isDrawing=!0;const u=f.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=Du(f.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,v=Po(p),w=u0(p),m=qc(f.id,p,v),{representationData:y}=jt(p),x=y.Labelmap;if(!x)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const C={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:m},data:{handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},S=[f.id];if(this.editData={annotation:C,centerCanvas:c,segmentIndex:v,segmentationId:p,segmentsLocked:w,segmentColor:m,viewportIdsToRender:S,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},f instanceof Xn){const{volumeId:T}=x,_=ke.getVolume(T);this.editData={...this.editData,volumeId:T,referencedVolumeId:_.referencedVolumeId}}else{const T=qo(f.id,p);this.editData={...this.editData,imageId:T}}return this._activateDraw(a),Tt(a),n.preventDefault(),Me(S),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=we(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=d,v=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),m=Math.sqrt(v*v+w*w),y=[g[0],g[1]+m],x=[g[0],g[1]-m],C=[g[0]-m,g[1]],S=[g[0]+m,g[1]];p.handles.points=[u(y),u(x),u(C),u(S)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=a,{viewPlaneNormal:f,viewUp:u}=a.metadata;if(s&&!c)return;l.handles.activeHandleIndex=null,this._deactivateDraw(o),Ut(o);const d=we(o),h={...this.editData,points:l.handles.points,viewPlaneNormal:f,viewUp:u,strategySpecificConfiguration:{},createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(d,h),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback),n.addEventListener(U.TOUCH_END,this._endCallback)},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,f=c.annotationUID,u=c.data,{points:d}=u.handles,h=d.map(x=>a.worldToCanvas(x)),g=h[0],p=h[1],v=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),m=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(ho(i,f,"0",v,w,{color:m}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}MG.toolName="CircleScissor";class RG extends r0{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:iB,ERASE_INSIDE:oB},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,r),this.preMouseDownCallback=n=>{if(this.isDrawing===!0)return;this.doneEditMemo();const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=o.canvas,l=we(a),{viewport:f}=l;this.isDrawing=!0;const u=f.getCamera(),{viewPlaneNormal:d,viewUp:h}=u,g=Du(f.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,v=Po(p),w=u0(p),m=qc(f.id,p,v);this.isDrawing=!0;const y={metadata:{viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:f.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:m},data:{invalidated:!0,handles:{points:[[...s],[...s],[...s],[...s]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},x=[f.id];this.editData={annotation:y,centerCanvas:c,segmentIndex:v,segmentationId:p,segmentsLocked:w,segmentColor:m,toolGroupId:this.toolGroupId,viewportIdsToRender:x,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null};const{representationData:C}=jt(p),S=C[ht.Labelmap];if(f instanceof Xn){const{volumeId:T}=S,_=ke.getVolume(T);this.editData={...this.editData,volumeId:T,referencedVolumeId:_.referencedVolumeId}}else this.editData={...this.editData};return this._activateDraw(a),Tt(a),n.preventDefault(),Me(x),!0},this._dragCallback=n=>{this.isDrawing=!0;const i=n.detail,{element:o}=i,{currentPoints:a}=i,s=a.canvas,c=we(o),{renderingEngine:l,viewport:f}=c,{canvasToWorld:u}=f,{annotation:d,viewportIdsToRender:h,centerCanvas:g}=this.editData,{data:p}=d,v=Math.abs(s[0]-g[0]),w=Math.abs(s[1]-g[1]),m=Math.sqrt(v*v+w*w),y=[g[0],g[1]+m],x=[g[0],g[1]-m],C=[g[0]-m,g[1]],S=[g[0]+m,g[1]];p.handles.points=[u(y),u(x),u(C),u(S)],d.invalidated=!0,this.editData.hasMoved=!0,Me(h)},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,newAnnotation:s,hasMoved:c,segmentIndex:l,segmentsLocked:f}=this.editData,{data:u}=a,{viewPlaneNormal:d,viewUp:h}=a.metadata;if(s&&!c)return;a.highlighted=!1,u.handles.activeHandleIndex=null,this._deactivateDraw(o),Ut(o);const g=we(o),p={...this.editData,points:u.handles.points,segmentIndex:l,segmentsLocked:f,viewPlaneNormal:d,viewUp:h,createMemo:this.createMemo.bind(this)};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(g,p),this.doneEditMemo()},this._activateDraw=n=>{n.addEventListener(U.MOUSE_UP,this._endCallback),n.addEventListener(U.MOUSE_DRAG,this._dragCallback),n.addEventListener(U.MOUSE_CLICK,this._endCallback),n.addEventListener(U.MOUSE_MOVE,this._dragCallback),n.addEventListener(U.TOUCH_END,this._endCallback),n.addEventListener(U.TOUCH_TAP,this._endCallback),n.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=n=>{n.removeEventListener(U.MOUSE_UP,this._endCallback),n.removeEventListener(U.MOUSE_DRAG,this._dragCallback),n.removeEventListener(U.MOUSE_CLICK,this._endCallback),n.removeEventListener(U.MOUSE_MOVE,this._dragCallback),n.removeEventListener(U.TOUCH_END,this._endCallback),n.removeEventListener(U.TOUCH_DRAG,this._dragCallback),n.removeEventListener(U.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(n,i)=>{let o=!1;if(!this.editData)return o;const{viewport:a}=n,{viewportIdsToRender:s}=this.editData;if(!s.includes(a.id))return o;const{annotation:c}=this.editData,l=c.metadata,f=c.annotationUID,u=c.data,{points:d}=u.handles,h=d.map(x=>a.worldToCanvas(x)),g=h[0],p=h[1],v=[Math.floor((g[0]+p[0])/2),Math.floor((g[1]+p[1])/2)],w=Math.abs(g[1]-Math.floor((g[1]+p[1])/2)),m=`rgb(${l.segmentColor.slice(0,3)})`;return a.getRenderingEngine()?(ho(i,f,"0",v,w,{color:m}),o=!0,o):(console.warn("Rendering Engine has been destroyed"),o)}}}RG.toolName="SphereScissor";const{transformWorldToIndex:Kh}=cn;class PG extends Bp{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!1,getTextLines:DCe,statsCalculator:wa,showTextBox:!1}}){super(e,r),this.isHandleOutsideImage=!1,this.addNewAnnotation=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l,renderingEngine:f}=c;this.isDrawing=!0;const u=l.getCamera(),{viewPlaneNormal:d,viewUp:h}=u;let g,p,v;if(l instanceof Jn)throw new Error("Stack Viewport Not implemented");{const T=this.getTargetId(l);v=Zs(T),p=ke.getVolume(v),g=$c(p,s,d)}const w=Su(p,d),m=this._getStartCoordinate(s,w,d),y=this._getEndCoordinate(s,w,d),x=l.getFrameOfReferenceUID(),C={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...h],FrameOfReferenceUID:x,referencedImageId:g,volumeId:v,spacingInNormal:w,enabledElement:c},data:{label:"",startCoordinate:m,endCoordinate:y,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...s],[...s]],activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(C,p),Zt(C,a);const S=pt(a,this.getToolName());return this.editData={annotation:C,viewportIdsToRender:S,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),Tt(a),n.preventDefault(),Me(S),C},this._endCallback=n=>{const i=n.detail,{element:o}=i,{annotation:a,viewportIdsToRender:s,newAnnotation:c,hasMoved:l}=this.editData,{data:f}=a;if(c&&!l)return;a.highlighted=!1,f.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),Ut(o);const u=we(o);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(a.annotationUID);const d=this.getTargetId(u.viewport),h=ke.getVolume(d.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(a,h,d,u),Me(s),c&&Bn(a)},this.renderAnnotation=(n,i)=>{let o=!1;const{viewport:a}=n;let s=sn(this.getToolName(),a.element);if(!(s!=null&&s.length))return o;s=V5(s,a.getCamera());const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u,data:d,metadata:h}=f,{startCoordinate:g,endCoordinate:p}=d,{points:v,activeHandleIndex:w}=d.handles;c.annotationUID=u;const m=this.getStyle("lineWidth",c,f),y=this.getStyle("lineDash",c,f),x=this.getStyle("color",c,f),C=v.map(de=>a.worldToCanvas(de)),S=C[0],T=ou(C),{centerPointRadius:_}=this.configuration,E=yd(C),D=a.getCamera().focalPoint,b=a.getCamera().viewPlaneNormal;let I=g,R=p;Array.isArray(g)&&(I=this._getCoordinateForViewplaneNormal(I,b),d.startCoordinate=I),Array.isArray(p)&&(R=this._getCoordinateForViewplaneNormal(R,b),d.endCoordinate=R);const M=Kl(d.startCoordinate),P=Kl(d.endCoordinate),k=this._getCoordinateForViewplaneNormal(D,b),z=Kl(k);if(z<Math.min(M,P)||z>Math.max(M,P))continue;const A=Kl((d.startCoordinate+d.endCoordinate)/2);let L=!1;if(z===A&&(L=!0),d.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(b)]=A,f.invalidated&&this._throttledCalculateCachedStats(f,n),!a.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),o;let N;if(!ti(u))continue;!jr(u)&&!this.editData&&w!==null&&L&&(N=[C[w]]),N&&Kn(i,u,"0",N,{color:x});let H=m,ee=y;L?(H=m,ee=[]):ee=[5,5];const oe="0";if(ho(i,u,oe,S,T,{color:x,lineDash:ee,lineWidth:H}),_>0&&T>3*_&&ho(i,u,`${oe}-center`,S,_,{color:x,lineDash:y,lineWidth:m}),o=!0,this.configuration.showTextBox==!0&&this.configuration.calculatePointsInsideVolume==!0){const de=this.getLinkedTextBoxStyle(c,f);if(!de.visibility){d.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const ue=this.configuration.getTextLines(d,{metadata:h});if(!ue||ue.length===0)continue;let me;d.handles.textBox.hasMoved||(me=Jo(E),d.handles.textBox.worldPosition=a.canvasToWorld(me));const Ee=a.worldToCanvas(d.handles.textBox.worldPosition),Ce=to(i,u,"1",ue,Ee,C,{},de),{x:F,y:O,width:$,height:W}=Ce;d.handles.textBox.worldBoundingBox={topLeft:a.canvasToWorld([F,O]),topRight:a.canvasToWorld([F+$,O]),bottomLeft:a.canvasToWorld([F,O+W]),bottomRight:a.canvasToWorld([F+$,O+W])}}}return o},this._throttledCalculateCachedStats=eo(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,r){const{data:n,metadata:i}=e,{viewPlaneNormal:o,spacingInNormal:a}=i,{imageData:s}=r,{startCoordinate:c,endCoordinate:l}=n,{points:f}=n.handles,u=Kh(s,f[0]),d=Kh(s,f[0]),h=pa(f),g=Ae();s.indexToWorldVec3(u,g);const p=Ae();s.indexToWorldVec3(d,p),this._getIndexOfCoordinatesForViewplaneNormal(o)==2?(g[2]=c,p[2]=l,h[0][2]=c,h[1][2]=c):this._getIndexOfCoordinatesForViewplaneNormal(o)==0?(g[0]=c,p[0]=l,h[0][0]=c,h[1][0]=c):this._getIndexOfCoordinatesForViewplaneNormal(o)==1&&(g[1]=c,p[1]=l,h[0][1]=c,h[1][1]=c);const v=li(g,p),w=[];for(let m=0;m<v;m+=a)w.push(h.map(y=>{const x=Ae();return Xt(x,y,o,m),Array.from(x)}));n.cachedStats.projectionPoints=w}_computePointsInsideVolume(e,r,n,i){var D,b,I;const{data:o,metadata:a}=e,{viewPlaneNormal:s,viewUp:c}=a,{viewport:l}=i,f=o.cachedStats.projectionPoints,u=[[]],d=this.getTargetImageData(n),h=o.handles.points.map(R=>l.worldToCanvas(R)),[g,p]=yd(h),v=l.canvasToWorld(g),w=l.canvasToWorld(p),{worldWidth:m,worldHeight:y}=X5(s,c,v,w),x=Ko(d,o.handles),C=T4(d),S=Math.abs(Math.PI*(m/x.scale/2)*(y/C/x.scale/2)),T={isPreScaled:ec(l,n),isSuvScaled:this.isSuvScaled(l,n,e.metadata.referencedImageId)},_=Eu(a.Modality,e.metadata.referencedImageId,T);for(let R=0;R<f.length;R++){if(!r)continue;const M=f[R][0],P=f[R].map(Ce=>l.worldToCanvas(Ce)),[k,z]=yd(P),A=l.canvasToWorld(k),L=l.canvasToWorld(z),N=A,H=L,{dimensions:ee,imageData:oe,voxelManager:de}=r,ue=Kh(oe,N),me=Kh(oe,M),Ee=this._getIndexOfCoordinatesForViewplaneNormal(s);ue[0]=Math.floor(ue[0]),ue[1]=Math.floor(ue[1]),ue[2]=Math.floor(ue[2]),ue[Ee]=me[Ee];const _e=Kh(oe,H);if(_e[0]=Math.floor(_e[0]),_e[1]=Math.floor(_e[1]),_e[2]=Math.floor(_e[2]),_e[Ee]=me[Ee],this._isInsideVolume(ue,_e,ee)){const Ce=Math.min(ue[0],_e[0]),F=Math.max(ue[0],_e[0]),O=Math.min(ue[1],_e[1]),$=Math.max(ue[1],_e[1]),W=Math.min(ue[2],_e[2]),X=Math.max(ue[2],_e[2]),Z=[[Ce,F],[O,$],[W,X]],xe={center:M,xRadius:Math.abs(A[0]-L[0])/2,yRadius:Math.abs(A[1]-L[1])/2,zRadius:Math.abs(A[2]-L[2])/2},Ie=de.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:Le=>N5(xe,Le),boundsIJK:Z,imageData:oe,returnPoints:this.configuration.storePointData});u.push(Ie)}}const E=this.configuration.statsCalculator.getStatistics();o.cachedStats.pointsInVolume=u,o.cachedStats.statistics={Modality:a.Modality,area:S,mean:(D=E.mean)==null?void 0:D.value,stdDev:(b=E.stdDev)==null?void 0:b.value,max:(I=E.max)==null?void 0:I.value,statsArray:E.array,areaUnit:x.areaUnit,modalityUnit:_}}_calculateCachedStatsTool(e,r){const n=e.data,{viewport:i}=r,{cachedStats:o}=n,a=this.getTargetId(i),s=ke.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,s,a,r),e.invalidated=!1,qn(e,i.element),o}_getStartCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=Math.round(i/2),a=Ae();return Xt(a,e,n,o*-r),this._getCoordinateForViewplaneNormal(a,n)}_getEndCoordinate(e,r,n){const i=this.configuration.numSlicesToPropagate,o=i-Math.round(i/2),a=Ae();return Xt(a,e,n,o*r),this._getCoordinateForViewplaneNormal(a,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const r=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return r.indexOf(Math.max(...r))}_getCoordinateForViewplaneNormal(e,r){const n=this._getIndexOfCoordinatesForViewplaneNormal(r);return e[n]}}function DCe(t,e={}){const r=t.cachedStats.statistics,{area:n,mean:i,max:o,stdDev:a,areaUnit:s,modalityUnit:c}=r;if(i===void 0)return;const l=[];return l.push(`Area: ${Kt(n)} ${s}`),l.push(`Mean: ${Kt(i)} ${c}`),l.push(`Max: ${Kt(o)} ${c}`),l.push(`Std Dev: ${Kt(a)} ${c}`),l}PG.toolName="CircleROIStartEndThreshold";const{transformWorldToIndex:Ib,isEqual:I3}=cn;class LG extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"]}){super(e,r),this.preMouseDownCallback=n=>{const i=n.detail,{currentPoints:o,element:a}=i,s=o.world,c=we(a),{viewport:l}=c,f=l.getCamera(),{viewPlaneNormal:u}=f,d=Du(l.id);if(!d)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:h}=d,g=Po(h),p=u0(h),{representationData:v}=jt(h);let w,m,y,x;if(this.doneEditMemo(),l instanceof Xn){const{volumeId:P}=v[ht.Labelmap],k=ke.getVolume(P);({dimensions:w,direction:m}=k),x=k.voxelManager,y=Ib(k.imageData,s)}else{const P=qo(l.id,h);if(!P)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const{imageData:k}=l.getImageData();w=k.getDimensions(),m=k.getDirection(),x=ke.getImage(P).voxelManager,y=Ib(k,s)}const C=this.getFixedDimension(u,m);if(C===void 0){console.warn("Oblique paint fill not yet supported");return}const{floodFillGetter:S,getLabelValue:T,getScalarDataPositionFromPlane:_,inPlaneSeedPoint:E,fixedDimensionValue:D}=this.generateHelpers(x,w,y,C);if(y[0]<0||y[0]>=w[0]||y[1]<0||y[1]>=w[1]||y[2]<0||y[2]>=w[2])return;const b=T(y[0],y[1],y[2]);if(p.includes(b))return;const I=JU(S,E),{flooded:R}=I;R.forEach(P=>{const k=_(P[0],P[1]);x.setAtIndex(k,g)});const M=this.getFramesModified(C,D,I);return Ai(h,M),!0},this.getFramesModified=(n,i,o)=>{const{flooded:a}=o;if(n===2)return[i];let s=1/0,c=-1/0;for(let f=0;f<a.length;f++){const u=a[f][1];u<s&&(s=u),u>c&&(c=u)}const l=[];for(let f=s;f<=c;f++)l.push(f);return l},this.generateHelpers=(n,i,o,a=2)=>{let s,c;switch(a){case 0:s=o[0],c=[o[1],o[2]];break;case 1:s=o[1],c=[o[0],o[2]];break;case 2:s=o[2],c=[o[0],o[1]];break;default:throw new Error(`Invalid fixedDimension: ${a}`)}const l=(h,g,p)=>n.toIndex([h,g,p]),f=(h,g,p)=>n.getAtIJK(h,g,p),u=this.generateFloodFillGetter(i,a,s,f);return{getScalarDataPositionFromPlane:this.generateGetScalarDataPositionFromPlane(l,a,s),getLabelValue:f,floodFillGetter:u,inPlaneSeedPoint:c,fixedDimensionValue:s}},this.generateFloodFillGetter=(n,i,o,a)=>{let s;switch(i){case 0:s=(c,l)=>{if(!(c>=n[1]||c<0||l>=n[2]||l<0))return a(o,c,l)};break;case 1:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[2]||l<0))return a(c,o,l)};break;case 2:s=(c,l)=>{if(!(c>=n[0]||c<0||l>=n[1]||l<0))return a(c,l,o)};break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return s},this.generateGetScalarDataPositionFromPlane=(n,i,o)=>{let a;switch(i){case 0:a=(s,c)=>n(o,s,c);break;case 1:a=(s,c)=>n(s,o,c);break;case 2:a=(s,c)=>n(s,c,o);break;default:throw new Error(`Invalid fixedDimension: ${i}`)}return a}}getFixedDimension(e,r){const n=r.slice(0,3),i=r.slice(3,6),o=r.slice(6,9),a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],s=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(I3(a,s))return 0;const c=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];if(I3(a,c))return 1;const l=[Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2])];if(I3(a,l))return 2}}LG.toolName="PaintFill";const bCe={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};var u8={Corners:bCe};const{vtkErrorMacro:O3}=K,{Corners:zm}=u8;function ICe(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const r={...t},n=[],i=PP.newInstance(),o=new ResizeObserver(d=>{t.updateViewport()});let a=null,s=null,c=null,l=null,f=null;function u(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const d=e.parentRenderer||e._interactor.getCurrentRenderer(),[h,g,p,v]=d.getViewport(),w=e._interactor.getView(),m=w.getSize(),[y,x]=w.getViewportSize(d),C=Math.min(y,x);let S=e.viewportSize*C;S=Math.max(Math.min(e.minPixelSize,C),Math.min(e.maxPixelSize,S));const T=S/m[0],_=S/m[1];switch(e.viewportCorner){case zm.TOP_LEFT:return[h,v-_,h+T,v];case zm.TOP_RIGHT:return[p-T,v-_,p,v];case zm.BOTTOM_LEFT:return[h,g,h+T,g+_];case zm.BOTTOM_RIGHT:return[p-T,g,p,g+_];default:return O3("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(i.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const h=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!h)return;const g=h.getReferenceByName("position"),p=h.getReferenceByName("focalPoint"),v=h.getReferenceByName("viewUp");if(n[0]!==g[0]||n[1]!==g[1]||n[2]!==g[2]||n[3]!==p[0]||n[4]!==p[1]||n[5]!==p[2]||n[6]!==v[0]||n[7]!==v[1]||n[8]!==v[2]){n[0]=g[0],n[1]=g[1],n[2]=g[2],n[3]=p[0],n[4]=p[1],n[5]=p[2],n[6]=v[0],n[7]=v[1],n[8]=v[2];const w=i.getActiveCamera();w.setPosition(g[0],g[1],g[2]),w.setFocalPoint(p[0],p[1],p[2]),w.setViewUp(v[0],v[1],v[2]),i.resetCamera()}},t.setEnabled=d=>{var h,g;if(d){if(e.enabled)return;if(!e.actor){O3("Must set actor before enabling orientation marker.");return}if(!e._interactor){O3("Must set interactor before enabling orientation marker.");return}const p=e.parentRenderer||e._interactor.getCurrentRenderer(),v=p.getRenderWindow();v.addRenderer(i),v.getNumberOfLayers()<2&&v.setNumberOfLayers(2),i.setLayer(v.getNumberOfLayers()-1),i.setInteractive(e.interactiveRenderer),i.addViewProp(e.actor),e.actor.setVisibility(!0),a=p.onEvent(w=>{w.type==="ActiveCameraEvent"&&(s&&s.unsubscribe(),s=w.camera.onModified(u))}),s=p.getActiveCamera().onModified(u),c=e._interactor.onAnimation(t.updateMarkerOrientation),l=e._interactor.onEndAnimation(t.updateMarkerOrientation),o.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,o.disconnect(),a.unsubscribe(),a=null,s.unsubscribe(),s=null,c.unsubscribe(),c=null,l.unsubscribe(),l=null,e.actor.setVisibility(!1),i.removeViewProp(e.actor);const p=(g=(h=e._interactor)==null?void 0:h.findPokedRenderer())==null?void 0:g.getRenderWindow();p&&p.removeRenderer(i)}t.modified()},t.setViewportCorner=d=>{d!==e.viewportCorner&&(e.viewportCorner=d,t.updateViewport())},t.setViewportSize=d=>{const h=Math.min(1,Math.max(0,d));h!==e.viewportSize&&(e.viewportSize=h,t.updateViewport())},t.setActor=d=>{const h=e.enabled;t.setEnabled(!1),e.actor=d,t.setEnabled(h)},t.getRenderer=()=>i,t.delete=()=>{r.delete(),f&&(f.unsubscribe(),f=null),a&&(a.unsubscribe(),a=null),s&&(s.unsubscribe(),s=null),c&&(c.unsubscribe(),c=null),l&&(l.unsubscribe(),l=null),o.disconnect()},f=t.onModified(t.updateViewport)}const OCe={viewportCorner:u8.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function AG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OCe,r),K.obj(t,e),K.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),K.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),K.get(t,e,["actor"]),K.moveToProtected(t,e,["interactor"]),ICe(t,e)}const MCe=K.newInstance(AG,"vtkOrientationMarkerWidget");var Ob={newInstance:MCe,extend:AG,...u8};function NG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0];const[r,n,i,o]=e,s=t.getContext("2d").getImageData(r,n,i||t.width,o||t.height),c=eh.newInstance({type:"vtkImageData"});c.setOrigin(0,0,0),c.setSpacing(1,1,1),c.setExtent(0,(i||t.width)-1,0,(o||t.height)-1,0,0);const l=Lt.newInstance({numberOfComponents:4,values:new Uint8Array(s.data.buffer)});return l.setName("scalars"),c.getPointData().setScalars(l),c}function RCe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{flipX:!1,flipY:!1,rotate:0};const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const n=r.getContext("2d"),{flipX:i,flipY:o,rotate:a}=e;return n.translate(r.width/2,r.height/2),n.scale(i?-1:1,o?-1:1),n.rotate(a*Math.PI/180),n.drawImage(t,-t.width/2,-t.height/2),NG(r)}var PCe={canvasToImageData:NG,imageToImageData:RCe};const kG={default:{defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:t=>t/2,faceColor:"white",edgeThickness:.1,edgeColor:"black",resolution:400},xMinusFaceProperty:{text:"X-",faceColor:"yellow"},xPlusFaceProperty:{text:"X+",faceColor:"yellow"},yMinusFaceProperty:{text:"Y-",faceColor:"red"},yPlusFaceProperty:{text:"Y+",faceColor:"red"},zMinusFaceProperty:{text:"Z-",faceColor:"#008000"},zPlusFaceProperty:{text:"Z+",faceColor:"#008000"}},lps:{xMinusFaceProperty:{text:"R",faceRotation:-90},xPlusFaceProperty:{text:"L",faceRotation:90},yMinusFaceProperty:{text:"A",faceRotation:0},yPlusFaceProperty:{text:"P",faceRotation:180},zMinusFaceProperty:{text:"I",faceRotation:180},zPlusFaceProperty:{text:"S",faceRotation:0}}};function VG(t,e){e.set(t)}function LCe(t,e){return VG(kG[t],e)}function ACe(t,e){kG[t]=e}var NCe={applyDefinitions:VG,applyPreset:LCe,registerStylePreset:ACe};const kCe={xPlus:0,xMinus:1,yPlus:2,yMinus:3,zPlus:4,zMinus:5};function VCe(t,e){e.classHierarchy.push("vtkAnnotatedCubeActor"),e.xPlusFaceProperty={...e.xPlusFaceProperty},e.xMinusFaceProperty={...e.xMinusFaceProperty},e.yPlusFaceProperty={...e.yPlusFaceProperty},e.yMinusFaceProperty={...e.yMinusFaceProperty},e.zPlusFaceProperty={...e.zPlusFaceProperty},e.zMinusFaceProperty={...e.zMinusFaceProperty};let r=null;const n=document.createElement("canvas"),i=js.newInstance(),o=l1.newInstance();o.setInterpolate(!0);function a(c){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;l&&Object.assign(e[`${c}FaceProperty`],l);const f={...e.defaultStyle,...e[`${c}FaceProperty`]};n.width=f.resolution,n.height=f.resolution;const u=n.getContext("2d");u.fillStyle=f.faceColor,u.fillRect(0,0,n.width,n.height),f.edgeThickness>0&&(u.strokeStyle=f.edgeColor,u.lineWidth=f.edgeThickness*n.width,u.strokeRect(0,0,n.width,n.height)),u.save(),u.translate(0,n.height),u.scale(1,-1),u.translate(n.width/2,n.height/2),u.rotate(-Math.PI*(f.faceRotation/180));const d=f.fontSizeScale(f.resolution);u.fillStyle=f.fontColor,u.textAlign="center",u.textBaseline="middle",u.font=`${f.fontStyle} ${d}px "${f.fontFamily}"`,u.fillText(f.text,0,0),u.restore();const h=PCe.canvasToImageData(n);o.setInputData(h,kCe[c]),t.modified()}function s(){r=RL.newInstance({generate3DTextureCoordinates:!0}),i.setInputConnection(r.getOutputPort()),a("xPlus"),a("xMinus"),a("yPlus"),a("yMinus"),a("zPlus"),a("zMinus")}t.setDefaultStyle=c=>{e.defaultStyle={...e.defaultStyle,...c},s()},t.setXPlusFaceProperty=c=>a("xPlus",c),t.setXMinusFaceProperty=c=>a("xMinus",c),t.setYPlusFaceProperty=c=>a("yPlus",c),t.setYMinusFaceProperty=c=>a("yMinus",c),t.setZPlusFaceProperty=c=>a("zPlus",c),t.setZMinusFaceProperty=c=>a("zMinus",c),s(),i.setInputConnection(r.getOutputPort()),t.setMapper(i),t.addTexture(o)}const FCe={defaultStyle:{text:"",faceColor:"white",faceRotation:0,fontFamily:"Arial",fontColor:"black",fontStyle:"normal",fontSizeScale:t=>t/1.8,edgeThickness:.1,edgeColor:"black",resolution:200}};function FG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FCe,r),qs.extend(t,e,r),K.get(t,e,["defaultStyle","xPlusFaceProperty","xMinusFaceProperty","yPlusFaceProperty","yMinusFaceProperty","zPlusFaceProperty","zMinusFaceProperty"]),VCe(t,e)}const UCe=K.newInstance(FG,"vtkAnnotatedCubeActor");var Mb={newInstance:UCe,extend:FG,Presets:NCe};const{vtkErrorMacro:BCe}=K;function GCe(t,e){let r=0;return t.map((n,i)=>i===r?(r+=n+1,n):n+e)}function $m(t,e,r,n){t.set(GCe(e,r),n)}function WCe(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(r,n)=>{const i=t.getNumberOfInputPorts();if(!i){BCe("No input specified.");return}if(i===1){n[0]=r[0];return}const o=Qr.newInstance();let a=0,s=0,c=1,l=1,f=0,u=0,d=0,h=0,g=!0,p=!0,v=!0;for(let b=0;b<i;b++){const I=r[b];if(!I)continue;const R=I.getPoints().getNumberOfPoints();a+=R,f+=I.getVerts().getNumberOfValues(),u+=I.getLines().getNumberOfValues(),d+=I.getStrips().getNumberOfValues(),h+=I.getPolys().getNumberOfValues(),R&&(l&&(l=0,s=I.getPoints().getDataType()),c=I.getPoints().getDataType(),s=s>c?s:c);const M=I.getPointData();M?(g=g&&M.getNormals()!==null,p=p&&M.getTCoords()!==null,v=v&&M.getScalars()!==null):(g=!1,p=!1,v=!1)}e.outputPointsPrecision===vv.SINGLE?s=Ht.FLOAT:e.outputPointsPrecision===vv.DOUBLE&&(s=Ht.DOUBLE);const w=gp.newInstance({dataType:s});w.setNumberOfPoints(a);const m=w.getData(),y=new Uint32Array(f),x=new Uint32Array(u),C=new Uint32Array(d),S=new Uint32Array(h);let T=null,_=null,E=null;const D=r[i-1];if(g){const b=D.getPointData().getNormals();T=Lt.newInstance({numberOfComponents:3,numberOfTuples:a,size:3*a,dataType:b.getDataType(),name:b.getName()})}if(p){const b=D.getPointData().getTCoords();_=Lt.newInstance({numberOfComponents:2,numberOfTuples:a,size:2*a,dataType:b.getDataType(),name:b.getName()})}if(v){const b=D.getPointData().getScalars();E=Lt.newInstance({numberOfComponents:b.getNumberOfComponents(),numberOfTuples:a,size:a*b.getNumberOfComponents(),dataType:b.getDataType(),name:b.getName()})}a=0,f=0,u=0,d=0,h=0;for(let b=0;b<i;b++){const I=r[b];m.set(I.getPoints().getData(),a*3),$m(y,I.getVerts().getData(),a,f),f+=I.getVerts().getNumberOfValues(),$m(x,I.getLines().getData(),a,u),u+=I.getLines().getNumberOfValues(),$m(C,I.getStrips().getData(),a,d),d+=I.getStrips().getNumberOfValues(),$m(S,I.getPolys().getData(),a,h),h+=I.getPolys().getNumberOfValues();const R=I.getPointData();if(g){const M=R.getNormals();T.getData().set(M.getData(),a*3)}if(p){const M=R.getTCoords();_.getData().set(M.getData(),a*2)}if(v){const M=R.getScalars();E.getData().set(M.getData(),a*E.getNumberOfComponents())}a+=I.getPoints().getNumberOfPoints()}o.setPoints(w),o.getVerts().setData(y),o.getLines().setData(x),o.getStrips().setData(C),o.getPolys().setData(S),T&&o.getPointData().setNormals(T),_&&o.getPointData().setTCoords(_),E&&o.getPointData().setScalars(E),n[0]=o}}const zCe={outputPointsPrecision:vv.DEFAULT};function UG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zCe,r),K.setGet(t,e,["outputPointsPrecision"]),K.obj(t,e),K.algo(t,e,1,1),WCe(t,e)}const $Ce=K.newInstance(UG,"vtkAppendPolyData");var BG={newInstance:$Ce,extend:UG};function jCe(t,e){e.classHierarchy.push("vtkConeSource");function r(n,i){if(e.deleted)return;let o=i[0];const a=2*Math.PI/e.resolution,s=-e.height/2,c=e.resolution+1,l=4*e.resolution+1+e.resolution;let f=0;const u=K.newTypedArray(e.pointType,c*3);let d=0;const h=new Uint32Array(l);u[0]=e.height/2,u[1]=0,u[2]=0,e.capping&&(h[d++]=e.resolution);for(let g=0;g<e.resolution;g++)f++,u[f*3+0]=s,u[f*3+1]=e.radius*Math.cos(g*a),u[f*3+2]=e.radius*Math.sin(g*a),e.capping&&(h[e.resolution-d+++1]=f);for(let g=0;g<e.resolution;g++)h[d++]=3,h[d++]=0,h[d++]=g+1,h[d++]=g+2>e.resolution?1:g+2;wi.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(u),o=Qr.newInstance(),o.getPoints().setData(u,3),o.getPolys().setData(h,1),i[0]=o}t.requestData=r}const HCe={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function GG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HCe,r),K.obj(t,e),K.setGet(t,e,["height","radius","resolution","capping"]),K.setGetArray(t,e,["center","direction"],3),K.algo(t,e,0,1),jCe(t,e)}const KCe=K.newInstance(GG,"vtkConeSource");var qCe={newInstance:KCe,extend:GG};function XCe(t,e){e.classHierarchy.push("vtkCylinderSource");function r(n,i){if(e.deleted)return;let o=i[0];const a=2*Math.PI/e.resolution;let s=2*e.resolution,c=5*e.resolution;e.capping&&(s=4*e.resolution,c=7*e.resolution+2);const l=K.newTypedArray(e.pointType,s*3);let f=0;const u=new Uint32Array(c),d=new Float32Array(s*3),h=Lt.newInstance({numberOfComponents:3,values:d,name:"Normals"}),g=new Float32Array(s*2),p=Lt.newInstance({numberOfComponents:2,values:g,name:"TCoords"}),v=[0,0,0],w=[0,0,0],m=[0,0,0],y=[0,0,0],x=[0,0],C=[0,0],S=e.otherRadius==null?e.radius:e.otherRadius;for(let T=0;T<e.resolution;T++){v[0]=Math.cos(T*a+e.initAngle),w[0]=v[0],m[0]=e.radius*v[0]+e.center[0],y[0]=m[0],x[0]=Math.abs(2*T/e.resolution-1),C[0]=x[0],m[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],x[1]=0,C[1]=1,v[2]=-Math.sin(T*a+e.initAngle),w[2]=v[2],m[2]=S*v[2]+e.center[2],y[2]=m[2];const _=2*T;for(let E=0;E<3;E++)d[_*3+E]=v[E],d[(_+1)*3+E]=w[E],l[_*3+E]=m[E],l[(_+1)*3+E]=y[E],E<2&&(g[_*2+E]=x[E],g[(_+1)*2+E]=C[E])}for(let T=0;T<e.resolution;T++){u[f++]=4,u[f++]=2*T,u[f++]=2*T+1;const _=(2*T+3)%(2*e.resolution);u[f++]=_,u[f++]=_-1}if(e.capping){for(let T=0;T<e.resolution;T++){m[0]=e.radius*Math.cos(T*a+e.initAngle),y[0]=m[0],x[0]=m[0],C[0]=m[0],m[0]+=e.center[0],y[0]+=e.center[0],v[1]=1,w[1]=-1,m[1]=.5*e.height+e.center[1],y[1]=-.5*e.height+e.center[1],m[2]=-S*Math.sin(T*a+e.initAngle),y[2]=m[2],x[1]=m[2],C[1]=m[2],m[2]+=e.center[2],y[2]+=e.center[2];const _=2*e.resolution+T,E=3*e.resolution+e.resolution-T-1;for(let D=0;D<3;D++)d[3*_+D]=v[D],d[3*E+D]=w[D],l[3*_+D]=m[D],l[3*E+D]=y[D],D<2&&(g[2*_+D]=x[D],g[2*E+D]=C[D])}u[f++]=e.resolution;for(let T=0;T<e.resolution;T++)u[f++]=2*e.resolution+T;u[f++]=e.resolution;for(let T=0;T<e.resolution;T++)u[f++]=3*e.resolution+T}wi.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(T=>T*-1)).apply(l),o=Qr.newInstance(),o.getPoints().setData(l,3),o.getPolys().setData(u,1),o.getPointData().setNormals(h),o.getPointData().setTCoords(p),i[0]=o}t.requestData=r}const YCe={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function WG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YCe,r),K.obj(t,e),K.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),K.setGetArray(t,e,["center","direction"],3),K.algo(t,e,0,1),XCe(t,e)}const JCe=K.newInstance(WG,"vtkCylinderSource");var ZCe={newInstance:JCe,extend:WG};function QCe(t,e){e.classHierarchy.push("vtkArrowSource");function r(n,i){if(e.deleted)return;const o=ZCe.newInstance({capping:!0});o.setResolution(e.shaftResolution),o.setRadius(e.shaftRadius),o.setHeight(1-e.tipLength),o.setCenter(0,(1-e.tipLength)*.5,0);const a=o.getOutputData(),s=a.getPoints().getData(),c=a.getPointData().getNormals().getData();wi.buildFromDegree().rotateZ(-90).apply(s).apply(c);const l=qCe.newInstance();l.setResolution(e.tipResolution),l.setHeight(e.tipLength),l.setRadius(e.tipRadius);const f=l.getOutputData(),u=f.getPoints().getData();wi.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(u);const d=BG.newInstance();d.setInputData(a),d.addInputData(f);const h=d.getOutputData(),g=h.getPoints().getData();wi.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(g),e.invert?(wi.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(g),i[0]=h):(wi.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(g),i[0]=d.getOutputData())}t.requestData=r}const eSe={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function zG(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eSe,r),K.obj(t,e),K.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),K.setGetArray(t,e,["direction"],3),K.algo(t,e,0,1),QCe(t,e)}const tSe=K.newInstance(zG,"vtkArrowSource");var M3={newInstance:tSe,extend:zG};function R3(t){const e=t.getPoints().getBounds(),r=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];wi.buildFromDegree().translate(...r).apply(t.getPoints().getData())}function P3(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=t.getPoints().getBounds(),i=[0,0,0];r?i[e]=-n[e*2+1]:i[e]=-n[e*2],wi.buildFromDegree().translate(...i).apply(t.getPoints().getData())}function L3(t,e,r,n){const i=t.getPoints().getData().length,o=new Uint8ClampedArray(i);let a=0;for(;a<i;)o[a++]=e,o[a++]=r,o[a++]=n;t.getPointData().setScalars(Lt.newInstance({name:"color",numberOfComponents:3,values:o}))}function nSe(t,e){e.classHierarchy.push("vtkAxesActor");const r=js.newInstance();t.setMapper(r),t.update=()=>{let i={...e.config,...e.xConfig};const o=M3.newInstance({direction:[1,0,0],...i}).getOutputData();e.config.recenter?R3(o):P3(o,0,i.invert),L3(o,...i.color),i={...e.config,...e.yConfig};const a=M3.newInstance({direction:[0,1,0],...i}).getOutputData();e.config.recenter?R3(a):P3(a,1,i.invert),L3(a,...i.color),i={...e.config,...e.zConfig};const s=M3.newInstance({direction:[0,0,1],...i}).getOutputData();e.config.recenter?R3(s):P3(s,2,i.invert),L3(s,...i.color);const c=BG.newInstance();c.setInputData(o),c.addInputData(a),c.addInputData(s),r.setInputConnection(c.getOutputPort())},t.update();const n=K.debounce(t.update,0);t.setXAxisColor=i=>t.setXConfig({...t.getXConfig(),color:i}),t.setYAxisColor=i=>t.setYConfig({...t.getYConfig(),color:i}),t.setZAxisColor=i=>t.setZConfig({...t.getZConfig(),color:i}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=n,e._onXConfigChanged=n,e._onYConfigChanged=n,e._onZConfigChanged=n}function rSe(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t==null?void 0:t.config},xConfig:{color:[255,0,0],invert:!1,...t==null?void 0:t.xConfig},yConfig:{color:[255,255,0],invert:!1,...t==null?void 0:t.yConfig},zConfig:{color:[0,128,0],invert:!1,...t==null?void 0:t.zConfig}}}function $G(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};qs.extend(t,e,rSe(r)),K.setGet(t,e,["config","xConfig","yConfig","zConfig"]),nSe(t,e)}const iSe=K.newInstance($G,"vtkAxesActor");var oSe={newInstance:iSe,extend:$G},jG={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(yi,function(){return function(r){var n={};function i(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return r[o].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=r,i.c=n,i.d=function(o,a,s){i.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:s})},i.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.t=function(o,a){if(1&a&&(o=i(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var c in o)i.d(s,c,(function(l){return o[l]}).bind(null,c));return s},i.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return i.d(a,"a",a),a},i.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},i.p="",i(i.s=184)}([function(r,n,i){function o(a){for(var s in a)n.hasOwnProperty(s)||(n[s]=a[s])}Object.defineProperty(n,"__esModule",{value:!0}),o(i(240)),o(i(251)),o(i(175)),o(i(107)),o(i(29)),o(i(73)),o(i(106)),o(i(30)),o(i(252)),o(i(52)),o(i(97)),o(i(253)),o(i(37)),o(i(51)),o(i(173)),o(i(176)),o(i(172)),o(i(108)),o(i(254)),o(i(255)),o(i(256)),o(i(72)),o(i(177)),o(i(105)),o(i(17)),o(i(257)),o(i(12)),o(i(174))},function(r,n,i){var o=this&&this.__values||function(y){var x=typeof Symbol=="function"&&Symbol.iterator,C=x&&y[x],S=0;if(C)return C.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&S>=y.length&&(y=void 0),{value:y&&y[S++],done:!y}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(212);n.FixedSizeSet=a.FixedSizeSet;var s=i(213);n.ObjectCache=s.ObjectCache;var c=i(214);n.CompareCache=c.CompareCache;var l=i(215);n.Lazy=l.Lazy;var f=i(216);function u(y,x,C){if(w(y))y.forEach(function(T,_){return x.call(C,_,T)});else for(var S in y)y.hasOwnProperty(S)&&x.call(C,S,y[S])}function d(y){var x,C;if(h(y))return y;if(p(y)){var S=[];try{for(var T=o(y),_=T.next();!_.done;_=T.next()){var E=_.value;S.push(d(E))}}catch(I){x={error:I}}finally{try{_&&!_.done&&(C=T.return)&&C.call(T)}finally{if(x)throw x.error}}return S}if(g(y)){S={};for(var D in y)if(y.hasOwnProperty(D)){var b=y[D];S[D]=d(b)}return S}return y}function h(y){return!!y&&Object.prototype.toString.call(y)==="[object Function]"}function g(y){var x=typeof y;return!!y&&(x==="function"||x==="object")}function p(y){return Array.isArray(y)}function v(y){return y instanceof Set}function w(y){return y instanceof Map}function m(y){if(g(y)){var x=Object.getPrototypeOf(y),C=x.constructor;return x&&C&&typeof C=="function"&&C instanceof C&&Function.prototype.toString.call(C)===Function.prototype.toString.call(Object)}return!1}n.StringWalker=f.StringWalker,n.applyMixin=function(y,x){for(var C=[],S=2;S<arguments.length;S++)C[S-2]=arguments[S];Object.getOwnPropertyNames(x.prototype).forEach(function(T){if(T!=="constructor"){if(C.indexOf(T)!==-1){var _=Object.getOwnPropertyDescriptor(y.prototype,T);_&&Object.defineProperty(y.prototype,"_"+T,_)}var E=Object.getOwnPropertyDescriptor(x.prototype,T);E&&Object.defineProperty(y.prototype,T,E)}})},n.applyDefaults=function y(x,C,S){S===void 0&&(S=!1);var T=d(x||{});return u(C,function(_,E){m(E)?T[_]=y(T[_],E,S):(S||T[_]===void 0)&&(T[_]=E)}),T},n.forEachArray=function(y,x,C){y.forEach(x,C)},n.forEachObject=u,n.arrayLength=function(y){return v(y)?y.size:y.length},n.objectLength=function(y){return w(y)?y.size:Object.keys(y).length},n.getObjectValue=function(y,x){return w(y)?y.get(x):y[x]},n.removeObjectValue=function(y,x){w(y)?y.delete(x):delete y[x]},n.clone=d,n.isBoolean=function(y){return typeof y=="boolean"},n.isNumber=function(y){return typeof y=="number"},n.isString=function(y){return typeof y=="string"},n.isFunction=h,n.isObject=g,n.isArray=p,n.isSet=v,n.isMap=w,n.isEmpty=function(y){if(p(y))return!y.length;if(v(y)||w(y))return!y.size;if(g(y)){for(var x in y)if(y.hasOwnProperty(x))return!1;return!0}return!1},n.isPlainObject=m,n.isIterable=function(y){return y&&typeof y[Symbol.iterator]=="function"},n.getValue=function(y){return h(y.valueOf)?y.valueOf():y},n.utf8Encode=function(y){for(var x=new Uint8Array(4*y.length),C=0,S=0;S<y.length;S++){var T=y.charCodeAt(S);if(T<128)x[C++]=T;else{if(T<2048)x[C++]=T>>6|192;else{if(T>55295&&T<56320){if(++S>=y.length)throw new Error("Incomplete surrogate pair.");var _=y.charCodeAt(S);if(_<56320||_>57343)throw new Error("Invalid surrogate character.");T=65536+((1023&T)<<10)+(1023&_),x[C++]=T>>18|240,x[C++]=T>>12&63|128}else x[C++]=T>>12|224;x[C++]=T>>6&63|128}x[C++]=63&T|128}}return x.subarray(0,C)},n.utf8Decode=function(y){for(var x="",C=0;C<y.length;){var S=y[C++];if(S>127)if(S>191&&S<224){if(C>=y.length)throw new Error("Incomplete 2-byte sequence.");S=(31&S)<<6|63&y[C++]}else if(S>223&&S<240){if(C+1>=y.length)throw new Error("Incomplete 3-byte sequence.");S=(15&S)<<12|(63&y[C++])<<6|63&y[C++]}else{if(!(S>239&&S<248))throw new Error("Unknown multi-byte start.");if(C+2>=y.length)throw new Error("Incomplete 4-byte sequence.");S=(7&S)<<18|(63&y[C++])<<12|(63&y[C++])<<6|63&y[C++]}if(S<=65535)x+=String.fromCharCode(S);else{if(!(S<=1114111))throw new Error("Code point exceeds UTF-16 limit.");S-=65536,x+=String.fromCharCode(S>>10|55296),x+=String.fromCharCode(1023&S|56320)}}return x}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),function(o){o[o.Before=0]="Before",o[o.Equal=1]="Equal",o[o.After=2]="After"}(n.BoundaryPosition||(n.BoundaryPosition={})),function(o){o[o.None=0]="None",o[o.Capturing=1]="Capturing",o[o.AtTarget=2]="AtTarget",o[o.Bubbling=3]="Bubbling"}(n.EventPhase||(n.EventPhase={})),function(o){o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=3]="Text",o[o.CData=4]="CData",o[o.EntityReference=5]="EntityReference",o[o.Entity=6]="Entity",o[o.ProcessingInstruction=7]="ProcessingInstruction",o[o.Comment=8]="Comment",o[o.Document=9]="Document",o[o.DocumentType=10]="DocumentType",o[o.DocumentFragment=11]="DocumentFragment",o[o.Notation=12]="Notation"}(n.NodeType||(n.NodeType={})),function(o){o[o.Disconnected=1]="Disconnected",o[o.Preceding=2]="Preceding",o[o.Following=4]="Following",o[o.Contains=8]="Contains",o[o.ContainedBy=16]="ContainedBy",o[o.ImplementationSpecific=32]="ImplementationSpecific"}(n.Position||(n.Position={})),function(o){o[o.Accept=1]="Accept",o[o.Reject=2]="Reject",o[o.Skip=3]="Skip"}(n.FilterResult||(n.FilterResult={})),function(o){o[o.All=4294967295]="All",o[o.Element=1]="Element",o[o.Attribute=2]="Attribute",o[o.Text=4]="Text",o[o.CDataSection=8]="CDataSection",o[o.EntityReference=16]="EntityReference",o[o.Entity=32]="Entity",o[o.ProcessingInstruction=64]="ProcessingInstruction",o[o.Comment=128]="Comment",o[o.Document=256]="Document",o[o.DocumentType=512]="DocumentType",o[o.DocumentFragment=1024]="DocumentFragment",o[o.Notation=2048]="Notation"}(n.WhatToShow||(n.WhatToShow={})),function(o){o[o.StartToStart=0]="StartToStart",o[o.StartToEnd=1]="StartToEnd",o[o.EndToEnd=2]="EndToEnd",o[o.EndToStart=3]="EndToStart"}(n.HowToCompare||(n.HowToCompare={}))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(241);n.Cast=o.Cast;var a=i(150);n.Guard=a.Guard;var s=i(242);n.EmptySet=s.EmptySet},function(r,n,i){var o=i(11),a=i(55).f,s=i(21),c=i(25),l=i(80),f=i(119),u=i(123);r.exports=function(d,h){var g,p,v,w,m,y=d.target,x=d.global,C=d.stat;if(g=x?o:C?o[y]||l(y,{}):(o[y]||{}).prototype)for(p in h){if(w=h[p],v=d.noTargetGet?(m=a(g,p))&&m.value:g[p],!u(x?p:y+(C?".":"#")+p,d.forced)&&v!==void 0){if(typeof w==typeof v)continue;f(w,v)}(d.sham||v&&v.sham)&&s(w,"sham",!0),c(g,p,w,d)}}},function(r,n,i){var o=i(11),a=i(81),s=i(14),c=i(58),l=i(86),f=i(124),u=a("wks"),d=o.Symbol,h=f?d:d&&d.withoutSetter||c;r.exports=function(g){return s(u,g)||(l&&s(d,g)?u[g]=d[g]:u[g]=h("Symbol."+g)),u[g]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(29),s=function(){function c(){this._features={mutationObservers:!0,customElements:!0,slots:!0,steps:!0},this._window=null,this._compareCache=new o.CompareCache,this._rangeList=new o.FixedSizeSet}return c.prototype.setFeatures=function(l){if(l===void 0&&(l=!0),o.isObject(l))for(var f in l)this._features[f]=l[f]||!1;else for(var f in this._features)this._features[f]=l},Object.defineProperty(c.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"window",{get:function(){return this._window===null&&(this._window=a.create_window()),this._window},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"compareCache",{get:function(){return this._compareCache},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rangeList",{get:function(){return this._rangeList},enumerable:!0,configurable:!0}),Object.defineProperty(c,"instance",{get:function(){return c._instance||(c._instance=new c),c._instance},enumerable:!0,configurable:!0}),c}();n.dom=s.instance},function(r,n,i){var o=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var y={};if(m!=null)for(var x in m)Object.hasOwnProperty.call(m,x)&&(y[x]=m[x]);return y.default=m,y};Object.defineProperty(n,"__esModule",{value:!0});var a=o(i(228));n.base64=a;var s=o(i(146));n.byte=s;var c=o(i(147));n.byteSequence=c;var l=o(i(96));n.codePoint=l;var f=o(i(232));n.json=f;var u=o(i(233));n.list=u;var d=o(i(234));n.map=d;var h=o(i(235));n.namespace=h;var g=o(i(236));n.queue=g;var p=o(i(237));n.set=p;var v=o(i(238));n.stack=v;var w=o(i(239));n.string=w},function(r,n){r.exports=function(i){try{return!!i()}catch{return!0}}},function(r,n,i){var o,a=this&&this.__extends||(o=function(A,L){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,H){N.__proto__=H}||function(N,H){for(var ee in H)H.hasOwnProperty(ee)&&(N[ee]=H[ee])})(A,L)},function(A,L){function N(){this.constructor=A}o(A,L),A.prototype=L===null?Object.create(L):(N.prototype=L.prototype,new N)});Object.defineProperty(n,"__esModule",{value:!0});var s=function(A){function L(N,H){H===void 0&&(H="");var ee=A.call(this,H)||this;return ee.name=N,ee}return a(L,A),L}(Error);n.DOMException=s;var c=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"DOMStringSizeError",N)||this}return a(L,A),L}(s);n.DOMStringSizeError=c;var l=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"WrongDocumentError","The object is in the wrong document. "+N)||this}return a(L,A),L}(s);n.WrongDocumentError=l;var f=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NoDataAllowedError",N)||this}return a(L,A),L}(s);n.NoDataAllowedError=f;var u=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NoModificationAllowedError","The object can not be modified. "+N)||this}return a(L,A),L}(s);n.NoModificationAllowedError=u;var d=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NotSupportedError","The operation is not supported. "+N)||this}return a(L,A),L}(s);n.NotSupportedError=d;var h=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InUseAttributeError",N)||this}return a(L,A),L}(s);n.InUseAttributeError=h;var g=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InvalidStateError","The object is in an invalid state. "+N)||this}return a(L,A),L}(s);n.InvalidStateError=g;var p=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InvalidModificationError","The object can not be modified in this way. "+N)||this}return a(L,A),L}(s);n.InvalidModificationError=p;var v=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NamespaceError","The operation is not allowed by Namespaces in XML. [XMLNS] "+N)||this}return a(L,A),L}(s);n.NamespaceError=v;var w=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InvalidAccessError","The object does not support the operation or argument. "+N)||this}return a(L,A),L}(s);n.InvalidAccessError=w;var m=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"ValidationError",N)||this}return a(L,A),L}(s);n.ValidationError=m;var y=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"TypeMismatchError",N)||this}return a(L,A),L}(s);n.TypeMismatchError=y;var x=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"SecurityError","The operation is insecure. "+N)||this}return a(L,A),L}(s);n.SecurityError=x;var C=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NetworkError","A network error occurred. "+N)||this}return a(L,A),L}(s);n.NetworkError=C;var S=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"AbortError","The operation was aborted. "+N)||this}return a(L,A),L}(s);n.AbortError=S;var T=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"URLMismatchError","The given URL does not match another URL. "+N)||this}return a(L,A),L}(s);n.URLMismatchError=T;var _=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"QuotaExceededError","The quota has been exceeded. "+N)||this}return a(L,A),L}(s);n.QuotaExceededError=_;var E=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"TimeoutError","The operation timed out. "+N)||this}return a(L,A),L}(s);n.TimeoutError=E;var D=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InvalidNodeTypeError","The supplied node is incorrect or has an incorrect ancestor for this operation. "+N)||this}return a(L,A),L}(s);n.InvalidNodeTypeError=D;var b=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"DataCloneError","The object can not be cloned. "+N)||this}return a(L,A),L}(s);n.DataCloneError=b;var I=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NotImplementedError","The DOM method is not implemented by this module. "+N)||this}return a(L,A),L}(s);n.NotImplementedError=I;var R=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"HierarchyRequestError","The operation would yield an incorrect node tree. "+N)||this}return a(L,A),L}(s);n.HierarchyRequestError=R;var M=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"NotFoundError","The object can not be found here. "+N)||this}return a(L,A),L}(s);n.NotFoundError=M;var P=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"IndexSizeError","The index is not in the allowed range. "+N)||this}return a(L,A),L}(s);n.IndexSizeError=P;var k=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"SyntaxError","The string did not match the expected pattern. "+N)||this}return a(L,A),L}(s);n.SyntaxError=k;var z=function(A){function L(N){return N===void 0&&(N=""),A.call(this,"InvalidCharacterError","The string contains invalid characters. "+N)||this}return a(L,A),L}(s);n.InvalidCharacterError=z},function(r,n,i){var o=i(53),a=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];r.exports=function(c,l){var f,u;if(l=l||{},Object.keys(l).forEach(function(d){if(a.indexOf(d)===-1)throw new o('Unknown option "'+d+'" is met in definition of "'+c+'" YAML type.')}),this.tag=c,this.kind=l.kind||null,this.resolve=l.resolve||function(){return!0},this.construct=l.construct||function(d){return d},this.instanceOf=l.instanceOf||null,this.predicate=l.predicate||null,this.represent=l.represent||null,this.defaultStyle=l.defaultStyle||null,this.styleAliases=(f=l.styleAliases||null,u={},f!==null&&Object.keys(f).forEach(function(d){f[d].forEach(function(h){u[String(h)]=d})}),u),s.indexOf(this.kind)===-1)throw new o('Unknown kind "'+this.kind+'" is specified for "'+c+'" YAML type.')}},function(r,n,i){(function(o){var a=function(s){return s&&s.Math==Math&&s};r.exports=a(typeof globalThis=="object"&&globalThis)||a(typeof window=="object"&&window)||a(typeof self=="object"&&self)||a(typeof o=="object"&&o)||Function("return this")()}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.idl_defineConst=function(o,a,s){Object.defineProperty(o,a,{writable:!1,enumerable:!0,configurable:!1,value:s})}},function(r,n){r.exports=function(i){return typeof i=="object"?i!==null:typeof i=="function"}},function(r,n){var i={}.hasOwnProperty;r.exports=function(o,a){return i.call(o,a)}},function(r,n,i){var o=i(16),a=i(115),s=i(18),c=i(56),l=Object.defineProperty;n.f=o?l:function(f,u,d){if(s(f),u=c(u,!0),s(d),a)try{return l(f,u,d)}catch{}if("get"in d||"set"in d)throw TypeError("Accessors not supported");return"value"in d&&(f[u]=d.value),f}},function(r,n,i){var o=i(8);r.exports=!o(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},function(r,n,i){var o=this&&this.__values||function(y){var x=typeof Symbol=="function"&&Symbol.iterator,C=x&&y[x],S=0;if(C)return C.call(y);if(y&&typeof y.length=="number")return{next:function(){return y&&S>=y.length&&(y=void 0),{value:y&&y[S++],done:!y}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(2);function c(y,x,C){if(C===void 0&&(C=!1),C&&a.Guard.isElementNode(x)&&a.Guard.isShadowRoot(x.shadowRoot)&&x.shadowRoot._firstChild)return x.shadowRoot._firstChild;if(x._firstChild)return x._firstChild;if(x===y)return null;if(x._nextSibling)return x._nextSibling;for(var S=x._parent;S&&S!==y;){if(S._nextSibling)return S._nextSibling;S=S._parent}return null}function l(){var y;return(y={})[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:null}}}},y}function f(y,x,C,S){x===void 0&&(x=!1),C===void 0&&(C=!1);for(var T=x?y:c(y,y,C);T&&S&&!S(T);)T=c(y,T,C);return T}function u(y,x,C,S,T){S===void 0&&(S=!1);for(var _=c(y,x,S);_&&T&&!T(_);)_=c(y,_,S);return _}function d(y,x,C,S){var T;return x===void 0&&(x=!1),C===void 0&&(C=!1),x||y._children.size!==0?((T={})[Symbol.iterator]=function(){var _=x?y:c(y,y,C);return{next:function(){for(;_&&S&&!S(_);)_=c(y,_,C);if(_===null)return{done:!0,value:null};var E={done:!1,value:_};return _=c(y,_,C),E}}},T):l()}function h(y,x,C){x===void 0&&(x=!1);for(var S=x?y:y._parent;S&&C&&!C(S);)S=S._parent;return S}function g(y,x,C,S){for(var T=x._parent;T&&S&&!S(T);)T=T._parent;return T}function p(y){return a.Guard.isDocumentTypeNode(y)?0:a.Guard.isCharacterDataNode(y)?y._data.length:y._children.size}function v(y,x){if(x===void 0&&(x=!1),x){var C=v(y,!1);return a.Guard.isShadowRoot(C)?v(C._host,!0):C}return y._parent?v(y._parent):y}function w(y,x,C,S){C===void 0&&(C=!1),S===void 0&&(S=!1);for(var T=C?y:S&&a.Guard.isShadowRoot(y)?y._host:y._parent;T!==null;){if(T===x)return!0;T=S&&a.Guard.isShadowRoot(T)?T._host:T._parent}return!1}function m(y){for(var x=v(y),C=0,S=f(x);S!==null;){if(C++,S===y)return C;S=u(x,S)}return-1}n.tree_getFirstDescendantNode=f,n.tree_getNextDescendantNode=u,n.tree_getDescendantNodes=d,n.tree_getDescendantElements=function(y,x,C,S){var T;return x===void 0&&(x=!1),C===void 0&&(C=!1),x||y._children.size!==0?((T={})[Symbol.iterator]=function(){var _=d(y,x,C,function(D){return a.Guard.isElementNode(D)})[Symbol.iterator](),E=_.next().value;return{next:function(){for(;E&&S&&!S(E);)E=_.next().value;if(E===null)return{done:!0,value:null};var D={done:!1,value:E};return E=_.next().value,D}}},T):l()},n.tree_getSiblingNodes=function(y,x,C){var S;return x===void 0&&(x=!1),y._parent&&y._parent._children.size!==0?((S={})[Symbol.iterator]=function(){var T=y._parent?y._parent._firstChild:null;return{next:function(){for(;T&&(C&&!C(T)||!x&&T===y);)T=T._nextSibling;if(T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=T._nextSibling,_}}},S):l()},n.tree_getFirstAncestorNode=h,n.tree_getNextAncestorNode=g,n.tree_getAncestorNodes=function(y,x,C){var S;return x===void 0&&(x=!1),x||y._parent?((S={})[Symbol.iterator]=function(){var T=h(y,x,C);return{next:function(){if(T===null)return{done:!0,value:null};var _={done:!1,value:T};return T=g(0,T,x,C),_}}},S):l()},n.tree_getCommonAncestor=function(y,x){if(y===x)return y._parent;for(var C=[],S=[],T=h(y,!0);T!==null;)C.push(T),T=g(0,T);for(var _=h(x,!0);_!==null;)S.push(_),_=g(0,_);for(var E=C.length,D=S.length,b=null,I=Math.min(E,D);I>0;I--){var R=C[--E];if(R!==S[--D])break;b=R}return b},n.tree_getFollowingNode=function(y,x){if(x._firstChild)return x._firstChild;if(x._nextSibling)return x._nextSibling;for(;;){var C=x._parent;if(C===null||C===y)return null;if(C._nextSibling)return C._nextSibling;x=C}},n.tree_getPrecedingNode=function(y,x){return x===y?null:x._previousSibling?(x=x._previousSibling)._lastChild?x._lastChild:x:x._parent},n.tree_isConstrained=function y(x){var C,S,T,_,E,D;switch(x._nodeType){case s.NodeType.Document:var b=!1,I=!1;try{for(var R=o(x._children),M=R.next();!M.done;M=R.next())switch(M.value._nodeType){case s.NodeType.ProcessingInstruction:case s.NodeType.Comment:break;case s.NodeType.DocumentType:if(b||I)return!1;b=!0;break;case s.NodeType.Element:if(I)return!1;I=!0;break;default:return!1}}catch(L){C={error:L}}finally{try{M&&!M.done&&(S=R.return)&&S.call(R)}finally{if(C)throw C.error}}break;case s.NodeType.DocumentFragment:case s.NodeType.Element:try{for(var P=o(x._children),k=P.next();!k.done;k=P.next())switch(k.value._nodeType){case s.NodeType.Element:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:break;default:return!1}}catch(L){T={error:L}}finally{try{k&&!k.done&&(_=P.return)&&_.call(P)}finally{if(T)throw T.error}}break;case s.NodeType.DocumentType:case s.NodeType.Text:case s.NodeType.ProcessingInstruction:case s.NodeType.CData:case s.NodeType.Comment:return!x.hasChildNodes()}try{for(var z=o(x._children),A=z.next();!A.done;A=z.next())if(!y(A.value))return!1}catch(L){E={error:L}}finally{try{A&&!A.done&&(D=z.return)&&D.call(z)}finally{if(E)throw E.error}}return!0},n.tree_nodeLength=p,n.tree_isEmpty=function(y){return p(y)===0},n.tree_rootNode=v,n.tree_isDescendantOf=function(y,x,C,S){C===void 0&&(C=!1),S===void 0&&(S=!1);for(var T=f(y,C,S);T!==null;){if(T===x)return!0;T=u(y,T,C,S)}return!1},n.tree_isAncestorOf=w,n.tree_isHostIncludingAncestorOf=function y(x,C,S){if(S===void 0&&(S=!1),w(x,C,S))return!0;var T=v(x);return!(!a.Guard.isDocumentFragmentNode(T)||T._host===null||!y(T._host,C,S))},n.tree_isSiblingOf=function(y,x,C){return C===void 0&&(C=!1),y!==x?y._parent!==null&&y._parent===x._parent:!!C},n.tree_isPreceding=function(y,x){var C=m(y),S=m(x);return C!==-1&&S!==-1&&v(y)===v(x)&&S<C},n.tree_isFollowing=function(y,x){var C=m(y),S=m(x);return C!==-1&&S!==-1&&v(y)===v(x)&&S>C},n.tree_isParentOf=function(y,x){return y._parent===x},n.tree_isChildOf=function(y,x){return x._parent===y},n.tree_previousSibling=function(y){return y._previousSibling},n.tree_nextSibling=function(y){return y._nextSibling},n.tree_firstChild=function(y){return y._firstChild},n.tree_lastChild=function(y){return y._lastChild},n.tree_treePosition=m,n.tree_index=function(y){for(var x=0;y._previousSibling!==null;)x++,y=y._previousSibling;return x},n.tree_retarget=function(y,x){for(;;){if(!y||!a.Guard.isNode(y))return y;var C=v(y);if(!a.Guard.isShadowRoot(C)||x&&a.Guard.isNode(x)&&w(C,x,!0,!0))return y;y=C.host}}},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a))throw TypeError(String(a)+" is not an object");return a}},function(r,n,i){var o=i(24),a=i(130),s=i(49),c=i(43),l=i(88),f=c.set,u=c.getterFor("Array Iterator");r.exports=l(Array,"Array",function(d,h){f(this,{type:"Array Iterator",target:o(d),index:0,kind:h})},function(){var d=u(this),h=d.target,g=d.kind,p=d.index++;return!h||p>=h.length?(d.target=void 0,{value:void 0,done:!0}):g=="keys"?{value:p,done:!1}:g=="values"?{value:h[p],done:!1}:{value:[p,h[p]],done:!1}},"values"),s.Arguments=s.Array,a("keys"),a("values"),a("entries")},function(r,n,i){var o=i(90),a=i(25),s=i(202);o||a(Object.prototype,"toString",s,{unsafe:!0})},function(r,n,i){var o=i(16),a=i(15),s=i(40);r.exports=o?function(c,l,f){return a.f(c,l,s(1,f))}:function(c,l,f){return c[l]=f,c}},function(r,n,i){var o=i(137).charAt,a=i(43),s=i(88),c=a.set,l=a.getterFor("String Iterator");s(String,"String",function(f){c(this,{type:"String Iterator",string:String(f),index:0})},function(){var f,u=l(this),d=u.string,h=u.index;return h>=d.length?{value:void 0,done:!0}:(f=o(d,h),u.index+=f.length,{value:f,done:!1})})},function(r,n,i){var o=i(11),a=i(203),s=i(19),c=i(21),l=i(5),f=l("iterator"),u=l("toStringTag"),d=s.values;for(var h in a){var g=o[h],p=g&&g.prototype;if(p){if(p[f]!==d)try{c(p,f,d)}catch{p[f]=d}if(p[u]||c(p,u,h),a[h]){for(var v in s)if(p[v]!==s[v])try{c(p,v,s[v])}catch{p[v]=s[v]}}}}},function(r,n,i){var o=i(41),a=i(35);r.exports=function(s){return o(a(s))}},function(r,n,i){var o=i(11),a=i(21),s=i(14),c=i(80),l=i(117),f=i(43),u=f.get,d=f.enforce,h=String(String).split("String");(r.exports=function(g,p,v,w){var m=!!w&&!!w.unsafe,y=!!w&&!!w.enumerable,x=!!w&&!!w.noTargetGet;typeof v=="function"&&(typeof p!="string"||s(v,"name")||a(v,"name",p),d(v).source=h.join(typeof p=="string"?p:"")),g!==o?(m?!x&&g[p]&&(y=!0):delete g[p],y?g[p]=v:a(g,p,v)):y?g[p]=v:c(p,v)})(Function.prototype,"toString",function(){return typeof this=="function"&&u(this).source||l(this)})},function(r,n,i){var o=i(47),a=Math.min;r.exports=function(s){return s>0?a(o(s),9007199254740991):0}},function(r,n,i){var o=i(35);r.exports=function(a){return Object(o(a))}},function(r,n,i){var o=i(16),a=i(8),s=i(14),c=Object.defineProperty,l={},f=function(u){throw u};r.exports=function(u,d){if(s(l,u))return l[u];d||(d={});var h=[][u],g=!!s(d,"ACCESSORS")&&d.ACCESSORS,p=s(d,0)?d[0]:f,v=s(d,1)?d[1]:void 0;return l[u]=!!h&&!a(function(){if(g&&!o)return!0;var w={length:-1};g?c(w,1,{enumerable:!0,get:f}):w[1]=1,h.call(w,p,v)})}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(148),a=i(149),s=i(151),c=i(98),l=i(153),f=i(154),u=i(155),d=i(99),h=i(100),g=i(156),p=i(157),v=i(101),w=i(158),m=i(159),y=i(160),x=i(161),C=i(162),S=i(163),T=i(164),_=i(165),E=i(166),D=i(167),b=i(168),I=i(169),R=i(170);n.create_domImplementation=function(M){return o.DOMImplementationImpl._create(M)},n.create_window=function(){return a.WindowImpl._create()},n.create_xmlDocument=function(){return new s.XMLDocumentImpl},n.create_document=function(){return new c.DocumentImpl},n.create_abortController=function(){return new l.AbortControllerImpl},n.create_abortSignal=function(){return f.AbortSignalImpl._create()},n.create_documentType=function(M,P,k,z){return u.DocumentTypeImpl._create(M,P,k,z)},n.create_element=function(M,P,k,z){return d.ElementImpl._create(M,P,k,z)},n.create_htmlElement=function(M,P,k,z){return d.ElementImpl._create(M,P,k,z)},n.create_htmlUnknownElement=function(M,P,k,z){return d.ElementImpl._create(M,P,k,z)},n.create_documentFragment=function(M){return h.DocumentFragmentImpl._create(M)},n.create_shadowRoot=function(M,P){return g.ShadowRootImpl._create(M,P)},n.create_attr=function(M,P){return p.AttrImpl._create(M,P)},n.create_text=function(M,P){return v.TextImpl._create(M,P)},n.create_cdataSection=function(M,P){return w.CDATASectionImpl._create(M,P)},n.create_comment=function(M,P){return m.CommentImpl._create(M,P)},n.create_processingInstruction=function(M,P,k){return y.ProcessingInstructionImpl._create(M,P,k)},n.create_htmlCollection=function(M,P){return P===void 0&&(P=function(){return!0}),x.HTMLCollectionImpl._create(M,P)},n.create_nodeList=function(M){return C.NodeListImpl._create(M)},n.create_nodeListStatic=function(M,P){return S.NodeListStaticImpl._create(M,P)},n.create_namedNodeMap=function(M){return T.NamedNodeMapImpl._create(M)},n.create_range=function(M,P){return _.RangeImpl._create(M,P)},n.create_nodeIterator=function(M,P,k){return E.NodeIteratorImpl._create(M,P,k)},n.create_treeWalker=function(M,P){return D.TreeWalkerImpl._create(M,P)},n.create_nodeFilter=function(){return b.NodeFilterImpl._create()},n.create_mutationRecord=function(M,P,k,z,A,L,N,H,ee){return I.MutationRecordImpl._create(M,P,k,z,A,L,N,H,ee)},n.create_domTokenList=function(M,P){return R.DOMTokenListImpl._create(M,P)}},function(r,n,i){var o=this&&this.__values||function(p){var v=typeof Symbol=="function"&&Symbol.iterator,w=v&&p[v],m=0;if(w)return w.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&m>=p.length&&(p=void 0),{value:p&&p[m++],done:!p}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(17),c=i(3),l=i(72),f=new Map;function u(p,v){if(v!==p._root&&s.tree_isAncestorOf(p._reference,v,!0)){if(p._pointerBeforeReference)for(;;){var w=s.tree_getFollowingNode(p._root,v);if(w!==null&&s.tree_isDescendantOf(p._root,w,!0)&&!s.tree_isDescendantOf(v,w,!0))return void(p._reference=w);if(w===null)return void(p._pointerBeforeReference=!1)}if(v._previousSibling===null)v._parent!==null&&(p._reference=v._parent);else{for(var m=v._previousSibling,y=s.tree_getFirstDescendantNode(v._previousSibling,!0,!1);y!==null;)y!==null&&(m=y),y=s.tree_getNextDescendantNode(v._previousSibling,y,!0,!1);p._reference=m}}}function d(p,v,w,m,y){if(c.Guard.isSlot(p)&&v==="name"&&y===null){if(m===w||m===null&&w===""||m===""&&w===null)return;p._name=m===null||m===""?"":m,l.shadowTree_assignSlotablesForATree(s.tree_rootNode(p))}}function h(p,v,w,m,y){if(c.Guard.isSlotable(p)&&v==="slot"&&y===null){if(m===w||m===null&&w===""||m===""&&w===null)return;p._name=m===null||m===""?"":m,l.shadowTree_isAssigned(p)&&l.shadowTree_assignSlotables(p._assignedSlot),l.shadowTree_assignASlot(p)}}function g(p,v,w,m){v==="id"&&m===null&&(p._uniqueIdentifier=w||void 0)}n.dom_runRemovingSteps=function(p,v){},n.dom_runCloningSteps=function(p,v,w,m){},n.dom_runAdoptingSteps=function(p,v){},n.dom_runAttributeChangeSteps=function(p,v,w,m,y){var x,C;a.dom.features.slots&&(h.call(p,p,v,w,m,y),d.call(p,p,v,w,m,y)),g.call(p,p,v,m,y);try{for(var S=o(p._attributeChangeSteps),T=S.next();!T.done;T=S.next())T.value.call(p,p,v,w,m,y)}catch(_){x={error:_}}finally{try{T&&!T.done&&(C=S.return)&&C.call(S)}finally{if(x)throw x.error}}},n.dom_runInsertionSteps=function(p){},n.dom_runNodeIteratorPreRemovingSteps=function(p,v){u.call(p,p,v)},n.dom_hasSupportedTokens=function(p){return f.has(p)},n.dom_getSupportedTokens=function(p){return f.get(p)||new Set},n.dom_runEventConstructingSteps=function(p){},n.dom_runChildTextContentChangeSteps=function(p){}},function(r,n,i){var o=i(4),a=i(11),s=i(46),c=i(44),l=i(16),f=i(86),u=i(124),d=i(8),h=i(14),g=i(59),p=i(13),v=i(18),w=i(27),m=i(24),y=i(56),x=i(40),C=i(60),S=i(61),T=i(82),_=i(190),E=i(85),D=i(55),b=i(15),I=i(79),R=i(21),M=i(25),P=i(81),k=i(57),z=i(45),A=i(58),L=i(5),N=i(125),H=i(126),ee=i(62),oe=i(43),de=i(36).forEach,ue=k("hidden"),me=L("toPrimitive"),Ee=oe.set,_e=oe.getterFor("Symbol"),Ce=Object.prototype,F=a.Symbol,O=s("JSON","stringify"),$=D.f,W=b.f,X=_.f,Z=I.f,ne=P("symbols"),xe=P("op-symbols"),Ie=P("string-to-symbol-registry"),Le=P("symbol-to-string-registry"),je=P("wks"),ie=a.QObject,ae=!ie||!ie.prototype||!ie.prototype.findChild,ve=l&&d(function(){return C(W({},"a",{get:function(){return W(this,"a",{value:7}).a}})).a!=7})?function(Ge,et,qe){var st=$(Ce,et);st&&delete Ce[et],W(Ge,et,qe),st&&Ge!==Ce&&W(Ce,et,st)}:W,se=function(Ge,et){var qe=ne[Ge]=C(F.prototype);return Ee(qe,{type:"Symbol",tag:Ge,description:et}),l||(qe.description=et),qe},ge=u?function(Ge){return typeof Ge=="symbol"}:function(Ge){return Object(Ge)instanceof F},Ve=function(Ge,et,qe){Ge===Ce&&Ve(xe,et,qe),v(Ge);var st=y(et,!0);return v(qe),h(ne,st)?(qe.enumerable?(h(Ge,ue)&&Ge[ue][st]&&(Ge[ue][st]=!1),qe=C(qe,{enumerable:x(0,!1)})):(h(Ge,ue)||W(Ge,ue,x(1,{})),Ge[ue][st]=!0),ve(Ge,st,qe)):W(Ge,st,qe)},re=function(Ge,et){v(Ge);var qe=m(et),st=S(qe).concat(Se(qe));return de(st,function(Et){l&&!it.call(qe,Et)||Ve(Ge,Et,qe[Et])}),Ge},it=function(Ge){var et=y(Ge,!0),qe=Z.call(this,et);return!(this===Ce&&h(ne,et)&&!h(xe,et))&&(!(qe||!h(this,et)||!h(ne,et)||h(this,ue)&&this[ue][et])||qe)},ut=function(Ge,et){var qe=m(Ge),st=y(et,!0);if(qe!==Ce||!h(ne,st)||h(xe,st)){var Et=$(qe,st);return!Et||!h(ne,st)||h(qe,ue)&&qe[ue][st]||(Et.enumerable=!0),Et}},ot=function(Ge){var et=X(m(Ge)),qe=[];return de(et,function(st){h(ne,st)||h(z,st)||qe.push(st)}),qe},Se=function(Ge){var et=Ge===Ce,qe=X(et?xe:m(Ge)),st=[];return de(qe,function(Et){!h(ne,Et)||et&&!h(Ce,Et)||st.push(ne[Et])}),st};f||(M((F=function(){if(this instanceof F)throw TypeError("Symbol is not a constructor");var Ge=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,et=A(Ge),qe=function(st){this===Ce&&qe.call(xe,st),h(this,ue)&&h(this[ue],et)&&(this[ue][et]=!1),ve(this,et,x(1,st))};return l&&ae&&ve(Ce,et,{configurable:!0,set:qe}),se(et,Ge)}).prototype,"toString",function(){return _e(this).tag}),M(F,"withoutSetter",function(Ge){return se(A(Ge),Ge)}),I.f=it,b.f=Ve,D.f=ut,T.f=_.f=ot,E.f=Se,N.f=function(Ge){return se(L(Ge),Ge)},l&&(W(F.prototype,"description",{configurable:!0,get:function(){return _e(this).description}}),c||M(Ce,"propertyIsEnumerable",it,{unsafe:!0}))),o({global:!0,wrap:!0,forced:!f,sham:!f},{Symbol:F}),de(S(je),function(Ge){H(Ge)}),o({target:"Symbol",stat:!0,forced:!f},{for:function(Ge){var et=String(Ge);if(h(Ie,et))return Ie[et];var qe=F(et);return Ie[et]=qe,Le[qe]=et,qe},keyFor:function(Ge){if(!ge(Ge))throw TypeError(Ge+" is not a symbol");if(h(Le,Ge))return Le[Ge]},useSetter:function(){ae=!0},useSimple:function(){ae=!1}}),o({target:"Object",stat:!0,forced:!f,sham:!l},{create:function(Ge,et){return et===void 0?C(Ge):re(C(Ge),et)},defineProperty:Ve,defineProperties:re,getOwnPropertyDescriptor:ut}),o({target:"Object",stat:!0,forced:!f},{getOwnPropertyNames:ot,getOwnPropertySymbols:Se}),o({target:"Object",stat:!0,forced:d(function(){E.f(1)})},{getOwnPropertySymbols:function(Ge){return E.f(w(Ge))}}),O&&o({target:"JSON",stat:!0,forced:!f||d(function(){var Ge=F();return O([Ge])!="[null]"||O({a:Ge})!="{}"||O(Object(Ge))!="{}"})},{stringify:function(Ge,et,qe){for(var st,Et=[Ge],ct=1;arguments.length>ct;)Et.push(arguments[ct++]);if(st=et,(p(et)||Ge!==void 0)&&!ge(Ge))return g(et)||(et=function(bt,It){if(typeof st=="function"&&(It=st.call(this,bt,It)),!ge(It))return It}),Et[1]=et,O.apply(null,Et)}}),F.prototype[me]||R(F.prototype,me,F.prototype.valueOf),ee(F,"Symbol"),z[ue]=!0},function(r,n,i){var o=i(4),a=i(16),s=i(11),c=i(14),l=i(13),f=i(15).f,u=i(119),d=s.Symbol;if(a&&typeof d=="function"&&(!("description"in d.prototype)||d().description!==void 0)){var h={},g=function(){var y=arguments.length<1||arguments[0]===void 0?void 0:String(arguments[0]),x=this instanceof g?new d(y):y===void 0?d():d(y);return y===""&&(h[x]=!0),x};u(g,d);var p=g.prototype=d.prototype;p.constructor=g;var v=p.toString,w=String(d("test"))=="Symbol(test)",m=/^Symbol\((.*)\)[^)]+$/;f(p,"description",{configurable:!0,get:function(){var y=l(this)?this.valueOf():this,x=v.call(y);if(c(h,y))return"";var C=w?x.slice(7,-1):x.replace(m,"$1");return C===""?void 0:C}}),o({global:!0,forced:!0},{Symbol:g})}},function(r,n,i){i(126)("iterator")},function(r,n,i){var o,a=this&&this.__extends||(o=function(w,m){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,x){y.__proto__=x}||function(y,x){for(var C in x)x.hasOwnProperty(C)&&(y[C]=x[C])})(w,m)},function(w,m){function y(){this.constructor=w}o(w,m),w.prototype=m===null?Object.create(m):(y.prototype=m.prototype,new y)}),s=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],x=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&x>=w.length&&(w=void 0),{value:w&&w[x++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(70),u=i(3),d=i(9),h=i(0),g=i(152),p=i(12),v=function(w){function m(){var y=w.call(this)||this;return y._parent=null,y._firstChild=null,y._lastChild=null,y._previousSibling=null,y._nextSibling=null,y}return a(m,w),Object.defineProperty(m.prototype,"_childNodes",{get:function(){return this.__childNodes||(this.__childNodes=h.create_nodeList(this))},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverride||c.dom.window._associatedDocument},set:function(y){this._nodeDocumentOverride=y},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"_registeredObserverList",{get:function(){return this.__registeredObserverList||(this.__registeredObserverList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeType",{get:function(){return this._nodeType},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeName",{get:function(){return u.Guard.isElementNode(this)?this._htmlUppercasedQualifiedName:u.Guard.isAttrNode(this)?this._qualifiedName:u.Guard.isExclusiveTextNode(this)?"#text":u.Guard.isCDATASectionNode(this)?"#cdata-section":u.Guard.isProcessingInstructionNode(this)?this._target:u.Guard.isCommentNode(this)?"#comment":u.Guard.isDocumentNode(this)?"#document":u.Guard.isDocumentTypeNode(this)?this._name:u.Guard.isDocumentFragmentNode(this)?"#document-fragment":""},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"baseURI",{get:function(){return g.urlSerializer(this._nodeDocument._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"isConnected",{get:function(){return u.Guard.isElementNode(this)&&h.shadowTree_isConnected(this)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"ownerDocument",{get:function(){return this._nodeType===l.NodeType.Document?null:this._nodeDocument},enumerable:!0,configurable:!0}),m.prototype.getRootNode=function(y){return h.tree_rootNode(this,!!y&&y.composed)},Object.defineProperty(m.prototype,"parentNode",{get:function(){return this._nodeType===l.NodeType.Attribute?null:this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"parentElement",{get:function(){return this._parent&&u.Guard.isElementNode(this._parent)?this._parent:null},enumerable:!0,configurable:!0}),m.prototype.hasChildNodes=function(){return this._firstChild!==null},Object.defineProperty(m.prototype,"childNodes",{get:function(){return this._childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"firstChild",{get:function(){return this._firstChild},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"nodeValue",{get:function(){return u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,this._data.length,y)},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"textContent",{get:function(){return u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.text_descendantTextContent(this):u.Guard.isAttrNode(this)?this._value:u.Guard.isCharacterDataNode(this)?this._data:null},set:function(y){y===null&&(y=""),u.Guard.isDocumentFragmentNode(this)||u.Guard.isElementNode(this)?h.node_stringReplaceAll(y,this):u.Guard.isAttrNode(this)?h.attr_setAnExistingAttributeValue(this,y):u.Guard.isCharacterDataNode(this)&&h.characterData_replaceData(this,0,h.tree_nodeLength(this),y)},enumerable:!0,configurable:!0}),m.prototype.normalize=function(){for(var y,x,C,S,T=[],_=h.tree_getFirstDescendantNode(this,!1,!1,function(de){return u.Guard.isExclusiveTextNode(de)});_!==null;)T.push(_),_=h.tree_getNextDescendantNode(this,_,!1,!1,function(de){return u.Guard.isExclusiveTextNode(de)});for(var E=0;E<T.length;E++){var D=T[E];if(D._parent!==null){var b=h.tree_nodeLength(D);if(b!==0){var I=[],R="";try{for(var M=(y=void 0,s(h.text_contiguousExclusiveTextNodes(D))),P=M.next();!P.done;P=M.next()){var k=P.value;I.push(k),R+=k._data}}catch(de){y={error:de}}finally{try{P&&!P.done&&(x=M.return)&&x.call(M)}finally{if(y)throw y.error}}if(h.characterData_replaceData(D,b,0,R),c.dom.rangeList.size!==0)for(var z=D._nextSibling;z!==null&&u.Guard.isExclusiveTextNode(z);){var A=z,L=h.tree_index(A);try{for(var N=(C=void 0,s(c.dom.rangeList)),H=N.next();!H.done;H=N.next()){var ee=H.value;ee._start[0]===A&&(ee._start[0]=D,ee._start[1]+=b),ee._end[0]===A&&(ee._end[0]=D,ee._end[1]+=b),ee._start[0]===A._parent&&ee._start[1]===L&&(ee._start[0]=D,ee._start[1]=b),ee._end[0]===A._parent&&ee._end[1]===L&&(ee._end[0]=D,ee._end[1]=b)}}catch(de){C={error:de}}finally{try{H&&!H.done&&(S=N.return)&&S.call(N)}finally{if(C)throw C.error}}b+=h.tree_nodeLength(z),z=z._nextSibling}for(var oe=0;oe<I.length;oe++)(k=I[oe])._parent!==null&&h.mutation_remove(k,k._parent)}else h.mutation_remove(D,D._parent)}}},m.prototype.cloneNode=function(y){if(y===void 0&&(y=!1),u.Guard.isShadowRoot(this))throw new d.NotSupportedError;return h.node_clone(this,null,y)},m.prototype.isEqualNode=function(y){return y===void 0&&(y=null),y!==null&&h.node_equals(this,y)},m.prototype.isSameNode=function(y){return y===void 0&&(y=null),this===y},m.prototype.compareDocumentPosition=function(y){if(y===this)return 0;var x=y,C=this,S=null,T=null;if(u.Guard.isAttrNode(x)&&(x=(S=x)._element),u.Guard.isAttrNode(C)&&(C=(T=C)._element,S&&x&&x===C))for(var _=0;_<C._attributeList.length;_++){var E=C._attributeList[_];if(h.node_equals(E,S))return l.Position.ImplementationSpecific|l.Position.Preceding;if(h.node_equals(E,T))return l.Position.ImplementationSpecific|l.Position.Following}return x===null||C===null||h.tree_rootNode(x)!==h.tree_rootNode(C)?l.Position.Disconnected|l.Position.ImplementationSpecific|(c.dom.compareCache.check(this,y)?l.Position.Preceding:l.Position.Following):!S&&h.tree_isAncestorOf(C,x)||T&&x===C?l.Position.Contains|l.Position.Preceding:!T&&h.tree_isDescendantOf(C,x)||S&&x===C?l.Position.ContainedBy|l.Position.Following:h.tree_isPreceding(C,x)?l.Position.Preceding:l.Position.Following},m.prototype.contains=function(y){return y!==null&&h.tree_isDescendantOf(this,y,!0)},m.prototype.lookupPrefix=function(y){return y?u.Guard.isElementNode(this)?h.node_locateANamespacePrefix(this,y):u.Guard.isDocumentNode(this)?this.documentElement===null?null:h.node_locateANamespacePrefix(this.documentElement,y):u.Guard.isDocumentTypeNode(this)||u.Guard.isDocumentFragmentNode(this)?null:u.Guard.isAttrNode(this)?this._element===null?null:h.node_locateANamespacePrefix(this._element,y):this._parent!==null&&u.Guard.isElementNode(this._parent)?h.node_locateANamespacePrefix(this._parent,y):null:null},m.prototype.lookupNamespaceURI=function(y){return h.node_locateANamespace(this,y||null)},m.prototype.isDefaultNamespace=function(y){return y||(y=null),h.node_locateANamespace(this,null)===y},m.prototype.insertBefore=function(y,x){return h.mutation_preInsert(y,this,x)},m.prototype.appendChild=function(y){return h.mutation_append(y,this)},m.prototype.replaceChild=function(y,x){return h.mutation_replace(x,y,this)},m.prototype.removeChild=function(y){return h.mutation_preRemove(y,this)},m.prototype._getTheParent=function(y){return u.Guard.isSlotable(this)&&h.shadowTree_isAssigned(this)?this._assignedSlot:this._parent},m.ELEMENT_NODE=1,m.ATTRIBUTE_NODE=2,m.TEXT_NODE=3,m.CDATA_SECTION_NODE=4,m.ENTITY_REFERENCE_NODE=5,m.ENTITY_NODE=6,m.PROCESSING_INSTRUCTION_NODE=7,m.COMMENT_NODE=8,m.DOCUMENT_NODE=9,m.DOCUMENT_TYPE_NODE=10,m.DOCUMENT_FRAGMENT_NODE=11,m.NOTATION_NODE=12,m.DOCUMENT_POSITION_DISCONNECTED=1,m.DOCUMENT_POSITION_PRECEDING=2,m.DOCUMENT_POSITION_FOLLOWING=4,m.DOCUMENT_POSITION_CONTAINS=8,m.DOCUMENT_POSITION_CONTAINED_BY=16,m.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32,m}(f.EventTargetImpl);n.NodeImpl=v,v.prototype._children=new u.EmptySet,p.idl_defineConst(v.prototype,"ELEMENT_NODE",1),p.idl_defineConst(v.prototype,"ATTRIBUTE_NODE",2),p.idl_defineConst(v.prototype,"TEXT_NODE",3),p.idl_defineConst(v.prototype,"CDATA_SECTION_NODE",4),p.idl_defineConst(v.prototype,"ENTITY_REFERENCE_NODE",5),p.idl_defineConst(v.prototype,"ENTITY_NODE",6),p.idl_defineConst(v.prototype,"PROCESSING_INSTRUCTION_NODE",7),p.idl_defineConst(v.prototype,"COMMENT_NODE",8),p.idl_defineConst(v.prototype,"DOCUMENT_NODE",9),p.idl_defineConst(v.prototype,"DOCUMENT_TYPE_NODE",10),p.idl_defineConst(v.prototype,"DOCUMENT_FRAGMENT_NODE",11),p.idl_defineConst(v.prototype,"NOTATION_NODE",12),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_DISCONNECTED",1),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_PRECEDING",2),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_FOLLOWING",4),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_CONTAINS",8),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_CONTAINED_BY",16),p.idl_defineConst(v.prototype,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32)},function(r,n){r.exports=function(i){if(i==null)throw TypeError("Can't call method on "+i);return i}},function(r,n,i){var o=i(87),a=i(41),s=i(27),c=i(26),l=i(128),f=[].push,u=function(d){var h=d==1,g=d==2,p=d==3,v=d==4,w=d==6,m=d==5||w;return function(y,x,C,S){for(var T,_,E=s(y),D=a(E),b=o(x,C,3),I=c(D.length),R=0,M=S||l,P=h?M(y,I):g?M(y,0):void 0;I>R;R++)if((m||R in D)&&(_=b(T=D[R],R,E),d)){if(h)P[R]=_;else if(_)switch(d){case 3:return!0;case 5:return T;case 6:return R;case 2:f.call(P,T)}else if(v)return!1}return w?-1:p||v?v:P}};r.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6)}},function(r,n,i){var o=this&&this.__values||function(E){var D=typeof Symbol=="function"&&Symbol.iterator,b=D&&E[D],I=0;if(b)return b.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&I>=E.length&&(E=void 0),{value:E&&E[I++],done:!E}}};throw new TypeError(D?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(E,D){var b=typeof Symbol=="function"&&E[Symbol.iterator];if(!b)return E;var I,R,M=b.call(E),P=[];try{for(;(D===void 0||D-- >0)&&!(I=M.next()).done;)P.push(I.value)}catch(k){R={error:k}}finally{try{I&&!I.done&&(b=M.return)&&b.call(M)}finally{if(R)throw R.error}}return P},s=this&&this.__spread||function(){for(var E=[],D=0;D<arguments.length;D++)E=E.concat(a(arguments[D]));return E};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(9),f=i(2),u=i(3),d=i(1),h=i(7),g=i(73),p=i(17),v=i(172),w=i(72),m=i(51),y=i(30),x=i(106);function C(E,D,b){var I,R,M,P,k,z,A,L,N=D._nodeType,H=E._nodeType,ee=b?b._nodeType:null;if(N!==f.NodeType.Document&&N!==f.NodeType.DocumentFragment&&N!==f.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+D.nodeName+".");if(p.tree_isHostIncludingAncestorOf(D,E,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an inclusive ancestor of parent node. Node is "+E.nodeName+", parent node is "+D.nodeName+".");if(b!==null&&b._parent!==D)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+b.nodeName+", parent node is "+D.nodeName+".");if(H!==f.NodeType.DocumentFragment&&H!==f.NodeType.DocumentType&&H!==f.NodeType.Element&&H!==f.NodeType.Text&&H!==f.NodeType.ProcessingInstruction&&H!==f.NodeType.CData&&H!==f.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+E.nodeName+".");if(H===f.NodeType.Text&&N===f.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+E.nodeName+".");if(H===f.NodeType.DocumentType&&N!==f.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+D.nodeName+".");if(N===f.NodeType.Document){if(H===f.NodeType.DocumentFragment){var oe=0;try{for(var de=o(E._children),ue=de.next();!ue.done;ue=de.next()){var me=ue.value;if(me._nodeType===f.NodeType.Element)oe++;else if(me._nodeType===f.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+me.nodeName+".")}}catch(Z){I={error:Z}}finally{try{ue&&!ue.done&&(R=de.return)&&R.call(de)}finally{if(I)throw I.error}}if(oe>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+oe+" element nodes.");if(oe===1){try{for(var Ee=o(D._children),_e=Ee.next();!_e.done;_e=Ee.next())if(_e.value._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(Z){M={error:Z}}finally{try{_e&&!_e.done&&(P=Ee.return)&&P.call(Ee)}finally{if(M)throw M.error}}if(b){if(ee===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");for(var Ce=b._nextSibling;Ce;){if(Ce._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");Ce=Ce._nextSibling}}}}else if(H===f.NodeType.Element){try{for(var F=o(D._children),O=F.next();!O.done;O=F.next())if(O.value._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+E.nodeName+".")}catch(Z){k={error:Z}}finally{try{O&&!O.done&&(z=F.return)&&z.call(F)}finally{if(k)throw k.error}}if(b){if(ee===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");for(Ce=b._nextSibling;Ce;){if(Ce._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+E.nodeName+".");Ce=Ce._nextSibling}}}else if(H===f.NodeType.DocumentType){try{for(var $=o(D._children),W=$.next();!W.done;W=$.next())if(W.value._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+E.nodeName+".")}catch(Z){A={error:Z}}finally{try{W&&!W.done&&(L=$.return)&&L.call($)}finally{if(A)throw A.error}}if(b)for(var X=b._previousSibling;X;){if(X._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");X=X._previousSibling}else for(X=D._firstChild;X;){if(X._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+E.nodeName+".");X=X._nextSibling}}}}function S(E,D,b){C(E,D,b);var I=b;return I===E&&(I=E._nextSibling),x.document_adopt(E,D._nodeDocument),T(E,D,I),E}function T(E,D,b,I){var R,M;if(b!==null||E._nodeType===f.NodeType.DocumentFragment){var P=E._nodeType===f.NodeType.DocumentFragment?E._children.size:1;if(b!==null&&c.dom.rangeList.size!==0){var k=p.tree_index(b);try{for(var z=o(c.dom.rangeList),A=z.next();!A.done;A=z.next()){var L=A.value;L._start[0]===D&&L._start[1]>k&&(L._start[1]+=P),L._end[0]===D&&L._end[1]>k&&(L._end[1]+=P)}}catch(_e){R={error:_e}}finally{try{A&&!A.done&&(M=z.return)&&M.call(z)}finally{if(R)throw R.error}}}var N=E._nodeType===f.NodeType.DocumentFragment?new(Array.bind.apply(Array,s([void 0],E._children))):[E];if(E._nodeType===f.NodeType.DocumentFragment)for(;E._firstChild;)_(E._firstChild,E,!0);c.dom.features.mutationObservers&&E._nodeType===f.NodeType.DocumentFragment&&m.observer_queueTreeMutationRecord(E,[],N,null,null);for(var H=b?b._previousSibling:D._lastChild,ee=b===null?-1:p.tree_index(b),oe=0;oe<N.length;oe++){var de=N[oe];if(u.Guard.isElementNode(de)&&(u.Guard.isDocumentNode(D)&&(D._documentElement=de),de._nodeDocument._hasNamespaces||de._namespace===null&&de._namespacePrefix===null||(de._nodeDocument._hasNamespaces=!0)),de._parent=D,b===null?h.set.append(D._children,de):(h.set.insert(D._children,de,ee),ee++),D._firstChild===null)de._previousSibling=null,de._nextSibling=null,D._firstChild=de,D._lastChild=de;else{var ue=b?b._previousSibling:D._lastChild,me=b||null;de._previousSibling=ue,de._nextSibling=me,ue&&(ue._nextSibling=de),me&&(me._previousSibling=de),ue||(D._firstChild=de),me||(D._lastChild=de)}c.dom.features.slots&&D._shadowRoot!==null&&u.Guard.isSlotable(de)&&w.shadowTree_assignASlot(de),c.dom.features.steps&&u.Guard.isTextNode(de)&&y.dom_runChildTextContentChangeSteps(D),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&d.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(de));for(var Ee=p.tree_getFirstDescendantNode(de,!0,!0);Ee!==null;)c.dom.features.steps&&y.dom_runInsertionSteps(Ee),c.dom.features.customElements&&u.Guard.isElementNode(Ee)&&w.shadowTree_isConnected(Ee)&&(u.Guard.isCustomElementNode(Ee)?g.customElement_enqueueACustomElementCallbackReaction(Ee,"connectedCallback",[]):g.customElement_tryToUpgrade(Ee)),Ee=p.tree_getNextDescendantNode(de,Ee,!0,!0)}c.dom.features.mutationObservers&&(I||m.observer_queueTreeMutationRecord(D,N,[],H,b))}else(function(_e,Ce,F){var O=Ce._lastChild;if(u.Guard.isElementNode(_e)&&(u.Guard.isDocumentNode(Ce)&&(Ce._documentElement=_e),_e._nodeDocument._hasNamespaces||_e._namespace===null&&_e._namespacePrefix===null||(_e._nodeDocument._hasNamespaces=!0)),_e._parent=Ce,Ce._children.add(_e),Ce._firstChild===null)_e._previousSibling=null,_e._nextSibling=null,Ce._firstChild=_e,Ce._lastChild=_e;else{var $=Ce._lastChild;_e._previousSibling=$,_e._nextSibling=null,$&&($._nextSibling=_e),$||(Ce._firstChild=_e),Ce._lastChild=_e}c.dom.features.slots&&Ce._shadowRoot!==null&&u.Guard.isSlotable(_e)&&w.shadowTree_assignASlot(_e),c.dom.features.steps&&u.Guard.isTextNode(_e)&&y.dom_runChildTextContentChangeSteps(Ce),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(Ce))&&u.Guard.isSlot(Ce)&&d.isEmpty(Ce._assignedNodes)&&w.shadowTree_signalASlotChange(Ce),c.dom.features.slots&&w.shadowTree_assignSlotablesForATree(p.tree_rootNode(_e)),c.dom.features.steps&&y.dom_runInsertionSteps(_e),c.dom.features.customElements&&u.Guard.isElementNode(_e)&&w.shadowTree_isConnected(_e)&&(u.Guard.isCustomElementNode(_e)?g.customElement_enqueueACustomElementCallbackReaction(_e,"connectedCallback",[]):g.customElement_tryToUpgrade(_e)),c.dom.features.mutationObservers&&(F||m.observer_queueTreeMutationRecord(Ce,[_e],[],O,null))})(E,D,I)}function _(E,D,b){var I,R,M,P,k,z,A,L;if(c.dom.rangeList.size!==0){var N=p.tree_index(E);try{for(var H=o(c.dom.rangeList),ee=H.next();!ee.done;ee=H.next()){var oe=ee.value;p.tree_isDescendantOf(E,oe._start[0],!0)&&(oe._start=[D,N]),p.tree_isDescendantOf(E,oe._end[0],!0)&&(oe._end=[D,N]),oe._start[0]===D&&oe._start[1]>N&&oe._start[1]--,oe._end[0]===D&&oe._end[1]>N&&oe._end[1]--}}catch(Ie){I={error:Ie}}finally{try{ee&&!ee.done&&(R=H.return)&&R.call(H)}finally{if(I)throw I.error}}try{for(var de=o(c.dom.rangeList),ue=de.next();!ue.done;ue=de.next())(oe=ue.value)._start[0]===D&&oe._start[1]>N&&(oe._start[1]-=1),oe._end[0]===D&&oe._end[1]>N&&(oe._end[1]-=1)}catch(Ie){M={error:Ie}}finally{try{ue&&!ue.done&&(P=de.return)&&P.call(de)}finally{if(M)throw M.error}}}if(c.dom.features.steps)try{for(var me=o(v.nodeIterator_iteratorList()),Ee=me.next();!Ee.done;Ee=me.next()){var _e=Ee.value;_e._root._nodeDocument===E._nodeDocument&&y.dom_runNodeIteratorPreRemovingSteps(_e,E)}}catch(Ie){k={error:Ie}}finally{try{Ee&&!Ee.done&&(z=me.return)&&z.call(me)}finally{if(k)throw k.error}}var Ce=E._previousSibling,F=E._nextSibling;u.Guard.isDocumentNode(D)&&u.Guard.isElementNode(E)&&(D._documentElement=null),E._parent=null,D._children.delete(E);var O=E._previousSibling,$=E._nextSibling;E._previousSibling=null,E._nextSibling=null,O&&(O._nextSibling=$),$&&($._previousSibling=O),O||(D._firstChild=$),$||(D._lastChild=O),c.dom.features.slots&&u.Guard.isSlotable(E)&&E._assignedSlot!==null&&w.shadowTree_isAssigned(E)&&w.shadowTree_assignSlotables(E._assignedSlot),c.dom.features.slots&&u.Guard.isShadowRoot(p.tree_rootNode(D))&&u.Guard.isSlot(D)&&d.isEmpty(D._assignedNodes)&&w.shadowTree_signalASlotChange(D),c.dom.features.slots&&p.tree_getFirstDescendantNode(E,!0,!1,function(Ie){return u.Guard.isSlot(Ie)})!==null&&(w.shadowTree_assignSlotablesForATree(p.tree_rootNode(D)),w.shadowTree_assignSlotablesForATree(E)),c.dom.features.steps&&y.dom_runRemovingSteps(E,D),c.dom.features.customElements&&u.Guard.isCustomElementNode(E)&&g.customElement_enqueueACustomElementCallbackReaction(E,"disconnectedCallback",[]);for(var W=p.tree_getFirstDescendantNode(E,!1,!0);W!==null;)c.dom.features.steps&&y.dom_runRemovingSteps(W,E),c.dom.features.customElements&&u.Guard.isCustomElementNode(W)&&g.customElement_enqueueACustomElementCallbackReaction(W,"disconnectedCallback",[]),W=p.tree_getNextDescendantNode(E,W,!1,!0);if(c.dom.features.mutationObservers)for(var X=p.tree_getFirstAncestorNode(D,!0);X!==null;){try{for(var Z=(A=void 0,o(X._registeredObserverList)),ne=Z.next();!ne.done;ne=Z.next()){var xe=ne.value;xe.options.subtree&&E._registeredObserverList.push({observer:xe.observer,options:xe.options,source:xe})}}catch(Ie){A={error:Ie}}finally{try{ne&&!ne.done&&(L=Z.return)&&L.call(Z)}finally{if(A)throw A.error}}X=p.tree_getNextAncestorNode(D,X,!0)}c.dom.features.mutationObservers&&(b||m.observer_queueTreeMutationRecord(D,[],[E],Ce,F)),c.dom.features.steps&&u.Guard.isTextNode(E)&&y.dom_runChildTextContentChangeSteps(D)}n.mutation_ensurePreInsertionValidity=C,n.mutation_preInsert=S,n.mutation_insert=T,n.mutation_append=function(E,D){return S(E,D,null)},n.mutation_replace=function(E,D,b){var I,R,M,P,k,z,A,L;if(b._nodeType!==f.NodeType.Document&&b._nodeType!==f.NodeType.DocumentFragment&&b._nodeType!==f.NodeType.Element)throw new l.HierarchyRequestError("Only document, document fragment and element nodes can contain child nodes. Parent node is "+b.nodeName+".");if(p.tree_isHostIncludingAncestorOf(b,D,!0))throw new l.HierarchyRequestError("The node to be inserted cannot be an ancestor of parent node. Node is "+D.nodeName+", parent node is "+b.nodeName+".");if(E._parent!==b)throw new l.NotFoundError("The reference child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+b.nodeName+".");if(D._nodeType!==f.NodeType.DocumentFragment&&D._nodeType!==f.NodeType.DocumentType&&D._nodeType!==f.NodeType.Element&&D._nodeType!==f.NodeType.Text&&D._nodeType!==f.NodeType.ProcessingInstruction&&D._nodeType!==f.NodeType.CData&&D._nodeType!==f.NodeType.Comment)throw new l.HierarchyRequestError("Only document fragment, document type, element, text, processing instruction, cdata section or comment nodes can be inserted. Node is "+D.nodeName+".");if(D._nodeType===f.NodeType.Text&&b._nodeType===f.NodeType.Document)throw new l.HierarchyRequestError("Cannot insert a text node as a child of a document node. Node is "+D.nodeName+".");if(D._nodeType===f.NodeType.DocumentType&&b._nodeType!==f.NodeType.Document)throw new l.HierarchyRequestError("A document type node can only be inserted under a document node. Parent node is "+b.nodeName+".");if(b._nodeType===f.NodeType.Document){if(D._nodeType===f.NodeType.DocumentFragment){var N=0;try{for(var H=o(D._children),ee=H.next();!ee.done;ee=H.next()){var oe=ee.value;if(oe._nodeType===f.NodeType.Element)N++;else if(oe._nodeType===f.NodeType.Text)throw new l.HierarchyRequestError("Cannot insert text a node as a child of a document node. Node is "+oe.nodeName+".")}}catch(xe){I={error:xe}}finally{try{ee&&!ee.done&&(R=H.return)&&R.call(H)}finally{if(I)throw I.error}}if(N>1)throw new l.HierarchyRequestError("A document node can only have one document element node. Document fragment to be inserted has "+N+" element nodes.");if(N===1){try{for(var de=o(b._children),ue=de.next();!ue.done;ue=de.next())if((O=ue.value)._nodeType===f.NodeType.Element&&O!==E)throw new l.HierarchyRequestError("The document node already has a document element node.")}catch(xe){M={error:xe}}finally{try{ue&&!ue.done&&(P=de.return)&&P.call(de)}finally{if(M)throw M.error}}for(var me=E._nextSibling;me;){if(me._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node.");me=me._nextSibling}}}else if(D._nodeType===f.NodeType.Element){try{for(var Ee=o(b._children),_e=Ee.next();!_e.done;_e=Ee.next())if((O=_e.value)._nodeType===f.NodeType.Element&&O!==E)throw new l.HierarchyRequestError("Document already has a document element node. Node is "+D.nodeName+".")}catch(xe){k={error:xe}}finally{try{_e&&!_e.done&&(z=Ee.return)&&z.call(Ee)}finally{if(k)throw k.error}}for(me=E._nextSibling;me;){if(me._nodeType===f.NodeType.DocumentType)throw new l.HierarchyRequestError("Cannot insert an element node before a document type node. Node is "+D.nodeName+".");me=me._nextSibling}}else if(D._nodeType===f.NodeType.DocumentType){try{for(var Ce=o(b._children),F=Ce.next();!F.done;F=Ce.next()){var O;if((O=F.value)._nodeType===f.NodeType.DocumentType&&O!==E)throw new l.HierarchyRequestError("Document already has a document type node. Node is "+D.nodeName+".")}}catch(xe){A={error:xe}}finally{try{F&&!F.done&&(L=Ce.return)&&L.call(Ce)}finally{if(A)throw A.error}}for(var $=E._previousSibling;$;){if($._nodeType===f.NodeType.Element)throw new l.HierarchyRequestError("Cannot insert a document type node before an element node. Node is "+D.nodeName+".");$=$._previousSibling}}}var W=E._nextSibling;W===D&&(W=D._nextSibling);var X=E._previousSibling;x.document_adopt(D,b._nodeDocument);var Z=[];E._parent!==null&&(Z.push(E),_(E,E._parent,!0));var ne=[];return D._nodeType===f.NodeType.DocumentFragment?ne=Array.from(D._children):ne.push(D),T(D,b,W,!0),c.dom.features.mutationObservers&&m.observer_queueTreeMutationRecord(b,ne,Z,X,W),E},n.mutation_replaceAll=function(E,D){var b,I;E!==null&&x.document_adopt(E,D._nodeDocument);var R=Array.from(D._children),M=[];E&&E._nodeType===f.NodeType.DocumentFragment?M=Array.from(E._children):E!==null&&M.push(E);try{for(var P=o(R),k=P.next();!k.done;k=P.next())_(k.value,D,!0)}catch(z){b={error:z}}finally{try{k&&!k.done&&(I=P.return)&&I.call(P)}finally{if(b)throw b.error}}E!==null&&T(E,D,null,!0),c.dom.features.mutationObservers&&m.observer_queueTreeMutationRecord(D,M,R,null,null)},n.mutation_preRemove=function(E,D){if(E._parent!==D)throw new l.NotFoundError("The child node cannot be found under parent node. Child node is "+E.nodeName+", parent node is "+D.nodeName+".");return _(E,D),E},n.mutation_remove=_},function(r,n,i){function o(a){return a==null}r.exports.isNothing=o,r.exports.isObject=function(a){return typeof a=="object"&&a!==null},r.exports.toArray=function(a){return Array.isArray(a)?a:o(a)?[]:[a]},r.exports.repeat=function(a,s){var c,l="";for(c=0;c<s;c+=1)l+=a;return l},r.exports.isNegativeZero=function(a){return a===0&&Number.NEGATIVE_INFINITY===1/a},r.exports.extend=function(a,s){var c,l,f,u;if(s)for(c=0,l=(u=Object.keys(s)).length;c<l;c+=1)a[f=u[c]]=s[f];return a}},function(r,n,i){var o=i(38),a=i(53),s=i(10);function c(f,u,d){var h=[];return f.include.forEach(function(g){d=c(g,u,d)}),f[u].forEach(function(g){d.forEach(function(p,v){p.tag===g.tag&&p.kind===g.kind&&h.push(v)}),d.push(g)}),d.filter(function(g,p){return h.indexOf(p)===-1})}function l(f){this.include=f.include||[],this.implicit=f.implicit||[],this.explicit=f.explicit||[],this.implicit.forEach(function(u){if(u.loadKind&&u.loadKind!=="scalar")throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=c(this,"implicit",[]),this.compiledExplicit=c(this,"explicit",[]),this.compiledTypeMap=function(){var u,d,h={scalar:{},sequence:{},mapping:{},fallback:{}};function g(p){h[p.kind][p.tag]=h.fallback[p.tag]=p}for(u=0,d=arguments.length;u<d;u+=1)arguments[u].forEach(g);return h}(this.compiledImplicit,this.compiledExplicit)}l.DEFAULT=null,l.create=function(){var f,u;switch(arguments.length){case 1:f=l.DEFAULT,u=arguments[0];break;case 2:f=arguments[0],u=arguments[1];break;default:throw new a("Wrong number of arguments for Schema.create function")}if(f=o.toArray(f),u=o.toArray(u),!f.every(function(d){return d instanceof l}))throw new a("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!u.every(function(d){return d instanceof s}))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new l({include:f,explicit:u})},r.exports=l},function(r,n){r.exports=function(i,o){return{enumerable:!(1&i),configurable:!(2&i),writable:!(4&i),value:o}}},function(r,n,i){var o=i(8),a=i(42),s="".split;r.exports=o(function(){return!Object("z").propertyIsEnumerable(0)})?function(c){return a(c)=="String"?s.call(c,""):Object(c)}:Object},function(r,n){var i={}.toString;r.exports=function(o){return i.call(o).slice(8,-1)}},function(r,n,i){var o,a,s,c=i(186),l=i(11),f=i(13),u=i(21),d=i(14),h=i(57),g=i(45),p=l.WeakMap;if(c){var v=new p,w=v.get,m=v.has,y=v.set;o=function(C,S){return y.call(v,C,S),S},a=function(C){return w.call(v,C)||{}},s=function(C){return m.call(v,C)}}else{var x=h("state");g[x]=!0,o=function(C,S){return u(C,x,S),S},a=function(C){return d(C,x)?C[x]:{}},s=function(C){return d(C,x)}}r.exports={set:o,get:a,has:s,enforce:function(C){return s(C)?a(C):o(C,{})},getterFor:function(C){return function(S){var T;if(!f(S)||(T=a(S)).type!==C)throw TypeError("Incompatible receiver, "+C+" required");return T}}}},function(r,n){r.exports=!1},function(r,n){r.exports={}},function(r,n,i){var o=i(120),a=i(11),s=function(c){return typeof c=="function"?c:void 0};r.exports=function(c,l){return arguments.length<2?s(o[c])||s(a[c]):o[c]&&o[c][l]||a[c]&&a[c][l]}},function(r,n){var i=Math.ceil,o=Math.floor;r.exports=function(a){return isNaN(a=+a)?0:(a>0?o:i)(a)}},function(r,n,i){var o=i(8);r.exports=function(a,s){var c=[][a];return!!c&&o(function(){c.call(null,s||function(){throw 1},1)})}},function(r,n){r.exports={}},function(r,n,i){i(31),i(32),i(33),i(220),i(64),i(19),i(65),i(20),i(68),i(66),i(92),i(144),i(22),i(94),i(23);var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(g,p){var v=typeof Symbol=="function"&&g[Symbol.iterator];if(!v)return g;var w,m,y=v.call(g),x=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)x.push(w.value)}catch(C){m={error:C}}finally{try{w&&!w.done&&(v=y.return)&&v.call(y)}finally{if(m)throw m.error}}return x},s=this&&this.__spread||function(){for(var g=[],p=0;p<arguments.length;p++)g=g.concat(a(arguments[p]));return g};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(69),f=i(95),u=i(7),d=i(0),h=function(){function g(p){this.level=0,this._builderOptions=p}return g.prototype.declaration=function(p,v,w){},g.prototype.docType=function(p,v,w){},g.prototype.comment=function(p){},g.prototype.text=function(p){},g.prototype.instruction=function(p,v){},g.prototype.cdata=function(p){},g.prototype.openTagBegin=function(p){},g.prototype.openTagEnd=function(p,v,w){},g.prototype.closeTag=function(p){},g.prototype.attributes=function(p){var v,w;try{for(var m=o(p),y=m.next();!y.done;y=m.next()){var x=y.value;this.attribute(x[1]===null?x[2]:x[1]+":"+x[2],x[3])}}catch(C){v={error:C}}finally{try{y&&!y.done&&(w=m.return)&&w.call(m)}finally{if(v)throw v.error}}},g.prototype.attribute=function(p,v){},g.prototype.beginElement=function(p){},g.prototype.endElement=function(p){},g.prototype.serializeNode=function(p,v){var w=p._nodeDocument!==void 0&&p._nodeDocument._hasNamespaces;if(this.level=0,this.currentNode=p,w){var m=new f.NamespacePrefixMap;m.set("xml",u.namespace.XML),this._serializeNodeNS(p,null,m,{value:1},v)}else this._serializeNode(p,v)},g.prototype._serializeNodeNS=function(p,v,w,m,y){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElementNS(p,v,w,m,y);break;case c.NodeType.Document:this._serializeDocumentNS(p,v,w,m,y);break;case c.NodeType.Comment:this._serializeComment(p,y);break;case c.NodeType.Text:this._serializeText(p,y);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragmentNS(p,v,w,m,y);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,y);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,y);break;case c.NodeType.CData:this._serializeCData(p,y);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeNode=function(p,v){switch(this.currentNode=p,p.nodeType){case c.NodeType.Element:this._serializeElement(p,v);break;case c.NodeType.Document:this._serializeDocument(p,v);break;case c.NodeType.Comment:this._serializeComment(p,v);break;case c.NodeType.Text:this._serializeText(p,v);break;case c.NodeType.DocumentFragment:this._serializeDocumentFragment(p,v);break;case c.NodeType.DocumentType:this._serializeDocumentType(p,v);break;case c.NodeType.ProcessingInstruction:this._serializeProcessingInstruction(p,v);break;case c.NodeType.CData:this._serializeCData(p,v);break;default:throw new Error("Unknown node type: "+p.nodeType)}},g.prototype._serializeElementNS=function(p,v,w,m,y){var x,C,S=[];if(y&&(p.localName.indexOf(":")!==-1||!d.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var T="",_=!1,E=!1,D=w.copy(),b={},I=this._recordNamespaceInformation(p,D,b),R=v,M=p.namespaceURI;if(R===M)I!==null&&(E=!0),T=M===u.namespace.XML?"xml:"+p.localName:p.localName,this.beginElement(T),this.openTagBegin(T);else{var P=p.prefix,k=null;if(P===null&&M===I||(k=D.get(P,M)),P==="xmlns"){if(y)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");k=P}k!==null?(T=k+":"+p.localName,I!==null&&I!==u.namespace.XML&&(R=I||null),this.beginElement(T),this.openTagBegin(T)):P!==null?(P in b&&(P=this._generatePrefix(M,D,m)),D.set(P,M),T+=P+":"+p.localName,this.beginElement(T),this.openTagBegin(T),S.push([null,"xmlns",P,this._serializeAttributeValue(M,y)]),I!==null&&(R=I||null)):I===null||I!==null&&I!==M?(E=!0,T+=p.localName,R=M,this.beginElement(T),this.openTagBegin(T),S.push([null,null,"xmlns",this._serializeAttributeValue(M,y)])):(T+=p.localName,R=M,this.beginElement(T),this.openTagBegin(T))}S.push.apply(S,s(this._serializeAttributesNS(p,D,m,b,E,y))),this.attributes(S);var z=M===u.namespace.HTML;if(z&&p.childNodes.length===0&&g._VoidElementNames.has(p.localName)?(this.openTagEnd(T,!0,!0),this.endElement(T),_=!0):z||p.childNodes.length!==0?this.openTagEnd(T,!1,!1):(this.openTagEnd(T,!0,!1),this.endElement(T),_=!0),!_){if(!(z&&p.localName==="template"))try{for(var A=o(p.childNodes),L=A.next();!L.done;L=A.next()){var N=L.value;this.level++,this._serializeNodeNS(N,R,D,m,y),this.level--}}catch(H){x={error:H}}finally{try{L&&!L.done&&(C=A.return)&&C.call(A)}finally{if(x)throw x.error}}this.closeTag(T),this.endElement(T)}},g.prototype._serializeElement=function(p,v){var w,m;if(v&&(p.localName.indexOf(":")!==-1||!d.xml_isName(p.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var y=!1,x=p.localName;this.beginElement(x),this.openTagBegin(x);var C=this._serializeAttributes(p,v);if(this.attributes(C),p.hasChildNodes()?this.openTagEnd(x,!1,!1):(this.openTagEnd(x,!0,!1),this.endElement(x),y=!0),!y){try{for(var S=o(p._children),T=S.next();!T.done;T=S.next()){var _=T.value;this.level++,this._serializeNode(_,v),this.level--}}catch(E){w={error:E}}finally{try{T&&!T.done&&(m=S.return)&&m.call(S)}finally{if(w)throw w.error}}this.closeTag(x),this.endElement(x)}},g.prototype._serializeDocumentNS=function(p,v,w,m,y){var x,C;if(y&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var S=o(p.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;this._serializeNodeNS(_,v,w,m,y)}}catch(E){x={error:E}}finally{try{T&&!T.done&&(C=S.return)&&C.call(S)}finally{if(x)throw x.error}}},g.prototype._serializeDocument=function(p,v){var w,m;if(v&&p.documentElement===null)throw new Error("Missing document element (well-formed required).");try{for(var y=o(p._children),x=y.next();!x.done;x=y.next()){var C=x.value;this._serializeNode(C,v)}}catch(S){w={error:S}}finally{try{x&&!x.done&&(m=y.return)&&m.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeComment=function(p,v){if(v&&(!d.xml_isLegalChar(p.data)||p.data.indexOf("--")!==-1||p.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");this.comment(p.data)},g.prototype._serializeText=function(p,v){if(v&&!d.xml_isLegalChar(p.data))throw new Error("Text data contains invalid characters (well-formed required).");var w=p.data.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.text(w)},g.prototype._serializeDocumentFragmentNS=function(p,v,w,m,y){var x,C;try{for(var S=o(p.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;this._serializeNodeNS(_,v,w,m,y)}}catch(E){x={error:E}}finally{try{T&&!T.done&&(C=S.return)&&C.call(S)}finally{if(x)throw x.error}}},g.prototype._serializeDocumentFragment=function(p,v){var w,m;try{for(var y=o(p._children),x=y.next();!x.done;x=y.next()){var C=x.value;this._serializeNode(C,v)}}catch(S){w={error:S}}finally{try{x&&!x.done&&(m=y.return)&&m.call(y)}finally{if(w)throw w.error}}},g.prototype._serializeDocumentType=function(p,v){if(v&&!d.xml_isPubidChar(p.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(v&&(!d.xml_isLegalChar(p.systemId)||p.systemId.indexOf('"')!==-1&&p.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");this.docType(p.name,p.publicId,p.systemId)},g.prototype._serializeProcessingInstruction=function(p,v){if(v&&(p.target.indexOf(":")!==-1||/^xml$/i.test(p.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(v&&(!d.xml_isLegalChar(p.data)||p.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");this.instruction(p.target,p.data)},g.prototype._serializeCData=function(p,v){if(v&&p.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");this.cdata(p.data)},g.prototype._serializeAttributesNS=function(p,v,w,m,y,x){var C,S,T=[],_=x?new l.LocalNameSet:void 0;try{for(var E=o(p.attributes),D=E.next();!D.done;D=E.next()){var b=D.value;if(x||y||b.namespaceURI!==null){if(x&&_&&_.has(b.namespaceURI,b.localName))throw new Error("Element contains duplicate attributes (well-formed required).");x&&_&&_.set(b.namespaceURI,b.localName);var I=b.namespaceURI,R=null;if(I!==null)if(R=v.get(b.prefix,I),I===u.namespace.XMLNS){if(b.value===u.namespace.XML||b.prefix===null&&y||b.prefix!==null&&(!(b.localName in m)||m[b.localName]!==b.value)&&v.has(b.localName,b.value))continue;if(x&&b.value===u.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(x&&b.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");b.prefix==="xmlns"&&(R="xmlns")}else R===null&&(R=b.prefix===null||v.hasPrefix(b.prefix)&&!v.has(b.prefix,I)?this._generatePrefix(I,v,w):b.prefix,T.push([null,"xmlns",R,this._serializeAttributeValue(I,x)]));if(x&&(b.localName.indexOf(":")!==-1||!d.xml_isName(b.localName)||b.localName==="xmlns"&&I===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");T.push([I,R,b.localName,this._serializeAttributeValue(b.value,x)])}else T.push([null,null,b.localName,this._serializeAttributeValue(b.value,x)])}}catch(M){C={error:M}}finally{try{D&&!D.done&&(S=E.return)&&S.call(E)}finally{if(C)throw C.error}}return T},g.prototype._serializeAttributes=function(p,v){var w,m,y=[],x=v?{}:void 0;try{for(var C=o(p.attributes),S=C.next();!S.done;S=C.next()){var T=S.value;if(v){if(v&&x&&T.localName in x)throw new Error("Element contains duplicate attributes (well-formed required).");if(v&&x&&(x[T.localName]=!0),v&&(T.localName.indexOf(":")!==-1||!d.xml_isName(T.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");y.push([null,null,T.localName,this._serializeAttributeValue(T.value,v)])}else y.push([null,null,T.localName,this._serializeAttributeValue(T.value,v)])}}catch(_){w={error:_}}finally{try{S&&!S.done&&(m=C.return)&&m.call(C)}finally{if(w)throw w.error}}return y},g.prototype._recordNamespaceInformation=function(p,v,w){var m,y,x=null;try{for(var C=o(p.attributes),S=C.next();!S.done;S=C.next()){var T=S.value,_=T.namespaceURI,E=T.prefix;if(_===u.namespace.XMLNS){if(E===null){x=T.value;continue}var D=T.localName,b=T.value;if(b===u.namespace.XML||(b===""&&(b=null),v.has(D,b)))continue;v.set(D,b),w[D]=b||""}}}catch(I){m={error:I}}finally{try{S&&!S.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return x},g.prototype._generatePrefix=function(p,v,w){var m="ns"+w.value.toString();return w.value++,v.set(m,p),m},g.prototype._serializeAttributeValue=function(p,v){if(v&&p!==null&&!d.xml_isLegalChar(p))throw new Error("Invalid characters in attribute value.");return p===null?"":p.replace(/(?!&([^&;]*);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},g._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),g}();n.BaseWriter=h},function(r,n,i){var o=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(v,w){var m=typeof Symbol=="function"&&v[Symbol.iterator];if(!m)return v;var y,x,C=m.call(v),S=[];try{for(;(w===void 0||w-- >0)&&!(y=C.next()).done;)S.push(y.value)}catch(T){x={error:T}}finally{try{y&&!y.done&&(m=C.return)&&m.call(C)}finally{if(x)throw x.error}}return S};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(7),f=i(29),u=i(17),d=i(97);function h(){var v=s.dom.window;v._mutationObserverMicrotaskQueued||(v._mutationObserverMicrotaskQueued=!0,Promise.resolve().then(function(){g()}))}function g(){var v,w,m,y,x=s.dom.window;x._mutationObserverMicrotaskQueued=!1;var C=l.set.clone(x._mutationObservers),S=l.set.clone(x._signalSlots);l.set.empty(x._signalSlots);var T=function(R){var M=l.list.clone(R._recordQueue);l.list.empty(R._recordQueue);for(var P=0;P<R._nodeList.length;P++){var k=R._nodeList[P];l.list.remove(k._registeredObserverList,function(z){return c.Guard.isTransientRegisteredObserver(z)&&z.observer===R})}if(!l.list.isEmpty(M))try{R._callback.call(R,M,R)}catch{}};try{for(var _=o(C),E=_.next();!E.done;E=_.next())T(E.value)}catch(R){v={error:R}}finally{try{E&&!E.done&&(w=_.return)&&w.call(_)}finally{if(v)throw v.error}}if(s.dom.features.slots)try{for(var D=o(S),b=D.next();!b.done;b=D.next()){var I=b.value;d.event_fireAnEvent("slotchange",I,void 0,{bubbles:!0})}}catch(R){m={error:R}}finally{try{b&&!b.done&&(y=D.return)&&y.call(D)}finally{if(m)throw m.error}}}function p(v,w,m,y,x,C,S,T,_){for(var E,D,b=new Map,I=u.tree_getFirstAncestorNode(w,!0);I!==null;){for(var R=0;R<I._registeredObserverList.length;R++){var M=I._registeredObserverList[R],P=M.options;if((I===w||P.subtree)&&(v!=="attributes"||P.attributes)&&(v!=="attributes"||!P.attributeFilter||P.attributeFilter.indexOf(m||"")&&y===null)&&(v!=="characterData"||P.characterData)&&(v!=="childList"||P.childList)){var k=M.observer;b.has(k)||b.set(k,null),(v==="attributes"&&P.attributeOldValue||v==="characterData"&&P.characterDataOldValue)&&b.set(k,x)}}I=u.tree_getNextAncestorNode(w,I,!0)}try{for(var z=o(b),A=z.next();!A.done;A=z.next()){var L=a(A.value,2),N=L[0],H=L[1],ee=f.create_mutationRecord(v,w,f.create_nodeListStatic(w,C),f.create_nodeListStatic(w,S),T,_,m,y,H);N._recordQueue.push(ee)}}catch(oe){E={error:oe}}finally{try{A&&!A.done&&(D=z.return)&&D.call(z)}finally{if(E)throw E.error}}h()}n.observer_queueAMutationObserverMicrotask=h,n.observer_notifyMutationObservers=g,n.observer_queueMutationRecord=p,n.observer_queueTreeMutationRecord=function(v,w,m,y,x){p("childList",v,null,null,null,w,m,y,x)},n.observer_queueAttributeMutationRecord=function(v,w,m,y){p("attributes",v,w,m,y,[],[],null,null)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(3),c=i(9),l=i(29),f=i(73),u=i(51),d=i(30),h=i(37),g=i(106);function p(C,S,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,C._localName,C._namespace,C._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&f.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[C._localName,C._value,T,C._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(S,C._localName,C._value,T,C._namespace),C._value=T}function v(C,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,C._localName,C._namespace,null),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&f.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[C._localName,null,C._value,C._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(S,C._localName,null,C._value,C._namespace),S._attributeList._asArray().push(C),C._element=S,S._nodeDocument._hasNamespaces||C._namespace===null&&C._namespacePrefix===null&&C._localName!=="xmlns"||(S._nodeDocument._hasNamespaces=!0)}function w(C,S){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(S,C._localName,C._namespace,C._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(S)&&f.customElement_enqueueACustomElementCallbackReaction(S,"attributeChangedCallback",[C._localName,C._value,null,C._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(S,C._localName,C._value,null,C._namespace);var T=S._attributeList._asArray().indexOf(C);S._attributeList._asArray().splice(T,1),C._element=null}function m(C,S,T){o.dom.features.mutationObservers&&u.observer_queueAttributeMutationRecord(T,C._localName,C._namespace,C._value),o.dom.features.customElements&&s.Guard.isCustomElementNode(T)&&f.customElement_enqueueACustomElementCallbackReaction(T,"attributeChangedCallback",[C._localName,C._value,S._value,C._namespace]),o.dom.features.steps&&d.dom_runAttributeChangeSteps(T,C._localName,C._value,S._value,C._namespace);var _=T._attributeList._asArray().indexOf(C);_!==-1&&(T._attributeList._asArray()[_]=S),C._element=null,S._element=T,T._nodeDocument._hasNamespaces||S._namespace===null&&S._namespacePrefix===null&&S._localName!=="xmlns"||(T._nodeDocument._hasNamespaces=!0)}function y(C,S){return S._namespace===a.namespace.HTML&&S._nodeDocument._type==="html"&&(C=C.toLowerCase()),S._attributeList._asArray().find(function(T){return T._qualifiedName===C})||null}function x(C,S,T){var _=C||null;return T._attributeList._asArray().find(function(E){return E._namespace===_&&E._localName===S})||null}n.element_has=function(C,S){return S._attributeList._asArray().indexOf(C)!==-1},n.element_change=p,n.element_append=v,n.element_remove=w,n.element_replace=m,n.element_getAnAttributeByName=y,n.element_getAnAttributeByNamespaceAndLocalName=x,n.element_getAnAttributeValue=function(C,S,T){T===void 0&&(T="");var _=x(T,S,C);return _===null?"":_._value},n.element_setAnAttribute=function(C,S){if(C._element!==null&&C._element!==S)throw new c.InUseAttributeError("This attribute already exists in the document: "+C._qualifiedName+" as a child of "+C._element._qualifiedName+".");var T=x(C._namespace||"",C._localName,S);return T===C?C:(T!==null?m(T,C,S):v(C,S),T)},n.element_setAnAttributeValue=function(C,S,T,_,E){_===void 0&&(_=null),E===void 0&&(E=null);var D=x(E||"",S,C);if(D===null){var b=l.create_attr(C._nodeDocument,S);return b._namespace=E,b._namespacePrefix=_,b._value=T,void v(b,C)}p(D,C,T)},n.element_removeAnAttributeByName=function(C,S){var T=y(C,S);return T!==null&&w(T,S),T},n.element_removeAnAttributeByNamespaceAndLocalName=function(C,S,T){var _=x(C,S,T);return _!==null&&w(_,T),_},n.element_createAnElement=function(C,S,T,_,E,D){_===void 0&&(_=null),E===void 0&&(E=null),D===void 0&&(D=!1);var b=null;if(!o.dom.features.customElements)return(b=l.create_element(C,S,T,_))._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b;var I=f.customElement_lookUpACustomElementDefinition(C,T,S,E);if(I!==null&&I.name!==I.localName)(b=new(g.document_elementInterface(S,a.namespace.HTML)))._localName=S,b._namespace=a.namespace.HTML,b._namespacePrefix=_,b._customElementState="undefined",b._customElementDefinition=null,b._is=E,b._nodeDocument=C,D?f.customElement_upgrade(I,b):f.customElement_enqueueACustomElementUpgradeReaction(b,I);else if(I!==null)if(D)try{var R=new I.constructor;if(console.assert(R._customElementState!==void 0),console.assert(R._customElementDefinition!==void 0),console.assert(R._namespace===a.namespace.HTML),R._attributeList.length!==0)throw new c.NotSupportedError("Custom element already has attributes.");if(R._children.size!==0)throw new c.NotSupportedError("Custom element already has child nodes.");if(R._parent!==null)throw new c.NotSupportedError("Custom element already has a parent node.");if(R._nodeDocument!==C)throw new c.NotSupportedError("Custom element is already in a document.");if(R._localName!==S)throw new c.NotSupportedError("Custom element has a different local name.");R._namespacePrefix=_,R._is=null}catch{(b=l.create_htmlUnknownElement(C,S,a.namespace.HTML,_))._customElementState="failed",b._customElementDefinition=null,b._is=null}else(b=l.create_htmlElement(C,S,a.namespace.HTML,_))._customElementState="undefined",b._customElementDefinition=null,b._is=null,f.customElement_enqueueACustomElementUpgradeReaction(b,I);else(b=new(g.document_elementInterface(S,T)))._localName=S,b._namespace=T,b._namespacePrefix=_,b._customElementState="uncustomized",b._customElementDefinition=null,b._is=E,b._nodeDocument=C,T!==a.namespace.HTML||E===null&&!f.customElement_isValidCustomElementName(S)||(b._customElementState="undefined");if(b===null)throw new Error("Unable to create element.");return b},n.element_insertAdjacent=function(C,S,T){switch(S.toLowerCase()){case"beforebegin":return C._parent===null?null:h.mutation_preInsert(T,C._parent,C);case"afterbegin":return h.mutation_preInsert(T,C,C._firstChild);case"beforeend":return h.mutation_preInsert(T,C,null);case"afterend":return C._parent===null?null:h.mutation_preInsert(T,C._parent,C._nextSibling);default:throw new c.SyntaxError(`Invalid 'where' argument. "beforebegin", "afterbegin", "beforeend" or "afterend" expected`)}}},function(r,n,i){function o(a,s){Error.call(this),this.name="YAMLException",this.reason=a,this.mark=s,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.toString=function(a){var s=this.name+": ";return s+=this.reason||"(unknown reason)",!a&&this.mark&&(s+=" "+this.mark.toString()),s},r.exports=o},function(r,n,i){var o=i(39);r.exports=new o({include:[i(181)],implicit:[i(293),i(294)],explicit:[i(295),i(296),i(297),i(298)]})},function(r,n,i){var o=i(16),a=i(79),s=i(40),c=i(24),l=i(56),f=i(14),u=i(115),d=Object.getOwnPropertyDescriptor;n.f=o?d:function(h,g){if(h=c(h),g=l(g,!0),u)try{return d(h,g)}catch{}if(f(h,g))return s(!a.f.call(h,g),h[g])}},function(r,n,i){var o=i(13);r.exports=function(a,s){if(!o(a))return a;var c,l;if(s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a))||typeof(c=a.valueOf)=="function"&&!o(l=c.call(a))||!s&&typeof(c=a.toString)=="function"&&!o(l=c.call(a)))return l;throw TypeError("Can't convert object to primitive value")}},function(r,n,i){var o=i(81),a=i(58),s=o("keys");r.exports=function(c){return s[c]||(s[c]=a(c))}},function(r,n){var i=0,o=Math.random();r.exports=function(a){return"Symbol("+String(a===void 0?"":a)+")_"+(++i+o).toString(36)}},function(r,n,i){var o=i(42);r.exports=Array.isArray||function(a){return o(a)=="Array"}},function(r,n,i){var o,a=i(18),s=i(188),c=i(84),l=i(45),f=i(189),u=i(116),d=i(57),h=d("IE_PROTO"),g=function(){},p=function(w){return"<script>"+w+"<\/script>"},v=function(){try{o=document.domain&&new ActiveXObject("htmlfile")}catch{}var w,m;v=o?function(x){x.write(p("")),x.close();var C=x.parentWindow.Object;return x=null,C}(o):((m=u("iframe")).style.display="none",f.appendChild(m),m.src="javascript:",(w=m.contentWindow.document).open(),w.write(p("document.F=Object")),w.close(),w.F);for(var y=c.length;y--;)delete v.prototype[c[y]];return v()};l[h]=!0,r.exports=Object.create||function(w,m){var y;return w!==null?(g.prototype=a(w),y=new g,g.prototype=null,y[h]=w):y=v(),m===void 0?y:s(y,m)}},function(r,n,i){var o=i(121),a=i(84);r.exports=Object.keys||function(s){return o(s,a)}},function(r,n,i){var o=i(15).f,a=i(14),s=i(5)("toStringTag");r.exports=function(c,l,f){c&&!a(c=f?c:c.prototype,s)&&o(c,s,{configurable:!0,value:l})}},function(r,n,i){var o=i(8),a=i(5),s=i(129),c=a("species");r.exports=function(l){return s>=51||!o(function(){var f=[];return(f.constructor={})[c]=function(){return{foo:1}},f[l](Boolean).foo!==1})}},function(r,n,i){var o=i(4),a=i(122).indexOf,s=i(48),c=i(28),l=[].indexOf,f=!!l&&1/[1].indexOf(1,-0)<0,u=s("indexOf"),d=c("indexOf",{ACCESSORS:!0,1:0});o({target:"Array",proto:!0,forced:f||!u||!d},{indexOf:function(h){return f?l.apply(this,arguments)||0:a(this,h,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(16),a=i(15).f,s=Function.prototype,c=s.toString,l=/^\s*function ([^ (]*)/;o&&!("name"in s)&&a(s,"name",{configurable:!0,get:function(){try{return c.call(this).match(l)[1]}catch{return""}}})},function(r,n,i){var o=i(25),a=i(18),s=i(8),c=i(136),l=RegExp.prototype,f=l.toString,u=s(function(){return f.call({source:"a",flags:"b"})!="/a/b"}),d=f.name!="toString";(u||d)&&o(RegExp.prototype,"toString",function(){var h=a(this),g=String(h.source),p=h.flags;return"/"+g+"/"+String(p===void 0&&h instanceof RegExp&&!("flags"in l)?c.call(h):p)},{unsafe:!0})},function(r,n,i){i(31),i(32),i(33),i(19),i(138),i(20),i(66),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(1),l=i(2),f=function(u){function d(h,g){var p=u.call(this,h)||this;return p._writerOptions=c.applyDefaults(g,{format:"object",wellFormed:!1,group:!1,verbose:!1}),p}return a(d,u),d.prototype.serialize=function(h){return this._currentList=[],this._currentIndex=0,this._listRegister=[this._currentList],this.serializeNode(h,this._writerOptions.wellFormed),this._process(this._currentList,this._writerOptions)},d.prototype._process=function(h,g){var p,v,w,m,y,x,C;if(h.length===0)return{};for(var S={},T=!1,_=0,E=0,D=0,b=0,I=0;I<h.length;I++){var R=h[I];switch(Ce=Object.keys(R)[0]){case"@":continue;case"#":_++;break;case"!":E++;break;case"?":D++;break;case"$":b++;break;default:S[Ce]?T=!0:S[Ce]=!0}}var M=this._getAttrKey(),P=this._getNodeKey(l.NodeType.Text),k=this._getNodeKey(l.NodeType.Comment),z=this._getNodeKey(l.NodeType.ProcessingInstruction),A=this._getNodeKey(l.NodeType.CData);if(_===1&&h.length===1&&c.isString(h[0]["#"]))return h[0]["#"];if(T){var L={};for(I=0;I<h.length;I++)if(R=h[I],(Ce=Object.keys(R)[0])==="@"){var N=R["@"];(F=Object.keys(N)).length===1?L[M+F[0]]=N[F[0]]:L[M]=R["@"]}var H=[];for(I=0;I<h.length;I++)switch(R=h[I],Ce=Object.keys(R)[0]){case"@":break;case"#":H.push(((p={})[P]=R["#"],p));break;case"!":H.push(((v={})[k]=R["!"],v));break;case"?":H.push(((w={})[z]=R["?"],w));break;case"$":H.push(((m={})[A]=R.$,m));break;default:if(($=R)[Ce].length!==0&&c.isArray($[Ce][0])){for(var ee=[],oe=$[Ce],de=0;de<oe.length;de++)ee.push(this._process(oe[de],g));H.push(((y={})[Ce]=ee,y))}else g.verbose?H.push(((x={})[Ce]=[this._process($[Ce],g)],x)):H.push(((C={})[Ce]=this._process($[Ce],g),C))}return L[P]=H,L}var ue=1,me=1,Ee=1,_e=1;for(L={},I=0;I<h.length;I++){var Ce;switch(R=h[I],Ce=Object.keys(R)[0]){case"@":N=R["@"];var F=Object.keys(N);if(g.group&&F.length!==1)L[M]=N;else for(var O in N)L[M+O]=N[O];break;case"#":ue=this._processSpecItem(R["#"],L,g.group,P,_,ue);break;case"!":me=this._processSpecItem(R["!"],L,g.group,k,E,me);break;case"?":Ee=this._processSpecItem(R["?"],L,g.group,z,D,Ee);break;case"$":_e=this._processSpecItem(R.$,L,g.group,A,b,_e);break;default:var $;if(($=R)[Ce].length!==0&&c.isArray($[Ce][0])){ee=[],oe=$[Ce];for(var W=0;W<oe.length;W++)ee.push(this._process(oe[W],g));L[Ce]=ee}else g.verbose?L[Ce]=[this._process($[Ce],g)]:L[Ce]=this._process($[Ce],g)}}return L},d.prototype._processSpecItem=function(h,g,p,v,w,m){var y,x;if(!p&&c.isArray(h)&&w+h.length>2)try{for(var C=s(h),S=C.next();!S.done;S=C.next()){var T=S.value;g[v+(m++).toString()]=T}}catch(_){y={error:_}}finally{try{S&&!S.done&&(x=C.return)&&x.call(C)}finally{if(y)throw y.error}}else g[w>1?v+(m++).toString():v]=h;return m},d.prototype.beginElement=function(h){var g,p,v=[];if(this._currentList.length===0)this._currentList.push(((g={})[h]=v,g));else{var w=this._currentList[this._currentList.length-1];this._isElementNode(w,h)?w[h].length!==0&&c.isArray(w[h][0])?w[h].push(v):w[h]=[w[h],v]:this._currentList.push(((p={})[h]=v,p))}this._currentIndex++,this._listRegister.length>this._currentIndex?this._listRegister[this._currentIndex]=v:this._listRegister.push(v),this._currentList=v},d.prototype.endElement=function(){this._currentList=this._listRegister[--this._currentIndex]},d.prototype.attribute=function(h,g){var p,v;if(this._currentList.length===0)this._currentList.push({"@":(p={},p[h]=g,p)});else{var w=this._currentList[this._currentList.length-1];this._isAttrNode(w)?w["@"][h]=g:this._currentList.push({"@":(v={},v[h]=g,v)})}},d.prototype.comment=function(h){if(this._currentList.length===0)this._currentList.push({"!":h});else{var g=this._currentList[this._currentList.length-1];this._isCommentNode(g)?c.isArray(g["!"])?g["!"].push(h):g["!"]=[g["!"],h]:this._currentList.push({"!":h})}},d.prototype.text=function(h){if(this._currentList.length===0)this._currentList.push({"#":h});else{var g=this._currentList[this._currentList.length-1];this._isTextNode(g)?c.isArray(g["#"])?g["#"].push(h):g["#"]=[g["#"],h]:this._currentList.push({"#":h})}},d.prototype.instruction=function(h,g){var p=g===""?h:h+" "+g;if(this._currentList.length===0)this._currentList.push({"?":p});else{var v=this._currentList[this._currentList.length-1];this._isInstructionNode(v)?c.isArray(v["?"])?v["?"].push(p):v["?"]=[v["?"],p]:this._currentList.push({"?":p})}},d.prototype.cdata=function(h){if(this._currentList.length===0)this._currentList.push({$:h});else{var g=this._currentList[this._currentList.length-1];this._isCDATANode(g)?c.isArray(g.$)?g.$.push(h):g.$=[g.$,h]:this._currentList.push({$:h})}},d.prototype._isAttrNode=function(h){return"@"in h},d.prototype._isTextNode=function(h){return"#"in h},d.prototype._isCommentNode=function(h){return"!"in h},d.prototype._isInstructionNode=function(h){return"?"in h},d.prototype._isCDATANode=function(h){return"$"in h},d.prototype._isElementNode=function(h,g){return g in h},d.prototype._getAttrKey=function(){return this._builderOptions.convert.att},d.prototype._getNodeKey=function(h){switch(h){case l.NodeType.Comment:return this._builderOptions.convert.comment;case l.NodeType.Text:return this._builderOptions.convert.text;case l.NodeType.ProcessingInstruction:return this._builderOptions.convert.ins;case l.NodeType.CData:return this._builderOptions.convert.cdata;default:throw new Error("Invalid node type.")}},d}(i(50).BaseWriter);n.ObjectWriter=f},function(r,n,i){var o=i(4),a=i(93);o({target:"RegExp",proto:!0,forced:/./.exec!==a},{exec:a})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(){this._items={},this._nullItems={}}return a.prototype.set=function(s,c){s===null?this._nullItems[c]=!0:(this._items[s]||(this._items[s]={}),this._items[s][c]=!0)},a.prototype.has=function(s,c){return s===null?this._nullItems[c]===!0:!!this._items[s]&&this._items[s][c]===!0},a}();n.LocalNameSet=o},function(r,n,i){var o=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return v};Object.defineProperty(n,"__esModule",{value:!0});var a=i(9),s=i(3),c=i(0),l=function(){function f(){}return Object.defineProperty(f.prototype,"_eventListenerList",{get:function(){return this.__eventListenerList||(this.__eventListenerList=[])},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"_eventHandlerMap",{get:function(){return this.__eventHandlerMap||(this.__eventHandlerMap={})},enumerable:!0,configurable:!0}),f.prototype.addEventListener=function(u,d,h){h===void 0&&(h={passive:!1,once:!1,capture:!1});var g,p=o(c.eventTarget_flattenMore(h),3),v=p[0],w=p[1],m=p[2];d&&(g=s.Guard.isEventListener(d)?d:{handleEvent:d},c.eventTarget_addEventListener(this,{type:u,callback:g,capture:v,passive:w,once:m,removed:!1}))},f.prototype.removeEventListener=function(u,d,h){h===void 0&&(h={capture:!1});var g=c.eventTarget_flatten(h);if(d)for(var p=0;p<this._eventListenerList.length;p++){var v=this._eventListenerList[p];if(v.type===u&&v.capture===g){if(s.Guard.isEventListener(d)&&v.callback===d){c.eventTarget_removeEventListener(this,v,p);break}if(d&&v.callback.handleEvent===d){c.eventTarget_removeEventListener(this,v,p);break}}}},f.prototype.dispatchEvent=function(u){if(u._dispatchFlag||!u._initializedFlag)throw new a.InvalidStateError;return u._isTrusted=!1,c.event_dispatch(u,this)},f.prototype._getTheParent=function(u){return null},f}();n.EventTargetImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(34),c=i(0),l=function(f){function u(d){var h=f.call(this)||this;return h._data=d,h}return a(u,f),Object.defineProperty(u.prototype,"data",{get:function(){return this._data},set:function(d){c.characterData_replaceData(this,0,this._data.length,d)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"length",{get:function(){return this._data.length},enumerable:!0,configurable:!0}),u.prototype.substringData=function(d,h){return c.characterData_substringData(this,d,h)},u.prototype.appendData=function(d){return c.characterData_replaceData(this,this._data.length,0,d)},u.prototype.insertData=function(d,h){c.characterData_replaceData(this,d,0,h)},u.prototype.deleteData=function(d,h){c.characterData_replaceData(this,d,h,"")},u.prototype.replaceData=function(d,h,g){c.characterData_replaceData(this,d,h,g)},Object.defineProperty(u.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),u.prototype.before=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.after=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.replaceWith=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];throw new Error("Mixin: ChildNode not implemented.")},u.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},u}(s.NodeImpl);n.CharacterDataImpl=l},function(r,n,i){var o=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],x=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&x>=w.length&&(w=void 0),{value:w&&w[x++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var x,C,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(x=S.next()).done;)T.push(x.value)}catch(_){C={error:_}}finally{try{x&&!x.done&&(y=S.return)&&y.call(S)}finally{if(C)throw C.error}}return T},s=this&&this.__spread||function(){for(var w=[],m=0;m<arguments.length;m++)w=w.concat(a(arguments[m]));return w};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(3),f=i(1),u=i(17),d=i(51);function h(w){c.dom.window._signalSlots.add(w),d.observer_queueAMutationObserverMicrotask()}function g(w,m){m===void 0&&(m=!1);var y=l.Cast.asNode(w)._parent;if(y===null)return null;var x=y._shadowRoot||null;if(x===null||m&&x._mode!=="open")return null;for(var C=u.tree_getFirstDescendantNode(x,!1,!0,function(S){return l.Guard.isSlot(S)});C!==null;){if(C._name===w._name)return C;C=u.tree_getNextDescendantNode(x,C,!1,!0,function(S){return l.Guard.isSlot(S)})}return null}function p(w){var m,y,x=[],C=u.tree_rootNode(w);if(!l.Guard.isShadowRoot(C))return x;var S=C._host;try{for(var T=o(S._children),_=T.next();!_.done;_=T.next()){var E=_.value;l.Guard.isSlotable(E)&&g(E)===w&&x.push(E)}}catch(D){m={error:D}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}return x}function v(w){var m,y,x=p(w);if(x.length===w._assignedNodes.length){for(var C=!0,S=0;S<x.length;S++)if(x[S]!==w._assignedNodes[S]){C=!1;break}C||h(w)}w._assignedNodes=x;try{for(var T=o(x),_=T.next();!_.done;_=T.next())_.value._assignedSlot=w}catch(E){m={error:E}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}}n.shadowTree_signalASlotChange=h,n.shadowTree_isConnected=function(w){return l.Guard.isDocumentNode(u.tree_rootNode(w,!0))},n.shadowTree_isAssigned=function(w){return w._assignedSlot!==null},n.shadowTree_findASlot=g,n.shadowTree_findSlotables=p,n.shadowTree_findFlattenedSlotables=function w(m){var y,x,C,S,T=[],_=u.tree_rootNode(m);if(!l.Guard.isShadowRoot(_))return T;var E=p(m);if(f.isEmpty(E))try{for(var D=o(m._children),b=D.next();!b.done;b=D.next()){var I=b.value;l.Guard.isSlotable(I)&&E.push(I)}}catch(z){y={error:z}}finally{try{b&&!b.done&&(x=D.return)&&x.call(D)}finally{if(y)throw y.error}}try{for(var R=o(E),M=R.next();!M.done;M=R.next()){var P=M.value;if(l.Guard.isSlot(P)&&l.Guard.isShadowRoot(u.tree_rootNode(P))){var k=w(P);T.push.apply(T,s(k))}else T.push(P)}}catch(z){C={error:z}}finally{try{M&&!M.done&&(S=R.return)&&S.call(R)}finally{if(C)throw C.error}}return T},n.shadowTree_assignSlotables=v,n.shadowTree_assignSlotablesForATree=function(w){for(var m=u.tree_getFirstDescendantNode(w,!0,!1,function(y){return l.Guard.isSlot(y)});m!==null;)v(m),m=u.tree_getNextDescendantNode(w,m,!0,!1,function(y){return l.Guard.isSlot(y)})},n.shadowTree_assignASlot=function(w){var m=g(w);m!==null&&v(m)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=/[a-z]([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*-([\0-\t\x2D\._a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*/,a=new Set(["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"]),s=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),c=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),l=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);n.customElement_isValidCustomElementName=function(f){return!!o.test(f)&&!a.has(f)},n.customElement_isValidElementName=function(f){return s.has(f)},n.customElement_isVoidElementName=function(f){return c.has(f)},n.customElement_isValidShadowHostName=function(f){return l.has(f)},n.customElement_enqueueACustomElementUpgradeReaction=function(f,u){},n.customElement_enqueueACustomElementCallbackReaction=function(f,u,d){},n.customElement_upgrade=function(f,u){},n.customElement_tryToUpgrade=function(f){},n.customElement_lookUpACustomElementDefinition=function(f,u,d,h){return null}},function(r,n,i){i(4)({target:"String",proto:!0},{repeat:i(259)})},function(r,n,i){i(278),i(68),i(179),i(94),Object.defineProperty(n,"__esModule",{value:!0});var o=i(109),a=function(){function s(c){this._builderOptions=c,c.parser&&Object.assign(this,c.parser)}return s.prototype._docType=function(c,l,f,u){return c.dtd({name:l,pubID:f,sysID:u})},s.prototype._comment=function(c,l){return c.com(l)},s.prototype._text=function(c,l){return c.txt(l)},s.prototype._instruction=function(c,l,f){return c.ins(l,f)},s.prototype._cdata=function(c,l){return c.dat(l)},s.prototype._element=function(c,l,f){return l===void 0?c.ele(f):c.ele(l,f)},s.prototype._attribute=function(c,l,f,u){return l===void 0?c.att(f,u):c.att(l,f,u)},s.prototype._sanitize=function(c){return o.sanitizeInput(c,this._builderOptions.invalidCharReplacement)},s.prototype._decodeText=function(c){return c==null?c:c.replace(/&(quot|amp|apos|lt|gt);/g,function(l,f){return s._entityTable[f]}).replace(/&#(?:x([a-fA-F0-9]+)|([0-9]+));/g,function(l,f,u){return String.fromCodePoint(parseInt(f||u,f?16:10))})},s.prototype._decodeAttributeValue=function(c){return this._decodeText(c)},s.prototype.parse=function(c,l){return this._parse(c,l)},s.prototype.docType=function(c,l,f,u){return this._docType(c,l,f,u)},s.prototype.comment=function(c,l){return this._comment(c,l)},s.prototype.text=function(c,l){return this._text(c,l)},s.prototype.instruction=function(c,l,f){return this._instruction(c,l,f)},s.prototype.cdata=function(c,l){return this._cdata(c,l)},s.prototype.element=function(c,l,f){return this._element(c,l,f)},s.prototype.attribute=function(c,l,f,u){return this._attribute(c,l,f,u)},s.prototype.sanitize=function(c){return this._sanitize(c)},s._entityTable={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},s}();n.BaseReader=a},function(r,n,i){var o=i(39);r.exports=o.DEFAULT=new o({include:[i(54)],explicit:[i(299),i(300),i(301)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(185);n.XMLBuilderImpl=o.XMLBuilderImpl;var a=i(304);n.XMLBuilderCBImpl=a.XMLBuilderCBImpl;var s=i(183);n.builder=s.builder,n.create=s.create,n.fragment=s.fragment,n.convert=s.convert;var c=i(309);n.createCB=c.createCB,n.fragmentCB=c.fragmentCB},function(r,n){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch{typeof window=="object"&&(i=window)}r.exports=i},function(r,n,i){var o={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,s=a&&!o.call({1:2},1);n.f=s?function(c){var l=a(this,c);return!!l&&l.enumerable}:o},function(r,n,i){var o=i(11),a=i(21);r.exports=function(s,c){try{a(o,s,c)}catch{o[s]=c}return c}},function(r,n,i){var o=i(44),a=i(118);(r.exports=function(s,c){return a[s]||(a[s]=c!==void 0?c:{})})("versions",[]).push({version:"3.6.5",mode:o?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(r,n,i){var o=i(121),a=i(84).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(s){return o(s,a)}},function(r,n,i){var o=i(47),a=Math.max,s=Math.min;r.exports=function(c,l){var f=o(c);return f<0?a(f+l,0):s(f,l)}},function(r,n){r.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(r,n){n.f=Object.getOwnPropertySymbols},function(r,n,i){var o=i(8);r.exports=!!Object.getOwnPropertySymbols&&!o(function(){return!String(Symbol())})},function(r,n,i){var o=i(127);r.exports=function(a,s,c){if(o(a),s===void 0)return a;switch(c){case 0:return function(){return a.call(s)};case 1:return function(l){return a.call(s,l)};case 2:return function(l,f){return a.call(s,l,f)};case 3:return function(l,f,u){return a.call(s,l,f,u)}}return function(){return a.apply(s,arguments)}}},function(r,n,i){var o=i(4),a=i(195),s=i(132),c=i(133),l=i(62),f=i(21),u=i(25),d=i(5),h=i(44),g=i(49),p=i(131),v=p.IteratorPrototype,w=p.BUGGY_SAFARI_ITERATORS,m=d("iterator"),y=function(){return this};r.exports=function(x,C,S,T,_,E,D){a(S,C,T);var b,I,R,M=function(H){if(H===_&&L)return L;if(!w&&H in z)return z[H];switch(H){case"keys":case"values":case"entries":return function(){return new S(this,H)}}return function(){return new S(this)}},P=C+" Iterator",k=!1,z=x.prototype,A=z[m]||z["@@iterator"]||_&&z[_],L=!w&&A||M(_),N=C=="Array"&&z.entries||A;if(N&&(b=s(N.call(new x)),v!==Object.prototype&&b.next&&(h||s(b)===v||(c?c(b,v):typeof b[m]!="function"&&f(b,m,y)),l(b,P,!0,!0),h&&(g[P]=y))),_=="values"&&A&&A.name!=="values"&&(k=!0,L=function(){return A.call(this)}),h&&!D||z[m]===L||f(z,m,L),g[C]=L,_)if(I={values:M("values"),keys:E?L:M("keys"),entries:M("entries")},D)for(R in I)(w||k||!(R in z))&&u(z,R,I[R]);else o({target:C,proto:!0,forced:w||k},I);return I}},function(r,n,i){var o=i(4),a=i(13),s=i(59),c=i(83),l=i(26),f=i(24),u=i(134),d=i(5),h=i(63),g=i(28),p=h("slice"),v=g("slice",{ACCESSORS:!0,0:0,1:2}),w=d("species"),m=[].slice,y=Math.max;o({target:"Array",proto:!0,forced:!p||!v},{slice:function(x,C){var S,T,_,E=f(this),D=l(E.length),b=c(x,D),I=c(C===void 0?D:C,D);if(s(E)&&(typeof(S=E.constructor)!="function"||S!==Array&&!s(S.prototype)?a(S)&&(S=S[w])===null&&(S=void 0):S=void 0,S===Array||S===void 0))return m.call(E,b,I);for(T=new(S===void 0?Array:S)(y(I-b,0)),_=0;b<I;b++,_++)b in E&&u(T,_,E[b]);return T.length=_,T}})},function(r,n,i){var o={};o[i(5)("toStringTag")]="z",r.exports=String(o)==="[object z]"},function(r,n,i){i(19),i(138),i(20),i(92),i(22),i(23),Object.defineProperty(n,"__esModule",{value:!0}),n.DefaultBuilderOptions={version:"1.0",encoding:void 0,standalone:void 0,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"},invalidCharReplacement:void 0,parser:void 0},n.XMLBuilderOptionKeys=new Set(Object.keys(n.DefaultBuilderOptions)),n.DefaultXMLBuilderCBOptions={format:"xml",wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,spaceBeforeSlash:!1,keepNullNodes:!1,keepNullAttributes:!1,ignoreConverters:!1,convert:{att:"@",ins:"?",text:"#",cdata:"$",comment:"!"},defaultNamespace:{ele:void 0,att:void 0},namespaceAlias:{html:"http://www.w3.org/1999/xhtml",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"}}},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Set",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},a)},function(r,n,i){var o,a,s=i(136),c=i(221),l=RegExp.prototype.exec,f=String.prototype.replace,u=l,d=(o=/a/,a=/b*/g,l.call(o,"a"),l.call(a,"a"),o.lastIndex!==0||a.lastIndex!==0),h=c.UNSUPPORTED_Y||c.BROKEN_CARET,g=/()??/.exec("")[1]!==void 0;(d||g||h)&&(u=function(p){var v,w,m,y,x=this,C=h&&x.sticky,S=s.call(x),T=x.source,_=0,E=p;return C&&((S=S.replace("y","")).indexOf("g")===-1&&(S+="g"),E=String(p).slice(x.lastIndex),x.lastIndex>0&&(!x.multiline||x.multiline&&p[x.lastIndex-1]!==`
`)&&(T="(?: "+T+")",E=" "+E,_++),w=new RegExp("^(?:"+T+")",S)),g&&(w=new RegExp("^"+T+"$(?!\\s)",S)),d&&(v=x.lastIndex),m=l.call(C?w:x,E),C?m?(m.input=m.input.slice(_),m[0]=m[0].slice(_),m.index=x.lastIndex,x.lastIndex+=m[0].length):x.lastIndex=0:d&&m&&(x.lastIndex=x.global?m.index+m[0].length:v),g&&m&&m.length>1&&f.call(m[0],w,function(){for(y=1;y<arguments.length-2;y++)arguments[y]===void 0&&(m[y]=void 0)}),m}),r.exports=u},function(r,n,i){var o=i(225),a=i(18),s=i(27),c=i(26),l=i(47),f=i(35),u=i(226),d=i(227),h=Math.max,g=Math.min,p=Math.floor,v=/\$([$&'`]|\d\d?|<[^>]*>)/g,w=/\$([$&'`]|\d\d?)/g;o("replace",2,function(m,y,x,C){var S=C.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,T=C.REPLACE_KEEPS_$0,_=S?"$":"$0";return[function(D,b){var I=f(this),R=D==null?void 0:D[m];return R!==void 0?R.call(D,I,b):y.call(String(I),D,b)},function(D,b){if(!S&&T||typeof b=="string"&&b.indexOf(_)===-1){var I=x(y,D,this,b);if(I.done)return I.value}var R=a(D),M=String(this),P=typeof b=="function";P||(b=String(b));var k=R.global;if(k){var z=R.unicode;R.lastIndex=0}for(var A=[];;){var L=d(R,M);if(L===null||(A.push(L),!k))break;String(L[0])===""&&(R.lastIndex=u(M,c(R.lastIndex),z))}for(var N,H="",ee=0,oe=0;oe<A.length;oe++){L=A[oe];for(var de=String(L[0]),ue=h(g(l(L.index),M.length),0),me=[],Ee=1;Ee<L.length;Ee++)me.push((N=L[Ee])===void 0?N:String(N));var _e=L.groups;if(P){var Ce=[de].concat(me,ue,M);_e!==void 0&&Ce.push(_e);var F=String(b.apply(void 0,Ce))}else F=E(de,M,ue,me,_e,b);ue>=ee&&(H+=M.slice(ee,ue)+F,ee=ue+de.length)}return H+M.slice(ee)}];function E(D,b,I,R,M,P){var k=I+D.length,z=R.length,A=w;return M!==void 0&&(M=s(M),A=v),y.call(P,A,function(L,N){var H;switch(N.charAt(0)){case"$":return"$";case"&":return D;case"`":return b.slice(0,I);case"'":return b.slice(k);case"<":H=M[N.slice(1,-1)];break;default:var ee=+N;if(ee===0)return L;if(ee>z){var oe=p(ee/10);return oe===0?L:oe<=z?R[oe-1]===void 0?N.charAt(1):R[oe-1]+N.charAt(1):L}H=R[ee-1]}return H===void 0?"":H})}})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(){this._items={},this._nullItems=[]}return a.prototype.copy=function(){var s=new a;for(var c in this._items)s._items[c]=this._items[c].slice(0);return s._nullItems=this._nullItems.slice(0),s},a.prototype.get=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;if(l===null)return null;for(var f=null,u=0;u<l.length;u++)if((f=l[u])===s)return f;return f},a.prototype.has=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;return l!==null&&l.indexOf(s)!==-1},a.prototype.hasPrefix=function(s){if(this._nullItems.indexOf(s)!==-1)return!0;for(var c in this._items)if(this._items[c].indexOf(s)!==-1)return!0;return!1},a.prototype.set=function(s,c){var l=c===null?this._nullItems:this._items[c]||null;c!==null&&l===null?this._items[c]=[s]:l.push(s)},a}();n.NamespacePrefixMap=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.Surrogate=/[\uD800-\uDFFF]/,n.ScalarValue=/[\uD800-\uDFFF]/,n.NonCharacter=/[\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]/,n.ASCIICodePoint=/[\u0000-\u007F]/,n.ASCIITabOrNewLine=/[\t\n\r]/,n.ASCIIWhiteSpace=/[\t\n\f\r ]/,n.C0Control=/[\u0000-\u001F]/,n.C0ControlOrSpace=/[\u0000-\u001F ]/,n.Control=/[\u0000-\u001F\u007F-\u009F]/,n.ASCIIDigit=/[0-9]/,n.ASCIIUpperHexDigit=/[0-9A-F]/,n.ASCIILowerHexDigit=/[0-9a-f]/,n.ASCIIHexDigit=/[0-9A-Fa-f]/,n.ASCIIUpperAlpha=/[A-Z]/,n.ASCIILowerAlpha=/[a-z]/,n.ASCIIAlpha=/[A-Za-z]/,n.ASCIIAlphanumeric=/[0-9A-Za-z]/},function(r,n,i){var o=this&&this.__values||function(b){var I=typeof Symbol=="function"&&Symbol.iterator,R=I&&b[I],M=0;if(R)return R.call(b);if(b&&typeof b.length=="number")return{next:function(){return b&&M>=b.length&&(b=void 0),{value:b&&b[M++],done:!b}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(b,I){var R=typeof Symbol=="function"&&b[Symbol.iterator];if(!R)return b;var M,P,k=R.call(b),z=[];try{for(;(I===void 0||I-- >0)&&!(M=k.next()).done;)z.push(M.value)}catch(A){P={error:A}}finally{try{M&&!M.done&&(R=k.return)&&R.call(k)}finally{if(P)throw P.error}}return z},s=this&&this.__spread||function(){for(var b=[],I=0;I<arguments.length;I++)b=b.concat(a(arguments[I]));return b};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(3),u=i(171),d=i(104),h=i(9),g=i(17),p=i(72),v=i(30);function w(b,I){I===void 0&&(I=void 0),I===void 0&&(I=null);var R=m(b,I,new Date,{});return R._isTrusted=!0,R}function m(b,I,R,M){var P=new b("");return P._initializedFlag=!0,P._timeStamp=R.getTime(),Object.assign(P,M),c.dom.features.steps&&v.dom_runEventConstructingSteps(P),P}function y(b,I,R,M){var P,k,z,A;R===void 0&&(R=!1),M===void 0&&(M={value:!1});var L=!1;b._dispatchFlag=!0;var N=I;if(R){var H=I._associatedDocument;f.Guard.isDocumentNode(H)&&(N=H)}var ee=null,oe=g.tree_retarget(b._relatedTarget,I);if(I!==oe||I===b._relatedTarget){var de=[];try{for(var ue=o(b._touchTargetList),me=ue.next();!me.done;me=ue.next()){var Ee=me.value;de.push(g.tree_retarget(Ee,I))}}catch(je){P={error:je}}finally{try{me&&!me.done&&(k=ue.return)&&k.call(ue)}finally{if(P)throw P.error}}x(b,I,N,oe,de,!1);var _e=f.Guard.isMouseEvent(b)&&b._type==="click";_e&&I._activationBehavior!==void 0&&(ee=I);for(var Ce=f.Guard.isSlotable(I)&&p.shadowTree_isAssigned(I)?I:null,F=!1,O=I._getTheParent(b);O!==null&&f.Guard.isNode(O);){if(Ce!==null){if(!f.Guard.isSlot(O))throw new Error("Parent node of a slotable should be a slot.");Ce=null;var $=g.tree_rootNode(O,!0);f.Guard.isShadowRoot($)&&$._mode==="closed"&&(F=!0)}f.Guard.isSlotable(O)&&p.shadowTree_isAssigned(O)&&(Ce=O),oe=g.tree_retarget(b._relatedTarget,O),de=[];try{for(var W=(z=void 0,o(b._touchTargetList)),X=W.next();!X.done;X=W.next())Ee=X.value,de.push(g.tree_retarget(Ee,O))}catch(je){z={error:je}}finally{try{X&&!X.done&&(A=W.return)&&A.call(W)}finally{if(z)throw z.error}}f.Guard.isWindow(O)||f.Guard.isNode(O)&&f.Guard.isNode(I)&&g.tree_isAncestorOf(g.tree_rootNode(I,!0),O,!0,!0)?(_e&&b._bubbles&&ee===null&&O._activationBehavior&&(ee=O),x(b,O,null,oe,de,F)):O===oe?O=null:(I=O,_e&&ee===null&&I._activationBehavior&&(ee=I),x(b,O,I,oe,de,F)),O!==null&&(O=O._getTheParent(b)),F=!1}for(var Z=null,ne=b._path,xe=ne.length-1;xe>=0;xe--)if((Le=ne[xe]).shadowAdjustedTarget!==null){Z=Le;break}if(Z!==null)if(f.Guard.isNode(Z.shadowAdjustedTarget)&&f.Guard.isShadowRoot(g.tree_rootNode(Z.shadowAdjustedTarget,!0)))L=!0;else if(f.Guard.isNode(Z.relatedTarget)&&f.Guard.isShadowRoot(g.tree_rootNode(Z.relatedTarget,!0)))L=!0;else for(var Ie=0;Ie<Z.touchTargetList.length;Ie++){var Le=Z.touchTargetList[Ie];if(f.Guard.isNode(Le)&&f.Guard.isShadowRoot(g.tree_rootNode(Le,!0))){L=!0;break}}for(ee!==null&&ee._legacyPreActivationBehavior!==void 0&&ee._legacyPreActivationBehavior(b),xe=ne.length-1;xe>=0;xe--)(Le=ne[xe]).shadowAdjustedTarget!==null?b._eventPhase=l.EventPhase.AtTarget:b._eventPhase=l.EventPhase.Capturing,C(Le,b,"capturing",M);for(xe=0;xe<ne.length;xe++){if((Le=ne[xe]).shadowAdjustedTarget!==null)b._eventPhase=l.EventPhase.AtTarget;else{if(!b._bubbles)continue;b._eventPhase=l.EventPhase.Bubbling}C(Le,b,"bubbling",M)}}return b._eventPhase=l.EventPhase.None,b._currentTarget=null,b._path=[],b._dispatchFlag=!1,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,L&&(b._target=null,b._relatedTarget=null,b._touchTargetList=[]),ee!==null&&(b._canceledFlag||ee._activationBehavior===void 0?ee._legacyCanceledActivationBehavior!==void 0&&ee._legacyCanceledActivationBehavior(b):ee._activationBehavior(b)),!b._canceledFlag}function x(b,I,R,M,P,k){var z=!1;f.Guard.isNode(I)&&f.Guard.isShadowRoot(g.tree_rootNode(I))&&(z=!0);var A=!1;f.Guard.isShadowRoot(I)&&I._mode==="closed"&&(A=!0),b._path.push({invocationTarget:I,invocationTargetInShadowTree:z,shadowAdjustedTarget:R,relatedTarget:M,touchTargetList:P,rootOfClosedTree:A,slotInClosedTree:k})}function C(b,I,R,M){M===void 0&&(M={value:!1});for(var P=I._path,k=-1,z=0;z<P.length;z++)if(P[z]===b){k=z;break}if(k!==-1){var A=P[k];(A.shadowAdjustedTarget!==null||k>0&&(A=P[k-1]).shadowAdjustedTarget!==null)&&(I._target=A.shadowAdjustedTarget)}if(I._relatedTarget=b.relatedTarget,I._touchTargetList=b.touchTargetList,!I._stopPropagationFlag){I._currentTarget=b.invocationTarget;var L=I._currentTarget._eventListenerList,N=new(Array.bind.apply(Array,s([void 0],L)));if(!S(I,N,R,b,M)&&I._isTrusted){var H=I._type;H==="animationend"?I._type="webkitAnimationEnd":H==="animationiteration"?I._type="webkitAnimationIteration":H==="animationstart"?I._type="webkitAnimationStart":H==="transitionend"&&(I._type="webkitTransitionEnd"),S(I,N,R,b,M),I._type=H}}}function S(b,I,R,M,P){P===void 0&&(P={value:!1});for(var k=!1,z=0;z<I.length;z++){var A=I[z];if(!A.removed){if(b._type!==A.type||(k=!0,R==="capturing"&&!A.capture)||R==="bubbling"&&A.capture)continue;if(A.once&&b._currentTarget!==null){for(var L=b._currentTarget,N=-1,H=0;H<L._eventListenerList.length;H++)if(L._eventListenerList[H]===A){N=H;break}N!==-1&&L._eventListenerList.splice(N,1)}var ee=void 0,oe=void 0;f.Guard.isWindow(ee)&&(oe=ee._currentEvent,M.invocationTargetInShadowTree===!1&&(ee._currentEvent=b)),A.passive&&(b._inPassiveListenerFlag=!0);try{A.callback.handleEvent.call(b._currentTarget,b)}catch{P.value=!0}if(A.passive&&(b._inPassiveListenerFlag=!1),f.Guard.isWindow(ee)&&(ee._currentEvent=oe),b._stopImmediatePropagationFlag)return k}}return k}function T(b,I){return null}function _(b,I){return null}function E(b,I){}function D(b,I){}n.event_setTheCanceledFlag=function(b){b._cancelable&&!b._inPassiveListenerFlag&&(b._canceledFlag=!0)},n.event_initialize=function(b,I,R,M){b._initializedFlag=!0,b._stopPropagationFlag=!1,b._stopImmediatePropagationFlag=!1,b._canceledFlag=!1,b._isTrusted=!1,b._target=null,b._type=I,b._bubbles=R,b._cancelable=M},n.event_createAnEvent=w,n.event_innerEventCreationSteps=m,n.event_dispatch=y,n.event_appendToAnEventPath=x,n.event_invoke=C,n.event_innerInvoke=S,n.event_fireAnEvent=function(b,I,R,M,P){R===void 0&&(R=d.EventImpl);var k=w(R);if(k._type=b,M)for(var z in M)k[z]=M[z];return y(k,I,P)},n.event_createLegacyEvent=function(b){var I=null;switch(b.toLowerCase()){case"beforeunloadevent":case"compositionevent":break;case"customevent":I=u.CustomEventImpl;break;case"devicemotionevent":case"deviceorientationevent":case"dragevent":break;case"event":case"events":I=d.EventImpl}if(I===null)throw new h.NotSupportedError("Event constructor not found for interface "+b+".");var R=new I("");return R._type="",R._timeStamp=new Date().getTime(),R._isTrusted=!1,R._initializedFlag=!1,R},n.event_getterEventHandlerIDLAttribute=function(b,I){return null},n.event_setterEventHandlerIDLAttribute=function(b,I,R){},n.event_determineTheTargetOfAnEventHandler=T,n.event_getTheCurrentValueOfAnEventHandler=_,n.event_activateAnEventHandler=E,n.event_deactivateAnEventHandler=D},function(r,n,i){var o,a=this&&this.__extends||(o=function(x,C){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,T){S.__proto__=T}||function(S,T){for(var _ in T)T.hasOwnProperty(_)&&(S[_]=T[_])})(x,C)},function(x,C){function S(){this.constructor=x}o(x,C),x.prototype=C===null?Object.create(C):(S.prototype=C.prototype,new S)}),s=this&&this.__values||function(x){var C=typeof Symbol=="function"&&Symbol.iterator,S=C&&x[C],T=0;if(S)return S.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&T>=x.length&&(x=void 0),{value:x&&x[T++],done:!x}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(x,C){var S=typeof Symbol=="function"&&x[Symbol.iterator];if(!S)return x;var T,_,E=S.call(x),D=[];try{for(;(C===void 0||C-- >0)&&!(T=E.next()).done;)D.push(T.value)}catch(b){_={error:b}}finally{try{T&&!T.done&&(S=E.return)&&S.call(E)}finally{if(_)throw _.error}}return D};Object.defineProperty(n,"__esModule",{value:!0});var l=i(6),f=i(2),u=i(9),d=i(34),h=i(3),g=i(1),p=i(7),v=i(152),w=i(0),m=i(12),y=function(x){function C(){var S=x.call(this)||this;return S._children=new Set,S._encoding={name:"UTF-8",labels:["unicode-1-1-utf-8","utf-8","utf8"]},S._contentType="application/xml",S._URL={scheme:"about",username:"",password:"",host:null,port:null,path:["blank"],query:null,fragment:null,_cannotBeABaseURLFlag:!0,_blobURLEntry:null},S._origin=null,S._type="xml",S._mode="no-quirks",S._documentElement=null,S._hasNamespaces=!1,S._nodeDocumentOverwrite=null,S}return a(C,x),Object.defineProperty(C.prototype,"_nodeDocument",{get:function(){return this._nodeDocumentOverwrite||this},set:function(S){this._nodeDocumentOverwrite=S},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"implementation",{get:function(){return this._implementation||(this._implementation=w.create_domImplementation(this))},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"URL",{get:function(){return v.urlSerializer(this._URL)},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"documentURI",{get:function(){return this.URL},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"origin",{get:function(){return"null"},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"compatMode",{get:function(){return this._mode==="quirks"?"BackCompat":"CSS1Compat"},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"characterSet",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"charset",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"inputEncoding",{get:function(){return this._encoding.name},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"contentType",{get:function(){return this._contentType},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"doctype",{get:function(){var S,T;try{for(var _=s(this._children),E=_.next();!E.done;E=_.next()){var D=E.value;if(h.Guard.isDocumentTypeNode(D))return D}}catch(b){S={error:b}}finally{try{E&&!E.done&&(T=_.return)&&T.call(_)}finally{if(S)throw S.error}}return null},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"documentElement",{get:function(){return this._documentElement},enumerable:!0,configurable:!0}),C.prototype.getElementsByTagName=function(S){return w.node_listOfElementsWithQualifiedName(S,this)},C.prototype.getElementsByTagNameNS=function(S,T){return w.node_listOfElementsWithNamespace(S,T,this)},C.prototype.getElementsByClassName=function(S){return w.node_listOfElementsWithClassNames(S,this)},C.prototype.createElement=function(S,T){if(!w.xml_isName(S))throw new u.InvalidCharacterError;this._type==="html"&&(S=S.toLowerCase());var _=null;T!==void 0&&(_=g.isString(T)?T:T.is);var E=this._type==="html"||this._contentType==="application/xhtml+xml"?p.namespace.HTML:null;return w.element_createAnElement(this,S,E,null,_,!0)},C.prototype.createElementNS=function(S,T,_){return w.document_internalCreateElementNS(this,S,T,_)},C.prototype.createDocumentFragment=function(){return w.create_documentFragment(this)},C.prototype.createTextNode=function(S){return w.create_text(this,S)},C.prototype.createCDATASection=function(S){if(this._type==="html")throw new u.NotSupportedError;if(S.indexOf("]]>")!==-1)throw new u.InvalidCharacterError;return w.create_cdataSection(this,S)},C.prototype.createComment=function(S){return w.create_comment(this,S)},C.prototype.createProcessingInstruction=function(S,T){if(!w.xml_isName(S))throw new u.InvalidCharacterError;if(T.indexOf("?>")!==-1)throw new u.InvalidCharacterError;return w.create_processingInstruction(this,S,T)},C.prototype.importNode=function(S,T){if(T===void 0&&(T=!1),h.Guard.isDocumentNode(S)||h.Guard.isShadowRoot(S))throw new u.NotSupportedError;return w.node_clone(S,this,T)},C.prototype.adoptNode=function(S){if(h.Guard.isDocumentNode(S))throw new u.NotSupportedError;if(h.Guard.isShadowRoot(S))throw new u.HierarchyRequestError;return w.document_adopt(S,this),S},C.prototype.createAttribute=function(S){if(!w.xml_isName(S))throw new u.InvalidCharacterError;return this._type==="html"&&(S=S.toLowerCase()),w.create_attr(this,S)},C.prototype.createAttributeNS=function(S,T){var _=c(w.namespace_validateAndExtract(S,T),3),E=_[0],D=_[1],b=_[2],I=w.create_attr(this,b);return I._namespace=E,I._namespacePrefix=D,I},C.prototype.createEvent=function(S){return w.event_createLegacyEvent(S)},C.prototype.createRange=function(){var S=w.create_range();return S._start=[this,0],S._end=[this,0],S},C.prototype.createNodeIterator=function(S,T,_){T===void 0&&(T=f.WhatToShow.All),_===void 0&&(_=null);var E=w.create_nodeIterator(S,S,!0);return E._whatToShow=T,E._iteratorCollection=w.create_nodeList(S),g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},C.prototype.createTreeWalker=function(S,T,_){T===void 0&&(T=f.WhatToShow.All),_===void 0&&(_=null);var E=w.create_treeWalker(S,S);return E._whatToShow=T,g.isFunction(_)?(E._filter=w.create_nodeFilter(),E._filter.acceptNode=_):E._filter=_,E},C.prototype._getTheParent=function(S){return S._type==="load"?null:l.dom.window},C.prototype.getElementById=function(S){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(C.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(C.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),C.prototype.prepend=function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T];throw new Error("Mixin: ParentNode not implemented.")},C.prototype.append=function(){for(var S=[],T=0;T<arguments.length;T++)S[T]=arguments[T];throw new Error("Mixin: ParentNode not implemented.")},C.prototype.querySelector=function(S){throw new Error("Mixin: ParentNode not implemented.")},C.prototype.querySelectorAll=function(S){throw new Error("Mixin: ParentNode not implemented.")},C}(d.NodeImpl);n.DocumentImpl=y,m.idl_defineConst(y.prototype,"_nodeType",f.NodeType.Document)},function(r,n,i){var o,a=this&&this.__extends||(o=function(v,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,y){m.__proto__=y}||function(m,y){for(var x in y)y.hasOwnProperty(x)&&(m[x]=y[x])})(v,w)},function(v,w){function m(){this.constructor=v}o(v,w),v.prototype=w===null?Object.create(w):(m.prototype=w.prototype,new m)}),s=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(v,w){var m=typeof Symbol=="function"&&v[Symbol.iterator];if(!m)return v;var y,x,C=m.call(v),S=[];try{for(;(w===void 0||w-- >0)&&!(y=C.next()).done;)S.push(y.value)}catch(T){x={error:T}}finally{try{y&&!y.done&&(m=C.return)&&m.call(C)}finally{if(x)throw x.error}}return S};Object.defineProperty(n,"__esModule",{value:!0});var l=i(2),f=i(34),u=i(9),d=i(7),h=i(0),g=i(12),p=function(v){function w(){var m=v.call(this)||this;return m._children=new Set,m._namespace=null,m._namespacePrefix=null,m._localName="",m._customElementState="undefined",m._customElementDefinition=null,m._is=null,m._shadowRoot=null,m._attributeList=h.create_namedNodeMap(m),m._attributeChangeSteps=[],m._name="",m._assignedSlot=null,m}return a(w,v),Object.defineProperty(w.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"tagName",{get:function(){return this._htmlUppercasedQualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"id",{get:function(){return h.element_getAnAttributeValue(this,"id")},set:function(m){h.element_setAnAttributeValue(this,"id",m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"className",{get:function(){return h.element_getAnAttributeValue(this,"class")},set:function(m){h.element_setAnAttributeValue(this,"class",m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"classList",{get:function(){var m=h.element_getAnAttributeByName("class",this);return m===null&&(m=h.create_attr(this._nodeDocument,"class")),h.create_domTokenList(this,m)},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"slot",{get:function(){return h.element_getAnAttributeValue(this,"slot")},set:function(m){h.element_setAnAttributeValue(this,"slot",m)},enumerable:!0,configurable:!0}),w.prototype.hasAttributes=function(){return this._attributeList.length!==0},Object.defineProperty(w.prototype,"attributes",{get:function(){return this._attributeList},enumerable:!0,configurable:!0}),w.prototype.getAttributeNames=function(){var m,y,x=[];try{for(var C=s(this._attributeList),S=C.next();!S.done;S=C.next()){var T=S.value;x.push(T._qualifiedName)}}catch(_){m={error:_}}finally{try{S&&!S.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return x},w.prototype.getAttribute=function(m){var y=h.element_getAnAttributeByName(m,this);return y?y._value:null},w.prototype.getAttributeNS=function(m,y){var x=h.element_getAnAttributeByNamespaceAndLocalName(m,y,this);return x?x._value:null},w.prototype.setAttribute=function(m,y){if(!h.xml_isName(m))throw new u.InvalidCharacterError;this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var x=null,C=0;C<this._attributeList.length;C++){var S=this._attributeList[C];if(S._qualifiedName===m){x=S;break}}if(x===null)return(x=h.create_attr(this._nodeDocument,m))._value=y,void h.element_append(x,this);h.element_change(x,this,y)},w.prototype.setAttributeNS=function(m,y,x){var C=c(h.namespace_validateAndExtract(m,y),3),S=C[0],T=C[1],_=C[2];h.element_setAnAttributeValue(this,_,x,T,S)},w.prototype.removeAttribute=function(m){h.element_removeAnAttributeByName(m,this)},w.prototype.removeAttributeNS=function(m,y){h.element_removeAnAttributeByNamespaceAndLocalName(m,y,this)},w.prototype.hasAttribute=function(m){this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var y=0;y<this._attributeList.length;y++)if(this._attributeList[y]._qualifiedName===m)return!0;return!1},w.prototype.toggleAttribute=function(m,y){if(!h.xml_isName(m))throw new u.InvalidCharacterError;this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toLowerCase());for(var x=null,C=0;C<this._attributeList.length;C++){var S=this._attributeList[C];if(S._qualifiedName===m){x=S;break}}return x===null?(y===void 0||y===!0)&&((x=h.create_attr(this._nodeDocument,m))._value="",h.element_append(x,this),!0):y!==void 0&&y!==!1||(h.element_removeAnAttributeByName(m,this),!1)},w.prototype.hasAttributeNS=function(m,y){for(var x=m||null,C=0;C<this._attributeList.length;C++){var S=this._attributeList[C];if(S._namespace===x&&S._localName===y)return!0}return!1},w.prototype.getAttributeNode=function(m){return h.element_getAnAttributeByName(m,this)},w.prototype.getAttributeNodeNS=function(m,y){return h.element_getAnAttributeByNamespaceAndLocalName(m,y,this)},w.prototype.setAttributeNode=function(m){return h.element_setAnAttribute(m,this)},w.prototype.setAttributeNodeNS=function(m){return h.element_setAnAttribute(m,this)},w.prototype.removeAttributeNode=function(m){for(var y=!1,x=0;x<this._attributeList.length;x++)if(this._attributeList[x]===m){y=!0;break}if(!y)throw new u.NotFoundError;return h.element_remove(m,this),m},w.prototype.attachShadow=function(m){if(this._namespace!==d.namespace.HTML)throw new u.NotSupportedError;if(!h.customElement_isValidCustomElementName(this._localName)&&!h.customElement_isValidShadowHostName(this._localName))throw new u.NotSupportedError;if(h.customElement_isValidCustomElementName(this._localName)||this._is!==null){var y=h.customElement_lookUpACustomElementDefinition(this._nodeDocument,this._namespace,this._localName,this._is);if(y!==null&&y.disableShadow===!0)throw new u.NotSupportedError}if(this._shadowRoot!==null)throw new u.NotSupportedError;var x=h.create_shadowRoot(this._nodeDocument,this);return x._mode=m.mode,this._shadowRoot=x,x},Object.defineProperty(w.prototype,"shadowRoot",{get:function(){var m=this._shadowRoot;return m===null||m.mode==="closed"?null:m},enumerable:!0,configurable:!0}),w.prototype.closest=function(m){throw new u.NotImplementedError},w.prototype.matches=function(m){throw new u.NotImplementedError},w.prototype.webkitMatchesSelector=function(m){return this.matches(m)},w.prototype.getElementsByTagName=function(m){return h.node_listOfElementsWithQualifiedName(m,this)},w.prototype.getElementsByTagNameNS=function(m,y){return h.node_listOfElementsWithNamespace(m,y,this)},w.prototype.getElementsByClassName=function(m){return h.node_listOfElementsWithClassNames(m,this)},w.prototype.insertAdjacentElement=function(m,y){return h.element_insertAdjacent(this,m,y)},w.prototype.insertAdjacentText=function(m,y){var x=h.create_text(this._nodeDocument,y);h.element_insertAdjacent(this,m,x)},Object.defineProperty(w.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"_htmlUppercasedQualifiedName",{get:function(){var m=this._qualifiedName;return this._namespace===d.namespace.HTML&&this._nodeDocument._type==="html"&&(m=m.toUpperCase()),m},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.prepend=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.append=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelector=function(m){throw new Error("Mixin: ParentNode not implemented.")},w.prototype.querySelectorAll=function(m){throw new Error("Mixin: ParentNode not implemented.")},Object.defineProperty(w.prototype,"previousElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"nextElementSibling",{get:function(){throw new Error("Mixin: NonDocumentTypeChildNode not implemented.")},enumerable:!0,configurable:!0}),w.prototype.before=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.after=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.replaceWith=function(){for(var m=[],y=0;y<arguments.length;y++)m[y]=arguments[y];throw new Error("Mixin: ChildNode not implemented.")},w.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},Object.defineProperty(w.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),w._create=function(m,y,x,C){x===void 0&&(x=null),C===void 0&&(C=null);var S=new w;return S._localName=y,S._namespace=x,S._namespacePrefix=C,S._nodeDocument=m,S},w}(f.NodeImpl);n.ElementImpl=p,g.idl_defineConst(p.prototype,"_nodeType",l.NodeType.Element)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),f=function(u){function d(h){h===void 0&&(h=null);var g=u.call(this)||this;return g._children=new Set,g._host=h,g}return a(d,u),d.prototype.getElementById=function(h){throw new Error("Mixin: NonElementParentNode not implemented.")},Object.defineProperty(d.prototype,"children",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"firstElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lastElementChild",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"childElementCount",{get:function(){throw new Error("Mixin: ParentNode not implemented.")},enumerable:!0,configurable:!0}),d.prototype.prepend=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},d.prototype.append=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ParentNode not implemented.")},d.prototype.querySelector=function(h){throw new Error("Mixin: ParentNode not implemented.")},d.prototype.querySelectorAll=function(h){throw new Error("Mixin: ParentNode not implemented.")},d._create=function(h,g){g===void 0&&(g=null);var p=new d(g);return p._nodeDocument=h,p},d}(c.NodeImpl);n.DocumentFragmentImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.DocumentFragment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(h,g){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var w in v)v.hasOwnProperty(w)&&(p[w]=v[w])})(h,g)},function(h,g){function p(){this.constructor=h}o(h,g),h.prototype=g===null?Object.create(g):(p.prototype=g.prototype,new p)}),s=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(71),f=i(0),u=i(12),d=function(h){function g(p){p===void 0&&(p="");var v=h.call(this,p)||this;return v._name="",v._assignedSlot=null,v}return a(g,h),Object.defineProperty(g.prototype,"wholeText",{get:function(){var p,v,w="";try{for(var m=s(f.text_contiguousTextNodes(this,!0)),y=m.next();!y.done;y=m.next())w+=y.value._data}catch(x){p={error:x}}finally{try{y&&!y.done&&(v=m.return)&&v.call(m)}finally{if(p)throw p.error}}return w},enumerable:!0,configurable:!0}),g.prototype.splitText=function(p){return f.text_split(this,p)},Object.defineProperty(g.prototype,"assignedSlot",{get:function(){throw new Error("Mixin: Slotable not implemented.")},enumerable:!0,configurable:!0}),g._create=function(p,v){v===void 0&&(v="");var w=new g(v);return w._nodeDocument=p,w},g}(l.CharacterDataImpl);n.TextImpl=d,u.idl_defineConst(d.prototype,"_nodeType",c.NodeType.Text)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(){}return Object.defineProperty(a.prototype,"_startNode",{get:function(){return this._start[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_startOffset",{get:function(){return this._start[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endNode",{get:function(){return this._end[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_endOffset",{get:function(){return this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"_collapsed",{get:function(){return this._start[0]===this._end[0]&&this._start[1]===this._end[1]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startContainer",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"startOffset",{get:function(){return this._startOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endContainer",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"endOffset",{get:function(){return this._endOffset},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"collapsed",{get:function(){return this._collapsed},enumerable:!0,configurable:!0}),a}();n.AbstractRangeImpl=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=function(){function s(c){this._activeFlag=!1,this._root=c,this._whatToShow=o.WhatToShow.All,this._filter=null}return Object.defineProperty(s.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"whatToShow",{get:function(){return this._whatToShow},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),s}();n.TraverserImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(0),s=i(12),c=function(){function l(f,u){this._target=null,this._relatedTarget=null,this._touchTargetList=[],this._path=[],this._currentTarget=null,this._eventPhase=o.EventPhase.None,this._stopPropagationFlag=!1,this._stopImmediatePropagationFlag=!1,this._canceledFlag=!1,this._inPassiveListenerFlag=!1,this._composedFlag=!1,this._initializedFlag=!1,this._dispatchFlag=!1,this._isTrusted=!1,this._bubbles=!1,this._cancelable=!1,this._type=f,u&&(this._bubbles=u.bubbles||!1,this._cancelable=u.cancelable||!1,this._composedFlag=u.composed||!1),this._initializedFlag=!0,this._timeStamp=new Date().getTime()}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"srcElement",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!0,configurable:!0}),l.prototype.composedPath=function(){var f=[],u=this._path;if(u.length===0)return f;var d=this._currentTarget;if(d===null)throw new Error("Event currentTarget is null.");f.push(d);for(var h=0,g=0,p=u.length-1;p>=0;){if(u[p].rootOfClosedTree&&g++,u[p].invocationTarget===d){h=p;break}u[p].slotInClosedTree&&g--,p--}var v=g,w=g;for(p=h-1;p>=0;)u[p].rootOfClosedTree&&v++,v<=w&&f.unshift(u[p].invocationTarget),u[p].slotInClosedTree&&--v<w&&(w=v),p--;for(v=g,w=g,p=h+1;p<u.length;)u[p].slotInClosedTree&&v++,v<=w&&f.push(u[p].invocationTarget),u[p].rootOfClosedTree&&--v<w&&(w=v),p++;return f},Object.defineProperty(l.prototype,"eventPhase",{get:function(){return this._eventPhase},enumerable:!0,configurable:!0}),l.prototype.stopPropagation=function(){this._stopPropagationFlag=!0},Object.defineProperty(l.prototype,"cancelBubble",{get:function(){return this._stopPropagationFlag},set:function(f){f&&this.stopPropagation()},enumerable:!0,configurable:!0}),l.prototype.stopImmediatePropagation=function(){this._stopPropagationFlag=!0,this._stopImmediatePropagationFlag=!0},Object.defineProperty(l.prototype,"bubbles",{get:function(){return this._bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"cancelable",{get:function(){return this._cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"returnValue",{get:function(){return!this._canceledFlag},set:function(f){f||a.event_setTheCanceledFlag(this)},enumerable:!0,configurable:!0}),l.prototype.preventDefault=function(){a.event_setTheCanceledFlag(this)},Object.defineProperty(l.prototype,"defaultPrevented",{get:function(){return this._canceledFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"composed",{get:function(){return this._composedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isTrusted",{get:function(){return this._isTrusted},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),l.prototype.initEvent=function(f,u,d){u===void 0&&(u=!1),d===void 0&&(d=!1),this._dispatchFlag||a.event_initialize(this,f,u,d)},l.NONE=0,l.CAPTURING_PHASE=1,l.AT_TARGET=2,l.BUBBLING_PHASE=3,l}();n.EventImpl=c,s.idl_defineConst(c.prototype,"NONE",0),s.idl_defineConst(c.prototype,"CAPTURING_PHASE",1),s.idl_defineConst(c.prototype,"AT_TARGET",2),s.idl_defineConst(c.prototype,"BUBBLING_PHASE",3)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(9);n.traversal_filter=function(s,c){if(s._activeFlag)throw new a.InvalidStateError;var l=1<<c._nodeType-1;if(!(s.whatToShow&l))return o.FilterResult.Skip;if(!s.filter)return o.FilterResult.Accept;s._activeFlag=!0;var f=o.FilterResult.Reject;try{f=s.filter.acceptNode(c)}catch(u){throw s._activeFlag=!1,u}return s._activeFlag=!1,f}},function(r,n,i){var o=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var x,C,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(x=S.next()).done;)T.push(x.value)}catch(_){C={error:_}}finally{try{x&&!x.done&&(y=S.return)&&y.call(S)}finally{if(C)throw C.error}}return T},a=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],x=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&x>=w.length&&(w=void 0),{value:w&&w[x++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(6),c=i(3),l=i(1),f=i(99),u=i(73),d=i(17),h=i(173),g=i(30),p=i(52),v=i(37);n.document_elementInterface=function(w,m){return f.ElementImpl},n.document_internalCreateElementNS=function(w,m,y,x){var C=o(h.namespace_validateAndExtract(m,y),3),S=C[0],T=C[1],_=C[2],E=null;return x!==void 0&&(E=l.isString(x)?x:x.is),p.element_createAnElement(w,_,S,T,E,!0)},n.document_adopt=function(w,m){var y,x;if(w._nodeDocument!==m||w._parent!==null){var C=w._nodeDocument;if(w._parent&&v.mutation_remove(w,w._parent),m!==C)for(var S=d.tree_getFirstDescendantNode(w,!0,!0);S!==null;){if(S._nodeDocument=m,c.Guard.isElementNode(S))try{for(var T=(y=void 0,a(S._attributeList._asArray())),_=T.next();!_.done;_=T.next())_.value._nodeDocument=m}catch(E){y={error:E}}finally{try{_&&!_.done&&(x=T.return)&&x.call(T)}finally{if(y)throw y.error}}s.dom.features.customElements&&c.Guard.isElementNode(S)&&S._customElementState==="custom"&&u.customElement_enqueueACustomElementCallbackReaction(S,"adoptedCallback",[C,m]),s.dom.features.steps&&g.dom_runAdoptingSteps(S,C),S=d.tree_getNextDescendantNode(w,S,!0,!0)}}}},function(r,n,i){var o=this&&this.__values||function(d){var h=typeof Symbol=="function"&&Symbol.iterator,g=h&&d[h],p=0;if(g)return g.call(d);if(d&&typeof d.length=="number")return{next:function(){return d&&p>=d.length&&(d=void 0),{value:d&&d[p++],done:!d}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(17),f=i(51),u=i(30);n.characterData_replaceData=function(d,h,g,p){var v,w,m=l.tree_nodeLength(d);if(h>m)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+m+", Node is "+d.nodeName+".");h+g>m&&(g=m-h),a.dom.features.mutationObservers&&f.observer_queueMutationRecord("characterData",d,null,null,d._data,[],[],null,null);var y=d._data.substring(0,h)+p+d._data.substring(h+g);d._data=y;try{for(var x=o(a.dom.rangeList),C=x.next();!C.done;C=x.next()){var S=C.value;S._start[0]===d&&S._start[1]>h&&S._start[1]<=h+g&&(S._start[1]=h),S._end[0]===d&&S._end[1]>h&&S._end[1]<=h+g&&(S._end[1]=h),S._start[0]===d&&S._start[1]>h+g&&(S._start[1]+=p.length-g),S._end[0]===d&&S._end[1]>h+g&&(S._end[1]+=p.length-g)}}catch(T){v={error:T}}finally{try{C&&!C.done&&(w=x.return)&&w.call(x)}finally{if(v)throw v.error}}a.dom.features.steps&&s.Guard.isTextNode(d)&&d._parent!==null&&u.dom_runChildTextContentChangeSteps(d._parent)},n.characterData_substringData=function(d,h,g){var p=l.tree_nodeLength(d);if(h>p)throw new c.IndexSizeError("Offset exceeds character data length. Offset: "+h+", Length: "+p+", Node is "+d.nodeName+".");return h+g>p?d._data.substr(h):d._data.substr(h,g)}},function(r,n,i){var o=this&&this.__read||function(u,d){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,v=h.call(u),w=[];try{for(;(d===void 0||d-- >0)&&!(g=v.next()).done;)w.push(g.value)}catch(m){p={error:m}}finally{try{g&&!g.done&&(h=v.return)&&h.call(v)}finally{if(p)throw p.error}}return w},a=this&&this.__spread||function(){for(var u=[],d=0;d<arguments.length;d++)u=u.concat(o(arguments[d]));return u},s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(7);function l(u){var d=c.string.splitAStringOnASCIIWhitespace(u);return new Set(d)}function f(u){return a(u).join(" ")}n.orderedSet_parse=l,n.orderedSet_serialize=f,n.orderedSet_sanitize=function(u){return f(l(u))},n.orderedSet_contains=function(u,d,h){var g,p,v,w;try{for(var m=s(d),y=m.next();!y.done;y=m.next()){var x=y.value,C=!1;try{for(var S=(v=void 0,s(u)),T=S.next();!T.done;T=S.next()){var _=T.value;if(h){if(_===x){C=!0;break}}else if(_.toUpperCase()===x.toUpperCase()){C=!0;break}}}catch(E){v={error:E}}finally{try{T&&!T.done&&(w=S.return)&&w.call(S)}finally{if(v)throw v.error}}if(!C)return!1}}catch(E){g={error:E}}finally{try{y&&!y.done&&(p=m.return)&&p.call(m)}finally{if(g)throw g.error}}return!0}},function(r,n,i){i(179),Object.defineProperty(n,"__esModule",{value:!0});var o=i(262),a=i(110),s=i(1);a.dom.setFeatures(!1),n.createDocument=function(){var c=new o.DOMImplementation().createDocument(null,"root",null);return c.documentElement&&c.removeChild(c.documentElement),c},n.sanitizeInput=function(c,l){if(c==null)return c;if(l===void 0)return c+"";var f="";c+="";for(var u=0;u<c.length;u++){var d=c.charCodeAt(u);if(d===9||d===10||d===13||d>=32&&d<=55295||d>=57344&&d<=65533)f+=c.charAt(u);else if(d>=55296&&d<=56319&&u<c.length-1){var h=c.charCodeAt(u+1);h>=56320&&h<=57343?(d=1024*(d-55296)+h-56320+65536,f+=String.fromCodePoint(d),u++):f+=s.isString(l)?l:l(c.charAt(u),u,c)}else f+=s.isString(l)?l:l(c.charAt(u),u,c)}return f}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(1),a=i(153);n.AbortController=a.AbortControllerImpl;var s=i(154);n.AbortSignal=s.AbortSignalImpl;var c=i(102);n.AbstractRange=c.AbstractRangeImpl;var l=i(157);n.Attr=l.AttrImpl;var f=i(158);n.CDATASection=f.CDATASectionImpl;var u=i(71);n.CharacterData=u.CharacterDataImpl;var d=i(263),h=i(159);n.Comment=h.CommentImpl;var g=i(171);n.CustomEvent=g.CustomEventImpl;var p=i(100);n.DocumentFragment=p.DocumentFragmentImpl;var v=i(98);n.Document=v.DocumentImpl;var w=i(264),m=i(155);n.DocumentType=m.DocumentTypeImpl;var y=i(6);n.dom=y.dom;var x=i(148);n.DOMImplementation=x.DOMImplementationImpl;var C=i(170);n.DOMTokenList=C.DOMTokenListImpl;var S=i(99);n.Element=S.ElementImpl;var T=i(104);n.Event=T.EventImpl;var _=i(70);n.EventTarget=_.EventTargetImpl;var E=i(161);n.HTMLCollection=E.HTMLCollectionImpl;var D=i(265);n.MutationObserver=D.MutationObserverImpl;var b=i(169);n.MutationRecord=b.MutationRecordImpl;var I=i(164);n.NamedNodeMap=I.NamedNodeMapImpl;var R=i(168);n.NodeFilter=R.NodeFilterImpl;var M=i(34);n.Node=M.NodeImpl;var P=i(166);n.NodeIterator=P.NodeIteratorImpl;var k=i(162);n.NodeList=k.NodeListImpl;var z=i(163);n.NodeListStatic=z.NodeListStaticImpl;var A=i(266),L=i(267),N=i(268),H=i(160);n.ProcessingInstruction=H.ProcessingInstructionImpl;var ee=i(165);n.Range=ee.RangeImpl;var oe=i(156);n.ShadowRoot=oe.ShadowRootImpl;var de=i(269),ue=i(270);n.StaticRange=ue.StaticRangeImpl;var me=i(101);n.Text=me.TextImpl;var Ee=i(103);n.Traverser=Ee.TraverserImpl;var _e=i(167);n.TreeWalker=_e.TreeWalkerImpl;var Ce=i(149);n.Window=Ce.WindowImpl;var F=i(151);n.XMLDocument=F.XMLDocumentImpl,o.applyMixin(S.ElementImpl,d.ChildNodeImpl),o.applyMixin(u.CharacterDataImpl,d.ChildNodeImpl),o.applyMixin(m.DocumentTypeImpl,d.ChildNodeImpl),o.applyMixin(v.DocumentImpl,w.DocumentOrShadowRootImpl),o.applyMixin(oe.ShadowRootImpl,w.DocumentOrShadowRootImpl),o.applyMixin(S.ElementImpl,A.NonDocumentTypeChildNodeImpl),o.applyMixin(u.CharacterDataImpl,A.NonDocumentTypeChildNodeImpl),o.applyMixin(v.DocumentImpl,L.NonElementParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,L.NonElementParentNodeImpl),o.applyMixin(v.DocumentImpl,N.ParentNodeImpl),o.applyMixin(p.DocumentFragmentImpl,N.ParentNodeImpl),o.applyMixin(S.ElementImpl,N.ParentNodeImpl),o.applyMixin(me.TextImpl,de.SlotableImpl),o.applyMixin(S.ElementImpl,de.SlotableImpl)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),function(o){o[o.EOF=0]="EOF",o[o.Declaration=1]="Declaration",o[o.DocType=2]="DocType",o[o.Element=3]="Element",o[o.Text=4]="Text",o[o.CDATA=5]="CDATA",o[o.PI=6]="PI",o[o.Comment=7]="Comment",o[o.ClosingTag=8]="ClosingTag"}(n.TokenType||(n.TokenType={}))},function(r,n,i){i(64),i(20),i(66);var o,a=this&&this.__extends||(o=function(l,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h])})(l,f)},function(l,f){function u(){this.constructor=l}o(l,f),l.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=function(l){function f(){return l!==null&&l.apply(this,arguments)||this}return a(f,l),f.prototype._parse=function(u,d){var h=this,g=this._builderOptions,p=null;return s.isFunction(d)?p=this.parse(u,d.apply(this)):s.isArray(d)||s.isSet(d)?s.forEachArray(d,function(v){return p=h.parse(u,v)},this):s.isMap(d)||s.isObject(d)?s.forEachObject(d,function(v,w){if(s.isFunction(w)&&(w=w.apply(h)),g.ignoreConverters||v.indexOf(g.convert.att)!==0)if(g.ignoreConverters||v.indexOf(g.convert.text)!==0)if(g.ignoreConverters||v.indexOf(g.convert.cdata)!==0)if(g.ignoreConverters||v.indexOf(g.convert.comment)!==0)if(g.ignoreConverters||v.indexOf(g.convert.ins)!==0){if(!((s.isArray(w)||s.isSet(w))&&s.isEmpty(w))){if((s.isMap(w)||s.isObject(w))&&s.isEmpty(w))p=h.element(u,void 0,h.sanitize(v))||p;else if(g.keepNullNodes||w!=null)if(s.isArray(w)||s.isSet(w))s.forEachArray(w,function(S){var T={};T[v]=S,p=h.parse(u,T)},h);else if(s.isMap(w)||s.isObject(w))(m=h.element(u,void 0,h.sanitize(v)))&&(p=m,h.parse(m,w));else if(w!=null&&w!==""){var m;(m=h.element(u,void 0,h.sanitize(v)))&&(p=m,h.text(m,h._decodeText(h.sanitize(w))))}else p=h.element(u,void 0,h.sanitize(v))||p}}else if(s.isString(w)){var y=w.indexOf(" "),x=y===-1?w:w.substr(0,y),C=y===-1?"":w.substr(y+1);p=h.instruction(u,h.sanitize(x),h.sanitize(C))||p}else s.isArray(w)||s.isSet(w)?s.forEachArray(w,function(S){var T=S.indexOf(" "),_=T===-1?S:S.substr(0,T),E=T===-1?"":S.substr(T+1);p=h.instruction(u,h.sanitize(_),h.sanitize(E))||p},h):s.forEachObject(w,function(S,T){return p=h.instruction(u,h.sanitize(S),h.sanitize(T))||p},h);else s.isArray(w)||s.isSet(w)?s.forEachArray(w,function(S){return p=h.comment(u,h.sanitize(S))||p},h):p=h.comment(u,h.sanitize(w))||p;else s.isArray(w)||s.isSet(w)?s.forEachArray(w,function(S){return p=h.cdata(u,h.sanitize(S))||p},h):p=h.cdata(u,h.sanitize(w))||p;else p=s.isMap(w)||s.isObject(w)?h.parse(u,w):h.text(u,h._decodeText(h.sanitize(w)))||p;else if(v===g.convert.att){if(s.isArray(w)||s.isSet(w))throw new Error("Invalid attribute: "+w.toString()+". "+u._debugInfo());s.forEachObject(w,function(S,T){p=h.attribute(u,void 0,h.sanitize(S),h._decodeAttributeValue(h.sanitize(T)))||p})}else p=h.attribute(u,void 0,h.sanitize(v.substr(g.convert.att.length)),h._decodeAttributeValue(h.sanitize(w)))||p},this):(g.keepNullNodes||d!=null)&&(p=this.text(u,this._decodeText(this.sanitize(d)))||p),p||u},f}(i(75).BaseReader);n.ObjectReader=c},function(r,n,i){var o=i(39);r.exports=new o({explicit:[i(286),i(287),i(288)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(a){this.level=0,this._builderOptions=a,this._writerOptions=a};n.BaseCBWriter=o},function(r,n,i){var o=i(16),a=i(8),s=i(116);r.exports=!o&&!a(function(){return Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a!=7})},function(r,n,i){var o=i(11),a=i(13),s=o.document,c=a(s)&&a(s.createElement);r.exports=function(l){return c?s.createElement(l):{}}},function(r,n,i){var o=i(118),a=Function.toString;typeof o.inspectSource!="function"&&(o.inspectSource=function(s){return a.call(s)}),r.exports=o.inspectSource},function(r,n,i){var o=i(11),a=i(80),s=o["__core-js_shared__"]||a("__core-js_shared__",{});r.exports=s},function(r,n,i){var o=i(14),a=i(187),s=i(55),c=i(15);r.exports=function(l,f){for(var u=a(f),d=c.f,h=s.f,g=0;g<u.length;g++){var p=u[g];o(l,p)||d(l,p,h(f,p))}}},function(r,n,i){var o=i(11);r.exports=o},function(r,n,i){var o=i(14),a=i(24),s=i(122).indexOf,c=i(45);r.exports=function(l,f){var u,d=a(l),h=0,g=[];for(u in d)!o(c,u)&&o(d,u)&&g.push(u);for(;f.length>h;)o(d,u=f[h++])&&(~s(g,u)||g.push(u));return g}},function(r,n,i){var o=i(24),a=i(26),s=i(83),c=function(l){return function(f,u,d){var h,g=o(f),p=a(g.length),v=s(d,p);if(l&&u!=u){for(;p>v;)if((h=g[v++])!=h)return!0}else for(;p>v;v++)if((l||v in g)&&g[v]===u)return l||v||0;return!l&&-1}};r.exports={includes:c(!0),indexOf:c(!1)}},function(r,n,i){var o=i(8),a=/#|\.prototype\./,s=function(d,h){var g=l[c(d)];return g==u||g!=f&&(typeof h=="function"?o(h):!!h)},c=s.normalize=function(d){return String(d).replace(a,".").toLowerCase()},l=s.data={},f=s.NATIVE="N",u=s.POLYFILL="P";r.exports=s},function(r,n,i){var o=i(86);r.exports=o&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},function(r,n,i){var o=i(5);n.f=o},function(r,n,i){var o=i(120),a=i(14),s=i(125),c=i(15).f;r.exports=function(l){var f=o.Symbol||(o.Symbol={});a(f,l)||c(f,l,{value:s.f(l)})}},function(r,n){r.exports=function(i){if(typeof i!="function")throw TypeError(String(i)+" is not a function");return i}},function(r,n,i){var o=i(13),a=i(59),s=i(5)("species");r.exports=function(c,l){var f;return a(c)&&(typeof(f=c.constructor)!="function"||f!==Array&&!a(f.prototype)?o(f)&&(f=f[s])===null&&(f=void 0):f=void 0),new(f===void 0?Array:f)(l===0?0:l)}},function(r,n,i){var o,a,s=i(11),c=i(193),l=s.process,f=l&&l.versions,u=f&&f.v8;u?a=(o=u.split("."))[0]+o[1]:c&&(!(o=c.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=c.match(/Chrome\/(\d+)/))&&(a=o[1]),r.exports=a&&+a},function(r,n,i){var o=i(5),a=i(60),s=i(15),c=o("unscopables"),l=Array.prototype;l[c]==null&&s.f(l,c,{configurable:!0,value:a(null)}),r.exports=function(f){l[c][f]=!0}},function(r,n,i){var o,a,s,c=i(132),l=i(21),f=i(14),u=i(5),d=i(44),h=u("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(a=c(c(s)))!==Object.prototype&&(o=a):g=!0),o==null&&(o={}),d||f(o,h)||l(o,h,function(){return this}),r.exports={IteratorPrototype:o,BUGGY_SAFARI_ITERATORS:g}},function(r,n,i){var o=i(14),a=i(27),s=i(57),c=i(196),l=s("IE_PROTO"),f=Object.prototype;r.exports=c?Object.getPrototypeOf:function(u){return u=a(u),o(u,l)?u[l]:typeof u.constructor=="function"&&u instanceof u.constructor?u.constructor.prototype:u instanceof Object?f:null}},function(r,n,i){var o=i(18),a=i(197);r.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var s,c=!1,l={};try{(s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(l,[]),c=l instanceof Array}catch{}return function(f,u){return o(f),a(u),c?s.call(f,u):f.__proto__=u,f}}():void 0)},function(r,n,i){var o=i(56),a=i(15),s=i(40);r.exports=function(c,l,f){var u=o(l);u in c?a.f(c,u,s(0,f)):c[u]=f}},function(r,n,i){var o=i(90),a=i(42),s=i(5)("toStringTag"),c=a(function(){return arguments}())=="Arguments";r.exports=o?a:function(l){var f,u,d;return l===void 0?"Undefined":l===null?"Null":typeof(u=function(h,g){try{return h[g]}catch{}}(f=Object(l),s))=="string"?u:c?a(f):(d=a(f))=="Object"&&typeof f.callee=="function"?"Arguments":d}},function(r,n,i){var o=i(18);r.exports=function(){var a=o(this),s="";return a.global&&(s+="g"),a.ignoreCase&&(s+="i"),a.multiline&&(s+="m"),a.dotAll&&(s+="s"),a.unicode&&(s+="u"),a.sticky&&(s+="y"),s}},function(r,n,i){var o=i(47),a=i(35),s=function(c){return function(l,f){var u,d,h=String(a(l)),g=o(f),p=h.length;return g<0||g>=p?c?"":void 0:(u=h.charCodeAt(g))<55296||u>56319||g+1===p||(d=h.charCodeAt(g+1))<56320||d>57343?c?h.charAt(g):u:c?h.slice(g,g+2):d-56320+(u-55296<<10)+65536}};r.exports={codeAt:s(!1),charAt:s(!0)}},function(r,n,i){var o=i(4),a=i(27),s=i(61);o({target:"Object",stat:!0,forced:i(8)(function(){s(1)})},{keys:function(c){return s(a(c))}})},function(r,n,i){var o=i(4),a=i(11),s=i(123),c=i(25),l=i(140),f=i(141),u=i(142),d=i(13),h=i(8),g=i(208),p=i(62),v=i(209);r.exports=function(w,m,y){var x=w.indexOf("Map")!==-1,C=w.indexOf("Weak")!==-1,S=x?"set":"add",T=a[w],_=T&&T.prototype,E=T,D={},b=function(z){var A=_[z];c(_,z,z=="add"?function(L){return A.call(this,L===0?0:L),this}:z=="delete"?function(L){return!(C&&!d(L))&&A.call(this,L===0?0:L)}:z=="get"?function(L){return C&&!d(L)?void 0:A.call(this,L===0?0:L)}:z=="has"?function(L){return!(C&&!d(L))&&A.call(this,L===0?0:L)}:function(L,N){return A.call(this,L===0?0:L,N),this})};if(s(w,typeof T!="function"||!(C||_.forEach&&!h(function(){new T().entries().next()}))))E=y.getConstructor(m,w,x,S),l.REQUIRED=!0;else if(s(w,!0)){var I=new E,R=I[S](C?{}:-0,1)!=I,M=h(function(){I.has(1)}),P=g(function(z){new T(z)}),k=!C&&h(function(){for(var z=new T,A=5;A--;)z[S](A,A);return!z.has(-0)});P||((E=m(function(z,A){u(z,E,w);var L=v(new T,z,E);return A!=null&&f(A,L[S],L,x),L})).prototype=_,_.constructor=E),(M||k)&&(b("delete"),b("has"),x&&b("get")),(k||R)&&b(S),C&&_.clear&&delete _.clear}return D[w]=E,o({global:!0,forced:E!=T},D),p(E,w),C||y.setStrong(E,w,x),E}},function(r,n,i){var o=i(45),a=i(13),s=i(14),c=i(15).f,l=i(58),f=i(204),u=l("meta"),d=0,h=Object.isExtensible||function(){return!0},g=function(v){c(v,u,{value:{objectID:"O"+ ++d,weakData:{}}})},p=r.exports={REQUIRED:!1,fastKey:function(v,w){if(!a(v))return typeof v=="symbol"?v:(typeof v=="string"?"S":"P")+v;if(!s(v,u)){if(!h(v))return"F";if(!w)return"E";g(v)}return v[u].objectID},getWeakData:function(v,w){if(!s(v,u)){if(!h(v))return!0;if(!w)return!1;g(v)}return v[u].weakData},onFreeze:function(v){return f&&p.REQUIRED&&h(v)&&!s(v,u)&&g(v),v}};o[u]=!0},function(r,n,i){var o=i(18),a=i(205),s=i(26),c=i(87),l=i(206),f=i(207),u=function(d,h){this.stopped=d,this.result=h};(r.exports=function(d,h,g,p,v){var w,m,y,x,C,S,T,_=c(h,g,p?2:1);if(v)w=d;else{if(typeof(m=l(d))!="function")throw TypeError("Target is not iterable");if(a(m)){for(y=0,x=s(d.length);x>y;y++)if((C=p?_(o(T=d[y])[0],T[1]):_(d[y]))&&C instanceof u)return C;return new u(!1)}w=m.call(d)}for(S=w.next;!(T=S.call(w)).done;)if(typeof(C=f(w,_,T.value,p))=="object"&&C&&C instanceof u)return C;return new u(!1)}).stop=function(d){return new u(!0,d)}},function(r,n){r.exports=function(i,o,a){if(!(i instanceof o))throw TypeError("Incorrect "+(a?a+" ":"")+"invocation");return i}},function(r,n,i){var o=i(15).f,a=i(60),s=i(210),c=i(87),l=i(142),f=i(141),u=i(88),d=i(211),h=i(16),g=i(140).fastKey,p=i(43),v=p.set,w=p.getterFor;r.exports={getConstructor:function(m,y,x,C){var S=m(function(D,b){l(D,S,y),v(D,{type:y,index:a(null),first:void 0,last:void 0,size:0}),h||(D.size=0),b!=null&&f(b,D[C],D,x)}),T=w(y),_=function(D,b,I){var R,M,P=T(D),k=E(D,b);return k?k.value=I:(P.last=k={index:M=g(b,!0),key:b,value:I,previous:R=P.last,next:void 0,removed:!1},P.first||(P.first=k),R&&(R.next=k),h?P.size++:D.size++,M!=="F"&&(P.index[M]=k)),D},E=function(D,b){var I,R=T(D),M=g(b);if(M!=="F")return R.index[M];for(I=R.first;I;I=I.next)if(I.key==b)return I};return s(S.prototype,{clear:function(){for(var D=T(this),b=D.index,I=D.first;I;)I.removed=!0,I.previous&&(I.previous=I.previous.next=void 0),delete b[I.index],I=I.next;D.first=D.last=void 0,h?D.size=0:this.size=0},delete:function(D){var b=T(this),I=E(this,D);if(I){var R=I.next,M=I.previous;delete b.index[I.index],I.removed=!0,M&&(M.next=R),R&&(R.previous=M),b.first==I&&(b.first=R),b.last==I&&(b.last=M),h?b.size--:this.size--}return!!I},forEach:function(D){for(var b,I=T(this),R=c(D,arguments.length>1?arguments[1]:void 0,3);b=b?b.next:I.first;)for(R(b.value,b.key,this);b&&b.removed;)b=b.previous},has:function(D){return!!E(this,D)}}),s(S.prototype,x?{get:function(D){var b=E(this,D);return b&&b.value},set:function(D,b){return _(this,D===0?0:D,b)}}:{add:function(D){return _(this,D=D===0?0:D,D)}}),h&&o(S.prototype,"size",{get:function(){return T(this).size}}),S},setStrong:function(m,y,x){var C=y+" Iterator",S=w(y),T=w(C);u(m,y,function(_,E){v(this,{type:C,target:_,state:S(_),kind:E,last:void 0})},function(){for(var _=T(this),E=_.kind,D=_.last;D&&D.removed;)D=D.previous;return _.target&&(_.last=D=D?D.next:_.state.first)?E=="keys"?{value:D.key,done:!1}:E=="values"?{value:D.value,done:!1}:{value:[D.key,D.value],done:!1}:(_.target=void 0,{value:void 0,done:!0})},x?"entries":"values",!x,!0),d(y)}}},function(r,n,i){var o,a=i(4),s=i(55).f,c=i(26),l=i(222),f=i(35),u=i(224),d=i(44),h="".endsWith,g=Math.min,p=u("endsWith");a({target:"String",proto:!0,forced:!!(d||p||(o=s(String.prototype,"endsWith"),!o||o.writable))&&!p},{endsWith:function(v){var w=String(f(this));l(v);var m=arguments.length>1?arguments[1]:void 0,y=c(w.length),x=m===void 0?y:g(c(m),y),C=String(v);return h?h.call(w,C,x):w.slice(x-C.length,x)===C}})},function(r,n,i){(function(o){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var a=i(229),s=i(230),c=i(231);function l(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(F,O){if(l()<O)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(F=new Uint8Array(O)).__proto__=u.prototype:(F===null&&(F=new u(O)),F.length=O),F}function u(F,O,$){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(F,O,$);if(typeof F=="number"){if(typeof O=="string")throw new Error("If encoding is specified then the first argument must be a string");return g(this,F)}return d(this,F,O,$)}function d(F,O,$,W){if(typeof O=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&O instanceof ArrayBuffer?function(X,Z,ne,xe){if(Z.byteLength,ne<0||Z.byteLength<ne)throw new RangeError("'offset' is out of bounds");if(Z.byteLength<ne+(xe||0))throw new RangeError("'length' is out of bounds");return Z=ne===void 0&&xe===void 0?new Uint8Array(Z):xe===void 0?new Uint8Array(Z,ne):new Uint8Array(Z,ne,xe),u.TYPED_ARRAY_SUPPORT?(X=Z).__proto__=u.prototype:X=p(X,Z),X}(F,O,$,W):typeof O=="string"?function(X,Z,ne){if(typeof ne=="string"&&ne!==""||(ne="utf8"),!u.isEncoding(ne))throw new TypeError('"encoding" must be a valid string encoding');var xe=0|w(Z,ne),Ie=(X=f(X,xe)).write(Z,ne);return Ie!==xe&&(X=X.slice(0,Ie)),X}(F,O,$):function(X,Z){if(u.isBuffer(Z)){var ne=0|v(Z.length);return(X=f(X,ne)).length===0||Z.copy(X,0,0,ne),X}if(Z){if(typeof ArrayBuffer<"u"&&Z.buffer instanceof ArrayBuffer||"length"in Z)return typeof Z.length!="number"||(xe=Z.length)!=xe?f(X,0):p(X,Z);if(Z.type==="Buffer"&&c(Z.data))return p(X,Z.data)}var xe;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(F,O)}function h(F){if(typeof F!="number")throw new TypeError('"size" argument must be a number');if(F<0)throw new RangeError('"size" argument must not be negative')}function g(F,O){if(h(O),F=f(F,O<0?0:0|v(O)),!u.TYPED_ARRAY_SUPPORT)for(var $=0;$<O;++$)F[$]=0;return F}function p(F,O){var $=O.length<0?0:0|v(O.length);F=f(F,$);for(var W=0;W<$;W+=1)F[W]=255&O[W];return F}function v(F){if(F>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|F}function w(F,O){if(u.isBuffer(F))return F.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(F)||F instanceof ArrayBuffer))return F.byteLength;typeof F!="string"&&(F=""+F);var $=F.length;if($===0)return 0;for(var W=!1;;)switch(O){case"ascii":case"latin1":case"binary":return $;case"utf8":case"utf-8":case void 0:return Ee(F).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*$;case"hex":return $>>>1;case"base64":return _e(F).length;default:if(W)return Ee(F).length;O=(""+O).toLowerCase(),W=!0}}function m(F,O,$){var W=!1;if((O===void 0||O<0)&&(O=0),O>this.length||(($===void 0||$>this.length)&&($=this.length),$<=0)||($>>>=0)<=(O>>>=0))return"";for(F||(F="utf8");;)switch(F){case"hex":return k(this,O,$);case"utf8":case"utf-8":return R(this,O,$);case"ascii":return M(this,O,$);case"latin1":case"binary":return P(this,O,$);case"base64":return I(this,O,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,O,$);default:if(W)throw new TypeError("Unknown encoding: "+F);F=(F+"").toLowerCase(),W=!0}}function y(F,O,$){var W=F[O];F[O]=F[$],F[$]=W}function x(F,O,$,W,X){if(F.length===0)return-1;if(typeof $=="string"?(W=$,$=0):$>2147483647?$=2147483647:$<-2147483648&&($=-2147483648),$=+$,isNaN($)&&($=X?0:F.length-1),$<0&&($=F.length+$),$>=F.length){if(X)return-1;$=F.length-1}else if($<0){if(!X)return-1;$=0}if(typeof O=="string"&&(O=u.from(O,W)),u.isBuffer(O))return O.length===0?-1:C(F,O,$,W,X);if(typeof O=="number")return O&=255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?X?Uint8Array.prototype.indexOf.call(F,O,$):Uint8Array.prototype.lastIndexOf.call(F,O,$):C(F,[O],$,W,X);throw new TypeError("val must be string, number or Buffer")}function C(F,O,$,W,X){var Z,ne=1,xe=F.length,Ie=O.length;if(W!==void 0&&((W=String(W).toLowerCase())==="ucs2"||W==="ucs-2"||W==="utf16le"||W==="utf-16le")){if(F.length<2||O.length<2)return-1;ne=2,xe/=2,Ie/=2,$/=2}function Le(ve,se){return ne===1?ve[se]:ve.readUInt16BE(se*ne)}if(X){var je=-1;for(Z=$;Z<xe;Z++)if(Le(F,Z)===Le(O,je===-1?0:Z-je)){if(je===-1&&(je=Z),Z-je+1===Ie)return je*ne}else je!==-1&&(Z-=Z-je),je=-1}else for($+Ie>xe&&($=xe-Ie),Z=$;Z>=0;Z--){for(var ie=!0,ae=0;ae<Ie;ae++)if(Le(F,Z+ae)!==Le(O,ae)){ie=!1;break}if(ie)return Z}return-1}function S(F,O,$,W){$=Number($)||0;var X=F.length-$;W?(W=Number(W))>X&&(W=X):W=X;var Z=O.length;if(Z%2!=0)throw new TypeError("Invalid hex string");W>Z/2&&(W=Z/2);for(var ne=0;ne<W;++ne){var xe=parseInt(O.substr(2*ne,2),16);if(isNaN(xe))return ne;F[$+ne]=xe}return ne}function T(F,O,$,W){return Ce(Ee(O,F.length-$),F,$,W)}function _(F,O,$,W){return Ce(function(X){for(var Z=[],ne=0;ne<X.length;++ne)Z.push(255&X.charCodeAt(ne));return Z}(O),F,$,W)}function E(F,O,$,W){return _(F,O,$,W)}function D(F,O,$,W){return Ce(_e(O),F,$,W)}function b(F,O,$,W){return Ce(function(X,Z){for(var ne,xe,Ie,Le=[],je=0;je<X.length&&!((Z-=2)<0);++je)ne=X.charCodeAt(je),xe=ne>>8,Ie=ne%256,Le.push(Ie),Le.push(xe);return Le}(O,F.length-$),F,$,W)}function I(F,O,$){return O===0&&$===F.length?a.fromByteArray(F):a.fromByteArray(F.slice(O,$))}function R(F,O,$){$=Math.min(F.length,$);for(var W=[],X=O;X<$;){var Z,ne,xe,Ie,Le=F[X],je=null,ie=Le>239?4:Le>223?3:Le>191?2:1;if(X+ie<=$)switch(ie){case 1:Le<128&&(je=Le);break;case 2:(192&(Z=F[X+1]))==128&&(Ie=(31&Le)<<6|63&Z)>127&&(je=Ie);break;case 3:Z=F[X+1],ne=F[X+2],(192&Z)==128&&(192&ne)==128&&(Ie=(15&Le)<<12|(63&Z)<<6|63&ne)>2047&&(Ie<55296||Ie>57343)&&(je=Ie);break;case 4:Z=F[X+1],ne=F[X+2],xe=F[X+3],(192&Z)==128&&(192&ne)==128&&(192&xe)==128&&(Ie=(15&Le)<<18|(63&Z)<<12|(63&ne)<<6|63&xe)>65535&&Ie<1114112&&(je=Ie)}je===null?(je=65533,ie=1):je>65535&&(je-=65536,W.push(je>>>10&1023|55296),je=56320|1023&je),W.push(je),X+=ie}return function(ae){var ve=ae.length;if(ve<=4096)return String.fromCharCode.apply(String,ae);for(var se="",ge=0;ge<ve;)se+=String.fromCharCode.apply(String,ae.slice(ge,ge+=4096));return se}(W)}n.Buffer=u,n.SlowBuffer=function(F){return+F!=F&&(F=0),u.alloc(+F)},n.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=o.TYPED_ARRAY_SUPPORT!==void 0?o.TYPED_ARRAY_SUPPORT:function(){try{var F=new Uint8Array(1);return F.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},F.foo()===42&&typeof F.subarray=="function"&&F.subarray(1,1).byteLength===0}catch{return!1}}(),n.kMaxLength=l(),u.poolSize=8192,u._augment=function(F){return F.__proto__=u.prototype,F},u.from=function(F,O,$){return d(null,F,O,$)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(F,O,$){return function(W,X,Z,ne){return h(X),X<=0?f(W,X):Z!==void 0?typeof ne=="string"?f(W,X).fill(Z,ne):f(W,X).fill(Z):f(W,X)}(null,F,O,$)},u.allocUnsafe=function(F){return g(null,F)},u.allocUnsafeSlow=function(F){return g(null,F)},u.isBuffer=function(F){return!(F==null||!F._isBuffer)},u.compare=function(F,O){if(!u.isBuffer(F)||!u.isBuffer(O))throw new TypeError("Arguments must be Buffers");if(F===O)return 0;for(var $=F.length,W=O.length,X=0,Z=Math.min($,W);X<Z;++X)if(F[X]!==O[X]){$=F[X],W=O[X];break}return $<W?-1:W<$?1:0},u.isEncoding=function(F){switch(String(F).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(F,O){if(!c(F))throw new TypeError('"list" argument must be an Array of Buffers');if(F.length===0)return u.alloc(0);var $;if(O===void 0)for(O=0,$=0;$<F.length;++$)O+=F[$].length;var W=u.allocUnsafe(O),X=0;for($=0;$<F.length;++$){var Z=F[$];if(!u.isBuffer(Z))throw new TypeError('"list" argument must be an Array of Buffers');Z.copy(W,X),X+=Z.length}return W},u.byteLength=w,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var F=this.length;if(F%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var O=0;O<F;O+=2)y(this,O,O+1);return this},u.prototype.swap32=function(){var F=this.length;if(F%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var O=0;O<F;O+=4)y(this,O,O+3),y(this,O+1,O+2);return this},u.prototype.swap64=function(){var F=this.length;if(F%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var O=0;O<F;O+=8)y(this,O,O+7),y(this,O+1,O+6),y(this,O+2,O+5),y(this,O+3,O+4);return this},u.prototype.toString=function(){var F=0|this.length;return F===0?"":arguments.length===0?R(this,0,F):m.apply(this,arguments)},u.prototype.equals=function(F){if(!u.isBuffer(F))throw new TypeError("Argument must be a Buffer");return this===F||u.compare(this,F)===0},u.prototype.inspect=function(){var F="",O=n.INSPECT_MAX_BYTES;return this.length>0&&(F=this.toString("hex",0,O).match(/.{2}/g).join(" "),this.length>O&&(F+=" ... ")),"<Buffer "+F+">"},u.prototype.compare=function(F,O,$,W,X){if(!u.isBuffer(F))throw new TypeError("Argument must be a Buffer");if(O===void 0&&(O=0),$===void 0&&($=F?F.length:0),W===void 0&&(W=0),X===void 0&&(X=this.length),O<0||$>F.length||W<0||X>this.length)throw new RangeError("out of range index");if(W>=X&&O>=$)return 0;if(W>=X)return-1;if(O>=$)return 1;if(this===F)return 0;for(var Z=(X>>>=0)-(W>>>=0),ne=($>>>=0)-(O>>>=0),xe=Math.min(Z,ne),Ie=this.slice(W,X),Le=F.slice(O,$),je=0;je<xe;++je)if(Ie[je]!==Le[je]){Z=Ie[je],ne=Le[je];break}return Z<ne?-1:ne<Z?1:0},u.prototype.includes=function(F,O,$){return this.indexOf(F,O,$)!==-1},u.prototype.indexOf=function(F,O,$){return x(this,F,O,$,!0)},u.prototype.lastIndexOf=function(F,O,$){return x(this,F,O,$,!1)},u.prototype.write=function(F,O,$,W){if(O===void 0)W="utf8",$=this.length,O=0;else if($===void 0&&typeof O=="string")W=O,$=this.length,O=0;else{if(!isFinite(O))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");O|=0,isFinite($)?($|=0,W===void 0&&(W="utf8")):(W=$,$=void 0)}var X=this.length-O;if(($===void 0||$>X)&&($=X),F.length>0&&($<0||O<0)||O>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var Z=!1;;)switch(W){case"hex":return S(this,F,O,$);case"utf8":case"utf-8":return T(this,F,O,$);case"ascii":return _(this,F,O,$);case"latin1":case"binary":return E(this,F,O,$);case"base64":return D(this,F,O,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,F,O,$);default:if(Z)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),Z=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function M(F,O,$){var W="";$=Math.min(F.length,$);for(var X=O;X<$;++X)W+=String.fromCharCode(127&F[X]);return W}function P(F,O,$){var W="";$=Math.min(F.length,$);for(var X=O;X<$;++X)W+=String.fromCharCode(F[X]);return W}function k(F,O,$){var W=F.length;(!O||O<0)&&(O=0),(!$||$<0||$>W)&&($=W);for(var X="",Z=O;Z<$;++Z)X+=me(F[Z]);return X}function z(F,O,$){for(var W=F.slice(O,$),X="",Z=0;Z<W.length;Z+=2)X+=String.fromCharCode(W[Z]+256*W[Z+1]);return X}function A(F,O,$){if(F%1!=0||F<0)throw new RangeError("offset is not uint");if(F+O>$)throw new RangeError("Trying to access beyond buffer length")}function L(F,O,$,W,X,Z){if(!u.isBuffer(F))throw new TypeError('"buffer" argument must be a Buffer instance');if(O>X||O<Z)throw new RangeError('"value" argument is out of bounds');if($+W>F.length)throw new RangeError("Index out of range")}function N(F,O,$,W){O<0&&(O=65535+O+1);for(var X=0,Z=Math.min(F.length-$,2);X<Z;++X)F[$+X]=(O&255<<8*(W?X:1-X))>>>8*(W?X:1-X)}function H(F,O,$,W){O<0&&(O=4294967295+O+1);for(var X=0,Z=Math.min(F.length-$,4);X<Z;++X)F[$+X]=O>>>8*(W?X:3-X)&255}function ee(F,O,$,W,X,Z){if($+W>F.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("Index out of range")}function oe(F,O,$,W,X){return X||ee(F,0,$,4),s.write(F,O,$,W,23,4),$+4}function de(F,O,$,W,X){return X||ee(F,0,$,8),s.write(F,O,$,W,52,8),$+8}u.prototype.slice=function(F,O){var $,W=this.length;if((F=~~F)<0?(F+=W)<0&&(F=0):F>W&&(F=W),(O=O===void 0?W:~~O)<0?(O+=W)<0&&(O=0):O>W&&(O=W),O<F&&(O=F),u.TYPED_ARRAY_SUPPORT)($=this.subarray(F,O)).__proto__=u.prototype;else{var X=O-F;$=new u(X,void 0);for(var Z=0;Z<X;++Z)$[Z]=this[Z+F]}return $},u.prototype.readUIntLE=function(F,O,$){F|=0,O|=0,$||A(F,O,this.length);for(var W=this[F],X=1,Z=0;++Z<O&&(X*=256);)W+=this[F+Z]*X;return W},u.prototype.readUIntBE=function(F,O,$){F|=0,O|=0,$||A(F,O,this.length);for(var W=this[F+--O],X=1;O>0&&(X*=256);)W+=this[F+--O]*X;return W},u.prototype.readUInt8=function(F,O){return O||A(F,1,this.length),this[F]},u.prototype.readUInt16LE=function(F,O){return O||A(F,2,this.length),this[F]|this[F+1]<<8},u.prototype.readUInt16BE=function(F,O){return O||A(F,2,this.length),this[F]<<8|this[F+1]},u.prototype.readUInt32LE=function(F,O){return O||A(F,4,this.length),(this[F]|this[F+1]<<8|this[F+2]<<16)+16777216*this[F+3]},u.prototype.readUInt32BE=function(F,O){return O||A(F,4,this.length),16777216*this[F]+(this[F+1]<<16|this[F+2]<<8|this[F+3])},u.prototype.readIntLE=function(F,O,$){F|=0,O|=0,$||A(F,O,this.length);for(var W=this[F],X=1,Z=0;++Z<O&&(X*=256);)W+=this[F+Z]*X;return W>=(X*=128)&&(W-=Math.pow(2,8*O)),W},u.prototype.readIntBE=function(F,O,$){F|=0,O|=0,$||A(F,O,this.length);for(var W=O,X=1,Z=this[F+--W];W>0&&(X*=256);)Z+=this[F+--W]*X;return Z>=(X*=128)&&(Z-=Math.pow(2,8*O)),Z},u.prototype.readInt8=function(F,O){return O||A(F,1,this.length),128&this[F]?-1*(255-this[F]+1):this[F]},u.prototype.readInt16LE=function(F,O){O||A(F,2,this.length);var $=this[F]|this[F+1]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt16BE=function(F,O){O||A(F,2,this.length);var $=this[F+1]|this[F]<<8;return 32768&$?4294901760|$:$},u.prototype.readInt32LE=function(F,O){return O||A(F,4,this.length),this[F]|this[F+1]<<8|this[F+2]<<16|this[F+3]<<24},u.prototype.readInt32BE=function(F,O){return O||A(F,4,this.length),this[F]<<24|this[F+1]<<16|this[F+2]<<8|this[F+3]},u.prototype.readFloatLE=function(F,O){return O||A(F,4,this.length),s.read(this,F,!0,23,4)},u.prototype.readFloatBE=function(F,O){return O||A(F,4,this.length),s.read(this,F,!1,23,4)},u.prototype.readDoubleLE=function(F,O){return O||A(F,8,this.length),s.read(this,F,!0,52,8)},u.prototype.readDoubleBE=function(F,O){return O||A(F,8,this.length),s.read(this,F,!1,52,8)},u.prototype.writeUIntLE=function(F,O,$,W){F=+F,O|=0,$|=0,W||L(this,F,O,$,Math.pow(2,8*$)-1,0);var X=1,Z=0;for(this[O]=255&F;++Z<$&&(X*=256);)this[O+Z]=F/X&255;return O+$},u.prototype.writeUIntBE=function(F,O,$,W){F=+F,O|=0,$|=0,W||L(this,F,O,$,Math.pow(2,8*$)-1,0);var X=$-1,Z=1;for(this[O+X]=255&F;--X>=0&&(Z*=256);)this[O+X]=F/Z&255;return O+$},u.prototype.writeUInt8=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,1,255,0),u.TYPED_ARRAY_SUPPORT||(F=Math.floor(F)),this[O]=255&F,O+1},u.prototype.writeUInt16LE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[O]=255&F,this[O+1]=F>>>8):N(this,F,O,!0),O+2},u.prototype.writeUInt16BE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[O]=F>>>8,this[O+1]=255&F):N(this,F,O,!1),O+2},u.prototype.writeUInt32LE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[O+3]=F>>>24,this[O+2]=F>>>16,this[O+1]=F>>>8,this[O]=255&F):H(this,F,O,!0),O+4},u.prototype.writeUInt32BE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[O]=F>>>24,this[O+1]=F>>>16,this[O+2]=F>>>8,this[O+3]=255&F):H(this,F,O,!1),O+4},u.prototype.writeIntLE=function(F,O,$,W){if(F=+F,O|=0,!W){var X=Math.pow(2,8*$-1);L(this,F,O,$,X-1,-X)}var Z=0,ne=1,xe=0;for(this[O]=255&F;++Z<$&&(ne*=256);)F<0&&xe===0&&this[O+Z-1]!==0&&(xe=1),this[O+Z]=(F/ne>>0)-xe&255;return O+$},u.prototype.writeIntBE=function(F,O,$,W){if(F=+F,O|=0,!W){var X=Math.pow(2,8*$-1);L(this,F,O,$,X-1,-X)}var Z=$-1,ne=1,xe=0;for(this[O+Z]=255&F;--Z>=0&&(ne*=256);)F<0&&xe===0&&this[O+Z+1]!==0&&(xe=1),this[O+Z]=(F/ne>>0)-xe&255;return O+$},u.prototype.writeInt8=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,1,127,-128),u.TYPED_ARRAY_SUPPORT||(F=Math.floor(F)),F<0&&(F=255+F+1),this[O]=255&F,O+1},u.prototype.writeInt16LE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[O]=255&F,this[O+1]=F>>>8):N(this,F,O,!0),O+2},u.prototype.writeInt16BE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[O]=F>>>8,this[O+1]=255&F):N(this,F,O,!1),O+2},u.prototype.writeInt32LE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[O]=255&F,this[O+1]=F>>>8,this[O+2]=F>>>16,this[O+3]=F>>>24):H(this,F,O,!0),O+4},u.prototype.writeInt32BE=function(F,O,$){return F=+F,O|=0,$||L(this,F,O,4,2147483647,-2147483648),F<0&&(F=4294967295+F+1),u.TYPED_ARRAY_SUPPORT?(this[O]=F>>>24,this[O+1]=F>>>16,this[O+2]=F>>>8,this[O+3]=255&F):H(this,F,O,!1),O+4},u.prototype.writeFloatLE=function(F,O,$){return oe(this,F,O,!0,$)},u.prototype.writeFloatBE=function(F,O,$){return oe(this,F,O,!1,$)},u.prototype.writeDoubleLE=function(F,O,$){return de(this,F,O,!0,$)},u.prototype.writeDoubleBE=function(F,O,$){return de(this,F,O,!1,$)},u.prototype.copy=function(F,O,$,W){if($||($=0),W||W===0||(W=this.length),O>=F.length&&(O=F.length),O||(O=0),W>0&&W<$&&(W=$),W===$||F.length===0||this.length===0)return 0;if(O<0)throw new RangeError("targetStart out of bounds");if($<0||$>=this.length)throw new RangeError("sourceStart out of bounds");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),F.length-O<W-$&&(W=F.length-O+$);var X,Z=W-$;if(this===F&&$<O&&O<W)for(X=Z-1;X>=0;--X)F[X+O]=this[X+$];else if(Z<1e3||!u.TYPED_ARRAY_SUPPORT)for(X=0;X<Z;++X)F[X+O]=this[X+$];else Uint8Array.prototype.set.call(F,this.subarray($,$+Z),O);return Z},u.prototype.fill=function(F,O,$,W){if(typeof F=="string"){if(typeof O=="string"?(W=O,O=0,$=this.length):typeof $=="string"&&(W=$,$=this.length),F.length===1){var X=F.charCodeAt(0);X<256&&(F=X)}if(W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!u.isEncoding(W))throw new TypeError("Unknown encoding: "+W)}else typeof F=="number"&&(F&=255);if(O<0||this.length<O||this.length<$)throw new RangeError("Out of range index");if($<=O)return this;var Z;if(O>>>=0,$=$===void 0?this.length:$>>>0,F||(F=0),typeof F=="number")for(Z=O;Z<$;++Z)this[Z]=F;else{var ne=u.isBuffer(F)?F:Ee(new u(F,W).toString()),xe=ne.length;for(Z=0;Z<$-O;++Z)this[Z+O]=ne[Z%xe]}return this};var ue=/[^+\/0-9A-Za-z-_]/g;function me(F){return F<16?"0"+F.toString(16):F.toString(16)}function Ee(F,O){var $;O=O||1/0;for(var W=F.length,X=null,Z=[],ne=0;ne<W;++ne){if(($=F.charCodeAt(ne))>55295&&$<57344){if(!X){if($>56319){(O-=3)>-1&&Z.push(239,191,189);continue}if(ne+1===W){(O-=3)>-1&&Z.push(239,191,189);continue}X=$;continue}if($<56320){(O-=3)>-1&&Z.push(239,191,189),X=$;continue}$=65536+(X-55296<<10|$-56320)}else X&&(O-=3)>-1&&Z.push(239,191,189);if(X=null,$<128){if((O-=1)<0)break;Z.push($)}else if($<2048){if((O-=2)<0)break;Z.push($>>6|192,63&$|128)}else if($<65536){if((O-=3)<0)break;Z.push($>>12|224,$>>6&63|128,63&$|128)}else{if(!($<1114112))throw new Error("Invalid code point");if((O-=4)<0)break;Z.push($>>18|240,$>>12&63|128,$>>6&63|128,63&$|128)}}return Z}function _e(F){return a.toByteArray(function(O){if((O=function($){return $.trim?$.trim():$.replace(/^\s+|\s+$/g,"")}(O).replace(ue,"")).length<2)return"";for(;O.length%4!=0;)O+="=";return O}(F))}function Ce(F,O,$,W){for(var X=0;X<W&&!(X+$>=O.length||X>=F.length);++X)O[X+$]=F[X];return X}}).call(this,i(78))},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.isASCIIByte=function(o){return o>=0&&o<=127}},function(r,n,i){var o=this&&this.__read||function(s,c){var l=typeof Symbol=="function"&&s[Symbol.iterator];if(!l)return s;var f,u,d=l.call(s),h=[];try{for(;(c===void 0||c-- >0)&&!(f=d.next()).done;)h.push(f.value)}catch(g){u={error:g}}finally{try{f&&!f.done&&(l=d.return)&&l.call(d)}finally{if(u)throw u.error}}return h},a=this&&this.__spread||function(){for(var s=[],c=0;c<arguments.length;c++)s=s.concat(o(arguments[c]));return s};Object.defineProperty(n,"__esModule",{value:!0}),n.length=function(s){return s.length},n.byteLowercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=65&&l<=90&&(s[c]=l+32)}},n.byteUppercase=function(s){for(var c=0;c<s.length;c++){var l=s[c];l>=97&&l<=122&&(s[c]=l-32)}},n.byteCaseInsensitiveMatch=function(s,c){if(s.length!==c.length)return!1;for(var l=0;l<s.length;l++){var f=s[l],u=c[l];if(f>=65&&f<=90&&(f+=32),u>=65&&u<=90&&(u+=32),f!==u)return!1}return!0},n.startsWith=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;if(s[l]!==c[l])return!1;l++}},n.byteLessThan=function(s,c){for(var l=0;;){if(l>=s.length)return!1;if(l>=c.length)return!0;var f=s[l],u=c[l];if(f<u)return!0;if(f>u)return!1;l++}},n.isomorphicDecode=function(s){return String.fromCodePoint.apply(String,a(s))}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(7),s=i(0),c=i(12),l=function(){function f(u){this._associatedDocument=u||o.dom.window.document}return f.prototype.createDocumentType=function(u,d,h){return s.namespace_validate(u),s.create_documentType(this._associatedDocument,u,d,h)},f.prototype.createDocument=function(u,d,h){h===void 0&&(h=null);var g=s.create_xmlDocument(),p=null;return d&&(p=s.document_internalCreateElementNS(g,u,d)),h&&g.appendChild(h),p&&g.appendChild(p),g._origin=this._associatedDocument._origin,u===a.namespace.HTML?g._contentType="application/xhtml+xml":u===a.namespace.SVG?g._contentType="image/svg+xml":g._contentType="application/xml",g},f.prototype.createHTMLDocument=function(u){var d=s.create_document();d._type="html",d._contentType="text/html",d.appendChild(s.create_documentType(d,"html","",""));var h=s.element_createAnElement(d,"html",a.namespace.HTML);d.appendChild(h);var g=s.element_createAnElement(d,"head",a.namespace.HTML);if(h.appendChild(g),u!==void 0){var p=s.element_createAnElement(d,"title",a.namespace.HTML);g.appendChild(p);var v=s.create_text(d,u);p.appendChild(v)}var w=s.element_createAnElement(d,"body",a.namespace.HTML);return h.appendChild(w),d._origin=this._associatedDocument._origin,d},f.prototype.hasFeature=function(){return!0},f._create=function(u){return new f(u)},f}();n.DOMImplementationImpl=l,c.idl_defineConst(l.prototype,"_ID","@oozcitak/dom")},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(1),l=i(0),f=function(u){function d(){var h=u.call(this)||this;return h._signalSlots=new Set,h._mutationObserverMicrotaskQueued=!1,h._mutationObservers=new Set,h._iteratorList=new c.FixedSizeSet,h._associatedDocument=l.create_document(),h}return a(d,u),Object.defineProperty(d.prototype,"document",{get:function(){return this._associatedDocument},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"event",{get:function(){return this._currentEvent},enumerable:!0,configurable:!0}),d._create=function(){return new d},d}(s.EventTargetImpl);n.WindowImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=function(){function s(){}return s.isNode=function(c){return!!c&&c._nodeType!==void 0},s.isDocumentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Document},s.isDocumentTypeNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentType},s.isDocumentFragmentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.DocumentFragment},s.isAttrNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Attribute},s.isCharacterDataNode=function(c){if(!s.isNode(c))return!1;var l=c._nodeType;return l===o.NodeType.Text||l===o.NodeType.ProcessingInstruction||l===o.NodeType.Comment||l===o.NodeType.CData},s.isTextNode=function(c){return s.isNode(c)&&(c._nodeType===o.NodeType.Text||c._nodeType===o.NodeType.CData)},s.isExclusiveTextNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Text},s.isCDATASectionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.CData},s.isCommentNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Comment},s.isProcessingInstructionNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.ProcessingInstruction},s.isElementNode=function(c){return s.isNode(c)&&c._nodeType===o.NodeType.Element},s.isCustomElementNode=function(c){return s.isElementNode(c)&&c._customElementState==="custom"},s.isShadowRoot=function(c){return!!c&&c.host!==void 0},s.isMouseEvent=function(c){return!!c&&c.screenX!==void 0&&c.screenY!=null},s.isSlotable=function(c){return!!c&&c._name!==void 0&&c._assignedSlot!==void 0&&(s.isTextNode(c)||s.isElementNode(c))},s.isSlot=function(c){return!!c&&c._name!==void 0&&c._assignedNodes!==void 0&&s.isElementNode(c)},s.isWindow=function(c){return!!c&&c.navigator!==void 0},s.isEventListener=function(c){return!!c&&c.handleEvent!==void 0},s.isRegisteredObserver=function(c){return!!c&&c.observer!==void 0&&c.options!==void 0},s.isTransientRegisteredObserver=function(c){return!!c&&c.source!==void 0&&s.isRegisteredObserver(c)},s}();n.Guard=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=function(c){function l(){return c.call(this)||this}return a(l,c),l}(i(98).DocumentImpl);n.XMLDocumentImpl=s},function(r,n,i){var o=this&&this.__values||function(W){var X=typeof Symbol=="function"&&Symbol.iterator,Z=X&&W[X],ne=0;if(Z)return Z.call(W);if(W&&typeof W.length=="number")return{next:function(){return W&&ne>=W.length&&(W=void 0),{value:W&&W[ne++],done:!W}}};throw new TypeError(X?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(W,X){var Z=typeof Symbol=="function"&&W[Symbol.iterator];if(!Z)return W;var ne,xe,Ie=Z.call(W),Le=[];try{for(;(X===void 0||X-- >0)&&!(ne=Ie.next()).done;)Le.push(ne.value)}catch(je){xe={error:je}}finally{try{ne&&!ne.done&&(Z=Ie.return)&&Z.call(Ie)}finally{if(xe)throw xe.error}}return Le};Object.defineProperty(n,"__esModule",{value:!0});var s,c=i(1),l=i(243),f=i(7),u=i(244),d={ftp:21,file:null,http:80,https:443,ws:80,wss:443},h=/[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,g=/[ "<>`]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p=/[ "<>`#?{}]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,v=/[ "<>`#?{}/:;=@\[\]\\\^\|]|[\0-\x1F\x7F-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,w=/[0-9A-Za-z!\$&-\/:;=\?@_~\xA0-\uD7FF\uE000-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uD83E\uD840-\uD87E\uD880-\uD8BE\uD8C0-\uD8FE\uD900-\uD93E\uD940-\uD97E\uD980-\uD9BE\uD9C0-\uD9FE\uDA00-\uDA3E\uDA40-\uDA7E\uDA80-\uDABE\uDAC0-\uDAFE\uDB00-\uDB3E\uDB40-\uDB7E\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDC00-\uDFFD]/,m=/[\0\t\f\r #%/:?@\[\\\]]/;function y(W){s!==void 0&&s.call(null,"Validation Error: "+W)}function x(){return{scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null}}function C(W){return W in d}function S(W){return C(W.scheme)}function T(W){return d[W]||null}function _(W){return W.username!==""||W.password!==""}function E(W,X){var Z,ne;X===void 0&&(X=!1);var xe=W.scheme+":";if(W.host!==null?(xe+="//",_(W)&&(xe+=W.username,W.password!==""&&(xe+=":"+W.password),xe+="@"),xe+=D(W.host),W.port!==null&&(xe+=":"+W.port)):W.host===null&&W.scheme==="file"&&(xe+="//"),W._cannotBeABaseURLFlag)xe+=W.path[0];else try{for(var Ie=o(W.path),Le=Ie.next();!Le.done;Le=Ie.next())xe+="/"+Le.value}catch(je){Z={error:je}}finally{try{Le&&!Le.done&&(ne=Ie.return)&&ne.call(Ie)}finally{if(Z)throw Z.error}}return W.query!==null&&(xe+="?"+W.query),X||W.fragment===null||(xe+="#"+W.fragment),xe}function D(W){return c.isNumber(W)?b(W):c.isArray(W)?"["+I(W)+"]":W}function b(W){for(var X="",Z=W,ne=1;ne<=4;ne++)X=(Z%256).toString()+X,ne!==4&&(X="."+X),Z=Math.floor(Z/256);return X}function I(W){for(var X="",Z=null,ne=-1,xe=0,Ie=0,Le=0;Le<8;Le++)if(W[Le]===0){xe=1;for(var je=Le+1;je<8&&W[je]===0;je++)xe++;xe>Ie&&(Ie=xe,ne=Le)}Ie>1&&(Z=ne);for(var ie=!1,ae=0;ae<8;ae++)ie&&W[ae]===0||(ie&&(ie=!1),Z!==ae?(X+=W[ae].toString(16),ae!==7&&(X+=":")):(X+=ae===0?"::":":",ie=!0));return X}function R(W,X,Z,ne,xe){var Ie,Le,je,ie;if(ne===void 0){ne={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,_cannotBeABaseURLFlag:!1,_blobURLEntry:null};var ae=/^[\u0000-\u001F\u0020]+/,ve=/[\u0000-\u001F\u0020]+$/;(ae.test(W)||ve.test(W))&&y("Input string contains leading or trailing control characters or space."),W=(W=W.replace(ae,"")).replace(ve,"")}var se=/[\u0009\u000A\u000D]/g;se.test(W)&&y("Input string contains tab or newline characters."),W=W.replace(se,"");var ge=xe===void 0?l.ParserState.SchemeStart:xe;X===void 0&&(X=null);for(var Ve=Z===void 0||Z==="replacement"||Z==="UTF-16BE"||Z==="UTF-16LE"?"UTF-8":Z,re="",it=!1,ut=!1,ot=!1,Se=new c.StringWalker(W);;){switch(ge){case l.ParserState.SchemeStart:if(f.codePoint.ASCIIAlpha.test(Se.c()))re+=Se.c().toLowerCase(),ge=l.ParserState.Scheme;else{if(xe!==void 0)return y("Invalid scheme start character."),null;ge=l.ParserState.NoScheme,Se.pointer--}break;case l.ParserState.Scheme:if(f.codePoint.ASCIIAlphanumeric.test(Se.c())||Se.c()==="+"||Se.c()==="-"||Se.c()===".")re+=Se.c().toLowerCase();else{if(Se.c()!==":"){if(xe===void 0){re="",ge=l.ParserState.NoScheme,Se.pointer=0;continue}return y("Invalid input string."),null}if(xe!==void 0&&(C(ne.scheme)&&!C(re)||!C(ne.scheme)&&C(re)||(_(ne)||ne.port!==null)&&re==="file"||ne.scheme==="file"&&(ne.host===""||ne.host===null)))return ne;if(ne.scheme=re,xe!==void 0)return ne.port===T(ne.scheme)&&(ne.port=null),ne;re="",ne.scheme==="file"?(Se.remaining().startsWith("//")||y("Invalid file URL scheme, '//' expected."),ge=l.ParserState.File):S(ne)&&X!==null&&X.scheme===ne.scheme?ge=l.ParserState.SpecialRelativeOrAuthority:S(ne)?ge=l.ParserState.SpecialAuthoritySlashes:Se.remaining().startsWith("/")?(ge=l.ParserState.PathOrAuthority,Se.pointer++):(ne._cannotBeABaseURLFlag=!0,ne.path.push(""),ge=l.ParserState.CannotBeABaseURLPath)}break;case l.ParserState.NoScheme:if(X===null||X._cannotBeABaseURLFlag&&Se.c()!=="#")return y("Invalid input string."),null;X._cannotBeABaseURLFlag&&Se.c()==="#"?(ne.scheme=X.scheme,ne.path=f.list.clone(X.path),ne.query=X.query,ne.fragment="",ne._cannotBeABaseURLFlag=!0,ge=l.ParserState.Fragment):X.scheme!=="file"?(ge=l.ParserState.Relative,Se.pointer--):(ge=l.ParserState.File,Se.pointer--);break;case l.ParserState.SpecialRelativeOrAuthority:Se.c()==="/"&&Se.remaining().startsWith("/")?(ge=l.ParserState.SpecialAuthorityIgnoreSlashes,Se.pointer++):(y("Invalid input string."),ge=l.ParserState.Relative,Se.pointer--);break;case l.ParserState.PathOrAuthority:Se.c()==="/"?ge=l.ParserState.Authority:(ge=l.ParserState.Path,Se.pointer--);break;case l.ParserState.Relative:if(X===null)throw new Error("Invalid parser state. Base URL is null.");switch(ne.scheme=X.scheme,Se.c()){case"":ne.username=X.username,ne.password=X.password,ne.host=X.host,ne.port=X.port,ne.path=f.list.clone(X.path),ne.query=X.query;break;case"/":ge=l.ParserState.RelativeSlash;break;case"?":ne.username=X.username,ne.password=X.password,ne.host=X.host,ne.port=X.port,ne.path=f.list.clone(X.path),ne.query="",ge=l.ParserState.Query;break;case"#":ne.username=X.username,ne.password=X.password,ne.host=X.host,ne.port=X.port,ne.path=f.list.clone(X.path),ne.query=X.query,ne.fragment="",ge=l.ParserState.Fragment;break;default:S(ne)&&Se.c()==="\\"?(y("Invalid input string."),ge=l.ParserState.RelativeSlash):(ne.username=X.username,ne.password=X.password,ne.host=X.host,ne.port=X.port,ne.path=f.list.clone(X.path),ne.path.length!==0&&ne.path.splice(ne.path.length-1,1),ge=l.ParserState.Path,Se.pointer--)}break;case l.ParserState.RelativeSlash:if(!S(ne)||Se.c()!=="/"&&Se.c()!=="\\")if(Se.c()==="/")ge=l.ParserState.Authority;else{if(X===null)throw new Error("Invalid parser state. Base URL is null.");ne.username=X.username,ne.password=X.password,ne.host=X.host,ne.port=X.port,ge=l.ParserState.Path,Se.pointer--}else Se.c()==="\\"&&y("Invalid input string."),ge=l.ParserState.SpecialAuthorityIgnoreSlashes;break;case l.ParserState.SpecialAuthoritySlashes:Se.c()==="/"&&Se.remaining().startsWith("/")?(ge=l.ParserState.SpecialAuthorityIgnoreSlashes,Se.pointer++):(y("Expected '//'."),ge=l.ParserState.SpecialAuthorityIgnoreSlashes,Se.pointer--);break;case l.ParserState.SpecialAuthorityIgnoreSlashes:Se.c()!=="/"&&Se.c()!=="\\"?(ge=l.ParserState.Authority,Se.pointer--):y("Unexpected '/' or '\\'.");break;case l.ParserState.Authority:if(Se.c()==="@"){y("Unexpected '@'."),it&&(re="%40"+re),it=!0;try{for(var Ge=(Ie=void 0,o(re)),et=Ge.next();!et.done;et=Ge.next()){var qe=et.value;if(qe!==":"||ot){var st=Ce(qe,v);ot?ne.password+=st:ne.username+=st}else ot=!0}}catch(Tn){Ie={error:Tn}}finally{try{et&&!et.done&&(Le=Ge.return)&&Le.call(Ge)}finally{if(Ie)throw Ie.error}}re=""}else if(Se.c()===""||Se.c()==="/"||Se.c()==="?"||Se.c()==="#"||S(ne)&&Se.c()==="\\"){if(it&&re==="")return y("Invalid input string."),null;Se.pointer-=re.length+1,re="",ge=l.ParserState.Host}else re+=Se.c();break;case l.ParserState.Host:case l.ParserState.Hostname:if(xe!==void 0&&ne.scheme==="file")Se.pointer--,ge=l.ParserState.FileHost;else if(Se.c()!==":"||ut)if(Se.c()===""||Se.c()==="/"||Se.c()==="?"||Se.c()==="#"||S(ne)&&Se.c()==="\\"){if(Se.pointer--,S(ne)&&re==="")return y("Invalid input string."),null;if(xe!==void 0&&re===""&&(_(ne)||ne.port!==null))return y("Invalid input string."),ne;if((ct=N(re,!S(ne)))===null)return null;if(ne.host=ct,re="",ge=l.ParserState.PathStart,xe!==void 0)return ne}else Se.c()==="["&&(ut=!0),Se.c()==="]"&&(ut=!1),re+=Se.c();else{if(re==="")return y("Invalid input string."),null;if((ct=N(re,!S(ne)))===null)return null;if(ne.host=ct,re="",ge=l.ParserState.Port,xe===l.ParserState.Hostname)return ne}break;case l.ParserState.Port:if(f.codePoint.ASCIIDigit.test(Se.c()))re+=Se.c();else{if(!(Se.c()===""||Se.c()==="/"||Se.c()==="?"||Se.c()==="#"||S(ne)&&Se.c()==="\\"||xe))return y("Invalid input string."),null;if(re!==""&&re!==""){var Et=parseInt(re,10);if(Et>Math.pow(2,16)-1)return y("Invalid port number."),null;ne.port=Et===T(ne.scheme)?null:Et,re=""}if(xe!==void 0)return ne;ge=l.ParserState.PathStart,Se.pointer--}break;case l.ParserState.File:if(ne.scheme="file",Se.c()==="/"||Se.c()==="\\")Se.c()==="\\"&&y("Invalid input string."),ge=l.ParserState.FileSlash;else if(X!==null&&X.scheme==="file")switch(Se.c()){case"":ne.host=X.host,ne.path=f.list.clone(X.path),ne.query=X.query;break;case"?":ne.host=X.host,ne.path=f.list.clone(X.path),ne.query="",ge=l.ParserState.Query;break;case"#":ne.host=X.host,ne.path=f.list.clone(X.path),ne.query=X.query,ne.fragment="",ge=l.ParserState.Fragment;break;default:L(Se.substring())?y("Unexpected windows drive letter in input string."):(ne.host=X.host,ne.path=f.list.clone(X.path),k(ne)),ge=l.ParserState.Path,Se.pointer--}else ge=l.ParserState.Path,Se.pointer--;break;case l.ParserState.FileSlash:Se.c()==="/"||Se.c()==="\\"?(Se.c()==="\\"&&y("Invalid input string."),ge=l.ParserState.FileHost):(X===null||X.scheme!=="file"||L(Se.substring())||(z(X.path[0])?ne.path.push(X.path[0]):ne.host=X.host),ge=l.ParserState.Path,Se.pointer--);break;case l.ParserState.FileHost:if(Se.c()===""||Se.c()==="/"||Se.c()==="\\"||Se.c()==="?"||Se.c()==="#")if(Se.pointer--,xe===void 0&&A(re))y("Unexpected windows drive letter in input string."),ge=l.ParserState.Path;else if(re===""){if(ne.host="",xe!==void 0)return ne;ge=l.ParserState.PathStart}else{var ct;if((ct=N(re,!S(ne)))===null)return null;if(ct==="localhost"&&(ct=""),ne.host=ct,xe!==void 0)return ne;re="",ge=l.ParserState.PathStart}else re+=Se.c();break;case l.ParserState.PathStart:S(ne)?(Se.c()==="\\"&&y("Invalid input string."),ge=l.ParserState.Path,Se.c()!=="/"&&Se.c()!=="\\"&&Se.pointer--):xe===void 0&&Se.c()==="?"?(ne.query="",ge=l.ParserState.Query):xe===void 0&&Se.c()==="#"?(ne.fragment="",ge=l.ParserState.Fragment):Se.c()!==""&&(ge=l.ParserState.Path,Se.c()!=="/"&&Se.pointer--);break;case l.ParserState.Path:if(Se.c()===""||Se.c()==="/"||S(ne)&&Se.c()==="\\"||xe===void 0&&(Se.c()==="?"||Se.c()==="#")){if(S(ne)&&Se.c()==="\\"&&y("Invalid input string."),P(re))k(ne),Se.c()==="/"||S(ne)&&Se.c()==="\\"||ne.path.push("");else if(!M(re)||Se.c()==="/"||S(ne)&&Se.c()==="\\"){if(!M(re)){if(ne.scheme==="file"&&ne.path.length===0&&A(re)){ne.host!==null&&ne.host!==""&&(y("Invalid input string."),ne.host="");var bt=Array.from(re);re=bt.slice(0,1)+":"+bt.slice(2)}ne.path.push(re)}}else ne.path.push("");if(re="",ne.scheme==="file"&&(Se.c()===""||Se.c()==="?"||Se.c()==="#"))for(;ne.path.length>1&&ne.path[0]==="";)y("Invalid input string."),ne.path.splice(0,1);Se.c()==="?"&&(ne.query="",ge=l.ParserState.Query),Se.c()==="#"&&(ne.fragment="",ge=l.ParserState.Fragment)}else w.test(Se.c())||Se.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Se.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Se.remaining())||y("Percent encoded character must be followed by two hex digits."),re+=Ce(Se.c(),p);break;case l.ParserState.CannotBeABaseURLPath:Se.c()==="?"?(ne.query="",ge=l.ParserState.Query):Se.c()==="#"?(ne.fragment="",ge=l.ParserState.Fragment):(Se.c()===""||w.test(Se.c())||Se.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Se.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Se.remaining())||y("Percent encoded character must be followed by two hex digits."),Se.c()!==""&&(ne.path[0]+=Ce(Se.c(),h)));break;case l.ParserState.Query:if(Ve==="UTF-8"||S(ne)&&ne.scheme!=="ws"&&ne.scheme!=="wss"||(Ve="UTF-8"),xe===void 0&&Se.c()==="#")ne.fragment="",ge=l.ParserState.Fragment;else if(Se.c()!==""){if(w.test(Se.c())||Se.c()==="%"||y("Character is not a URL code point or a percent encoded character."),Se.c()!=="%"||/^[0-9a-fA-F][0-9a-fA-F]/.test(Se.remaining())||y("Percent encoded character must be followed by two hex digits."),Ve.toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var It=c.utf8Encode(Se.c());if(It.length>=3&&It[0]===38&&It[1]===35&&It[It.length-1]===59)It=It.subarray(2,It.length-1),ne.query+="%26%23"+f.byteSequence.isomorphicDecode(It)+"%3B";else try{for(var ln=(je=void 0,o(It)),Pn=ln.next();!Pn.done;Pn=ln.next()){var zt=Pn.value;zt<33||zt>126||zt===34||zt===35||zt===60||zt===62||zt===39&&S(ne)?ne.query+=me(zt):ne.query+=String.fromCharCode(zt)}}catch(Tn){je={error:Tn}}finally{try{Pn&&!Pn.done&&(ie=ln.return)&&ie.call(ln)}finally{if(je)throw je.error}}}break;case l.ParserState.Fragment:Se.c()===""||(Se.c()==="\0"?y("NULL character in input string."):(w.test(Se.c())||Se.c()==="%"||y("Unexpected character in fragment string."),Se.c()!=="%"||/^[A-Za-z0-9][A-Za-z0-9]/.test(Se.remaining())||y("Unexpected character in fragment string."),ne.fragment+=Ce(Se.c(),g)))}if(Se.eof)break;Se.pointer++}return ne}function M(W){return W==="."||W.toLowerCase()==="%2e"}function P(W){var X=W.toLowerCase();return X===".."||X===".%2e"||X==="%2e."||X==="%2e%2e"}function k(W){var X=W.path;X.length!==0&&(W.scheme==="file"&&X.length===1&&z(X[0])||W.path.splice(W.path.length-1,1))}function z(W){return W.length>=2&&f.codePoint.ASCIIAlpha.test(W[0])&&W[1]===":"}function A(W){return W.length>=2&&f.codePoint.ASCIIAlpha.test(W[0])&&(W[1]===":"||W[1]==="|")}function L(W){return W.length>=2&&A(W)&&(W.length===2||W[2]==="/"||W[2]==="\\"||W[2]==="?"||W[2]==="#")}function N(W,X){if(X===void 0&&(X=!1),W.startsWith("["))return W.endsWith("]")?oe(W.substring(1,W.length-1)):(y("Expected ']' after '['."),null);if(X)return de(W);var Z=$(c.utf8Decode(_e(W)));if(Z===null||m.test(Z))return y("Invalid domain."),null;var ne=ee(Z);return ne===null||c.isNumber(ne)?ne:Z}function H(W,X){X===void 0&&(X={value:!1});var Z=10;return W.startsWith("0x")||W.startsWith("0X")?(X.value=!0,W=W.substr(2),Z=16):W.length>=2&&W[0]==="0"&&(X.value=!0,W=W.substr(1),Z=8),W===""?0:(Z===10?/^[0-9]+$/:Z===16?/^[0-9A-Fa-f]+$/:/^[0-7]+$/).test(W)?parseInt(W,Z):null}function ee(W){var X,Z,ne,xe,Ie={value:!1},Le=W.split(".");if(Le[Le.length-1]===""&&(Ie.value=!0,Le.length>1&&Le.pop()),Le.length>4)return W;var je=[];try{for(var ie=o(Le),ae=ie.next();!ae.done;ae=ie.next()){var ve=ae.value;if(ve===""||(ut=H(ve,Ie))===null)return W;je.push(ut)}}catch(ot){X={error:ot}}finally{try{ae&&!ae.done&&(Z=ie.return)&&Z.call(ie)}finally{if(X)throw X.error}}Ie.value&&y("Invalid IP v4 address.");for(var se=0;se<je.length;se++)if(je[se]>255&&(y("Invalid IP v4 address."),se<je.length-1))return null;if(je[je.length-1]>=Math.pow(256,5-je.length))return y("Invalid IP v4 address."),null;var ge=je[je.length-1];je.pop();var Ve=0;try{for(var re=o(je),it=re.next();!it.done;it=re.next()){var ut;ge+=(ut=it.value)*Math.pow(256,3-Ve),Ve++}}catch(ot){ne={error:ot}}finally{try{it&&!it.done&&(xe=re.return)&&xe.call(re)}finally{if(ne)throw ne.error}}return ge}function oe(W){var X,Z=[0,0,0,0,0,0,0,0],ne=0,xe=null,Ie=new c.StringWalker(W);if(Ie.c()===":"){if(!Ie.remaining().startsWith(":"))return y("Invalid IP v6 address."),null;Ie.pointer+=2,xe=ne+=1}for(;Ie.c()!=="";){if(ne===8)return y("Invalid IP v6 address."),null;if(Ie.c()!==":"){for(var Le=0,je=0;je<4&&f.codePoint.ASCIIHexDigit.test(Ie.c());)Le=16*Le+parseInt(Ie.c(),16),Ie.pointer++,je++;if(Ie.c()==="."){if(je===0||(Ie.pointer-=je,ne>6))return y("Invalid IP v6 address."),null;for(var ie=0;Ie.c()!=="";){var ae=null;if(ie>0){if(!(Ie.c()==="."&&ie<4))return y("Invalid IP v6 address."),null;Ie.pointer++}if(!f.codePoint.ASCIIDigit.test(Ie.c()))return y("Invalid IP v6 address."),null;for(;f.codePoint.ASCIIDigit.test(Ie.c());){var ve=parseInt(Ie.c(),10);if(ae===null)ae=ve;else{if(ae===0)return y("Invalid IP v6 address."),null;ae=10*ae+ve}if(ae>255)return y("Invalid IP v6 address."),null;Ie.pointer++}if(ae===null)return y("Invalid IP v6 address."),null;Z[ne]=256*Z[ne]+ae,++ie!==2&&ie!==4||ne++}if(ie!==4)return y("Invalid IP v6 address."),null;break}if(Ie.c()===":"){if(Ie.pointer++,Ie.c()==="")return y("Invalid IP v6 address."),null}else if(Ie.c()!=="")return y("Invalid IP v6 address."),null;Z[ne]=Le,ne++}else{if(xe!==null)return y("Invalid IP v6 address."),null;Ie.pointer++,xe=++ne}}if(xe!==null){var se=ne-xe;for(ne=7;ne!==0&&se>0;)X=a([Z[xe+se-1],Z[ne]],2),Z[ne]=X[0],Z[xe+se-1]=X[1],ne--,se--}else if(xe===null&&ne!==8)return y("Invalid IP v6 address."),null;return Z}function de(W){var X,Z;if(/[\x00\t\f\r #/:?@\[\\\]]/.test(W))return y("Invalid host string."),null;var ne="";try{for(var xe=o(W),Ie=xe.next();!Ie.done;Ie=xe.next())ne+=Ce(Ie.value,h)}catch(Le){X={error:Le}}finally{try{Ie&&!Ie.done&&(Z=xe.return)&&Z.call(xe)}finally{if(X)throw X.error}}return ne}function ue(W){return null}function me(W){return"%"+("00"+W.toString(16).toUpperCase()).slice(-2)}function Ee(W){for(var X=function(je){return je>=48&&je<=57||je>=65&&je<=70||je>=97&&je<=102},Z=new Uint8Array(W.length),ne=0,xe=0;xe<W.length;xe++){var Ie=W[xe];if(Ie!==37)Z[ne]=Ie,ne++;else if(Ie===37&&xe>=W.length-2)Z[ne]=Ie,ne++;else if(Ie!==37||X(W[xe+1])&&X(W[xe+2])){var Le=parseInt(c.utf8Decode(Uint8Array.of(W[xe+1],W[xe+2])),16);Z[ne]=Le,ne++,xe+=2}else Z[ne]=Ie,ne++}return Z.subarray(0,ne)}function _e(W){return Ee(c.utf8Encode(W))}function Ce(W,X){var Z,ne;if(!X.test(W))return W;var xe=c.utf8Encode(W),Ie="";try{for(var Le=o(xe),je=Le.next();!je.done;je=Le.next())Ie+=me(je.value)}catch(ie){Z={error:ie}}finally{try{je&&!je.done&&(ne=Le.return)&&ne.call(Le)}finally{if(Z)throw Z.error}}return Ie}function F(W){var X,Z,ne,xe,Ie=[],Le=[];try{for(var je=o(W),ie=je.next();!ie.done;ie=je.next()){var ae=ie.value;ae===38?(Ie.push(Uint8Array.from(Le)),Le=[]):Le.push(ae)}}catch(et){X={error:et}}finally{try{ie&&!ie.done&&(Z=je.return)&&Z.call(je)}finally{if(X)throw X.error}}Le.length!==0&&Ie.push(Uint8Array.from(Le));var ve=[];try{for(var se=o(Ie),ge=se.next();!ge.done;ge=se.next()){var Ve=ge.value;if(Ve.length!==0){for(var re=Ve.indexOf(61),it=re!==-1?Ve.slice(0,re):Ve,ut=re!==-1?Ve.slice(re+1):new Uint8Array,ot=0;ot<it.length;ot++)it[ot]===43&&(it[ot]=32);for(ot=0;ot<ut.length;ot++)ut[ot]===43&&(ut[ot]=32);var Se=c.utf8Decode(it),Ge=c.utf8Decode(ut);ve.push([Se,Ge])}}}catch(et){ne={error:et}}finally{try{ge&&!ge.done&&(xe=se.return)&&xe.call(se)}finally{if(ne)throw ne.error}}return ve}function O(W){var X,Z,ne="";try{for(var xe=o(W),Ie=xe.next();!Ie.done;Ie=xe.next()){var Le=Ie.value;ne+=Le===32?"+":Le===42||Le===45||Le===46||Le>=48&&Le<=57||Le>=65&&Le<=90||Le===95||Le>=97&&Le<=122?String.fromCodePoint(Le):me(Le)}}catch(je){X={error:je}}finally{try{Ie&&!Ie.done&&(Z=xe.return)&&Z.call(xe)}finally{if(X)throw X.error}}return ne}function $(W,X){var Z=u.domainToASCII(W);return Z===""?(y("Invalid domain name."),null):Z}n.setValidationErrorCallback=function(W){s=W},n.newURL=x,n.isSpecialScheme=C,n.isSpecial=S,n.defaultPort=T,n.includesCredentials=_,n.cannotHaveAUsernamePasswordPort=function(W){return W.host===null||W.host===""||W._cannotBeABaseURLFlag||W.scheme==="file"},n.urlSerializer=E,n.hostSerializer=D,n.iPv4Serializer=b,n.iPv6Serializer=I,n.urlParser=function(W,X,Z){var ne=R(W,X,Z);return ne===null?null:(ne.scheme!=="blob"||(ne._blobURLEntry=null),ne)},n.basicURLParser=R,n.setTheUsername=function(W,X){var Z,ne,xe="";try{for(var Ie=o(X),Le=Ie.next();!Le.done;Le=Ie.next())xe+=Ce(Le.value,v)}catch(je){Z={error:je}}finally{try{Le&&!Le.done&&(ne=Ie.return)&&ne.call(Ie)}finally{if(Z)throw Z.error}}W.username=xe},n.setThePassword=function(W,X){var Z,ne,xe="";try{for(var Ie=o(X),Le=Ie.next();!Le.done;Le=Ie.next())xe+=Ce(Le.value,v)}catch(je){Z={error:je}}finally{try{Le&&!Le.done&&(ne=Ie.return)&&ne.call(Ie)}finally{if(Z)throw Z.error}}W.password=xe},n.isSingleDotPathSegment=M,n.isDoubleDotPathSegment=P,n.shorten=k,n.isNormalizedWindowsDriveLetter=z,n.isWindowsDriveLetter=A,n.startsWithAWindowsDriveLetter=L,n.hostParser=N,n.iPv4NumberParser=H,n.iPv4Parser=ee,n.iPv6Parser=oe,n.opaqueHostParser=de,n.resolveABlobURL=ue,n.percentEncode=me,n.percentDecode=Ee,n.stringPercentDecode=_e,n.utf8PercentEncode=Ce,n.hostEquals=function(W,X){return W===X},n.urlEquals=function(W,X,Z){return Z===void 0&&(Z=!1),E(W,Z)===E(X,Z)},n.urlEncodedStringParser=function(W){return F(c.utf8Encode(W))},n.urlEncodedParser=F,n.urlEncodedByteSerializer=O,n.urlEncodedSerializer=function(W,X){var Z,ne;if((X===void 0||X==="replacement"||X==="UTF-16BE"||X==="UTF-16LE"?"UTF-8":X).toUpperCase()!=="UTF-8")throw new Error("Only UTF-8 encoding is supported.");var xe="";try{for(var Ie=o(W),Le=Ie.next();!Le.done;Le=Ie.next()){var je=Le.value,ie=O(c.utf8Encode(je[0])),ae=je[1];ae=O(c.utf8Encode(ae)),xe!==""&&(xe+="&"),xe+=ie+"="+ae}}catch(ve){Z={error:ve}}finally{try{Le&&!Le.done&&(ne=Ie.return)&&ne.call(Ie)}finally{if(Z)throw Z.error}}return xe},n.origin=function W(X){switch(X.scheme){case"blob":X._blobURLEntry;var Z=R(X.path[0]);return Z===null?l.OpaqueOrigin:W(Z);case"ftp":case"http":case"https":case"ws":case"wss":return[X.scheme,X.host===null?"":X.host,X.port,null];case"file":default:return l.OpaqueOrigin}},n.domainToASCII=$,n.domainToUnicode=function(W,X){var Z=u.domainToUnicode(W);return Z===""&&y("Invalid domain name."),Z},n.asciiSerializationOfAnOrigin=function(W){if(W[0]===""&&W[1]===""&&W[2]===null&&W[3]===null)return"null";var X=W[0]+"://"+D(W[1]);return W[2]!==null&&(X+=":"+W[2].toString()),X}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=function(){function s(){this._signal=o.create_abortSignal()}return Object.defineProperty(s.prototype,"signal",{get:function(){return this._signal},enumerable:!0,configurable:!0}),s.prototype.abort=function(){o.abort_signalAbort(this._signal)},s}();n.AbortControllerImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(70),c=i(0),l=function(f){function u(){var d=f.call(this)||this;return d._abortedFlag=!1,d._abortAlgorithms=new Set,d}return a(u,f),Object.defineProperty(u.prototype,"aborted",{get:function(){return this._abortedFlag},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"onabort",{get:function(){return c.event_getterEventHandlerIDLAttribute(this,"onabort")},set:function(d){c.event_setterEventHandlerIDLAttribute(this,"onabort",d)},enumerable:!0,configurable:!0}),u._create=function(){return new u},u}(s.EventTargetImpl);n.AbortSignalImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(12),f=function(u){function d(h,g,p){var v=u.call(this)||this;return v._name="",v._publicId="",v._systemId="",v._name=h,v._publicId=g,v._systemId=p,v}return a(d,u),Object.defineProperty(d.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"publicId",{get:function(){return this._publicId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"systemId",{get:function(){return this._systemId},enumerable:!0,configurable:!0}),d.prototype.before=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.after=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.replaceWith=function(){for(var h=[],g=0;g<arguments.length;g++)h[g]=arguments[g];throw new Error("Mixin: ChildNode not implemented.")},d.prototype.remove=function(){throw new Error("Mixin: ChildNode not implemented.")},d._create=function(h,g,p,v){p===void 0&&(p=""),v===void 0&&(v="");var w=new d(g,p,v);return w._nodeDocument=h,w},d}(c.NodeImpl);n.DocumentTypeImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.DocumentType)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(100),c=i(1),l=i(0),f=function(u){function d(h,g){var p=u.call(this)||this;return p._host=h,p._mode=g,p}return a(d,u),Object.defineProperty(d.prototype,"mode",{get:function(){return this._mode},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),d.prototype._getTheParent=function(h){return h._composedFlag||c.isEmpty(h._path)||l.tree_rootNode(h._path[0].invocationTarget)!==this?this._host:null},d._create=function(h,g){return new d(g,"closed")},d}(s.DocumentFragmentImpl);n.ShadowRootImpl=f},function(r,n,i){var o,a=this&&this.__extends||(o=function(d,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var v in p)p.hasOwnProperty(v)&&(g[v]=p[v])})(d,h)},function(d,h){function g(){this.constructor=d}o(d,h),d.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(34),l=i(0),f=i(12),u=function(d){function h(g){var p=d.call(this)||this;return p._namespace=null,p._namespacePrefix=null,p._element=null,p._value="",p._localName=g,p}return a(h,d),Object.defineProperty(h.prototype,"ownerElement",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"namespaceURI",{get:function(){return this._namespace},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"prefix",{get:function(){return this._namespacePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"localName",{get:function(){return this._localName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"name",{get:function(){return this._qualifiedName},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"value",{get:function(){return this._value},set:function(g){l.attr_setAnExistingAttributeValue(this,g)},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"_qualifiedName",{get:function(){return this._namespacePrefix!==null?this._namespacePrefix+":"+this._localName:this._localName},enumerable:!0,configurable:!0}),h._create=function(g,p){var v=new h(p);return v._nodeDocument=g,v},h}(c.NodeImpl);n.AttrImpl=u,f.idl_defineConst(u.prototype,"_nodeType",s.NodeType.Attribute),f.idl_defineConst(u.prototype,"specified",!0)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(101),c=i(2),l=i(12),f=function(u){function d(h){return u.call(this,h)||this}return a(d,u),d._create=function(h,g){g===void 0&&(g="");var p=new d(g);return p._nodeDocument=h,p},d}(s.TextImpl);n.CDATASectionImpl=f,l.idl_defineConst(f.prototype,"_nodeType",c.NodeType.CData)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),f=function(u){function d(h){return h===void 0&&(h=""),u.call(this,h)||this}return a(d,u),d._create=function(h,g){g===void 0&&(g="");var p=new d(g);return p._nodeDocument=h,p},d}(c.CharacterDataImpl);n.CommentImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.Comment)},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(71),l=i(12),f=function(u){function d(h,g){var p=u.call(this,g)||this;return p._target=h,p}return a(d,u),Object.defineProperty(d.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),d._create=function(h,g,p){var v=new d(g,p);return v._nodeDocument=h,v},d}(c.CharacterDataImpl);n.ProcessingInstructionImpl=f,l.idl_defineConst(f.prototype,"_nodeType",s.NodeType.ProcessingInstruction)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(7),a=i(0),s=i(3),c=i(1),l=function(){function f(u,d){return this._live=!0,this._root=u,this._filter=d,new Proxy(this,this)}return Object.defineProperty(f.prototype,"length",{get:function(){for(var u=this,d=0,h=a.tree_getFirstDescendantNode(this._root,!1,!1,function(g){return s.Guard.isElementNode(g)&&u._filter(g)});h!==null;)d++,h=a.tree_getNextDescendantNode(this._root,h,!1,!1,function(g){return s.Guard.isElementNode(g)&&u._filter(g)});return d},enumerable:!0,configurable:!0}),f.prototype.item=function(u){for(var d=this,h=0,g=a.tree_getFirstDescendantNode(this._root,!1,!1,function(p){return s.Guard.isElementNode(p)&&d._filter(p)});g!==null;){if(h===u)return g;h++,g=a.tree_getNextDescendantNode(this._root,g,!1,!1,function(p){return s.Guard.isElementNode(p)&&d._filter(p)})}return null},f.prototype.namedItem=function(u){var d=this;if(u==="")return null;for(var h=a.tree_getFirstDescendantNode(this._root,!1,!1,function(v){return s.Guard.isElementNode(v)&&d._filter(v)});h!=null;){if(h._uniqueIdentifier===u)return h;if(h._namespace===o.namespace.HTML)for(var g=0;g<h._attributeList.length;g++){var p=h._attributeList[g];if(p._localName==="name"&&p._namespace===null&&p._namespacePrefix===null&&p._value===u)return h}h=a.tree_getNextDescendantNode(this._root,h,!1,!1,function(v){return s.Guard.isElementNode(v)&&d._filter(v)})}return null},f.prototype[Symbol.iterator]=function(){var u=this._root,d=this._filter,h=a.tree_getFirstDescendantNode(u,!1,!1,function(g){return s.Guard.isElementNode(g)&&d(g)});return{next:function(){if(h===null)return{done:!0,value:null};var g={done:!1,value:h};return h=a.tree_getNextDescendantNode(u,h,!1,!1,function(p){return s.Guard.isElementNode(p)&&d(p)}),g}}},f.prototype.get=function(u,d,h){if(!c.isString(d)||f.reservedNames.indexOf(d)!==-1)return Reflect.get(u,d,h);var g=Number(d);return isNaN(g)?u.namedItem(d)||void 0:u.item(g)||void 0},f.prototype.set=function(u,d,h,g){if(!c.isString(d)||f.reservedNames.indexOf(d)!==-1)return Reflect.set(u,d,h,g);var p=Number(d),v=isNaN(p)?u.namedItem(d)||void 0:u.item(p)||void 0;return!(!v||!v._parent)&&(a.mutation_replace(v,h,v._parent),!0)},f._create=function(u,d){return d===void 0&&(d=function(){return!0}),new f(u,d)},f.reservedNames=["_root","_live","_filter","length","item","namedItem","get","set"],f}();n.HTMLCollectionImpl=l},function(r,n,i){var o=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=i(0),l=function(){function f(u){return this._live=!0,this._filter=null,this._length=0,this._root=u,new Proxy(this,this)}return Object.defineProperty(f.prototype,"length",{get:function(){return this._root._children.size},enumerable:!0,configurable:!0}),f.prototype.item=function(u){if(u<0||u>this.length-1)return null;if(u<this.length/2){for(var d=0,h=this._root._firstChild;h!==null&&d!==u;)h=h._nextSibling,d++;return h}for(d=this.length-1,h=this._root._lastChild;h!==null&&d!==u;)h=h._previousSibling,d--;return h},f.prototype.keys=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=0;return{next:(function(){return d===this.length?{done:!0,value:null}:{done:!1,value:d++}}).bind(this)}}).bind(this),u},f.prototype.values=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=this[Symbol.iterator]();return{next:function(){return d.next()}}}).bind(this),u},f.prototype.entries=function(){var u;return(u={})[Symbol.iterator]=(function(){var d=this[Symbol.iterator](),h=0;return{next:function(){var g=d.next();return g.done?{done:!0,value:null}:{done:!1,value:[h++,g.value]}}}}).bind(this),u},f.prototype[Symbol.iterator]=function(){return this._root._children[Symbol.iterator]()},f.prototype.forEach=function(u,d){var h,g;d===void 0&&(d=a.dom.window);var p=0;try{for(var v=o(this._root._children),w=v.next();!w.done;w=v.next()){var m=w.value;u.call(d,m,p++,this)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}},f.prototype.get=function(u,d,h){if(!s.isString(d))return Reflect.get(u,d,h);var g=Number(d);return isNaN(g)?Reflect.get(u,d,h):u.item(g)||void 0},f.prototype.set=function(u,d,h,g){if(!s.isString(d))return Reflect.set(u,d,h,g);var p=Number(d);if(isNaN(p))return Reflect.set(u,d,h,g);var v=u.item(p)||void 0;return!!v&&!!v._parent&&(c.mutation_replace(v,h,v._parent),!0)},f._create=function(u){return new f(u)},f}();n.NodeListImpl=l},function(r,n,i){var o=this&&this.__values||function(l){var f=typeof Symbol=="function"&&Symbol.iterator,u=f&&l[f],d=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&d>=l.length&&(l=void 0),{value:l&&l[d++],done:!l}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(1),c=function(){function l(f){return this._live=!1,this._items=[],this._length=0,this._root=f,this._items=[],this._filter=function(u){return!0},new Proxy(this,this)}return Object.defineProperty(l.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),l.prototype.item=function(f){return f<0||f>this.length-1?null:this._items[f]},l.prototype.keys=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=0;return{next:(function(){return u===this.length?{done:!0,value:null}:{done:!1,value:u++}}).bind(this)}}).bind(this),f},l.prototype.values=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator]();return{next:function(){return u.next()}}}).bind(this),f},l.prototype.entries=function(){var f;return(f={})[Symbol.iterator]=(function(){var u=this[Symbol.iterator](),d=0;return{next:function(){var h=u.next();return h.done?{done:!0,value:null}:{done:!1,value:[d++,h.value]}}}}).bind(this),f},l.prototype[Symbol.iterator]=function(){var f=this._items[Symbol.iterator]();return{next:function(){return f.next()}}},l.prototype.forEach=function(f,u){var d,h;u===void 0&&(u=a.dom.window);var g=0;try{for(var p=o(this._items),v=p.next();!v.done;v=p.next()){var w=v.value;f.call(u,w,g++,this)}}catch(m){d={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}},l.prototype.get=function(f,u,d){if(!s.isString(u))return Reflect.get(f,u,d);var h=Number(u);return isNaN(h)?Reflect.get(f,u,d):f._items[h]||void 0},l.prototype.set=function(f,u,d,h){if(!s.isString(u))return Reflect.set(f,u,d,h);var g=Number(u);return isNaN(g)?Reflect.set(f,u,d,h):g>=0&&g<f._items.length&&(f._items[g]=d,!0)},l._create=function(f,u){var d=new l(f);return d._items=u,d},l}();n.NodeListStaticImpl=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(9),c=i(0),l=function(f){function u(d){var h=f.call(this)||this;return h._element=d,Object.setPrototypeOf(h,u.prototype),h}return a(u,f),u.prototype._asArray=function(){return this},u.prototype.item=function(d){return this[d]||null},u.prototype.getNamedItem=function(d){return c.element_getAnAttributeByName(d,this._element)},u.prototype.getNamedItemNS=function(d,h){return c.element_getAnAttributeByNamespaceAndLocalName(d||"",h,this._element)},u.prototype.setNamedItem=function(d){return c.element_setAnAttribute(d,this._element)},u.prototype.setNamedItemNS=function(d){return c.element_setAnAttribute(d,this._element)},u.prototype.removeNamedItem=function(d){var h=c.element_removeAnAttributeByName(d,this._element);if(h===null)throw new s.NotFoundError;return h},u.prototype.removeNamedItemNS=function(d,h){var g=c.element_removeAnAttributeByNamespaceAndLocalName(d||"",h,this._element);if(g===null)throw new s.NotFoundError;return g},u._create=function(d){return new u(d)},u}(Array);n.NamedNodeMapImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(v,w){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,y){m.__proto__=y}||function(m,y){for(var x in y)y.hasOwnProperty(x)&&(m[x]=y[x])})(v,w)},function(v,w){function m(){this.constructor=v}o(v,w),v.prototype=w===null?Object.create(w):(m.prototype=w.prototype,new m)}),s=this&&this.__values||function(v){var w=typeof Symbol=="function"&&Symbol.iterator,m=w&&v[w],y=0;if(m)return m.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&y>=v.length&&(v=void 0),{value:v&&v[y++],done:!v}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(6),l=i(2),f=i(102),u=i(9),d=i(0),h=i(12),g=i(3),p=function(v){function w(){var m=v.call(this)||this,y=c.dom.window._associatedDocument;return m._start=[y,0],m._end=[y,0],c.dom.rangeList.add(m),m}return a(w,v),Object.defineProperty(w.prototype,"commonAncestorContainer",{get:function(){for(var m=this._start[0];!d.tree_isAncestorOf(this._end[0],m,!0);){if(m._parent===null)throw new Error("Parent node  is null.");m=m._parent}return m},enumerable:!0,configurable:!0}),w.prototype.setStart=function(m,y){d.range_setTheStart(this,m,y)},w.prototype.setEnd=function(m,y){d.range_setTheEnd(this,m,y)},w.prototype.setStartBefore=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheStart(this,y,d.tree_index(m))},w.prototype.setStartAfter=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheStart(this,y,d.tree_index(m)+1)},w.prototype.setEndBefore=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheEnd(this,y,d.tree_index(m))},w.prototype.setEndAfter=function(m){var y=m._parent;if(y===null)throw new u.InvalidNodeTypeError;d.range_setTheEnd(this,y,d.tree_index(m)+1)},w.prototype.collapse=function(m){m?this._end=this._start:this._start=this._end},w.prototype.selectNode=function(m){d.range_select(m,this)},w.prototype.selectNodeContents=function(m){if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;var y=d.tree_nodeLength(m);this._start=[m,0],this._end=[m,y]},w.prototype.compareBoundaryPoints=function(m,y){if(m!==l.HowToCompare.StartToStart&&m!==l.HowToCompare.StartToEnd&&m!==l.HowToCompare.EndToEnd&&m!==l.HowToCompare.EndToStart)throw new u.NotSupportedError;if(d.range_root(this)!==d.range_root(y))throw new u.WrongDocumentError;var x,C;switch(m){case l.HowToCompare.StartToStart:x=this._start,C=y._start;break;case l.HowToCompare.StartToEnd:x=this._end,C=y._start;break;case l.HowToCompare.EndToEnd:x=this._end,C=y._end;break;case l.HowToCompare.EndToStart:x=this._start,C=y._end;break;default:throw new u.NotSupportedError}var S=d.boundaryPoint_position(x,C);return S===l.BoundaryPosition.Before?-1:S===l.BoundaryPosition.After?1:0},w.prototype.deleteContents=function(){var m,y,x,C;if(!d.range_collapsed(this)){var S=this._startNode,T=this._startOffset,_=this._endNode,E=this._endOffset;if(S===_&&g.Guard.isCharacterDataNode(S))d.characterData_replaceData(S,T,E-T,"");else{var D,b,I=[];try{for(var R=s(d.range_getContainedNodes(this)),M=R.next();!M.done;M=R.next()){var P=(L=M.value)._parent;P!==null&&d.range_isContained(P,this)||I.push(L)}}catch(N){m={error:N}}finally{try{M&&!M.done&&(y=R.return)&&y.call(R)}finally{if(m)throw m.error}}if(d.tree_isAncestorOf(_,S,!0))D=S,b=T;else{for(var k=S;k._parent!==null&&!d.tree_isAncestorOf(_,k._parent,!0);)k=k._parent;if(k._parent===null)throw new Error("Parent node is null.");D=k._parent,b=d.tree_index(k)+1}g.Guard.isCharacterDataNode(S)&&d.characterData_replaceData(S,T,d.tree_nodeLength(S)-T,"");try{for(var z=s(I),A=z.next();!A.done;A=z.next()){var L;(L=A.value)._parent&&d.mutation_remove(L,L._parent)}}catch(N){x={error:N}}finally{try{A&&!A.done&&(C=z.return)&&C.call(z)}finally{if(x)throw x.error}}g.Guard.isCharacterDataNode(_)&&d.characterData_replaceData(_,0,E,""),this._start=[D,b],this._end=[D,b]}}},w.prototype.extractContents=function(){return d.range_extract(this)},w.prototype.cloneContents=function(){return d.range_cloneTheContents(this)},w.prototype.insertNode=function(m){return d.range_insert(m,this)},w.prototype.surroundContents=function(m){var y,x;try{for(var C=s(d.range_getPartiallyContainedNodes(this)),S=C.next();!S.done;S=C.next()){var T=S.value;if(!g.Guard.isTextNode(T))throw new u.InvalidStateError}}catch(E){y={error:E}}finally{try{S&&!S.done&&(x=C.return)&&x.call(C)}finally{if(y)throw y.error}}if(g.Guard.isDocumentNode(m)||g.Guard.isDocumentTypeNode(m)||g.Guard.isDocumentFragmentNode(m))throw new u.InvalidNodeTypeError;var _=d.range_extract(this);m._children.size!==0&&d.mutation_replaceAll(null,m),d.range_insert(m,this),d.mutation_append(_,m),d.range_select(m,this)},w.prototype.cloneRange=function(){return d.create_range(this._start,this._end)},w.prototype.detach=function(){c.dom.rangeList.delete(this)},w.prototype.isPointInRange=function(m,y){if(d.tree_rootNode(m)!==d.range_root(this))return!1;if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;if(y>d.tree_nodeLength(m))throw new u.IndexSizeError;var x=[m,y];return d.boundaryPoint_position(x,this._start)!==l.BoundaryPosition.Before&&d.boundaryPoint_position(x,this._end)!==l.BoundaryPosition.After},w.prototype.comparePoint=function(m,y){if(d.tree_rootNode(m)!==d.range_root(this))throw new u.WrongDocumentError;if(g.Guard.isDocumentTypeNode(m))throw new u.InvalidNodeTypeError;if(y>d.tree_nodeLength(m))throw new u.IndexSizeError;var x=[m,y];return d.boundaryPoint_position(x,this._start)===l.BoundaryPosition.Before?-1:d.boundaryPoint_position(x,this._end)===l.BoundaryPosition.After?1:0},w.prototype.intersectsNode=function(m){if(d.tree_rootNode(m)!==d.range_root(this))return!1;var y=m._parent;if(y===null)return!0;var x=d.tree_index(m);return d.boundaryPoint_position([y,x],this._end)===l.BoundaryPosition.Before&&d.boundaryPoint_position([y,x+1],this._start)===l.BoundaryPosition.After},w.prototype.toString=function(){var m,y,x="";if(this._startNode===this._endNode&&g.Guard.isTextNode(this._startNode))return this._startNode._data.substring(this._startOffset,this._endOffset);g.Guard.isTextNode(this._startNode)&&(x+=this._startNode._data.substring(this._startOffset));try{for(var C=s(d.range_getContainedNodes(this)),S=C.next();!S.done;S=C.next()){var T=S.value;g.Guard.isTextNode(T)&&(x+=T._data)}}catch(_){m={error:_}}finally{try{S&&!S.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return g.Guard.isTextNode(this._endNode)&&(x+=this._endNode._data.substring(0,this._endOffset)),x},w._create=function(m,y){var x=new w;return m&&(x._start=m),y&&(x._end=y),x},w.START_TO_START=0,w.START_TO_END=1,w.END_TO_END=2,w.END_TO_START=3,w}(f.AbstractRangeImpl);n.RangeImpl=p,h.idl_defineConst(p.prototype,"START_TO_START",0),h.idl_defineConst(p.prototype,"START_TO_END",1),h.idl_defineConst(p.prototype,"END_TO_END",2),h.idl_defineConst(p.prototype,"END_TO_START",3)},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(103),c=i(0),l=function(f){function u(d,h,g){var p=f.call(this,d)||this;return p._iteratorCollection=void 0,p._reference=h,p._pointerBeforeReference=g,c.nodeIterator_iteratorList().add(p),p}return a(u,f),Object.defineProperty(u.prototype,"referenceNode",{get:function(){return this._reference},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"pointerBeforeReferenceNode",{get:function(){return this._pointerBeforeReference},enumerable:!0,configurable:!0}),u.prototype.nextNode=function(){return c.nodeIterator_traverse(this,!0)},u.prototype.previousNode=function(){return c.nodeIterator_traverse(this,!1)},u.prototype.detach=function(){c.nodeIterator_iteratorList().delete(this)},u._create=function(d,h,g){return new u(d,h,g)},u}(s.TraverserImpl);n.NodeIteratorImpl=l},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(2),c=i(103),l=i(0),f=function(u){function d(h,g){var p=u.call(this,h)||this;return p._current=g,p}return a(d,u),Object.defineProperty(d.prototype,"currentNode",{get:function(){return this._current},set:function(h){this._current=h},enumerable:!0,configurable:!0}),d.prototype.parentNode=function(){for(var h=this._current;h!==null&&h!==this._root;)if((h=h._parent)!==null&&l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h;return null},d.prototype.firstChild=function(){return l.treeWalker_traverseChildren(this,!0)},d.prototype.lastChild=function(){return l.treeWalker_traverseChildren(this,!1)},d.prototype.nextSibling=function(){return l.treeWalker_traverseSiblings(this,!0)},d.prototype.previousNode=function(){for(var h=this._current;h!==this._root;){for(var g=h._previousSibling;g;){h=g;for(var p=l.traversal_filter(this,h);p!==s.FilterResult.Reject&&h._lastChild;)h=h._lastChild,p=l.traversal_filter(this,h);if(p===s.FilterResult.Accept)return this._current=h,h;g=h._previousSibling}if(h===this._root||h._parent===null)return null;if(h=h._parent,l.traversal_filter(this,h)===s.FilterResult.Accept)return this._current=h,h}return null},d.prototype.previousSibling=function(){return l.treeWalker_traverseSiblings(this,!1)},d.prototype.nextNode=function(){for(var h=this._current,g=s.FilterResult.Accept;;){for(;g!==s.FilterResult.Reject&&h._firstChild;)if(h=h._firstChild,(g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h;for(var p=null,v=h;v!==null;){if(v===this._root)return null;if((p=v._nextSibling)!==null){h=p;break}v=v._parent}if((g=l.traversal_filter(this,h))===s.FilterResult.Accept)return this._current=h,h}},d._create=function(h,g){return new d(h,g)},d}(c.TraverserImpl);n.TreeWalkerImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(12),s=function(){function c(){}return c.prototype.acceptNode=function(l){return o.FilterResult.Accept},c._create=function(){return new c},c.FILTER_ACCEPT=1,c.FILTER_REJECT=2,c.FILTER_SKIP=3,c.SHOW_ALL=4294967295,c.SHOW_ELEMENT=1,c.SHOW_ATTRIBUTE=2,c.SHOW_TEXT=4,c.SHOW_CDATA_SECTION=8,c.SHOW_ENTITY_REFERENCE=16,c.SHOW_ENTITY=32,c.SHOW_PROCESSING_INSTRUCTION=64,c.SHOW_COMMENT=128,c.SHOW_DOCUMENT=256,c.SHOW_DOCUMENT_TYPE=512,c.SHOW_DOCUMENT_FRAGMENT=1024,c.SHOW_NOTATION=2048,c}();n.NodeFilterImpl=s,a.idl_defineConst(s.prototype,"FILTER_ACCEPT",1),a.idl_defineConst(s.prototype,"FILTER_REJECT",2),a.idl_defineConst(s.prototype,"FILTER_SKIP",3),a.idl_defineConst(s.prototype,"SHOW_ALL",4294967295),a.idl_defineConst(s.prototype,"SHOW_ELEMENT",1),a.idl_defineConst(s.prototype,"SHOW_ATTRIBUTE",2),a.idl_defineConst(s.prototype,"SHOW_TEXT",4),a.idl_defineConst(s.prototype,"SHOW_CDATA_SECTION",8),a.idl_defineConst(s.prototype,"SHOW_ENTITY_REFERENCE",16),a.idl_defineConst(s.prototype,"SHOW_ENTITY",32),a.idl_defineConst(s.prototype,"SHOW_PROCESSING_INSTRUCTION",64),a.idl_defineConst(s.prototype,"SHOW_COMMENT",128),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT",256),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_TYPE",512),a.idl_defineConst(s.prototype,"SHOW_DOCUMENT_FRAGMENT",1024),a.idl_defineConst(s.prototype,"SHOW_NOTATION",2048)},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(s,c,l,f,u,d,h,g,p){this._type=s,this._target=c,this._addedNodes=l,this._removedNodes=f,this._previousSibling=u,this._nextSibling=d,this._attributeName=h,this._attributeNamespace=g,this._oldValue=p}return Object.defineProperty(a.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"target",{get:function(){return this._target},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"addedNodes",{get:function(){return this._addedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"removedNodes",{get:function(){return this._removedNodes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"previousSibling",{get:function(){return this._previousSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nextSibling",{get:function(){return this._nextSibling},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeName",{get:function(){return this._attributeName},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"attributeNamespace",{get:function(){return this._attributeNamespace},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),a._create=function(s,c,l,f,u,d,h,g,p){return new a(s,c,l,f,u,d,h,g,p)},a}();n.MutationRecordImpl=o},function(r,n,i){var o=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(9),c=i(7),l=i(0),f=function(){function u(d,h){this._element=d,this._attribute=h,this._tokenSet=new Set;var g=h._localName,p=l.element_getAnAttributeValue(d,g),v=this;this._element._attributeChangeSteps.push(function(w,m,y,x,C){m===v._attribute._localName&&C===null&&(x?v._tokenSet=l.orderedSet_parse(x):v._tokenSet.clear())}),a.dom.features.steps&&l.dom_runAttributeChangeSteps(d,g,p,p,null)}return Object.defineProperty(u.prototype,"length",{get:function(){return this._tokenSet.size},enumerable:!0,configurable:!0}),u.prototype.item=function(d){var h,g,p=0;try{for(var v=o(this._tokenSet),w=v.next();!w.done;w=v.next()){var m=w.value;if(p===d)return m;p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return null},u.prototype.contains=function(d){return this._tokenSet.has(d)},u.prototype.add=function(){for(var d,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var v=o(g),w=v.next();!w.done;w=v.next()){var m=w.value;if(m==="")throw new s.SyntaxError("Cannot add an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(m))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.add(m)}}catch(y){d={error:y}}finally{try{w&&!w.done&&(h=v.return)&&h.call(v)}finally{if(d)throw d.error}}l.tokenList_updateSteps(this)},u.prototype.remove=function(){for(var d,h,g=[],p=0;p<arguments.length;p++)g[p]=arguments[p];try{for(var v=o(g),w=v.next();!w.done;w=v.next()){var m=w.value;if(m==="")throw new s.SyntaxError("Cannot remove an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(m))throw new s.InvalidCharacterError("Token cannot contain whitespace.");this._tokenSet.delete(m)}}catch(y){d={error:y}}finally{try{w&&!w.done&&(h=v.return)&&h.call(v)}finally{if(d)throw d.error}}l.tokenList_updateSteps(this)},u.prototype.toggle=function(d,h){if(h===void 0&&(h=void 0),d==="")throw new s.SyntaxError("Cannot toggle an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(d))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return this._tokenSet.has(d)?h!==void 0&&h!==!1||(this._tokenSet.delete(d),l.tokenList_updateSteps(this),!1):(h===void 0||h===!0)&&(this._tokenSet.add(d),l.tokenList_updateSteps(this),!0)},u.prototype.replace=function(d,h){if(d===""||h==="")throw new s.SyntaxError("Cannot replace an empty token.");if(c.codePoint.ASCIIWhiteSpace.test(d)||c.codePoint.ASCIIWhiteSpace.test(h))throw new s.InvalidCharacterError("Token cannot contain whitespace.");return!!this._tokenSet.has(d)&&(c.set.replace(this._tokenSet,d,h),l.tokenList_updateSteps(this),!0)},u.prototype.supports=function(d){return l.tokenList_validationSteps(this,d)},Object.defineProperty(u.prototype,"value",{get:function(){return l.tokenList_serializeSteps(this)},set:function(d){l.element_setAnAttributeValue(this._element,this._attribute._localName,d)},enumerable:!0,configurable:!0}),u.prototype[Symbol.iterator]=function(){var d=this._tokenSet[Symbol.iterator]();return{next:function(){return d.next()}}},u._create=function(d,h){return new u(d,h)},u}();n.DOMTokenListImpl=f},function(r,n,i){var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(104),c=i(0),l=function(f){function u(d,h){var g=f.call(this,d,h)||this;return g._detail=null,g._detail=h&&h.detail||null,g}return a(u,f),Object.defineProperty(u.prototype,"detail",{get:function(){return this._detail},enumerable:!0,configurable:!0}),u.prototype.initCustomEvent=function(d,h,g,p){h===void 0&&(h=!1),g===void 0&&(g=!1),p===void 0&&(p=null),this._dispatchFlag||(c.event_initialize(this,d,h,g),this._detail=p)},u}(s.EventImpl);n.CustomEventImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(6),a=i(2),s=i(105),c=i(17);n.nodeIterator_traverse=function(l,f){for(var u=l._reference,d=l._pointerBeforeReference;;){if(f)if(d)d=!1;else{var h=c.tree_getFollowingNode(l._root,u);if(!h)return null;u=h}else if(d){var g=c.tree_getPrecedingNode(l.root,u);if(!g)return null;u=g}else d=!0;if(s.traversal_filter(l,u)===a.FilterResult.Accept)break}return l._reference=u,l._pointerBeforeReference=d,u},n.nodeIterator_iteratorList=function(){return o.dom.window._iteratorList}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9),a=i(7),s=i(174);function c(l){if(!s.xml_isName(l))throw new o.InvalidCharacterError("Invalid XML name: "+l);if(!s.xml_isQName(l))throw new o.InvalidCharacterError("Invalid XML qualified name: "+l+".")}n.namespace_validate=c,n.namespace_validateAndExtract=function(l,f){l||(l=null),c(f);var u=f.split(":"),d=u.length===2?u[0]:null,h=u.length===2?u[1]:f;if(d&&l===null)throw new o.NamespaceError("Qualified name includes a prefix but the namespace is null.");if(d==="xml"&&l!==a.namespace.XML)throw new o.NamespaceError('Qualified name includes the "xml" prefix but the namespace is not the XML namespace.');if(l!==a.namespace.XMLNS&&(d==="xmlns"||f==="xmlns"))throw new o.NamespaceError('Qualified name includes the "xmlns" prefix but the namespace is not the XMLNS namespace.');if(l===a.namespace.XMLNS&&d!=="xmlns"&&f!=="xmlns")throw new o.NamespaceError('Qualified name does not include the "xmlns" prefix but the namespace is the XMLNS namespace.');return[l,d,h]},n.namespace_extractQName=function(l){c(l);var f=l.split(":");return[f.length===2?f[0]:null,f.length===2?f[1]:l]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.xml_isName=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s===58||s===95||s>=192&&s<=214||s>=216&&s<=246||s>=248&&s<=767||s>=880&&s<=893||s>=895&&s<=8191||s>=8204&&s<=8205||s>=8304&&s<=8591||s>=11264&&s<=12271||s>=12289&&s<=55295||s>=63744&&s<=64975||s>=65008&&s<=65533)&&(a===0||!(s===45||s===46||s>=48&&s<=57||s===183||s>=768&&s<=879||s>=8255&&s<=8256))){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=983039))continue}return!1}}return!0},n.xml_isQName=function(o){for(var a=!1,s=0;s<o.length;s++){var c=o.charCodeAt(s);if(!(c>=97&&c<=122||c>=65&&c<=90||c===95||c>=192&&c<=214||c>=216&&c<=246||c>=248&&c<=767||c>=880&&c<=893||c>=895&&c<=8191||c>=8204&&c<=8205||c>=8304&&c<=8591||c>=11264&&c<=12271||c>=12289&&c<=55295||c>=63744&&c<=64975||c>=65008&&c<=65533)&&(s===0||!(c===45||c===46||c>=48&&c<=57||c===183||c>=768&&c<=879||c>=8255&&c<=8256))){if(s===0||c!==58){if(c>=55296&&c<=56319&&s<o.length-1){var l=o.charCodeAt(s+1);if(l>=56320&&l<=57343&&(s++,(c=1024*(c-55296)+l-56320+65536)>=65536&&c<=983039))continue}return!1}if(a||s===o.length-1)return!1;a=!0}}return!0},n.xml_isLegalChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s===9||s===10||s===13||s>=32&&s<=55295||s>=57344&&s<=65533)){if(s>=55296&&s<=56319&&a<o.length-1){var c=o.charCodeAt(a+1);if(c>=56320&&c<=57343&&(a++,(s=1024*(s-55296)+c-56320+65536)>=65536&&s<=1114111))continue}return!1}}return!0},n.xml_isPubidChar=function(o){for(var a=0;a<o.length;a++){var s=o.charCodeAt(a);if(!(s>=97&&s<=122||s>=65&&s<=90||s>=39&&s<=59||s===32||s===13||s===10||s>=35&&s<=37||s===33||s===61||s===63||s===64||s===95))return!1}return!0}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(17);n.boundaryPoint_position=function s(c,l){var f=c[0],u=c[1],d=l[0],h=l[1];if(console.assert(a.tree_rootNode(f)===a.tree_rootNode(d),"Boundary points must share the same root node."),f===d)return u===h?o.BoundaryPosition.Equal:u<h?o.BoundaryPosition.Before:o.BoundaryPosition.After;if(a.tree_isFollowing(d,f)){var g=s([d,h],[f,u]);if(g===o.BoundaryPosition.Before)return o.BoundaryPosition.After;if(g===o.BoundaryPosition.After)return o.BoundaryPosition.Before}if(a.tree_isAncestorOf(d,f)){for(var p=d;!a.tree_isChildOf(f,p);)p._parent!==null&&(p=p._parent);if(a.tree_index(p)<u)return o.BoundaryPosition.After}return o.BoundaryPosition.Before}},function(r,n,i){var o=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=i(29),f=i(108),u=i(30),d=i(37),h=i(52);n.node_stringReplaceAll=function(g,p){var v=null;g!==""&&(v=l.create_text(p._nodeDocument,g)),d.mutation_replaceAll(v,p)},n.node_clone=function g(p,v,w){var m,y,x,C,S;if(v===void 0&&(v=null),w===void 0&&(w=!1),v===null&&(v=p._nodeDocument),s.Guard.isElementNode(p)){S=h.element_createAnElement(v,p._localName,p._namespace,p._namespacePrefix,p._is,!1);try{for(var T=o(p._attributeList),_=T.next();!_.done;_=T.next()){var E=g(_.value,v);h.element_append(E,S)}}catch(P){m={error:P}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}}else if(s.Guard.isDocumentNode(p)){var D=l.create_document();D._encoding=p._encoding,D._contentType=p._contentType,D._URL=p._URL,D._origin=p._origin,D._type=p._type,D._mode=p._mode,S=D}else if(s.Guard.isDocumentTypeNode(p))S=l.create_documentType(v,p._name,p._publicId,p._systemId);else if(s.Guard.isAttrNode(p)){var b=l.create_attr(v,p.localName);b._namespace=p._namespace,b._namespacePrefix=p._namespacePrefix,b._value=p._value,S=b}else S=s.Guard.isExclusiveTextNode(p)?l.create_text(v,p._data):s.Guard.isCDATASectionNode(p)?l.create_cdataSection(v,p._data):s.Guard.isCommentNode(p)?l.create_comment(v,p._data):s.Guard.isProcessingInstructionNode(p)?l.create_processingInstruction(v,p._target,p._data):s.Guard.isDocumentFragmentNode(p)?l.create_documentFragment(v):Object.create(p);if(s.Guard.isDocumentNode(S)?(S._nodeDocument=S,v=S):S._nodeDocument=v,a.dom.features.steps&&u.dom_runCloningSteps(S,p,v,w),w)try{for(var I=o(p._children),R=I.next();!R.done;R=I.next()){var M=g(R.value,v,!0);d.mutation_append(M,S)}}catch(P){x={error:P}}finally{try{R&&!R.done&&(C=I.return)&&C.call(I)}finally{if(x)throw x.error}}return S},n.node_equals=function g(p,v){var w,m,y,x;if(p._nodeType!==v._nodeType)return!1;if(s.Guard.isDocumentTypeNode(p)&&s.Guard.isDocumentTypeNode(v)){if(p._name!==v._name||p._publicId!==v._publicId||p._systemId!==v._systemId)return!1}else if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(v)){if(p._namespace!==v._namespace||p._namespacePrefix!==v._namespacePrefix||p._localName!==v._localName||p._attributeList.length!==v._attributeList.length)return!1}else if(s.Guard.isAttrNode(p)&&s.Guard.isAttrNode(v)){if(p._namespace!==v._namespace||p._localName!==v._localName||p._value!==v._value)return!1}else if(s.Guard.isProcessingInstructionNode(p)&&s.Guard.isProcessingInstructionNode(v)){if(p._target!==v._target||p._data!==v._data)return!1}else if(s.Guard.isCharacterDataNode(p)&&s.Guard.isCharacterDataNode(v)&&p._data!==v._data)return!1;if(s.Guard.isElementNode(p)&&s.Guard.isElementNode(v)){var C={};try{for(var S=o(p._attributeList),T=S.next();!T.done;T=S.next())C[(D=T.value)._localName]=D}catch(k){w={error:k}}finally{try{T&&!T.done&&(m=S.return)&&m.call(S)}finally{if(w)throw w.error}}try{for(var _=o(v._attributeList),E=_.next();!E.done;E=_.next()){var D,b=E.value;if(!(D=C[b._localName])||!g(D,b))return!1}}catch(k){y={error:k}}finally{try{E&&!E.done&&(x=_.return)&&x.call(_)}finally{if(y)throw y.error}}}if(p._children.size!==v._children.size)return!1;for(var I=p._children[Symbol.iterator](),R=v._children[Symbol.iterator](),M=I.next(),P=R.next();!M.done&&!P.done;){if(!g(M.value,P.value))return!1;M=I.next(),P=R.next()}return!0},n.node_listOfElementsWithQualifiedName=function(g,p){return g==="*"?l.create_htmlCollection(p):p._nodeDocument._type==="html"?l.create_htmlCollection(p,function(v){return v._namespace===c.namespace.HTML&&v._qualifiedName===g.toLowerCase()||v._namespace!==c.namespace.HTML&&v._qualifiedName===g}):l.create_htmlCollection(p,function(v){return v._qualifiedName===g})},n.node_listOfElementsWithNamespace=function(g,p,v){return g===""&&(g=null),g==="*"&&p==="*"?l.create_htmlCollection(v):g==="*"?l.create_htmlCollection(v,function(w){return w._localName===p}):p==="*"?l.create_htmlCollection(v,function(w){return w._namespace===g}):l.create_htmlCollection(v,function(w){return w._localName===p&&w._namespace===g})},n.node_listOfElementsWithClassNames=function(g,p){var v=f.orderedSet_parse(g);if(v.size===0)return l.create_htmlCollection(p,function(){return!1});var w=p._nodeDocument._mode!=="quirks";return l.create_htmlCollection(p,function(m){var y=m.classList;return f.orderedSet_contains(y._tokenSet,v,w)})},n.node_locateANamespacePrefix=function g(p,v){if(p._namespace===v&&p._namespacePrefix!==null)return p._namespacePrefix;for(var w=0;w<p._attributeList.length;w++){var m=p._attributeList[w];if(m._namespacePrefix==="xmlns"&&m._value===v)return m._localName}return p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,v):null},n.node_locateANamespace=function g(p,v){if(s.Guard.isElementNode(p)){if(p._namespace!==null&&p._namespacePrefix===v)return p._namespace;for(var w=0;w<p._attributeList.length;w++){var m=p._attributeList[w];if(m._namespace===c.namespace.XMLNS&&m._namespacePrefix==="xmlns"&&m._localName===v||v===null&&m._namespace===c.namespace.XMLNS&&m._namespacePrefix===null&&m._localName==="xmlns")return m._value||null}return p.parentElement===null?null:g(p.parentElement,v)}return s.Guard.isDocumentNode(p)?p.documentElement===null?null:g(p.documentElement,v):s.Guard.isDocumentTypeNode(p)||s.Guard.isDocumentFragmentNode(p)?null:s.Guard.isAttrNode(p)?p._element===null?null:g(p._element,v):p._parent&&s.Guard.isElementNode(p._parent)?g(p._parent,v):null}},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(9),l=i(29),f=i(17),u=i(107),d=i(37);n.text_contiguousTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var v=h;v&&s.Guard.isTextNode(v._previousSibling);)v=v._previousSibling;return{next:function(){if(v&&!g&&v===h&&(v=s.Guard.isTextNode(v._nextSibling)?v._nextSibling:null),v===null)return{done:!0,value:null};var w={done:!1,value:v};return v=s.Guard.isTextNode(v._nextSibling)?v._nextSibling:null,w}}},p},n.text_contiguousExclusiveTextNodes=function(h,g){var p;return g===void 0&&(g=!1),(p={})[Symbol.iterator]=function(){for(var v=h;v&&s.Guard.isExclusiveTextNode(v._previousSibling);)v=v._previousSibling;return{next:function(){if(v&&!g&&v===h&&(v=s.Guard.isExclusiveTextNode(v._nextSibling)?v._nextSibling:null),v===null)return{done:!0,value:null};var w={done:!1,value:v};return v=s.Guard.isExclusiveTextNode(v._nextSibling)?v._nextSibling:null,w}}},p},n.text_descendantTextContent=function(h){for(var g="",p=f.tree_getFirstDescendantNode(h,!1,!1,function(v){return s.Guard.isTextNode(v)});p!==null;)g+=p._data,p=f.tree_getNextDescendantNode(h,p,!1,!1,function(v){return s.Guard.isTextNode(v)});return g},n.text_split=function(h,g){var p,v,w=h._data.length;if(g>w)throw new c.IndexSizeError;var m=w-g,y=u.characterData_substringData(h,g,m),x=l.create_text(h._nodeDocument,y),C=h._parent;if(C!==null){d.mutation_insert(x,C,h._nextSibling);try{for(var S=o(a.dom.rangeList),T=S.next();!T.done;T=S.next()){var _=T.value;_._start[0]===h&&_._start[1]>g&&(_._start[0]=x,_._start[1]-=g),_._end[0]===h&&_._end[1]>g&&(_._end[0]=x,_._end[1]-=g);var E=f.tree_index(h);_._start[0]===C&&_._start[1]===E+1&&_._start[1]++,_._end[0]===C&&_._end[1]===E+1&&_._end[1]++}}catch(D){p={error:D}}finally{try{T&&!T.done&&(v=S.return)&&v.call(S)}finally{if(p)throw p.error}}}return u.characterData_replaceData(h,g,m,""),x}},function(r,n,i){var o=i(4),a=i(41),s=i(24),c=i(48),l=[].join,f=a!=Object,u=c("join",",");o({target:"Array",proto:!0,forced:f||!u},{join:function(d){return l.call(s(this),d===void 0?",":d)}})},function(r,n,i){var o=i(4),a=i(83),s=String.fromCharCode,c=String.fromCodePoint;o({target:"String",stat:!0,forced:!!c&&c.length!=1},{fromCodePoint:function(l){for(var f,u=[],d=arguments.length,h=0;d>h;){if(f=+arguments[h++],a(f,1114111)!==f)throw RangeError(f+" is not a valid code point");u.push(f<65536?s(f):s(55296+((f-=65536)>>10),f%1024+56320))}return u.join("")}})},function(r,n,i){var o=this&&this.__read||function(c,l){var f=typeof Symbol=="function"&&c[Symbol.iterator];if(!f)return c;var u,d,h=f.call(c),g=[];try{for(;(l===void 0||l-- >0)&&!(u=h.next()).done;)g.push(u.value)}catch(p){d={error:p}}finally{try{u&&!u.done&&(f=h.return)&&f.call(h)}finally{if(d)throw d.error}}return g};Object.defineProperty(n,"__esModule",{value:!0});var a=i(111),s=function(){function c(l,f){this._options={skipWhitespaceOnlyText:!1},this.err={line:-1,col:-1,index:-1,str:""},this._str=l,this._index=0,this._length=l.length,f&&(this._options.skipWhitespaceOnlyText=f.skipWhitespaceOnlyText||!1)}return c.prototype.nextToken=function(){if(this.eof())return{type:a.TokenType.EOF};var l=this.skipIfStartsWith("<")?this.openBracket():this.text();return this._options.skipWhitespaceOnlyText&&l.type===a.TokenType.Text&&c.isWhiteSpaceToken(l)&&(l=this.nextToken()),l},c.prototype.openBracket=function(){return this.skipIfStartsWith("?")?this.skipIfStartsWith("xml")?c.isSpace(this._str[this._index])?this.declaration():(this.seek(-3),this.pi()):this.pi():this.skipIfStartsWith("!")?this.skipIfStartsWith("--")?this.comment():this.skipIfStartsWith("[CDATA[")?this.cdata():this.skipIfStartsWith("DOCTYPE")?this.doctype():void this.throwError("Invalid '!' in opening tag."):this.skipIfStartsWith("/")?this.closeTag():this.openTag()},c.prototype.declaration=function(){for(var l="",f="",u="";!this.eof();){if(this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.Declaration,version:l,encoding:f,standalone:u};var d=o(this.attribute(),2),h=d[0],g=d[1];h==="version"?l=g:h==="encoding"?f=g:h==="standalone"?u=g:this.throwError("Invalid attribute name: "+h)}this.throwError("Missing declaration end symbol `?>`")},c.prototype.doctype=function(){var l="",f="";this.skipSpace();var u=this.takeUntil2("[",">",!0);return this.skipSpace(),this.skipIfStartsWith("PUBLIC")?(l=this.quotedString(),f=this.quotedString()):this.skipIfStartsWith("SYSTEM")&&(f=this.quotedString()),this.skipSpace(),this.skipIfStartsWith("[")&&(this.skipUntil("]"),this.skipIfStartsWith("]")||this.throwError("Missing end bracket of DTD internal subset")),this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing doctype end symbol `>`"),{type:a.TokenType.DocType,name:u,pubId:l,sysId:f}},c.prototype.pi=function(){var l=this.takeUntilStartsWith("?>",!0);if(this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.skipSpace(),this.skipIfStartsWith("?>"))return{type:a.TokenType.PI,target:l,data:""};var f=this.takeUntilStartsWith("?>");return this.eof()&&this.throwError("Missing processing instruction end symbol `?>`"),this.seek(2),{type:a.TokenType.PI,target:l,data:f}},c.prototype.text=function(){var l=this.takeUntil("<");return{type:a.TokenType.Text,data:l}},c.prototype.comment=function(){var l=this.takeUntilStartsWith("-->");return this.eof()&&this.throwError("Missing comment end symbol `-->`"),this.seek(3),{type:a.TokenType.Comment,data:l}},c.prototype.cdata=function(){var l=this.takeUntilStartsWith("]]>");return this.eof()&&this.throwError("Missing CDATA end symbol `]>`"),this.seek(3),{type:a.TokenType.CDATA,data:l}},c.prototype.openTag=function(){this.skipSpace();var l=this.takeUntil2(">","/",!0);if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:[],selfClosing:!0};for(var f=[];!this.eof();){if(this.skipSpace(),this.skipIfStartsWith(">"))return{type:a.TokenType.Element,name:l,attributes:f,selfClosing:!1};if(this.skipIfStartsWith("/>"))return{type:a.TokenType.Element,name:l,attributes:f,selfClosing:!0};var u=this.attribute();f.push(u)}this.throwError("Missing opening element tag end symbol `>`")},c.prototype.closeTag=function(){this.skipSpace();var l=this.takeUntil(">",!0);return this.skipSpace(),this.skipIfStartsWith(">")||this.throwError("Missing closing element tag end symbol `>`"),{type:a.TokenType.ClosingTag,name:l}},c.prototype.attribute=function(){this.skipSpace();var l=this.takeUntil("=",!0);return this.skipSpace(),this.skipIfStartsWith("=")||this.throwError("Missing equals sign before attribute value"),[l,this.quotedString()]},c.prototype.quotedString=function(){this.skipSpace();var l=this.take(1);c.isQuote(l)||this.throwError("Missing start quote character before quoted value");var f=this.takeUntil(l);return this.skipIfStartsWith(l)||this.throwError("Missing end quote character after quoted value"),f},c.prototype.eof=function(){return this._index>=this._length},c.prototype.skipIfStartsWith=function(l){var f=l.length;if(f===1)return this._str[this._index]===l&&(this._index++,!0);for(var u=0;u<f;u++)if(this._str[this._index+u]!==l[u])return!1;return this._index+=f,!0},c.prototype.seek=function(l){this._index+=l,this._index<0&&(this._index=0),this._index>this._length&&(this._index=this._length)},c.prototype.skipSpace=function(){for(;!this.eof()&&c.isSpace(this._str[this._index]);)this._index++},c.prototype.take=function(l){if(l===1)return this._str[this._index++];var f=this._index;return this.seek(l),this._str.slice(f,this._index)},c.prototype.takeUntil=function(l,f){f===void 0&&(f=!1);for(var u=this._index;this._index<this._length;){var d=this._str[this._index];if(d===l||f&&c.isSpace(d))break;this._index++}return this._str.slice(u,this._index)},c.prototype.takeUntil2=function(l,f,u){u===void 0&&(u=!1);for(var d=this._index;this._index<this._length;){var h=this._str[this._index];if(h===l||h===f||u&&c.isSpace(h))break;this._index++}return this._str.slice(d,this._index)},c.prototype.takeUntilStartsWith=function(l,f){f===void 0&&(f=!1);for(var u=this._index,d=l.length;this._index<this._length;){for(var h=!0,g=0;g<d;g++){var p=this._str[this._index+g],v=l[g];if(f&&c.isSpace(p))return this._str.slice(u,this._index);if(p!==v){this._index++,h=!1;break}}if(h)return this._str.slice(u,this._index)}return this._index=this._length,this._str.slice(u)},c.prototype.skipUntil=function(l){for(;this._index<this._length&&this._str[this._index]!==l;)this._index++},c.isWhiteSpaceToken=function(l){for(var f=l.data,u=0;u<f.length;u++){var d=f[u];if(d!==" "&&d!==`
`&&d!=="\r"&&d!=="	"&&d!=="\f")return!1}return!0},c.isSpace=function(l){return l===" "||l===`
`||l==="\r"||l==="	"},c.isQuote=function(l){return l==='"'||l==="'"},c.prototype.throwError=function(l){for(var f=/\r\n|\r|\n/g,u=null,d=0,h=0,g=this._str.length;(u=f.exec(this._str))!==null&&u!==null;)if(d++,u.index<this._index&&(h=f.lastIndex),u.index>this._index){g=u.index;break}throw this.err={line:d,col:this._index-h,index:this._index,str:this._str.substring(h,g)},new Error(l+`
Index: `+this.err.index+`
Ln: `+this.err.line+", Col: "+this.err.col+`
Input: `+this.err.str)},c.prototype[Symbol.iterator]=function(){return this._index=0,{next:(function(){var l=this.nextToken();return l.type===a.TokenType.EOF?{done:!0,value:null}:{done:!1,value:l}}).bind(this)}},c}();n.XMLStringLexer=s},function(r,n,i){var o=i(39);r.exports=new o({include:[i(182)]})},function(r,n,i){var o=i(39);r.exports=new o({include:[i(113)],implicit:[i(289),i(290),i(291),i(292)]})},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(91),a=i(1),s=i(3),c=i(77),l=i(109);function f(g,p){var v=d(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,m=l.createDocument();h(m,v);var y=new c.XMLBuilderImpl(m);return w!==void 0&&y.ele(w),y}function u(g){if(!a.isPlainObject(g))return!1;for(var p in g)if(g.hasOwnProperty(p)&&!o.XMLBuilderOptionKeys.has(p))return!1;return!0}function d(g){g===void 0&&(g={});var p=a.applyDefaults(g,o.DefaultBuilderOptions);if(p.convert.att.length===0||p.convert.ins.length===0||p.convert.text.length===0||p.convert.cdata.length===0||p.convert.comment.length===0)throw new Error("JS object converter strings cannot be zero length.");return p}function h(g,p,v){var w=g;w._xmlBuilderOptions=p,w._isFragment=v}n.builder=function(g,p){var v=d(u(g)?g:o.DefaultBuilderOptions),w=s.Guard.isNode(g)||a.isArray(g)?g:p;if(w===void 0)throw new Error("Invalid arguments.");if(a.isArray(w)){for(var m=[],y=0;y<w.length;y++){var x=new c.XMLBuilderImpl(w[y]);x.set(v),m.push(x)}return m}var C=new c.XMLBuilderImpl(w);return C.set(v),C},n.create=f,n.fragment=function(g,p){var v=d(g===void 0||u(g)?g:o.DefaultBuilderOptions),w=u(g)?p:g,m=l.createDocument();h(m,v,!0);var y=new c.XMLBuilderImpl(m.createDocumentFragment());return w!==void 0&&y.ele(w),y},n.convert=function(g,p,v){var w,m,y;return u(g)&&p!==void 0?(w=g,m=p,y=v):(w=o.DefaultBuilderOptions,m=g,y=p||void 0),f(w,m).end(y)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.builder=o.builder,n.create=o.create,n.fragment=o.fragment,n.convert=o.convert,n.createCB=o.createCB,n.fragmentCB=o.fragmentCB},function(r,n,i){i(31),i(32),i(33),i(191),i(192),i(194),i(64),i(19),i(198),i(199),i(89),i(201),i(65),i(20),i(66),i(22),i(23);var o=this&&this.__read||function(w,m){var y=typeof Symbol=="function"&&w[Symbol.iterator];if(!y)return w;var x,C,S=y.call(w),T=[];try{for(;(m===void 0||m-- >0)&&!(x=S.next()).done;)T.push(x.value)}catch(_){C={error:_}}finally{try{x&&!x.done&&(y=S.return)&&y.call(S)}finally{if(C)throw C.error}}return T},a=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],x=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&x>=w.length&&(w=void 0),{value:w&&w[x++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(91),c=i(1),l=i(217),f=i(2),u=i(3),d=i(0),h=i(109),g=i(7),p=i(276),v=function(){function w(m){this._domNode=m}return Object.defineProperty(w.prototype,"node",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),Object.defineProperty(w.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),w.prototype.set=function(m){return this._options=c.applyDefaults(c.applyDefaults(this._options,m,!0),s.DefaultBuilderOptions),this},w.prototype.ele=function(m,y,x){var C,S,T,_,E,D;if(c.isObject(m))return new p.ObjectReader(this._options).parse(this,m);if(m!==null&&/^\s*</.test(m))return new p.XMLReader(this._options).parse(this,m);if(m!==null&&/^\s*[\{\[]/.test(m))return new p.JSONReader(this._options).parse(this,m);if(m!==null&&/^(\s*|(#.*)|(%.*))*---/.test(m))return new p.YAMLReader(this._options).parse(this,m);if((m===null||c.isString(m))&&c.isString(y))_=(C=o([m,y,x],3))[0],E=C[1],D=C[2];else{if(m===null)throw new Error("Element name cannot be null. "+this._debugInfo());_=(S=o([void 0,m,c.isObject(y)?y:void 0],3))[0],E=S[1],D=S[2]}if(D&&(D=c.getValue(D)),_=(T=o(this._extractNamespace(h.sanitizeInput(_,this._options.invalidCharReplacement),h.sanitizeInput(E,this._options.invalidCharReplacement),!0),2))[0],E=T[1],_===void 0){var b=o(d.namespace_extractQName(E),1)[0];_=this.node.lookupNamespaceURI(b)}var I=_!=null?this._doc.createElementNS(_,E):this._doc.createElement(E);this.node.appendChild(I);var R=new w(I),M=this._doc.doctype;if(I===this._doc.documentElement&&M!==null){var P=this._doc.implementation.createDocumentType(this._doc.documentElement.tagName,M.publicId,M.systemId);this._doc.replaceChild(P,M)}return D&&!c.isEmpty(D)&&R.att(D),R},w.prototype.remove=function(){var m=this.up();return m.node.removeChild(this.node),m},w.prototype.att=function(m,y,x){var C,S,T,_,E,D,b=this;if(c.isMap(m)||c.isObject(m))return c.forEachObject(m,function(A,L){return b.att(A,L)},this),this;if(m!=null&&(m=c.getValue(m+"")),y!=null&&(y=c.getValue(y+"")),x!=null&&(x=c.getValue(x+"")),m!==null&&!c.isString(m)||!c.isString(y)||x!==null&&!c.isString(x)){if(!c.isString(m)||y!=null&&!c.isString(y))throw new Error("Attribute name and value not specified. "+this._debugInfo());_=(S=o([void 0,m,y],3))[0],E=S[1],D=S[2]}else _=(C=o([m,y,x],3))[0],E=C[1],D=C[2];if(this._options.keepNullAttributes&&D==null)D="";else if(D==null)return this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be assigned to an element node.");var I=this.node;_=(T=o(this._extractNamespace(_,E,!1),2))[0],E=T[1],E=h.sanitizeInput(E,this._options.invalidCharReplacement),_=h.sanitizeInput(_,this._options.invalidCharReplacement),D=h.sanitizeInput(D,this._options.invalidCharReplacement);var R=o(d.namespace_extractQName(E),2),M=R[0],P=R[1],k=o(d.namespace_extractQName(I.prefix?I.prefix+":"+I.localName:I.localName),1)[0],z=null;return M==="xmlns"?(_=g.namespace.XMLNS,I.namespaceURI===null&&k===P&&(z=D)):M===null&&P==="xmlns"&&k===null&&(_=g.namespace.XMLNS,z=D),z!==null&&(this._updateNamespace(z),I=this.node),_!==void 0?I.setAttributeNS(_,E,D):I.setAttribute(E,D),this},w.prototype.removeAtt=function(m,y){var x,C,S=this;if(!u.Guard.isElementNode(this.node))throw new Error("An attribute can only be removed from an element node.");if(m=c.getValue(m),y!==void 0&&(y=c.getValue(y)),m!==null&&y===void 0)C=m;else{if(m!==null&&!c.isString(m)||y===void 0)throw new Error("Attribute namespace must be a string. "+this._debugInfo());x=m,C=y}return c.isArray(C)||c.isSet(C)?c.forEachArray(C,function(T){return x===void 0?S.removeAtt(T):S.removeAtt(x,T)},this):x!==void 0?(C=h.sanitizeInput(C,this._options.invalidCharReplacement),x=h.sanitizeInput(x,this._options.invalidCharReplacement),this.node.removeAttributeNS(x,C)):(C=h.sanitizeInput(C,this._options.invalidCharReplacement),this.node.removeAttribute(C)),this},w.prototype.txt=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createTextNode(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.com=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createComment(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.dat=function(m){if(m==null){if(!this._options.keepNullNodes)return this;m=""}var y=this._doc.createCDATASection(h.sanitizeInput(m,this._options.invalidCharReplacement));return this.node.appendChild(y),this},w.prototype.ins=function(m,y){var x=this;if(y===void 0&&(y=""),y==null){if(!this._options.keepNullNodes)return this;y=""}if(c.isArray(m)||c.isSet(m))c.forEachArray(m,function(S){var T=(S+="").indexOf(" "),_=T===-1?S:S.substr(0,T),E=T===-1?"":S.substr(T+1);x.ins(_,E)},this);else if(c.isMap(m)||c.isObject(m))c.forEachObject(m,function(S,T){return x.ins(S,T)},this);else{var C=this._doc.createProcessingInstruction(h.sanitizeInput(m,this._options.invalidCharReplacement),h.sanitizeInput(y,this._options.invalidCharReplacement));this.node.appendChild(C)}return this},w.prototype.dec=function(m){return this._options.version=m.version||"1.0",this._options.encoding=m.encoding,this._options.standalone=m.standalone,this},w.prototype.dtd=function(m){var y=h.sanitizeInput(m&&m.name||(this._doc.documentElement?this._doc.documentElement.tagName:"ROOT"),this._options.invalidCharReplacement),x=h.sanitizeInput(m&&m.pubID||"",this._options.invalidCharReplacement),C=h.sanitizeInput(m&&m.sysID||"",this._options.invalidCharReplacement);if(this._doc.documentElement!==null&&y!==this._doc.documentElement.tagName)throw new Error("DocType name does not match document element name.");var S=this._doc.implementation.createDocumentType(y,x,C);return this._doc.doctype!==null?this._doc.replaceChild(S,this._doc.doctype):this._doc.insertBefore(S,this._doc.documentElement),this},w.prototype.import=function(m){var y,x,C=this._domNode,S=this._doc,T=m.node;if(u.Guard.isDocumentNode(T)){var _=T.documentElement;if(_===null)throw new Error("Imported document has no document element node. "+this._debugInfo());var E=S.importNode(_,!0);C.appendChild(E);var D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=C.lookupNamespaceURI(D);new w(E)._updateNamespace(b)}else if(u.Guard.isDocumentFragmentNode(T))try{for(var I=a(T.childNodes),R=I.next();!R.done;R=I.next()){var M=R.value;E=S.importNode(M,!0),C.appendChild(E),u.Guard.isElementNode(E)&&(D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=C.lookupNamespaceURI(D),new w(E)._updateNamespace(b))}}catch(P){y={error:P}}finally{try{R&&!R.done&&(x=I.return)&&x.call(I)}finally{if(y)throw y.error}}else E=S.importNode(T,!0),C.appendChild(E),u.Guard.isElementNode(E)&&(D=o(d.namespace_extractQName(E.prefix?E.prefix+":"+E.localName:E.localName),1)[0],b=C.lookupNamespaceURI(D),new w(E)._updateNamespace(b));return this},w.prototype.doc=function(){if(this._doc._isFragment){for(var m=this.node;m&&m.nodeType!==f.NodeType.DocumentFragment;)m=m.parentNode;if(m===null)throw new Error("Node has no parent node while searching for document fragment ancestor. "+this._debugInfo());return new w(m)}return new w(this._doc)},w.prototype.root=function(){var m=this._doc.documentElement;if(!m)throw new Error("Document root element is null. "+this._debugInfo());return new w(m)},w.prototype.up=function(){var m=this._domNode.parentNode;if(!m)throw new Error("Parent node is null. "+this._debugInfo());return new w(m)},w.prototype.prev=function(){var m=this._domNode.previousSibling;if(!m)throw new Error("Previous sibling node is null. "+this._debugInfo());return new w(m)},w.prototype.next=function(){var m=this._domNode.nextSibling;if(!m)throw new Error("Next sibling node is null. "+this._debugInfo());return new w(m)},w.prototype.first=function(){var m=this._domNode.firstChild;if(!m)throw new Error("First child node is null. "+this._debugInfo());return new w(m)},w.prototype.last=function(){var m=this._domNode.lastChild;if(!m)throw new Error("Last child node is null. "+this._debugInfo());return new w(m)},w.prototype.each=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,x);S[0];){var T=this._getNextDescendantNode(this._domNode,S[0],x,S[1],S[2]);m.call(C,new w(S[0]),S[1],S[2]),S=T}return this},w.prototype.map=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);var S=[];return this.each(function(T,_,E){return S.push(m.call(C,T,_,E))},y,x),S},w.prototype.reduce=function(m,y,x,C,S){x===void 0&&(x=!1),C===void 0&&(C=!1);var T=y;return this.each(function(_,E,D){return T=m.call(S,T,_,E,D)},x,C),T},w.prototype.find=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,x);S[0];){var T=new w(S[0]);if(m.call(C,T,S[1],S[2]))return T;S=this._getNextDescendantNode(this._domNode,S[0],x,S[1],S[2])}},w.prototype.filter=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);var S=[];return this.each(function(T,_,E){m.call(C,T,_,E)&&S.push(T)},y,x),S},w.prototype.every=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,x);S[0];){var T=new w(S[0]);if(!m.call(C,T,S[1],S[2]))return!1;S=this._getNextDescendantNode(this._domNode,S[0],x,S[1],S[2])}return!0},w.prototype.some=function(m,y,x,C){y===void 0&&(y=!1),x===void 0&&(x=!1);for(var S=this._getFirstDescendantNode(this._domNode,y,x);S[0];){var T=new w(S[0]);if(m.call(C,T,S[1],S[2]))return!0;S=this._getNextDescendantNode(this._domNode,S[0],x,S[1],S[2])}return!1},w.prototype.toArray=function(m,y){m===void 0&&(m=!1),y===void 0&&(y=!1);var x=[];return this.each(function(C){return x.push(C)},m,y),x},w.prototype.toString=function(m){return(m=m||{}).format===void 0&&(m.format="xml"),this._serialize(m)},w.prototype.toObject=function(m){return(m=m||{}).format===void 0&&(m.format="object"),this._serialize(m)},w.prototype.end=function(m){return(m=m||{}).format===void 0&&(m.format="xml"),this.doc()._serialize(m)},w.prototype._getFirstDescendantNode=function(m,y,x){return y?[this._domNode,0,0]:x?this._getNextDescendantNode(m,m,x,0,0):[this._domNode.firstChild,0,1]},w.prototype._getNextDescendantNode=function(m,y,x,C,S){if(!x)return m===y?[y.firstChild,0,S+1]:[y.nextSibling,C+1,S];if(y.firstChild)return[y.firstChild,0,S+1];if(y===m)return[null,-1,-1];if(y.nextSibling)return[y.nextSibling,C+1,S];for(var T=y.parentNode;T&&T!==m;){if(T.nextSibling)return[T.nextSibling,d.tree_index(T.nextSibling),S-1];T=T.parentNode,S--}return[null,-1,-1]},w.prototype._serialize=function(m){if(m.format==="xml")return new l.XMLWriter(this._options,m).serialize(this.node);if(m.format==="map")return new l.MapWriter(this._options,m).serialize(this.node);if(m.format==="object")return new l.ObjectWriter(this._options,m).serialize(this.node);if(m.format==="json")return new l.JSONWriter(this._options,m).serialize(this.node);if(m.format==="yaml")return new l.YAMLWriter(this._options,m).serialize(this.node);throw new Error("Invalid writer format: "+m.format+". "+this._debugInfo())},w.prototype._extractNamespace=function(m,y,x){var C=y.indexOf("@");if(C>0&&(m===void 0&&(m=y.slice(C+1)),y=y.slice(0,C)),m===void 0)m=x?this._options.defaultNamespace.ele:this._options.defaultNamespace.att;else if(m!==null&&m[0]==="@"){var S=m.slice(1);if((m=this._options.namespaceAlias[S])===void 0)throw new Error("Namespace alias `"+S+"` is not defined. "+this._debugInfo())}return[m,y]},w.prototype._updateNamespace=function(m){var y,x,C,S,T=this._domNode;if(u.Guard.isElementNode(T)&&m!==null&&T.namespaceURI!==m){var _=o(d.namespace_extractQName(T.prefix?T.prefix+":"+T.localName:T.localName),2),E=_[0],D=_[1],b=d.create_element(this._doc,D,m,E);try{for(var I=a(T.attributes),R=I.next();!R.done;R=I.next()){var M=R.value,P=M.prefix?M.prefix+":"+M.localName:M.localName,k=o(d.namespace_extractQName(P),1)[0],z=M.namespaceURI;z===null&&k!==null&&(z=T.lookupNamespaceURI(k)),z===null?b.setAttribute(P,M.value):b.setAttributeNS(z,P,M.value)}}catch(de){y={error:de}}finally{try{R&&!R.done&&(x=I.return)&&x.call(I)}finally{if(y)throw y.error}}var A=T.parentNode;if(A===null)throw new Error("Parent node is null."+this._debugInfo());A.replaceChild(b,T),this._domNode=b;try{for(var L=a(T.childNodes),N=L.next();!N.done;N=L.next()){var H=N.value.cloneNode(!0);if(b.appendChild(H),u.Guard.isElementNode(H)){var ee=o(d.namespace_extractQName(H.prefix?H.prefix+":"+H.localName:H.localName),1)[0],oe=b.lookupNamespaceURI(ee);new w(H)._updateNamespace(oe)}}}catch(de){C={error:de}}finally{try{N&&!N.done&&(S=L.return)&&S.call(L)}finally{if(C)throw C.error}}}},Object.defineProperty(w.prototype,"_doc",{get:function(){var m=this.node;if(u.Guard.isDocumentNode(m))return m;var y=m.ownerDocument;if(!y)throw new Error("Owner document is null. "+this._debugInfo());return y},enumerable:!0,configurable:!0}),w.prototype._debugInfo=function(m){var y=this.node,x=y.parentNode;m=m||y.nodeName;var C=x?x.nodeName:"";return C?"node: <"+m+">, parent: <"+C+">":"node: <"+m+">"},Object.defineProperty(w.prototype,"_options",{get:function(){var m=this._doc;if(m._xmlBuilderOptions===void 0)throw new Error("Builder options is not set.");return m._xmlBuilderOptions},set:function(m){this._doc._xmlBuilderOptions=m},enumerable:!0,configurable:!0}),w}();n.XMLBuilderImpl=v},function(r,n,i){var o=i(11),a=i(117),s=o.WeakMap;r.exports=typeof s=="function"&&/native code/.test(a(s))},function(r,n,i){var o=i(46),a=i(82),s=i(85),c=i(18);r.exports=o("Reflect","ownKeys")||function(l){var f=a.f(c(l)),u=s.f;return u?f.concat(u(l)):f}},function(r,n,i){var o=i(16),a=i(15),s=i(18),c=i(61);r.exports=o?Object.defineProperties:function(l,f){s(l);for(var u,d=c(f),h=d.length,g=0;h>g;)a.f(l,u=d[g++],f[u]);return l}},function(r,n,i){var o=i(46);r.exports=o("document","documentElement")},function(r,n,i){var o=i(24),a=i(82).f,s={}.toString,c=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];r.exports.f=function(l){return c&&s.call(l)=="[object Window]"?function(f){try{return a(f)}catch{return c.slice()}}(l):a(o(l))}},function(r,n,i){var o=i(4),a=i(36).every,s=i(48),c=i(28),l=s("every"),f=c("every");o({target:"Array",proto:!0,forced:!l||!f},{every:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(36).filter,s=i(63),c=i(28),l=s("filter"),f=c("filter");o({target:"Array",proto:!0,forced:!l||!f},{filter:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(46);r.exports=o("navigator","userAgent")||""},function(r,n,i){var o=i(4),a=i(36).find,s=i(130),c=i(28),l=!0,f=c("find");"find"in[]&&Array(1).find(function(){l=!1}),o({target:"Array",proto:!0,forced:l||!f},{find:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}}),s("find")},function(r,n,i){var o=i(131).IteratorPrototype,a=i(60),s=i(40),c=i(62),l=i(49),f=function(){return this};r.exports=function(u,d,h){var g=d+" Iterator";return u.prototype=a(o,{next:s(1,h)}),c(u,g,!1,!0),l[g]=f,u}},function(r,n,i){var o=i(8);r.exports=!o(function(){function a(){}return a.prototype.constructor=null,Object.getPrototypeOf(new a)!==a.prototype})},function(r,n,i){var o=i(13);r.exports=function(a){if(!o(a)&&a!==null)throw TypeError("Can't set "+String(a)+" as a prototype");return a}},function(r,n,i){var o=i(4),a=i(36).map,s=i(63),c=i(28),l=s("map"),f=c("map");o({target:"Array",proto:!0,forced:!l||!f},{map:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(4),a=i(200).left,s=i(48),c=i(28),l=s("reduce"),f=c("reduce",{1:0});o({target:"Array",proto:!0,forced:!l||!f},{reduce:function(u){return a(this,u,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(127),a=i(27),s=i(41),c=i(26),l=function(f){return function(u,d,h,g){o(d);var p=a(u),v=s(p),w=c(p.length),m=f?w-1:0,y=f?-1:1;if(h<2)for(;;){if(m in v){g=v[m],m+=y;break}if(m+=y,f?m<0:w<=m)throw TypeError("Reduce of empty array with no initial value")}for(;f?m>=0:w>m;m+=y)m in v&&(g=d(g,v[m],m,p));return g}};r.exports={left:l(!1),right:l(!0)}},function(r,n,i){var o=i(4),a=i(36).some,s=i(48),c=i(28),l=s("some"),f=c("some");o({target:"Array",proto:!0,forced:!l||!f},{some:function(u){return a(this,u,arguments.length>1?arguments[1]:void 0)}})},function(r,n,i){var o=i(90),a=i(135);r.exports=o?{}.toString:function(){return"[object "+a(this)+"]"}},function(r,n){r.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(r,n,i){var o=i(8);r.exports=!o(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(r,n,i){var o=i(5),a=i(49),s=o("iterator"),c=Array.prototype;r.exports=function(l){return l!==void 0&&(a.Array===l||c[s]===l)}},function(r,n,i){var o=i(135),a=i(49),s=i(5)("iterator");r.exports=function(c){if(c!=null)return c[s]||c["@@iterator"]||a[o(c)]}},function(r,n,i){var o=i(18);r.exports=function(a,s,c,l){try{return l?s(o(c)[0],c[1]):s(c)}catch(u){var f=a.return;throw f!==void 0&&o(f.call(a)),u}}},function(r,n,i){var o=i(5)("iterator"),a=!1;try{var s=0,c={next:function(){return{done:!!s++}},return:function(){a=!0}};c[o]=function(){return this},Array.from(c,function(){throw 2})}catch{}r.exports=function(l,f){if(!f&&!a)return!1;var u=!1;try{var d={};d[o]=function(){return{next:function(){return{done:u=!0}}}},l(d)}catch{}return u}},function(r,n,i){var o=i(13),a=i(133);r.exports=function(s,c,l){var f,u;return a&&typeof(f=c.constructor)=="function"&&f!==l&&o(u=f.prototype)&&u!==l.prototype&&a(s,u),s}},function(r,n,i){var o=i(25);r.exports=function(a,s,c){for(var l in s)o(a,l,s[l],c);return a}},function(r,n,i){var o=i(46),a=i(15),s=i(5),c=i(16),l=s("species");r.exports=function(f){var u=o(f),d=a.f;c&&u&&!u[l]&&d(u,l,{configurable:!0,get:function(){return this}})}},function(r,n,i){var o=this&&this.__generator||function(c,l){var f,u,d,h,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(v){return function(w){return function(m){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,u&&(d=2&m[0]?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[2&m[0],d.value]),m[0]){case 0:case 1:d=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,u=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(d=g.trys,!((d=d.length>0&&d[d.length-1])||m[0]!==6&&m[0]!==2)){g=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){g.label=m[1];break}if(m[0]===6&&g.label<d[1]){g.label=d[1],d=m;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(m);break}d[2]&&g.ops.pop(),g.trys.pop();continue}m=l.call(c,g)}catch(y){m=[6,y],u=0}finally{f=d=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([v,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function c(l){l===void 0&&(l=1e3),this._items=new Set,this._limit=l}return c.prototype.add=function(l){if(this._items.add(l),this._items.size>this._limit){var f=this._items.values().next();f.done||this._items.delete(f.value)}return this},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,f){var u=this;this._items.forEach(function(d){return l.call(f,d,d,u)})},c.prototype.keys=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}})},c.prototype.values=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}})},c.prototype.entries=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}})},c.prototype[Symbol.iterator]=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}})},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"FixedSizeSet"},enumerable:!0,configurable:!0}),c}();n.FixedSizeSet=s},function(r,n,i){var o=this&&this.__generator||function(c,l){var f,u,d,h,g={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return h={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function p(v){return function(w){return function(m){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,u&&(d=2&m[0]?u.return:m[0]?u.throw||((d=u.return)&&d.call(u),0):u.next)&&!(d=d.call(u,m[1])).done)return d;switch(u=0,d&&(m=[2&m[0],d.value]),m[0]){case 0:case 1:d=m;break;case 4:return g.label++,{value:m[1],done:!1};case 5:g.label++,u=m[1],m=[0];continue;case 7:m=g.ops.pop(),g.trys.pop();continue;default:if(d=g.trys,!((d=d.length>0&&d[d.length-1])||m[0]!==6&&m[0]!==2)){g=0;continue}if(m[0]===3&&(!d||m[1]>d[0]&&m[1]<d[3])){g.label=m[1];break}if(m[0]===6&&g.label<d[1]){g.label=d[1],d=m;break}if(d&&g.label<d[2]){g.label=d[2],g.ops.push(m);break}d[2]&&g.ops.pop(),g.trys.pop();continue}m=l.call(c,g)}catch(y){m=[6,y],u=0}finally{f=d=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([v,w])}}},a=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function c(l){l===void 0&&(l=1e3),this._items=new Map,this._limit=l}return c.prototype.get=function(l){return this._items.get(l)},c.prototype.set=function(l,f){if(this._items.set(l,f),this._items.size>this._limit){var u=this._items.keys().next();u.done||this._items.delete(u.value)}},c.prototype.delete=function(l){return this._items.delete(l)},c.prototype.has=function(l){return this._items.has(l)},c.prototype.clear=function(){this._items.clear()},Object.defineProperty(c.prototype,"size",{get:function(){return this._items.size},enumerable:!0,configurable:!0}),c.prototype.forEach=function(l,f){this._items.forEach(function(u,d){return l.call(f,d,u)})},c.prototype.keys=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.keys())];case 1:return l.sent(),[2]}})},c.prototype.values=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.values())];case 1:return l.sent(),[2]}})},c.prototype.entries=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items.entries())];case 1:return l.sent(),[2]}})},c.prototype[Symbol.iterator]=function(){return o(this,function(l){switch(l.label){case 0:return[5,a(this._items)];case 1:return l.sent(),[2]}})},Object.defineProperty(c.prototype,Symbol.toStringTag,{get:function(){return"ObjectCache"},enumerable:!0,configurable:!0}),c}();n.ObjectCache=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(s){s===void 0&&(s=1e3),this._items=new Map,this._limit=s}return a.prototype.check=function(s,c){if(this._items.get(s)===c)return!0;if(this._items.get(c)===s)return!1;var l=Math.random()<.5;if(l?this._items.set(s,c):this._items.set(c,s),this._items.size>this._limit){var f=this._items.keys().next();f.done||this._items.delete(f.value)}return l},a}();n.CompareCache=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(s){this._initialized=!1,this._value=void 0,this._initFunc=s}return Object.defineProperty(a.prototype,"value",{get:function(){return this._initialized||(this._value=this._initFunc(),this._initialized=!0),this._value},enumerable:!0,configurable:!0}),a}();n.Lazy=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function a(s){this._pointer=0,this._chars=Array.from(s),this._length=this._chars.length}return Object.defineProperty(a.prototype,"eof",{get:function(){return this._pointer>=this._length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),a.prototype.codePoint=function(){if(this._codePoint===void 0)if(this.eof)this._codePoint=-1;else{var s=this._chars[this._pointer].codePointAt(0);this._codePoint=s!==void 0?s:-1}return this._codePoint},a.prototype.c=function(){return this._c===void 0&&(this._c=this.eof?"":this._chars[this._pointer]),this._c},a.prototype.remaining=function(){return this._remaining===void 0&&(this._remaining=this.eof?"":this._chars.slice(this._pointer+1).join("")),this._remaining},a.prototype.substring=function(){return this._substring===void 0&&(this._substring=this.eof?"":this._chars.slice(this._pointer).join("")),this._substring},Object.defineProperty(a.prototype,"pointer",{get:function(){return this._pointer},set:function(s){s!==this._pointer&&(this._pointer=s,this._codePoint=void 0,this._c=void 0,this._remaining=void 0,this._substring=void 0)},enumerable:!0,configurable:!0}),a}();n.StringWalker=o},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(218);n.MapWriter=o.MapWriter;var a=i(258);n.XMLWriter=a.XMLWriter;var s=i(67);n.ObjectWriter=s.ObjectWriter;var c=i(260);n.JSONWriter=c.JSONWriter;var l=i(261);n.YAMLWriter=l.YAMLWriter},function(r,n,i){i(19),i(219),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(f,u){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var g in h)h.hasOwnProperty(g)&&(d[g]=h[g])})(f,u)},function(f,u){function d(){this.constructor=f}o(f,u),f.prototype=u===null?Object.create(u):(d.prototype=u.prototype,new d)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(67),l=function(f){function u(d,h){var g=f.call(this,d)||this;return g._writerOptions=s.applyDefaults(h,{format:"map",wellFormed:!1,group:!1,verbose:!1}),g}return a(u,f),u.prototype.serialize=function(d){var h=s.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1,verbose:!1}),g=new c.ObjectWriter(this._builderOptions,h).serialize(d);return this._convertObject(g)},u.prototype._convertObject=function(d){if(s.isArray(d)){for(var h=0;h<d.length;h++)d[h]=this._convertObject(d[h]);return d}if(s.isObject(d)){var g=new Map;for(var p in d)g.set(p,this._convertObject(d[p]));return g}return d},u}(i(50).BaseWriter);n.MapWriter=l},function(r,n,i){var o=i(139),a=i(143);r.exports=o("Map",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},a)},function(r,n,i){var o=i(4),a=i(8),s=i(59),c=i(13),l=i(27),f=i(26),u=i(134),d=i(128),h=i(63),g=i(5),p=i(129),v=g("isConcatSpreadable"),w=p>=51||!a(function(){var x=[];return x[v]=!1,x.concat()[0]!==x}),m=h("concat"),y=function(x){if(!c(x))return!1;var C=x[v];return C!==void 0?!!C:s(x)};o({target:"Array",proto:!0,forced:!w||!m},{concat:function(x){var C,S,T,_,E,D=l(this),b=d(D,0),I=0;for(C=-1,T=arguments.length;C<T;C++)if(y(E=C===-1?D:arguments[C])){if(I+(_=f(E.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(S=0;S<_;S++,I++)S in E&&u(b,I,E[S])}else{if(I>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(b,I++,E)}return b.length=I,b}})},function(r,n,i){var o=i(8);function a(s,c){return RegExp(s,c)}n.UNSUPPORTED_Y=o(function(){var s=a("a","y");return s.lastIndex=2,s.exec("abcd")!=null}),n.BROKEN_CARET=o(function(){var s=a("^r","gy");return s.lastIndex=2,s.exec("str")!=null})},function(r,n,i){var o=i(223);r.exports=function(a){if(o(a))throw TypeError("The method doesn't accept regular expressions");return a}},function(r,n,i){var o=i(13),a=i(42),s=i(5)("match");r.exports=function(c){var l;return o(c)&&((l=c[s])!==void 0?!!l:a(c)=="RegExp")}},function(r,n,i){var o=i(5)("match");r.exports=function(a){var s=/./;try{"/./"[a](s)}catch{try{return s[o]=!1,"/./"[a](s)}catch{}}return!1}},function(r,n,i){i(68);var o=i(25),a=i(8),s=i(5),c=i(93),l=i(21),f=s("species"),u=!a(function(){var v=/./;return v.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(v,"$<a>")!=="7"}),d="a".replace(/./,"$0")==="$0",h=s("replace"),g=!!/./[h]&&/./[h]("a","$0")==="",p=!a(function(){var v=/(?:)/,w=v.exec;v.exec=function(){return w.apply(this,arguments)};var m="ab".split(v);return m.length!==2||m[0]!=="a"||m[1]!=="b"});r.exports=function(v,w,m,y){var x=s(v),C=!a(function(){var b={};return b[x]=function(){return 7},""[v](b)!=7}),S=C&&!a(function(){var b=!1,I=/a/;return v==="split"&&((I={}).constructor={},I.constructor[f]=function(){return I},I.flags="",I[x]=/./[x]),I.exec=function(){return b=!0,null},I[x](""),!b});if(!C||!S||v==="replace"&&(!u||!d||g)||v==="split"&&!p){var T=/./[x],_=m(x,""[v],function(b,I,R,M,P){return I.exec===c?C&&!P?{done:!0,value:T.call(I,R,M)}:{done:!0,value:b.call(R,I,M)}:{done:!1}},{REPLACE_KEEPS_$0:d,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:g}),E=_[0],D=_[1];o(String.prototype,v,E),o(RegExp.prototype,x,w==2?function(b,I){return D.call(b,this,I)}:function(b){return D.call(b,this)})}y&&l(RegExp.prototype[x],"sham",!0)}},function(r,n,i){var o=i(137).charAt;r.exports=function(a,s,c){return s+(c?o(a,s).length:1)}},function(r,n,i){var o=i(42),a=i(93);r.exports=function(s,c){var l=s.exec;if(typeof l=="function"){var f=l.call(s,c);if(typeof f!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return f}if(o(s)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return a.call(s,c)}},function(r,n,i){(function(o){Object.defineProperty(n,"__esModule",{value:!0});var a=i(96);n.forgivingBase64Encode=function(s){return o.from(s).toString("base64")},n.forgivingBase64Decode=function(s){return s===""?"":((s=s.replace(a.ASCIIWhiteSpace,"")).length%4==0&&(s.endsWith("==")?s=s.substr(0,s.length-2):s.endsWith("=")&&(s=s.substr(0,s.length-1))),s.length%4==1?null:/[0-9A-Za-z+/]/.test(s)?o.from(s,"base64").toString("utf8"):null)}}).call(this,i(145).Buffer)},function(r,n,i){n.byteLength=function(h){var g=u(h),p=g[0],v=g[1];return 3*(p+v)/4-v},n.toByteArray=function(h){var g,p,v=u(h),w=v[0],m=v[1],y=new s(function(S,T,_){return 3*(T+_)/4-_}(0,w,m)),x=0,C=m>0?w-4:w;for(p=0;p<C;p+=4)g=a[h.charCodeAt(p)]<<18|a[h.charCodeAt(p+1)]<<12|a[h.charCodeAt(p+2)]<<6|a[h.charCodeAt(p+3)],y[x++]=g>>16&255,y[x++]=g>>8&255,y[x++]=255&g;return m===2&&(g=a[h.charCodeAt(p)]<<2|a[h.charCodeAt(p+1)]>>4,y[x++]=255&g),m===1&&(g=a[h.charCodeAt(p)]<<10|a[h.charCodeAt(p+1)]<<4|a[h.charCodeAt(p+2)]>>2,y[x++]=g>>8&255,y[x++]=255&g),y},n.fromByteArray=function(h){for(var g,p=h.length,v=p%3,w=[],m=0,y=p-v;m<y;m+=16383)w.push(d(h,m,m+16383>y?y:m+16383));return v===1?(g=h[p-1],w.push(o[g>>2]+o[g<<4&63]+"==")):v===2&&(g=(h[p-2]<<8)+h[p-1],w.push(o[g>>10]+o[g>>4&63]+o[g<<2&63]+"=")),w.join("")};for(var o=[],a=[],s=typeof Uint8Array<"u"?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,f=c.length;l<f;++l)o[l]=c[l],a[c.charCodeAt(l)]=l;function u(h){var g=h.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var p=h.indexOf("=");return p===-1&&(p=g),[p,p===g?0:4-p%4]}function d(h,g,p){for(var v,w,m=[],y=g;y<p;y+=3)v=(h[y]<<16&16711680)+(h[y+1]<<8&65280)+(255&h[y+2]),m.push(o[(w=v)>>18&63]+o[w>>12&63]+o[w>>6&63]+o[63&w]);return m.join("")}a[45]=62,a[95]=63},function(r,n){n.read=function(i,o,a,s,c){var l,f,u=8*c-s-1,d=(1<<u)-1,h=d>>1,g=-7,p=a?c-1:0,v=a?-1:1,w=i[o+p];for(p+=v,l=w&(1<<-g)-1,w>>=-g,g+=u;g>0;l=256*l+i[o+p],p+=v,g-=8);for(f=l&(1<<-g)-1,l>>=-g,g+=s;g>0;f=256*f+i[o+p],p+=v,g-=8);if(l===0)l=1-h;else{if(l===d)return f?NaN:1/0*(w?-1:1);f+=Math.pow(2,s),l-=h}return(w?-1:1)*f*Math.pow(2,l-s)},n.write=function(i,o,a,s,c,l){var f,u,d,h=8*l-c-1,g=(1<<h)-1,p=g>>1,v=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=s?0:l-1,m=s?1:-1,y=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(u=isNaN(o)?1:0,f=g):(f=Math.floor(Math.log(o)/Math.LN2),o*(d=Math.pow(2,-f))<1&&(f--,d*=2),(o+=f+p>=1?v/d:v*Math.pow(2,1-p))*d>=2&&(f++,d/=2),f+p>=g?(u=0,f=g):f+p>=1?(u=(o*d-1)*Math.pow(2,c),f+=p):(u=o*Math.pow(2,p-1)*Math.pow(2,c),f=0));c>=8;i[a+w]=255&u,w+=m,u/=256,c-=8);for(f=f<<c|u,h+=c;h>0;i[a+w]=255&f,w+=m,f/=256,h-=8);i[a+w-m]|=128*y}},function(r,n){var i={}.toString;r.exports=Array.isArray||function(o){return i.call(o)=="[object Array]"}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){var l,f;if(c===null||a.isString(c)||a.isNumber(c))return c;if(a.isArray(c)){var u=new Array;try{for(var d=o(c),h=d.next();!h.done;h=d.next()){var g=h.value;u.push(s(g))}}catch(w){l={error:w}}finally{try{h&&!h.done&&(f=d.return)&&f.call(d)}finally{if(l)throw l.error}}return u}if(a.isObject(c)){u=new Map;for(var p in c)if(c.hasOwnProperty(p)){var v=c[p];u.set(p,s(v))}return u}return c}n.parseJSONFromBytes=function(c){var l=a.utf8Decode(c);return JSON.parse.call(void 0,l)},n.serializeJSONToBytes=function(c){var l=JSON.stringify.call(void 0,c);return a.utf8Encode(l)},n.parseJSONIntoInfraValues=function(c){return s(JSON.parse.call(void 0,c))},n.convertAJSONDerivedJavaScriptValueToAnInfraValue=s},function(r,n,i){var o=this&&this.__generator||function(f,u){var d,h,g,p,v={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(y){return function(x){if(d)throw new TypeError("Generator is already executing.");for(;v;)try{if(d=1,h&&(g=2&x[0]?h.return:x[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,x[1])).done)return g;switch(h=0,g&&(x=[2&x[0],g.value]),x[0]){case 0:case 1:g=x;break;case 4:return v.label++,{value:x[1],done:!1};case 5:v.label++,h=x[1],x=[0];continue;case 7:x=v.ops.pop(),v.trys.pop();continue;default:if(g=v.trys,!((g=g.length>0&&g[g.length-1])||x[0]!==6&&x[0]!==2)){v=0;continue}if(x[0]===3&&(!g||x[1]>g[0]&&x[1]<g[3])){v.label=x[1];break}if(x[0]===6&&v.label<g[1]){v.label=g[1],g=x;break}if(g&&v.label<g[2]){v.label=g[2],v.ops.push(x);break}g[2]&&v.ops.pop(),v.trys.pop();continue}x=u.call(f,v)}catch(C){x=[6,C],h=0}finally{d=g=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([m,y])}}},a=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return v},s=this&&this.__spread||function(){for(var f=[],u=0;u<arguments.length;u++)f=f.concat(a(arguments[u]));return f},c=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.append=function(f,u){f.push(u)},n.extend=function(f,u){f.push.apply(f,s(u))},n.prepend=function(f,u){f.unshift(u)},n.replace=function(f,u,d){var h,g,p=0;try{for(var v=c(f),w=v.next();!w.done;w=v.next()){var m=w.value;if(l.isFunction(u))u.call(null,m)&&(f[p]=d);else if(m===u)return void(f[p]=d);p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}},n.insert=function(f,u,d){f.splice(d,0,u)},n.remove=function(f,u){for(var d=f.length;d--;){var h=f[d];if(l.isFunction(u))u.call(null,h)&&f.splice(d,1);else if(h===u)return void f.splice(d,1)}},n.empty=function(f){f.length=0},n.contains=function(f,u){var d,h;try{for(var g=c(f),p=g.next();!p.done;p=g.next()){var v=p.value;if(l.isFunction(u)){if(u.call(null,v))return!0}else if(v===u)return!0}}catch(w){d={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(d)throw d.error}}return!1},n.size=function(f,u){var d,h;if(u===void 0)return f.length;var g=0;try{for(var p=c(f),v=p.next();!v.done;v=p.next()){var w=v.value;u.call(null,w)&&g++}}catch(m){d={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}return g},n.isEmpty=function(f){return f.length===0},n.forEach=function(f,u){var d,h,g,p,v,w;return o(this,function(m){switch(m.label){case 0:return u!==void 0?[3,2]:[5,c(f)];case 1:return m.sent(),[3,9];case 2:m.trys.push([2,7,8,9]),d=c(f),h=d.next(),m.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:m.sent(),m.label=5;case 5:return h=d.next(),[3,3];case 6:return[3,9];case 7:return p=m.sent(),v={error:p},[3,9];case 8:try{h&&!h.done&&(w=d.return)&&w.call(d)}finally{if(v)throw v.error}return[7];case 9:return[2]}})},n.clone=function(f){return new(Array.bind.apply(Array,s([void 0],f)))},n.sortInAscendingOrder=function(f,u){return f.sort(function(d,h){return u.call(null,d,h)?-1:1})},n.sortInDescendingOrder=function(f,u){return f.sort(function(d,h){return u.call(null,d,h)?1:-1})}},function(r,n,i){var o=this&&this.__generator||function(f,u){var d,h,g,p,v={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return p={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function w(m){return function(y){return function(x){if(d)throw new TypeError("Generator is already executing.");for(;v;)try{if(d=1,h&&(g=2&x[0]?h.return:x[0]?h.throw||((g=h.return)&&g.call(h),0):h.next)&&!(g=g.call(h,x[1])).done)return g;switch(h=0,g&&(x=[2&x[0],g.value]),x[0]){case 0:case 1:g=x;break;case 4:return v.label++,{value:x[1],done:!1};case 5:v.label++,h=x[1],x=[0];continue;case 7:x=v.ops.pop(),v.trys.pop();continue;default:if(g=v.trys,!((g=g.length>0&&g[g.length-1])||x[0]!==6&&x[0]!==2)){v=0;continue}if(x[0]===3&&(!g||x[1]>g[0]&&x[1]<g[3])){v.label=x[1];break}if(x[0]===6&&v.label<g[1]){v.label=g[1],g=x;break}if(g&&v.label<g[2]){v.label=g[2],v.ops.push(x);break}g[2]&&v.ops.pop(),v.trys.pop();continue}x=u.call(f,v)}catch(C){x=[6,C],h=0}finally{d=g=0}if(5&x[0])throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}([m,y])}}},a=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(f,u){var d=typeof Symbol=="function"&&f[Symbol.iterator];if(!d)return f;var h,g,p=d.call(f),v=[];try{for(;(u===void 0||u-- >0)&&!(h=p.next()).done;)v.push(h.value)}catch(w){g={error:w}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(g)throw g.error}}return v},c=this&&this.__spread||function(){for(var f=[],u=0;u<arguments.length;u++)f=f.concat(s(arguments[u]));return f};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);n.get=function(f,u){return f.get(u)},n.set=function(f,u,d){f.set(u,d)},n.remove=function(f,u){var d,h,g,p;if(l.isFunction(u)){var v=[];try{for(var w=a(f),m=w.next();!m.done;m=w.next()){var y=m.value;u.call(null,y)&&v.push(y[0])}}catch(T){d={error:T}}finally{try{m&&!m.done&&(h=w.return)&&h.call(w)}finally{if(d)throw d.error}}try{for(var x=a(v),C=x.next();!C.done;C=x.next()){var S=C.value;f.delete(S)}}catch(T){g={error:T}}finally{try{C&&!C.done&&(p=x.return)&&p.call(x)}finally{if(g)throw g.error}}}else f.delete(u)},n.contains=function(f,u){var d,h;if(l.isFunction(u)){try{for(var g=a(f),p=g.next();!p.done;p=g.next()){var v=p.value;if(u.call(null,v))return!0}}catch(w){d={error:w}}finally{try{p&&!p.done&&(h=g.return)&&h.call(g)}finally{if(d)throw d.error}}return!1}return f.has(u)},n.keys=function(f){return new Set(f.keys())},n.values=function(f){return c(f.values())},n.size=function(f,u){var d,h;if(u===void 0)return f.size;var g=0;try{for(var p=a(f),v=p.next();!v.done;v=p.next()){var w=v.value;u.call(null,w)&&g++}}catch(m){d={error:m}}finally{try{v&&!v.done&&(h=p.return)&&h.call(p)}finally{if(d)throw d.error}}return g},n.isEmpty=function(f){return f.size===0},n.forEach=function(f,u){var d,h,g,p,v,w;return o(this,function(m){switch(m.label){case 0:return u!==void 0?[3,2]:[5,a(f)];case 1:return m.sent(),[3,9];case 2:m.trys.push([2,7,8,9]),d=a(f),h=d.next(),m.label=3;case 3:return h.done?[3,6]:(g=h.value,u.call(null,g)?[4,g]:[3,5]);case 4:m.sent(),m.label=5;case 5:return h=d.next(),[3,3];case 6:return[3,9];case 7:return p=m.sent(),v={error:p},[3,9];case 8:try{h&&!h.done&&(w=d.return)&&w.call(d)}finally{if(v)throw v.error}return[7];case 9:return[2]}})},n.clone=function(f){return new Map(f)},n.sortInAscendingOrder=function(f,u){var d=new(Array.bind.apply(Array,c([void 0],f)));return d.sort(function(h,g){return u.call(null,h,g)?-1:1}),new Map(d)},n.sortInDescendingOrder=function(f,u){var d=new(Array.bind.apply(Array,c([void 0],f)));return d.sort(function(h,g){return u.call(null,h,g)?1:-1}),new Map(d)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.HTML="http://www.w3.org/1999/xhtml",n.XML="http://www.w3.org/XML/1998/namespace",n.XMLNS="http://www.w3.org/2000/xmlns/",n.MathML="http://www.w3.org/1998/Math/MathML",n.SVG="http://www.w3.org/2000/svg",n.XLink="http://www.w3.org/1999/xlink"},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.enqueue=function(o,a){o.push(a)},n.dequeue=function(o){return o.shift()||null}},function(r,n,i){var o=this&&this.__generator||function(u,d){var h,g,p,v,w={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return v={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function m(y){return function(x){return function(C){if(h)throw new TypeError("Generator is already executing.");for(;w;)try{if(h=1,g&&(p=2&C[0]?g.return:C[0]?g.throw||((p=g.return)&&p.call(g),0):g.next)&&!(p=p.call(g,C[1])).done)return p;switch(g=0,p&&(C=[2&C[0],p.value]),C[0]){case 0:case 1:p=C;break;case 4:return w.label++,{value:C[1],done:!1};case 5:w.label++,g=C[1],C=[0];continue;case 7:C=w.ops.pop(),w.trys.pop();continue;default:if(p=w.trys,!((p=p.length>0&&p[p.length-1])||C[0]!==6&&C[0]!==2)){w=0;continue}if(C[0]===3&&(!p||C[1]>p[0]&&C[1]<p[3])){w.label=C[1];break}if(C[0]===6&&w.label<p[1]){w.label=p[1],p=C;break}if(p&&w.label<p[2]){w.label=p[2],w.ops.push(C);break}p[2]&&w.ops.pop(),w.trys.pop();continue}C=d.call(u,w)}catch(S){C=[6,S],g=0}finally{h=p=0}if(5&C[0])throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}([y,x])}}},a=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(u,d){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var g,p,v=h.call(u),w=[];try{for(;(d===void 0||d-- >0)&&!(g=v.next()).done;)w.push(g.value)}catch(m){p={error:m}}finally{try{g&&!g.done&&(h=v.return)&&h.call(v)}finally{if(p)throw p.error}}return w},c=this&&this.__spread||function(){for(var u=[],d=0;d<arguments.length;d++)u=u.concat(s(arguments[d]));return u};Object.defineProperty(n,"__esModule",{value:!0});var l=i(1);function f(u,d){var h,g;try{for(var p=a(u),v=p.next();!v.done;v=p.next()){var w=v.value;if(!d.has(w))return!1}}catch(m){h={error:m}}finally{try{v&&!v.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!0}n.append=function(u,d){u.add(d)},n.extend=function(u,d){d.forEach(u.add,u)},n.prepend=function(u,d){var h=new Set(u);u.clear(),u.add(d),h.forEach(u.add,u)},n.replace=function(u,d,h){var g,p,v=new Set;try{for(var w=a(u),m=w.next();!m.done;m=w.next()){var y=m.value;l.isFunction(d)?d.call(null,y)?v.add(h):v.add(y):y===d?v.add(h):v.add(y)}}catch(x){g={error:x}}finally{try{m&&!m.done&&(p=w.return)&&p.call(w)}finally{if(g)throw g.error}}u.clear(),v.forEach(u.add,u)},n.insert=function(u,d,h){var g,p,v=new Set,w=0;try{for(var m=a(u),y=m.next();!y.done;y=m.next()){var x=y.value;w===h&&v.add(d),v.add(x),w++}}catch(C){g={error:C}}finally{try{y&&!y.done&&(p=m.return)&&p.call(m)}finally{if(g)throw g.error}}u.clear(),v.forEach(u.add,u)},n.remove=function(u,d){var h,g,p,v;if(l.isFunction(d)){var w=[];try{for(var m=a(u),y=m.next();!y.done;y=m.next()){var x=y.value;d.call(null,x)&&w.push(x)}}catch(_){h={error:_}}finally{try{y&&!y.done&&(g=m.return)&&g.call(m)}finally{if(h)throw h.error}}try{for(var C=a(w),S=C.next();!S.done;S=C.next()){var T=S.value;u.delete(T)}}catch(_){p={error:_}}finally{try{S&&!S.done&&(v=C.return)&&v.call(C)}finally{if(p)throw p.error}}}else u.delete(d)},n.empty=function(u){u.clear()},n.contains=function(u,d){var h,g;if(!l.isFunction(d))return u.has(d);try{for(var p=a(u),v=p.next();!v.done;v=p.next()){var w=v.value;if(d.call(null,w))return!0}}catch(m){h={error:m}}finally{try{v&&!v.done&&(g=p.return)&&g.call(p)}finally{if(h)throw h.error}}return!1},n.size=function(u,d){var h,g;if(d===void 0)return u.size;var p=0;try{for(var v=a(u),w=v.next();!w.done;w=v.next()){var m=w.value;d.call(null,m)&&p++}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return p},n.isEmpty=function(u){return u.size===0},n.forEach=function(u,d){var h,g,p,v,w,m;return o(this,function(y){switch(y.label){case 0:return d!==void 0?[3,2]:[5,a(u)];case 1:return y.sent(),[3,9];case 2:y.trys.push([2,7,8,9]),h=a(u),g=h.next(),y.label=3;case 3:return g.done?[3,6]:(p=g.value,d.call(null,p)?[4,p]:[3,5]);case 4:y.sent(),y.label=5;case 5:return g=h.next(),[3,3];case 6:return[3,9];case 7:return v=y.sent(),w={error:v},[3,9];case 8:try{g&&!g.done&&(m=h.return)&&m.call(h)}finally{if(w)throw w.error}return[7];case 9:return[2]}})},n.clone=function(u){return new Set(u)},n.sortInAscendingOrder=function(u,d){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort(function(g,p){return d.call(null,g,p)?-1:1}),new Set(h)},n.sortInDescendingOrder=function(u,d){var h=new(Array.bind.apply(Array,c([void 0],u)));return h.sort(function(g,p){return d.call(null,g,p)?1:-1}),new Set(h)},n.isSubsetOf=f,n.isSupersetOf=function(u,d){return f(d,u)},n.intersection=function(u,d){var h,g,p=new Set;try{for(var v=a(u),w=v.next();!w.done;w=v.next()){var m=w.value;d.has(m)&&p.add(m)}}catch(y){h={error:y}}finally{try{w&&!w.done&&(g=v.return)&&g.call(v)}finally{if(h)throw h.error}}return p},n.union=function(u,d){var h=new Set(u);return d.forEach(h.add,h),h},n.range=function(u,d){for(var h=new Set,g=u;g<=d;g++)h.add(g);return h}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),n.push=function(o,a){o.push(a)},n.pop=function(o){return o.pop()||null}},function(r,n,i){var o=this&&this.__values||function(w){var m=typeof Symbol=="function"&&Symbol.iterator,y=m&&w[m],x=0;if(y)return y.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&x>=w.length&&(w=void 0),{value:w&&w[x++],done:!w}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(96),s=i(147),c=i(146),l=i(1);function f(w,m){for(var y=0;;){var x=y<w.length?w.charCodeAt(y):null,C=y<m.length?m.charCodeAt(y):null;if(x===null)return!0;if(x!==C)return!1;y++}}function u(w){var m,y,x=Array.from(w),C=new Uint8Array(x.length),S=0;try{for(var T=o(w),_=T.next();!_.done;_=T.next()){var E=_.value.codePointAt(0);console.assert(E!==void 0&&E<=255,"isomorphicEncode requires string bytes to be less than or equal to 0x00FF."),E!==void 0&&E<=255&&(C[S++]=E)}}catch(D){m={error:D}}finally{try{_&&!_.done&&(y=T.return)&&y.call(T)}finally{if(m)throw m.error}}return C}function d(w){return/^[\u0000-\u007F]*$/.test(w)}function h(w){var m,y,x="";try{for(var C=o(w),S=C.next();!S.done;S=C.next()){var T=S.value,_=T.codePointAt(0);x+=_!==void 0&&_>=65&&_<=90?String.fromCodePoint(_+32):T}}catch(E){m={error:E}}finally{try{S&&!S.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return x}function g(w){return w.replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,"")}function p(w,m,y){if(!l.isArray(m))return p(w,Array.from(m),y);for(var x="";y.position<m.length&&w.call(null,m[y.position]);)x+=m[y.position],y.position++;return x}function v(w,m){p(function(y){return a.ASCIIWhiteSpace.test(y)},w,m)}n.isCodeUnitPrefix=f,n.isCodeUnitLessThan=function(w,m){if(f(m,w))return!1;if(f(w,m))return!0;for(var y=0;y<Math.min(w.length,m.length);y++){var x=w.charCodeAt(y),C=m.charCodeAt(y);if(x!==C)return x<C}return!1},n.isomorphicEncode=u,n.isASCIIString=d,n.asciiLowercase=h,n.asciiUppercase=function(w){var m,y,x="";try{for(var C=o(w),S=C.next();!S.done;S=C.next()){var T=S.value,_=T.codePointAt(0);x+=_!==void 0&&_>=97&&_<=122?String.fromCodePoint(_-32):T}}catch(E){m={error:E}}finally{try{S&&!S.done&&(y=C.return)&&y.call(C)}finally{if(m)throw m.error}}return x},n.asciiCaseInsensitiveMatch=function(w,m){return h(w)===h(m)},n.asciiEncode=function(w){return console.assert(d(w),"asciiEncode requires an ASCII string."),u(w)},n.asciiDecode=function(w){var m,y;try{for(var x=o(w),C=x.next();!C.done;C=x.next()){var S=C.value;console.assert(c.isASCIIByte(S),"asciiDecode requires an ASCII byte sequence.")}}catch(T){m={error:T}}finally{try{C&&!C.done&&(y=x.return)&&y.call(x)}finally{if(m)throw m.error}}return s.isomorphicDecode(w)},n.stripNewlines=function(w){return w.replace(/[\n\r]/g,"")},n.normalizeNewlines=function(w){return w.replace(/\r\n/g,`
`).replace(/\r/g,`
`)},n.stripLeadingAndTrailingASCIIWhitespace=g,n.stripAndCollapseASCIIWhitespace=function(w){return g(w.replace(/[\t\n\f\r ]{2,}/g," "))},n.collectASequenceOfCodePoints=p,n.skipASCIIWhitespace=v,n.strictlySplit=function w(m,y){if(!l.isArray(m))return w(Array.from(m),y);var x={position:0},C=[],S=p(function(T){return y!==T},m,x);for(C.push(S);x.position<m.length;)console.assert(m[x.position]===y,"strictlySplit found no delimiter in input string."),x.position++,S=p(function(T){return y!==T},m,x),C.push(S);return C},n.splitAStringOnASCIIWhitespace=function w(m){if(!l.isArray(m))return w(Array.from(m));var y={position:0},x=[];for(v(m,y);y.position<m.length;){var C=p(function(S){return!a.ASCIIWhiteSpace.test(S)},m,y);x.push(C),v(m,y)}return x},n.splitAStringOnCommas=function w(m){if(!l.isArray(m))return w(Array.from(m));for(var y={position:0},x=[];y.position<m.length;){var C=p(function(S){return S!==","},m,y);x.push(g(C)),y.position<m.length&&(console.assert(m[y.position]===",","splitAStringOnCommas found no delimiter in input string."),y.position++)}return x},n.concatenate=function(w,m){return m===void 0&&(m=""),w.length===0?"":w.join(m)}},function(r,n,i){var o=this&&this.__values||function(s){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&s[c],f=0;if(l)return l.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&f>=s.length&&(s=void 0),{value:s&&s[f++],done:!s}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(97);n.abort_add=function(s,c){c._abortedFlag||c._abortAlgorithms.add(s)},n.abort_remove=function(s,c){c._abortAlgorithms.delete(s)},n.abort_signalAbort=function(s){var c,l;if(!s._abortedFlag){s._abortedFlag=!0;try{for(var f=o(s._abortAlgorithms),u=f.next();!u.done;u=f.next())u.value.call(s)}catch(d){c={error:d}}finally{try{u&&!u.done&&(l=f.return)&&l.call(f)}finally{if(c)throw c.error}}s._abortAlgorithms.clear(),a.event_fireAnEvent("abort",s)}}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(150),a=function(){function s(){}return s.asNode=function(c){if(o.Guard.isNode(c))return c;throw new Error("Invalid object. Node expected.")},s}();n.Cast=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function s(){}return Object.defineProperty(s.prototype,"size",{get:function(){return 0},enumerable:!0,configurable:!0}),s.prototype.add=function(c){throw new Error("Cannot add to an empty set.")},s.prototype.clear=function(){},s.prototype.delete=function(c){return!1},s.prototype.forEach=function(c,l){},s.prototype.has=function(c){return!1},s.prototype[Symbol.iterator]=function(){return new a},s.prototype.entries=function(){return new a},s.prototype.keys=function(){return new a},s.prototype.values=function(){return new a},Object.defineProperty(s.prototype,Symbol.toStringTag,{get:function(){return"EmptySet"},enumerable:!0,configurable:!0}),s}();n.EmptySet=o;var a=function(){function s(){}return s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){return{done:!0,value:null}},s}()},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),function(o){o[o.SchemeStart=0]="SchemeStart",o[o.Scheme=1]="Scheme",o[o.NoScheme=2]="NoScheme",o[o.SpecialRelativeOrAuthority=3]="SpecialRelativeOrAuthority",o[o.PathOrAuthority=4]="PathOrAuthority",o[o.Relative=5]="Relative",o[o.RelativeSlash=6]="RelativeSlash",o[o.SpecialAuthoritySlashes=7]="SpecialAuthoritySlashes",o[o.SpecialAuthorityIgnoreSlashes=8]="SpecialAuthorityIgnoreSlashes",o[o.Authority=9]="Authority",o[o.Host=10]="Host",o[o.Hostname=11]="Hostname",o[o.Port=12]="Port",o[o.File=13]="File",o[o.FileSlash=14]="FileSlash",o[o.FileHost=15]="FileHost",o[o.PathStart=16]="PathStart",o[o.Path=17]="Path",o[o.CannotBeABaseURLPath=18]="CannotBeABaseURLPath",o[o.Query=19]="Query",o[o.Fragment=20]="Fragment"}(n.ParserState||(n.ParserState={})),n.OpaqueOrigin=["","",null,null]},function(r,n,i){var o=i(245),a=i(247);function s(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=C,n.resolve=function(S,T){return C(S,!1,!0).resolve(T)},n.resolveObject=function(S,T){return S?C(S,!1,!0).resolveObject(T):T},n.format=function(S){return a.isString(S)&&(S=C(S)),S instanceof s?S.format():s.prototype.format.call(S)},n.Url=s;var c=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),d=["'"].concat(u),h=["%","/","?",";","#"].concat(d),g=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,v=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,w={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=i(248);function C(S,T,_){if(S&&a.isObject(S)&&S instanceof s)return S;var E=new s;return E.parse(S,T,_),E}s.prototype.parse=function(S,T,_){if(!a.isString(S))throw new TypeError("Parameter 'url' must be a string, not "+typeof S);var E=S.indexOf("?"),D=E!==-1&&E<S.indexOf("#")?"?":"#",b=S.split(D);b[0]=b[0].replace(/\\/g,"/");var I=S=b.join(D);if(I=I.trim(),!_&&S.split("#").length===1){var R=f.exec(I);if(R)return this.path=I,this.href=I,this.pathname=R[1],R[2]?(this.search=R[2],this.query=T?x.parse(this.search.substr(1)):this.search.substr(1)):T&&(this.search="",this.query={}),this}var M=c.exec(I);if(M){var P=(M=M[0]).toLowerCase();this.protocol=P,I=I.substr(M.length)}if(_||M||I.match(/^\/\/[^@\/]+@[^@\/]+/)){var k=I.substr(0,2)==="//";!k||M&&m[M]||(I=I.substr(2),this.slashes=!0)}if(!m[M]&&(k||M&&!y[M])){for(var z,A,L=-1,N=0;N<g.length;N++)(H=I.indexOf(g[N]))!==-1&&(L===-1||H<L)&&(L=H);for((A=L===-1?I.lastIndexOf("@"):I.lastIndexOf("@",L))!==-1&&(z=I.slice(0,A),I=I.slice(A+1),this.auth=decodeURIComponent(z)),L=-1,N=0;N<h.length;N++){var H;(H=I.indexOf(h[N]))!==-1&&(L===-1||H<L)&&(L=H)}L===-1&&(L=I.length),this.host=I.slice(0,L),I=I.slice(L),this.parseHost(),this.hostname=this.hostname||"";var ee=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ee)for(var oe=this.hostname.split(/\./),de=(N=0,oe.length);N<de;N++){var ue=oe[N];if(ue&&!ue.match(p)){for(var me="",Ee=0,_e=ue.length;Ee<_e;Ee++)ue.charCodeAt(Ee)>127?me+="x":me+=ue[Ee];if(!me.match(p)){var Ce=oe.slice(0,N),F=oe.slice(N+1),O=ue.match(v);O&&(Ce.push(O[1]),F.unshift(O[2])),F.length&&(I="/"+F.join(".")+I),this.hostname=Ce.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ee||(this.hostname=o.toASCII(this.hostname));var $=this.port?":"+this.port:"",W=this.hostname||"";this.host=W+$,this.href+=this.host,ee&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!w[P])for(N=0,de=d.length;N<de;N++){var X=d[N];if(I.indexOf(X)!==-1){var Z=encodeURIComponent(X);Z===X&&(Z=escape(X)),I=I.split(X).join(Z)}}var ne=I.indexOf("#");ne!==-1&&(this.hash=I.substr(ne),I=I.slice(0,ne));var xe=I.indexOf("?");if(xe!==-1?(this.search=I.substr(xe),this.query=I.substr(xe+1),T&&(this.query=x.parse(this.query)),I=I.slice(0,xe)):T&&(this.search="",this.query={}),I&&(this.pathname=I),y[P]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){$=this.pathname||"";var Ie=this.search||"";this.path=$+Ie}return this.href=this.format(),this},s.prototype.format=function(){var S=this.auth||"";S&&(S=(S=encodeURIComponent(S)).replace(/%3A/i,":"),S+="@");var T=this.protocol||"",_=this.pathname||"",E=this.hash||"",D=!1,b="";this.host?D=S+this.host:this.hostname&&(D=S+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(D+=":"+this.port)),this.query&&a.isObject(this.query)&&Object.keys(this.query).length&&(b=x.stringify(this.query));var I=this.search||b&&"?"+b||"";return T&&T.substr(-1)!==":"&&(T+=":"),this.slashes||(!T||y[T])&&D!==!1?(D="//"+(D||""),_&&_.charAt(0)!=="/"&&(_="/"+_)):D||(D=""),E&&E.charAt(0)!=="#"&&(E="#"+E),I&&I.charAt(0)!=="?"&&(I="?"+I),T+D+(_=_.replace(/[?#]/g,function(R){return encodeURIComponent(R)}))+(I=I.replace("#","%23"))+E},s.prototype.resolve=function(S){return this.resolveObject(C(S,!1,!0)).format()},s.prototype.resolveObject=function(S){if(a.isString(S)){var T=new s;T.parse(S,!1,!0),S=T}for(var _=new s,E=Object.keys(this),D=0;D<E.length;D++){var b=E[D];_[b]=this[b]}if(_.hash=S.hash,S.href==="")return _.href=_.format(),_;if(S.slashes&&!S.protocol){for(var I=Object.keys(S),R=0;R<I.length;R++){var M=I[R];M!=="protocol"&&(_[M]=S[M])}return y[_.protocol]&&_.hostname&&!_.pathname&&(_.path=_.pathname="/"),_.href=_.format(),_}if(S.protocol&&S.protocol!==_.protocol){if(!y[S.protocol]){for(var P=Object.keys(S),k=0;k<P.length;k++){var z=P[k];_[z]=S[z]}return _.href=_.format(),_}if(_.protocol=S.protocol,S.host||m[S.protocol])_.pathname=S.pathname;else{for(var A=(S.pathname||"").split("/");A.length&&!(S.host=A.shift()););S.host||(S.host=""),S.hostname||(S.hostname=""),A[0]!==""&&A.unshift(""),A.length<2&&A.unshift(""),_.pathname=A.join("/")}if(_.search=S.search,_.query=S.query,_.host=S.host||"",_.auth=S.auth,_.hostname=S.hostname||S.host,_.port=S.port,_.pathname||_.search){var L=_.pathname||"",N=_.search||"";_.path=L+N}return _.slashes=_.slashes||S.slashes,_.href=_.format(),_}var H=_.pathname&&_.pathname.charAt(0)==="/",ee=S.host||S.pathname&&S.pathname.charAt(0)==="/",oe=ee||H||_.host&&S.pathname,de=oe,ue=_.pathname&&_.pathname.split("/")||[],me=(A=S.pathname&&S.pathname.split("/")||[],_.protocol&&!y[_.protocol]);if(me&&(_.hostname="",_.port=null,_.host&&(ue[0]===""?ue[0]=_.host:ue.unshift(_.host)),_.host="",S.protocol&&(S.hostname=null,S.port=null,S.host&&(A[0]===""?A[0]=S.host:A.unshift(S.host)),S.host=null),oe=oe&&(A[0]===""||ue[0]==="")),ee)_.host=S.host||S.host===""?S.host:_.host,_.hostname=S.hostname||S.hostname===""?S.hostname:_.hostname,_.search=S.search,_.query=S.query,ue=A;else if(A.length)ue||(ue=[]),ue.pop(),ue=ue.concat(A),_.search=S.search,_.query=S.query;else if(!a.isNullOrUndefined(S.search))return me&&(_.hostname=_.host=ue.shift(),(O=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=O.shift(),_.host=_.hostname=O.shift())),_.search=S.search,_.query=S.query,a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.href=_.format(),_;if(!ue.length)return _.pathname=null,_.search?_.path="/"+_.search:_.path=null,_.href=_.format(),_;for(var Ee=ue.slice(-1)[0],_e=(_.host||S.host||ue.length>1)&&(Ee==="."||Ee==="..")||Ee==="",Ce=0,F=ue.length;F>=0;F--)(Ee=ue[F])==="."?ue.splice(F,1):Ee===".."?(ue.splice(F,1),Ce++):Ce&&(ue.splice(F,1),Ce--);if(!oe&&!de)for(;Ce--;Ce)ue.unshift("..");!oe||ue[0]===""||ue[0]&&ue[0].charAt(0)==="/"||ue.unshift(""),_e&&ue.join("/").substr(-1)!=="/"&&ue.push("");var O,$=ue[0]===""||ue[0]&&ue[0].charAt(0)==="/";return me&&(_.hostname=_.host=$?"":ue.length?ue.shift():"",(O=!!(_.host&&_.host.indexOf("@")>0)&&_.host.split("@"))&&(_.auth=O.shift(),_.host=_.hostname=O.shift())),(oe=oe||_.host&&ue.length)&&!$&&ue.unshift(""),ue.length?_.pathname=ue.join("/"):(_.pathname=null,_.path=null),a.isNull(_.pathname)&&a.isNull(_.search)||(_.path=(_.pathname?_.pathname:"")+(_.search?_.search:"")),_.auth=S.auth||_.auth,_.slashes=_.slashes||S.slashes,_.href=_.format(),_},s.prototype.parseHost=function(){var S=this.host,T=l.exec(S);T&&((T=T[0])!==":"&&(this.port=T.substr(1)),S=S.substr(0,S.length-T.length)),S&&(this.hostname=S)}},function(r,n,i){(function(o,a){var s;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(c){n&&n.nodeType,o&&o.nodeType;var l=typeof a=="object"&&a;l.global!==l&&l.window!==l&&l.self;var f,u=2147483647,d=/^xn--/,h=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,w=String.fromCharCode;function m(b){throw new RangeError(p[b])}function y(b,I){for(var R=b.length,M=[];R--;)M[R]=I(b[R]);return M}function x(b,I){var R=b.split("@"),M="";return R.length>1&&(M=R[0]+"@",b=R[1]),M+y((b=b.replace(g,".")).split("."),I).join(".")}function C(b){for(var I,R,M=[],P=0,k=b.length;P<k;)(I=b.charCodeAt(P++))>=55296&&I<=56319&&P<k?(64512&(R=b.charCodeAt(P++)))==56320?M.push(((1023&I)<<10)+(1023&R)+65536):(M.push(I),P--):M.push(I);return M}function S(b){return y(b,function(I){var R="";return I>65535&&(R+=w((I-=65536)>>>10&1023|55296),I=56320|1023&I),R+=w(I)}).join("")}function T(b,I){return b+22+75*(b<26)-((I!=0)<<5)}function _(b,I,R){var M=0;for(b=R?v(b/700):b>>1,b+=v(b/I);b>455;M+=36)b=v(b/35);return v(M+36*b/(b+38))}function E(b){var I,R,M,P,k,z,A,L,N,H,ee,oe=[],de=b.length,ue=0,me=128,Ee=72;for((R=b.lastIndexOf("-"))<0&&(R=0),M=0;M<R;++M)b.charCodeAt(M)>=128&&m("not-basic"),oe.push(b.charCodeAt(M));for(P=R>0?R+1:0;P<de;){for(k=ue,z=1,A=36;P>=de&&m("invalid-input"),((L=(ee=b.charCodeAt(P++))-48<10?ee-22:ee-65<26?ee-65:ee-97<26?ee-97:36)>=36||L>v((u-ue)/z))&&m("overflow"),ue+=L*z,!(L<(N=A<=Ee?1:A>=Ee+26?26:A-Ee));A+=36)z>v(u/(H=36-N))&&m("overflow"),z*=H;Ee=_(ue-k,I=oe.length+1,k==0),v(ue/I)>u-me&&m("overflow"),me+=v(ue/I),ue%=I,oe.splice(ue++,0,me)}return S(oe)}function D(b){var I,R,M,P,k,z,A,L,N,H,ee,oe,de,ue,me,Ee=[];for(oe=(b=C(b)).length,I=128,R=0,k=72,z=0;z<oe;++z)(ee=b[z])<128&&Ee.push(w(ee));for(M=P=Ee.length,P&&Ee.push("-");M<oe;){for(A=u,z=0;z<oe;++z)(ee=b[z])>=I&&ee<A&&(A=ee);for(A-I>v((u-R)/(de=M+1))&&m("overflow"),R+=(A-I)*de,I=A,z=0;z<oe;++z)if((ee=b[z])<I&&++R>u&&m("overflow"),ee==I){for(L=R,N=36;!(L<(H=N<=k?1:N>=k+26?26:N-k));N+=36)me=L-H,ue=36-H,Ee.push(w(T(H+me%ue,0))),L=v(me/ue);Ee.push(w(T(L,0))),k=_(R,de,M==P),R=0,++M}++R,++I}return Ee.join("")}f={version:"1.4.1",ucs2:{decode:C,encode:S},decode:E,encode:D,toASCII:function(b){return x(b,function(I){return h.test(I)?"xn--"+D(I):I})},toUnicode:function(b){return x(b,function(I){return d.test(I)?E(I.slice(4).toLowerCase()):I})}},(s=(function(){return f}).call(n,i,n,o))===void 0||(o.exports=s)})()}).call(this,i(246)(r),i(78))},function(r,n){r.exports=function(i){return i.webpackPolyfill||(i.deprecate=function(){},i.paths=[],i.children||(i.children=[]),Object.defineProperty(i,"loaded",{enumerable:!0,get:function(){return i.l}}),Object.defineProperty(i,"id",{enumerable:!0,get:function(){return i.i}}),i.webpackPolyfill=1),i}},function(r,n,i){r.exports={isString:function(o){return typeof o=="string"},isObject:function(o){return typeof o=="object"&&o!==null},isNull:function(o){return o===null},isNullOrUndefined:function(o){return o==null}}},function(r,n,i){n.decode=n.parse=i(249),n.encode=n.stringify=i(250)},function(r,n,i){function o(s,c){return Object.prototype.hasOwnProperty.call(s,c)}r.exports=function(s,c,l,f){c=c||"&",l=l||"=";var u={};if(typeof s!="string"||s.length===0)return u;var d=/\+/g;s=s.split(c);var h=1e3;f&&typeof f.maxKeys=="number"&&(h=f.maxKeys);var g=s.length;h>0&&g>h&&(g=h);for(var p=0;p<g;++p){var v,w,m,y,x=s[p].replace(d,"%20"),C=x.indexOf(l);C>=0?(v=x.substr(0,C),w=x.substr(C+1)):(v=x,w=""),m=decodeURIComponent(v),y=decodeURIComponent(w),o(u,m)?a(u[m])?u[m].push(y):u[m]=[u[m],y]:u[m]=y}return u};var a=Array.isArray||function(s){return Object.prototype.toString.call(s)==="[object Array]"}},function(r,n,i){var o=function(l){switch(typeof l){case"string":return l;case"boolean":return l?"true":"false";case"number":return isFinite(l)?l:"";default:return""}};r.exports=function(l,f,u,d){return f=f||"&",u=u||"=",l===null&&(l=void 0),typeof l=="object"?s(c(l),function(h){var g=encodeURIComponent(o(h))+u;return a(l[h])?s(l[h],function(p){return g+encodeURIComponent(o(p))}).join(f):g+encodeURIComponent(o(l[h]))}).join(f):d?encodeURIComponent(o(d))+u+encodeURIComponent(o(l)):""};var a=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"};function s(l,f){if(l.map)return l.map(f);for(var u=[],d=0;d<l.length;d++)u.push(f(l[d],d));return u}var c=Object.keys||function(l){var f=[];for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&f.push(u);return f}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(52);n.attr_setAnExistingAttributeValue=function(a,s){a._element===null?a._value=s:o.element_change(a,a._element,s)}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(108),a=i(30),s=i(52);n.tokenList_validationSteps=function(c,l){if(!a.dom_hasSupportedTokens(c._attribute._localName))throw new TypeError("There are no supported tokens defined for attribute name: '"+c._attribute._localName+"'.");return a.dom_getSupportedTokens(c._attribute._localName).has(l.toLowerCase())},n.tokenList_updateSteps=function(c){(c._element.hasAttribute(c._attribute._localName)||c._tokenSet.size!==0)&&s.element_setAnAttributeValue(c._element,c._attribute._localName,o.orderedSet_serialize(c._tokenSet))},n.tokenList_serializeSteps=function(c){return s.element_getAnAttributeValue(c._element,c._attribute._localName)}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1);function s(c){return a.isBoolean(c)?c:c.capture||!1}n.eventTarget_flatten=s,n.eventTarget_flattenMore=function(c){var l=s(c),f=!1,u=!1;return a.isBoolean(c)||(f=c.once||!1,u=c.passive||!1),[l,u,f]},n.eventTarget_addEventListener=function(c,l){if(l.callback!==null){for(var f=0;f<c._eventListenerList.length;f++){var u=c._eventListenerList[f];if(u.type===l.type&&u.callback.handleEvent===l.callback.handleEvent&&u.capture===l.capture)return}c._eventListenerList.push(l)}},n.eventTarget_removeEventListener=function(c,l,f){l.removed=!0,c._eventListenerList.splice(f,1)},n.eventTarget_removeAllEventListeners=function(c){var l,f;try{for(var u=o(c._eventListenerList),d=u.next();!d.done;d=u.next())d.value.removed=!0}catch(h){l={error:h}}finally{try{d&&!d.done&&(f=u.return)&&f.call(u)}finally{if(l)throw l.error}}c._eventListenerList.length=0}},function(r,n,i){var o=this&&this.__values||function(c){var l=typeof Symbol=="function"&&Symbol.iterator,f=l&&c[l],u=0;if(f)return f.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&u>=c.length&&(c=void 0),{value:c&&c[u++],done:!c}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(1),s=i(29);n.parentNode_convertNodesIntoANode=function(c,l){for(var f,u,d=null,h=0;h<c.length;h++){var g=c[h];if(a.isString(g)){var p=s.create_text(l,g);c[h]=p}}if(c.length===1)d=c[0];else{var v=d=s.create_documentFragment(l);try{for(var w=o(c),m=w.next();!m.done;m=w.next())g=m.value,v.appendChild(g)}catch(y){f={error:y}}finally{try{m&&!m.done&&(u=w.return)&&u.call(w)}finally{if(f)throw f.error}}}return d}},function(r,n,i){var o=this&&this.__values||function(T){var _=typeof Symbol=="function"&&Symbol.iterator,E=_&&T[_],D=0;if(E)return E.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&D>=T.length&&(T=void 0),{value:T&&T[D++],done:!T}}};throw new TypeError(_?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(T,_){var E=typeof Symbol=="function"&&T[Symbol.iterator];if(!E)return T;var D,b,I=E.call(T),R=[];try{for(;(_===void 0||_-- >0)&&!(D=I.next()).done;)R.push(D.value)}catch(M){b={error:M}}finally{try{D&&!D.done&&(E=I.return)&&E.call(I)}finally{if(b)throw b.error}}return R},s=this&&this.__spread||function(){for(var T=[],_=0;_<arguments.length;_++)T=T.concat(a(arguments[_]));return T};Object.defineProperty(n,"__esModule",{value:!0});var c=i(2),l=i(9),f=i(3),u=i(29),d=i(17),h=i(175),g=i(107),p=i(176),v=i(37),w=i(177);function m(T){return T._startNode===T._endNode&&T._startOffset===T._endOffset}function y(T){return d.tree_rootNode(T._startNode)}function x(T,_){return d.tree_rootNode(T)===y(_)&&h.boundaryPoint_position([T,0],_._start)===c.BoundaryPosition.After&&h.boundaryPoint_position([T,d.tree_nodeLength(T)],_._end)===c.BoundaryPosition.Before}function C(T,_){var E=d.tree_isAncestorOf(_._startNode,T,!0),D=d.tree_isAncestorOf(_._endNode,T,!0);return E&&!D||!E&&D}function S(T){var _,E,D,b,I,R,M=u.create_documentFragment(T._startNode._nodeDocument);if(m(T))return M;var P=T._startNode,k=T._startOffset,z=T._endNode,A=T._endOffset;if(P===z&&f.Guard.isCharacterDataNode(P))return(W=p.node_clone(P))._data=g.characterData_substringData(P,k,A-k),v.mutation_append(W,M),g.characterData_replaceData(P,k,A-k,""),M;for(var L=P;!d.tree_isAncestorOf(z,L,!0);){if(L._parent===null)throw new Error("Parent node  is null.");L=L._parent}var N=null;if(!d.tree_isAncestorOf(z,P,!0))try{for(var H=o(L._children),ee=H.next();!ee.done;ee=H.next())if(C(me=ee.value,T)){N=me;break}}catch(Ie){_={error:Ie}}finally{try{ee&&!ee.done&&(E=H.return)&&E.call(H)}finally{if(_)throw _.error}}var oe=null;if(!d.tree_isAncestorOf(P,z,!0))for(var de=s(L._children),ue=de.length-1;ue>0;ue--){var me;if(C(me=de[ue],T)){oe=me;break}}var Ee,_e,Ce=[];try{for(var F=o(L._children),O=F.next();!O.done;O=F.next())if(x(xe=O.value,T)){if(f.Guard.isDocumentTypeNode(xe))throw new l.HierarchyRequestError;Ce.push(xe)}}catch(Ie){D={error:Ie}}finally{try{O&&!O.done&&(b=F.return)&&b.call(F)}finally{if(D)throw D.error}}if(d.tree_isAncestorOf(z,P,!0))Ee=P,_e=k;else{for(var $=P;$._parent!==null&&!d.tree_isAncestorOf(z,$._parent);)$=$._parent;if($._parent===null)throw new Error("Parent node is null.");Ee=$._parent,_e=1+d.tree_index($)}if(f.Guard.isCharacterDataNode(N))(W=p.node_clone(P))._data=g.characterData_substringData(P,k,d.tree_nodeLength(P)-k),v.mutation_append(W,M),g.characterData_replaceData(P,k,d.tree_nodeLength(P)-k,"");else if(N!==null){var W=p.node_clone(N);v.mutation_append(W,M);var X=S(u.create_range([P,k],[N,d.tree_nodeLength(N)]));v.mutation_append(X,W)}try{for(var Z=o(Ce),ne=Z.next();!ne.done;ne=Z.next()){var xe=ne.value;v.mutation_append(xe,M)}}catch(Ie){I={error:Ie}}finally{try{ne&&!ne.done&&(R=Z.return)&&R.call(Z)}finally{if(I)throw I.error}}return f.Guard.isCharacterDataNode(oe)?((W=p.node_clone(z))._data=g.characterData_substringData(z,0,A),v.mutation_append(W,M),g.characterData_replaceData(z,0,A,"")):oe!==null&&(W=p.node_clone(oe),v.mutation_append(W,M),X=S(u.create_range([oe,0],[z,A])),v.mutation_append(X,W)),T._start=[Ee,_e],T._end=[Ee,_e],M}n.range_collapsed=m,n.range_root=y,n.range_isContained=x,n.range_isPartiallyContained=C,n.range_setTheStart=function(T,_,E){if(f.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>d.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(T)===d.tree_rootNode(_)&&h.boundaryPoint_position(D,T._end)!==c.BoundaryPosition.After||(T._end=D),T._start=D},n.range_setTheEnd=function(T,_,E){if(f.Guard.isDocumentTypeNode(_))throw new l.InvalidNodeTypeError;if(E>d.tree_nodeLength(_))throw new l.IndexSizeError;var D=[_,E];y(T)===d.tree_rootNode(_)&&h.boundaryPoint_position(D,T._start)!==c.BoundaryPosition.Before||(T._start=D),T._end=D},n.range_select=function(T,_){var E=T._parent;if(E===null)throw new l.InvalidNodeTypeError;var D=d.tree_index(T);_._start=[E,D],_._end=[E,D+1]},n.range_extract=S,n.range_cloneTheContents=function T(_){var E,D,b,I,R,M,P=u.create_documentFragment(_._startNode._nodeDocument);if(m(_))return P;var k=_._startNode,z=_._startOffset,A=_._endNode,L=_._endOffset;k===A&&f.Guard.isCharacterDataNode(k)&&((O=p.node_clone(k))._data=g.characterData_substringData(k,z,L-z),v.mutation_append(O,P));for(var N=k;!d.tree_isAncestorOf(A,N,!0);){if(N._parent===null)throw new Error("Parent node  is null.");N=N._parent}var H=null;if(!d.tree_isAncestorOf(A,k,!0))try{for(var ee=o(N._children),oe=ee.next();!oe.done;oe=ee.next())if(C(Ee=oe.value,_)){H=Ee;break}}catch(ne){E={error:ne}}finally{try{oe&&!oe.done&&(D=ee.return)&&D.call(ee)}finally{if(E)throw E.error}}var de=null;if(!d.tree_isAncestorOf(k,A,!0))for(var ue=s(N._children),me=ue.length-1;me>0;me--){var Ee;if(C(Ee=ue[me],_)){de=Ee;break}}var _e=[];try{for(var Ce=o(N._children),F=Ce.next();!F.done;F=Ce.next())if(x(Z=F.value,_)){if(f.Guard.isDocumentTypeNode(Z))throw new l.HierarchyRequestError;_e.push(Z)}}catch(ne){b={error:ne}}finally{try{F&&!F.done&&(I=Ce.return)&&I.call(Ce)}finally{if(b)throw b.error}}if(f.Guard.isCharacterDataNode(H))(O=p.node_clone(k))._data=g.characterData_substringData(k,z,d.tree_nodeLength(k)-z),v.mutation_append(O,P);else if(H!==null){var O=p.node_clone(H);v.mutation_append(O,P);var $=T(u.create_range([k,z],[H,d.tree_nodeLength(H)]));v.mutation_append($,O)}try{for(var W=o(_e),X=W.next();!X.done;X=W.next()){var Z=X.value,O=p.node_clone(Z);v.mutation_append(O,P)}}catch(ne){R={error:ne}}finally{try{X&&!X.done&&(M=W.return)&&M.call(W)}finally{if(R)throw R.error}}return f.Guard.isCharacterDataNode(de)?((O=p.node_clone(A))._data=g.characterData_substringData(A,0,L),v.mutation_append(O,P)):de!==null&&(O=p.node_clone(de),P.append(O),$=S(u.create_range([de,0],[A,L])),v.mutation_append($,O)),P},n.range_insert=function(T,_){var E,D;if(f.Guard.isProcessingInstructionNode(_._startNode)||f.Guard.isCommentNode(_._startNode)||f.Guard.isTextNode(_._startNode)&&_._startNode._parent===null||_._startNode===T)throw new l.HierarchyRequestError;var b,I=null;if(f.Guard.isTextNode(_._startNode))I=_._startNode;else{var R=0;try{for(var M=o(_._startNode._children),P=M.next();!P.done;P=M.next()){var k=P.value;if(R===_._startOffset){I=k;break}R++}}catch(A){E={error:A}}finally{try{P&&!P.done&&(D=M.return)&&D.call(M)}finally{if(E)throw E.error}}}if(I===null)b=_._startNode;else{if(I._parent===null)throw new Error("Parent node is null.");b=I._parent}v.mutation_ensurePreInsertionValidity(T,b,I),f.Guard.isTextNode(_._startNode)&&(I=w.text_split(_._startNode,_._startOffset)),T===I&&(I=T._nextSibling),T._parent!==null&&v.mutation_remove(T,T._parent);var z=I===null?d.tree_nodeLength(b):d.tree_index(I);f.Guard.isDocumentFragmentNode(T)?z+=d.tree_nodeLength(T):z++,v.mutation_preInsert(T,b,I),m(_)&&(_._end=[b,z])},n.range_getContainedNodes=function(T){var _;return(_={})[Symbol.iterator]=function(){var E=T.commonAncestorContainer,D=d.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!x(D,T);)D=d.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=d.tree_getNextDescendantNode(E,D),b}}},_},n.range_getPartiallyContainedNodes=function(T){var _;return(_={})[Symbol.iterator]=function(){var E=T.commonAncestorContainer,D=d.tree_getFirstDescendantNode(E);return{next:function(){for(;D&&!C(D,T);)D=d.tree_getNextDescendantNode(E,D);if(D===null)return{done:!0,value:null};var b={done:!1,value:D};return D=d.tree_getNextDescendantNode(E,D),b}}},_}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(9);n.selectors_scopeMatchASelectorsString=function(a,s){throw new o.NotSupportedError}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(2),a=i(105);n.treeWalker_traverseChildren=function(s,c){for(var l=c?s._current._firstChild:s._current._lastChild;l!==null;){var f=a.traversal_filter(s,l);if(f===o.FilterResult.Accept)return s._current=l,l;if(f===o.FilterResult.Skip){var u=c?l._firstChild:l._lastChild;if(u!==null){l=u;continue}}for(;l!==null;){var d=c?l._nextSibling:l._previousSibling;if(d!==null){l=d;break}var h=l._parent;if(h===null||h===s._root||h===s._current)return null;l=h}}return null},n.treeWalker_traverseSiblings=function(s,c){var l=s._current;if(l===s._root)return null;for(;;){for(var f=c?l._nextSibling:l._previousSibling;f!==null;){l=f;var u=a.traversal_filter(s,l);if(u===o.FilterResult.Accept)return s._current=l,l;f=c?l._firstChild:l._lastChild,u!==o.FilterResult.Reject&&f!==null||(f=c?l._nextSibling:l._previousSibling)}if((l=l._parent)===null||l===s._root||a.traversal_filter(s,l)===o.FilterResult.Accept)return null}}},function(r,n,i){i(89),i(74);var o,a=this&&this.__extends||(o=function(d,h){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,p){g.__proto__=p}||function(g,p){for(var v in p)p.hasOwnProperty(v)&&(g[v]=p[v])})(d,h)},function(d,h){function g(){this.constructor=d}o(d,h),d.prototype=h===null?Object.create(h):(g.prototype=h.prototype,new g)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(1),c=i(2),l=i(50),f=i(3),u=function(d){function h(g,p){var v=d.call(this,g)||this;return v._indentation={},v._lengthToLastNewline=0,v._writerOptions=s.applyDefaults(p,{wellFormed:!1,headless:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,width:0,allowEmptyTags:!1,indentTextOnlyNodes:!1,spaceBeforeSlash:!1}),v}return a(h,d),h.prototype.serialize=function(g){return this._refs={suppressPretty:!1,emptyNode:!1,markup:""},g.nodeType!==c.NodeType.Document||this._writerOptions.headless||this.declaration(this._builderOptions.version,this._builderOptions.encoding,this._builderOptions.standalone),this.serializeNode(g,this._writerOptions.wellFormed),this._writerOptions.prettyPrint&&this._refs.markup.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(this._refs.markup=this._refs.markup.slice(0,-this._writerOptions.newline.length)),this._refs.markup},h.prototype.declaration=function(g,p,v){this._beginLine(),this._refs.markup+='<?xml version="'+g+'"',p!==void 0&&(this._refs.markup+=' encoding="'+p+'"'),v!==void 0&&(this._refs.markup+=' standalone="'+(v?"yes":"no")+'"'),this._refs.markup+="?>",this._endLine()},h.prototype.docType=function(g,p,v){this._beginLine(),this._refs.markup+=p&&v?"<!DOCTYPE "+g+' PUBLIC "'+p+'" "'+v+'">':p?"<!DOCTYPE "+g+' PUBLIC "'+p+'">':v?"<!DOCTYPE "+g+' SYSTEM "'+v+'">':"<!DOCTYPE "+g+">",this._endLine()},h.prototype.openTagBegin=function(g){this._beginLine(),this._refs.markup+="<"+g},h.prototype.openTagEnd=function(g,p,v){if(this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._writerOptions.prettyPrint&&!p&&!v){for(var w=!0,m=!0,y=this.currentNode.firstChild,x=0,C=0;y;){if(f.Guard.isExclusiveTextNode(y))C++;else{if(!f.Guard.isCDATASectionNode(y)){w=!1,m=!1;break}x++}y.data!==""&&(m=!1),y=y.nextSibling}this._refs.suppressPretty=!this._writerOptions.indentTextOnlyNodes&&w&&(x<=1&&C===0||x===0),this._refs.emptyNode=m}(v||p||this._refs.emptyNode)&&this._writerOptions.allowEmptyTags?this._refs.markup+="></"+g+">":this._refs.markup+=v?" />":p||this._refs.emptyNode?this._writerOptions.spaceBeforeSlash?" />":"/>":">",this._endLine()},h.prototype.closeTag=function(g){this._refs.emptyNode||(this._beginLine(),this._refs.markup+="</"+g+">"),this._refs.suppressPretty=!1,this._refs.emptyNode=!1,this._endLine()},h.prototype.attribute=function(g,p){var v=g+'="'+p+'"';this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._refs.markup.length-this._lengthToLastNewline+1+v.length>this._writerOptions.width?(this._endLine(),this._beginLine(),this._refs.markup+=this._indent(1)+v):this._refs.markup+=" "+v},h.prototype.text=function(g){g!==""&&(this._beginLine(),this._refs.markup+=g,this._endLine())},h.prototype.cdata=function(g){g!==""&&(this._beginLine(),this._refs.markup+="<![CDATA["+g+"]]>",this._endLine())},h.prototype.comment=function(g){this._beginLine(),this._refs.markup+="<!--"+g+"-->",this._endLine()},h.prototype.instruction=function(g,p){this._beginLine(),this._refs.markup+="<?"+(p===""?g:g+" "+p)+"?>",this._endLine()},h.prototype._beginLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._indent(this._writerOptions.offset+this.level))},h.prototype._endLine=function(){this._writerOptions.prettyPrint&&!this._refs.suppressPretty&&(this._refs.markup+=this._writerOptions.newline,this._lengthToLastNewline=this._refs.markup.length)},h.prototype._indent=function(g){if(g<=0)return"";if(this._indentation[g]!==void 0)return this._indentation[g];var p=this._writerOptions.indent.repeat(g);return this._indentation[g]=p,p},h}(l.BaseWriter);n.XMLWriter=u},function(r,n,i){var o=i(47),a=i(35);r.exports="".repeat||function(s){var c=String(a(this)),l="",f=o(s);if(f<0||f==1/0)throw RangeError("Wrong number of repetitions");for(;f>0;(f>>>=1)&&(c+=c))1&f&&(l+=c);return l}},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),f=function(u){function d(h,g){var p=u.call(this,h)||this;return p._writerOptions=l.applyDefaults(g,{wellFormed:!1,prettyPrint:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p}return a(d,u),d.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h);return this._beginLine(this._writerOptions,0)+this._convertObject(p,this._writerOptions)},d.prototype._convertObject=function(h,g,p){var v,w,m=this;p===void 0&&(p=0);var y="",x=this._isLeafNode(h);if(l.isArray(h)){y+="[";var C=h.length,S=0;try{for(var T=s(h),_=T.next();!_.done;_=T.next()){var E=_.value;y+=this._endLine(g,p+1)+this._beginLine(g,p+1)+this._convertObject(E,g,p+1),S<C-1&&(y+=","),S++}}catch(I){v={error:I}}finally{try{_&&!_.done&&(w=T.return)&&w.call(T)}finally{if(v)throw v.error}}y+=this._endLine(g,p)+this._beginLine(g,p),y+="]"}else if(l.isObject(h)){y+="{";var D=l.objectLength(h),b=0;l.forEachObject(h,function(I,R){x&&g.prettyPrint?y+=" ":y+=m._endLine(g,p+1)+m._beginLine(g,p+1),y+=m._key(I),g.prettyPrint&&(y+=" "),y+=m._convertObject(R,g,p+1),b<D-1&&(y+=","),b++},this),x&&g.prettyPrint?y+=" ":y+=this._endLine(g,p)+this._beginLine(g,p),y+="}"}else y+=this._val(h);return y},d.prototype._beginLine=function(h,g){if(!h.prettyPrint)return"";var p=h.offset+g+1;return p>0?new Array(p).join(h.indent):""},d.prototype._endLine=function(h,g){return h.prettyPrint?h.newline:""},d.prototype._key=function(h){return'"'+h+'":'},d.prototype._val=function(h){return JSON.stringify(h)},d.prototype._isLeafNode=function(h){return this._descendantCount(h)<=1},d.prototype._descendantCount=function(h,g){var p=this;return g===void 0&&(g=0),l.isArray(h)?l.forEachArray(h,function(v){return g+=p._descendantCount(v,g)},this):l.isObject(h)?l.forEachObject(h,function(v,w){return g+=p._descendantCount(w,g)},this):g++,g},d}(i(50).BaseWriter);n.JSONWriter=f},function(r,n,i){i(31),i(32),i(33),i(19),i(178),i(89),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}),s=this&&this.__values||function(u){var d=typeof Symbol=="function"&&Symbol.iterator,h=d&&u[d],g=0;if(h)return h.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&g>=u.length&&(u=void 0),{value:u&&u[g++],done:!u}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var c=i(67),l=i(1),f=function(u){function d(h,g){var p=u.call(this,h)||this;if(p._writerOptions=l.applyDefaults(g,{wellFormed:!1,indent:"  ",newline:`
`,offset:0,group:!1,verbose:!1}),p._writerOptions.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(p._writerOptions.offset<0)throw new Error("YAML offset should be zero or a positive number.");return p}return a(d,u),d.prototype.serialize=function(h){var g=l.applyDefaults(this._writerOptions,{format:"object",wellFormed:!1}),p=new c.ObjectWriter(this._builderOptions,g).serialize(h),v=this._beginLine(this._writerOptions,0)+"---"+this._endLine(this._writerOptions)+this._convertObject(p,this._writerOptions,0);return v.slice(-this._writerOptions.newline.length)===this._writerOptions.newline&&(v=v.slice(0,-this._writerOptions.newline.length)),v},d.prototype._convertObject=function(h,g,p,v){var w,m,y=this;v===void 0&&(v=!1);var x="";if(l.isArray(h))try{for(var C=s(h),S=C.next();!S.done;S=C.next()){var T=S.value;x+=this._beginLine(g,p,!0),l.isObject(T)?l.isEmpty(T)?x+='""'+this._endLine(g):x+=this._convertObject(T,g,p,!0):x+=this._val(T)+this._endLine(g)}}catch(_){w={error:_}}finally{try{S&&!S.done&&(m=C.return)&&m.call(C)}finally{if(w)throw w.error}}else l.forEachObject(h,function(_,E){v?(x+=y._key(_),v=!1):x+=y._beginLine(g,p)+y._key(_),l.isObject(E)?l.isEmpty(E)?x+=' ""'+y._endLine(g):x+=y._endLine(g)+y._convertObject(E,g,p+1):x+=" "+y._val(E)+y._endLine(g)},this);return x},d.prototype._beginLine=function(h,g,p){p===void 0&&(p=!1);var v=h.offset+g+1,w=new Array(v).join(h.indent);return p?w.substr(0,w.length-2)+"-"+w.substr(-1,1):w},d.prototype._endLine=function(h){return h.newline},d.prototype._key=function(h){return'"'+h+'":'},d.prototype._val=function(h){return JSON.stringify(h)},d}(i(50).BaseWriter);n.YAMLWriter=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0}),i(110).dom.setFeatures(!0);var o=i(110);n.DOMImplementation=o.DOMImplementation;var a=i(271);n.DOMParser=a.DOMParser;var s=i(274);n.XMLSerializer=s.XMLSerializer},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=function(){function c(){}return c.prototype.before=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d!==null){for(var h=u._previousSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._previousSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);h=h===null?d._firstChild:h._nextSibling,a.mutation_preInsert(w,d,h)}},c.prototype.after=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);a.mutation_preInsert(w,d,h)}},c.prototype.replaceWith=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];var u=o.Cast.asNode(this),d=u._parent;if(d){for(var h=u._nextSibling,g=!0;g&&h;){g=!1;for(var p=0;p<l.length;p++){var v=l[p];if(v===h){h=h._nextSibling,g=!0;break}}}var w=a.parentNode_convertNodesIntoANode(l,u._nodeDocument);u._parent===d?a.mutation_replace(u,w,d):a.mutation_preInsert(w,d,h)}},c.prototype.remove=function(){var l=o.Cast.asNode(this),f=l._parent;f&&a.mutation_remove(l,f)},c}();n.ChildNodeImpl=s},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=function(){};n.DocumentOrShadowRootImpl=o},function(r,n,i){var o=this&&this.__values||function(f){var u=typeof Symbol=="function"&&Symbol.iterator,d=u&&f[u],h=0;if(d)return d.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&h>=f.length&&(f=void 0),{value:f&&f[h++],done:!f}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(6),s=i(3),c=i(7),l=function(){function f(u){this._nodeList=[],this._recordQueue=[],this._callback=u;var d=a.dom.window;c.set.append(d._mutationObservers,this)}return f.prototype.observe=function(u,d){var h,g;if((d=d||{childList:!1,subtree:!1}).attributeOldValue===void 0&&d.attributeFilter===void 0||d.attributes!==void 0||(d.attributes=!0),d.characterDataOldValue!==void 0&&d.characterData===void 0&&(d.characterData=!0),!d.childList&&!d.attributes&&!d.characterData)throw new TypeError;if(d.attributeOldValue&&!d.attributes)throw new TypeError;if(d.attributeFilter!==void 0&&!d.attributes)throw new TypeError;if(d.characterDataOldValue&&!d.characterData)throw new TypeError;var p=!1,v=d,w=function(C){var S,T;if(C.observer===m){p=!0;try{for(var _=(S=void 0,o(m._nodeList)),E=_.next();!E.done;E=_.next()){var D=E.value;c.list.remove(D._registeredObserverList,function(b){return s.Guard.isTransientRegisteredObserver(b)&&b.source===C})}}catch(b){S={error:b}}finally{try{E&&!E.done&&(T=_.return)&&T.call(_)}finally{if(S)throw S.error}}C.options=v}},m=this;try{for(var y=o(u._registeredObserverList),x=y.next();!x.done;x=y.next())w(x.value)}catch(C){h={error:C}}finally{try{x&&!x.done&&(g=y.return)&&g.call(y)}finally{if(h)throw h.error}}p||(u._registeredObserverList.push({observer:this,options:d}),this._nodeList.push(u))},f.prototype.disconnect=function(){var u,d,h=this;try{for(var g=o(this._nodeList),p=g.next();!p.done;p=g.next()){var v=p.value;c.list.remove(v._registeredObserverList,function(w){return w.observer===h})}}catch(w){u={error:w}}finally{try{p&&!p.done&&(d=g.return)&&d.call(g)}finally{if(u)throw u.error}}this._recordQueue=[]},f.prototype.takeRecords=function(){var u=this._recordQueue;return this._recordQueue=[],u},f}();n.MutationObserverImpl=l},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=function(){function s(){}return Object.defineProperty(s.prototype,"previousElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._previousSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"nextElementSibling",{get:function(){for(var c=o.Cast.asNode(this)._nextSibling;c;){if(o.Guard.isElementNode(c))return c;c=c._nextSibling}return null},enumerable:!0,configurable:!0}),s}();n.NonDocumentTypeChildNodeImpl=a},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(3),a=i(0),s=function(){function c(){}return c.prototype.getElementById=function(l){for(var f=a.tree_getFirstDescendantNode(o.Cast.asNode(this),!1,!1,function(u){return o.Guard.isElementNode(u)});f!==null;){if(f._uniqueIdentifier===l)return f;f=a.tree_getNextDescendantNode(o.Cast.asNode(this),f,!1,!1,function(u){return o.Guard.isElementNode(u)})}return null},c}();n.NonElementParentNodeImpl=s},function(r,n,i){var o=this&&this.__values||function(l){var f=typeof Symbol=="function"&&Symbol.iterator,u=f&&l[f],d=0;if(u)return u.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&d>=l.length&&(l=void 0),{value:l&&l[d++],done:!l}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(3),s=i(0),c=function(){function l(){}return Object.defineProperty(l.prototype,"children",{get:function(){return s.create_htmlCollection(a.Cast.asNode(this))},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"firstElementChild",{get:function(){for(var f=a.Cast.asNode(this)._firstChild;f;){if(a.Guard.isElementNode(f))return f;f=f._nextSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"lastElementChild",{get:function(){for(var f=a.Cast.asNode(this)._lastChild;f;){if(a.Guard.isElementNode(f))return f;f=f._previousSibling}return null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"childElementCount",{get:function(){var f,u,d=0;try{for(var h=o(a.Cast.asNode(this)._children),g=h.next();!g.done;g=h.next()){var p=g.value;a.Guard.isElementNode(p)&&d++}}catch(v){f={error:v}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(f)throw f.error}}return d},enumerable:!0,configurable:!0}),l.prototype.prepend=function(){for(var f=[],u=0;u<arguments.length;u++)f[u]=arguments[u];var d=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(f,d._nodeDocument);s.mutation_preInsert(h,d,d._firstChild)},l.prototype.append=function(){for(var f=[],u=0;u<arguments.length;u++)f[u]=arguments[u];var d=a.Cast.asNode(this),h=s.parentNode_convertNodesIntoANode(f,d._nodeDocument);s.mutation_append(h,d)},l.prototype.querySelector=function(f){var u=a.Cast.asNode(this),d=s.selectors_scopeMatchASelectorsString(f,u);return d.length===0?null:d[0]},l.prototype.querySelectorAll=function(f){var u=a.Cast.asNode(this),d=s.selectors_scopeMatchASelectorsString(f,u);return s.create_nodeListStatic(u,d)},l}();n.ParentNodeImpl=c},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=function(){function s(){}return Object.defineProperty(s.prototype,"_name",{get:function(){return this.__name||""},set:function(c){this.__name=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_assignedSlot",{get:function(){return this.__assignedSlot||null},set:function(c){this.__assignedSlot=c},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"assignedSlot",{get:function(){return o.shadowTree_findASlot(this,!0)},enumerable:!0,configurable:!0}),s}();n.SlotableImpl=a},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(102),c=i(9),l=i(3),f=function(u){function d(h){var g=u.call(this)||this;if(l.Guard.isDocumentTypeNode(h.startContainer)||l.Guard.isAttrNode(h.startContainer)||l.Guard.isDocumentTypeNode(h.endContainer)||l.Guard.isAttrNode(h.endContainer))throw new c.InvalidNodeTypeError;return g._start=[h.startContainer,h.startOffset],g._end=[h.endContainer,h.endOffset],g}return a(d,u),d}(s.AbstractRangeImpl);n.StaticRangeImpl=f},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(272);n.DOMParser=o.DOMParserImpl},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(0),a=i(273),s=function(){function c(){}return c.prototype.parseFromString=function(l,f){if(f==="text/html")throw new Error("HTML parser not implemented.");try{return(u=new a.XMLParserImpl().parse(l))._contentType=f,u}catch(p){var u,d="http://www.mozilla.org/newlayout/xml/parsererror.xml",h=(u=o.create_xmlDocument()).createElementNS(d,"parsererror"),g=u.createElementNS(d,"error");return g.setAttribute("message",p.message),h.appendChild(g),u.appendChild(h),u}},c}();n.DOMParserImpl=s},function(r,n,i){var o=this&&this.__read||function(h,g){var p=typeof Symbol=="function"&&h[Symbol.iterator];if(!p)return h;var v,w,m=p.call(h),y=[];try{for(;(g===void 0||g-- >0)&&!(v=m.next()).done;)y.push(v.value)}catch(x){w={error:x}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(w)throw w.error}}return y},a=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var s=i(180),c=i(111),l=i(7),f=i(0),u=i(69),d=function(){function h(){}return h.prototype.parse=function(g){for(var p,v,w,m,y=new s.XMLStringLexer(g,{skipWhitespaceOnlyText:!0}),x=f.create_document(),C=x,S=y.nextToken();S.type!==c.TokenType.EOF;){switch(S.type){case c.TokenType.Declaration:var T=S;if(T.version!=="1.0")throw new Error("Invalid xml version: "+T.version);break;case c.TokenType.DocType:var _=S;if(!f.xml_isPubidChar(_.pubId))throw new Error("DocType public identifier does not match PubidChar construct.");if(!f.xml_isLegalChar(_.sysId)||_.sysId.indexOf('"')!==-1&&_.sysId.indexOf("'")!==-1)throw new Error("DocType system identifier contains invalid characters.");C.appendChild(x.implementation.createDocumentType(_.name,_.pubId,_.sysId));break;case c.TokenType.CDATA:var E=S;if(!f.xml_isLegalChar(E.data)||E.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters.");C.appendChild(x.createCDATASection(E.data));break;case c.TokenType.Comment:var D=S;if(!f.xml_isLegalChar(D.data)||D.data.indexOf("--")!==-1||D.data.endsWith("-"))throw new Error("Comment data contains invalid characters.");C.appendChild(x.createComment(D.data));break;case c.TokenType.PI:var b=S;if(b.target.indexOf(":")!==-1||/^xml$/i.test(b.target))throw new Error("Processing instruction target contains invalid characters.");if(!f.xml_isLegalChar(b.data)||b.data.indexOf("?>")!==-1)throw new Error("Processing instruction data contains invalid characters.");C.appendChild(x.createProcessingInstruction(b.target,b.data));break;case c.TokenType.Text:var I=S;if(!f.xml_isLegalChar(I.data))throw new Error("Text data contains invalid characters.");C.appendChild(x.createTextNode(this._decodeText(I.data)));break;case c.TokenType.Element:var R=S,M=o(f.namespace_extractQName(R.name),2),P=M[0],k=M[1];if(k.indexOf(":")!==-1||!f.xml_isName(k))throw new Error("Node local name contains invalid characters.");if(P==="xmlns")throw new Error("An element cannot have the 'xmlns' prefix.");var z=C.lookupNamespaceURI(P),A={};try{for(var L=(p=void 0,a(R.attributes)),N=L.next();!N.done;N=L.next()){var H=o(N.value,2),ee=H[0],oe=H[1];if(ee==="xmlns")z=oe;else{var de=o(f.namespace_extractQName(ee),2),ue=de[0],me=de[1];ue==="xmlns"&&(me===P&&(z=oe),A[me]=oe)}}}catch(X){p={error:X}}finally{try{N&&!N.done&&(v=L.return)&&v.call(L)}finally{if(p)throw p.error}}var Ee=z!==null?x.createElementNS(z,R.name):x.createElement(R.name);C.appendChild(Ee);var _e=new u.LocalNameSet;try{for(var Ce=(w=void 0,a(R.attributes)),F=Ce.next();!F.done;F=Ce.next()){var O=o(F.value,2),$=(ee=O[0],oe=O[1],o(f.namespace_extractQName(ee),2)),W=(ue=$[0],me=$[1],null);if(ue==="xmlns"||ue===null&&me==="xmlns"?W=l.namespace.XMLNS:(W=Ee.lookupNamespaceURI(ue))!==null&&Ee.isDefaultNamespace(W)?W=null:W===null&&ue!==null&&(W=A[ue]||null),_e.has(W,me))throw new Error("Element contains duplicate attributes.");if(_e.set(W,me),W===l.namespace.XMLNS&&oe===l.namespace.XMLNS)throw new Error("XMLNS namespace is reserved.");if(me.indexOf(":")!==-1||!f.xml_isName(me))throw new Error("Attribute local name contains invalid characters.");if(ue==="xmlns"&&oe==="")throw new Error("Empty XML namespace is not allowed.");W!==null?Ee.setAttributeNS(W,ee,this._decodeAttributeValue(oe)):Ee.setAttribute(ee,this._decodeAttributeValue(oe))}}catch(X){w={error:X}}finally{try{F&&!F.done&&(m=Ce.return)&&m.call(Ce)}finally{if(w)throw w.error}}R.selfClosing||(C=Ee);break;case c.TokenType.ClosingTag:if(S.name!==C.nodeName)throw new Error("Closing tag name does not match opening tag name.");C._parent&&(C=C._parent)}S=y.nextToken()}return x},h.prototype._decodeText=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h.prototype._decodeAttributeValue=function(g){return g==null?g:g.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},h}();n.XMLParserImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(275);n.XMLSerializer=o.XMLSerializerImpl},function(r,n,i){var o=this&&this.__values||function(h){var g=typeof Symbol=="function"&&Symbol.iterator,p=g&&h[g],v=0;if(p)return p.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&v>=h.length&&(h=void 0),{value:h&&h[v++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var a=i(2),s=i(69),c=i(95),l=i(9),f=i(7),u=i(0),d=function(){function h(){}return h.prototype.serializeToString=function(g){return this._xmlSerialization(g,!1)},h.prototype._xmlSerialization=function(g,p){if(g._nodeDocument===void 0||g._nodeDocument._hasNamespaces){var v=new c.NamespacePrefixMap;v.set("xml",f.namespace.XML);try{return this._serializeNodeNS(g,null,v,{value:1},p)}catch{throw new l.InvalidStateError}}else try{return this._serializeNode(g,p)}catch{throw new l.InvalidStateError}},h.prototype._serializeNodeNS=function(g,p,v,w,m){switch(g.nodeType){case a.NodeType.Element:return this._serializeElementNS(g,p,v,w,m);case a.NodeType.Document:return this._serializeDocumentNS(g,p,v,w,m);case a.NodeType.Comment:return this._serializeComment(g,m);case a.NodeType.Text:return this._serializeText(g,m);case a.NodeType.DocumentFragment:return this._serializeDocumentFragmentNS(g,p,v,w,m);case a.NodeType.DocumentType:return this._serializeDocumentType(g,m);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,m);case a.NodeType.CData:return this._serializeCData(g,m);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeNode=function(g,p){switch(g.nodeType){case a.NodeType.Element:return this._serializeElement(g,p);case a.NodeType.Document:return this._serializeDocument(g,p);case a.NodeType.Comment:return this._serializeComment(g,p);case a.NodeType.Text:return this._serializeText(g,p);case a.NodeType.DocumentFragment:return this._serializeDocumentFragment(g,p);case a.NodeType.DocumentType:return this._serializeDocumentType(g,p);case a.NodeType.ProcessingInstruction:return this._serializeProcessingInstruction(g,p);case a.NodeType.CData:return this._serializeCData(g,p);default:throw new Error("Unknown node type: "+g.nodeType)}},h.prototype._serializeElementNS=function(g,p,v,w,m){var y,x;if(m&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var C="<",S="",T=!1,_=!1,E=v.copy(),D={},b=this._recordNamespaceInformation(g,E,D),I=p,R=g.namespaceURI;if(I===R)b!==null&&(_=!0),C+=S=R===f.namespace.XML?"xml:"+g.localName:g.localName;else{var M=g.prefix,P=null;if(M===null&&R===b||(P=E.get(M,R)),M==="xmlns"){if(m)throw new Error("An element cannot have the 'xmlns' prefix (well-formed required).");P=M}P!==null?(S=P+":"+g.localName,b!==null&&b!==f.namespace.XML&&(I=b||null),C+=S):M!==null?(M in D&&(M=this._generatePrefix(R,E,w)),E.set(M,R),C+=S+=M+":"+g.localName,C+=" xmlns:"+M+'="'+this._serializeAttributeValue(R,m)+'"',b!==null&&(I=b||null)):b===null||b!==null&&b!==R?(_=!0,I=R,C+=S+=g.localName,C+=' xmlns="'+this._serializeAttributeValue(R,m)+'"'):(I=R,C+=S+=g.localName)}C+=this._serializeAttributesNS(g,E,w,D,_,m);var k=R===f.namespace.HTML;if(k&&g.childNodes.length===0&&h._VoidElementNames.has(g.localName)?(C+=" /",T=!0):k||g.childNodes.length!==0||(C+="/",T=!0),C+=">",T)return C;if(!(k&&g.localName==="template"))try{for(var z=o(g._children||g.childNodes),A=z.next();!A.done;A=z.next()){var L=A.value;C+=this._serializeNodeNS(L,I,E,w,m)}}catch(N){y={error:N}}finally{try{A&&!A.done&&(x=z.return)&&x.call(z)}finally{if(y)throw y.error}}return C+="</"+S+">"},h.prototype._serializeDocumentNS=function(g,p,v,w,m){var y,x;if(m&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var C="";try{for(var S=o(g._children||g.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;C+=this._serializeNodeNS(_,p,v,w,m)}}catch(E){y={error:E}}finally{try{T&&!T.done&&(x=S.return)&&x.call(S)}finally{if(y)throw y.error}}return C},h.prototype._serializeComment=function(g,p){if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("--")!==-1||g.data.endsWith("-")))throw new Error("Comment data contains invalid characters (well-formed required).");return"<!--"+g.data+"-->"},h.prototype._serializeText=function(g,p){if(p&&!u.xml_isLegalChar(g.data))throw new Error("Text data contains invalid characters (well-formed required).");for(var v="",w=0;w<g.data.length;w++){var m=g.data[w];v+=m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":m}return v},h.prototype._serializeDocumentFragmentNS=function(g,p,v,w,m){var y,x,C="";try{for(var S=o(g._children||g.childNodes),T=S.next();!T.done;T=S.next()){var _=T.value;C+=this._serializeNodeNS(_,p,v,w,m)}}catch(E){y={error:E}}finally{try{T&&!T.done&&(x=S.return)&&x.call(S)}finally{if(y)throw y.error}}return C},h.prototype._serializeDocumentType=function(g,p){if(p&&!u.xml_isPubidChar(g.publicId))throw new Error("DocType public identifier does not match PubidChar construct (well-formed required).");if(p&&(!u.xml_isLegalChar(g.systemId)||g.systemId.indexOf('"')!==-1&&g.systemId.indexOf("'")!==-1))throw new Error("DocType system identifier contains invalid characters (well-formed required).");return g.publicId&&g.systemId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'" "'+g.systemId+'">':g.publicId?"<!DOCTYPE "+g.name+' PUBLIC "'+g.publicId+'">':g.systemId?"<!DOCTYPE "+g.name+' SYSTEM "'+g.systemId+'">':"<!DOCTYPE "+g.name+">"},h.prototype._serializeProcessingInstruction=function(g,p){if(p&&(g.target.indexOf(":")!==-1||/^xml$/i.test(g.target)))throw new Error("Processing instruction target contains invalid characters (well-formed required).");if(p&&(!u.xml_isLegalChar(g.data)||g.data.indexOf("?>")!==-1))throw new Error("Processing instruction data contains invalid characters (well-formed required).");return"<?"+(g.data===""?g.target:g.target+" "+g.data)+"?>"},h.prototype._serializeCData=function(g,p){if(p&&g.data.indexOf("]]>")!==-1)throw new Error("CDATA contains invalid characters (well-formed required).");return"<![CDATA["+g.data+"]]>"},h.prototype._serializeAttributesNS=function(g,p,v,w,m,y){var x,C,S="",T=y?new s.LocalNameSet:void 0;try{for(var _=o(g.attributes),E=_.next();!E.done;E=_.next()){var D=E.value;if(m||y||D.namespaceURI!==null){if(y&&T&&T.has(D.namespaceURI,D.localName))throw new Error("Element contains duplicate attributes (well-formed required).");y&&T&&T.set(D.namespaceURI,D.localName);var b=D.namespaceURI,I=null;if(b!==null)if(I=p.get(D.prefix,b),b===f.namespace.XMLNS){if(D.value===f.namespace.XML||D.prefix===null&&m||D.prefix!==null&&(!(D.localName in w)||w[D.localName]!==D.value)&&p.has(D.localName,D.value))continue;if(y&&D.value===f.namespace.XMLNS)throw new Error("XMLNS namespace is reserved (well-formed required).");if(y&&D.value==="")throw new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required).");D.prefix==="xmlns"&&(I="xmlns")}else I===null&&(S+=" xmlns:"+(I=D.prefix===null||p.hasPrefix(D.prefix)&&!p.has(D.prefix,b)?this._generatePrefix(b,p,v):D.prefix)+'="'+this._serializeAttributeValue(b,y)+'"');if(S+=" ",I!==null&&(S+=I+":"),y&&(D.localName.indexOf(":")!==-1||!u.xml_isName(D.localName)||D.localName==="xmlns"&&b===null))throw new Error("Attribute local name contains invalid characters (well-formed required).");S+=D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}else S+=" "+D.localName+'="'+this._serializeAttributeValue(D.value,y)+'"'}}catch(R){x={error:R}}finally{try{E&&!E.done&&(C=_.return)&&C.call(_)}finally{if(x)throw x.error}}return S},h.prototype._recordNamespaceInformation=function(g,p,v){var w,m,y=null;try{for(var x=o(g.attributes),C=x.next();!C.done;C=x.next()){var S=C.value,T=S.namespaceURI,_=S.prefix;if(T===f.namespace.XMLNS){if(_===null){y=S.value;continue}var E=S.localName,D=S.value;if(D===f.namespace.XML||(D===""&&(D=null),p.has(E,D)))continue;p.set(E,D),v[E]=D||""}}}catch(b){w={error:b}}finally{try{C&&!C.done&&(m=x.return)&&m.call(x)}finally{if(w)throw w.error}}return y},h.prototype._generatePrefix=function(g,p,v){var w="ns"+v.value;return v.value++,p.set(w,g),w},h.prototype._serializeAttributeValue=function(g,p){if(p&&g!==null&&!u.xml_isLegalChar(g))throw new Error("Invalid characters in attribute value.");if(g===null)return"";for(var v="",w=0;w<g.length;w++){var m=g[w];v+=m==='"'?"&quot;":m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":m}return v},h.prototype._serializeElement=function(g,p){var v,w;if(p&&(g.localName.indexOf(":")!==-1||!u.xml_isName(g.localName)))throw new Error("Node local name contains invalid characters (well-formed required).");var m=!1,y=g.localName,x="<"+y;if(x+=this._serializeAttributes(g,p),g._children.size===0&&(x+="/",m=!0),x+=">",m)return x;try{for(var C=o(g._children),S=C.next();!S.done;S=C.next()){var T=S.value;x+=this._serializeNode(T,p)}}catch(_){v={error:_}}finally{try{S&&!S.done&&(w=C.return)&&w.call(C)}finally{if(v)throw v.error}}return x+="</"+y+">"},h.prototype._serializeDocument=function(g,p){var v,w;if(p&&g.documentElement===null)throw new Error("Missing document element (well-formed required).");var m="";try{for(var y=o(g._children),x=y.next();!x.done;x=y.next()){var C=x.value;m+=this._serializeNode(C,p)}}catch(S){v={error:S}}finally{try{x&&!x.done&&(w=y.return)&&w.call(y)}finally{if(v)throw v.error}}return m},h.prototype._serializeDocumentFragment=function(g,p){var v,w,m="";try{for(var y=o(g._children),x=y.next();!x.done;x=y.next()){var C=x.value;m+=this._serializeNode(C,p)}}catch(S){v={error:S}}finally{try{x&&!x.done&&(w=y.return)&&w.call(y)}finally{if(v)throw v.error}}return m},h.prototype._serializeAttributes=function(g,p){var v,w,m="",y=p?{}:void 0;try{for(var x=o(g.attributes),C=x.next();!C.done;C=x.next()){var S=C.value;if(p&&y&&S.localName in y)throw new Error("Element contains duplicate attributes (well-formed required).");if(p&&y&&(y[S.localName]=!0),p&&(S.localName.indexOf(":")!==-1||!u.xml_isName(S.localName)))throw new Error("Attribute local name contains invalid characters (well-formed required).");m+=" "+S.localName+'="'+this._serializeAttributeValue(S.value,p)+'"'}}catch(T){v={error:T}}finally{try{C&&!C.done&&(w=x.return)&&w.call(x)}finally{if(v)throw v.error}}return m},h._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),h}();n.XMLSerializerImpl=d},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(277);n.XMLReader=o.XMLReader;var a=i(112);n.ObjectReader=a.ObjectReader;var s=i(280);n.JSONReader=s.JSONReader;var c=i(281);n.YAMLReader=c.YAMLReader},function(r,n,i){i(31),i(32),i(33),i(19),i(65),i(20),i(22),i(23);var o,a=this&&this.__extends||(o=function(g,p){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,w){v.__proto__=w}||function(v,w){for(var m in w)w.hasOwnProperty(m)&&(v[m]=w[m])})(g,p)},function(g,p){function v(){this.constructor=g}o(g,p),g.prototype=p===null?Object.create(p):(v.prototype=p.prototype,new v)}),s=this&&this.__read||function(g,p){var v=typeof Symbol=="function"&&g[Symbol.iterator];if(!v)return g;var w,m,y=v.call(g),x=[];try{for(;(p===void 0||p-- >0)&&!(w=y.next()).done;)x.push(w.value)}catch(C){m={error:C}}finally{try{w&&!w.done&&(v=y.return)&&v.call(y)}finally{if(m)throw m.error}}return x},c=this&&this.__values||function(g){var p=typeof Symbol=="function"&&Symbol.iterator,v=p&&g[p],w=0;if(v)return v.call(g);if(g&&typeof g.length=="number")return{next:function(){return g&&w>=g.length&&(g=void 0),{value:g&&g[w++],done:!g}}};throw new TypeError(p?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0});var l=i(180),f=i(111),u=i(7),d=i(0),h=function(g){function p(){return g!==null&&g.apply(this,arguments)||this}return a(p,g),p.prototype._parse=function(v,w){for(var m,y,x,C,S=new l.XMLStringLexer(w,{skipWhitespaceOnlyText:!0}),T=v,_=v,E=S.nextToken();E.type!==f.TokenType.EOF;){switch(E.type){case f.TokenType.Declaration:var D=E,b=this.sanitize(D.version);if(b!=="1.0")throw new Error("Invalid xml version: "+b);var I={version:b};D.encoding&&(I.encoding=this.sanitize(D.encoding)),D.standalone&&(I.standalone=this.sanitize(D.standalone)==="yes"),_.set(I);break;case f.TokenType.DocType:var R=E;_=this.docType(_,this.sanitize(R.name),this.sanitize(R.pubId),this.sanitize(R.sysId))||_;break;case f.TokenType.CDATA:var M=E;_=this.cdata(_,this.sanitize(M.data))||_;break;case f.TokenType.Comment:var P=E;_=this.comment(_,this.sanitize(P.data))||_;break;case f.TokenType.PI:var k=E;_=this.instruction(_,this.sanitize(k.target),this.sanitize(k.data))||_;break;case f.TokenType.Text:var z=E;_=this.text(_,this._decodeText(this.sanitize(z.data)))||_;break;case f.TokenType.Element:var A=E,L=this.sanitize(A.name),N=s(d.namespace_extractQName(L),1)[0],H=_.node.lookupNamespaceURI(N),ee={};try{for(var oe=(m=void 0,c(A.attributes)),de=oe.next();!de.done;de=oe.next()){var ue=s(de.value,2),me=ue[0],Ee=ue[1];if(me=this.sanitize(me),Ee=this.sanitize(Ee),me==="xmlns")H=Ee;else{var _e=s(d.namespace_extractQName(me),2),Ce=_e[0],F=_e[1];Ce==="xmlns"&&(F===N&&(H=Ee),ee[F]=Ee)}}}catch(xe){m={error:xe}}finally{try{de&&!de.done&&(y=oe.return)&&y.call(oe)}finally{if(m)throw m.error}}var O=H!==null?this.element(_,H,L):this.element(_,void 0,L);if(O===void 0)break;_.node===v.node&&(T=O);try{for(var $=(x=void 0,c(A.attributes)),W=$.next();!W.done;W=$.next()){var X=s(W.value,2);me=X[0],Ee=X[1],me=this.sanitize(me),Ee=this.sanitize(Ee);var Z=s(d.namespace_extractQName(me),2),ne=(Ce=Z[0],F=Z[1],null);Ce==="xmlns"||Ce===null&&F==="xmlns"?ne=u.namespace.XMLNS:(ne=O.node.lookupNamespaceURI(Ce))!==null&&O.node.isDefaultNamespace(ne)?ne=null:ne===null&&Ce!==null&&(ne=ee[Ce]||null),ne!==null?this.attribute(O,ne,me,this._decodeAttributeValue(Ee)):this.attribute(O,void 0,me,this._decodeAttributeValue(Ee))}}catch(xe){x={error:xe}}finally{try{W&&!W.done&&(C=$.return)&&C.call($)}finally{if(x)throw x.error}}A.selfClosing||(_=O);break;case f.TokenType.ClosingTag:_.node.parentNode&&(_=_.up())}E=S.nextToken()}return T},p}(i(75).BaseReader);n.XMLReader=h},function(r,n,i){var o=i(4),a=i(279);o({target:"Object",stat:!0,forced:Object.assign!==a},{assign:a})},function(r,n,i){var o=i(16),a=i(8),s=i(61),c=i(85),l=i(79),f=i(27),u=i(41),d=Object.assign,h=Object.defineProperty;r.exports=!d||a(function(){if(o&&d({b:1},d(h({},"a",{enumerable:!0,get:function(){h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var g={},p={},v=Symbol();return g[v]=7,"abcdefghijklmnopqrst".split("").forEach(function(w){p[w]=w}),d({},g)[v]!=7||s(d({},p)).join("")!="abcdefghijklmnopqrst"})?function(g,p){for(var v=f(g),w=arguments.length,m=1,y=c.f,x=l.f;w>m;)for(var C,S=u(arguments[m++]),T=y?s(S).concat(y(S)):s(S),_=T.length,E=0;_>E;)C=T[E++],o&&!x.call(S,C)||(v[C]=S[C]);return v}:d},function(r,n,i){var o,a=this&&this.__extends||(o=function(l,f){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h])})(l,f)},function(l,f){function u(){this.constructor=l}o(l,f),l.prototype=f===null?Object.create(f):(u.prototype=f.prototype,new u)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=function(l){function f(){return l!==null&&l.apply(this,arguments)||this}return a(f,l),f.prototype._parse=function(u,d){return new s.ObjectReader(this._builderOptions).parse(u,JSON.parse(d))},f}(i(75).BaseReader);n.JSONReader=c},function(r,n,i){var o,a=this&&this.__extends||(o=function(u,d){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])})(u,d)},function(u,d){function h(){this.constructor=u}o(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)});Object.defineProperty(n,"__esModule",{value:!0});var s=i(112),c=i(75),l=i(282),f=function(u){function d(){return u!==null&&u.apply(this,arguments)||this}return a(d,u),d.prototype._parse=function(h,g){var p=l.safeLoad(g);if(p===void 0)throw new Error("Unable to parse YAML document.");return new s.ObjectReader(this._builderOptions).parse(h,p)},d}(c.BaseReader);n.YAMLReader=f},function(r,n,i){var o=i(283);r.exports=o},function(r,n,i){var o=i(284),a=i(303);function s(c){return function(){throw new Error("Function "+c+" is deprecated and cannot be used.")}}r.exports.Type=i(10),r.exports.Schema=i(39),r.exports.FAILSAFE_SCHEMA=i(113),r.exports.JSON_SCHEMA=i(182),r.exports.CORE_SCHEMA=i(181),r.exports.DEFAULT_SAFE_SCHEMA=i(54),r.exports.DEFAULT_FULL_SCHEMA=i(76),r.exports.load=o.load,r.exports.loadAll=o.loadAll,r.exports.safeLoad=o.safeLoad,r.exports.safeLoadAll=o.safeLoadAll,r.exports.dump=a.dump,r.exports.safeDump=a.safeDump,r.exports.YAMLException=i(53),r.exports.MINIMAL_SCHEMA=i(113),r.exports.SAFE_SCHEMA=i(54),r.exports.DEFAULT_SCHEMA=i(76),r.exports.scan=s("scan"),r.exports.parse=s("parse"),r.exports.compose=s("compose"),r.exports.addConstructor=s("addConstructor")},function(r,n,i){var o=i(38),a=i(53),s=i(285),c=i(54),l=i(76),f=Object.prototype.hasOwnProperty,u=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,d=/[\x85\u2028\u2029]/,h=/[,\[\]\{\}]/,g=/^(?:!|!!|![a-z\-]+!)$/i,p=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function v(O){return Object.prototype.toString.call(O)}function w(O){return O===10||O===13}function m(O){return O===9||O===32}function y(O){return O===9||O===32||O===10||O===13}function x(O){return O===44||O===91||O===93||O===123||O===125}function C(O){var $;return 48<=O&&O<=57?O-48:97<=($=32|O)&&$<=102?$-97+10:-1}function S(O){return O===48?"\0":O===97?"\x07":O===98?"\b":O===116||O===9?"	":O===110?`
`:O===118?"\v":O===102?"\f":O===114?"\r":O===101?"\x1B":O===32?" ":O===34?'"':O===47?"/":O===92?"\\":O===78?"":O===95?"":O===76?"\u2028":O===80?"\u2029":""}function T(O){return O<=65535?String.fromCharCode(O):String.fromCharCode(55296+(O-65536>>10),56320+(O-65536&1023))}for(var _=new Array(256),E=new Array(256),D=0;D<256;D++)_[D]=S(D)?1:0,E[D]=S(D);function b(O,$){this.input=O,this.filename=$.filename||null,this.schema=$.schema||l,this.onWarning=$.onWarning||null,this.legacy=$.legacy||!1,this.json=$.json||!1,this.listener=$.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=O.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function I(O,$){return new a($,new s(O.filename,O.input,O.position,O.line,O.position-O.lineStart))}function R(O,$){throw I(O,$)}function M(O,$){O.onWarning&&O.onWarning.call(null,I(O,$))}var P={YAML:function(O,$,W){var X,Z,ne;O.version!==null&&R(O,"duplication of %YAML directive"),W.length!==1&&R(O,"YAML directive accepts exactly one argument"),(X=/^([0-9]+)\.([0-9]+)$/.exec(W[0]))===null&&R(O,"ill-formed argument of the YAML directive"),Z=parseInt(X[1],10),ne=parseInt(X[2],10),Z!==1&&R(O,"unacceptable YAML version of the document"),O.version=W[0],O.checkLineBreaks=ne<2,ne!==1&&ne!==2&&M(O,"unsupported YAML version of the document")},TAG:function(O,$,W){var X,Z;W.length!==2&&R(O,"TAG directive accepts exactly two arguments"),X=W[0],Z=W[1],g.test(X)||R(O,"ill-formed tag handle (first argument) of the TAG directive"),f.call(O.tagMap,X)&&R(O,'there is a previously declared suffix for "'+X+'" tag handle'),p.test(Z)||R(O,"ill-formed tag prefix (second argument) of the TAG directive"),O.tagMap[X]=Z}};function k(O,$,W,X){var Z,ne,xe,Ie;if($<W){if(Ie=O.input.slice($,W),X)for(Z=0,ne=Ie.length;Z<ne;Z+=1)(xe=Ie.charCodeAt(Z))===9||32<=xe&&xe<=1114111||R(O,"expected valid JSON character");else u.test(Ie)&&R(O,"the stream contains non-printable characters");O.result+=Ie}}function z(O,$,W,X){var Z,ne,xe,Ie;for(o.isObject(W)||R(O,"cannot merge mappings; the provided source object is unacceptable"),xe=0,Ie=(Z=Object.keys(W)).length;xe<Ie;xe+=1)ne=Z[xe],f.call($,ne)||($[ne]=W[ne],X[ne]=!0)}function A(O,$,W,X,Z,ne,xe,Ie){var Le,je;if(Array.isArray(Z))for(Le=0,je=(Z=Array.prototype.slice.call(Z)).length;Le<je;Le+=1)Array.isArray(Z[Le])&&R(O,"nested arrays are not supported inside keys"),typeof Z=="object"&&v(Z[Le])==="[object Object]"&&(Z[Le]="[object Object]");if(typeof Z=="object"&&v(Z)==="[object Object]"&&(Z="[object Object]"),Z=String(Z),$===null&&($={}),X==="tag:yaml.org,2002:merge")if(Array.isArray(ne))for(Le=0,je=ne.length;Le<je;Le+=1)z(O,$,ne[Le],W);else z(O,$,ne,W);else O.json||f.call(W,Z)||!f.call($,Z)||(O.line=xe||O.line,O.position=Ie||O.position,R(O,"duplicated mapping key")),$[Z]=ne,delete W[Z];return $}function L(O){var $;($=O.input.charCodeAt(O.position))===10?O.position++:$===13?(O.position++,O.input.charCodeAt(O.position)===10&&O.position++):R(O,"a line break is expected"),O.line+=1,O.lineStart=O.position}function N(O,$,W){for(var X=0,Z=O.input.charCodeAt(O.position);Z!==0;){for(;m(Z);)Z=O.input.charCodeAt(++O.position);if($&&Z===35)do Z=O.input.charCodeAt(++O.position);while(Z!==10&&Z!==13&&Z!==0);if(!w(Z))break;for(L(O),Z=O.input.charCodeAt(O.position),X++,O.lineIndent=0;Z===32;)O.lineIndent++,Z=O.input.charCodeAt(++O.position)}return W!==-1&&X!==0&&O.lineIndent<W&&M(O,"deficient indentation"),X}function H(O){var $,W=O.position;return!(($=O.input.charCodeAt(W))!==45&&$!==46||$!==O.input.charCodeAt(W+1)||$!==O.input.charCodeAt(W+2)||(W+=3,($=O.input.charCodeAt(W))!==0&&!y($)))}function ee(O,$){$===1?O.result+=" ":$>1&&(O.result+=o.repeat(`
`,$-1))}function oe(O,$){var W,X,Z=O.tag,ne=O.anchor,xe=[],Ie=!1;for(O.anchor!==null&&(O.anchorMap[O.anchor]=xe),X=O.input.charCodeAt(O.position);X!==0&&X===45&&y(O.input.charCodeAt(O.position+1));)if(Ie=!0,O.position++,N(O,!0,-1)&&O.lineIndent<=$)xe.push(null),X=O.input.charCodeAt(O.position);else if(W=O.line,me(O,$,3,!1,!0),xe.push(O.result),N(O,!0,-1),X=O.input.charCodeAt(O.position),(O.line===W||O.lineIndent>$)&&X!==0)R(O,"bad indentation of a sequence entry");else if(O.lineIndent<$)break;return!!Ie&&(O.tag=Z,O.anchor=ne,O.kind="sequence",O.result=xe,!0)}function de(O){var $,W,X,Z,ne=!1,xe=!1;if((Z=O.input.charCodeAt(O.position))!==33)return!1;if(O.tag!==null&&R(O,"duplication of a tag property"),(Z=O.input.charCodeAt(++O.position))===60?(ne=!0,Z=O.input.charCodeAt(++O.position)):Z===33?(xe=!0,W="!!",Z=O.input.charCodeAt(++O.position)):W="!",$=O.position,ne){do Z=O.input.charCodeAt(++O.position);while(Z!==0&&Z!==62);O.position<O.length?(X=O.input.slice($,O.position),Z=O.input.charCodeAt(++O.position)):R(O,"unexpected end of the stream within a verbatim tag")}else{for(;Z!==0&&!y(Z);)Z===33&&(xe?R(O,"tag suffix cannot contain exclamation marks"):(W=O.input.slice($-1,O.position+1),g.test(W)||R(O,"named tag handle cannot contain such characters"),xe=!0,$=O.position+1)),Z=O.input.charCodeAt(++O.position);X=O.input.slice($,O.position),h.test(X)&&R(O,"tag suffix cannot contain flow indicator characters")}return X&&!p.test(X)&&R(O,"tag name cannot contain such characters: "+X),ne?O.tag=X:f.call(O.tagMap,W)?O.tag=O.tagMap[W]+X:W==="!"?O.tag="!"+X:W==="!!"?O.tag="tag:yaml.org,2002:"+X:R(O,'undeclared tag handle "'+W+'"'),!0}function ue(O){var $,W;if((W=O.input.charCodeAt(O.position))!==38)return!1;for(O.anchor!==null&&R(O,"duplication of an anchor property"),W=O.input.charCodeAt(++O.position),$=O.position;W!==0&&!y(W)&&!x(W);)W=O.input.charCodeAt(++O.position);return O.position===$&&R(O,"name of an anchor node must contain at least one character"),O.anchor=O.input.slice($,O.position),!0}function me(O,$,W,X,Z){var ne,xe,Ie,Le,je,ie,ae,ve,se=1,ge=!1,Ve=!1;if(O.listener!==null&&O.listener("open",O),O.tag=null,O.anchor=null,O.kind=null,O.result=null,ne=xe=Ie=W===4||W===3,X&&N(O,!0,-1)&&(ge=!0,O.lineIndent>$?se=1:O.lineIndent===$?se=0:O.lineIndent<$&&(se=-1)),se===1)for(;de(O)||ue(O);)N(O,!0,-1)?(ge=!0,Ie=ne,O.lineIndent>$?se=1:O.lineIndent===$?se=0:O.lineIndent<$&&(se=-1)):Ie=!1;if(Ie&&(Ie=ge||Z),se!==1&&W!==4||(ae=W===1||W===2?$:$+1,ve=O.position-O.lineStart,se===1?Ie&&(oe(O,ve)||function(re,it,ut){var ot,Se,Ge,et,qe,st=re.tag,Et=re.anchor,ct={},bt={},It=null,ln=null,Pn=null,zt=!1,Tn=!1;for(re.anchor!==null&&(re.anchorMap[re.anchor]=ct),qe=re.input.charCodeAt(re.position);qe!==0;){if(ot=re.input.charCodeAt(re.position+1),Ge=re.line,et=re.position,qe!==63&&qe!==58||!y(ot)){if(!me(re,ut,2,!1,!0))break;if(re.line===Ge){for(qe=re.input.charCodeAt(re.position);m(qe);)qe=re.input.charCodeAt(++re.position);if(qe===58)y(qe=re.input.charCodeAt(++re.position))||R(re,"a whitespace character is expected after the key-value separator within a block mapping"),zt&&(A(re,ct,bt,It,ln,null),It=ln=Pn=null),Tn=!0,zt=!1,Se=!1,It=re.tag,ln=re.result;else{if(!Tn)return re.tag=st,re.anchor=Et,!0;R(re,"can not read an implicit mapping pair; a colon is missed")}}else{if(!Tn)return re.tag=st,re.anchor=Et,!0;R(re,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else qe===63?(zt&&(A(re,ct,bt,It,ln,null),It=ln=Pn=null),Tn=!0,zt=!0,Se=!0):zt?(zt=!1,Se=!0):R(re,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),re.position+=1,qe=ot;if((re.line===Ge||re.lineIndent>it)&&(me(re,it,4,!0,Se)&&(zt?ln=re.result:Pn=re.result),zt||(A(re,ct,bt,It,ln,Pn,Ge,et),It=ln=Pn=null),N(re,!0,-1),qe=re.input.charCodeAt(re.position)),re.lineIndent>it&&qe!==0)R(re,"bad indentation of a mapping entry");else if(re.lineIndent<it)break}return zt&&A(re,ct,bt,It,ln,null),Tn&&(re.tag=st,re.anchor=Et,re.kind="mapping",re.result=ct),Tn}(O,ve,ae))||function(re,it){var ut,ot,Se,Ge,et,qe,st,Et,ct,bt,It=!0,ln=re.tag,Pn=re.anchor,zt={};if((bt=re.input.charCodeAt(re.position))===91)Se=93,qe=!1,ot=[];else{if(bt!==123)return!1;Se=125,qe=!0,ot={}}for(re.anchor!==null&&(re.anchorMap[re.anchor]=ot),bt=re.input.charCodeAt(++re.position);bt!==0;){if(N(re,!0,it),(bt=re.input.charCodeAt(re.position))===Se)return re.position++,re.tag=ln,re.anchor=Pn,re.kind=qe?"mapping":"sequence",re.result=ot,!0;It||R(re,"missed comma between flow collection entries"),ct=null,Ge=et=!1,bt===63&&y(re.input.charCodeAt(re.position+1))&&(Ge=et=!0,re.position++,N(re,!0,it)),ut=re.line,me(re,it,1,!1,!0),Et=re.tag,st=re.result,N(re,!0,it),bt=re.input.charCodeAt(re.position),!et&&re.line!==ut||bt!==58||(Ge=!0,bt=re.input.charCodeAt(++re.position),N(re,!0,it),me(re,it,1,!1,!0),ct=re.result),qe?A(re,ot,zt,Et,st,ct):Ge?ot.push(A(re,null,zt,Et,st,ct)):ot.push(st),N(re,!0,it),(bt=re.input.charCodeAt(re.position))===44?(It=!0,bt=re.input.charCodeAt(++re.position)):It=!1}R(re,"unexpected end of the stream within a flow collection")}(O,ae)?Ve=!0:(xe&&function(re,it){var ut,ot,Se,Ge,et,qe=1,st=!1,Et=!1,ct=it,bt=0,It=!1;if((Ge=re.input.charCodeAt(re.position))===124)ot=!1;else{if(Ge!==62)return!1;ot=!0}for(re.kind="scalar",re.result="";Ge!==0;)if((Ge=re.input.charCodeAt(++re.position))===43||Ge===45)qe===1?qe=Ge===43?3:2:R(re,"repeat of a chomping mode identifier");else{if(!((Se=48<=(et=Ge)&&et<=57?et-48:-1)>=0))break;Se===0?R(re,"bad explicit indentation width of a block scalar; it cannot be less than one"):Et?R(re,"repeat of an indentation width identifier"):(ct=it+Se-1,Et=!0)}if(m(Ge)){do Ge=re.input.charCodeAt(++re.position);while(m(Ge));if(Ge===35)do Ge=re.input.charCodeAt(++re.position);while(!w(Ge)&&Ge!==0)}for(;Ge!==0;){for(L(re),re.lineIndent=0,Ge=re.input.charCodeAt(re.position);(!Et||re.lineIndent<ct)&&Ge===32;)re.lineIndent++,Ge=re.input.charCodeAt(++re.position);if(!Et&&re.lineIndent>ct&&(ct=re.lineIndent),w(Ge))bt++;else{if(re.lineIndent<ct){qe===3?re.result+=o.repeat(`
`,st?1+bt:bt):qe===1&&st&&(re.result+=`
`);break}for(ot?m(Ge)?(It=!0,re.result+=o.repeat(`
`,st?1+bt:bt)):It?(It=!1,re.result+=o.repeat(`
`,bt+1)):bt===0?st&&(re.result+=" "):re.result+=o.repeat(`
`,bt):re.result+=o.repeat(`
`,st?1+bt:bt),st=!0,Et=!0,bt=0,ut=re.position;!w(Ge)&&Ge!==0;)Ge=re.input.charCodeAt(++re.position);k(re,ut,re.position,!1)}}return!0}(O,ae)||function(re,it){var ut,ot,Se;if((ut=re.input.charCodeAt(re.position))!==39)return!1;for(re.kind="scalar",re.result="",re.position++,ot=Se=re.position;(ut=re.input.charCodeAt(re.position))!==0;)if(ut===39){if(k(re,ot,re.position,!0),(ut=re.input.charCodeAt(++re.position))!==39)return!0;ot=re.position,re.position++,Se=re.position}else w(ut)?(k(re,ot,Se,!0),ee(re,N(re,!1,it)),ot=Se=re.position):re.position===re.lineStart&&H(re)?R(re,"unexpected end of the document within a single quoted scalar"):(re.position++,Se=re.position);R(re,"unexpected end of the stream within a single quoted scalar")}(O,ae)||function(re,it){var ut,ot,Se,Ge,et,qe,st;if((qe=re.input.charCodeAt(re.position))!==34)return!1;for(re.kind="scalar",re.result="",re.position++,ut=ot=re.position;(qe=re.input.charCodeAt(re.position))!==0;){if(qe===34)return k(re,ut,re.position,!0),re.position++,!0;if(qe===92){if(k(re,ut,re.position,!0),w(qe=re.input.charCodeAt(++re.position)))N(re,!1,it);else if(qe<256&&_[qe])re.result+=E[qe],re.position++;else if((et=(st=qe)===120?2:st===117?4:st===85?8:0)>0){for(Se=et,Ge=0;Se>0;Se--)(et=C(qe=re.input.charCodeAt(++re.position)))>=0?Ge=(Ge<<4)+et:R(re,"expected hexadecimal character");re.result+=T(Ge),re.position++}else R(re,"unknown escape sequence");ut=ot=re.position}else w(qe)?(k(re,ut,ot,!0),ee(re,N(re,!1,it)),ut=ot=re.position):re.position===re.lineStart&&H(re)?R(re,"unexpected end of the document within a double quoted scalar"):(re.position++,ot=re.position)}R(re,"unexpected end of the stream within a double quoted scalar")}(O,ae)?Ve=!0:function(re){var it,ut,ot;if((ot=re.input.charCodeAt(re.position))!==42)return!1;for(ot=re.input.charCodeAt(++re.position),it=re.position;ot!==0&&!y(ot)&&!x(ot);)ot=re.input.charCodeAt(++re.position);return re.position===it&&R(re,"name of an alias node must contain at least one character"),ut=re.input.slice(it,re.position),re.anchorMap.hasOwnProperty(ut)||R(re,'unidentified alias "'+ut+'"'),re.result=re.anchorMap[ut],N(re,!0,-1),!0}(O)?(Ve=!0,O.tag===null&&O.anchor===null||R(O,"alias node should not have any properties")):function(re,it,ut){var ot,Se,Ge,et,qe,st,Et,ct,bt=re.kind,It=re.result;if(y(ct=re.input.charCodeAt(re.position))||x(ct)||ct===35||ct===38||ct===42||ct===33||ct===124||ct===62||ct===39||ct===34||ct===37||ct===64||ct===96||(ct===63||ct===45)&&(y(ot=re.input.charCodeAt(re.position+1))||ut&&x(ot)))return!1;for(re.kind="scalar",re.result="",Se=Ge=re.position,et=!1;ct!==0;){if(ct===58){if(y(ot=re.input.charCodeAt(re.position+1))||ut&&x(ot))break}else if(ct===35){if(y(re.input.charCodeAt(re.position-1)))break}else{if(re.position===re.lineStart&&H(re)||ut&&x(ct))break;if(w(ct)){if(qe=re.line,st=re.lineStart,Et=re.lineIndent,N(re,!1,-1),re.lineIndent>=it){et=!0,ct=re.input.charCodeAt(re.position);continue}re.position=Ge,re.line=qe,re.lineStart=st,re.lineIndent=Et;break}}et&&(k(re,Se,Ge,!1),ee(re,re.line-qe),Se=Ge=re.position,et=!1),m(ct)||(Ge=re.position+1),ct=re.input.charCodeAt(++re.position)}return k(re,Se,Ge,!1),!!re.result||(re.kind=bt,re.result=It,!1)}(O,ae,W===1)&&(Ve=!0,O.tag===null&&(O.tag="?")),O.anchor!==null&&(O.anchorMap[O.anchor]=O.result)):se===0&&(Ve=Ie&&oe(O,ve))),O.tag!==null&&O.tag!=="!")if(O.tag==="?"){for(O.result!==null&&O.kind!=="scalar"&&R(O,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+O.kind+'"'),Le=0,je=O.implicitTypes.length;Le<je;Le+=1)if((ie=O.implicitTypes[Le]).resolve(O.result)){O.result=ie.construct(O.result),O.tag=ie.tag,O.anchor!==null&&(O.anchorMap[O.anchor]=O.result);break}}else f.call(O.typeMap[O.kind||"fallback"],O.tag)?(ie=O.typeMap[O.kind||"fallback"][O.tag],O.result!==null&&ie.kind!==O.kind&&R(O,"unacceptable node kind for !<"+O.tag+'> tag; it should be "'+ie.kind+'", not "'+O.kind+'"'),ie.resolve(O.result)?(O.result=ie.construct(O.result),O.anchor!==null&&(O.anchorMap[O.anchor]=O.result)):R(O,"cannot resolve a node with !<"+O.tag+"> explicit tag")):R(O,"unknown tag !<"+O.tag+">");return O.listener!==null&&O.listener("close",O),O.tag!==null||O.anchor!==null||Ve}function Ee(O){var $,W,X,Z,ne=O.position,xe=!1;for(O.version=null,O.checkLineBreaks=O.legacy,O.tagMap={},O.anchorMap={};(Z=O.input.charCodeAt(O.position))!==0&&(N(O,!0,-1),Z=O.input.charCodeAt(O.position),!(O.lineIndent>0||Z!==37));){for(xe=!0,Z=O.input.charCodeAt(++O.position),$=O.position;Z!==0&&!y(Z);)Z=O.input.charCodeAt(++O.position);for(X=[],(W=O.input.slice($,O.position)).length<1&&R(O,"directive name must not be less than one character in length");Z!==0;){for(;m(Z);)Z=O.input.charCodeAt(++O.position);if(Z===35){do Z=O.input.charCodeAt(++O.position);while(Z!==0&&!w(Z));break}if(w(Z))break;for($=O.position;Z!==0&&!y(Z);)Z=O.input.charCodeAt(++O.position);X.push(O.input.slice($,O.position))}Z!==0&&L(O),f.call(P,W)?P[W](O,W,X):M(O,'unknown document directive "'+W+'"')}N(O,!0,-1),O.lineIndent===0&&O.input.charCodeAt(O.position)===45&&O.input.charCodeAt(O.position+1)===45&&O.input.charCodeAt(O.position+2)===45?(O.position+=3,N(O,!0,-1)):xe&&R(O,"directives end mark is expected"),me(O,O.lineIndent-1,4,!1,!0),N(O,!0,-1),O.checkLineBreaks&&d.test(O.input.slice(ne,O.position))&&M(O,"non-ASCII line breaks are interpreted as content"),O.documents.push(O.result),O.position===O.lineStart&&H(O)?O.input.charCodeAt(O.position)===46&&(O.position+=3,N(O,!0,-1)):O.position<O.length-1&&R(O,"end of the stream or a document separator is expected")}function _e(O,$){$=$||{},(O=String(O)).length!==0&&(O.charCodeAt(O.length-1)!==10&&O.charCodeAt(O.length-1)!==13&&(O+=`
`),O.charCodeAt(0)===65279&&(O=O.slice(1)));var W=new b(O,$),X=O.indexOf("\0");for(X!==-1&&(W.position=X,R(W,"null byte is not allowed in input")),W.input+="\0";W.input.charCodeAt(W.position)===32;)W.lineIndent+=1,W.position+=1;for(;W.position<W.length-1;)Ee(W);return W.documents}function Ce(O,$,W){$!==null&&typeof $=="object"&&W===void 0&&(W=$,$=null);var X=_e(O,W);if(typeof $!="function")return X;for(var Z=0,ne=X.length;Z<ne;Z+=1)$(X[Z])}function F(O,$){var W=_e(O,$);if(W.length!==0){if(W.length===1)return W[0];throw new a("expected a single document in the stream, but found more")}}r.exports.loadAll=Ce,r.exports.load=F,r.exports.safeLoadAll=function(O,$,W){return typeof $=="object"&&$!==null&&W===void 0&&(W=$,$=null),Ce(O,$,o.extend({schema:c},W))},r.exports.safeLoad=function(O,$){return F(O,o.extend({schema:c},$))}},function(r,n,i){var o=i(38);function a(s,c,l,f,u){this.name=s,this.buffer=c,this.position=l,this.line=f,this.column=u}a.prototype.getSnippet=function(s,c){var l,f,u,d,h;if(!this.buffer)return null;for(s=s||4,c=c||75,l="",f=this.position;f>0&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(f-1))===-1;)if(f-=1,this.position-f>c/2-1){l=" ... ",f+=5;break}for(u="",d=this.position;d<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(d))===-1;)if((d+=1)-this.position>c/2-1){u=" ... ",d-=5;break}return h=this.buffer.slice(f,d),o.repeat(" ",s)+l+h+u+`
`+o.repeat(" ",s+this.position-f+l.length)+"^"},a.prototype.toString=function(s){var c,l="";return this.name&&(l+='in "'+this.name+'" '),l+="at line "+(this.line+1)+", column "+(this.column+1),s||(c=this.getSnippet())&&(l+=`:
`+c),l},r.exports=a},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:str",{kind:"scalar",construct:function(a){return a!==null?a:""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(a){return a!==null?a:[]}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:map",{kind:"mapping",construct:function(a){return a!==null?a:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(a){if(a===null)return!0;var s=a.length;return s===1&&a==="~"||s===4&&(a==="null"||a==="Null"||a==="NULL")},construct:function(){return null},predicate:function(a){return a===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(a){if(a===null)return!1;var s=a.length;return s===4&&(a==="true"||a==="True"||a==="TRUE")||s===5&&(a==="false"||a==="False"||a==="FALSE")},construct:function(a){return a==="true"||a==="True"||a==="TRUE"},predicate:function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},represent:{lowercase:function(a){return a?"true":"false"},uppercase:function(a){return a?"TRUE":"FALSE"},camelcase:function(a){return a?"True":"False"}},defaultStyle:"lowercase"})},function(r,n,i){var o=i(38),a=i(10);function s(l){return 48<=l&&l<=55}function c(l){return 48<=l&&l<=57}r.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(l){if(l===null)return!1;var f,u,d=l.length,h=0,g=!1;if(!d)return!1;if((f=l[h])!=="-"&&f!=="+"||(f=l[++h]),f==="0"){if(h+1===d)return!0;if((f=l[++h])==="b"){for(h++;h<d;h++)if((f=l[h])!=="_"){if(f!=="0"&&f!=="1")return!1;g=!0}return g&&f!=="_"}if(f==="x"){for(h++;h<d;h++)if((f=l[h])!=="_"){if(!(48<=(u=l.charCodeAt(h))&&u<=57||65<=u&&u<=70||97<=u&&u<=102))return!1;g=!0}return g&&f!=="_"}for(;h<d;h++)if((f=l[h])!=="_"){if(!s(l.charCodeAt(h)))return!1;g=!0}return g&&f!=="_"}if(f==="_")return!1;for(;h<d;h++)if((f=l[h])!=="_"){if(f===":")break;if(!c(l.charCodeAt(h)))return!1;g=!0}return!(!g||f==="_")&&(f!==":"||/^(:[0-5]?[0-9])+$/.test(l.slice(h)))},construct:function(l){var f,u,d=l,h=1,g=[];return d.indexOf("_")!==-1&&(d=d.replace(/_/g,"")),(f=d[0])!=="-"&&f!=="+"||(f==="-"&&(h=-1),f=(d=d.slice(1))[0]),d==="0"?0:f==="0"?d[1]==="b"?h*parseInt(d.slice(2),2):d[1]==="x"?h*parseInt(d,16):h*parseInt(d,8):d.indexOf(":")!==-1?(d.split(":").forEach(function(p){g.unshift(parseInt(p,10))}),d=0,u=1,g.forEach(function(p){d+=p*u,u*=60}),h*d):h*parseInt(d,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&l%1==0&&!o.isNegativeZero(l)},represent:{binary:function(l){return l>=0?"0b"+l.toString(2):"-0b"+l.toString(2).slice(1)},octal:function(l){return l>=0?"0"+l.toString(8):"-0"+l.toString(8).slice(1)},decimal:function(l){return l.toString(10)},hexadecimal:function(l){return l>=0?"0x"+l.toString(16).toUpperCase():"-0x"+l.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(r,n,i){var o=i(38),a=i(10),s=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),c=/^[-+]?[0-9]+e/;r.exports=new a("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(l){return l!==null&&!(!s.test(l)||l[l.length-1]==="_")},construct:function(l){var f,u,d,h;return u=(f=l.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,h=[],"+-".indexOf(f[0])>=0&&(f=f.slice(1)),f===".inf"?u===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:f===".nan"?NaN:f.indexOf(":")>=0?(f.split(":").forEach(function(g){h.unshift(parseFloat(g,10))}),f=0,d=1,h.forEach(function(g){f+=g*d,d*=60}),u*f):u*parseFloat(f,10)},predicate:function(l){return Object.prototype.toString.call(l)==="[object Number]"&&(l%1!=0||o.isNegativeZero(l))},represent:function(l,f){var u;if(isNaN(l))switch(f){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===l)switch(f){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===l)switch(f){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(o.isNegativeZero(l))return"-0.0";return u=l.toString(10),c.test(u)?u.replace("e",".e"):u},defaultStyle:"lowercase"})},function(r,n,i){var o=i(10),a=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),s=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");r.exports=new o("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(c){return c!==null&&(a.exec(c)!==null||s.exec(c)!==null)},construct:function(c){var l,f,u,d,h,g,p,v,w=0,m=null;if((l=a.exec(c))===null&&(l=s.exec(c)),l===null)throw new Error("Date resolve error");if(f=+l[1],u=+l[2]-1,d=+l[3],!l[4])return new Date(Date.UTC(f,u,d));if(h=+l[4],g=+l[5],p=+l[6],l[7]){for(w=l[7].slice(0,3);w.length<3;)w+="0";w=+w}return l[9]&&(m=6e4*(60*+l[10]+ +(l[11]||0)),l[9]==="-"&&(m=-m)),v=new Date(Date.UTC(f,u,d,h,g,p,w)),m&&v.setTime(v.getTime()-m),v},instanceOf:Date,represent:function(c){return c.toISOString()}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(a){return a==="<<"||a===null}})},function(r,n,i){var o;try{o=i(145).Buffer}catch{}var a=i(10),s=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;r.exports=new a("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(c){if(c===null)return!1;var l,f,u=0,d=c.length,h=s;for(f=0;f<d;f++)if(!((l=h.indexOf(c.charAt(f)))>64)){if(l<0)return!1;u+=6}return u%8==0},construct:function(c){var l,f,u=c.replace(/[\r\n=]/g,""),d=u.length,h=s,g=0,p=[];for(l=0;l<d;l++)l%4==0&&l&&(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)),g=g<<6|h.indexOf(u.charAt(l));return(f=d%4*6)===0?(p.push(g>>16&255),p.push(g>>8&255),p.push(255&g)):f===18?(p.push(g>>10&255),p.push(g>>2&255)):f===12&&p.push(g>>4&255),o?o.from?o.from(p):new o(p):p},predicate:function(c){return o&&o.isBuffer(c)},represent:function(c){var l,f,u="",d=0,h=c.length,g=s;for(l=0;l<h;l++)l%3==0&&l&&(u+=g[d>>18&63],u+=g[d>>12&63],u+=g[d>>6&63],u+=g[63&d]),d=(d<<8)+c[l];return(f=h%3)===0?(u+=g[d>>18&63],u+=g[d>>12&63],u+=g[d>>6&63],u+=g[63&d]):f===2?(u+=g[d>>10&63],u+=g[d>>4&63],u+=g[d<<2&63],u+=g[64]):f===1&&(u+=g[d>>2&63],u+=g[d<<4&63],u+=g[64],u+=g[64]),u}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty,s=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(c){if(c===null)return!0;var l,f,u,d,h,g=[],p=c;for(l=0,f=p.length;l<f;l+=1){if(u=p[l],h=!1,s.call(u)!=="[object Object]")return!1;for(d in u)if(a.call(u,d)){if(h)return!1;h=!0}if(!h||g.indexOf(d)!==-1)return!1;g.push(d)}return!0},construct:function(c){return c!==null?c:[]}})},function(r,n,i){var o=i(10),a=Object.prototype.toString;r.exports=new o("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(s){if(s===null)return!0;var c,l,f,u,d,h=s;for(d=new Array(h.length),c=0,l=h.length;c<l;c+=1){if(f=h[c],a.call(f)!=="[object Object]"||(u=Object.keys(f)).length!==1)return!1;d[c]=[u[0],f[u[0]]]}return!0},construct:function(s){if(s===null)return[];var c,l,f,u,d,h=s;for(d=new Array(h.length),c=0,l=h.length;c<l;c+=1)f=h[c],u=Object.keys(f),d[c]=[u[0],f[u[0]]];return d}})},function(r,n,i){var o=i(10),a=Object.prototype.hasOwnProperty;r.exports=new o("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(s){if(s===null)return!0;var c,l=s;for(c in l)if(a.call(l,c)&&l[c]!==null)return!1;return!0},construct:function(s){return s!==null?s:{}}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(a){return a===void 0},represent:function(){return""}})},function(r,n,i){var o=i(10);r.exports=new o("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(a){if(a===null||a.length===0)return!1;var s=a,c=/\/([gim]*)$/.exec(a),l="";return!(s[0]==="/"&&(c&&(l=c[1]),l.length>3||s[s.length-l.length-1]!=="/"))},construct:function(a){var s=a,c=/\/([gim]*)$/.exec(a),l="";return s[0]==="/"&&(c&&(l=c[1]),s=s.slice(1,s.length-l.length-1)),new RegExp(s,l)},predicate:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},represent:function(a){var s="/"+a.source+"/";return a.global&&(s+="g"),a.multiline&&(s+="m"),a.ignoreCase&&(s+="i"),s}})},function(r,n,i){var o;try{o=i(302)}catch{typeof window<"u"&&(o=window.esprima)}var a=i(10);r.exports=new a("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(s){if(s===null)return!1;try{var c="("+s+")",l=o.parse(c,{range:!0});return l.type==="Program"&&l.body.length===1&&l.body[0].type==="ExpressionStatement"&&(l.body[0].expression.type==="ArrowFunctionExpression"||l.body[0].expression.type==="FunctionExpression")}catch{return!1}},construct:function(s){var c,l="("+s+")",f=o.parse(l,{range:!0}),u=[];if(f.type!=="Program"||f.body.length!==1||f.body[0].type!=="ExpressionStatement"||f.body[0].expression.type!=="ArrowFunctionExpression"&&f.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return f.body[0].expression.params.forEach(function(d){u.push(d.name)}),c=f.body[0].expression.body.range,f.body[0].expression.body.type==="BlockStatement"?new Function(u,l.slice(c[0]+1,c[1]-1)):new Function(u,"return "+l.slice(c[0],c[1]))},predicate:function(s){return Object.prototype.toString.call(s)==="[object Function]"},represent:function(s){return s.toString()}})},function(r,n,i){var o;o=function(){return function(a){var s={};function c(l){if(s[l])return s[l].exports;var f=s[l]={exports:{},id:l,loaded:!1};return a[l].call(f.exports,f,f.exports,c),f.loaded=!0,f.exports}return c.m=a,c.c=s,c.p="",c(0)}([function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(1),f=c(3),u=c(8),d=c(15);function h(p,v,w){var m=null,y=function(D,b){w&&w(D,b),m&&m.visit(D,b)},x=typeof w=="function"?y:null,C=!1;if(v){C=typeof v.comment=="boolean"&&v.comment;var S=typeof v.attachComment=="boolean"&&v.attachComment;(C||S)&&((m=new l.CommentHandler).attach=S,v.comment=!0,x=y)}var T,_=!1;v&&typeof v.sourceType=="string"&&(_=v.sourceType==="module"),T=v&&typeof v.jsx=="boolean"&&v.jsx?new f.JSXParser(p,v,x):new u.Parser(p,v,x);var E=_?T.parseModule():T.parseScript();return C&&m&&(E.comments=m.comments),T.config.tokens&&(E.tokens=T.tokens),T.config.tolerant&&(E.errors=T.errorHandler.errors),E}s.parse=h,s.parseModule=function(p,v,w){var m=v||{};return m.sourceType="module",h(p,m,w)},s.parseScript=function(p,v,w){var m=v||{};return m.sourceType="script",h(p,m,w)},s.tokenize=function(p,v,w){var m,y=new d.Tokenizer(p,v);m=[];try{for(;;){var x=y.getNextToken();if(!x)break;w&&(x=w(x)),m.push(x)}}catch(C){y.errorHandler.tolerate(C)}return y.errorHandler.tolerant&&(m.errors=y.errors()),m};var g=c(2);s.Syntax=g.Syntax,s.version="4.0.1"},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),f=function(){function u(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return u.prototype.insertInnerComments=function(d,h){if(d.type===l.Syntax.BlockStatement&&d.body.length===0){for(var g=[],p=this.leading.length-1;p>=0;--p){var v=this.leading[p];h.end.offset>=v.start&&(g.unshift(v.comment),this.leading.splice(p,1),this.trailing.splice(p,1))}g.length&&(d.innerComments=g)}},u.prototype.findTrailingComments=function(d){var h=[];if(this.trailing.length>0){for(var g=this.trailing.length-1;g>=0;--g){var p=this.trailing[g];p.start>=d.end.offset&&h.unshift(p.comment)}return this.trailing.length=0,h}var v=this.stack[this.stack.length-1];if(v&&v.node.trailingComments){var w=v.node.trailingComments[0];w&&w.range[0]>=d.end.offset&&(h=v.node.trailingComments,delete v.node.trailingComments)}return h},u.prototype.findLeadingComments=function(d){for(var h,g=[];this.stack.length>0&&(w=this.stack[this.stack.length-1])&&w.start>=d.start.offset;)h=w.node,this.stack.pop();if(h){for(var p=(h.leadingComments?h.leadingComments.length:0)-1;p>=0;--p){var v=h.leadingComments[p];v.range[1]<=d.start.offset&&(g.unshift(v),h.leadingComments.splice(p,1))}return h.leadingComments&&h.leadingComments.length===0&&delete h.leadingComments,g}for(p=this.leading.length-1;p>=0;--p){var w;(w=this.leading[p]).start<=d.start.offset&&(g.unshift(w.comment),this.leading.splice(p,1))}return g},u.prototype.visitNode=function(d,h){if(!(d.type===l.Syntax.Program&&d.body.length>0)){this.insertInnerComments(d,h);var g=this.findTrailingComments(h),p=this.findLeadingComments(h);p.length>0&&(d.leadingComments=p),g.length>0&&(d.trailingComments=g),this.stack.push({node:d,start:h.start.offset})}},u.prototype.visitComment=function(d,h){var g=d.type[0]==="L"?"Line":"Block",p={type:g,value:d.value};if(d.range&&(p.range=d.range),d.loc&&(p.loc=d.loc),this.comments.push(p),this.attach){var v={comment:{type:g,value:d.value,range:[h.start.offset,h.end.offset]},start:h.start.offset};d.loc&&(v.comment.loc=d.loc),d.type=g,this.leading.push(v),this.trailing.push(v)}},u.prototype.visit=function(d,h){d.type==="LineComment"||d.type==="BlockComment"?this.visitComment(d,h):this.attach&&this.visitNode(d,h)},u}();s.CommentHandler=f},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(a,s,c){var l,f=this&&this.__extends||(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,C){x.__proto__=C}||function(x,C){for(var S in C)C.hasOwnProperty(S)&&(x[S]=C[S])},function(x,C){function S(){this.constructor=x}l(x,C),x.prototype=C===null?Object.create(C):(S.prototype=C.prototype,new S)});Object.defineProperty(s,"__esModule",{value:!0});var u=c(4),d=c(5),h=c(6),g=c(7),p=c(8),v=c(13),w=c(14);function m(x){var C;switch(x.type){case h.JSXSyntax.JSXIdentifier:C=x.name;break;case h.JSXSyntax.JSXNamespacedName:var S=x;C=m(S.namespace)+":"+m(S.name);break;case h.JSXSyntax.JSXMemberExpression:var T=x;C=m(T.object)+"."+m(T.property)}return C}v.TokenName[100]="JSXIdentifier",v.TokenName[101]="JSXText";var y=function(x){function C(S,T,_){return x.call(this,S,T,_)||this}return f(C,x),C.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():x.prototype.parsePrimaryExpression.call(this)},C.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},C.prototype.finishJSX=function(){this.nextToken()},C.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},C.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},C.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},C.prototype.scanXHTMLEntity=function(S){for(var T="&",_=!0,E=!1,D=!1,b=!1;!this.scanner.eof()&&_&&!E;){var I=this.scanner.source[this.scanner.index];if(I===S)break;if(E=I===";",T+=I,++this.scanner.index,!E)switch(T.length){case 2:D=I==="#";break;case 3:D&&(_=(b=I==="x")||u.Character.isDecimalDigit(I.charCodeAt(0)),D=D&&!b);break;default:_=(_=_&&!(D&&!u.Character.isDecimalDigit(I.charCodeAt(0))))&&!(b&&!u.Character.isHexDigit(I.charCodeAt(0)))}}if(_&&E&&T.length>2){var R=T.substr(1,T.length-2);D&&R.length>1?T=String.fromCharCode(parseInt(R.substr(1),10)):b&&R.length>2?T=String.fromCharCode(parseInt("0"+R.substr(1),16)):D||b||!w.XHTMLEntities[R]||(T=w.XHTMLEntities[R])}return T},C.prototype.lexJSX=function(){var S=this.scanner.source.charCodeAt(this.scanner.index);if(S===60||S===62||S===47||S===58||S===61||S===123||S===125)return{type:7,value:I=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(S===34||S===39){for(var T=this.scanner.index,_=this.scanner.source[this.scanner.index++],E="";!this.scanner.eof()&&(R=this.scanner.source[this.scanner.index++])!==_;)E+=R==="&"?this.scanXHTMLEntity(_):R;return{type:8,value:E,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}if(S===46){var D=this.scanner.source.charCodeAt(this.scanner.index+1),b=this.scanner.source.charCodeAt(this.scanner.index+2),I=D===46&&b===46?"...":".";return T=this.scanner.index,this.scanner.index+=I.length,{type:7,value:I,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}if(S===96)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(u.Character.isIdentifierStart(S)&&S!==92){for(T=this.scanner.index,++this.scanner.index;!this.scanner.eof();){var R=this.scanner.source.charCodeAt(this.scanner.index);if(u.Character.isIdentifierPart(R)&&R!==92)++this.scanner.index;else{if(R!==45)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(T,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:T,end:this.scanner.index}}return this.scanner.lex()},C.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var S=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(S)),S},C.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var S=this.scanner.index,T="";!this.scanner.eof();){var _=this.scanner.source[this.scanner.index];if(_==="{"||_==="<")break;++this.scanner.index,T+=_,u.Character.isLineTerminator(_.charCodeAt(0))&&(++this.scanner.lineNumber,_==="\r"&&this.scanner.source[this.scanner.index]===`
`&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var E={type:101,value:T,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:S,end:this.scanner.index};return T.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(E)),E},C.prototype.peekJSXToken=function(){var S=this.scanner.saveState();this.scanner.scanComments();var T=this.lexJSX();return this.scanner.restoreState(S),T},C.prototype.expectJSX=function(S){var T=this.nextJSXToken();T.type===7&&T.value===S||this.throwUnexpectedToken(T)},C.prototype.matchJSX=function(S){var T=this.peekJSXToken();return T.type===7&&T.value===S},C.prototype.parseJSXIdentifier=function(){var S=this.createJSXNode(),T=this.nextJSXToken();return T.type!==100&&this.throwUnexpectedToken(T),this.finalize(S,new d.JSXIdentifier(T.value))},C.prototype.parseJSXElementName=function(){var S=this.createJSXNode(),T=this.parseJSXIdentifier();if(this.matchJSX(":")){var _=T;this.expectJSX(":");var E=this.parseJSXIdentifier();T=this.finalize(S,new d.JSXNamespacedName(_,E))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var D=T;this.expectJSX(".");var b=this.parseJSXIdentifier();T=this.finalize(S,new d.JSXMemberExpression(D,b))}return T},C.prototype.parseJSXAttributeName=function(){var S,T=this.createJSXNode(),_=this.parseJSXIdentifier();if(this.matchJSX(":")){var E=_;this.expectJSX(":");var D=this.parseJSXIdentifier();S=this.finalize(T,new d.JSXNamespacedName(E,D))}else S=_;return S},C.prototype.parseJSXStringLiteralAttribute=function(){var S=this.createJSXNode(),T=this.nextJSXToken();T.type!==8&&this.throwUnexpectedToken(T);var _=this.getTokenRaw(T);return this.finalize(S,new g.Literal(T.value,_))},C.prototype.parseJSXExpressionAttribute=function(){var S=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var T=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(S,new d.JSXExpressionContainer(T))},C.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},C.prototype.parseJSXNameValueAttribute=function(){var S=this.createJSXNode(),T=this.parseJSXAttributeName(),_=null;return this.matchJSX("=")&&(this.expectJSX("="),_=this.parseJSXAttributeValue()),this.finalize(S,new d.JSXAttribute(T,_))},C.prototype.parseJSXSpreadAttribute=function(){var S=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var T=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(S,new d.JSXSpreadAttribute(T))},C.prototype.parseJSXAttributes=function(){for(var S=[];!this.matchJSX("/")&&!this.matchJSX(">");){var T=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();S.push(T)}return S},C.prototype.parseJSXOpeningElement=function(){var S=this.createJSXNode();this.expectJSX("<");var T=this.parseJSXElementName(),_=this.parseJSXAttributes(),E=this.matchJSX("/");return E&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(S,new d.JSXOpeningElement(T,E,_))},C.prototype.parseJSXBoundaryElement=function(){var S=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var T=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(S,new d.JSXClosingElement(T))}var _=this.parseJSXElementName(),E=this.parseJSXAttributes(),D=this.matchJSX("/");return D&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(S,new d.JSXOpeningElement(_,D,E))},C.prototype.parseJSXEmptyExpression=function(){var S=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(S,new d.JSXEmptyExpression)},C.prototype.parseJSXExpressionContainer=function(){var S,T=this.createJSXNode();return this.expectJSX("{"),this.matchJSX("}")?(S=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),S=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(T,new d.JSXExpressionContainer(S))},C.prototype.parseJSXChildren=function(){for(var S=[];!this.scanner.eof();){var T=this.createJSXChildNode(),_=this.nextJSXText();if(_.start<_.end){var E=this.getTokenRaw(_),D=this.finalize(T,new d.JSXText(_.value,E));S.push(D)}if(this.scanner.source[this.scanner.index]!=="{")break;var b=this.parseJSXExpressionContainer();S.push(b)}return S},C.prototype.parseComplexJSXElement=function(S){for(var T=[];!this.scanner.eof();){S.children=S.children.concat(this.parseJSXChildren());var _=this.createJSXChildNode(),E=this.parseJSXBoundaryElement();if(E.type===h.JSXSyntax.JSXOpeningElement){var D=E;if(D.selfClosing){var b=this.finalize(_,new d.JSXElement(D,[],null));S.children.push(b)}else T.push(S),S={node:_,opening:D,closing:null,children:[]}}if(E.type===h.JSXSyntax.JSXClosingElement){S.closing=E;var I=m(S.opening.name);if(I!==m(S.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",I),!(T.length>0))break;b=this.finalize(S.node,new d.JSXElement(S.opening,S.children,S.closing)),(S=T[T.length-1]).children.push(b),T.pop()}}return S},C.prototype.parseJSXElement=function(){var S=this.createJSXNode(),T=this.parseJSXOpeningElement(),_=[],E=null;if(!T.selfClosing){var D=this.parseComplexJSXElement({node:S,opening:T,closing:E,children:_});_=D.children,E=D.closing}return this.finalize(S,new d.JSXElement(T,_,E))},C.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var S=this.parseJSXElement();return this.finishJSX(),S},C.prototype.isStartOfExpression=function(){return x.prototype.isStartOfExpression.call(this)||this.match("<")},C}(p.Parser);s.JSXParser=y},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};s.Character={fromCodePoint:function(l){return l<65536?String.fromCharCode(l):String.fromCharCode(55296+(l-65536>>10))+String.fromCharCode(56320+(l-65536&1023))},isWhiteSpace:function(l){return l===32||l===9||l===11||l===12||l===160||l>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(l)>=0},isLineTerminator:function(l){return l===10||l===13||l===8232||l===8233},isIdentifierStart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l===92||l>=128&&c.NonAsciiIdentifierStart.test(s.Character.fromCodePoint(l))},isIdentifierPart:function(l){return l===36||l===95||l>=65&&l<=90||l>=97&&l<=122||l>=48&&l<=57||l===92||l>=128&&c.NonAsciiIdentifierPart.test(s.Character.fromCodePoint(l))},isDecimalDigit:function(l){return l>=48&&l<=57},isHexDigit:function(l){return l>=48&&l<=57||l>=65&&l<=70||l>=97&&l<=102},isOctalDigit:function(l){return l>=48&&l<=55}}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(6),f=function(C){this.type=l.JSXSyntax.JSXClosingElement,this.name=C};s.JSXClosingElement=f;var u=function(C,S,T){this.type=l.JSXSyntax.JSXElement,this.openingElement=C,this.children=S,this.closingElement=T};s.JSXElement=u;var d=function(){this.type=l.JSXSyntax.JSXEmptyExpression};s.JSXEmptyExpression=d;var h=function(C){this.type=l.JSXSyntax.JSXExpressionContainer,this.expression=C};s.JSXExpressionContainer=h;var g=function(C){this.type=l.JSXSyntax.JSXIdentifier,this.name=C};s.JSXIdentifier=g;var p=function(C,S){this.type=l.JSXSyntax.JSXMemberExpression,this.object=C,this.property=S};s.JSXMemberExpression=p;var v=function(C,S){this.type=l.JSXSyntax.JSXAttribute,this.name=C,this.value=S};s.JSXAttribute=v;var w=function(C,S){this.type=l.JSXSyntax.JSXNamespacedName,this.namespace=C,this.name=S};s.JSXNamespacedName=w;var m=function(C,S,T){this.type=l.JSXSyntax.JSXOpeningElement,this.name=C,this.selfClosing=S,this.attributes=T};s.JSXOpeningElement=m;var y=function(C){this.type=l.JSXSyntax.JSXSpreadAttribute,this.argument=C};s.JSXSpreadAttribute=y;var x=function(C,S){this.type=l.JSXSyntax.JSXText,this.value=C,this.raw=S};s.JSXText=x},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(2),f=function(Ue){this.type=l.Syntax.ArrayExpression,this.elements=Ue};s.ArrayExpression=f;var u=function(Ue){this.type=l.Syntax.ArrayPattern,this.elements=Ue};s.ArrayPattern=u;var d=function(Ue,nt,Mt){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Ue,this.body=nt,this.generator=!1,this.expression=Mt,this.async=!1};s.ArrowFunctionExpression=d;var h=function(Ue,nt,Mt){this.type=l.Syntax.AssignmentExpression,this.operator=Ue,this.left=nt,this.right=Mt};s.AssignmentExpression=h;var g=function(Ue,nt){this.type=l.Syntax.AssignmentPattern,this.left=Ue,this.right=nt};s.AssignmentPattern=g;var p=function(Ue,nt,Mt){this.type=l.Syntax.ArrowFunctionExpression,this.id=null,this.params=Ue,this.body=nt,this.generator=!1,this.expression=Mt,this.async=!0};s.AsyncArrowFunctionExpression=p;var v=function(Ue,nt,Mt){this.type=l.Syntax.FunctionDeclaration,this.id=Ue,this.params=nt,this.body=Mt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionDeclaration=v;var w=function(Ue,nt,Mt){this.type=l.Syntax.FunctionExpression,this.id=Ue,this.params=nt,this.body=Mt,this.generator=!1,this.expression=!1,this.async=!0};s.AsyncFunctionExpression=w;var m=function(Ue){this.type=l.Syntax.AwaitExpression,this.argument=Ue};s.AwaitExpression=m;var y=function(Ue,nt,Mt){var pn=Ue==="||"||Ue==="&&";this.type=pn?l.Syntax.LogicalExpression:l.Syntax.BinaryExpression,this.operator=Ue,this.left=nt,this.right=Mt};s.BinaryExpression=y;var x=function(Ue){this.type=l.Syntax.BlockStatement,this.body=Ue};s.BlockStatement=x;var C=function(Ue){this.type=l.Syntax.BreakStatement,this.label=Ue};s.BreakStatement=C;var S=function(Ue,nt){this.type=l.Syntax.CallExpression,this.callee=Ue,this.arguments=nt};s.CallExpression=S;var T=function(Ue,nt){this.type=l.Syntax.CatchClause,this.param=Ue,this.body=nt};s.CatchClause=T;var _=function(Ue){this.type=l.Syntax.ClassBody,this.body=Ue};s.ClassBody=_;var E=function(Ue,nt,Mt){this.type=l.Syntax.ClassDeclaration,this.id=Ue,this.superClass=nt,this.body=Mt};s.ClassDeclaration=E;var D=function(Ue,nt,Mt){this.type=l.Syntax.ClassExpression,this.id=Ue,this.superClass=nt,this.body=Mt};s.ClassExpression=D;var b=function(Ue,nt){this.type=l.Syntax.MemberExpression,this.computed=!0,this.object=Ue,this.property=nt};s.ComputedMemberExpression=b;var I=function(Ue,nt,Mt){this.type=l.Syntax.ConditionalExpression,this.test=Ue,this.consequent=nt,this.alternate=Mt};s.ConditionalExpression=I;var R=function(Ue){this.type=l.Syntax.ContinueStatement,this.label=Ue};s.ContinueStatement=R;var M=function(){this.type=l.Syntax.DebuggerStatement};s.DebuggerStatement=M;var P=function(Ue,nt){this.type=l.Syntax.ExpressionStatement,this.expression=Ue,this.directive=nt};s.Directive=P;var k=function(Ue,nt){this.type=l.Syntax.DoWhileStatement,this.body=Ue,this.test=nt};s.DoWhileStatement=k;var z=function(){this.type=l.Syntax.EmptyStatement};s.EmptyStatement=z;var A=function(Ue){this.type=l.Syntax.ExportAllDeclaration,this.source=Ue};s.ExportAllDeclaration=A;var L=function(Ue){this.type=l.Syntax.ExportDefaultDeclaration,this.declaration=Ue};s.ExportDefaultDeclaration=L;var N=function(Ue,nt,Mt){this.type=l.Syntax.ExportNamedDeclaration,this.declaration=Ue,this.specifiers=nt,this.source=Mt};s.ExportNamedDeclaration=N;var H=function(Ue,nt){this.type=l.Syntax.ExportSpecifier,this.exported=nt,this.local=Ue};s.ExportSpecifier=H;var ee=function(Ue){this.type=l.Syntax.ExpressionStatement,this.expression=Ue};s.ExpressionStatement=ee;var oe=function(Ue,nt,Mt){this.type=l.Syntax.ForInStatement,this.left=Ue,this.right=nt,this.body=Mt,this.each=!1};s.ForInStatement=oe;var de=function(Ue,nt,Mt){this.type=l.Syntax.ForOfStatement,this.left=Ue,this.right=nt,this.body=Mt};s.ForOfStatement=de;var ue=function(Ue,nt,Mt,pn){this.type=l.Syntax.ForStatement,this.init=Ue,this.test=nt,this.update=Mt,this.body=pn};s.ForStatement=ue;var me=function(Ue,nt,Mt,pn){this.type=l.Syntax.FunctionDeclaration,this.id=Ue,this.params=nt,this.body=Mt,this.generator=pn,this.expression=!1,this.async=!1};s.FunctionDeclaration=me;var Ee=function(Ue,nt,Mt,pn){this.type=l.Syntax.FunctionExpression,this.id=Ue,this.params=nt,this.body=Mt,this.generator=pn,this.expression=!1,this.async=!1};s.FunctionExpression=Ee;var _e=function(Ue){this.type=l.Syntax.Identifier,this.name=Ue};s.Identifier=_e;var Ce=function(Ue,nt,Mt){this.type=l.Syntax.IfStatement,this.test=Ue,this.consequent=nt,this.alternate=Mt};s.IfStatement=Ce;var F=function(Ue,nt){this.type=l.Syntax.ImportDeclaration,this.specifiers=Ue,this.source=nt};s.ImportDeclaration=F;var O=function(Ue){this.type=l.Syntax.ImportDefaultSpecifier,this.local=Ue};s.ImportDefaultSpecifier=O;var $=function(Ue){this.type=l.Syntax.ImportNamespaceSpecifier,this.local=Ue};s.ImportNamespaceSpecifier=$;var W=function(Ue,nt){this.type=l.Syntax.ImportSpecifier,this.local=Ue,this.imported=nt};s.ImportSpecifier=W;var X=function(Ue,nt){this.type=l.Syntax.LabeledStatement,this.label=Ue,this.body=nt};s.LabeledStatement=X;var Z=function(Ue,nt){this.type=l.Syntax.Literal,this.value=Ue,this.raw=nt};s.Literal=Z;var ne=function(Ue,nt){this.type=l.Syntax.MetaProperty,this.meta=Ue,this.property=nt};s.MetaProperty=ne;var xe=function(Ue,nt,Mt,pn,ni){this.type=l.Syntax.MethodDefinition,this.key=Ue,this.computed=nt,this.value=Mt,this.kind=pn,this.static=ni};s.MethodDefinition=xe;var Ie=function(Ue){this.type=l.Syntax.Program,this.body=Ue,this.sourceType="module"};s.Module=Ie;var Le=function(Ue,nt){this.type=l.Syntax.NewExpression,this.callee=Ue,this.arguments=nt};s.NewExpression=Le;var je=function(Ue){this.type=l.Syntax.ObjectExpression,this.properties=Ue};s.ObjectExpression=je;var ie=function(Ue){this.type=l.Syntax.ObjectPattern,this.properties=Ue};s.ObjectPattern=ie;var ae=function(Ue,nt,Mt,pn,ni,Ot){this.type=l.Syntax.Property,this.key=nt,this.computed=Mt,this.value=pn,this.kind=Ue,this.method=ni,this.shorthand=Ot};s.Property=ae;var ve=function(Ue,nt,Mt,pn){this.type=l.Syntax.Literal,this.value=Ue,this.raw=nt,this.regex={pattern:Mt,flags:pn}};s.RegexLiteral=ve;var se=function(Ue){this.type=l.Syntax.RestElement,this.argument=Ue};s.RestElement=se;var ge=function(Ue){this.type=l.Syntax.ReturnStatement,this.argument=Ue};s.ReturnStatement=ge;var Ve=function(Ue){this.type=l.Syntax.Program,this.body=Ue,this.sourceType="script"};s.Script=Ve;var re=function(Ue){this.type=l.Syntax.SequenceExpression,this.expressions=Ue};s.SequenceExpression=re;var it=function(Ue){this.type=l.Syntax.SpreadElement,this.argument=Ue};s.SpreadElement=it;var ut=function(Ue,nt){this.type=l.Syntax.MemberExpression,this.computed=!1,this.object=Ue,this.property=nt};s.StaticMemberExpression=ut;var ot=function(){this.type=l.Syntax.Super};s.Super=ot;var Se=function(Ue,nt){this.type=l.Syntax.SwitchCase,this.test=Ue,this.consequent=nt};s.SwitchCase=Se;var Ge=function(Ue,nt){this.type=l.Syntax.SwitchStatement,this.discriminant=Ue,this.cases=nt};s.SwitchStatement=Ge;var et=function(Ue,nt){this.type=l.Syntax.TaggedTemplateExpression,this.tag=Ue,this.quasi=nt};s.TaggedTemplateExpression=et;var qe=function(Ue,nt){this.type=l.Syntax.TemplateElement,this.value=Ue,this.tail=nt};s.TemplateElement=qe;var st=function(Ue,nt){this.type=l.Syntax.TemplateLiteral,this.quasis=Ue,this.expressions=nt};s.TemplateLiteral=st;var Et=function(){this.type=l.Syntax.ThisExpression};s.ThisExpression=Et;var ct=function(Ue){this.type=l.Syntax.ThrowStatement,this.argument=Ue};s.ThrowStatement=ct;var bt=function(Ue,nt,Mt){this.type=l.Syntax.TryStatement,this.block=Ue,this.handler=nt,this.finalizer=Mt};s.TryStatement=bt;var It=function(Ue,nt){this.type=l.Syntax.UnaryExpression,this.operator=Ue,this.argument=nt,this.prefix=!0};s.UnaryExpression=It;var ln=function(Ue,nt,Mt){this.type=l.Syntax.UpdateExpression,this.operator=Ue,this.argument=nt,this.prefix=Mt};s.UpdateExpression=ln;var Pn=function(Ue,nt){this.type=l.Syntax.VariableDeclaration,this.declarations=Ue,this.kind=nt};s.VariableDeclaration=Pn;var zt=function(Ue,nt){this.type=l.Syntax.VariableDeclarator,this.id=Ue,this.init=nt};s.VariableDeclarator=zt;var Tn=function(Ue,nt){this.type=l.Syntax.WhileStatement,this.test=Ue,this.body=nt};s.WhileStatement=Tn;var ui=function(Ue,nt){this.type=l.Syntax.WithStatement,this.object=Ue,this.body=nt};s.WithStatement=ui;var Ur=function(Ue,nt){this.type=l.Syntax.YieldExpression,this.argument=Ue,this.delegate=nt};s.YieldExpression=Ur},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),f=c(10),u=c(11),d=c(7),h=c(12),g=c(2),p=c(13),v=function(){function w(m,y,x){y===void 0&&(y={}),this.config={range:typeof y.range=="boolean"&&y.range,loc:typeof y.loc=="boolean"&&y.loc,source:null,tokens:typeof y.tokens=="boolean"&&y.tokens,comment:typeof y.comment=="boolean"&&y.comment,tolerant:typeof y.tolerant=="boolean"&&y.tolerant},this.config.loc&&y.source&&y.source!==null&&(this.config.source=String(y.source)),this.delegate=x,this.errorHandler=new f.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new h.Scanner(m,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return w.prototype.throwError=function(m){for(var y=[],x=1;x<arguments.length;x++)y[x-1]=arguments[x];var C=Array.prototype.slice.call(arguments,1),S=m.replace(/%(\d)/g,function(D,b){return l.assert(b<C.length,"Message reference must be in range"),C[b]}),T=this.lastMarker.index,_=this.lastMarker.line,E=this.lastMarker.column+1;throw this.errorHandler.createError(T,_,E,S)},w.prototype.tolerateError=function(m){for(var y=[],x=1;x<arguments.length;x++)y[x-1]=arguments[x];var C=Array.prototype.slice.call(arguments,1),S=m.replace(/%(\d)/g,function(D,b){return l.assert(b<C.length,"Message reference must be in range"),C[b]}),T=this.lastMarker.index,_=this.scanner.lineNumber,E=this.lastMarker.column+1;this.errorHandler.tolerateError(T,_,E,S)},w.prototype.unexpectedTokenError=function(m,y){var x,C=y||u.Messages.UnexpectedToken;if(m?(y||(C=m.type===2?u.Messages.UnexpectedEOS:m.type===3?u.Messages.UnexpectedIdentifier:m.type===6?u.Messages.UnexpectedNumber:m.type===8?u.Messages.UnexpectedString:m.type===10?u.Messages.UnexpectedTemplate:u.Messages.UnexpectedToken,m.type===4&&(this.scanner.isFutureReservedWord(m.value)?C=u.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(m.value)&&(C=u.Messages.StrictReservedWord))),x=m.value):x="ILLEGAL",C=C.replace("%0",x),m&&typeof m.lineNumber=="number"){var S=m.start,T=m.lineNumber,_=this.lastMarker.index-this.lastMarker.column,E=m.start-_+1;return this.errorHandler.createError(S,T,E,C)}return S=this.lastMarker.index,T=this.lastMarker.line,E=this.lastMarker.column+1,this.errorHandler.createError(S,T,E,C)},w.prototype.throwUnexpectedToken=function(m,y){throw this.unexpectedTokenError(m,y)},w.prototype.tolerateUnexpectedToken=function(m,y){this.errorHandler.tolerate(this.unexpectedTokenError(m,y))},w.prototype.collectComments=function(){if(this.config.comment){var m=this.scanner.scanComments();if(m.length>0&&this.delegate)for(var y=0;y<m.length;++y){var x=m[y],C=void 0;C={type:x.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(x.slice[0],x.slice[1])},this.config.range&&(C.range=x.range),this.config.loc&&(C.loc=x.loc);var S={start:{line:x.loc.start.line,column:x.loc.start.column,offset:x.range[0]},end:{line:x.loc.end.line,column:x.loc.end.column,offset:x.range[1]}};this.delegate(C,S)}}else this.scanner.scanComments()},w.prototype.getTokenRaw=function(m){return this.scanner.source.slice(m.start,m.end)},w.prototype.convertToken=function(m){var y={type:p.TokenName[m.type],value:this.getTokenRaw(m)};if(this.config.range&&(y.range=[m.start,m.end]),this.config.loc&&(y.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),m.type===9){var x=m.pattern,C=m.flags;y.regex={pattern:x,flags:C}}return y},w.prototype.nextToken=function(){var m=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var y=this.scanner.lex();return this.hasLineTerminator=m.lineNumber!==y.lineNumber,y&&this.context.strict&&y.type===3&&this.scanner.isStrictModeReservedWord(y.value)&&(y.type=4),this.lookahead=y,this.config.tokens&&y.type!==2&&this.tokens.push(this.convertToken(y)),m},w.prototype.nextRegexToken=function(){this.collectComments();var m=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(m))),this.lookahead=m,this.nextToken(),m},w.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},w.prototype.startNode=function(m,y){y===void 0&&(y=0);var x=m.start-m.lineStart,C=m.lineNumber;return x<0&&(x+=y,C--),{index:m.start,line:C,column:x}},w.prototype.finalize=function(m,y){if(this.config.range&&(y.range=[m.index,this.lastMarker.index]),this.config.loc&&(y.loc={start:{line:m.line,column:m.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(y.loc.source=this.config.source)),this.delegate){var x={start:{line:m.line,column:m.column,offset:m.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(y,x)}return y},w.prototype.expect=function(m){var y=this.nextToken();y.type===7&&y.value===m||this.throwUnexpectedToken(y)},w.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var m=this.lookahead;m.type===7&&m.value===","?this.nextToken():m.type===7&&m.value===";"?(this.nextToken(),this.tolerateUnexpectedToken(m)):this.tolerateUnexpectedToken(m,u.Messages.UnexpectedToken)}else this.expect(",")},w.prototype.expectKeyword=function(m){var y=this.nextToken();y.type===4&&y.value===m||this.throwUnexpectedToken(y)},w.prototype.match=function(m){return this.lookahead.type===7&&this.lookahead.value===m},w.prototype.matchKeyword=function(m){return this.lookahead.type===4&&this.lookahead.value===m},w.prototype.matchContextualKeyword=function(m){return this.lookahead.type===3&&this.lookahead.value===m},w.prototype.matchAssign=function(){if(this.lookahead.type!==7)return!1;var m=this.lookahead.value;return m==="="||m==="*="||m==="**="||m==="/="||m==="%="||m==="+="||m==="-="||m==="<<="||m===">>="||m===">>>="||m==="&="||m==="^="||m==="|="},w.prototype.isolateCoverGrammar=function(m){var y=this.context.isBindingElement,x=this.context.isAssignmentTarget,C=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var S=m.call(this);return this.context.firstCoverInitializedNameError!==null&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=y,this.context.isAssignmentTarget=x,this.context.firstCoverInitializedNameError=C,S},w.prototype.inheritCoverGrammar=function(m){var y=this.context.isBindingElement,x=this.context.isAssignmentTarget,C=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var S=m.call(this);return this.context.isBindingElement=this.context.isBindingElement&&y,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&x,this.context.firstCoverInitializedNameError=C||this.context.firstCoverInitializedNameError,S},w.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===2||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},w.prototype.parsePrimaryExpression=function(){var m,y,x,C=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&this.lookahead.value==="await"&&this.tolerateUnexpectedToken(this.lookahead),m=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(C,new d.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,u.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),x=this.getTokenRaw(y),m=this.finalize(C,new d.Literal(y.value,x));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),x=this.getTokenRaw(y),m=this.finalize(C,new d.Literal(y.value==="true",x));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,y=this.nextToken(),x=this.getTokenRaw(y),m=this.finalize(C,new d.Literal(null,x));break;case 10:m=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,m=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":m=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":m=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,y=this.nextRegexToken(),x=this.getTokenRaw(y),m=this.finalize(C,new d.RegexLiteral(y.regex,x,y.pattern,y.flags));break;default:m=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?m=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?m=this.finalize(C,new d.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?m=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),m=this.finalize(C,new d.ThisExpression)):m=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:m=this.throwUnexpectedToken(this.nextToken())}return m},w.prototype.parseSpreadElement=function(){var m=this.createNode();this.expect("...");var y=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(m,new d.SpreadElement(y))},w.prototype.parseArrayInitializer=function(){var m=this.createNode(),y=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),y.push(null);else if(this.match("...")){var x=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),y.push(x)}else y.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(m,new d.ArrayExpression(y))},w.prototype.parsePropertyMethod=function(m){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var y=this.context.strict,x=this.context.allowStrictDirective;this.context.allowStrictDirective=m.simple;var C=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&m.firstRestricted&&this.tolerateUnexpectedToken(m.firstRestricted,m.message),this.context.strict&&m.stricted&&this.tolerateUnexpectedToken(m.stricted,m.message),this.context.strict=y,this.context.allowStrictDirective=x,C},w.prototype.parsePropertyMethodFunction=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var x=this.parseFormalParameters(),C=this.parsePropertyMethod(x);return this.context.allowYield=y,this.finalize(m,new d.FunctionExpression(null,x.params,C,!1))},w.prototype.parsePropertyMethodAsyncFunction=function(){var m=this.createNode(),y=this.context.allowYield,x=this.context.await;this.context.allowYield=!1,this.context.await=!0;var C=this.parseFormalParameters(),S=this.parsePropertyMethod(C);return this.context.allowYield=y,this.context.await=x,this.finalize(m,new d.AsyncFunctionExpression(null,C.params,S))},w.prototype.parseObjectPropertyKey=function(){var m,y=this.createNode(),x=this.nextToken();switch(x.type){case 8:case 6:this.context.strict&&x.octal&&this.tolerateUnexpectedToken(x,u.Messages.StrictOctalLiteral);var C=this.getTokenRaw(x);m=this.finalize(y,new d.Literal(x.value,C));break;case 3:case 1:case 5:case 4:m=this.finalize(y,new d.Identifier(x.value));break;case 7:x.value==="["?(m=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):m=this.throwUnexpectedToken(x);break;default:m=this.throwUnexpectedToken(x)}return m},w.prototype.isPropertyKey=function(m,y){return m.type===g.Syntax.Identifier&&m.name===y||m.type===g.Syntax.Literal&&m.value===y},w.prototype.parseObjectProperty=function(m){var y,x=this.createNode(),C=this.lookahead,S=null,T=null,_=!1,E=!1,D=!1,b=!1;if(C.type===3){var I=C.value;this.nextToken(),_=this.match("["),S=(b=!(this.hasLineTerminator||I!=="async"||this.match(":")||this.match("(")||this.match("*")||this.match(",")))?this.parseObjectPropertyKey():this.finalize(x,new d.Identifier(I))}else this.match("*")?this.nextToken():(_=this.match("["),S=this.parseObjectPropertyKey());var R=this.qualifiedPropertyName(this.lookahead);if(C.type===3&&!b&&C.value==="get"&&R)y="get",_=this.match("["),S=this.parseObjectPropertyKey(),this.context.allowYield=!1,T=this.parseGetterMethod();else if(C.type===3&&!b&&C.value==="set"&&R)y="set",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseSetterMethod();else if(C.type===7&&C.value==="*"&&R)y="init",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseGeneratorMethod(),E=!0;else if(S||this.throwUnexpectedToken(this.lookahead),y="init",this.match(":")&&!b)!_&&this.isPropertyKey(S,"__proto__")&&(m.value&&this.tolerateError(u.Messages.DuplicateProtoProperty),m.value=!0),this.nextToken(),T=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))T=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0;else if(C.type===3)if(I=this.finalize(x,new d.Identifier(C.value)),this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),D=!0;var M=this.isolateCoverGrammar(this.parseAssignmentExpression);T=this.finalize(x,new d.AssignmentPattern(I,M))}else D=!0,T=I;else this.throwUnexpectedToken(this.nextToken());return this.finalize(x,new d.Property(y,S,_,T,E,D))},w.prototype.parseObjectInitializer=function(){var m=this.createNode();this.expect("{");for(var y=[],x={value:!1};!this.match("}");)y.push(this.parseObjectProperty(x)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(m,new d.ObjectExpression(y))},w.prototype.parseTemplateHead=function(){l.assert(this.lookahead.head,"Template literal must start with a template head");var m=this.createNode(),y=this.nextToken(),x=y.value,C=y.cooked;return this.finalize(m,new d.TemplateElement({raw:x,cooked:C},y.tail))},w.prototype.parseTemplateElement=function(){this.lookahead.type!==10&&this.throwUnexpectedToken();var m=this.createNode(),y=this.nextToken(),x=y.value,C=y.cooked;return this.finalize(m,new d.TemplateElement({raw:x,cooked:C},y.tail))},w.prototype.parseTemplateLiteral=function(){var m=this.createNode(),y=[],x=[],C=this.parseTemplateHead();for(x.push(C);!C.tail;)y.push(this.parseExpression()),C=this.parseTemplateElement(),x.push(C);return this.finalize(m,new d.TemplateLiteral(x,y))},w.prototype.reinterpretExpressionAsPattern=function(m){switch(m.type){case g.Syntax.Identifier:case g.Syntax.MemberExpression:case g.Syntax.RestElement:case g.Syntax.AssignmentPattern:break;case g.Syntax.SpreadElement:m.type=g.Syntax.RestElement,this.reinterpretExpressionAsPattern(m.argument);break;case g.Syntax.ArrayExpression:m.type=g.Syntax.ArrayPattern;for(var y=0;y<m.elements.length;y++)m.elements[y]!==null&&this.reinterpretExpressionAsPattern(m.elements[y]);break;case g.Syntax.ObjectExpression:for(m.type=g.Syntax.ObjectPattern,y=0;y<m.properties.length;y++)this.reinterpretExpressionAsPattern(m.properties[y].value);break;case g.Syntax.AssignmentExpression:m.type=g.Syntax.AssignmentPattern,delete m.operator,this.reinterpretExpressionAsPattern(m.left)}},w.prototype.parseGroupExpression=function(){var m;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),m={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var y=this.lookahead,x=[];if(this.match("..."))m=this.parseRestElement(x),this.expect(")"),this.match("=>")||this.expect("=>"),m={type:"ArrowParameterPlaceHolder",params:[m],async:!1};else{var C=!1;if(this.context.isBindingElement=!0,m=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var S=[];for(this.context.isAssignmentTarget=!1,S.push(m);this.lookahead.type!==2&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(var T=0;T<S.length;T++)this.reinterpretExpressionAsPattern(S[T]);C=!0,m={type:"ArrowParameterPlaceHolder",params:S,async:!1}}else if(this.match("...")){for(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),S.push(this.parseRestElement(x)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1,T=0;T<S.length;T++)this.reinterpretExpressionAsPattern(S[T]);C=!0,m={type:"ArrowParameterPlaceHolder",params:S,async:!1}}else S.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(C)break}C||(m=this.finalize(this.startNode(y),new d.SequenceExpression(S)))}if(!C){if(this.expect(")"),this.match("=>")&&(m.type===g.Syntax.Identifier&&m.name==="yield"&&(C=!0,m={type:"ArrowParameterPlaceHolder",params:[m],async:!1}),!C)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),m.type===g.Syntax.SequenceExpression)for(T=0;T<m.expressions.length;T++)this.reinterpretExpressionAsPattern(m.expressions[T]);else this.reinterpretExpressionAsPattern(m);m={type:"ArrowParameterPlaceHolder",params:m.type===g.Syntax.SequenceExpression?m.expressions:[m],async:!1}}this.context.isBindingElement=!1}}}return m},w.prototype.parseArguments=function(){this.expect("(");var m=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(m.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),m},w.prototype.isIdentifierName=function(m){return m.type===3||m.type===4||m.type===1||m.type===5},w.prototype.parseIdentifierName=function(){var m=this.createNode(),y=this.nextToken();return this.isIdentifierName(y)||this.throwUnexpectedToken(y),this.finalize(m,new d.Identifier(y.value))},w.prototype.parseNewExpression=function(){var m,y=this.createNode(),x=this.parseIdentifierName();if(l.assert(x.name==="new","New expression must start with `new`"),this.match("."))if(this.nextToken(),this.lookahead.type===3&&this.context.inFunctionBody&&this.lookahead.value==="target"){var C=this.parseIdentifierName();m=new d.MetaProperty(x,C)}else this.throwUnexpectedToken(this.lookahead);else{var S=this.isolateCoverGrammar(this.parseLeftHandSideExpression),T=this.match("(")?this.parseArguments():[];m=new d.NewExpression(S,T),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(y,m)},w.prototype.parseAsyncArgument=function(){var m=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,m},w.prototype.parseAsyncArguments=function(){this.expect("(");var m=[];if(!this.match(")"))for(;;){var y=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(m.push(y),this.match(")")||(this.expectCommaSeparator(),this.match(")")))break}return this.expect(")"),m},w.prototype.parseLeftHandSideExpressionAllowCall=function(){var m,y=this.lookahead,x=this.matchContextualKeyword("async"),C=this.context.allowIn;for(this.context.allowIn=!0,this.matchKeyword("super")&&this.context.inFunctionBody?(m=this.createNode(),this.nextToken(),m=this.finalize(m,new d.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):m=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var S=this.parseIdentifierName();m=this.finalize(this.startNode(y),new d.StaticMemberExpression(m,S))}else if(this.match("(")){var T=x&&y.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var _=T?this.parseAsyncArguments():this.parseArguments();if(m=this.finalize(this.startNode(y),new d.CallExpression(m,_)),T&&this.match("=>")){for(var E=0;E<_.length;++E)this.reinterpretExpressionAsPattern(_[E]);m={type:"ArrowParameterPlaceHolder",params:_,async:!0}}}else if(this.match("["))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("["),S=this.isolateCoverGrammar(this.parseExpression),this.expect("]"),m=this.finalize(this.startNode(y),new d.ComputedMemberExpression(m,S));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var D=this.parseTemplateLiteral();m=this.finalize(this.startNode(y),new d.TaggedTemplateExpression(m,D))}return this.context.allowIn=C,m},w.prototype.parseSuper=function(){var m=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(m,new d.Super)},w.prototype.parseLeftHandSideExpression=function(){l.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var m=this.startNode(this.lookahead),y=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var x=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),y=this.finalize(m,new d.ComputedMemberExpression(y,x))}else if(this.match("."))this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("."),x=this.parseIdentifierName(),y=this.finalize(m,new d.StaticMemberExpression(y,x));else{if(this.lookahead.type!==10||!this.lookahead.head)break;var C=this.parseTemplateLiteral();y=this.finalize(m,new d.TaggedTemplateExpression(y,C))}return y},w.prototype.parseUpdateExpression=function(){var m,y=this.lookahead;if(this.match("++")||this.match("--")){var x=this.startNode(y),C=this.nextToken();m=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&m.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(m.name)&&this.tolerateError(u.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment);var S=!0;m=this.finalize(x,new d.UpdateExpression(C.value,m,S)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(m=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===7&&(this.match("++")||this.match("--"))){this.context.strict&&m.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(m.name)&&this.tolerateError(u.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var T=this.nextToken().value;S=!1,m=this.finalize(this.startNode(y),new d.UpdateExpression(T,m,S))}return m},w.prototype.parseAwaitExpression=function(){var m=this.createNode();this.nextToken();var y=this.parseUnaryExpression();return this.finalize(m,new d.AwaitExpression(y))},w.prototype.parseUnaryExpression=function(){var m;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var y=this.startNode(this.lookahead),x=this.nextToken();m=this.inheritCoverGrammar(this.parseUnaryExpression),m=this.finalize(y,new d.UnaryExpression(x.value,m)),this.context.strict&&m.operator==="delete"&&m.argument.type===g.Syntax.Identifier&&this.tolerateError(u.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else m=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return m},w.prototype.parseExponentiationExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseUnaryExpression);if(y.type!==g.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var x=y,C=this.isolateCoverGrammar(this.parseExponentiationExpression);y=this.finalize(this.startNode(m),new d.BinaryExpression("**",x,C))}return y},w.prototype.binaryPrecedence=function(m){var y=m.value;return m.type===7?this.operatorPrecedence[y]||0:m.type===4&&(y==="instanceof"||this.context.allowIn&&y==="in")?7:0},w.prototype.parseBinaryExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseExponentiationExpression),x=this.lookahead,C=this.binaryPrecedence(x);if(C>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var S=[m,this.lookahead],T=y,_=this.isolateCoverGrammar(this.parseExponentiationExpression),E=[T,x.value,_],D=[C];!((C=this.binaryPrecedence(this.lookahead))<=0);){for(;E.length>2&&C<=D[D.length-1];){_=E.pop();var b=E.pop();D.pop(),T=E.pop(),S.pop();var I=this.startNode(S[S.length-1]);E.push(this.finalize(I,new d.BinaryExpression(b,T,_)))}E.push(this.nextToken().value),D.push(C),S.push(this.lookahead),E.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var R=E.length-1;y=E[R];for(var M=S.pop();R>1;){var P=S.pop(),k=M&&M.lineStart;I=this.startNode(P,k),b=E[R-1],y=this.finalize(I,new d.BinaryExpression(b,E[R-2],y)),R-=2,M=P}}return y},w.prototype.parseConditionalExpression=function(){var m=this.lookahead,y=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var x=this.context.allowIn;this.context.allowIn=!0;var C=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=x,this.expect(":");var S=this.isolateCoverGrammar(this.parseAssignmentExpression);y=this.finalize(this.startNode(m),new d.ConditionalExpression(y,C,S)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return y},w.prototype.checkPatternParam=function(m,y){switch(y.type){case g.Syntax.Identifier:this.validateParam(m,y,y.name);break;case g.Syntax.RestElement:this.checkPatternParam(m,y.argument);break;case g.Syntax.AssignmentPattern:this.checkPatternParam(m,y.left);break;case g.Syntax.ArrayPattern:for(var x=0;x<y.elements.length;x++)y.elements[x]!==null&&this.checkPatternParam(m,y.elements[x]);break;case g.Syntax.ObjectPattern:for(x=0;x<y.properties.length;x++)this.checkPatternParam(m,y.properties[x].value)}m.simple=m.simple&&y instanceof d.Identifier},w.prototype.reinterpretAsCoverFormalsList=function(m){var y,x=[m],C=!1;switch(m.type){case g.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":x=m.params,C=m.async;break;default:return null}y={simple:!0,paramSet:{}};for(var S=0;S<x.length;++S)(T=x[S]).type===g.Syntax.AssignmentPattern?T.right.type===g.Syntax.YieldExpression&&(T.right.argument&&this.throwUnexpectedToken(this.lookahead),T.right.type=g.Syntax.Identifier,T.right.name="yield",delete T.right.argument,delete T.right.delegate):C&&T.type===g.Syntax.Identifier&&T.name==="await"&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(y,T),x[S]=T;if(this.context.strict||!this.context.allowYield)for(S=0;S<x.length;++S){var T;(T=x[S]).type===g.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(y.message===u.Messages.StrictParamDupe){var _=this.context.strict?y.stricted:y.firstRestricted;this.throwUnexpectedToken(_,y.message)}return{simple:y.simple,params:x,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.parseAssignmentExpression=function(){var m;if(!this.context.allowYield&&this.matchKeyword("yield"))m=this.parseYieldExpression();else{var y=this.lookahead,x=y;if(m=this.parseConditionalExpression(),x.type===3&&x.lineNumber===this.lookahead.lineNumber&&x.value==="async"&&(this.lookahead.type===3||this.matchKeyword("yield"))){var C=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(C),m={type:"ArrowParameterPlaceHolder",params:[C],async:!0}}if(m.type==="ArrowParameterPlaceHolder"||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var S=m.async,T=this.reinterpretAsCoverFormalsList(m);if(T){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var _=this.context.strict,E=this.context.allowStrictDirective;this.context.allowStrictDirective=T.simple;var D=this.context.allowYield,b=this.context.await;this.context.allowYield=!0,this.context.await=S;var I=this.startNode(y);this.expect("=>");var R=void 0;if(this.match("{")){var M=this.context.allowIn;this.context.allowIn=!0,R=this.parseFunctionSourceElements(),this.context.allowIn=M}else R=this.isolateCoverGrammar(this.parseAssignmentExpression);var P=R.type!==g.Syntax.BlockStatement;this.context.strict&&T.firstRestricted&&this.throwUnexpectedToken(T.firstRestricted,T.message),this.context.strict&&T.stricted&&this.tolerateUnexpectedToken(T.stricted,T.message),m=S?this.finalize(I,new d.AsyncArrowFunctionExpression(T.params,R,P)):this.finalize(I,new d.ArrowFunctionExpression(T.params,R,P)),this.context.strict=_,this.context.allowStrictDirective=E,this.context.allowYield=D,this.context.await=b}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(u.Messages.InvalidLHSInAssignment),this.context.strict&&m.type===g.Syntax.Identifier){var k=m;this.scanner.isRestrictedWord(k.name)&&this.tolerateUnexpectedToken(x,u.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(k.name)&&this.tolerateUnexpectedToken(x,u.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(m):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var z=(x=this.nextToken()).value,A=this.isolateCoverGrammar(this.parseAssignmentExpression);m=this.finalize(this.startNode(y),new d.AssignmentExpression(z,m,A)),this.context.firstCoverInitializedNameError=null}}return m},w.prototype.parseExpression=function(){var m=this.lookahead,y=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var x=[];for(x.push(y);this.lookahead.type!==2&&this.match(",");)this.nextToken(),x.push(this.isolateCoverGrammar(this.parseAssignmentExpression));y=this.finalize(this.startNode(m),new d.SequenceExpression(x))}return y},w.prototype.parseStatementListItem=function(){var m;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,this.lookahead.type===4)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalExportDeclaration),m=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,u.Messages.IllegalImportDeclaration),m=this.parseImportDeclaration();break;case"const":m=this.parseLexicalDeclaration({inFor:!1});break;case"function":m=this.parseFunctionDeclaration();break;case"class":m=this.parseClassDeclaration();break;case"let":m=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:m=this.parseStatement()}else m=this.parseStatement();return m},w.prototype.parseBlock=function(){var m=this.createNode();this.expect("{");for(var y=[];!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.finalize(m,new d.BlockStatement(y))},w.prototype.parseLexicalBinding=function(m,y){var x=this.createNode(),C=this.parsePattern([],m);this.context.strict&&C.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(C.name)&&this.tolerateError(u.Messages.StrictVarName);var S=null;return m==="const"?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),S=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(u.Messages.DeclarationMissingInitializer,"const")):(!y.inFor&&C.type!==g.Syntax.Identifier||this.match("="))&&(this.expect("="),S=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(x,new d.VariableDeclarator(C,S))},w.prototype.parseBindingList=function(m,y){for(var x=[this.parseLexicalBinding(m,y)];this.match(",");)this.nextToken(),x.push(this.parseLexicalBinding(m,y));return x},w.prototype.isLexicalDeclaration=function(){var m=this.scanner.saveState();this.scanner.scanComments();var y=this.scanner.lex();return this.scanner.restoreState(m),y.type===3||y.type===7&&y.value==="["||y.type===7&&y.value==="{"||y.type===4&&y.value==="let"||y.type===4&&y.value==="yield"},w.prototype.parseLexicalDeclaration=function(m){var y=this.createNode(),x=this.nextToken().value;l.assert(x==="let"||x==="const","Lexical declaration must be either let or const");var C=this.parseBindingList(x,m);return this.consumeSemicolon(),this.finalize(y,new d.VariableDeclaration(C,x))},w.prototype.parseBindingRestElement=function(m,y){var x=this.createNode();this.expect("...");var C=this.parsePattern(m,y);return this.finalize(x,new d.RestElement(C))},w.prototype.parseArrayPattern=function(m,y){var x=this.createNode();this.expect("[");for(var C=[];!this.match("]");)if(this.match(","))this.nextToken(),C.push(null);else{if(this.match("...")){C.push(this.parseBindingRestElement(m,y));break}C.push(this.parsePatternWithDefault(m,y)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(x,new d.ArrayPattern(C))},w.prototype.parsePropertyPattern=function(m,y){var x,C,S=this.createNode(),T=!1,_=!1;if(this.lookahead.type===3){var E=this.lookahead;x=this.parseVariableIdentifier();var D=this.finalize(S,new d.Identifier(E.value));if(this.match("=")){m.push(E),_=!0,this.nextToken();var b=this.parseAssignmentExpression();C=this.finalize(this.startNode(E),new d.AssignmentPattern(D,b))}else this.match(":")?(this.expect(":"),C=this.parsePatternWithDefault(m,y)):(m.push(E),_=!0,C=D)}else T=this.match("["),x=this.parseObjectPropertyKey(),this.expect(":"),C=this.parsePatternWithDefault(m,y);return this.finalize(S,new d.Property("init",x,T,C,!1,_))},w.prototype.parseObjectPattern=function(m,y){var x=this.createNode(),C=[];for(this.expect("{");!this.match("}");)C.push(this.parsePropertyPattern(m,y)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(x,new d.ObjectPattern(C))},w.prototype.parsePattern=function(m,y){var x;return this.match("[")?x=this.parseArrayPattern(m,y):this.match("{")?x=this.parseObjectPattern(m,y):(!this.matchKeyword("let")||y!=="const"&&y!=="let"||this.tolerateUnexpectedToken(this.lookahead,u.Messages.LetInLexicalBinding),m.push(this.lookahead),x=this.parseVariableIdentifier(y)),x},w.prototype.parsePatternWithDefault=function(m,y){var x=this.lookahead,C=this.parsePattern(m,y);if(this.match("=")){this.nextToken();var S=this.context.allowYield;this.context.allowYield=!0;var T=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=S,C=this.finalize(this.startNode(x),new d.AssignmentPattern(C,T))}return C},w.prototype.parseVariableIdentifier=function(m){var y=this.createNode(),x=this.nextToken();return x.type===4&&x.value==="yield"?this.context.strict?this.tolerateUnexpectedToken(x,u.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(x):x.type!==3?this.context.strict&&x.type===4&&this.scanner.isStrictModeReservedWord(x.value)?this.tolerateUnexpectedToken(x,u.Messages.StrictReservedWord):(this.context.strict||x.value!=="let"||m!=="var")&&this.throwUnexpectedToken(x):(this.context.isModule||this.context.await)&&x.type===3&&x.value==="await"&&this.tolerateUnexpectedToken(x),this.finalize(y,new d.Identifier(x.value))},w.prototype.parseVariableDeclaration=function(m){var y=this.createNode(),x=this.parsePattern([],"var");this.context.strict&&x.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(x.name)&&this.tolerateError(u.Messages.StrictVarName);var C=null;return this.match("=")?(this.nextToken(),C=this.isolateCoverGrammar(this.parseAssignmentExpression)):x.type===g.Syntax.Identifier||m.inFor||this.expect("="),this.finalize(y,new d.VariableDeclarator(x,C))},w.prototype.parseVariableDeclarationList=function(m){var y={inFor:m.inFor},x=[];for(x.push(this.parseVariableDeclaration(y));this.match(",");)this.nextToken(),x.push(this.parseVariableDeclaration(y));return x},w.prototype.parseVariableStatement=function(){var m=this.createNode();this.expectKeyword("var");var y=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(m,new d.VariableDeclaration(y,"var"))},w.prototype.parseEmptyStatement=function(){var m=this.createNode();return this.expect(";"),this.finalize(m,new d.EmptyStatement)},w.prototype.parseExpressionStatement=function(){var m=this.createNode(),y=this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new d.ExpressionStatement(y))},w.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(u.Messages.StrictFunction),this.parseStatement()},w.prototype.parseIfStatement=function(){var m,y=this.createNode(),x=null;this.expectKeyword("if"),this.expect("(");var C=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new d.EmptyStatement)):(this.expect(")"),m=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),x=this.parseIfClause())),this.finalize(y,new d.IfStatement(C,m,x))},w.prototype.parseDoWhileStatement=function(){var m=this.createNode();this.expectKeyword("do");var y=this.context.inIteration;this.context.inIteration=!0;var x=this.parseStatement();this.context.inIteration=y,this.expectKeyword("while"),this.expect("(");var C=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(m,new d.DoWhileStatement(x,C))},w.prototype.parseWhileStatement=function(){var m,y=this.createNode();this.expectKeyword("while"),this.expect("(");var x=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new d.EmptyStatement);else{this.expect(")");var C=this.context.inIteration;this.context.inIteration=!0,m=this.parseStatement(),this.context.inIteration=C}return this.finalize(y,new d.WhileStatement(x,m))},w.prototype.parseForStatement=function(){var m,y,x,C=null,S=null,T=null,_=!0,E=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){C=this.createNode(),this.nextToken();var D=this.context.allowIn;this.context.allowIn=!1;var b=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=D,b.length===1&&this.matchKeyword("in")){var I=b[0];I.init&&(I.id.type===g.Syntax.ArrayPattern||I.id.type===g.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(u.Messages.ForInOfLoopInitializer,"for-in"),C=this.finalize(C,new d.VariableDeclaration(b,"var")),this.nextToken(),m=C,y=this.parseExpression(),C=null}else b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(C=this.finalize(C,new d.VariableDeclaration(b,"var")),this.nextToken(),m=C,y=this.parseAssignmentExpression(),C=null,_=!1):(C=this.finalize(C,new d.VariableDeclaration(b,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){C=this.createNode();var R=this.nextToken().value;this.context.strict||this.lookahead.value!=="in"?(D=this.context.allowIn,this.context.allowIn=!1,b=this.parseBindingList(R,{inFor:!0}),this.context.allowIn=D,b.length===1&&b[0].init===null&&this.matchKeyword("in")?(C=this.finalize(C,new d.VariableDeclaration(b,R)),this.nextToken(),m=C,y=this.parseExpression(),C=null):b.length===1&&b[0].init===null&&this.matchContextualKeyword("of")?(C=this.finalize(C,new d.VariableDeclaration(b,R)),this.nextToken(),m=C,y=this.parseAssignmentExpression(),C=null,_=!1):(this.consumeSemicolon(),C=this.finalize(C,new d.VariableDeclaration(b,R)))):(C=this.finalize(C,new d.Identifier(R)),this.nextToken(),m=C,y=this.parseExpression(),C=null)}else{var M=this.lookahead;if(D=this.context.allowIn,this.context.allowIn=!1,C=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=D,this.matchKeyword("in"))this.context.isAssignmentTarget&&C.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(C),m=C,y=this.parseExpression(),C=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&C.type!==g.Syntax.AssignmentExpression||this.tolerateError(u.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(C),m=C,y=this.parseAssignmentExpression(),C=null,_=!1;else{if(this.match(",")){for(var P=[C];this.match(",");)this.nextToken(),P.push(this.isolateCoverGrammar(this.parseAssignmentExpression));C=this.finalize(this.startNode(M),new d.SequenceExpression(P))}this.expect(";")}}if(m===void 0&&(this.match(";")||(S=this.parseExpression()),this.expect(";"),this.match(")")||(T=this.parseExpression())),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),x=this.finalize(this.createNode(),new d.EmptyStatement);else{this.expect(")");var k=this.context.inIteration;this.context.inIteration=!0,x=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=k}return m===void 0?this.finalize(E,new d.ForStatement(C,S,T,x)):_?this.finalize(E,new d.ForInStatement(m,y,x)):this.finalize(E,new d.ForOfStatement(m,y,x))},w.prototype.parseContinueStatement=function(){var m=this.createNode();this.expectKeyword("continue");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var x=this.parseVariableIdentifier();y=x;var C="$"+x.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,C)||this.throwError(u.Messages.UnknownLabel,x.name)}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.throwError(u.Messages.IllegalContinue),this.finalize(m,new d.ContinueStatement(y))},w.prototype.parseBreakStatement=function(){var m=this.createNode();this.expectKeyword("break");var y=null;if(this.lookahead.type===3&&!this.hasLineTerminator){var x=this.parseVariableIdentifier(),C="$"+x.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,C)||this.throwError(u.Messages.UnknownLabel,x.name),y=x}return this.consumeSemicolon(),y!==null||this.context.inIteration||this.context.inSwitch||this.throwError(u.Messages.IllegalBreak),this.finalize(m,new d.BreakStatement(y))},w.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(u.Messages.IllegalReturn);var m=this.createNode();this.expectKeyword("return");var y=(this.match(";")||this.match("}")||this.hasLineTerminator||this.lookahead.type===2)&&this.lookahead.type!==8&&this.lookahead.type!==10?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new d.ReturnStatement(y))},w.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(u.Messages.StrictModeWith);var m,y=this.createNode();this.expectKeyword("with"),this.expect("(");var x=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),m=this.finalize(this.createNode(),new d.EmptyStatement)):(this.expect(")"),m=this.parseStatement()),this.finalize(y,new d.WithStatement(x,m))},w.prototype.parseSwitchCase=function(){var m,y=this.createNode();this.matchKeyword("default")?(this.nextToken(),m=null):(this.expectKeyword("case"),m=this.parseExpression()),this.expect(":");for(var x=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)x.push(this.parseStatementListItem());return this.finalize(y,new d.SwitchCase(m,x))},w.prototype.parseSwitchStatement=function(){var m=this.createNode();this.expectKeyword("switch"),this.expect("(");var y=this.parseExpression();this.expect(")");var x=this.context.inSwitch;this.context.inSwitch=!0;var C=[],S=!1;for(this.expect("{");!this.match("}");){var T=this.parseSwitchCase();T.test===null&&(S&&this.throwError(u.Messages.MultipleDefaultsInSwitch),S=!0),C.push(T)}return this.expect("}"),this.context.inSwitch=x,this.finalize(m,new d.SwitchStatement(y,C))},w.prototype.parseLabelledStatement=function(){var m,y=this.createNode(),x=this.parseExpression();if(x.type===g.Syntax.Identifier&&this.match(":")){this.nextToken();var C=x,S="$"+C.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,S)&&this.throwError(u.Messages.Redeclaration,"Label",C.name),this.context.labelSet[S]=!0;var T=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),T=this.parseClassDeclaration();else if(this.matchKeyword("function")){var _=this.lookahead,E=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(_,u.Messages.StrictFunction):E.generator&&this.tolerateUnexpectedToken(_,u.Messages.GeneratorInLegacyContext),T=E}else T=this.parseStatement();delete this.context.labelSet[S],m=new d.LabeledStatement(C,T)}else this.consumeSemicolon(),m=new d.ExpressionStatement(x);return this.finalize(y,m)},w.prototype.parseThrowStatement=function(){var m=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(u.Messages.NewlineAfterThrow);var y=this.parseExpression();return this.consumeSemicolon(),this.finalize(m,new d.ThrowStatement(y))},w.prototype.parseCatchClause=function(){var m=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var y=[],x=this.parsePattern(y),C={},S=0;S<y.length;S++){var T="$"+y[S].value;Object.prototype.hasOwnProperty.call(C,T)&&this.tolerateError(u.Messages.DuplicateBinding,y[S].value),C[T]=!0}this.context.strict&&x.type===g.Syntax.Identifier&&this.scanner.isRestrictedWord(x.name)&&this.tolerateError(u.Messages.StrictCatchVariable),this.expect(")");var _=this.parseBlock();return this.finalize(m,new d.CatchClause(x,_))},w.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},w.prototype.parseTryStatement=function(){var m=this.createNode();this.expectKeyword("try");var y=this.parseBlock(),x=this.matchKeyword("catch")?this.parseCatchClause():null,C=this.matchKeyword("finally")?this.parseFinallyClause():null;return x||C||this.throwError(u.Messages.NoCatchOrFinally),this.finalize(m,new d.TryStatement(y,x,C))},w.prototype.parseDebuggerStatement=function(){var m=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(m,new d.DebuggerStatement)},w.prototype.parseStatement=function(){var m;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:m=this.parseExpressionStatement();break;case 7:var y=this.lookahead.value;m=y==="{"?this.parseBlock():y==="("?this.parseExpressionStatement():y===";"?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:m=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":m=this.parseBreakStatement();break;case"continue":m=this.parseContinueStatement();break;case"debugger":m=this.parseDebuggerStatement();break;case"do":m=this.parseDoWhileStatement();break;case"for":m=this.parseForStatement();break;case"function":m=this.parseFunctionDeclaration();break;case"if":m=this.parseIfStatement();break;case"return":m=this.parseReturnStatement();break;case"switch":m=this.parseSwitchStatement();break;case"throw":m=this.parseThrowStatement();break;case"try":m=this.parseTryStatement();break;case"var":m=this.parseVariableStatement();break;case"while":m=this.parseWhileStatement();break;case"with":m=this.parseWithStatement();break;default:m=this.parseExpressionStatement()}break;default:m=this.throwUnexpectedToken(this.lookahead)}return m},w.prototype.parseFunctionSourceElements=function(){var m=this.createNode();this.expect("{");var y=this.parseDirectivePrologues(),x=this.context.labelSet,C=this.context.inIteration,S=this.context.inSwitch,T=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;this.lookahead.type!==2&&!this.match("}");)y.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=x,this.context.inIteration=C,this.context.inSwitch=S,this.context.inFunctionBody=T,this.finalize(m,new d.BlockStatement(y))},w.prototype.validateParam=function(m,y,x){var C="$"+x;this.context.strict?(this.scanner.isRestrictedWord(x)&&(m.stricted=y,m.message=u.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(m.paramSet,C)&&(m.stricted=y,m.message=u.Messages.StrictParamDupe)):m.firstRestricted||(this.scanner.isRestrictedWord(x)?(m.firstRestricted=y,m.message=u.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(x)?(m.firstRestricted=y,m.message=u.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(m.paramSet,C)&&(m.stricted=y,m.message=u.Messages.StrictParamDupe)),typeof Object.defineProperty=="function"?Object.defineProperty(m.paramSet,C,{value:!0,enumerable:!0,writable:!0,configurable:!0}):m.paramSet[C]=!0},w.prototype.parseRestElement=function(m){var y=this.createNode();this.expect("...");var x=this.parsePattern(m);return this.match("=")&&this.throwError(u.Messages.DefaultRestParameter),this.match(")")||this.throwError(u.Messages.ParameterAfterRestParameter),this.finalize(y,new d.RestElement(x))},w.prototype.parseFormalParameter=function(m){for(var y=[],x=this.match("...")?this.parseRestElement(y):this.parsePatternWithDefault(y),C=0;C<y.length;C++)this.validateParam(m,y[C],y[C].value);m.simple=m.simple&&x instanceof d.Identifier,m.params.push(x)},w.prototype.parseFormalParameters=function(m){var y;if(y={simple:!0,params:[],firstRestricted:m},this.expect("("),!this.match(")"))for(y.paramSet={};this.lookahead.type!==2&&(this.parseFormalParameter(y),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:y.simple,params:y.params,stricted:y.stricted,firstRestricted:y.firstRestricted,message:y.message}},w.prototype.matchAsyncFunction=function(){var m=this.matchContextualKeyword("async");if(m){var y=this.scanner.saveState();this.scanner.scanComments();var x=this.scanner.lex();this.scanner.restoreState(y),m=y.lineNumber===x.lineNumber&&x.type===4&&x.value==="function"}return m},w.prototype.parseFunctionDeclaration=function(m){var y=this.createNode(),x=this.matchContextualKeyword("async");x&&this.nextToken(),this.expectKeyword("function");var C,S=!x&&this.match("*");S&&this.nextToken();var T=null,_=null;if(!m||!this.match("(")){var E=this.lookahead;T=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(E.value)&&this.tolerateUnexpectedToken(E,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(E.value)?(_=E,C=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(E.value)&&(_=E,C=u.Messages.StrictReservedWord)}var D=this.context.await,b=this.context.allowYield;this.context.await=x,this.context.allowYield=!S;var I=this.parseFormalParameters(_),R=I.params,M=I.stricted;_=I.firstRestricted,I.message&&(C=I.message);var P=this.context.strict,k=this.context.allowStrictDirective;this.context.allowStrictDirective=I.simple;var z=this.parseFunctionSourceElements();return this.context.strict&&_&&this.throwUnexpectedToken(_,C),this.context.strict&&M&&this.tolerateUnexpectedToken(M,C),this.context.strict=P,this.context.allowStrictDirective=k,this.context.await=D,this.context.allowYield=b,x?this.finalize(y,new d.AsyncFunctionDeclaration(T,R,z)):this.finalize(y,new d.FunctionDeclaration(T,R,z,S))},w.prototype.parseFunctionExpression=function(){var m=this.createNode(),y=this.matchContextualKeyword("async");y&&this.nextToken(),this.expectKeyword("function");var x,C=!y&&this.match("*");C&&this.nextToken();var S,T=null,_=this.context.await,E=this.context.allowYield;if(this.context.await=y,this.context.allowYield=!C,!this.match("(")){var D=this.lookahead;T=this.context.strict||C||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(D.value)&&this.tolerateUnexpectedToken(D,u.Messages.StrictFunctionName):this.scanner.isRestrictedWord(D.value)?(S=D,x=u.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(D.value)&&(S=D,x=u.Messages.StrictReservedWord)}var b=this.parseFormalParameters(S),I=b.params,R=b.stricted;S=b.firstRestricted,b.message&&(x=b.message);var M=this.context.strict,P=this.context.allowStrictDirective;this.context.allowStrictDirective=b.simple;var k=this.parseFunctionSourceElements();return this.context.strict&&S&&this.throwUnexpectedToken(S,x),this.context.strict&&R&&this.tolerateUnexpectedToken(R,x),this.context.strict=M,this.context.allowStrictDirective=P,this.context.await=_,this.context.allowYield=E,y?this.finalize(m,new d.AsyncFunctionExpression(T,I,k)):this.finalize(m,new d.FunctionExpression(T,I,k,C))},w.prototype.parseDirective=function(){var m=this.lookahead,y=this.createNode(),x=this.parseExpression(),C=x.type===g.Syntax.Literal?this.getTokenRaw(m).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(y,C?new d.Directive(x,C):new d.ExpressionStatement(x))},w.prototype.parseDirectivePrologues=function(){for(var m=null,y=[];;){var x=this.lookahead;if(x.type!==8)break;var C=this.parseDirective();y.push(C);var S=C.directive;if(typeof S!="string")break;S==="use strict"?(this.context.strict=!0,m&&this.tolerateUnexpectedToken(m,u.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(x,u.Messages.IllegalLanguageModeDirective)):!m&&x.octal&&(m=x)}return y},w.prototype.qualifiedPropertyName=function(m){switch(m.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return m.value==="["}return!1},w.prototype.parseGetterMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var x=this.parseFormalParameters();x.params.length>0&&this.tolerateError(u.Messages.BadGetterArity);var C=this.parsePropertyMethod(x);return this.context.allowYield=y,this.finalize(m,new d.FunctionExpression(null,x.params,C,!1))},w.prototype.parseSetterMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var x=this.parseFormalParameters();x.params.length!==1?this.tolerateError(u.Messages.BadSetterArity):x.params[0]instanceof d.RestElement&&this.tolerateError(u.Messages.BadSetterRestParameter);var C=this.parsePropertyMethod(x);return this.context.allowYield=y,this.finalize(m,new d.FunctionExpression(null,x.params,C,!1))},w.prototype.parseGeneratorMethod=function(){var m=this.createNode(),y=this.context.allowYield;this.context.allowYield=!0;var x=this.parseFormalParameters();this.context.allowYield=!1;var C=this.parsePropertyMethod(x);return this.context.allowYield=y,this.finalize(m,new d.FunctionExpression(null,x.params,C,!0))},w.prototype.isStartOfExpression=function(){var m=!0,y=this.lookahead.value;switch(this.lookahead.type){case 7:m=y==="["||y==="("||y==="{"||y==="+"||y==="-"||y==="!"||y==="~"||y==="++"||y==="--"||y==="/"||y==="/=";break;case 4:m=y==="class"||y==="delete"||y==="function"||y==="let"||y==="new"||y==="super"||y==="this"||y==="typeof"||y==="void"||y==="yield"}return m},w.prototype.parseYieldExpression=function(){var m=this.createNode();this.expectKeyword("yield");var y=null,x=!1;if(!this.hasLineTerminator){var C=this.context.allowYield;this.context.allowYield=!1,(x=this.match("*"))?(this.nextToken(),y=this.parseAssignmentExpression()):this.isStartOfExpression()&&(y=this.parseAssignmentExpression()),this.context.allowYield=C}return this.finalize(m,new d.YieldExpression(y,x))},w.prototype.parseClassElement=function(m){var y=this.lookahead,x=this.createNode(),C="",S=null,T=null,_=!1,E=!1,D=!1,b=!1;if(this.match("*"))this.nextToken();else if(_=this.match("["),(S=this.parseObjectPropertyKey()).name==="static"&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(y=this.lookahead,D=!0,_=this.match("["),this.match("*")?this.nextToken():S=this.parseObjectPropertyKey()),y.type===3&&!this.hasLineTerminator&&y.value==="async"){var I=this.lookahead.value;I!==":"&&I!=="("&&I!=="*"&&(b=!0,y=this.lookahead,S=this.parseObjectPropertyKey(),y.type===3&&y.value==="constructor"&&this.tolerateUnexpectedToken(y,u.Messages.ConstructorIsAsync))}var R=this.qualifiedPropertyName(this.lookahead);return y.type===3?y.value==="get"&&R?(C="get",_=this.match("["),S=this.parseObjectPropertyKey(),this.context.allowYield=!1,T=this.parseGetterMethod()):y.value==="set"&&R&&(C="set",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseSetterMethod()):y.type===7&&y.value==="*"&&R&&(C="init",_=this.match("["),S=this.parseObjectPropertyKey(),T=this.parseGeneratorMethod(),E=!0),!C&&S&&this.match("(")&&(C="init",T=b?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),E=!0),C||this.throwUnexpectedToken(this.lookahead),C==="init"&&(C="method"),_||(D&&this.isPropertyKey(S,"prototype")&&this.throwUnexpectedToken(y,u.Messages.StaticPrototype),!D&&this.isPropertyKey(S,"constructor")&&((C!=="method"||!E||T&&T.generator)&&this.throwUnexpectedToken(y,u.Messages.ConstructorSpecialMethod),m.value?this.throwUnexpectedToken(y,u.Messages.DuplicateConstructor):m.value=!0,C="constructor")),this.finalize(x,new d.MethodDefinition(S,_,T,C,D))},w.prototype.parseClassElementList=function(){var m=[],y={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():m.push(this.parseClassElement(y));return this.expect("}"),m},w.prototype.parseClassBody=function(){var m=this.createNode(),y=this.parseClassElementList();return this.finalize(m,new d.ClassBody(y))},w.prototype.parseClassDeclaration=function(m){var y=this.createNode(),x=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var C=m&&this.lookahead.type!==3?null:this.parseVariableIdentifier(),S=null;this.matchKeyword("extends")&&(this.nextToken(),S=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var T=this.parseClassBody();return this.context.strict=x,this.finalize(y,new d.ClassDeclaration(C,S,T))},w.prototype.parseClassExpression=function(){var m=this.createNode(),y=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var x=this.lookahead.type===3?this.parseVariableIdentifier():null,C=null;this.matchKeyword("extends")&&(this.nextToken(),C=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var S=this.parseClassBody();return this.context.strict=y,this.finalize(m,new d.ClassExpression(x,C,S))},w.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0,this.scanner.isModule=!0;for(var m=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(m,new d.Module(y))},w.prototype.parseScript=function(){for(var m=this.createNode(),y=this.parseDirectivePrologues();this.lookahead.type!==2;)y.push(this.parseStatementListItem());return this.finalize(m,new d.Script(y))},w.prototype.parseModuleSpecifier=function(){var m=this.createNode();this.lookahead.type!==8&&this.throwError(u.Messages.InvalidModuleSpecifier);var y=this.nextToken(),x=this.getTokenRaw(y);return this.finalize(m,new d.Literal(y.value,x))},w.prototype.parseImportSpecifier=function(){var m,y,x=this.createNode();return this.lookahead.type===3?(y=m=this.parseVariableIdentifier(),this.matchContextualKeyword("as")&&(this.nextToken(),y=this.parseVariableIdentifier())):(y=m=this.parseIdentifierName(),this.matchContextualKeyword("as")?(this.nextToken(),y=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(x,new d.ImportSpecifier(y,m))},w.prototype.parseNamedImports=function(){this.expect("{");for(var m=[];!this.match("}");)m.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),m},w.prototype.parseImportDefaultSpecifier=function(){var m=this.createNode(),y=this.parseIdentifierName();return this.finalize(m,new d.ImportDefaultSpecifier(y))},w.prototype.parseImportNamespaceSpecifier=function(){var m=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(u.Messages.NoAsAfterImportNamespace),this.nextToken();var y=this.parseIdentifierName();return this.finalize(m,new d.ImportNamespaceSpecifier(y))},w.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalImportDeclaration);var m,y=this.createNode();this.expectKeyword("import");var x=[];if(this.lookahead.type===8)m=this.parseModuleSpecifier();else{if(this.match("{")?x=x.concat(this.parseNamedImports()):this.match("*")?x.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(x.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?x.push(this.parseImportNamespaceSpecifier()):this.match("{")?x=x.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var C=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(C,this.lookahead.value)}this.nextToken(),m=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(y,new d.ImportDeclaration(x,m))},w.prototype.parseExportSpecifier=function(){var m=this.createNode(),y=this.parseIdentifierName(),x=y;return this.matchContextualKeyword("as")&&(this.nextToken(),x=this.parseIdentifierName()),this.finalize(m,new d.ExportSpecifier(y,x))},w.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(u.Messages.IllegalExportDeclaration);var m,y=this.createNode();if(this.expectKeyword("export"),this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){var x=this.parseFunctionDeclaration(!0);m=this.finalize(y,new d.ExportDefaultDeclaration(x))}else this.matchKeyword("class")?(x=this.parseClassDeclaration(!0),m=this.finalize(y,new d.ExportDefaultDeclaration(x))):this.matchContextualKeyword("async")?(x=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression(),m=this.finalize(y,new d.ExportDefaultDeclaration(x))):(this.matchContextualKeyword("from")&&this.throwError(u.Messages.UnexpectedToken,this.lookahead.value),x=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression(),this.consumeSemicolon(),m=this.finalize(y,new d.ExportDefaultDeclaration(x)));else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){var C=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause;this.throwError(C,this.lookahead.value)}this.nextToken();var S=this.parseModuleSpecifier();this.consumeSemicolon(),m=this.finalize(y,new d.ExportAllDeclaration(S))}else if(this.lookahead.type===4){switch(x=void 0,this.lookahead.value){case"let":case"const":x=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":x=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}m=this.finalize(y,new d.ExportNamedDeclaration(x,[],null))}else if(this.matchAsyncFunction())x=this.parseFunctionDeclaration(),m=this.finalize(y,new d.ExportNamedDeclaration(x,[],null));else{var T=[],_=null,E=!1;for(this.expect("{");!this.match("}");)E=E||this.matchKeyword("default"),T.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");this.expect("}"),this.matchContextualKeyword("from")?(this.nextToken(),_=this.parseModuleSpecifier(),this.consumeSemicolon()):E?(C=this.lookahead.value?u.Messages.UnexpectedToken:u.Messages.MissingFromClause,this.throwError(C,this.lookahead.value)):this.consumeSemicolon(),m=this.finalize(y,new d.ExportNamedDeclaration(null,T,_))}return m},w}();s.Parser=v},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.assert=function(c,l){if(!c)throw new Error("ASSERT: "+l)}},function(a,s){Object.defineProperty(s,"__esModule",{value:!0});var c=function(){function l(){this.errors=[],this.tolerant=!1}return l.prototype.recordError=function(f){this.errors.push(f)},l.prototype.tolerate=function(f){if(!this.tolerant)throw f;this.recordError(f)},l.prototype.constructError=function(f,u){var d=new Error(f);try{throw d}catch(h){Object.create&&Object.defineProperty&&(d=Object.create(h),Object.defineProperty(d,"column",{value:u}))}return d},l.prototype.createError=function(f,u,d,h){var g="Line "+u+": "+h,p=this.constructError(g,d);return p.index=f,p.lineNumber=u,p.description=h,p},l.prototype.throwError=function(f,u,d,h){throw this.createError(f,u,d,h)},l.prototype.tolerateError=function(f,u,d,h){var g=this.createError(f,u,d,h);if(!this.tolerant)throw g;this.recordError(g)},l}();s.ErrorHandler=c},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(9),f=c(4),u=c(11);function d(p){return"0123456789abcdef".indexOf(p.toLowerCase())}function h(p){return"01234567".indexOf(p)}var g=function(){function p(v,w){this.source=v,this.errorHandler=w,this.trackComment=!1,this.isModule=!1,this.length=v.length,this.index=0,this.lineNumber=v.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return p.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},p.prototype.restoreState=function(v){this.index=v.index,this.lineNumber=v.lineNumber,this.lineStart=v.lineStart},p.prototype.eof=function(){return this.index>=this.length},p.prototype.throwUnexpectedToken=function(v){return v===void 0&&(v=u.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,v)},p.prototype.tolerateUnexpectedToken=function(v){v===void 0&&(v=u.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,v)},p.prototype.skipSingleLineComment=function(v){var w,m,y=[];for(this.trackComment&&(y=[],w=this.index-v,m={start:{line:this.lineNumber,column:this.index-this.lineStart-v},end:{}});!this.eof();){var x=this.source.charCodeAt(this.index);if(++this.index,f.Character.isLineTerminator(x)){if(this.trackComment){m.end={line:this.lineNumber,column:this.index-this.lineStart-1};var C={multiLine:!1,slice:[w+v,this.index-1],range:[w,this.index-1],loc:m};y.push(C)}return x===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,y}}return this.trackComment&&(m.end={line:this.lineNumber,column:this.index-this.lineStart},C={multiLine:!1,slice:[w+v,this.index],range:[w,this.index],loc:m},y.push(C)),y},p.prototype.skipMultiLineComment=function(){var v,w,m=[];for(this.trackComment&&(m=[],v=this.index-2,w={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var y=this.source.charCodeAt(this.index);if(f.Character.isLineTerminator(y))y===13&&this.source.charCodeAt(this.index+1)===10&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(y===42){if(this.source.charCodeAt(this.index+1)===47){if(this.index+=2,this.trackComment){w.end={line:this.lineNumber,column:this.index-this.lineStart};var x={multiLine:!0,slice:[v+2,this.index-2],range:[v,this.index],loc:w};m.push(x)}return m}++this.index}else++this.index}return this.trackComment&&(w.end={line:this.lineNumber,column:this.index-this.lineStart},x={multiLine:!0,slice:[v+2,this.index],range:[v,this.index],loc:w},m.push(x)),this.tolerateUnexpectedToken(),m},p.prototype.scanComments=function(){var v;this.trackComment&&(v=[]);for(var w=this.index===0;!this.eof();){var m=this.source.charCodeAt(this.index);if(f.Character.isWhiteSpace(m))++this.index;else if(f.Character.isLineTerminator(m))++this.index,m===13&&this.source.charCodeAt(this.index)===10&&++this.index,++this.lineNumber,this.lineStart=this.index,w=!0;else if(m===47)if((m=this.source.charCodeAt(this.index+1))===47){this.index+=2;var y=this.skipSingleLineComment(2);this.trackComment&&(v=v.concat(y)),w=!0}else{if(m!==42)break;this.index+=2,y=this.skipMultiLineComment(),this.trackComment&&(v=v.concat(y))}else if(w&&m===45){if(this.source.charCodeAt(this.index+1)!==45||this.source.charCodeAt(this.index+2)!==62)break;this.index+=3,y=this.skipSingleLineComment(3),this.trackComment&&(v=v.concat(y))}else{if(m!==60||this.isModule||this.source.slice(this.index+1,this.index+4)!=="!--")break;this.index+=4,y=this.skipSingleLineComment(4),this.trackComment&&(v=v.concat(y))}}return v},p.prototype.isFutureReservedWord=function(v){switch(v){case"enum":case"export":case"import":case"super":return!0;default:return!1}},p.prototype.isStrictModeReservedWord=function(v){switch(v){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},p.prototype.isRestrictedWord=function(v){return v==="eval"||v==="arguments"},p.prototype.isKeyword=function(v){switch(v.length){case 2:return v==="if"||v==="in"||v==="do";case 3:return v==="var"||v==="for"||v==="new"||v==="try"||v==="let";case 4:return v==="this"||v==="else"||v==="case"||v==="void"||v==="with"||v==="enum";case 5:return v==="while"||v==="break"||v==="catch"||v==="throw"||v==="const"||v==="yield"||v==="class"||v==="super";case 6:return v==="return"||v==="typeof"||v==="delete"||v==="switch"||v==="export"||v==="import";case 7:return v==="default"||v==="finally"||v==="extends";case 8:return v==="function"||v==="continue"||v==="debugger";case 10:return v==="instanceof";default:return!1}},p.prototype.codePointAt=function(v){var w=this.source.charCodeAt(v);if(w>=55296&&w<=56319){var m=this.source.charCodeAt(v+1);m>=56320&&m<=57343&&(w=1024*(w-55296)+m-56320+65536)}return w},p.prototype.scanHexEscape=function(v){for(var w=v==="u"?4:2,m=0,y=0;y<w;++y){if(this.eof()||!f.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;m=16*m+d(this.source[this.index++])}return String.fromCharCode(m)},p.prototype.scanUnicodeCodePointEscape=function(){var v=this.source[this.index],w=0;for(v==="}"&&this.throwUnexpectedToken();!this.eof()&&(v=this.source[this.index++],f.Character.isHexDigit(v.charCodeAt(0)));)w=16*w+d(v);return(w>1114111||v!=="}")&&this.throwUnexpectedToken(),f.Character.fromCodePoint(w)},p.prototype.getIdentifier=function(){for(var v=this.index++;!this.eof();){var w=this.source.charCodeAt(this.index);if(w===92)return this.index=v,this.getComplexIdentifier();if(w>=55296&&w<57343)return this.index=v,this.getComplexIdentifier();if(!f.Character.isIdentifierPart(w))break;++this.index}return this.source.slice(v,this.index)},p.prototype.getComplexIdentifier=function(){var v,w=this.codePointAt(this.index),m=f.Character.fromCodePoint(w);for(this.index+=m.length,w===92&&(this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,v=this.scanUnicodeCodePointEscape()):(v=this.scanHexEscape("u"))!==null&&v!=="\\"&&f.Character.isIdentifierStart(v.charCodeAt(0))||this.throwUnexpectedToken(),m=v);!this.eof()&&(w=this.codePointAt(this.index),f.Character.isIdentifierPart(w));)m+=v=f.Character.fromCodePoint(w),this.index+=v.length,w===92&&(m=m.substr(0,m.length-1),this.source.charCodeAt(this.index)!==117&&this.throwUnexpectedToken(),++this.index,this.source[this.index]==="{"?(++this.index,v=this.scanUnicodeCodePointEscape()):(v=this.scanHexEscape("u"))!==null&&v!=="\\"&&f.Character.isIdentifierPart(v.charCodeAt(0))||this.throwUnexpectedToken(),m+=v);return m},p.prototype.octalToDecimal=function(v){var w=v!=="0",m=h(v);return!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(w=!0,m=8*m+h(this.source[this.index++]),"0123".indexOf(v)>=0&&!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(m=8*m+h(this.source[this.index++]))),{code:m,octal:w}},p.prototype.scanIdentifier=function(){var v,w=this.index,m=this.source.charCodeAt(w)===92?this.getComplexIdentifier():this.getIdentifier();if((v=m.length===1?3:this.isKeyword(m)?4:m==="null"?5:m==="true"||m==="false"?1:3)!=3&&w+m.length!==this.index){var y=this.index;this.index=w,this.tolerateUnexpectedToken(u.Messages.InvalidEscapedReservedWord),this.index=y}return{type:v,value:m,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.scanPunctuator=function(){var v=this.index,w=this.source[this.index];switch(w){case"(":case"{":w==="{"&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,this.source[this.index]==="."&&this.source[this.index+1]==="."&&(this.index+=2,w="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:(w=this.source.substr(this.index,4))===">>>="?this.index+=4:(w=w.substr(0,3))==="==="||w==="!=="||w===">>>"||w==="<<="||w===">>="||w==="**="?this.index+=3:(w=w.substr(0,2))==="&&"||w==="||"||w==="=="||w==="!="||w==="+="||w==="-="||w==="*="||w==="/="||w==="++"||w==="--"||w==="<<"||w===">>"||w==="&="||w==="|="||w==="^="||w==="%="||w==="<="||w===">="||w==="=>"||w==="**"?this.index+=2:(w=this.source[this.index],"<>=!+-*%&|^/".indexOf(w)>=0&&++this.index)}return this.index===v&&this.throwUnexpectedToken(),{type:7,value:w,lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanHexLiteral=function(v){for(var w="";!this.eof()&&f.Character.isHexDigit(this.source.charCodeAt(this.index));)w+=this.source[this.index++];return w.length===0&&this.throwUnexpectedToken(),f.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+w,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanBinaryLiteral=function(v){for(var w,m="";!this.eof()&&((w=this.source[this.index])==="0"||w==="1");)m+=this.source[this.index++];return m.length===0&&this.throwUnexpectedToken(),this.eof()||(w=this.source.charCodeAt(this.index),(f.Character.isIdentifierStart(w)||f.Character.isDecimalDigit(w))&&this.throwUnexpectedToken()),{type:6,value:parseInt(m,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanOctalLiteral=function(v,w){var m="",y=!1;for(f.Character.isOctalDigit(v.charCodeAt(0))?(y=!0,m="0"+this.source[this.index++]):++this.index;!this.eof()&&f.Character.isOctalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];return y||m.length!==0||this.throwUnexpectedToken(),(f.Character.isIdentifierStart(this.source.charCodeAt(this.index))||f.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(m,8),octal:y,lineNumber:this.lineNumber,lineStart:this.lineStart,start:w,end:this.index}},p.prototype.isImplicitOctalLiteral=function(){for(var v=this.index+1;v<this.length;++v){var w=this.source[v];if(w==="8"||w==="9")return!1;if(!f.Character.isOctalDigit(w.charCodeAt(0)))return!0}return!0},p.prototype.scanNumericLiteral=function(){var v=this.index,w=this.source[v];l.assert(f.Character.isDecimalDigit(w.charCodeAt(0))||w===".","Numeric literal must start with a decimal digit or a decimal point");var m="";if(w!=="."){if(m=this.source[this.index++],w=this.source[this.index],m==="0"){if(w==="x"||w==="X")return++this.index,this.scanHexLiteral(v);if(w==="b"||w==="B")return++this.index,this.scanBinaryLiteral(v);if(w==="o"||w==="O")return this.scanOctalLiteral(w,v);if(w&&f.Character.isOctalDigit(w.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(w,v)}for(;f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];w=this.source[this.index]}if(w==="."){for(m+=this.source[this.index++];f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];w=this.source[this.index]}if(w==="e"||w==="E")if(m+=this.source[this.index++],(w=this.source[this.index])!=="+"&&w!=="-"||(m+=this.source[this.index++]),f.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;f.Character.isDecimalDigit(this.source.charCodeAt(this.index));)m+=this.source[this.index++];else this.throwUnexpectedToken();return f.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(m),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanStringLiteral=function(){var v=this.index,w=this.source[v];l.assert(w==="'"||w==='"',"String literal must starts with a quote"),++this.index;for(var m=!1,y="";!this.eof();){var x=this.source[this.index++];if(x===w){w="";break}if(x==="\\")if((x=this.source[this.index++])&&f.Character.isLineTerminator(x.charCodeAt(0)))++this.lineNumber,x==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(x){case"u":if(this.source[this.index]==="{")++this.index,y+=this.scanUnicodeCodePointEscape();else{var C=this.scanHexEscape(x);C===null&&this.throwUnexpectedToken(),y+=C}break;case"x":var S=this.scanHexEscape(x);S===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),y+=S;break;case"n":y+=`
`;break;case"r":y+="\r";break;case"t":y+="	";break;case"b":y+="\b";break;case"f":y+="\f";break;case"v":y+="\v";break;case"8":case"9":y+=x,this.tolerateUnexpectedToken();break;default:if(x&&f.Character.isOctalDigit(x.charCodeAt(0))){var T=this.octalToDecimal(x);m=T.octal||m,y+=String.fromCharCode(T.code)}else y+=x}else{if(f.Character.isLineTerminator(x.charCodeAt(0)))break;y+=x}}return w!==""&&(this.index=v,this.throwUnexpectedToken()),{type:8,value:y,octal:m,lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.scanTemplate=function(){var v="",w=!1,m=this.index,y=this.source[m]==="`",x=!1,C=2;for(++this.index;!this.eof();){var S=this.source[this.index++];if(S==="`"){C=1,x=!0,w=!0;break}if(S==="$"){if(this.source[this.index]==="{"){this.curlyStack.push("${"),++this.index,w=!0;break}v+=S}else if(S==="\\")if(S=this.source[this.index++],f.Character.isLineTerminator(S.charCodeAt(0)))++this.lineNumber,S==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index;else switch(S){case"n":v+=`
`;break;case"r":v+="\r";break;case"t":v+="	";break;case"u":if(this.source[this.index]==="{")++this.index,v+=this.scanUnicodeCodePointEscape();else{var T=this.index,_=this.scanHexEscape(S);_!==null?v+=_:(this.index=T,v+=S)}break;case"x":var E=this.scanHexEscape(S);E===null&&this.throwUnexpectedToken(u.Messages.InvalidHexEscapeSequence),v+=E;break;case"b":v+="\b";break;case"f":v+="\f";break;case"v":v+="\v";break;default:S==="0"?(f.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral),v+="\0"):f.Character.isOctalDigit(S.charCodeAt(0))?this.throwUnexpectedToken(u.Messages.TemplateOctalLiteral):v+=S}else f.Character.isLineTerminator(S.charCodeAt(0))?(++this.lineNumber,S==="\r"&&this.source[this.index]===`
`&&++this.index,this.lineStart=this.index,v+=`
`):v+=S}return w||this.throwUnexpectedToken(),y||this.curlyStack.pop(),{type:10,value:this.source.slice(m+1,this.index-C),cooked:v,head:y,tail:x,lineNumber:this.lineNumber,lineStart:this.lineStart,start:m,end:this.index}},p.prototype.testRegExp=function(v,w){var m=v,y=this;w.indexOf("u")>=0&&(m=m.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(x,C,S){var T=parseInt(C||S,16);return T>1114111&&y.throwUnexpectedToken(u.Messages.InvalidRegExp),T<=65535?String.fromCharCode(T):""}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(m)}catch{this.throwUnexpectedToken(u.Messages.InvalidRegExp)}try{return new RegExp(v,w)}catch{return null}},p.prototype.scanRegExpBody=function(){var v=this.source[this.index];l.assert(v==="/","Regular expression literal must start with a slash");for(var w=this.source[this.index++],m=!1,y=!1;!this.eof();)if(w+=v=this.source[this.index++],v==="\\")v=this.source[this.index++],f.Character.isLineTerminator(v.charCodeAt(0))&&this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w+=v;else if(f.Character.isLineTerminator(v.charCodeAt(0)))this.throwUnexpectedToken(u.Messages.UnterminatedRegExp);else if(m)v==="]"&&(m=!1);else{if(v==="/"){y=!0;break}v==="["&&(m=!0)}return y||this.throwUnexpectedToken(u.Messages.UnterminatedRegExp),w.substr(1,w.length-2)},p.prototype.scanRegExpFlags=function(){for(var v="";!this.eof();){var w=this.source[this.index];if(!f.Character.isIdentifierPart(w.charCodeAt(0)))break;if(++this.index,w!=="\\"||this.eof())v+=w;else if((w=this.source[this.index])==="u"){++this.index;var m=this.index,y=this.scanHexEscape("u");if(y!==null)for(v+=y;m<this.index;++m)this.source[m];else this.index=m,v+="u";this.tolerateUnexpectedToken()}else this.tolerateUnexpectedToken()}return v},p.prototype.scanRegExp=function(){var v=this.index,w=this.scanRegExpBody(),m=this.scanRegExpFlags();return{type:9,value:"",pattern:w,flags:m,regex:this.testRegExp(w,m),lineNumber:this.lineNumber,lineStart:this.lineStart,start:v,end:this.index}},p.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var v=this.source.charCodeAt(this.index);return f.Character.isIdentifierStart(v)?this.scanIdentifier():v===40||v===41||v===59?this.scanPunctuator():v===39||v===34?this.scanStringLiteral():v===46?f.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():f.Character.isDecimalDigit(v)?this.scanNumericLiteral():v===96||v===125&&this.curlyStack[this.curlyStack.length-1]==="${"?this.scanTemplate():v>=55296&&v<57343&&f.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},p}();s.Scanner=g},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenName={},s.TokenName[1]="Boolean",s.TokenName[2]="<end>",s.TokenName[3]="Identifier",s.TokenName[4]="Keyword",s.TokenName[5]="Null",s.TokenName[6]="Numeric",s.TokenName[7]="Punctuator",s.TokenName[8]="String",s.TokenName[9]="RegularExpression",s.TokenName[10]="Template"},function(a,s){Object.defineProperty(s,"__esModule",{value:!0}),s.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(a,s,c){Object.defineProperty(s,"__esModule",{value:!0});var l=c(10),f=c(12),u=c(13),d=function(){function g(){this.values=[],this.curly=this.paren=-1}return g.prototype.beforeFunctionExpression=function(p){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(p)>=0},g.prototype.isRegexStart=function(){var p=this.values[this.values.length-1],v=p!==null;switch(p){case"this":case"]":v=!1;break;case")":var w=this.values[this.paren-1];v=w==="if"||w==="while"||w==="for"||w==="with";break;case"}":if(v=!1,this.values[this.curly-3]==="function")v=!!(m=this.values[this.curly-4])&&!this.beforeFunctionExpression(m);else if(this.values[this.curly-4]==="function"){var m;v=!(m=this.values[this.curly-5])||!this.beforeFunctionExpression(m)}}return v},g.prototype.push=function(p){p.type===7||p.type===4?(p.value==="{"?this.curly=this.values.length:p.value==="("&&(this.paren=this.values.length),this.values.push(p.value)):this.values.push(null)},g}(),h=function(){function g(p,v){this.errorHandler=new l.ErrorHandler,this.errorHandler.tolerant=!!v&&typeof v.tolerant=="boolean"&&v.tolerant,this.scanner=new f.Scanner(p,this.errorHandler),this.scanner.trackComment=!!v&&typeof v.comment=="boolean"&&v.comment,this.trackRange=!!v&&typeof v.range=="boolean"&&v.range,this.trackLoc=!!v&&typeof v.loc=="boolean"&&v.loc,this.buffer=[],this.reader=new d}return g.prototype.errors=function(){return this.errorHandler.errors},g.prototype.getNextToken=function(){if(this.buffer.length===0){var p=this.scanner.scanComments();if(this.scanner.trackComment)for(var v=0;v<p.length;++v){var w=p[v],m=this.scanner.source.slice(w.slice[0],w.slice[1]),y={type:w.multiLine?"BlockComment":"LineComment",value:m};this.trackRange&&(y.range=w.range),this.trackLoc&&(y.loc=w.loc),this.buffer.push(y)}if(!this.scanner.eof()){var x=void 0;this.trackLoc&&(x={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var C=this.scanner.source[this.scanner.index]==="/"&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(C);var S={type:u.TokenName[C.type],value:this.scanner.source.slice(C.start,C.end)};if(this.trackRange&&(S.range=[C.start,C.end]),this.trackLoc&&(x.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},S.loc=x),C.type===9){var T=C.pattern,_=C.flags;S.regex={pattern:T,flags:_}}this.buffer.push(S)}}return this.buffer.shift()},g}();s.Tokenizer=h}])},r.exports=o()},function(r,n,i){var o=i(38),a=i(53),s=i(76),c=i(54),l=Object.prototype.toString,f=Object.prototype.hasOwnProperty,u={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},d=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function h(M){var P,k,z;if(P=M.toString(16).toUpperCase(),M<=255)k="x",z=2;else if(M<=65535)k="u",z=4;else{if(!(M<=4294967295))throw new a("code point within a string may not be greater than 0xFFFFFFFF");k="U",z=8}return"\\"+k+o.repeat("0",z-P.length)+P}function g(M){this.schema=M.schema||s,this.indent=Math.max(1,M.indent||2),this.noArrayIndent=M.noArrayIndent||!1,this.skipInvalid=M.skipInvalid||!1,this.flowLevel=o.isNothing(M.flowLevel)?-1:M.flowLevel,this.styleMap=function(P,k){var z,A,L,N,H,ee,oe;if(k===null)return{};for(z={},L=0,N=(A=Object.keys(k)).length;L<N;L+=1)H=A[L],ee=String(k[H]),H.slice(0,2)==="!!"&&(H="tag:yaml.org,2002:"+H.slice(2)),(oe=P.compiledTypeMap.fallback[H])&&f.call(oe.styleAliases,ee)&&(ee=oe.styleAliases[ee]),z[H]=ee;return z}(this.schema,M.styles||null),this.sortKeys=M.sortKeys||!1,this.lineWidth=M.lineWidth||80,this.noRefs=M.noRefs||!1,this.noCompatMode=M.noCompatMode||!1,this.condenseFlow=M.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function p(M,P){for(var k,z=o.repeat(" ",P),A=0,L=-1,N="",H=M.length;A<H;)(L=M.indexOf(`
`,A))===-1?(k=M.slice(A),A=H):(k=M.slice(A,L+1),A=L+1),k.length&&k!==`
`&&(N+=z),N+=k;return N}function v(M,P){return`
`+o.repeat(" ",M.indent*P)}function w(M){return M===32||M===9}function m(M){return 32<=M&&M<=126||161<=M&&M<=55295&&M!==8232&&M!==8233||57344<=M&&M<=65533&&M!==65279||65536<=M&&M<=1114111}function y(M,P){return m(M)&&M!==65279&&M!==44&&M!==91&&M!==93&&M!==123&&M!==125&&M!==58&&(M!==35||P&&function(k){return m(k)&&!w(k)&&k!==65279&&k!==13&&k!==10}(P))}function x(M){return/^\n* /.test(M)}function C(M,P,k,z,A){var L,N,H,ee,oe=!1,de=!1,ue=z!==-1,me=-1,Ee=m(ee=M.charCodeAt(0))&&ee!==65279&&!w(ee)&&ee!==45&&ee!==63&&ee!==58&&ee!==44&&ee!==91&&ee!==93&&ee!==123&&ee!==125&&ee!==35&&ee!==38&&ee!==42&&ee!==33&&ee!==124&&ee!==61&&ee!==62&&ee!==39&&ee!==34&&ee!==37&&ee!==64&&ee!==96&&!w(M.charCodeAt(M.length-1));if(P)for(L=0;L<M.length;L++){if(!m(N=M.charCodeAt(L)))return 5;H=L>0?M.charCodeAt(L-1):null,Ee=Ee&&y(N,H)}else{for(L=0;L<M.length;L++){if((N=M.charCodeAt(L))===10)oe=!0,ue&&(de=de||L-me-1>z&&M[me+1]!==" ",me=L);else if(!m(N))return 5;H=L>0?M.charCodeAt(L-1):null,Ee=Ee&&y(N,H)}de=de||ue&&L-me-1>z&&M[me+1]!==" "}return oe||de?k>9&&x(M)?5:de?4:3:Ee&&!A(M)?1:2}function S(M,P,k,z){M.dump=function(){if(P.length===0)return"''";if(!M.noCompatMode&&d.indexOf(P)!==-1)return"'"+P+"'";var A=M.indent*Math.max(1,k),L=M.lineWidth===-1?-1:Math.max(Math.min(M.lineWidth,40),M.lineWidth-A),N=z||M.flowLevel>-1&&k>=M.flowLevel;switch(C(P,N,M.indent,L,function(H){return function(ee,oe){var de,ue;for(de=0,ue=ee.implicitTypes.length;de<ue;de+=1)if(ee.implicitTypes[de].resolve(oe))return!0;return!1}(M,H)})){case 1:return P;case 2:return"'"+P.replace(/'/g,"''")+"'";case 3:return"|"+T(P,M.indent)+_(p(P,A));case 4:return">"+T(P,M.indent)+_(p(function(H,ee){for(var oe,de,ue=/(\n+)([^\n]*)/g,me=(_e=H.indexOf(`
`),_e=_e!==-1?_e:H.length,ue.lastIndex=_e,E(H.slice(0,_e),ee)),Ee=H[0]===`
`||H[0]===" ",_e;de=ue.exec(H);){var Ce=de[1],F=de[2];oe=F[0]===" ",me+=Ce+(Ee||oe||F===""?"":`
`)+E(F,ee),Ee=oe}return me}(P,L),A));case 5:return'"'+function(H){for(var ee,oe,de,ue="",me=0;me<H.length;me++)(ee=H.charCodeAt(me))>=55296&&ee<=56319&&(oe=H.charCodeAt(me+1))>=56320&&oe<=57343?(ue+=h(1024*(ee-55296)+oe-56320+65536),me++):(de=u[ee],ue+=!de&&m(ee)?H[me]:de||h(ee));return ue}(P)+'"';default:throw new a("impossible error: invalid scalar style")}}()}function T(M,P){var k=x(M)?String(P):"",z=M[M.length-1]===`
`;return k+(z&&(M[M.length-2]===`
`||M===`
`)?"+":z?"":"-")+`
`}function _(M){return M[M.length-1]===`
`?M.slice(0,-1):M}function E(M,P){if(M===""||M[0]===" ")return M;for(var k,z,A=/ [^ ]/g,L=0,N=0,H=0,ee="";k=A.exec(M);)(H=k.index)-L>P&&(z=N>L?N:H,ee+=`
`+M.slice(L,z),L=z+1),N=H;return ee+=`
`,M.length-L>P&&N>L?ee+=M.slice(L,N)+`
`+M.slice(N+1):ee+=M.slice(L),ee.slice(1)}function D(M,P,k){var z,A,L,N,H,ee;for(L=0,N=(A=k?M.explicitTypes:M.implicitTypes).length;L<N;L+=1)if(((H=A[L]).instanceOf||H.predicate)&&(!H.instanceOf||typeof P=="object"&&P instanceof H.instanceOf)&&(!H.predicate||H.predicate(P))){if(M.tag=k?H.tag:"?",H.represent){if(ee=M.styleMap[H.tag]||H.defaultStyle,l.call(H.represent)==="[object Function]")z=H.represent(P,ee);else{if(!f.call(H.represent,ee))throw new a("!<"+H.tag+'> tag resolver accepts not "'+ee+'" style');z=H.represent[ee](P,ee)}M.dump=z}return!0}return!1}function b(M,P,k,z,A,L){M.tag=null,M.dump=k,D(M,k,!1)||D(M,k,!0);var N=l.call(M.dump);z&&(z=M.flowLevel<0||M.flowLevel>P);var H,ee,oe=N==="[object Object]"||N==="[object Array]";if(oe&&(ee=(H=M.duplicates.indexOf(k))!==-1),(M.tag!==null&&M.tag!=="?"||ee||M.indent!==2&&P>0)&&(A=!1),ee&&M.usedDuplicates[H])M.dump="*ref_"+H;else{if(oe&&ee&&!M.usedDuplicates[H]&&(M.usedDuplicates[H]=!0),N==="[object Object]")z&&Object.keys(M.dump).length!==0?(function(ue,me,Ee,_e){var Ce,F,O,$,W,X,Z="",ne=ue.tag,xe=Object.keys(Ee);if(ue.sortKeys===!0)xe.sort();else if(typeof ue.sortKeys=="function")xe.sort(ue.sortKeys);else if(ue.sortKeys)throw new a("sortKeys must be a boolean or a function");for(Ce=0,F=xe.length;Ce<F;Ce+=1)X="",_e&&Ce===0||(X+=v(ue,me)),$=Ee[O=xe[Ce]],b(ue,me+1,O,!0,!0,!0)&&((W=ue.tag!==null&&ue.tag!=="?"||ue.dump&&ue.dump.length>1024)&&(ue.dump&&ue.dump.charCodeAt(0)===10?X+="?":X+="? "),X+=ue.dump,W&&(X+=v(ue,me)),b(ue,me+1,$,!0,W)&&(ue.dump&&ue.dump.charCodeAt(0)===10?X+=":":X+=": ",Z+=X+=ue.dump));ue.tag=ne,ue.dump=Z||"{}"}(M,P,M.dump,A),ee&&(M.dump="&ref_"+H+M.dump)):(function(ue,me,Ee){var _e,Ce,F,O,$,W="",X=ue.tag,Z=Object.keys(Ee);for(_e=0,Ce=Z.length;_e<Ce;_e+=1)$="",_e!==0&&($+=", "),ue.condenseFlow&&($+='"'),O=Ee[F=Z[_e]],b(ue,me,F,!1,!1)&&(ue.dump.length>1024&&($+="? "),$+=ue.dump+(ue.condenseFlow?'"':"")+":"+(ue.condenseFlow?"":" "),b(ue,me,O,!1,!1)&&(W+=$+=ue.dump));ue.tag=X,ue.dump="{"+W+"}"}(M,P,M.dump),ee&&(M.dump="&ref_"+H+" "+M.dump));else if(N==="[object Array]"){var de=M.noArrayIndent&&P>0?P-1:P;z&&M.dump.length!==0?(function(ue,me,Ee,_e){var Ce,F,O="",$=ue.tag;for(Ce=0,F=Ee.length;Ce<F;Ce+=1)b(ue,me+1,Ee[Ce],!0,!0)&&(_e&&Ce===0||(O+=v(ue,me)),ue.dump&&ue.dump.charCodeAt(0)===10?O+="-":O+="- ",O+=ue.dump);ue.tag=$,ue.dump=O||"[]"}(M,de,M.dump,A),ee&&(M.dump="&ref_"+H+M.dump)):(function(ue,me,Ee){var _e,Ce,F="",O=ue.tag;for(_e=0,Ce=Ee.length;_e<Ce;_e+=1)b(ue,me,Ee[_e],!1,!1)&&(_e!==0&&(F+=","+(ue.condenseFlow?"":" ")),F+=ue.dump);ue.tag=O,ue.dump="["+F+"]"}(M,de,M.dump),ee&&(M.dump="&ref_"+H+" "+M.dump))}else{if(N!=="[object String]"){if(M.skipInvalid)return!1;throw new a("unacceptable kind of an object to dump "+N)}M.tag!=="?"&&S(M,M.dump,P,L)}M.tag!==null&&M.tag!=="?"&&(M.dump="!<"+M.tag+"> "+M.dump)}return!0}function I(M,P){var k,z,A=[],L=[];for(function N(H,ee,oe){var de,ue,me;if(H!==null&&typeof H=="object")if((ue=ee.indexOf(H))!==-1)oe.indexOf(ue)===-1&&oe.push(ue);else if(ee.push(H),Array.isArray(H))for(ue=0,me=H.length;ue<me;ue+=1)N(H[ue],ee,oe);else for(de=Object.keys(H),ue=0,me=de.length;ue<me;ue+=1)N(H[de[ue]],ee,oe)}(M,A,L),k=0,z=L.length;k<z;k+=1)P.duplicates.push(A[L[k]]);P.usedDuplicates=new Array(z)}function R(M,P){var k=new g(P=P||{});return k.noRefs||I(M,k),b(k,0,M,!0,!0)?k.dump+`
`:""}r.exports.dump=R,r.exports.safeDump=function(M,P){return R(M,o.extend({schema:c},P))}},function(r,n,i){i(31),i(32),i(33),i(64),i(19),i(65),i(20),i(68),i(92),i(144),i(22),i(94),i(23);var o,a=this&&this.__extends||(o=function(C,S){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,_){T.__proto__=_}||function(T,_){for(var E in _)_.hasOwnProperty(E)&&(T[E]=_[E])})(C,S)},function(C,S){function T(){this.constructor=C}o(C,S),C.prototype=S===null?Object.create(S):(T.prototype=S.prototype,new T)}),s=this&&this.__values||function(C){var S=typeof Symbol=="function"&&Symbol.iterator,T=S&&C[S],_=0;if(T)return T.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&_>=C.length&&(C=void 0),{value:C&&C[_++],done:!C}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__read||function(C,S){var T=typeof Symbol=="function"&&C[Symbol.iterator];if(!T)return C;var _,E,D=T.call(C),b=[];try{for(;(S===void 0||S-- >0)&&!(_=D.next()).done;)b.push(_.value)}catch(I){E={error:I}}finally{try{_&&!_.done&&(T=D.return)&&T.call(D)}finally{if(E)throw E.error}}return b};Object.defineProperty(n,"__esModule",{value:!0});var l=i(91),f=i(1),u=i(183),d=i(0),h=i(7),g=i(95),p=i(69),v=i(3),w=i(305),m=i(306),y=i(307),x=function(C){function S(T,_){_===void 0&&(_=!1);var E=C.call(this)||this;return E._hasDeclaration=!1,E._docTypeName="",E._hasDocumentElement=!1,E._currentElementSerialized=!1,E._openTags=[],E._ended=!1,E._fragment=_,E._options=f.applyDefaults(T||{},l.DefaultXMLBuilderCBOptions),E._builderOptions={defaultNamespace:E._options.defaultNamespace,namespaceAlias:E._options.namespaceAlias},E._options.format==="json"?E._writer=new m.JSONCBWriter(E._options):E._options.format==="yaml"?E._writer=new y.YAMLCBWriter(E._options):E._writer=new w.XMLCBWriter(E._options),E._options.data!==void 0&&E.on("data",E._options.data),E._options.end!==void 0&&E.on("end",E._options.end),E._options.error!==void 0&&E.on("error",E._options.error),E._prefixMap=new g.NamespacePrefixMap,E._prefixMap.set("xml",h.namespace.XML),E._prefixIndex={value:1},E._push(E._writer.frontMatter()),E}return a(S,C),S.prototype.ele=function(T,_,E){var D,b;if(f.isObject(T)||f.isString(T)&&(/^\s*</.test(T)||/^\s*[\{\[]/.test(T)||/^(\s*|(#.*)|(%.*))*---/.test(T))){var I=u.fragment().set(this._options);try{I.ele(T)}catch(k){return this.emit("error",k),this}try{for(var R=s(I.node.childNodes),M=R.next();!M.done;M=R.next()){var P=M.value;this._fromNode(P)}}catch(k){D={error:k}}finally{try{M&&!M.done&&(b=R.return)&&b.call(R)}finally{if(D)throw D.error}}return this}if(this._serializeOpenTag(!0),!this._fragment&&this._hasDocumentElement&&this._writer.level===0)return this.emit("error",new Error("Document cannot have multiple document element nodes.")),this;try{this._currentElement=u.fragment(this._builderOptions).ele(T,_,E)}catch(k){return this.emit("error",k),this}return this._fragment||this._hasDocumentElement||this._docTypeName===""||this._currentElement.node._qualifiedName===this._docTypeName?(this._currentElementSerialized=!1,this._fragment||(this._hasDocumentElement=!0),this):(this.emit("error",new Error("Document element name does not match DocType declaration name.")),this)},S.prototype.att=function(T,_,E){if(this._currentElement===void 0)return this.emit("error",new Error("Cannot insert an attribute node as child of a document node.")),this;try{this._currentElement.att(T,_,E)}catch(D){return this.emit("error",D),this}return this},S.prototype.com=function(T){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).com(T).first().node}catch(E){return this.emit("error",E),this}return!this._options.wellFormed||d.xml_isLegalChar(_.data)&&_.data.indexOf("--")===-1&&!_.data.endsWith("-")?(this._push(this._writer.comment(_.data)),this):(this.emit("error",new Error("Comment data contains invalid characters (well-formed required).")),this)},S.prototype.txt=function(T){if(!this._fragment&&this._currentElement===void 0)return this.emit("error",new Error("Cannot insert a text node as child of a document node.")),this;var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).txt(T).first().node}catch(D){return this.emit("error",D),this}if(this._options.wellFormed&&!d.xml_isLegalChar(_.data))return this.emit("error",new Error("Text data contains invalid characters (well-formed required).")),this;var E=_.data.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return this._push(this._writer.text(E)),this},S.prototype.ins=function(T,_){var E;_===void 0&&(_=""),this._serializeOpenTag(!0);try{E=u.fragment(this._builderOptions).ins(T,_).first().node}catch(D){return this.emit("error",D),this}return this._options.wellFormed&&(E.target.indexOf(":")!==-1||/^xml$/i.test(E.target))?(this.emit("error",new Error("Processing instruction target contains invalid characters (well-formed required).")),this):this._options.wellFormed&&!d.xml_isLegalChar(E.data)?(this.emit("error",Error("Processing instruction data contains invalid characters (well-formed required).")),this):(this._push(this._writer.instruction(E.target,E.data)),this)},S.prototype.dat=function(T){var _;this._serializeOpenTag(!0);try{_=u.fragment(this._builderOptions).dat(T).first().node}catch(E){return this.emit("error",E),this}return this._push(this._writer.cdata(_.data)),this},S.prototype.dec=function(T){return T===void 0&&(T={version:"1.0"}),this._fragment?(this.emit("error",Error("Cannot insert an XML declaration into a document fragment.")),this):this._hasDeclaration?(this.emit("error",Error("XML declaration is already inserted.")),this):(this._push(this._writer.declaration(T.version||"1.0",T.encoding,T.standalone)),this._hasDeclaration=!0,this)},S.prototype.dtd=function(T){if(this._fragment)return this.emit("error",Error("Cannot insert a DocType declaration into a document fragment.")),this;if(this._docTypeName!=="")return this.emit("error",new Error("DocType declaration is already inserted.")),this;if(this._hasDocumentElement)return this.emit("error",new Error("Cannot insert DocType declaration after document element.")),this;var _;try{_=u.create().dtd(T).first().node}catch(E){return this.emit("error",E),this}return this._options.wellFormed&&!d.xml_isPubidChar(_.publicId)?(this.emit("error",new Error("DocType public identifier does not match PubidChar construct (well-formed required).")),this):this._options.wellFormed&&(!d.xml_isLegalChar(_.systemId)||_.systemId.indexOf('"')!==-1&&_.systemId.indexOf("'")!==-1)?(this.emit("error",new Error("DocType system identifier contains invalid characters (well-formed required).")),this):(this._docTypeName=T.name,this._push(this._writer.docType(T.name,_.publicId,_.systemId)),this)},S.prototype.import=function(T){var _,E,D=u.fragment().set(this._options);try{D.import(T)}catch(M){return this.emit("error",M),this}try{for(var b=s(D.node.childNodes),I=b.next();!I.done;I=b.next()){var R=I.value;this._fromNode(R)}}catch(M){_={error:M}}finally{try{I&&!I.done&&(E=b.return)&&E.call(b)}finally{if(_)throw _.error}}return this},S.prototype.up=function(){return this._serializeOpenTag(!1),this._serializeCloseTag(),this},S.prototype.end=function(){for(this._serializeOpenTag(!1);this._openTags.length>0;)this._serializeCloseTag();return this._push(null),this},S.prototype._serializeOpenTag=function(T){if(!this._currentElementSerialized&&this._currentElement!==void 0){var _=this._currentElement.node;if(!this._options.wellFormed||_.localName.indexOf(":")===-1&&d.xml_isName(_.localName)){var E="",D=!1,b=this._prefixMap.copy(),I={},R=this._recordNamespaceInformation(_,b,I),M=this._openTags.length===0?null:this._openTags[this._openTags.length-1][1],P=_.namespaceURI;if(P===null&&(P=M),M===P)R!==null&&(D=!0),E=P===h.namespace.XML?"xml:"+_.localName:_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E));else{var k=_.prefix,z=null;if(k===null&&P===R||(z=b.get(k,P)),k==="xmlns"){if(this._options.wellFormed)return void this.emit("error",new Error("An element cannot have the 'xmlns' prefix (well-formed required)."));z=k}z!==null?(E=z+":"+_.localName,R!==null&&R!==h.namespace.XML&&(M=R||null),this._writer.beginElement(E),this._push(this._writer.openTagBegin(E))):k!==null?(k in I&&(k=this._generatePrefix(P,b,this._prefixIndex)),b.set(k,P),E+=k+":"+_.localName,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns:"+k,this._serializeAttributeValue(P,this._options.wellFormed))),R!==null&&(M=R||null)):R===null||R!==null&&R!==P?(D=!0,E+=_.localName,M=P,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)),this._push(this._writer.attribute("xmlns",this._serializeAttributeValue(P,this._options.wellFormed)))):(E+=_.localName,M=P,this._writer.beginElement(E),this._push(this._writer.openTagBegin(E)))}this._serializeAttributes(_,b,this._prefixIndex,I,D,this._options.wellFormed);var A=P===h.namespace.HTML;A&&!T&&S._VoidElementNames.has(_.localName)?(this._push(this._writer.openTagEnd(E,!0,!0)),this._writer.endElement(E)):A||T?this._push(this._writer.openTagEnd(E,!1,!1)):(this._push(this._writer.openTagEnd(E,!0,!1)),this._writer.endElement(E)),this._currentElementSerialized=!0,this._openTags.push([E,M,this._prefixMap,T]),this._isPrefixMapModified(this._prefixMap,b)&&(this._prefixMap=b),this._writer.level++}else this.emit("error",new Error("Node local name contains invalid characters (well-formed required)."))}},S.prototype._serializeCloseTag=function(){this._writer.level--;var T=this._openTags.pop();if(T!==void 0){var _=c(T,4),E=_[0],D=(_[1],_[2]),b=_[3];this._prefixMap=D,b&&(this._push(this._writer.closeTag(E)),this._writer.endElement(E))}else this.emit("error",new Error("Last element is undefined."))},S.prototype._push=function(T){T===null?(this._ended=!0,this.emit("end")):this._ended?this.emit("error",new Error("Cannot push to ended stream.")):T.length!==0&&(this._writer.hasData=!0,this.emit("data",T,this._writer.level))},S.prototype._fromNode=function(T){var _,E,D,b;if(v.Guard.isElementNode(T)){var I=T.prefix?T.prefix+":"+T.localName:T.localName;T.namespaceURI!==null?this.ele(T.namespaceURI,I):this.ele(I);try{for(var R=s(T.attributes),M=R.next();!M.done;M=R.next()){var P=M.value,k=P.prefix?P.prefix+":"+P.localName:P.localName;P.namespaceURI!==null?this.att(P.namespaceURI,k,P.value):this.att(k,P.value)}}catch(N){_={error:N}}finally{try{M&&!M.done&&(E=R.return)&&E.call(R)}finally{if(_)throw _.error}}try{for(var z=s(T.childNodes),A=z.next();!A.done;A=z.next()){var L=A.value;this._fromNode(L)}}catch(N){D={error:N}}finally{try{A&&!A.done&&(b=z.return)&&b.call(z)}finally{if(D)throw D.error}}this.up()}else v.Guard.isExclusiveTextNode(T)&&T.data?this.txt(T.data):v.Guard.isCommentNode(T)?this.com(T.data):v.Guard.isCDATASectionNode(T)?this.dat(T.data):v.Guard.isProcessingInstructionNode(T)&&this.ins(T.target,T.data)},S.prototype._serializeAttributes=function(T,_,E,D,b,I){var R,M,P=I?new p.LocalNameSet:void 0;try{for(var k=s(T.attributes),z=k.next();!z.done;z=k.next()){var A=z.value;if(I||b||A.namespaceURI!==null){if(I&&P&&P.has(A.namespaceURI,A.localName))return void this.emit("error",new Error("Element contains duplicate attributes (well-formed required)."));I&&P&&P.set(A.namespaceURI,A.localName);var L=A.namespaceURI,N=null;if(L!==null)if(N=_.get(A.prefix,L),L===h.namespace.XMLNS){if(A.value===h.namespace.XML||A.prefix===null&&b||A.prefix!==null&&(!(A.localName in D)||D[A.localName]!==A.value)&&_.has(A.localName,A.value))continue;if(I&&A.value===h.namespace.XMLNS)return void this.emit("error",new Error("XMLNS namespace is reserved (well-formed required)."));if(I&&A.value==="")return void this.emit("error",new Error("Namespace prefix declarations cannot be used to undeclare a namespace (well-formed required)."));A.prefix==="xmlns"&&(N="xmlns")}else N===null&&(N=A.prefix===null||_.hasPrefix(A.prefix)&&!_.has(A.prefix,L)?this._generatePrefix(L,_,E):A.prefix,this._push(this._writer.attribute("xmlns:"+N,this._serializeAttributeValue(L,this._options.wellFormed))));if(I&&(A.localName.indexOf(":")!==-1||!d.xml_isName(A.localName)||A.localName==="xmlns"&&L===null))return void this.emit("error",new Error("Attribute local name contains invalid characters (well-formed required)."));this._push(this._writer.attribute((N!==null?N+":":"")+A.localName,this._serializeAttributeValue(A.value,this._options.wellFormed)))}else this._push(this._writer.attribute(A.localName,this._serializeAttributeValue(A.value,this._options.wellFormed)))}}catch(H){R={error:H}}finally{try{z&&!z.done&&(M=k.return)&&M.call(k)}finally{if(R)throw R.error}}},S.prototype._serializeAttributeValue=function(T,_){return _&&T!==null&&!d.xml_isLegalChar(T)?(this.emit("error",new Error("Invalid characters in attribute value.")),""):T===null?"":T.replace(/(?!&(lt|gt|amp|apos|quot);)&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},S.prototype._recordNamespaceInformation=function(T,_,E){var D,b,I=null;try{for(var R=s(T.attributes),M=R.next();!M.done;M=R.next()){var P=M.value,k=P.namespaceURI,z=P.prefix;if(k===h.namespace.XMLNS){if(z===null){I=P.value;continue}var A=P.localName,L=P.value;if(L===h.namespace.XML||(L===""&&(L=null),_.has(A,L)))continue;_.set(A,L),E[A]=L||""}}}catch(N){D={error:N}}finally{try{M&&!M.done&&(b=R.return)&&b.call(R)}finally{if(D)throw D.error}}return I},S.prototype._generatePrefix=function(T,_,E){var D="ns"+E.value;return E.value++,_.set(D,T),D},S.prototype._isPrefixMapModified=function(T,_){var E=T._items,D=_._items,b=T._nullItems,I=_._nullItems;for(var R in D){var M=E[R];if(M===void 0)return!0;var P=D[R];if(M.length!==P.length)return!0;for(var k=0;k<M.length;k++)if(M[k]!==P[k])return!0}if(b.length!==I.length)return!0;for(k=0;k<b.length;k++)if(b[k]!==I[k])return!0;return!1},S._VoidElementNames=new Set(["area","base","basefont","bgsound","br","col","embed","frame","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"]),S}(i(308).EventEmitter);n.XMLBuilderCBImpl=x},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=function(c){function l(f){var u=c.call(this,f)||this;return u._lineLength=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(f,u,d){var h=this._beginLine()+"<?xml";return h+=' version="'+f+'"',u!==void 0&&(h+=' encoding="'+u+'"'),d!==void 0&&(h+=' standalone="'+(d?"yes":"no")+'"'),h+="?>"},l.prototype.docType=function(f,u,d){var h=this._beginLine();return h+=u&&d?"<!DOCTYPE "+f+' PUBLIC "'+u+'" "'+d+'">':u?"<!DOCTYPE "+f+' PUBLIC "'+u+'">':d?"<!DOCTYPE "+f+' SYSTEM "'+d+'">':"<!DOCTYPE "+f+">"},l.prototype.comment=function(f){return this._beginLine()+"<!--"+f+"-->"},l.prototype.text=function(f){return this._beginLine()+f},l.prototype.instruction=function(f,u){return u?this._beginLine()+"<?"+f+" "+u+"?>":this._beginLine()+"<?"+f+"?>"},l.prototype.cdata=function(f){return this._beginLine()+"<![CDATA["+f+"]]>"},l.prototype.openTagBegin=function(f){return this._lineLength+=1+f.length,this._beginLine()+"<"+f},l.prototype.openTagEnd=function(f,u,d){return d?" />":u?this._writerOptions.allowEmptyTags?"></"+f+">":this._writerOptions.spaceBeforeSlash?" />":"/>":">"},l.prototype.closeTag=function(f){return this._beginLine()+"</"+f+">"},l.prototype.attribute=function(f,u){var d=f+'="'+u+'"';return this._writerOptions.prettyPrint&&this._writerOptions.width>0&&this._lineLength+1+d.length>this._writerOptions.width?(d=this._beginLine()+this._indent(1)+d,this._lineLength=d.length,d):(this._lineLength+=1+d.length," "+d)},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){},l.prototype._beginLine=function(){if(this._writerOptions.prettyPrint){var f=(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level);return this._lineLength=f.length,f}return""},l.prototype._indent=function(f){return f<=0?"":this._writerOptions.indent.repeat(f)},l}(i(114).BaseCBWriter);n.XMLCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=function(c){function l(f){var u=c.call(this,f)||this;return u._hasChildren=[],u._additionalLevel=0,u}return a(l,c),l.prototype.frontMatter=function(){return""},l.prototype.declaration=function(f,u,d){return""},l.prototype.docType=function(f,u,d){return""},l.prototype.comment=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.comment)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.text=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.text)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.instruction=function(f,u){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.ins)+this._sep()+this._val(u?f+" "+u:f)+this._sep()+"}"},l.prototype.cdata=function(f){return this._comma()+this._beginLine()+"{"+this._sep()+this._key(this._builderOptions.convert.cdata)+this._sep()+this._val(f)+this._sep()+"}"},l.prototype.attribute=function(f,u){return this._comma()+this._beginLine(1)+"{"+this._sep()+this._key(this._builderOptions.convert.att+f)+this._sep()+this._val(u)+this._sep()+"}"},l.prototype.openTagBegin=function(f){var u=this._comma()+this._beginLine()+"{"+this._sep()+this._key(f)+this._sep()+"{";return this._additionalLevel++,this.hasData=!0,u+=this._beginLine()+this._key(this._builderOptions.convert.text)+this._sep()+"[",this._hasChildren.push(!1),u},l.prototype.openTagEnd=function(f,u,d){if(u){var h=this._sep()+"]";return this._additionalLevel--,h+=this._beginLine()+"}"+this._sep()+"}"}return""},l.prototype.closeTag=function(f){var u=this._beginLine()+"]";return this._additionalLevel--,u+=this._beginLine()+"}"+this._sep()+"}"},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){this._hasChildren.pop()},l.prototype._beginLine=function(f){return f===void 0&&(f=0),this._writerOptions.prettyPrint?(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level+f):""},l.prototype._indent=function(f){return f+this._additionalLevel<=0?"":this._writerOptions.indent.repeat(f+this._additionalLevel)},l.prototype._comma=function(){var f=this._hasChildren[this._hasChildren.length-1]?",":"";return this._hasChildren.length>0&&(this._hasChildren[this._hasChildren.length-1]=!0),f},l.prototype._sep=function(){return this._writerOptions.prettyPrint?" ":""},l.prototype._key=function(f){return'"'+f+'":'},l.prototype._val=function(f){return JSON.stringify(f)},l}(i(114).BaseCBWriter);n.JSONCBWriter=s},function(r,n,i){i(74);var o,a=this&&this.__extends||(o=function(c,l){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,u){f.__proto__=u}||function(f,u){for(var d in u)u.hasOwnProperty(d)&&(f[d]=u[d])})(c,l)},function(c,l){function f(){this.constructor=c}o(c,l),c.prototype=l===null?Object.create(l):(f.prototype=l.prototype,new f)});Object.defineProperty(n,"__esModule",{value:!0});var s=function(c){function l(f){var u=c.call(this,f)||this;if(u._rootWritten=!1,u._additionalLevel=0,f.indent.length<2)throw new Error("YAML indententation string must be at least two characters long.");if(f.offset<0)throw new Error("YAML offset should be zero or a positive number.");return u}return a(l,c),l.prototype.frontMatter=function(){return this._beginLine()+"---"},l.prototype.declaration=function(f,u,d){return""},l.prototype.docType=function(f,u,d){return""},l.prototype.comment=function(f){return this._beginLine()+this._key(this._builderOptions.convert.comment)+" "+this._val(f)},l.prototype.text=function(f){return this._beginLine()+this._key(this._builderOptions.convert.text)+" "+this._val(f)},l.prototype.instruction=function(f,u){return this._beginLine()+this._key(this._builderOptions.convert.ins)+" "+this._val(u?f+" "+u:f)},l.prototype.cdata=function(f){return this._beginLine()+this._key(this._builderOptions.convert.cdata)+" "+this._val(f)},l.prototype.attribute=function(f,u){this._additionalLevel++;var d=this._beginLine()+this._key(this._builderOptions.convert.att+f)+" "+this._val(u);return this._additionalLevel--,d},l.prototype.openTagBegin=function(f){var u=this._beginLine()+this._key(f);return this._rootWritten||(this._rootWritten=!0),this.hasData=!0,this._additionalLevel++,u+=this._beginLine(!0)+this._key(this._builderOptions.convert.text)},l.prototype.openTagEnd=function(f,u,d){return u?" "+this._val(""):""},l.prototype.closeTag=function(f){return this._additionalLevel--,""},l.prototype.beginElement=function(f){},l.prototype.endElement=function(f){},l.prototype._beginLine=function(f){return f===void 0&&(f=!1),(this.hasData?this._writerOptions.newline:"")+this._indent(this._writerOptions.offset+this.level,f)},l.prototype._indent=function(f,u){if(f+this._additionalLevel<=0)return"";var d=this._writerOptions.indent.repeat(f+this._additionalLevel);return!u&&this._rootWritten?d.substr(0,d.length-2)+"-"+d.substr(-1,1):d},l.prototype._key=function(f){return'"'+f+'":'},l.prototype._val=function(f){return JSON.stringify(f)},l}(i(114).BaseCBWriter);n.YAMLCBWriter=s},function(r,n,i){var o,a=typeof Reflect=="object"?Reflect:null,s=a&&typeof a.apply=="function"?a.apply:function(y,x,C){return Function.prototype.apply.call(y,x,C)};o=a&&typeof a.ownKeys=="function"?a.ownKeys:Object.getOwnPropertySymbols?function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:function(y){return Object.getOwnPropertyNames(y)};var c=Number.isNaN||function(y){return y!=y};function l(){l.init.call(this)}r.exports=l,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function u(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}function d(y){return y._maxListeners===void 0?l.defaultMaxListeners:y._maxListeners}function h(y,x,C,S){var T,_,E,D;if(u(C),(_=y._events)===void 0?(_=y._events=Object.create(null),y._eventsCount=0):(_.newListener!==void 0&&(y.emit("newListener",x,C.listener?C.listener:C),_=y._events),E=_[x]),E===void 0)E=_[x]=C,++y._eventsCount;else if(typeof E=="function"?E=_[x]=S?[C,E]:[E,C]:S?E.unshift(C):E.push(C),(T=d(y))>0&&E.length>T&&!E.warned){E.warned=!0;var b=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");b.name="MaxListenersExceededWarning",b.emitter=y,b.type=x,b.count=E.length,D=b,console&&console.warn&&console.warn(D)}return y}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(y,x,C){var S={fired:!1,wrapFn:void 0,target:y,type:x,listener:C},T=g.bind(S);return T.listener=C,S.wrapFn=T,T}function v(y,x,C){var S=y._events;if(S===void 0)return[];var T=S[x];return T===void 0?[]:typeof T=="function"?C?[T.listener||T]:[T]:C?function(_){for(var E=new Array(_.length),D=0;D<E.length;++D)E[D]=_[D].listener||_[D];return E}(T):m(T,T.length)}function w(y){var x=this._events;if(x!==void 0){var C=x[y];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}function m(y,x){for(var C=new Array(x),S=0;S<x;++S)C[S]=y[S];return C}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");f=y}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||c(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this},l.prototype.getMaxListeners=function(){return d(this)},l.prototype.emit=function(y){for(var x=[],C=1;C<arguments.length;C++)x.push(arguments[C]);var S=y==="error",T=this._events;if(T!==void 0)S=S&&T.error===void 0;else if(!S)return!1;if(S){var _;if(x.length>0&&(_=x[0]),_ instanceof Error)throw _;var E=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw E.context=_,E}var D=T[y];if(D===void 0)return!1;if(typeof D=="function")s(D,this,x);else{var b=D.length,I=m(D,b);for(C=0;C<b;++C)s(I[C],this,x)}return!0},l.prototype.addListener=function(y,x){return h(this,y,x,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(y,x){return h(this,y,x,!0)},l.prototype.once=function(y,x){return u(x),this.on(y,p(this,y,x)),this},l.prototype.prependOnceListener=function(y,x){return u(x),this.prependListener(y,p(this,y,x)),this},l.prototype.removeListener=function(y,x){var C,S,T,_,E;if(u(x),(S=this._events)===void 0)return this;if((C=S[y])===void 0)return this;if(C===x||C.listener===x)--this._eventsCount==0?this._events=Object.create(null):(delete S[y],S.removeListener&&this.emit("removeListener",y,C.listener||x));else if(typeof C!="function"){for(T=-1,_=C.length-1;_>=0;_--)if(C[_]===x||C[_].listener===x){E=C[_].listener,T=_;break}if(T<0)return this;T===0?C.shift():function(D,b){for(;b+1<D.length;b++)D[b]=D[b+1];D.pop()}(C,T),C.length===1&&(S[y]=C[0]),S.removeListener!==void 0&&this.emit("removeListener",y,E||x)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(y){var x,C,S;if((C=this._events)===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[y]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete C[y]),this;if(arguments.length===0){var T,_=Object.keys(C);for(S=0;S<_.length;++S)(T=_[S])!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(x=C[y])=="function")this.removeListener(y,x);else if(x!==void 0)for(S=x.length-1;S>=0;S--)this.removeListener(y,x[S]);return this},l.prototype.listeners=function(y){return v(this,y,!0)},l.prototype.rawListeners=function(y){return v(this,y,!1)},l.listenerCount=function(y,x){return typeof y.listenerCount=="function"?y.listenerCount(x):w.call(y,x)},l.prototype.listenerCount=w,l.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(r,n,i){Object.defineProperty(n,"__esModule",{value:!0});var o=i(77);n.createCB=function(a){return new o.XMLBuilderCBImpl(a)},n.fragmentCB=function(a){return new o.XMLBuilderCBImpl(a,!0)}}])})})(jG);var aSe=jG.exports,Go=Uint8Array,Of=Uint16Array,HG=Uint32Array,KG=new Go([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qG=new Go([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sSe=new Go([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),XG=function(t,e){for(var r=new Of(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new HG(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},YG=XG(KG,2),JG=YG[0],cSe=YG[1];JG[28]=258,cSe[258]=28;var lSe=XG(qG,0),uSe=lSe[0],cS=new Of(32768);for(var cr=0;cr<32768;++cr){var bl=(cr&43690)>>>1|(cr&21845)<<1;bl=(bl&52428)>>>2|(bl&13107)<<2,bl=(bl&61680)>>>4|(bl&3855)<<4,cS[cr]=((bl&65280)>>>8|(bl&255)<<8)>>>1}var Ug=function(t,e,r){for(var n=t.length,i=0,o=new Of(e);i<n;++i)t[i]&&++o[t[i]-1];var a=new Of(e);for(i=0;i<e;++i)a[i]=a[i-1]+o[i-1]<<1;var s;if(r){s=new Of(1<<e);var c=15-e;for(i=0;i<n;++i)if(t[i])for(var l=i<<4|t[i],f=e-t[i],u=a[t[i]-1]++<<f,d=u|(1<<f)-1;u<=d;++u)s[cS[u]>>>c]=l}else for(s=new Of(n),i=0;i<n;++i)t[i]&&(s[i]=cS[a[t[i]-1]++]>>>15-t[i]);return s},E1=new Go(288);for(var cr=0;cr<144;++cr)E1[cr]=8;for(var cr=144;cr<256;++cr)E1[cr]=9;for(var cr=256;cr<280;++cr)E1[cr]=7;for(var cr=280;cr<288;++cr)E1[cr]=8;var ZG=new Go(32);for(var cr=0;cr<32;++cr)ZG[cr]=5;var fSe=Ug(E1,9,1),dSe=Ug(ZG,5,1),A3=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Wa=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},N3=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},hSe=function(t){return(t+7)/8|0},gSe=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?Of:t.BYTES_PER_ELEMENT==4?HG:Go)(r-e);return n.set(t.subarray(e,r)),n},pSe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xa=function(t,e,r){var n=new Error(e||pSe[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Xa),!r)throw n;return n},f8=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new Go(0);var i=!e||r,o=!r||r.i;r||(r={}),e||(e=new Go(n*3));var a=function(me){var Ee=e.length;if(me>Ee){var _e=new Go(Math.max(Ee*2,me));_e.set(e),e=_e}},s=r.f||0,c=r.p||0,l=r.b||0,f=r.l,u=r.d,d=r.m,h=r.n,g=n*8;do{if(!f){s=Wa(t,c,1);var p=Wa(t,c+1,3);if(c+=3,p)if(p==1)f=fSe,u=dSe,d=9,h=5;else if(p==2){var y=Wa(t,c,31)+257,x=Wa(t,c+10,15)+4,C=y+Wa(t,c+5,31)+1;c+=14;for(var S=new Go(C),T=new Go(19),_=0;_<x;++_)T[sSe[_]]=Wa(t,c+_*3,7);c+=x*3;for(var E=A3(T),D=(1<<E)-1,b=Ug(T,E,1),_=0;_<C;){var I=b[Wa(t,c,D)];c+=I&15;var v=I>>>4;if(v<16)S[_++]=v;else{var R=0,M=0;for(v==16?(M=3+Wa(t,c,3),c+=2,R=S[_-1]):v==17?(M=3+Wa(t,c,7),c+=3):v==18&&(M=11+Wa(t,c,127),c+=7);M--;)S[_++]=R}}var P=S.subarray(0,y),k=S.subarray(y);d=A3(P),h=A3(k),f=Ug(P,d,1),u=Ug(k,h,1)}else Xa(1);else{var v=hSe(c)+4,w=t[v-4]|t[v-3]<<8,m=v+w;if(m>n){o&&Xa(0);break}i&&a(l+w),e.set(t.subarray(v,m),l),r.b=l+=w,r.p=c=m*8,r.f=s;continue}if(c>g){o&&Xa(0);break}}i&&a(l+131072);for(var z=(1<<d)-1,A=(1<<h)-1,L=c;;L=c){var R=f[N3(t,c)&z],N=R>>>4;if(c+=R&15,c>g){o&&Xa(0);break}if(R||Xa(2),N<256)e[l++]=N;else if(N==256){L=c,f=null;break}else{var H=N-254;if(N>264){var _=N-257,ee=KG[_];H=Wa(t,c,(1<<ee)-1)+JG[_],c+=ee}var oe=u[N3(t,c)&A],de=oe>>>4;oe||Xa(3),c+=oe&15;var k=uSe[de];if(de>3){var ee=qG[de];k+=N3(t,c)&(1<<ee)-1,c+=ee}if(c>g){o&&Xa(0);break}i&&a(l+131072);for(var ue=l+H;l<ue;l+=4)e[l]=e[l-k],e[l+1]=e[l+1-k],e[l+2]=e[l+2-k],e[l+3]=e[l+3-k];l=ue}}r.l=f,r.p=L,r.b=l,r.f=s,f&&(s=1,r.m=d,r.d=u,r.n=h)}while(!s);return l==e.length?e:gSe(e,0,l)},mSe=new Go(0),vSe=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Xa(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=t[10]|(t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)},ySe=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},wSe=function(t){((t[0]&15)!=8||t[0]>>>4>7||(t[0]<<8|t[1])%31)&&Xa(6,"invalid zlib data"),t[1]&32&&Xa(6,"invalid zlib data: preset dictionaries not supported")};function xSe(t,e){return f8(t,e)}function CSe(t,e){return f8(t.subarray(vSe(t),-8),new Go(ySe(t)))}function SSe(t,e){return f8((wSe(t),t.subarray(2,-4)),e)}function TSe(t,e){return t[0]==31&&t[1]==139&&t[2]==8?CSe(t):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?xSe(t,e):SSe(t,e)}var _Se=typeof TextDecoder<"u"&&new TextDecoder,ESe=0;try{_Se.decode(mSe,{stream:!0}),ESe=1}catch{}const d8={};function QG(t){return!!d8[t]}function DSe(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return d8[t](e)}function eW(t,e){d8[t]=e}var bSe={get:DSe,has:QG,registerType:eW};const Vo=[];Vo[45]=62;Vo[95]=63;const X0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let t=0;t<X0.length;t++)Vo[X0.charCodeAt(t)]=t;function bs(t){return Vo[t.charCodeAt(0)]!==void 0}function ISe(t){const e=t.length,r=[];let n=null;for(let i=0;i<e;i++)bs(t[i])?(n||(n={start:i,count:0}),n.count++,n.end=i):t[i]==="="&&n&&(r.push(n),n=null);return n&&r.push(n),r}function OSe(t,e,r,n){const{start:i,count:o}=e,a=o%4,s=Math.floor(o/4);let c=i,l=null,f=r;for(let u=0;u<s;u++){for(;!bs(t[c]);)c++;for(l=Vo[t.charCodeAt(c++)]<<18;!bs(t[c]);)c++;for(l|=Vo[t.charCodeAt(c++)]<<12;!bs(t[c]);)c++;for(l|=Vo[t.charCodeAt(c++)]<<6;!bs(t[c]);)c++;l|=Vo[t.charCodeAt(c++)],n[f++]=l>>16&255,n[f++]=l>>8&255,n[f++]=l&255}switch(a){case 3:for(;!bs(t[c]);)c++;for(l=Vo[t.charCodeAt(c++)]<<10;!bs(t[c]);)c++;for(l|=Vo[t.charCodeAt(c++)]<<4;!bs(t[c]);)c++;l|=Vo[t.charCodeAt(c++)]>>2,n[f++]=l>>8&255,n[f++]=l&255;break;case 2:for(;!bs(t[c]);)c++;for(l=Vo[t.charCodeAt(c++)]<<2;!bs(t[c]);)c++;l|=Vo[t.charCodeAt(c++)]>>4,n[f++]=l&255;break;case 1:throw new Error("BASE64: remain 1 should not happen")}return f}function MSe(t){const e=ISe(t),r=e[e.length-1].end+1,n=(4-r%4)%4,i=(r+n)*3/4-n,o=new ArrayBuffer(i),a=new Uint8Array(o);let s=0;for(let c=0;c<e.length;c++)s+=OSe(t,e[c],s,a),s+=(4-e[c].count%4)%4;return o}function Rb(t,e,r){const n=(t<<16)+(e<<8)+r;return X0[n>>18]+X0[n>>12&63]+X0[n>>6&63]+X0[n&63]}function RSe(t){const e=new Uint8Array(t),r=t.byteLength%3,n=t.byteLength-r,i=Array(n/3);for(let o=0;o<i.length;o++){const a=o*3;i[o]=Rb(e[a],e[a+1],e[a+2])}if(r>0){const o=Rb(e[n],e[n+1]||0,e[n+2]||0);r===1?i.push(`${o.substr(0,2)}==`):r===2&&i.push(`${o.substr(0,3)}=`)}return i.join("")}var h8={toArrayBuffer:MSe,fromArrayBuffer:RSe};function PSe(t,e){e.classHierarchy.push("vtkStringArray"),t.getComponent=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+n]},t.setComponent=(r,n,i)=>{i!==e.values[r*e.numberOfComponents+n]&&(e.values[r*e.numberOfComponents+n]=i,t.modified())},t.getData=()=>e.values,t.getTuple=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=e.numberOfComponents||1;n.length&&(n.length=i);const o=r*i;for(let a=0;a<i;a++)n[a]=e.values[o+a];return n},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.values.length,t.getNumberOfTuples=()=>e.values.length/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>nW({name:e.name,numberOfComponents:e.numberOfComponents,empty:!0}),t.getName=()=>(e.name||t.setName(`vtkStringArray${t.getMTime()}`),e.name),t.setData=(r,n)=>{e.values=r,e.size=r.length,n&&(e.numberOfComponents=n),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.modified()}}const LSe={name:"",numberOfComponents:1,size:0,dataType:"string"};function tW(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,LSe,r),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkStringArray object without: size > 0, values");e.values?Array.isArray(e.values)&&(e.values=[...e.values]):e.values=[],e.values&&(e.size=e.values.length),K.obj(t,e),K.set(t,e,["name"]),PSe(t,e)}const nW=K.newInstance(tW,"vtkStringArray");var ASe={newInstance:nW,extend:tW};function rW(t){return new TextDecoder("latin1").decode(t)}function NSe(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=rW(t),i=e.exec(n);if(!i)return{text:n};const o=i.index+i[0].length,a=n.substring(0,o);let s=null;const c=r?r.exec(n):null;if(c){const l=n.substr(c.index);s={text:a+l,binaryBuffer:t.slice(o,c.index)}}else s={text:a,binaryBuffer:t.slice(o)};return s}var kSe={arrayBufferToString:rW,extractBinary:NSe};function iW(){const t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,r[0]===3569595041?"LittleEndian":r[0]===2712847316?"BigEndian":null}const VSe=iW();function FSe(t,e){if(e<2)return;const r=new Int8Array(t),n=r.length,i=[];for(let o=0;o<n;o+=e){for(let a=0;a<e;a++)i.push(r[o+a]);for(let a=0;a<e;a++)r[o+a]=i.pop()}}var k3={ENDIANNESS:VSe,getEndianness:iW,swapBytes:FSe};const{vtkErrorMacro:oW,vtkDebugMacro:USe}=K,g8=()=>(oW("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let jd=0;function J5(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new XMLHttpRequest;return n.open(t,e,!0),r.headers&&Object.entries(r.headers).forEach(i=>{let[o,a]=i;return n.setRequestHeader(o,a)}),r.progressCallback&&n.addEventListener("progress",r.progressCallback),n}function BSe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{const i=J5("GET",t,e);i.onreadystatechange=o=>{i.readyState===4&&(i.status===200||i.status===0?r(i.response):n({xhr:i,e:o}))},i.responseType="arraybuffer",i.send()})}function GSe(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return n&&n.compression?g8():r.ref&&!r.ref.pending?new Promise((i,o)=>{const a=[e,r.ref.basepath,r.ref.id].join("/"),s=J5("GET",a,n);s.onreadystatechange=c=>{s.readyState===1&&(r.ref.pending=!0,++jd===1&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!0)),s.readyState===4&&(r.ref.pending=!1,s.status===200||s.status===0?(r.buffer=s.response,r.ref.encode==="JSON"?r.values=JSON.parse(r.buffer):(k3.ENDIANNESS!==r.ref.encode&&k3.ENDIANNESS&&(USe(`Swap bytes of ${r.name}`),k3.swapBytes(r.buffer,IO[r.dataType])),r.values=K.newTypedArray(r.dataType,r.buffer)),r.values.length!==r.size&&oW(`Error in FetchArray: ${r.name}, does not have the proper array size. Got ${r.values.length}, instead of ${r.size}`),delete r.ref,--jd===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),t!=null&&t.modified&&t.modified(),i(r)):o({xhr:s,e:c}))},s.responseType=r.dataType!=="string"?"arraybuffer":"text",s.send()}):Promise.resolve(r)}function WSe(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?g8():new Promise((n,i)=>{const o=J5("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++jd===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--jd===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),o.status===200||o.status===0?n(JSON.parse(o.responseText)):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function zSe(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?g8():new Promise((n,i)=>{const o=J5("GET",e,r);o.onreadystatechange=a=>{o.readyState===1&&++jd===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),o.readyState===4&&(--jd===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),o.status===200||o.status===0?n(o.responseText):i({xhr:o,e:a}))},o.responseType="text",o.send()})}function $Se(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((n,i)=>{const o=new Image;r.crossOrigin&&(o.crossOrigin=r.crossOrigin),o.onload=()=>n(o),o.onerror=i,o.src=e})}const jSe={fetchArray:GSe,fetchJSON:WSe,fetchText:zSe,fetchBinary:BSe,fetchImage:$Se};QG("http")||eW("http",t=>jSe);function HSe(t,e){return[...t.getElementsByTagName(e)]}function Pb(t,e){return HSe(t,e)[0]}function KSe(t){return aSe.create(t)}function qSe(t){const e=/^\s*<AppendedData\s+encoding="raw">\s*_/m,r=/\n\s*<\/AppendedData>/m;return kSe.extractBinary(t,e,r)}const ql={Int8:Int8Array,UInt8:Uint8Array,Int16:Int16Array,UInt16:Uint16Array,Int32:Int32Array,UInt32:Uint32Array,Int64:Int32Array,UInt64:Uint32Array,Float32:Float32Array,Float64:Float64Array},Wp={Int8:1,UInt8:1,Int16:2,UInt16:2,Int32:4,UInt32:4,Int64:8,UInt64:8,Float32:4,Float64:8};function lS(t){const e=t.length-1;return t.filter((r,n)=>n<e&&n%2===0)}function uS(t,e,r){if(!["UInt64","UInt32"].includes(r))throw new Error(`Cannot handle a header type of ${r}`);let n=ql[r],i=ql[e],o=!1;r==="UInt64"&&(n=ql.UInt32),/^U?Int64$/.test(e)&&(o=!0,i=ql[e.replace("64","32")]);const{byteOffset:a}=t,s=Wp[e],c=Wp[r];let l;a%c===0?l=new n(t.buffer,a,1):l=new n(t.buffer.slice(a,a+c));const f=Number(l[0]);let u,d=f/s;o&&(d*=2);const h=a+c;return h%s===0?u=new i(t.buffer,h,d):u=new i(t.buffer.slice(h,h+f)),o&&(u=lS(u)),u}function XSe(t,e){if(e==="UInt64"){let l=new Uint32Array(t.buffer,0,6);const f=l[0],u=l[2],d=l[4],h=[8,f,u,d];l=new Uint32Array(t.buffer,3*8,f*2);for(let g=0;g<f;g++)h.push(l[g*2]);return h}let r=new Uint32Array(t.buffer,0,3);const n=4,i=r[0],o=r[1],a=r[2],s=[n,i,o,a];r=new Uint32Array(t.buffer,3*4,i);for(let c=0;c<i;c++)s.push(r[c]);return s}function YSe(t,e){const[r]=t;return(t.length-1)*r}function JSe(t,e){const r=TSe(t);e.uint8.set(r,e.offset),e.offset+=r.length}function p8(t,e){const r=XSe(t,e),n=r[1],i=r[2],o=r[3];let a=0;n>0&&(o===0?a=n*i:a=(n-1)*i+o);const s=new ArrayBuffer(a),c={offset:0,uint8:new Uint8Array(s)};let l=YSe(r);for(;l<t.length&&t[l]!==120;)l++;for(let f=0;f<n;f++){const u=r[4+f],d=new Uint8Array(t.buffer,l,u);JSe(d,c),l+=u}return c.uint8}function zp(t,e,r,n,i,o){const a=e.getAttribute("type"),s=e.getAttribute("Name"),c=e.getAttribute("format"),l=Number(e.getAttribute("NumberOfComponents")||"1");let f=null;if(c==="ascii"){f=new ql[a](t*l);let u=0;e.firstChild.nodeValue.split(/[\\t \\n]+/).forEach(d=>{d.trim().length&&(f[u++]=Number(d))})}else if(c==="binary"){const u=new Uint8Array(h8.toArrayBuffer(e.firstChild.nodeValue.trim()));if(r==="vtkZLibDataCompressor"){const d=p8(u,i);f=new ql[a](d.buffer),/^U?Int64$/.test(a)&&(f=lS(f))}else f=new ql[a](u.buffer,Wp[i]),a.indexOf("Int64")!==-1&&(f=lS(f))}else if(c==="appended"){const u=Number(e.getAttribute("offset"));f=uS(new Uint8Array(o,u),a,i)}else console.error("Format not supported",c);return{name:s,values:f,numberOfComponents:l}}function V3(t){return new TextDecoder().decode(t).split("\0").slice(0,-1)}function ZSe(t,e,r,n,i){const o=t.getAttribute("Name"),a=t.getAttribute("format"),s=Number(t.getAttribute("NumberOfComponents")||"1"),l=Number(t.getAttribute("NumberOfTuples")||"1")*s,f=[];if(a==="ascii"){const u=t.firstChild.nodeValue.trim().split(/\s+/);let d=0;const h=[];for(;f.length<l;){const g=Number(u[d++]);g===0?(f.push(h.join("")),h.length=0):h.push(String.fromCharCode(g))}}else if(a==="binary"){const u=new Uint8Array(h8.toArrayBuffer(t.firstChild.nodeValue.trim()));if(e==="vtkZLibDataCompressor"){const d=p8(u,n);f.push(...V3(d))}else{const d=uS(u,"UInt8",n);f.push(...V3(d))}}else if(a==="appended"){const u=Number(t.getAttribute("offset")),d=uS(new Uint8Array(i,u),"UInt8",n);f.push(...V3(d))}else K.vtkErrorMacro(`Format not supported: ${a}`);return{name:o,values:f,numberOfComponents:s}}function QSe(t,e,r,n,i,o){const a={},s=e.getElementsByTagName("DataArray");for(let g=0;g<s.length;g++){const p=s[g];a[p.getAttribute("Name")]=p}const c=zp(t,a.offsets,r,n,i,o).values,l=c[c.length-1],f=zp(l,a.connectivity,r,n,i,o).values,u=new Uint32Array(t+l);let d=0,h=0;return c.forEach(g=>{const p=g-h;u[d++]=p;for(let v=0;v<p;v++)u[d++]=f[h+v];h=g}),u}function eTe(t,e,r,n,i,o,a){if(e){const s=["Scalars","Vectors","Normals","Tensors","TCoords"],c={};s.forEach(u=>{const d=e.getAttribute(u);d&&(c[d]=r[`set${u}`])});const l=e.getElementsByTagName("DataArray"),f=l.length;for(let u=0;u<f;u++){const d=l[u],h=Lt.newInstance(zp(t,d,n,i,o,a)),g=h.getName();(c[g]||r.addArray)(h)}}}function tTe(t,e,r,n,i){const o=[...t.getElementsByTagName("DataArray")].map(s=>Lt.newInstance(zp(Number(s.getAttribute("NumberOfTuples")),s,e,r,n,i))),a=[...t.getElementsByTagName("Array")].filter(s=>s.getAttribute("type")==="String").map(s=>ASe.newInstance(ZSe(s,e,r,n,i)));return[...o,...a]}function nTe(t,e){e.classHierarchy.push("vtkXMLReader"),e.dataAccessHelper||(e.dataAccessHelper=bSe.get("http"));function r(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.dataAccessHelper.fetchBinary(n,i)}t.setUrl=function(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.url=n;const o=n.split("/");return o.pop(),e.baseURL=o.join("/"),t.loadData(i)},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r(e.url,n).then(t.parseAsArrayBuffer)},t.parseAsArrayBuffer=n=>{if(!n)return!1;if(n!==e.rawDataBuffer)t.modified();else return!0;const{text:i,binaryBuffer:o}=qSe(n);e.rawDataBuffer=n,e.binaryBuffer=o;const s=KSe(i).root(),c=s.node,l=c.getAttribute("type"),f=c.getAttribute("compressor"),u=c.getAttribute("byte_order"),d=c.getAttribute("header_type")||"UInt32";if(f&&f!=="vtkZLibDataCompressor")return console.error("Invalid compressor",f),!1;if(u&&u!=="LittleEndian")return console.error("Only LittleEndian encoding is supported"),!1;if(l!==e.dataType)return console.error("Invalid data type",l,"expecting",e.dataType),!1;if(Pb(c,"AppendedData")){const p=Pb(c,"AppendedData"),v=p.getAttribute("encoding"),w=s.filter(T=>{const{node:_}=T;return _.nodeType===Node.ELEMENT_NODE&&_.getAttribute("format")==="appended"&&_.hasAttribute("offset")},!1,!0).map(T=>({node:T.node,offset:Number(T.node.getAttribute("offset"))}));w.sort((T,_)=>T.offset-_.offset);let m=e.binaryBuffer;v==="base64"&&(m=p.textContent.trim().substr(1));const y=[];for(let T=0;T<w.length;++T){const _=w[T].offset;let E=0;T===w.length-1?E=m.length||m.byteLength:E=w[T+1].offset,v==="base64"?y.push(new Uint8Array(h8.toArrayBuffer(m.substring(_,E)))):y.push(new Uint8Array(m.slice(_,E)))}if(f==="vtkZLibDataCompressor")for(let T=0;T<y.length;++T){const _=y[T],E=p8(_,d),D=new Uint8Array(E.length+Wp[d]);new ql[d](D.buffer,0,1)[0]=E.length,D.set(E,Wp[d]),y[T]=D}const x=y.reduce((T,_)=>T+_.length,0),C=new ArrayBuffer(x),S=new Uint8Array(C);for(let T=0,_=0;T<y.length;++T)w[T].node.setAttribute("offset",_),S.set(y[T],_),_+=y[T].length;if(e.binaryBuffer=C,!e.binaryBuffer)return console.error("Processing appended data format: requires binaryBuffer to parse"),!1}t.parseXML(c,l,f,u,d);const g=c.getElementsByTagName(l)[0].getElementsByTagName("FieldData")[0];if(g){const p=tTe(g,f,u,d,e.binaryBuffer);for(let v=0;v<e.output.length;v++){const w=e.output[v].getFieldData();for(let m=0;m<p.length;m++)w.addArray(p[m])}}return!0},t.requestData=(n,i)=>{t.parseAsArrayBuffer(e.rawDataBuffer)}}const rTe={};function iTe(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rTe,r),K.obj(t,e),K.get(t,e,["url","baseURL"]),K.setGet(t,e,["dataAccessHelper"]),K.algo(t,e,0,1),nTe(t,e)}var $p={extend:iTe,processDataArray:zp,processFieldData:eTe,processCells:QSe};function oTe(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=r.getElementsByTagName(e)[0].getElementsByTagName("DataArray")[0],{values:l,numberOfComponents:f}=$p.processDataArray(s,c,n,i,o,a);t[`get${e}`]().setData(l,f)}return s}function aTe(t,e,r,n,i,o,a){const s=Number(r.getAttribute(`NumberOf${e}`));if(s>0){const c=$p.processCells(s,r.getElementsByTagName(e)[0],n,i,o,a);t[`get${e}`]().setData(c)}return s}function sTe(t,e){e.classHierarchy.push("vtkXMLPolyDataReader"),t.parseXML=(r,n,i,o,a)=>{const c=r.getElementsByTagName(e.dataType)[0].getElementsByTagName("Piece"),l=c.length;for(let f=0;f<l;f++){const u=Qr.newInstance(),d=c[f],h=oTe(u,"Points",d,i,o,a,e.binaryBuffer);let g=0;["Verts","Lines","Strips","Polys"].forEach(p=>{g+=aTe(u,p,d,i,o,a,e.binaryBuffer)}),$p.processFieldData(h,d.getElementsByTagName("PointData")[0],u.getPointData(),i,o,a,e.binaryBuffer),$p.processFieldData(g,d.getElementsByTagName("CellData")[0],u.getCellData(),i,o,a,e.binaryBuffer),e.output[f]=u}}}const cTe={dataType:"PolyData"};function aW(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cTe,r),$p.extend(t,e,r),sTe(t,e)}const lTe=K.newInstance(aW,"vtkXMLPolyDataReader");var uTe={newInstance:lTe,extend:aW},my;(function(t){t[t.ANNOTATED_CUBE=1]="ANNOTATED_CUBE",t[t.AXES=2]="AXES",t[t.CUSTOM=3]="CUSTOM"})(my||(my={}));const Os=class Os extends $r{constructor(e={},r={configuration:{orientationWidget:{enabled:!0,viewportCorner:Ob.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:Os.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[Os.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:n=>n/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[Os.OVERLAY_MARKER_TYPES.AXES]:{},[Os.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,r),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>Li(this.toolGroupId).viewportsInfo,this.resize=n=>{const i=this.orientationMarkers[n];if(!i)return;const{orientationWidget:o}=i;o.updateViewport()},this.orientationMarkers={},this.updatingOrientationMarker={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=zr(n,i),{element:a}=o;a.removeEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this)),this._resizeObservers.get(n).unobserve(a)})};We.removeEventListener(U.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach(({viewportId:n,renderingEngineId:i})=>{const{viewport:o}=zr(n,i),{element:a}=o;this.initViewports(),a.addEventListener($e.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const s=new ResizeObserver(()=>{setTimeout(()=>{const c=zr(n,i);if(!c)return;const{viewport:l}=c;this.resize(n),l.render()},100)});s.observe(a),this._resizeObservers.set(n,s)})};e(),We.addEventListener(U.TOOLGROUP_VIEWPORT_ADDED,r=>{r.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())})}cleanUpData(){Qi()[0].getViewports().forEach(i=>{const o=this.orientationMarkers[i.id];if(!o)return;const{actor:a,orientationWidget:s}=o;s==null||s.setEnabled(!1),s==null||s.delete(),a==null||a.delete(),i.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow().render(),i.getRenderingEngine().render(),delete this.orientationMarkers[i.id]})}initViewports(){const r=Qi()[0];if(!r)return;let n=r.getViewports();n=F5(n,this.getToolName()),n.forEach(i=>{const o=i.getWidget(this.getToolName());(!o||o.isDeleted())&&this.addAxisActorInViewport(i)})}async addAxisActorInViewport(e){const r=e.id;if(!this.updatingOrientationMarker[r]){this.updatingOrientationMarker[r]=!0;const n=this.configuration.overlayMarkerType,i=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[r]){const{actor:g,orientationWidget:p}=this.orientationMarkers[r];e.getRenderer().removeActor(g),p.setEnabled(!1)}let o;n===1?o=this.createAnnotationCube(i):n===2?o=oSe.newInstance():n===3&&(o=await this.createCustomActor());const a=e.getRenderer(),s=e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow(),{enabled:c,viewportCorner:l,viewportSize:f,minPixelSize:u,maxPixelSize:d}=this.configuration.orientationWidget,h=Ob.newInstance({actor:o,interactor:s.getInteractor(),parentRenderer:a});h.setEnabled(c),h.setViewportCorner(l),h.setViewportSize(f),h.setMinPixelSize(u),h.setMaxPixelSize(d),h.updateMarkerOrientation(),this.orientationMarkers[r]={orientationWidget:h,actor:o},e.addWidget(this.getToolName(),h),s.render(),e.getRenderingEngine().render(),this.updatingOrientationMarker[r]=!1}}async createCustomActor(){const e=this.configuration.overlayConfiguration[my.CUSTOM].polyDataURL,n=await(await fetch(e)).arrayBuffer(),i=uTe.newInstance();i.parseAsArrayBuffer(n),i.update();const o=Qr.newInstance();o.shallowCopy(i.getOutputData()),o.getPointData().setActiveScalars("Color");const a=js.newInstance();a.setInputData(o),a.setColorModeToDirectScalars();const s=qs.newInstance();return s.setMapper(a),s.rotateZ(180),s}createAnnotationCube(e){const r=Mb.newInstance();return r.setDefaultStyle({...e.defaultStyle}),r.setXPlusFaceProperty({...e.faceProperties.xPlus}),r.setXMinusFaceProperty({...e.faceProperties.xMinus}),r.setYPlusFaceProperty({...e.faceProperties.yPlus}),r.setYMinusFaceProperty({...e.faceProperties.yMinus}),r.setZPlusFaceProperty({...e.faceProperties.zPlus}),r.setZMinusFaceProperty({...e.faceProperties.zMinus}),r}async createAnnotatedCubeActor(){const e=Mb.newInstance(),{faceProperties:r,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(r).forEach(i=>{const o=`set${i.charAt(0).toUpperCase()+i.slice(1)}FaceProperty`;e[o](r[i])}),e}};Os.CUBE=1,Os.AXIS=2,Os.VTPFILE=3,Os.OVERLAY_MARKER_TYPES=my;let vy=Os;vy.toolName="OrientationMarker";const Hg=class Hg extends $r{constructor(e={},r={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:Hg.SelectMode.Border,searchRadius:6}}){super(e,r),this.mouseMoveCallback=n=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout(()=>{this._setActiveSegment(n),this.hoverTimer=null},this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(ze.isInteractingWithTool)return;const{element:r,currentPoints:n}=e.detail,i=n.world,o=we(r);if(!o)return;const{viewport:a}=o,s=Du(a.id);s&&this._setActiveSegmentForType(s,i,a)}_setActiveSegmentForType(e,r,n){if(!n.getImageData())return;const{segmentationId:o,representationData:a}=e;let s;if(this.configuration.mode===Hg.SelectMode.Inside?s=vB(o,r,{viewport:n}):a.Labelmap?s=yB(o,r,{viewport:n,searchRadius:this.configuration.searchRadius}):a.Contour?s=xB(o):a.Surface,!s||s===0)return;fy(o,s);const l=n.getRenderingEngine().getViewports().map(f=>f.id);Ro(o),Me(l)}};Hg.SelectMode={Inside:"Inside",Border:"Border"};let yy=Hg;yy.toolName="SegmentSelectTool";class sW extends zn{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=r=>{const n=r.detail,{currentPoints:i,element:o}=n,a=i.world,s=we(o),{viewport:c,renderingEngine:l}=s;this.isDrawing=!0;const f=c.getCamera(),{viewPlaneNormal:u,viewUp:d}=f,h=this.getReferencedImageId(c,a,u,d),g={metadata:{viewPlaneNormal:[0,0,1],viewUp:[0,1,0],FrameOfReferenceUID:c.getFrameOfReferenceUID(),referencedImageId:h,toolName:this.getToolName()},data:{invalidated:!0,handles:{points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null},cachedStats:{},active:!0}};Zt(g,o);const p=pt(o,this.getToolName(),!1);return this.editData={annotation:g,viewportUIDsToRender:p,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),Tt(o),r.preventDefault(),Me(p),g},this.getHandleNearImagePoint=(r,n,i,o)=>{const a=we(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles;for(let f=0;f<l.length;f++){const u=l[f],d=s.worldToCanvas(u);if(ir(i,d)<o===!0)return c.handles.activeHandleIndex=f,u}c.handles.activeHandleIndex=null},this.isPointNearTool=(r,n,i,o)=>{const a=we(r),{viewport:s}=a,{data:c}=n,{points:l}=c.handles,f=s.worldToCanvas(l[0]),u=s.worldToCanvas(l[3]),d=this._getRectangleImageCoordinates([f,u]),h=[i[0],i[1]],{left:g,top:p,width:v,height:w}=d;if(M4([g,p,v,w],h)<=o)return!0},this.toolSelectedCallback=(r,n,i="mouse")=>{const o=r.detail,{element:a}=o,{data:s}=n;s.active=!0;const c=pt(a,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:c},this._activateModify(a),Tt(a),Me(c),r.preventDefault()},this.handleSelectedCallback=(r,n,i,o="mouse")=>{const a=r.detail,{element:s}=a,{data:c}=n;c.active=!0;let l;i.worldPosition||(l=c.handles.points.findIndex(u=>u===i));const f=pt(s,this.getToolName(),!1);this.editData={annotation:n,viewportUIDsToRender:f,handleIndex:l},this._activateModify(s),Tt(s),Me(f),r.preventDefault()},this._endCallback=r=>{const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,newAnnotation:s,hasMoved:c}=this.editData,{data:l}=o;s&&!c||(this.doneEditMemo(),l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(i),this._deactivateDraw(i),Ut(i),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&hn(o.annotationUID),Me(a))},this._dragCallback=r=>{this.isDrawing=!0;const n=r.detail,{element:i}=n,{annotation:o,viewportUIDsToRender:a,handleIndex:s,newAnnotation:c}=this.editData;this.createMemo(i,o,{newAnnotation:c});const{data:l}=o;if(s===void 0){const{deltaPoints:f}=n,u=f.world,{points:d}=l.handles;d.forEach(h=>{h[0]+=u[0],h[1]+=u[1],h[2]+=u[2]}),l.invalidated=!0}else{const{currentPoints:f}=n,u=we(i),{worldToCanvas:d,canvasToWorld:h}=u.viewport,g=f.world,{points:p}=l.handles;p[s]=[...g];let v,w,m,y,x,C,S,T;switch(s){case 0:case 3:v=d(p[0]),y=d(p[3]),w=[y[0],v[1]],m=[v[0],y[1]],C=h(w),S=h(m),p[1]=C,p[2]=S;break;case 1:case 2:w=d(p[1]),m=d(p[2]),v=[m[0],w[1]],y=[w[0],m[1]],x=h(v),T=h(y),p[0]=x,p[3]=T;break}l.invalidated=!0}this.editData.hasMoved=!0,we(i),Me(a)},this._activateDraw=r=>{ze.isInteractingWithTool=!0,r.addEventListener(U.MOUSE_UP,this._endCallback),r.addEventListener(U.MOUSE_DRAG,this._dragCallback),r.addEventListener(U.MOUSE_MOVE,this._dragCallback),r.addEventListener(U.MOUSE_CLICK,this._endCallback),r.addEventListener(U.TOUCH_END,this._endCallback),r.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=r=>{ze.isInteractingWithTool=!1,r.removeEventListener(U.MOUSE_UP,this._endCallback),r.removeEventListener(U.MOUSE_DRAG,this._dragCallback),r.removeEventListener(U.MOUSE_MOVE,this._dragCallback),r.removeEventListener(U.MOUSE_CLICK,this._endCallback),r.removeEventListener(U.TOUCH_END,this._endCallback),r.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this._activateModify=r=>{ze.isInteractingWithTool=!0,r.addEventListener(U.MOUSE_UP,this._endCallback),r.addEventListener(U.MOUSE_DRAG,this._dragCallback),r.addEventListener(U.MOUSE_CLICK,this._endCallback),r.addEventListener(U.TOUCH_END,this._endCallback),r.addEventListener(U.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=r=>{ze.isInteractingWithTool=!1,r.removeEventListener(U.MOUSE_UP,this._endCallback),r.removeEventListener(U.MOUSE_DRAG,this._dragCallback),r.removeEventListener(U.MOUSE_CLICK,this._endCallback),r.removeEventListener(U.TOUCH_END,this._endCallback),r.removeEventListener(U.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(r,n)=>{const{viewport:o}=r,{element:a}=o;let s=sn(this.getToolName(),a);if(!(s!=null&&s.length)||(s=this.filterInteractableAnnotationsForElement(a,s),!(s!=null&&s.length)))return!1;const c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:r.viewport.id};for(let l=0;l<s.length;l++){const f=s[l],{annotationUID:u}=f,d=f.data,{points:h,activeHandleIndex:g}=d.handles,p=h.map(C=>o.worldToCanvas(C)),v=this.getStyle("lineWidth",c,f),w=this.getStyle("lineDash",c,f),m=this.getStyle("color",c,f);if(!o.getRenderingEngine()){console.warn("Rendering Engine has been destroyed");return}let y;!this.editData&&g!==null&&(y=[p[g]]),y&&Kn(n,u,"0",y,{color:m}),JV(n,u,"0",p[0],p[3],{color:"black",lineDash:w,lineWidth:v})}},this._getRectangleImageCoordinates=r=>{const[n,i]=r;return{left:Math.min(n[0],i[0]),top:Math.min(n[1],i[1]),width:Math.abs(n[0]-i[0]),height:Math.abs(n[1]-i[1])}},this._calculateCachedStats=(r,n,i,o,a)=>{const{data:s}=r,{viewportUID:c,renderingEngineUID:l,sceneUID:f}=a,u=s.handles.points[0],d=s.handles.points[3],{cachedStats:h}=s,g=Object.keys(h);for(let w=0;w<g.length;w++){const m=g[w],{imageVolume:y}=this._getImageVolumeFromTargetUID(m,o),{dimensions:x,scalarData:C,vtkImageData:S,metadata:T}=y,_=xt(0,0,0),E=xt(0,0,0);if(S.worldToIndexVec3(u,_),_[0]=Math.floor(_[0]),_[1]=Math.floor(_[1]),_[2]=Math.floor(_[2]),S.worldToIndexVec3(d,E),E[0]=Math.floor(E[0]),E[1]=Math.floor(E[1]),E[2]=Math.floor(E[2]),this._isInsideVolume(_,E,x)){this.isHandleOutsideImage=!1;const D=Math.min(_[0],E[0]),b=Math.max(_[0],E[0]),I=Math.min(_[1],E[1]),R=Math.max(_[1],E[1]),M=Math.min(_[2],E[2]),P=Math.max(_[2],E[2]),{worldWidth:k,worldHeight:z}=X5(n,i,u,d),A=k*z;let L=0,N=0,H=0;const ee=x[0],oe=x[0]*x[1];for(let de=M;de<=P;de++)for(let ue=I;ue<=R;ue++)for(let me=D;me<=b;me++){const Ee=C[de*oe+ue*ee+me];L++,N+=Ee}N/=L;for(let de=M;de<=P;de++)for(let ue=I;ue<=R;ue++)for(let me=D;me<=b;me++){const _e=C[de*oe+ue*ee+me]-N;H+=_e*_e}H/=L,H=Math.sqrt(H),h[m]={Modality:T.Modality,area:A,mean:N,stdDev:H}}else this.isHandleOutsideImage=!0,h[m]={Modality:T.Modality}}s.invalidated=!1;const p=U.ANNOTATION_MODIFIED;return Qe(We,p,{annotation:r,viewportUID:c,renderingEngineUID:l,sceneUID:f}),h},this._isInsideVolume=(r,n,i)=>ur(r,i)&&ur(n,i),this._getTargetVolumeUID=r=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const n=r.getVolumeActors();if(!(!n&&!n.length))return n[0].uid},this._throttledCalculateCachedStats=eo(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),Ut(e);const{annotation:r,viewportUIDsToRender:n}=this.editData,{data:i}=r;return i.active=!1,i.handles.activeHandleIndex=null,Me(n),this.editData=null,r.metadata.annotationUID}_getImageVolumeFromTargetUID(e,r){let n,i;if(e.startsWith("stackTarget")){const o=e.indexOf(":"),a=e.substring(o+1);n=r.getViewport(a).getImageData()}else n=ke.getVolume(e);return{imageVolume:n,viewport:i}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}}sW.toolName="VideoRedaction";const m8=Object.freeze(Object.defineProperty({__proto__:null,AdvancedMagnifyTool:Fp,AngleTool:py,AnnotationDisplayTool:_u,AnnotationTool:zn,ArrowAnnotateTool:gy,BaseTool:$r,BidirectionalTool:Z4,BrushTool:J4,CONSTANTS:mye,CircleROIStartEndThresholdTool:PG,CircleROITool:Bp,CircleScissorsTool:MG,CobbAngleTool:TG,CrosshairsTool:oG,DragProbeTool:wG,ETDRSGridTool:xG,EllipticalROITool:dy,Enums:D0e,EraserTool:EG,HeightTool:yG,KeyImageTool:Y5,LabelmapBaseTool:r0,LengthTool:vG,LivewireContourSegmentationTool:SG,LivewireContourTool:l8,MIPJumpToClickTool:iG,MagnifyTool:aG,OrientationMarkerTool:vy,OverlayGridTool:cG,PaintFillTool:LG,PanTool:JB,PlanarFreehandContourSegmentationTool:T1,PlanarFreehandROITool:W4,PlanarRotateTool:nG,ProbeTool:Up,RectangleROIStartEndThresholdTool:K4,RectangleROIThresholdTool:q4,RectangleROITool:zd,RectangleScissorsTool:OG,ReferenceCursors:dG,ReferenceLinesTool:sG,RegionSegmentPlusTool:bG,RegionSegmentTool:DG,ScaleOverlayTool:hG,SculptorTool:pG,SegmentSelectTool:yy,SegmentationIntersectionTool:lG,SphereScissorsTool:RG,SplineContourSegmentationTool:CG,SplineROITool:Gp,StackScrollTool:tG,Synchronizer:AU,SynchronizerManager:dye,ToolGroupManager:Jde,TrackballRotateTool:ZB,Types:uxe,UltrasoundDirectionalTool:_G,VideoRedactionTool:sW,VolumeRotateTool:mG,WholeBodySegmentTool:IG,WindowLevelRegionTool:eG,WindowLevelTool:QB,ZoomTool:rG,addTool:Nl,annotation:Dme,cancelActiveManipulations:aye,cursors:Hde,destroy:hye,drawing:Npe,init:NU,removeTool:ohe,segmentation:Rxe,splines:kxe,get state(){return ze},synchronizers:kye,utilities:lxe},Symbol.toStringTag,{value:"Module"})),{LengthTool:F3,StackScrollTool:qh,PanTool:U3,ZoomTool:B3,TrackballRotateTool:G3,Enums:fTe}=m8,{MouseBindings:Il,KeyboardBindings:D0}=fTe;async function dTe(t){for(let e=0;e<t.length;e++)await I2.wadouri.loadImage(t[e]).promise}function hTe(t){if(t.includes("wadors:")){const e=t.indexOf("/frames/"),r=e>0?t.slice(0,e+8):t;return{frameIndex:e,imageIdFrameless:r}}else{const e=t.indexOf("&frame=");let r=e>0?t.slice(0,e+7):t;return r.includes("&frame=")||(r=r+"&frame="),{frameIndex:e,imageIdFrameless:r}}}function gTe(t){const e=[];return t.forEach(r=>{const{imageIdFrameless:n}=hTe(r),i=dt("multiframeModule",r);if(i&&i.NumberOfFrames&&i.NumberOfFrames>1){const o=i.NumberOfFrames;for(let a=0;a<o;a++){const s=n+(a+1);e.push(s)}}else e.push(r)}),e}let Lb=!1;function pTe(t,e={}){var a;const r=[{mouseButton:Il.Secondary}],{is3DViewport:n=!1,enableShiftClickZoom:i=!1,toolMap:o=new Map}=e;if(i===!0&&r.push({mouseButton:Il.Primary,modifierKey:D0.Shift}),!Lb){Nl(U3),Nl(B3),Nl(G3),Nl(F3),Nl(qh);for(const[,s]of o)s.tool&&Nl(s.tool)}Lb=!0,t.addTool(U3.toolName),t.addTool(B3.toolName,{minZoomScale:.001,maxZoomScale:4e3}),n?t.addTool(G3.toolName):t.addTool(qh.toolName),t.addTool(F3.toolName),t.addTool(qh.toolName),t.setToolActive(U3.toolName,{bindings:[{mouseButton:Il.Auxiliary},{numTouchPoints:1,modifierKey:D0.Ctrl}]}),t.setToolActive(B3.toolName,{bindings:r}),t.setToolActive(qh.toolName,{bindings:[{mouseButton:Il.Primary,modifierKey:D0.Alt},{numTouchPoints:1,modifierKey:D0.Alt},{mouseButton:Il.Wheel}]}),t.setToolActive(F3.toolName,{bindings:[{mouseButton:Il.Primary,modifierKey:D0.ShiftCtrl},{numTouchPoints:1,modifierKey:D0.ShiftCtrl}]}),n?t.setToolActive(G3.toolName,{bindings:[{mouseButton:Il.Primary}]}):t.setToolActive(qh.toolName);for(const[s,c]of o)c.baseTool?(t.hasTool(c.baseTool)||t.addTool(c.baseTool,(a=o.get(c.baseTool))==null?void 0:a.configuration),t.addToolInstance(s,c.baseTool,c.configuration)):t.hasTool(s)||t.addTool(s,c.configuration),c.passive&&t.setToolPassive(s),(c.bindings||c.selected)&&t.setToolActive(s,c.bindings&&c||{bindings:[{mouseButton:Il.Primary}]})}const{segmentation:W3}=m8,{PanTool:ETe,WindowLevelTool:DTe,StackScrollTool:bTe,ZoomTool:ITe,ToolGroupManager:mTe,Enums:OTe}=m8;function vTe(){console.debug("app rendering");const t=ua.useRef(null),e=ua.useRef(null),r=ua.useRef(null),n=ua.useRef(null),i=ua.useRef(!1),[o,a]=ua.useState(!1),s=ua.useRef(null),c=ua.useRef({renderingEngine:null,renderingEngineId:"MY_RENDERING_ENGINE_ID",toolGroup:null,toolGroupId:"MY_TOOL_GROUP_ID",viewportIds:["CT_AXIAL","CT_SAGITTAL","CT_CORONAL","CT_VOLUME"],volumeId:"",segmentationId:"LOAD_SEG_ID:"+Cn(),referenceImageIds:[],skipOverlapping:!1,segImageIds:[],devConfig:{...new Map().values().next().value}});ua.useEffect(()=>{if(!t.current||!e.current||!r.current||!n.current){console.log("Rendering engine not initializing");return}console.log("Rendering engine initializing");const v=async()=>{const y=mTe.createToolGroup("TOOL_GROUP_ID");pTe(y,{is3DViewport:!0});const x=new P_(c.current.renderingEngineId),C=[{viewportId:c.current.viewportIds[0],type:Hn.ORTHOGRAPHIC,element:t.current,defaultOptions:{orientation:As.AXIAL,background:[.2,0,.2]}},{viewportId:c.current.viewportIds[1],type:Hn.ORTHOGRAPHIC,element:e.current,defaultOptions:{orientation:As.SAGITTAL,background:[.2,0,.2]}},{viewportId:c.current.viewportIds[2],type:Hn.ORTHOGRAPHIC,element:r.current,defaultOptions:{orientation:As.CORONAL,background:[.2,0,.2]}},{viewportId:c.current.viewportIds[3],type:Hn.VOLUME_3D,element:n.current,defaultOptions:{orientation:As.CORONAL,background:[160/255,164/255,217/255]}}];console.log("viewportInputArray",C,c.current),x.setViewports(C),c.current.renderingEngine=x,y.addViewport(c.current.viewportIds[3],c.current.renderingEngineId)};(async()=>{i.current||(i.current=!0,I2.init(),await wL(),await NU(),v(),console.debug("Rendering engine initialized"),a(!0))})()},[t,e,r,n,i]);const l=()=>W3.state.getSegmentations().map(v=>v.segmentationId),f=()=>{console.debug("Restarting some ui state about multiple file upload");const{volumeId:v}=c.current;if(!v)return;ke.removeVolumeLoadObject(v),W3.removeAllSegmentationRepresentations(),l().forEach(m=>{W3.state.removeSegmentation(m),ke.removeVolumeLoadObject(m)})},u=async()=>{f();const v="cornerstoneStreamingImageVolume",{volumeId:w,toolGroup:m,referenceImageIds:y,viewportIds:x,renderingEngineId:C,renderingEngine:S}=c.current,{utilities:T}=rue;c.current.volumeId=v+":"+T.uuidv4(),await(await u5(c.current.volumeId,{imageIds:y})).load();const E=S.getViewport(x[3]);await R_(S,[{volumeId:c.current.volumeId}],x),E.setProperties({preset:"MR-MIP"}),S.render()},d=async v=>{for(const w of v){const m=I2.wadouri.fileManager.add(w);await us(m),c.current.referenceImageIds.push(m)}},h=async v=>{const w=Array.from(v.target.files||[]);await d(w),await u()},g=async v=>{v.stopPropagation(),v.preventDefault();const w=Array.from(v.target.files||[]);if(w.length!==0)try{console.log("Loading files:",w);const m=I2.wadouri.fileManager.add(w[0]);console.log("Image ID:",m),p(m)}catch(m){console.error("Error loading DICOM files:",m)}},p=async function(v){await dTe([v]);const w=gTe([v]);s.current.setStack(w).then(()=>{s.current.render()})};return za.jsxs("div",{children:[za.jsx("h1",{className:"text-3xl font-bold underline",children:"Hello world!"}),za.jsx("button",{onClick:()=>{const v=document.createElement("input");v.type="file",v.multiple=!0,v.accept=".dcm",v.addEventListener("change",g),v.click()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:!o,children:"Select single DICOM file"}),za.jsx("button",{onClick:()=>{const v=document.createElement("input");v.type="file",v.multiple=!0,v.accept=".dcm",v.addEventListener("change",h),v.click()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",disabled:!o,children:"Select multiple DICOM files"}),za.jsxs("div",{className:"flex flex-row",children:[za.jsx("div",{ref:t,style:{width:"512px",height:"512px",backgroundColor:"#000"}}),za.jsx("div",{ref:e,style:{width:"512px",height:"512px",backgroundColor:"#123"}}),za.jsx("div",{ref:r,style:{width:"512px",height:"512px",backgroundColor:"#123"}}),za.jsx("div",{ref:n,style:{width:"512px",height:"512px",backgroundColor:"#123"}})]})]})}z3.createRoot(document.getElementById("root")).render(za.jsx(EW.StrictMode,{children:za.jsx(vTe,{})}));
