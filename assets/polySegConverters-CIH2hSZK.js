import oe from"@icr/polyseg-wasm";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const kn=Symbol("Comlink.proxy"),Ms=Symbol("Comlink.endpoint"),Is=Symbol("Comlink.releaseProxy"),ce=Symbol("Comlink.finalizer"),It=Symbol("Comlink.thrown"),$n=e=>typeof e=="object"&&e!==null||typeof e=="function",Ns={canHandle:e=>$n(e)&&e[kn],serialize(e){const{port1:t,port2:n}=new MessageChannel;return Me(e,t),[n,[n]]},deserialize(e){return e.start(),ks(e)}},Rs={canHandle:e=>$n(e)&&It in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},Un=new Map([["proxy",Ns],["throw",Rs]]);function As(e,t){for(const n of e)if(t===n||n==="*"||n instanceof RegExp&&n.test(t))return!0;return!1}function Me(e,t=globalThis,n=["*"]){t.addEventListener("message",function r(s){if(!s||!s.data)return;if(!As(n,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:a,type:i,path:c}=Object.assign({path:[]},s.data),o=(s.data.argumentList||[]).map(ot);let u;try{const f=c.slice(0,-1).reduce((g,h)=>g[h],e),l=c.reduce((g,h)=>g[h],e);switch(i){case"GET":u=l;break;case"SET":f[c.slice(-1)[0]]=ot(s.data.value),u=!0;break;case"APPLY":u=l.apply(f,o);break;case"CONSTRUCT":{const g=new l(...o);u=js(g)}break;case"ENDPOINT":{const{port1:g,port2:h}=new MessageChannel;Me(e,h),u=Fs(g,[g])}break;case"RELEASE":u=void 0;break;default:return}}catch(f){u={value:f,[It]:0}}Promise.resolve(u).catch(f=>({value:f,[It]:0})).then(f=>{const[l,g]=jt(f);t.postMessage(Object.assign(Object.assign({},l),{id:a}),g),i==="RELEASE"&&(t.removeEventListener("message",r),Gn(t),ce in e&&typeof e[ce]=="function"&&e[ce]())}).catch(f=>{const[l,g]=jt({value:new TypeError("Unserializable return value"),[It]:0});t.postMessage(Object.assign(Object.assign({},l),{id:a}),g)})}),t.start&&t.start()}function Vs(e){return e.constructor.name==="MessagePort"}function Gn(e){Vs(e)&&e.close()}function ks(e,t){return Ee(e,[],t)}function _t(e){if(e)throw new Error("Proxy has been released and is not useable")}function Fn(e){return dt(e,{type:"RELEASE"}).then(()=>{Gn(e)})}const Gt=new WeakMap,Ft="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(Gt.get(e)||0)-1;Gt.set(e,t),t===0&&Fn(e)});function $s(e,t){const n=(Gt.get(t)||0)+1;Gt.set(t,n),Ft&&Ft.register(e,t,e)}function Us(e){Ft&&Ft.unregister(e)}function Ee(e,t=[],n=function(){}){let r=!1;const s=new Proxy(n,{get(a,i){if(_t(r),i===Is)return()=>{Us(s),Fn(e),r=!0};if(i==="then"){if(t.length===0)return{then:()=>s};const c=dt(e,{type:"GET",path:t.map(o=>o.toString())}).then(ot);return c.then.bind(c)}return Ee(e,[...t,i])},set(a,i,c){_t(r);const[o,u]=jt(c);return dt(e,{type:"SET",path:[...t,i].map(f=>f.toString()),value:o},u).then(ot)},apply(a,i,c){_t(r);const o=t[t.length-1];if(o===Ms)return dt(e,{type:"ENDPOINT"}).then(ot);if(o==="bind")return Ee(e,t.slice(0,-1));const[u,f]=en(c);return dt(e,{type:"APPLY",path:t.map(l=>l.toString()),argumentList:u},f).then(ot)},construct(a,i){_t(r);const[c,o]=en(i);return dt(e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:c},o).then(ot)}});return $s(s,e),s}function Gs(e){return Array.prototype.concat.apply([],e)}function en(e){const t=e.map(jt);return[t.map(n=>n[0]),Gs(t.map(n=>n[1]))]}const jn=new WeakMap;function Fs(e,t){return jn.set(e,t),e}function js(e){return Object.assign(e,{[kn]:!0})}function jt(e){for(const[t,n]of Un)if(n.canHandle(e)){const[r,s]=n.serialize(e);return[{type:"HANDLER",name:t,value:r},s]}return[{type:"RAW",value:e},jn.get(e)||[]]}function ot(e){switch(e.type){case"HANDLER":return Un.get(e.name).deserialize(e.value);case"RAW":return e.value}}function dt(e,t,n){return new Promise(r=>{const s=zs();e.addEventListener("message",function a(i){!i.data||!i.data.id||i.data.id!==s||(e.removeEventListener("message",a),r(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),n)})}function zs(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var z;(function(e){e.ERROR_EVENT="CORNERSTONE_ERROR",e.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",e.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",e.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",e.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",e.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",e.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",e.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",e.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",e.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",e.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",e.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",e.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",e.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",e.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",e.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",e.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",e.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",e.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",e.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",e.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",e.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",e.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",e.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",e.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",e.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",e.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",e.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",e.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",e.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",e.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",e.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",e.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",e.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",e.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",e.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",e.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",e.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",e.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",e.GEOMETRY_LOADED="GEOMETRY_LOADED",e.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})(z||(z={}));var zt;(function(e){e[e.FAR_REPLICATE=1]="FAR_REPLICATE",e[e.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",e[e.SUBRESOLUTION=6]="SUBRESOLUTION",e[e.LOSSY=7]="LOSSY",e[e.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(zt||(zt={}));class bs{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(t,n){const r=s=>{this.removeEventListener(t,r),n.call(this,s)};this.addEventListener(t,r)}addEventListener(t,n){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].indexOf(n)===-1&&this.listeners[t].push(n)}addEventListenerDebounced(t,n,r){this.debouncedListeners[t]=this.debouncedListeners[t]||{};const s=this.debouncedListeners[t];if(!s[n]){const a=i=>{s[n]&&clearTimeout(s[n].timeoutId),s[n].timeoutId=setTimeout(()=>{n.call(this,i)},r)};s[n]={original:n,handle:a,timeoutId:null},this.addEventListener(t,a)}}removeEventListenerDebounced(t,n){var r;if((r=this.debouncedListeners[t])!=null&&r[n]){const s=this.debouncedListeners[t][n];this.removeEventListener(t,s.handle),clearTimeout(s.timeoutId),delete this.debouncedListeners[t][n]}}removeEventListener(t,n){if(!this.listeners[t])return;const r=this.listeners[t],s=r.length;for(let a=0;a<s;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(t){if(!this.listeners[t.type])return!t.defaultPrevented;const n=this.listeners[t.type].slice(),r=n.length;for(let s=0;s<r;s++)try{n[s].call(this,t)}catch(a){console.error(`error in event listener of type:  ${t.type}`,a)}return!t.defaultPrevented}}const H=new bs;function X(e=H,t,n=null){if(!t)throw new Error("Event type was not defined");const r=new CustomEvent(t,{detail:n,cancelable:!0});return e==null?void 0:e.dispatchEvent(r)}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ks(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var Bs=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,s,a;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(s=r;s--!==0;)if(!e(t[s],n[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(a=Object.keys(t),r=a.length,r!==Object.keys(n).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[s]))return!1;for(s=r;s--!==0;){var i=a[s];if(!e(t[i],n[i]))return!1}return!0}return t!==t&&n!==n},Hs=zn(Bs),nn=Object.prototype.toString,bn=function(t){var n=nn.call(t),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&nn.call(t.callee)==="[object Function]"),r},ue,rn;function Ws(){if(rn)return ue;rn=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=bn,s=Object.prototype.propertyIsEnumerable,a=!s.call({toString:null},"toString"),i=s.call(function(){},"prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=function(g){var h=g.constructor;return h&&h.prototype===g},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},f=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!u["$"+g]&&t.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{o(window[g])}catch{return!0}}catch{return!0}return!1}(),l=function(g){if(typeof window>"u"||!f)return o(g);try{return o(g)}catch{return!1}};e=function(h){var y=h!==null&&typeof h=="object",d=n.call(h)==="[object Function]",E=r(h),_=y&&n.call(h)==="[object String]",C=[];if(!y&&!d&&!E)throw new TypeError("Object.keys called on a non-object");var m=i&&d;if(_&&h.length>0&&!t.call(h,0))for(var p=0;p<h.length;++p)C.push(String(p));if(E&&h.length>0)for(var O=0;O<h.length;++O)C.push(String(O));else for(var T in h)!(m&&T==="prototype")&&t.call(h,T)&&C.push(String(T));if(a)for(var w=l(h),D=0;D<c.length;++D)!(w&&c[D]==="constructor")&&t.call(h,c[D])&&C.push(c[D]);return C}}return ue=e,ue}var Ys=Array.prototype.slice,Ps=bn,sn=Object.keys,Nt=sn?function(t){return sn(t)}:Ws(),an=Object.keys;Nt.shim=function(){if(Object.keys){var t=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);t||(Object.keys=function(r){return Ps(r)?an(Ys.call(r)):an(r)})}else Object.keys=Nt;return Object.keys||Nt};var Xs=Nt,Rt=Object.defineProperty||!1;if(Rt)try{Rt({},"a",{value:1})}catch{Rt=!1}var Kn=Rt,Js=SyntaxError,Qs=TypeError,qs=Object.getOwnPropertyDescriptor,At=qs;if(At)try{At([],"length")}catch{At=null}var Zs=At,on=Kn,ta=Js,ht=Qs,cn=Zs,ea=function(t,n,r){if(!t||typeof t!="object"&&typeof t!="function")throw new ht("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new ht("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new ht("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new ht("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new ht("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new ht("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,c=arguments.length>6?arguments[6]:!1,o=!!cn&&cn(t,n);if(on)on(t,n,{configurable:i===null&&o?o.configurable:!i,enumerable:s===null&&o?o.enumerable:!s,value:r,writable:a===null&&o?o.writable:!a});else if(c||!s&&!a&&!i)t[n]=r;else throw new ta("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},pe=Kn,Bn=function(){return!!pe};Bn.hasArrayLengthDefineBug=function(){if(!pe)return null;try{return pe([],"length",{value:1}).length!==1}catch{return!0}};var na=Bn,ra=Xs,sa=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",aa=Object.prototype.toString,ia=Array.prototype.concat,un=ea,oa=function(e){return typeof e=="function"&&aa.call(e)==="[object Function]"},Hn=na(),ca=function(e,t,n,r){if(t in e){if(r===!0){if(e[t]===n)return}else if(!oa(r)||!r())return}Hn?un(e,t,n,!0):un(e,t,n)},Wn=function(e,t){var n=arguments.length>2?arguments[2]:{},r=ra(t);sa&&(r=ia.call(r,Object.getOwnPropertySymbols(t)));for(var s=0;s<r.length;s+=1)ca(e,r[s],t[r[s]],n[r[s]])};Wn.supportsDescriptors=!!Hn;var Yn=Wn,Vt={exports:{}};typeof self<"u"?Vt.exports=self:typeof window<"u"?Vt.exports=window:Vt.exports=Function("return this")();var Pn=Vt.exports,ua=Pn,Xn=function(){return typeof K!="object"||!K||K.Math!==Math||K.Array!==Array?ua:K},fa=Yn,la=Xn,ga=function(){var t=la();if(fa.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(t,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==t))&&Object.defineProperty(t,"globalThis",{configurable:!0,enumerable:!1,value:t,writable:!0})}else(typeof globalThis!="object"||globalThis!==t)&&(t.globalThis=t);return t},ha=Yn,ya=Pn,Jn=Xn,da=ga,ma=Jn(),Qn=function(){return ma};ha(Qn,{getPolyfill:Jn,implementation:ya,shim:da});var Ea=Qn,pa=zn(Ea);const Y=pa(),qn={vtkObject:()=>null};function P(e){if(e==null||e.isA)return e;if(!e.vtkClass)return Y.console&&Y.console.error&&Y.console.error("Invalid VTK object"),null;const t=qn[e.vtkClass];if(!t)return Y.console&&Y.console.error&&Y.console.error(`No vtk class found for Object of type ${e.vtkClass}`),null;const n={...e};Object.keys(n).forEach(s=>{n[s]&&typeof n[s]=="object"&&n[s].vtkClass&&(n[s]=P(n[s]))});const r=t(n);return r&&r.modified&&r.modified(),r}function Ca(e,t){qn[e]=t}P.register=Ca;class fe extends Array{push(){for(let t=0;t<arguments.length;t++)this.includes(arguments[t])||super.push(arguments[t]);return this.length}}let Ce=0;const Zn=Symbol("void");function Ta(){return Ce}const tr={};function ct(){}const Oa=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Oa.forEach(e=>{tr[e]=ct});Y.console=console.hasOwnProperty("log")?console:tr;const st={debug:ct,error:Y.console.error||ct,info:Y.console.info||ct,log:Y.console.log||ct,warn:Y.console.warn||ct};function er(e,t){st[e]&&(st[e]=t||ct)}function nr(){st.log(...arguments)}function rr(){st.info(...arguments)}function bt(){st.debug(...arguments)}function G(){st.error(...arguments)}function Jt(){st.warn(...arguments)}const fn={};function sr(e){fn[e]||(st.error(e),fn[e]=!0)}const F=Object.create(null);F.Float32Array=Float32Array;F.Float64Array=Float64Array;F.Uint8Array=Uint8Array;F.Int8Array=Int8Array;F.Uint16Array=Uint16Array;F.Int16Array=Int16Array;F.Uint32Array=Uint32Array;F.Int32Array=Int32Array;F.Uint8ClampedArray=Uint8ClampedArray;try{F.BigInt64Array=BigInt64Array,F.BigUint64Array=BigUint64Array}catch{}function Qt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new(F[e]||Float64Array)(...n)}function qt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return(F[e]||Float64Array).from(...n)}function Zt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function $(e){return Zt(e[0]==="_"?e.slice(1):e)}function ar(e){return e.charAt(0).toLowerCase()+e.slice(1)}function ir(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let s=Number(e),a="B";for(;s>n;)s/=n,a=r.pop();return`${s.toFixed(t)} ${a}`}function or(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=e;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(t)}function cr(e){Object.keys(e).forEach(t=>{Array.isArray(e[t])&&(e[t]=[].concat(e[t]))})}function _a(e){return Object.values(F).some(t=>e instanceof t)}function wa(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Da(e,t){return Object.keys(e).find(n=>e[n]===t)}function ur(e){return e&&e.isA?e.getState():e}function Ie(e){setTimeout(e,0)}function fr(e,t){const n=performance.now();e.finally(()=>{const r=performance.now()-n;t(r)})}function te(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};cr(t);const n=[];if(Number.isInteger(t.mtime)||(t.mtime=++Ce),!("classHierarchy"in t))t.classHierarchy=new fe("vtkObject");else if(!(t.classHierarchy instanceof fe)){const a=new fe;for(let i=0;i<t.classHierarchy.length;i++)a.push(t.classHierarchy[i]);t.classHierarchy=a}function r(a){n[a]=null}function s(a){function i(){r(a)}return Object.freeze({unsubscribe:i})}return e.isDeleted=()=>!!t.deleted,e.modified=a=>{if(t.deleted){G("instance deleted - cannot call any method");return}a&&a<e.getMTime()||(t.mtime=++Ce,n.forEach(i=>i&&i(e)))},e.onModified=a=>{if(t.deleted)return G("instance deleted - cannot call any method"),null;const i=n.length;return n.push(a),s(i)},e.getMTime=()=>t.mtime,e.isA=a=>{let i=t.classHierarchy.length;for(;i--;)if(t.classHierarchy[i]===a)return!0;return!1},e.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-a]},e.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,o=!1;return Object.keys(a).forEach(u=>{const f=c?null:e[`set${Zt(u)}`];f&&Array.isArray(a[u])&&f.length>1?o=f(...a[u])||o:f?o=f(a[u])||o:(["mtime"].indexOf(u)===-1&&!i&&Jt(`Warning: Set value to model directly ${u}, ${a[u]}`),o=t[u]!==a[u]||o,t[u]=a[u])}),o},e.get=function(){for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];if(!i.length)return t;const o={};return i.forEach(u=>{o[u]=t[u]}),o},e.getReferenceByName=a=>t[a],e.delete=()=>{Object.keys(t).forEach(a=>delete t[a]),n.forEach((a,i)=>r(i)),t.deleted=!0},e.getState=()=>{if(t.deleted)return null;const a={...t,vtkClass:e.getClassName()};Object.keys(a).forEach(c=>{a[c]===null||a[c]===void 0||c[0]==="_"?delete a[c]:a[c].isA?a[c]=a[c].getState():Array.isArray(a[c])?a[c]=a[c].map(ur):_a(a[c])&&(a[c]=Array.from(a[c]))});const i={};return Object.keys(a).sort().forEach(c=>{i[c]=a[c]}),i.mtime&&delete i.mtime,i},e.shallowCopy=function(a){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==e.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${e.getClassName()}`);const c=a.get(),o=Object.keys(t).sort();Object.keys(c).sort().forEach(f=>{const l=o.indexOf(f);l===-1?i&&bt(`add ${f} in shallowCopy`):o.splice(l,1),t[f]=c[f]}),o.length&&i&&bt(`Untouched keys: ${o.join(", ")}`),e.modified()},e.toJSON=function(){return e.getState()},e}const Sa={object(e,t,n){return function(){return{...t[n.name]}}}};function Ot(e,t,n){n.forEach(r=>{if(typeof r=="object"){const s=Sa[r.type];s?e[`get${$(r.name)}`]=s(e,t,r):e[`get${$(r.name)}`]=()=>t[r.name]}else e[`get${$(r)}`]=()=>t[r]})}const lr={enum(e,t,n){const r=`_on${$(n.name)}Changed`;return s=>{var a;if(typeof s=="string"){if(n.enum[s]!==void 0)return t[n.name]!==n.enum[s]?(t[n.name]=n.enum[s],e.modified(),!0):!1;throw G(`Set Enum with invalid argument ${n}, ${s}`),new RangeError("Set Enum with invalid string argument")}if(typeof s=="number"){if(t[n.name]!==s){if(Object.keys(n.enum).map(i=>n.enum[i]).indexOf(s)!==-1){const i=t[n.name];return t[n.name]=s,(a=t[r])==null||a.call(t,e,t,s,i),e.modified(),!0}throw G(`Set Enum outside numeric range ${n}, ${s}`),new RangeError("Set Enum outside numeric range")}return!1}throw G(`Set Enum with invalid argument (String/Number) ${n}, ${s}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(e,t,n){var s;((s=n.params)==null?void 0:s.length)===1&&Jt('Setter of type "object" with a single "param" field is not supported');const r=`_on${$(n.name)}Changed`;return function(){var u,f;for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];let o;if(i.length>1&&((u=n.params)!=null&&u.length)?o=n.params.reduce((l,g,h)=>Object.assign(l,{[g]:i[h]}),{}):o=i[0],!Hs(t[n.name],o)){const l=t[n.name];return t[n.name]=o,(f=t[r])==null||f.call(t,e,t,o,l),e.modified(),!0}return!1}}};function ln(e){if(typeof e=="object"){const t=lr[e.type];if(t)return(n,r)=>t(n,r,e);throw G(`No setter for field ${e}`),new TypeError("No setter for field")}return function(n,r){const s=`_on${$(e)}Changed`;return function(i){var c;if(r.deleted)return G("instance deleted - cannot call any method"),!1;if(r[e]!==i){const o=r[e.name];return r[e]=i,(c=r[s])==null||c.call(r,n,r,i,o),n.modified(),!0}return!1}}}function ee(e,t,n){n.forEach(r=>{typeof r=="object"?e[`set${$(r.name)}`]=ln(r)(e,t):e[`set${$(r)}`]=ln(r)(e,t)})}function ne(e,t,n){Ot(e,t,n),ee(e,t,n)}function Ne(e,t,n){n.forEach(r=>{e[`get${$(r)}`]=()=>t[r]?Array.from(t[r]):t[r],e[`get${$(r)}ByReference`]=()=>t[r]})}function Re(e,t,n,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(t[a]&&r&&t[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const i=`_on${$(a)}Changed`;e[`set${$(a)}`]=function(){var h;if(t.deleted)return G("instance deleted - cannot call any method"),!1;for(var c=arguments.length,o=new Array(c),u=0;u<c;u++)o[u]=arguments[u];let f=o,l,g=!1;if(f.length===1&&(f[0]==null||f[0].length>=0)&&(f=f[0],g=!0),f==null)l=t[a]!==f;else{if(r&&f.length!==r)if(f.length<r&&s!==void 0)for(f=Array.from(f),g=!1;f.length<r;)f.push(s);else throw new RangeError(`Invalid number of values for array setter (${a})`);l=t[a]==null||t[a].length!==f.length;for(let y=0;!l&&y<f.length;++y)l=t[a][y]!==f[y];l&&g&&(f=Array.from(f))}if(l){const y=t[a.name];t[a]=f,(h=t[i])==null||h.call(t,e,t,f,y),e.modified()}return l},e[`set${$(a)}From`]=c=>{const o=t[a];c.forEach((u,f)=>{o[f]=u})}})}function gr(e,t,n,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Ne(e,t,n),Re(e,t,n,r,s)}function hr(e,t,n){for(let r=0;r<n.length;r++){const s=n[r];t[s]!==void 0&&(t[`_${s}`]=t[s],delete t[s])}}function Ae(e,t,n,r){t.inputData?t.inputData=t.inputData.map(P):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(P):t.inputConnection=[],t.output?t.output=t.output.map(P):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(P):t.inputArrayToProcess=[],t.numberOfInputs=n;function s(h){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){G("instance deleted - cannot call any method");return}if(y>=t.numberOfInputs){G(`algorithm ${e.getClassName()} only has ${t.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(t.inputData[y]!==h||t.inputConnection[y])&&(t.inputData[y]=h,t.inputConnection[y]=null,e.modified&&e.modified())}function a(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[h]&&(t.inputData[h]=t.inputConnection[h]()),t.inputData[h]}function i(h){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(t.deleted){G("instance deleted - cannot call any method");return}if(y>=t.numberOfInputs){let d=`algorithm ${e.getClassName()} only has `;d+=`${t.numberOfInputs}`,d+=" input ports. To add more input ports, use addInputConnection()",G(d);return}t.inputData[y]=null,t.inputConnection[y]=h}function c(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.inputConnection[h]}function o(){let h=t.numberOfInputs;for(;h&&!t.inputData[h-1]&&!t.inputConnection[h-1];)h--;return h===t.numberOfInputs&&t.numberOfInputs++,h}function u(h){if(t.deleted){G("instance deleted - cannot call any method");return}i(h,o())}function f(h){if(t.deleted){G("instance deleted - cannot call any method");return}s(h,o())}function l(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.deleted?(G("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[h])}e.shouldUpdate=()=>{var E,_;const h=e.getMTime();let y=1/0,d=r;for(;d--;){if(!t.output[d]||t.output[d].isDeleted())return!0;const C=t.output[d].getMTime();if(C<h)return!0;C<y&&(y=C)}for(d=t.numberOfInputs;d--;)if((E=t.inputConnection[d])!=null&&E.filter.shouldUpdate()||((_=e.getInputData(d))==null?void 0:_.getMTime())>y)return!0;return!1};function g(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const y=()=>l(h);return y.filter=e,y}if(t.numberOfInputs){let h=t.numberOfInputs;for(;h--;)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=s,e.setInputConnection=i,e.addInputData=f,e.addInputConnection=u,e.getInputData=a,e.getInputConnection=c}r&&(e.getOutputData=l,e.getOutputPort=g),e.update=()=>{const h=[];if(t.numberOfInputs){let y=0;for(;y<t.numberOfInputs;)h[y]=e.getInputData(y),y++}e.shouldUpdate()&&e.requestData&&e.requestData(h,t.output)},e.getNumberOfInputPorts=()=>t.numberOfInputs,e.getNumberOfOutputPorts=()=>r||t.output.length,e.getInputArrayToProcess=h=>{const y=t.inputArrayToProcess[h],d=t.inputData[h];return y&&d?d[`get${y.fieldAssociation}`]().getArray(y.arrayName):null},e.setInputArrayToProcess=function(h,y,d){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;t.inputArrayToProcess.length<h;)t.inputArrayToProcess.push(null);t.inputArrayToProcess[h]={arrayName:y,fieldAssociation:d,attributeType:E}}}const Ve=Symbol("Event abort");function yr(e,t,n){const r=[],s=e.delete;let a=1;function i(u){for(let f=0;f<r.length;++f){const[l]=r[f];if(l===u){r.splice(f,1);return}}}function c(u){function f(){i(u)}return Object.freeze({unsubscribe:f})}function o(){if(t.deleted){G("instance deleted - cannot call any method");return}const u=r.slice();for(let f=0;f<u.length;++f){const[,l,g]=u[f];if(l){if(g<0)setTimeout(()=>l.apply(e,arguments),1-g);else if(l.apply(e,arguments)===Ve)break}}}e[`invoke${$(n)}`]=o,e[`on${$(n)}`]=function(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${n}`),null;if(t.deleted)return G("instance deleted - cannot call any method"),null;const l=a++;return r.push([l,u,f]),r.sort((g,h)=>h[2]-g[2]),c(l)},e.delete=()=>{s(),r.forEach(u=>{let[f]=u;return i(f)})}}function re(e,t){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={},a={};return e(a,s,r),Object.freeze(a)};return t&&P.register(t,n),n}function dr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return t.filter(i=>!!i).map(i=>i(...s))}}function ke(e){return e&&e.isA&&e.isA("vtkObject")}function Kt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(ke(e)){if(r.indexOf(e)>=0)return n;r.push(e);const s=t(e);s!==void 0&&n.push(s);const a=e.get();Object.keys(a).forEach(i=>{const c=a[i];Array.isArray(c)?c.forEach(o=>{Kt(o,t,n,r)}):Kt(c,t,n,r)})}return n}function mr(e,t,n){var r=this;let s;const a=function(){for(var i=arguments.length,c=new Array(i),o=0;o<i;o++)c[o]=arguments[o];const u=r,f=()=>{s=null,n||e.apply(u,c)},l=n&&!s;clearTimeout(s),s=setTimeout(f,t),l&&e.apply(u,c)};return a.cancel=()=>clearTimeout(s),a}function Er(e,t){let n=!1,r=null;function s(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var i=arguments.length,c=new Array(i),o=0;o<i;o++)c[o]=arguments[o];if(n){r=c;return}n=!0,e(...c),setTimeout(s,t)}return a}function $e(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},n),e.setKey=(r,s)=>{t.keystore[r]=s},e.getKey=r=>t.keystore[r],e.getAllKeys=()=>Object.keys(t.keystore),e.deleteKey=r=>delete t.keystore[r],e.clearKeystore=()=>e.getAllKeys().forEach(r=>delete t.keystore[r])}let va=1;const wt="__root__";function pr(e,t){$e(e,t);const n=e.delete;t.proxyId=`${va++}`,t.ui=JSON.parse(JSON.stringify(t.ui||[])),Ot(e,t,["proxyId","proxyGroup","proxyName"]),ne(e,t,["proxyManager"]);const r={},s={};function a(u,f){s[f]||(s[f]=[]);const l=s[f];for(let g=0;g<u.length;g++)l.push(u[g].name),r[u[g].name]=u[g],u[g].children&&u[g].children.length&&a(u[g].children,u[g].name)}a(t.ui,wt),e.updateUI=u=>{t.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(f=>delete r[f]),Object.keys(s).forEach(f=>delete s[f]),a(t.ui,wt),e.modified()};function i(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wt;return s[u]}e.updateProxyProperty=(u,f)=>{const l=r[u];l?Object.assign(l,f):r[u]={...f}},e.activate=()=>{if(t.proxyManager){const u=`setActive${$(e.getProxyGroup().slice(0,-1))}`;t.proxyManager[u]&&t.proxyManager[u](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=(u,f)=>{f in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[f]=[]),t.propertyLinkSubscribers[f].push(u)},e.gcPropertyLinks=u=>{const f=t.propertyLinkSubscribers[u]||[];for(;f.length;)f.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t.propertyLinkMap[u])return t.propertyLinkMap[u];let l=null;const g=[];let h=0,y=!1;function d(p){let O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(y)return null;const T=[];let w=null;for(h=g.length;h--;){const L=g[h];L.instance===p?w=L:T.push(L)}if(!w)return null;const D=w.instance[`get${$(w.propertyName)}`]();if(!wa(D,l)||O){for(l=D,y=!0;T.length;){const L=T.pop();L.instance.set({[L.propertyName]:l})}y=!1}return t.propertyLinkMap[u].persistent&&(t.propertyLinkMap[u].value=D),D}function E(p,O){const T=[];for(h=g.length;h--;){const w=g[h];w.instance===p&&(w.propertyName===O||O===void 0)&&(w.subscription.unsubscribe(),T.push(h))}for(;T.length;)g.splice(T.pop(),1)}function _(p,O){let T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const w=p.onModified(d),D=g[0];return g.push({instance:p,propertyName:O,subscription:w}),T&&(t.propertyLinkMap[u].persistent&&t.propertyLinkMap[u].value!==void 0?p.set({[O]:t.propertyLinkMap[u].value}):D&&d(D.instance,!0)),{unsubscribe:()=>E(p,O)}}function C(){for(;g.length;)g.pop().subscription.unsubscribe()}const m={bind:_,unbind:E,unsubscribe:C,persistent:f};return t.propertyLinkMap[u]=m,m};function c(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:wt;const f=[],l=t.proxyId,g=i(u)||[];for(let h=0;h<g.length;h++){const y=g[h],d=e[`get${$(y)}`],E=d?d():void 0,_={id:l,name:y,value:E},C=c(y);C.length&&(_.children=C),f.push(_)}return f}e.listPropertyNames=()=>c().map(u=>u.name),e.getPropertyByName=u=>c().find(f=>f.name===u),e.getPropertyDomainByName=u=>(r[u]||{}).domain,e.getProxySection=()=>({id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:c()}),e.delete=()=>{const u=Object.keys(t.propertyLinkMap);let f=u.length;for(;f--;)t.propertyLinkMap[u[f]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),n()},e.getState=()=>null;function o(){if(t.links)for(let u=0;u<t.links.length;u++){const{link:f,property:l,persistent:g,updateOnBind:h,type:y}=t.links[u];if(y==="application"){const d=t.proxyManager.getPropertyLink(f,g);e.registerPropertyLinkForGC(d,"application"),d.bind(e,l,h)}}}Ie(o)}function Cr(e,t,n){const r=e.delete,s=[],a=Object.keys(n);let i=a.length;for(;i--;){const c=a[i],{modelKey:o,property:u,modified:f=!0}=n[c],l=$(u),g=$(c);e[`get${g}`]=t[o][`get${l}`],e[`set${g}`]=t[o][`set${l}`],f&&s.push(t[o].onModified(e.modified))}e.delete=()=>{for(;s.length;)s.pop().unsubscribe();r()}}function Tr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};t.this=e;function s(c){const o=Object.keys(c);let u=o.length;for(;u--;){const f=o[u];t[f].set(c[f])}}const a=Object.keys(r);let i=a.length;for(;i--;){const c=a[i];t[c]=r[c];const o=n[c];e[`set${$(c)}`]=u=>{if(u!==t[c]){t[c]=u;const f=o[u];s(f),e.modified()}}}a.length&&Ot(e,t,a)}const gn=10,hn=40,yn=800;function Or(e){let t=0,n=0,r=0,s=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=t*gn,s=n*gn,"deltaY"in e&&(s=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||s)&&e.deltaMode&&(e.deltaMode===1?(r*=hn,s*=hn):(r*=yn,s*=yn)),r&&!t&&(t=r<1?-1:1),s&&!n&&(n=s<1?-1:1),{spinX:t,spinY:n||t,pixelX:r,pixelY:s||r}}var x={algo:Ae,capitalize:Zt,chain:dr,debounce:mr,enumToString:Da,event:yr,EVENT_ABORT:Ve,formatBytesToProperUnit:ir,formatNumbersWithThousandSeparator:or,get:Ot,getArray:Ne,getCurrentGlobalMTime:Ta,getStateArrayMapFunc:ur,isVtkObject:ke,keystore:$e,measurePromiseExecution:fr,moveToProtected:hr,newInstance:re,newTypedArray:Qt,newTypedArrayFrom:qt,normalizeWheel:Or,obj:te,proxy:pr,proxyPropertyMapping:Cr,proxyPropertyState:Tr,safeArrays:cr,set:ee,setArray:Re,setGet:ne,setGetArray:gr,setImmediate:Ie,setLoggerFunction:er,throttle:Er,traverseInstanceTree:Kt,TYPED_ARRAYS:F,uncapitalize:ar,VOID:Zn,vtkDebugMacro:bt,vtkErrorMacro:G,vtkInfoMacro:rr,vtkLogMacro:nr,vtkOnceErrorMacro:sr,vtkWarningMacro:Jt,objectSetterMap:lr},_r=Object.freeze({__proto__:null,VOID:Zn,setLoggerFunction:er,vtkLogMacro:nr,vtkInfoMacro:rr,vtkDebugMacro:bt,vtkErrorMacro:G,vtkWarningMacro:Jt,vtkOnceErrorMacro:sr,TYPED_ARRAYS:F,newTypedArray:Qt,newTypedArrayFrom:qt,capitalize:Zt,_capitalize:$,uncapitalize:ar,formatBytesToProperUnit:ir,formatNumbersWithThousandSeparator:or,setImmediateVTK:Ie,measurePromiseExecution:fr,obj:te,get:Ot,set:ee,setGet:ne,getArray:Ne,setArray:Re,setGetArray:gr,moveToProtected:hr,algo:Ae,EVENT_ABORT:Ve,event:yr,newInstance:re,chain:dr,isVtkObject:ke,traverseInstanceTree:Kt,debounce:mr,throttle:Er,keystore:$e,proxy:pr,proxyPropertyMapping:Cr,proxyPropertyState:Tr,normalizeWheel:Or,default:x});const La={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},se={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},xa=se.FLOAT;var wr={DefaultDataType:xa,DataTypeByteSize:La,VtkDataTypes:se},Ue={exports:{}};Ue.exports;(function(e){(function(t,n,r){function s(o){var u=this,f=c();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=f(" "),u.s1=f(" "),u.s2=f(" "),u.s0-=f(o),u.s0<0&&(u.s0+=1),u.s1-=f(o),u.s1<0&&(u.s1+=1),u.s2-=f(o),u.s2<0&&(u.s2+=1),f=null}function a(o,u){return u.c=o.c,u.s0=o.s0,u.s1=o.s1,u.s2=o.s2,u}function i(o,u){var f=new s(o),l=u&&u.state,g=f.next;return g.int32=function(){return f.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,l&&(typeof l=="object"&&a(l,f),g.state=function(){return a(f,{})}),g}function c(){var o=4022871197,u=function(f){f=String(f);for(var l=0;l<f.length;l++){o+=f.charCodeAt(l);var g=.02519603282416938*o;o=g>>>0,g-=o,g*=o,o=g>>>0,g-=o,o+=g*4294967296}return(o>>>0)*23283064365386963e-26};return u}n.exports?n.exports=i:this.alea=i})(K,e)})(Ue);var Ma=Ue.exports,Ge={exports:{}};Ge.exports;(function(e){(function(t,n,r){function s(c){var o=this,u="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var l=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^l^l>>>8},c===(c|0)?o.x=c:u+=c;for(var f=0;f<u.length+64;f++)o.x^=u.charCodeAt(f)|0,o.next()}function a(c,o){return o.x=c.x,o.y=c.y,o.z=c.z,o.w=c.w,o}function i(c,o){var u=new s(c),f=o&&o.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var g=u.next()>>>11,h=(u.next()>>>0)/4294967296,y=(g+h)/(1<<21);while(y===0);return y},l.int32=u.next,l.quick=l,f&&(typeof f=="object"&&a(f,u),l.state=function(){return a(u,{})}),l}n.exports?n.exports=i:this.xor128=i})(K,e)})(Ge);var Ia=Ge.exports,Fe={exports:{}};Fe.exports;(function(e){(function(t,n,r){function s(c){var o=this,u="";o.next=function(){var l=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(l^l<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,c===(c|0)?o.x=c:u+=c;for(var f=0;f<u.length+64;f++)o.x^=u.charCodeAt(f)|0,f==u.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function a(c,o){return o.x=c.x,o.y=c.y,o.z=c.z,o.w=c.w,o.v=c.v,o.d=c.d,o}function i(c,o){var u=new s(c),f=o&&o.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var g=u.next()>>>11,h=(u.next()>>>0)/4294967296,y=(g+h)/(1<<21);while(y===0);return y},l.int32=u.next,l.quick=l,f&&(typeof f=="object"&&a(f,u),l.state=function(){return a(u,{})}),l}n.exports?n.exports=i:this.xorwow=i})(K,e)})(Fe);var Na=Fe.exports,je={exports:{}};je.exports;(function(e){(function(t,n,r){function s(c){var o=this;o.next=function(){var f=o.x,l=o.i,g,h;return g=f[l],g^=g>>>7,h=g^g<<24,g=f[l+1&7],h^=g^g>>>10,g=f[l+3&7],h^=g^g>>>3,g=f[l+4&7],h^=g^g<<7,g=f[l+7&7],g=g^g<<13,h^=g^g<<9,f[l]=h,o.i=l+1&7,h};function u(f,l){var g,h=[];if(l===(l|0))h[0]=l;else for(l=""+l,g=0;g<l.length;++g)h[g&7]=h[g&7]<<15^l.charCodeAt(g)+h[g+1&7]<<13;for(;h.length<8;)h.push(0);for(g=0;g<8&&h[g]===0;++g);for(g==8?h[7]=-1:h[g],f.x=h,f.i=0,g=256;g>0;--g)f.next()}u(o,c)}function a(c,o){return o.x=c.x.slice(),o.i=c.i,o}function i(c,o){c==null&&(c=+new Date);var u=new s(c),f=o&&o.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var g=u.next()>>>11,h=(u.next()>>>0)/4294967296,y=(g+h)/(1<<21);while(y===0);return y},l.int32=u.next,l.quick=l,f&&(f.x&&a(f,u),l.state=function(){return a(u,{})}),l}n.exports?n.exports=i:this.xorshift7=i})(K,e)})(je);var Ra=je.exports,ze={exports:{}};ze.exports;(function(e){(function(t,n,r){function s(c){var o=this;o.next=function(){var f=o.w,l=o.X,g=o.i,h,y;return o.w=f=f+1640531527|0,y=l[g+34&127],h=l[g=g+1&127],y^=y<<13,h^=h<<17,y^=y>>>15,h^=h>>>12,y=l[g]=y^h,o.i=g,y+(f^f>>>16)|0};function u(f,l){var g,h,y,d,E,_=[],C=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,C=Math.max(C,l.length)),y=0,d=-32;d<C;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(E=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(E=E+1640531527|0,g=_[d&127]^=h+E,y=g==0?y+1:0);for(y>=128&&(_[(l&&l.length||0)&127]=-1),y=127,d=4*128;d>0;--d)h=_[y+34&127],g=_[y=y+1&127],h^=h<<13,g^=g<<17,h^=h>>>15,g^=g>>>12,_[y]=h^g;f.w=E,f.X=_,f.i=y}u(o,c)}function a(c,o){return o.i=c.i,o.w=c.w,o.X=c.X.slice(),o}function i(c,o){c==null&&(c=+new Date);var u=new s(c),f=o&&o.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var g=u.next()>>>11,h=(u.next()>>>0)/4294967296,y=(g+h)/(1<<21);while(y===0);return y},l.int32=u.next,l.quick=l,f&&(f.X&&a(f,u),l.state=function(){return a(u,{})}),l}n.exports?n.exports=i:this.xor4096=i})(K,e)})(ze);var Aa=ze.exports,be={exports:{}};be.exports;(function(e){(function(t,n,r){function s(c){var o=this,u="";o.next=function(){var l=o.b,g=o.c,h=o.d,y=o.a;return l=l<<25^l>>>7^g,g=g-h|0,h=h<<24^h>>>8^y,y=y-l|0,o.b=l=l<<20^l>>>12^g,o.c=g=g-h|0,o.d=h<<16^g>>>16^y,o.a=y-l|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,c===Math.floor(c)?(o.a=c/4294967296|0,o.b=c|0):u+=c;for(var f=0;f<u.length+20;f++)o.b^=u.charCodeAt(f)|0,o.next()}function a(c,o){return o.a=c.a,o.b=c.b,o.c=c.c,o.d=c.d,o}function i(c,o){var u=new s(c),f=o&&o.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var g=u.next()>>>11,h=(u.next()>>>0)/4294967296,y=(g+h)/(1<<21);while(y===0);return y},l.int32=u.next,l.quick=l,f&&(typeof f=="object"&&a(f,u),l.state=function(){return a(u,{})}),l}n.exports?n.exports=i:this.tychei=i})(K,e)})(be);var Va=be.exports,Dr={exports:{}},ka={},$a=Object.freeze({__proto__:null,default:ka}),Ua=Ks($a);(function(e){(function(t,n,r){var s=256,a=6,i=52,c="random",o=r.pow(s,a),u=r.pow(2,i),f=u*2,l=s-1,g;function h(p,O,T){var w=[];O=O==!0?{entropy:!0}:O||{};var D=_(E(O.entropy?[p,m(n)]:p??C(),3),w),L=new y(w),v=function(){for(var S=L.g(a),N=o,I=0;S<u;)S=(S+I)*s,N*=s,I=L.g(1);for(;S>=f;)S/=2,N/=2,I>>>=1;return(S+I)/N};return v.int32=function(){return L.g(4)|0},v.quick=function(){return L.g(4)/4294967296},v.double=v,_(m(L.S),n),(O.pass||T||function(S,N,I,M){return M&&(M.S&&d(M,L),S.state=function(){return d(L,{})}),I?(r[c]=S,N):S})(v,D,"global"in O?O.global:this==r,O.state)}function y(p){var O,T=p.length,w=this,D=0,L=w.i=w.j=0,v=w.S=[];for(T||(p=[T++]);D<s;)v[D]=D++;for(D=0;D<s;D++)v[D]=v[L=l&L+p[D%T]+(O=v[D])],v[L]=O;(w.g=function(S){for(var N,I=0,M=w.i,U=w.j,A=w.S;S--;)N=A[M=l&M+1],I=I*s+A[l&(A[M]=A[U=l&U+N])+(A[U]=N)];return w.i=M,w.j=U,I})(s)}function d(p,O){return O.i=p.i,O.j=p.j,O.S=p.S.slice(),O}function E(p,O){var T=[],w=typeof p,D;if(O&&w=="object")for(D in p)try{T.push(E(p[D],O-1))}catch{}return T.length?T:w=="string"?p:p+"\0"}function _(p,O){for(var T=p+"",w,D=0;D<T.length;)O[l&D]=l&(w^=O[l&D]*19)+T.charCodeAt(D++);return m(O)}function C(){try{var p;return g&&(p=g.randomBytes)?p=p(s):(p=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(p)),m(p)}catch{var O=t.navigator,T=O&&O.plugins;return[+new Date,t,T,t.screen,m(n)]}}function m(p){return String.fromCharCode.apply(0,p)}if(_(r.random(),n),e.exports){e.exports=h;try{g=Ua}catch{}}else r["seed"+c]=h})(typeof self<"u"?self:K,[],Math)})(Dr);var Ga=Dr.exports,Fa=Ma,ja=Ia,za=Na,ba=Ra,Ka=Aa,Ba=Va,Et=Ga;Et.alea=Fa;Et.xor128=ja;Et.xorwow=za;Et.xorshift7=ba;Et.xor4096=Ka;Et.tychei=Ba;const Ha=1e-12,{vtkErrorMacro:wc,vtkWarningMacro:dn}=x;function Te(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const t=Array(e);for(let n=0;n<e;++n)t[n]=0;return t}function Wa(e,t,n){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function rt(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function mn(e,t,n,r){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function R(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Sr(e,t,n){const r=e[1]*t[2]-e[2]*t[1],s=e[2]*t[0]-e[0]*t[2],a=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=s,n[2]=a,n}function vr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:{let n=0;for(let r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}}function Ya(e){const t=vr(e);return t!==0&&(e[0]/=t,e[1]/=t,e[2]/=t),t}function Q(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])}function kt(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.length===2?t[0][0]*t[1][1]-t[1][0]*t[0][1]:t.length===4?t[0]*t[3]-t[1]*t[2]:Number.NaN}function le(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${e}`.includes("e"))return+`${Math.round(`${e}e+${t}`)}e-${t}`;const n=`${e}`.split("e");let r="";return+n[1]+t>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+t}`)}e-${t}`}function En(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t[0]=le(e[0],n),t[1]=le(e[1],n),t[2]=le(e[2],n),t}function Pa(e,t,n){let r,s,a,i,c=0,o,u,f;const l=Te(n);for(r=0;r<n;r++){for(i=0,s=0;s<n;s++)(f=Math.abs(e[r*n+s]))>i&&(i=f);if(i===0)return dn("Unable to factor linear system"),0;l[r]=1/i}for(s=0;s<n;s++){for(r=0;r<s;r++){for(o=e[r*n+s],a=0;a<r;a++)o-=e[r*n+a]*e[a*n+s];e[r*n+s]=o}for(i=0,r=s;r<n;r++){for(o=e[r*n+s],a=0;a<s;a++)o-=e[r*n+a]*e[a*n+s];e[r*n+s]=o,(u=l[r]*Math.abs(o))>=i&&(i=u,c=r)}if(s!==c){for(a=0;a<n;a++)u=e[c*n+a],e[c*n+a]=e[s*n+a],e[s*n+a]=u;l[c]=l[s]}if(t[s]=c,Math.abs(e[s*n+s])<=Ha)return dn("Unable to factor linear system"),0;if(s!==n-1)for(u=1/e[s*n+s],r=s+1;r<n;r++)e[r*n+s]*=u}return 1}function Xa(e,t,n,r){let s,a,i,c,o;for(i=-1,s=0;s<r;s++){if(c=t[s],o=n[c],n[c]=n[s],i>=0)for(a=i;a<=s-1;a++)o-=e[s*r+a]*n[a];else o!==0&&(i=s);n[s]=o}for(s=r-1;s>=0;s--){for(o=n[s],a=s+1;a<r;a++)o-=e[s*r+a]*n[a];n[s]=o/e[s*r+s]}}function Ja(e,t,n){if(n===2){const s=Te(2),a=kt(e[0],e[1],e[2],e[3]);return a===0?0:(s[0]=(e[3]*t[0]-e[1]*t[1])/a,s[1]=(-(e[2]*t[0])+e[0]*t[1])/a,t[0]=s[0],t[1]=s[1],1)}if(n===1)return e[0]===0?0:(t[0]/=e[0],1);const r=Te(n);return Pa(e,r,n)===0?0:(Xa(e,r,t,n),1)}function Qa(e){return e[0]=1,e[1]=-1,e[2]=1,e[3]=-1,e[4]=1,e[5]=-1,e}function ge(e,t,n){return e<t?t:e>n?n:e}function pn(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=ge(e[0],t[0],n[0]),r[1]=ge(e[1],t[1],n[1]),r[2]=ge(e[2],t[2],n[2]),r}const{vtkErrorMacro:qa}=_r,{DefaultDataType:Za}=wr,ti=1e-6;function Oe(e,t,n){const r=e.length;let s=Number.MAX_VALUE,a=-Number.MAX_VALUE,i,c;for(c=t;c<r;c+=n)if(!Number.isNaN(e[c])){s=e[c],a=s;break}for(;c<r;c+=n)i=e[c],i<s?s=i:i>a&&(a=i);return{min:s,max:a}}function ei(){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE,n=0,r=0;return{add(s){e>s&&(e=s),t<s&&(t=s),n++,r+=s},get(){return{min:e,max:t,count:n,sum:r,mean:r/n}},getRange(){return{min:e,max:t}}}}function Lr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(t<0&&n>1){const s=e.length/n,a=new Float64Array(s);for(let i=0,c=0;i<s;++i){for(let o=c+n;c<o;++c)a[i]+=e[c]*e[c];a[i]**=.5}return Oe(a,0,1)}return Oe(e,t<0?0:t,n)}function Cn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=e||[];for(;n.length<=t;)n.push(null);return n}function Ke(e){return Object.prototype.toString.call(e).slice(8,-1)}function ni(e){const t=e.getNumberOfComponents();let n=0;const r=new Array(t);for(let s=0;s<e.getNumberOfTuples();++s){e.getTuple(s,r);const a=vr(r,t);a>n&&(n=a)}return n}const ri={computeRange:Lr,createRangeHelper:ei,fastComputeRange:Oe,getDataType:Ke,getMaxNorm:ni};function si(e,t){t.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const s=e.getNumberOfComponents(),a=t.values.length/(s>0?s:1);if(r===a)return!0;if(r>a){const i=t.values;return t.values=Qt(t.dataType,(r+a)*s),t.values.set(i),!0}return t.size>r*s&&(t.size=r*s,e.dataChange()),!0}e.dataChange=()=>{t.ranges=null,e.modified()},e.resize=r=>{n(r);const s=r*e.getNumberOfComponents();return t.size!==s?(t.size=s,e.dataChange(),!0):!1},e.initialize=()=>{e.resize(0)},e.getElementComponentSize=()=>t.values.BYTES_PER_ELEMENT,e.getComponent=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return t.values[r*t.numberOfComponents+s]},e.setComponent=(r,s,a)=>{a!==t.values[r*t.numberOfComponents+s]&&(t.values[r*t.numberOfComponents+s]=a,e.dataChange())},e.getValue=r=>{const s=r/t.numberOfComponents,a=r%t.numberOfComponents;return e.getComponent(s,a)},e.setValue=(r,s)=>{const a=r/t.numberOfComponents,i=r%t.numberOfComponents;e.setComponent(a,i,s)},e.getData=()=>t.size===t.values.length?t.values:t.values.subarray(0,t.size),e.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,s=r;s<0&&(s=t.numberOfComponents===1?0:t.numberOfComponents);let a=null;return t.ranges||(t.ranges=Cn(t.ranges,t.numberOfComponents)),a=t.ranges[s],a?(t.rangeTuple[0]=a.min,t.rangeTuple[1]=a.max,t.rangeTuple):(a=Lr(e.getData(),r,t.numberOfComponents),t.ranges[s]=a,t.rangeTuple[0]=a.min,t.rangeTuple[1]=a.max,t.rangeTuple)},e.setRange=(r,s)=>{t.ranges||(t.ranges=Cn(t.ranges,t.numberOfComponents));const a={min:r.min,max:r.max};return t.ranges[s]=a,t.rangeTuple[0]=a.min,t.rangeTuple[1]=a.max,t.rangeTuple},e.setTuple=(r,s)=>{const a=r*t.numberOfComponents;for(let i=0;i<t.numberOfComponents;i++)t.values[a+i]=s[i]},e.setTuples=(r,s)=>{let a=r*t.numberOfComponents;const i=Math.min(s.length,t.size-a);for(let c=0;c<i;)t.values[a++]=s[c++]},e.insertTuple=(r,s)=>(t.size<=r*t.numberOfComponents&&(t.size=(r+1)*t.numberOfComponents,n(r+1)),e.setTuple(r,s),r),e.insertTuples=(r,s)=>{const a=r+s.length/t.numberOfComponents;return t.size<a*t.numberOfComponents&&(t.size=a*t.numberOfComponents,n(a)),e.setTuples(r,s),a},e.insertNextTuple=r=>{const s=t.size/t.numberOfComponents;return e.insertTuple(s,r)},e.insertNextTuples=r=>{const s=t.size/t.numberOfComponents;return e.insertTuples(s,r)},e.findTuple=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ti;for(let a=0;a<t.size;a+=t.numberOfComponents)if(Math.abs(r[0]-t.values[a])<=s){let i=!0;for(let c=1;c<t.numberOfComponents;++c)if(Math.abs(r[c]-t.values[a+c])>s){i=!1;break}if(i)return a/t.numberOfComponents}return-1},e.getTuple=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=t.numberOfComponents||1,i=r*a;switch(a){case 4:s[3]=t.values[i+3];case 3:s[2]=t.values[i+2];case 2:s[1]=t.values[i+1];case 1:s[0]=t.values[i];break;default:for(let c=a-1;c>=0;--c)s[c]=t.values[i+c]}return s},e.getTuples=(r,s)=>{const a=(r??0)*t.numberOfComponents,i=(s??e.getNumberOfTuples())*t.numberOfComponents,c=e.getData().subarray(a,i);return c.length>0?c:null},e.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*t.numberOfComponents},e.getNumberOfComponents=()=>t.numberOfComponents,e.getNumberOfValues=()=>t.size,e.getNumberOfTuples=()=>t.size/t.numberOfComponents,e.getDataType=()=>t.dataType,e.newClone=()=>Mr({empty:!0,name:t.name,dataType:t.dataType,numberOfComponents:t.numberOfComponents}),e.getName=()=>(t.name||(e.modified(),t.name=`vtkDataArray${e.getMTime()}`),t.name),e.setData=(r,s)=>{t.values=r,t.size=r.length,t.dataType=Ke(r),s&&(t.numberOfComponents=s),t.size%t.numberOfComponents!==0&&(t.numberOfComponents=1),e.dataChange()},e.getState=()=>{if(t.deleted)return null;const r={...t,vtkClass:e.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const s={};return Object.keys(r).sort().forEach(a=>{s[a]=r[a]}),s.mtime&&delete s.mtime,s},e.deepCopy=r=>{const s=e.getDataType(),a=t.values;e.shallowCopy(r),(a==null?void 0:a.length)>=r.getNumberOfValues()&&s===r.getDataType()?(a.set(r.getData()),t.values=a,e.dataChange()):e.setData(r.getData().slice())},e.interpolateTuple=(r,s,a,i,c,o)=>{const u=t.numberOfComponents||1;(u!==s.getNumberOfComponents()||u!==i.getNumberOfComponents())&&qa("numberOfComponents must match");const f=s.getTuple(a),l=i.getTuple(c),g=[];switch(g.length=u,u){case 4:g[3]=f[3]+(l[3]-f[3])*o;case 3:g[2]=f[2]+(l[2]-f[2])*o;case 2:g[1]=f[1]+(l[1]-f[1])*o;case 1:g[0]=f[0]+(l[0]-f[0])*o;break;default:for(let h=0;h<u;h++)g[h]=f[h]+(l[h]-f[h])*o}return e.insertTuple(r,g)}}const ai={name:"",numberOfComponents:1,dataType:Za,rangeTuple:[0,0]};function xr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(t,ai,n),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(t.values?Array.isArray(t.values)&&(t.values=qt(t.dataType,t.values)):t.values=Qt(t.dataType,t.size),t.values&&(t.size=t.size??t.values.length,t.dataType=Ke(t.values)),te(e,t),ee(e,t,["name","numberOfComponents"]),t.size%t.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");si(e,t)}const Mr=re(xr,"vtkDataArray");var q={newInstance:Mr,extend:xr,...ri,...wr},Ir=1e-6,Z=typeof Float32Array<"u"?Float32Array:Array;function ii(e,t){return Math.abs(e-t)<=Ir*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function oi(){var e=new Z(9);return Z!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ci(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ui(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],i=t[4],c=t[5],o=t[6],u=t[7],f=t[8],l=t[9],g=t[10],h=t[11],y=t[12],d=t[13],E=t[14],_=t[15],C=n*c-r*i,m=n*o-s*i,p=n*u-a*i,O=r*o-s*c,T=r*u-a*c,w=s*u-a*o,D=f*d-l*y,L=f*E-g*y,v=f*_-h*y,S=l*E-g*d,N=l*_-h*d,I=g*_-h*E,M=C*I-m*N+p*S+O*v-T*L+w*D;return M?(M=1/M,e[0]=(c*I-o*N+u*S)*M,e[1]=(s*N-r*I-a*S)*M,e[2]=(d*w-E*T+_*O)*M,e[3]=(g*T-l*w-h*O)*M,e[4]=(o*v-i*I-u*L)*M,e[5]=(n*I-s*v+a*L)*M,e[6]=(E*p-y*w-_*m)*M,e[7]=(f*w-g*p+h*m)*M,e[8]=(i*N-c*v+u*D)*M,e[9]=(r*v-n*N-a*D)*M,e[10]=(y*T-d*p+_*C)*M,e[11]=(l*p-f*T-h*C)*M,e[12]=(c*L-i*S-o*D)*M,e[13]=(n*S-r*L+s*D)*M,e[14]=(d*m-y*O-E*C)*M,e[15]=(f*O-l*m+g*C)*M,e):null}function fi(e,t,n){var r=n[0],s=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function li(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Bt(){var e=new Z(3);return Z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function gi(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function j(e,t,n){var r=new Z(3);return r[0]=e,r[1]=t,r[2]=n,r}function hi(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function he(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function yi(e,t){var n=t[0],r=t[1],s=t[2],a=n*n+r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function _e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ye(e,t,n){var r=t[0],s=t[1],a=t[2],i=n[0],c=n[1],o=n[2];return e[0]=s*o-a*c,e[1]=a*i-r*o,e[2]=r*c-s*i,e}function we(e,t,n){var r=t[0],s=t[1],a=t[2],i=n[3]*r+n[7]*s+n[11]*a+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*s+n[8]*a+n[12])/i,e[1]=(n[1]*r+n[5]*s+n[9]*a+n[13])/i,e[2]=(n[2]*r+n[6]*s+n[10]*a+n[14])/i,e}var di=gi;(function(){var e=Bt();return function(t,n,r,s,a,i){var c,o;for(n||(n=3),r||(r=0),s?o=Math.min(s*n+r,t.length):o=t.length,c=r;c<o;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],a(e,e,i),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}})();function mi(){var e=new Z(4);return Z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ei(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],i=n*n+r*r+s*s+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=r*i,e[2]=s*i,e[3]=a*i,e}(function(){var e=mi();return function(t,n,r,s,a,i){var c,o;for(n||(n=4),r||(r=0),s?o=Math.min(s*n+r,t.length):o=t.length,c=r;c<o;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],a(e,e,i),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}})();function Tn(){var e=new Z(4);return Z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function pi(e,t,n){n=n*.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function $t(e,t,n,r){var s=t[0],a=t[1],i=t[2],c=t[3],o=n[0],u=n[1],f=n[2],l=n[3],g,h,y,d,E;return h=s*o+a*u+i*f+c*l,h<0&&(h=-h,o=-o,u=-u,f=-f,l=-l),1-h>Ir?(g=Math.acos(h),y=Math.sin(g),d=Math.sin((1-r)*g)/y,E=Math.sin(r*g)/y):(d=1-r,E=r),e[0]=d*s+E*o,e[1]=d*a+E*u,e[2]=d*i+E*f,e[3]=d*c+E*l,e}function Ci(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var a=(s+1)%3,i=(s+2)%3;r=Math.sqrt(t[s*3+s]-t[a*3+a]-t[i*3+i]+1),e[s]=.5*r,r=.5/r,e[3]=(t[a*3+i]-t[i*3+a])*r,e[a]=(t[a*3+s]+t[s*3+a])*r,e[i]=(t[i*3+s]+t[s*3+i])*r}return e}var Nr=Ei;(function(){var e=Bt(),t=j(1,0,0),n=j(0,1,0);return function(r,s,a){var i=_e(s,a);return i<-.999999?(ye(e,t,s),di(e)<1e-6&&ye(e,n,s),yi(e,e),pi(r,e,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ye(e,s,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,Nr(r,r))}})();(function(){var e=Tn(),t=Tn();return function(n,r,s,a,i,c){return $t(e,r,i,c),$t(t,s,a,c),$t(n,e,t,2*c*(1-c)),n}})();(function(){var e=oi();return function(t,n,r,s){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Nr(t,Ci(t,e))}})();const{vtkErrorMacro:On,vtkWarningMacro:Ti}=x;function Oi(e,t){t.classHierarchy.push("vtkFieldData");const n=e.getState;t.arrays&&(t.arrays=t.arrays.map(r=>({data:P(r.data)}))),e.initialize=()=>{e.initializeFields(),e.copyAllOn(),e.clearFieldFlags()},e.initializeFields=()=>{t.arrays=[],t.copyFieldFlags={},e.modified()},e.copyStructure=r=>{e.initializeFields(),t.copyFieldFlags=r.getCopyFieldFlags().map(s=>s),t.arrays=r.arrays().map(s=>({array:s}))},e.getNumberOfArrays=()=>t.arrays.length,e.getNumberOfActiveArrays=()=>t.arrays.length,e.addArray=r=>{const s=r.getName(),{array:a,index:i}=e.getArrayWithIndex(s);return a!=null?(t.arrays[i]={data:r},i):(t.arrays=[].concat(t.arrays,{data:r}),t.arrays.length-1)},e.removeAllArrays=()=>{t.arrays=[]},e.removeArray=r=>{const s=t.arrays.findIndex(a=>a.data.getName()===r);return e.removeArrayByIndex(s)},e.removeArrayByIndex=r=>r!==-1&&r<t.arrays.length?(t.arrays.splice(r,1),!0):!1,e.getArrays=()=>t.arrays.map(r=>r.data),e.getArray=r=>typeof r=="number"?e.getArrayByIndex(r):e.getArrayByName(r),e.getArrayByName=r=>t.arrays.reduce((s,a,i)=>a.data.getName()===r?a.data:s,null),e.getArrayWithIndex=r=>{const s=t.arrays.findIndex(a=>a.data.getName()===r);return{array:s!==-1?t.arrays[s].data:null,index:s}},e.getArrayByIndex=r=>r>=0&&r<t.arrays.length?t.arrays[r].data:null,e.hasArray=r=>e.getArrayWithIndex(r).index>=0,e.getArrayName=r=>{const s=t.arrays[r];return s?s.data.getName():""},e.getCopyFieldFlags=()=>t.copyFieldFlags,e.getFlag=r=>t.copyFieldFlags[r],e.passData=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(i=>{const c=e.getFlag(i.getName());if(c!==!1&&!(t.doCopyAllOff&&c!==!0)&&i){let o=e.getArrayByName(i.getName());if(o)if(i.getNumberOfComponents()===o.getNumberOfComponents())if(s>-1&&s<i.getNumberOfTuples()){const u=a>-1?a:s;o.insertTuple(u,i.getTuple(s))}else o.insertTuples(0,i.getTuples());else On("Unhandled case in passData");else if(s<0||s>i.getNumberOfTuples())e.addArray(i),r.getAttributes(i).forEach(u=>{e.setAttribute(i,u)});else{const u=i.getNumberOfComponents();let f=i.getNumberOfValues();const l=a>-1?a:s;f<=l*u&&(f=(l+1)*u),o=q.newInstance({name:i.getName(),dataType:i.getDataType(),numberOfComponents:u,values:x.newTypedArray(i.getDataType(),f),size:0}),o.insertTuple(l,i.getTuple(s)),e.addArray(o),r.getAttributes(i).forEach(g=>{e.setAttribute(o,g)})}}})},e.interpolateData=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(o=>{const u=e.getFlag(o.getName());if(u!==!1&&!(t.doCopyAllOff&&u!==!0)&&o){let f=e.getArrayByName(o.getName());if(f)if(o.getNumberOfComponents()===f.getNumberOfComponents())if(s>-1&&s<o.getNumberOfTuples()){const l=i>-1?i:s;f.interpolateTuple(l,o,s,o,a,c),Ti("Unexpected case in interpolateData")}else f.insertTuples(o.getTuples());else On("Unhandled case in interpolateData");else if(s<0||a<0||s>o.getNumberOfTuples())e.addArray(o),r.getAttributes(o).forEach(l=>{e.setAttribute(o,l)});else{const l=o.getNumberOfComponents();let g=o.getNumberOfValues();const h=i>-1?i:s;g<=h*l&&(g=(h+1)*l),f=q.newInstance({name:o.getName(),dataType:o.getDataType(),numberOfComponents:l,values:x.newTypedArray(o.getDataType(),g),size:0}),f.interpolateTuple(h,o,s,o,a,c),e.addArray(f),r.getAttributes(o).forEach(y=>{e.setAttribute(f,y)})}}})},e.copyFieldOn=r=>{t.copyFieldFlags[r]=!0},e.copyFieldOff=r=>{t.copyFieldFlags[r]=!1},e.copyAllOn=()=>{(!t.doCopyAllOn||t.doCopyAllOff)&&(t.doCopyAllOn=!0,t.doCopyAllOff=!1,e.modified())},e.copyAllOff=()=>{(t.doCopyAllOn||!t.doCopyAllOff)&&(t.doCopyAllOn=!1,t.doCopyAllOff=!0,e.modified())},e.clearFieldFlags=()=>{t.copyFieldFlags={}},e.deepCopy=r=>{t.arrays=r.getArrays().map(s=>{const a=s.newClone();return a.deepCopy(s),{data:a}})},e.copyFlags=r=>r.getCopyFieldFlags().map(s=>s),e.reset=()=>t.arrays.forEach(r=>r.data.reset()),e.getMTime=()=>t.arrays.reduce((r,s)=>s.data.getMTime()>r?s.data.getMTime():r,t.mtime),e.getNumberOfComponents=()=>t.arrays.reduce((r,s)=>r+s.data.getNumberOfComponents(),0),e.getNumberOfTuples=()=>t.arrays.length>0?t.arrays[0].getNumberOfTuples():0,e.getState=()=>{const r=n();return r&&(r.arrays=t.arrays.map(s=>({data:s.data.getState()}))),r}}const _i={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function Rr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,_i,n),x.obj(e,t),Oi(e,t)}const wi=x.newInstance(Rr,"vtkFieldData");var Di={newInstance:wi,extend:Rr};const Si={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},vi={MAX:0,EXACT:1,NOLIMIT:2},Li={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},xi={DUPLICATEPOINT:1,HIDDENPOINT:2},Mi={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Ii="vtkGhostType",Ni={DEFAULT:0,SINGLE:1,DOUBLE:2};var Ar={AttributeCopyOperations:Mi,AttributeLimitTypes:vi,AttributeTypes:Si,CellGhostTypes:Li,DesiredOutputPrecision:Ni,PointGhostTypes:xi,ghostArrayName:Ii};const{AttributeTypes:et,AttributeCopyOperations:at}=Ar,{vtkWarningMacro:Dt}=x;function Ri(e,t){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(i){let c=n.find(o=>et[o.toUpperCase()]===i||typeof i!="number"&&o.toLowerCase()===i.toLowerCase());return typeof c>"u"&&(c=null),c}t.classHierarchy.push("vtkDataSetAttributes");const s={...e};e.checkNumberOfComponents=i=>!0,e.setAttribute=(i,c)=>{const o=r(c);if(i&&o.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return Dt(`Cannot set attribute ${o}. The attribute must be a vtkDataArray.`),-1;if(i&&!e.checkNumberOfComponents(i,o))return Dt(`Cannot set attribute ${o}. Incorrect number of components.`),-1;let u=t[`active${o}`];if(u>=0&&u<t.arrays.length){if(t.arrays[u]===i)return u;e.removeArrayByIndex(u)}return i?(u=e.addArray(i),t[`active${o}`]=u):t[`active${o}`]=-1,e.modified(),t[`active${o}`]},e.getAttributes=i=>n.filter(c=>e[`get${c}`]()===i),e.setActiveAttributeByName=(i,c)=>e.setActiveAttributeByIndex(e.getArrayWithIndex(i).index,c),e.setActiveAttributeByIndex=(i,c)=>{const o=r(c);if(i>=0&&i<t.arrays.length){if(o.toUpperCase()!=="PEDIGREEIDS"){const u=e.getArrayByIndex(i);if(!u.isA("vtkDataArray"))return Dt(`Cannot set attribute ${o}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!e.checkNumberOfComponents(u,o))return Dt(`Cannot set attribute ${o}. Incorrect number of components.`),-1}return t[`active${o}`]=i,e.modified(),i}return i===-1&&(t[`active${o}`]=i,e.modified()),-1},e.getActiveAttribute=i=>{const c=r(i);return e[`get${c}`]()},e.removeAllArrays=()=>{n.forEach(i=>{t[`active${i}`]=-1}),s.removeAllArrays()},e.removeArrayByIndex=i=>(i!==-1&&n.forEach(c=>{i===t[`active${c}`]?t[`active${c}`]=-1:i<t[`active${c}`]&&(t[`active${c}`]-=1)}),s.removeArrayByIndex(i)),n.forEach(i=>{const c=`active${i}`;e[`get${i}`]=()=>e.getArrayByIndex(t[c]),e[`set${i}`]=o=>e.setAttribute(o,i),e[`setActive${i}`]=o=>e.setActiveAttributeByIndex(e.getArrayWithIndex(o).index,i),e[`copy${i}Off`]=()=>{const o=i.toUpperCase();t.copyAttributeFlags[at.PASSDATA][et[o]]=!1},e[`copy${i}On`]=()=>{const o=i.toUpperCase();t.copyAttributeFlags[at.PASSDATA][et[o]]=!0}}),e.initializeAttributeCopyFlags=()=>{t.copyAttributeFlags=[],Object.keys(at).filter(i=>i!=="ALLCOPY").forEach(i=>{t.copyAttributeFlags[at[i]]=Object.keys(et).filter(c=>c!=="NUM_ATTRIBUTES").reduce((c,o)=>(c[et[o]]=!0,c),[])}),t.copyAttributeFlags[at.COPYTUPLE][et.GLOBALIDS]=!1,t.copyAttributeFlags[at.INTERPOLATE][et.GLOBALIDS]=!1,t.copyAttributeFlags[at.COPYTUPLE][et.PEDIGREEIDS]=!1},e.initialize=x.chain(e.initialize,e.initializeAttributeCopyFlags),t.dataArrays&&Object.keys(t.dataArrays).length&&Object.keys(t.dataArrays).forEach(i=>{!t.dataArrays[i].ref&&t.dataArrays[i].type==="vtkDataArray"&&e.addArray(q.newInstance(t.dataArrays[i]))});const a=e.shallowCopy;e.shallowCopy=(i,c)=>{a(i,c),t.arrays=i.getArrays().map(o=>{const u=o.newClone();return u.shallowCopy(o,c),{data:u}})},e.initializeAttributeCopyFlags()}const Ai={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Vr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Ai,n),Di.extend(e,t,n),x.setGet(e,t,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),t.arrays||(t.arrays={}),Ri(e,t)}const Vi=x.newInstance(Vr,"vtkDataSetAttributes");var _n={newInstance:Vi,extend:Vr,...Ar};const ki={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},$i={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var Ui={FieldDataTypes:ki,FieldAssociations:$i};const De=["pointData","cellData","fieldData"];function Gi(e,t){t.classHierarchy.push("vtkDataSet"),De.forEach(r=>{t[r]?t[r]=P(t[r]):t[r]=_n.newInstance()});const n=e.shallowCopy;e.shallowCopy=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,s),De.forEach(a=>{t[a]=_n.newInstance(),t[a].shallowCopy(r.getReferenceByName(a))})}}const Fi={};function kr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Fi,n),x.obj(e,t),x.setGet(e,t,De),Gi(e,t)}const ji=x.newInstance(kr,"vtkDataSet");var $r={newInstance:ji,extend:kr,...Ui};function zi(e,t){t.classHierarchy.push("vtkImplicitFunction"),e.functionValue=n=>{if(!t.transform)return e.evaluateFunction(n);const r=[];return t.transform.transformPoint(n,r),e.evaluateFunction(r)},e.evaluateFunction=n=>{x.vtkErrorMacro("not implemented")}}const bi={};function Ur(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,bi,n),x.obj(e,t),x.setGet(e,t,["transform"]),zi(e,t)}const Ki=x.newInstance(Ur,"vtkImplicitFunction");var Bi={newInstance:Ki,extend:Ur};const Se=1e-6,Gr="coincide",Fr="disjoint";function Hi(e,t,n){return e[0]*(n[0]-t[0])+e[1]*(n[1]-t[1])+e[2]*(n[2]-t[2])}function jr(e,t,n){const r=n[0]*(e[0]-t[0])+n[1]*(e[1]-t[1])+n[2]*(e[2]-t[2]);return Math.abs(r)}function zr(e,t,n,r){const s=[];rt(e,t,s);const a=R(n,s);r[0]=e[0]-a*n[0],r[1]=e[1]-a*n[1],r[2]=e[2]-a*n[2]}function br(e,t,n){const r=R(e,t);let s=R(t,t);return s===0&&(s=1),n[0]=e[0]-r*t[0]/s,n[1]=e[1]-r*t[1]/s,n[2]=e[2]-r*t[2]/s,n}function Kr(e,t,n,r){const s=[];rt(e,t,s);const a=R(n,s),i=R(n,n);i!==0?(r[0]=e[0]-a*n[0]/i,r[1]=e[1]-a*n[1]/i,r[2]=e[2]-a*n[2]/i):(r[0]=e[0],r[1]=e[1],r[2]=e[2])}function Br(e,t,n,r){const s={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],i=[];rt(t,e,a),rt(n,e,i);const c=R(r,i),o=R(r,a);let u,f;return o<0?u=-o:u=o,c<0?f=-c*Se:f=c*Se,u<=f||(s.t=c/o,s.x[0]=e[0]+s.t*a[0],s.x[1]=e[1]+s.t*a[1],s.x[2]=e[2]+s.t*a[2],s.intersection=!0,s.betweenPoints=s.t>=0&&s.t<=1),s}function Hr(e,t,n,r){const s={intersection:!1,l0:[],l1:[],error:null},a=[];Sr(t,r,a);const i=a.map(l=>Math.abs(l));if(i[0]+i[1]+i[2]<Se){const l=[];return rt(e,n,l),R(t,l)===0?s.error=Gr:s.error=Fr,s}let c;i[0]>i[1]&&i[0]>i[2]?c="x":i[1]>i[2]?c="y":c="z";const o=[],u=-R(t,e),f=-R(r,n);switch(c){case"x":o[0]=0,o[1]=(f*t[2]-u*r[2])/a[0],o[2]=(u*r[1]-f*t[1])/a[0];break;case"y":o[0]=(u*r[2]-f*t[2])/a[1],o[1]=0,o[2]=(f*t[0]-u*r[0])/a[1];break;case"z":o[0]=(f*t[1]-u*r[1])/a[2],o[1]=(u*r[0]-f*t[0])/a[2],o[2]=0;break}return s.l0=o,Wa(o,a,s.l1),s.intersection=!0,s}const Wi={evaluate:Hi,distanceToPlane:jr,projectPoint:zr,projectVector:br,generalizedProjectPoint:Kr,intersectWithLine:Br,intersectWithPlane:Hr,DISJOINT:Fr,COINCIDE:Gr};function Yi(e,t){t.classHierarchy.push("vtkPlane"),e.distanceToPlane=n=>jr(n,t.origin,t.normal),e.projectPoint=(n,r)=>{zr(n,t.origin,t.normal,r)},e.projectVector=(n,r)=>br(n,t.normal,r),e.push=n=>{if(n!==0)for(let r=0;r<3;r++)t.origin[r]+=n*t.normal[r]},e.generalizedProjectPoint=(n,r)=>{Kr(n,t.origin,t.normal,r)},e.evaluateFunction=(n,r,s)=>Array.isArray(n)?t.normal[0]*(n[0]-t.origin[0])+t.normal[1]*(n[1]-t.origin[1])+t.normal[2]*(n[2]-t.origin[2]):t.normal[0]*(n-t.origin[0])+t.normal[1]*(r-t.origin[1])+t.normal[2]*(s-t.origin[2]),e.evaluateGradient=n=>[t.normal[0],t.normal[1],t.normal[2]],e.intersectWithLine=(n,r)=>Br(n,r,t.origin,t.normal),e.intersectWithPlane=(n,r)=>Hr(n,r,t.origin,t.normal)}const Pi={normal:[0,0,1],origin:[0,0,0]};function Wr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Pi,n),Bi.extend(e,t,n),x.setGetArray(e,t,["normal","origin"],3),Yi(e,t)}const Xi=x.newInstance(Wr,"vtkPlane");var ft={newInstance:Xi,extend:Wr,...Wi};const ae=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Yr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function tt(e){return(e==null?void 0:e.length)>=6&&e[0]<=e[1]&&e[2]<=e[3]&&e[4]<=e[5]}function Be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function He(e){return Be(e,ae)}function Ht(e,t,n,r){const[s,a,i,c,o,u]=e;return e[0]=s<t?s:t,e[1]=a>t?a:t,e[2]=i<n?i:n,e[3]=c>n?c:n,e[4]=o<r?o:r,e[5]=u>r?u:r,e}function We(e,t){if(t.length===0)return e;if(Array.isArray(t[0]))for(let n=0;n<t.length;++n)Ht(e,...t[n]);else for(let n=0;n<t.length;n+=3)Ht(e,...t.slice(n,n+3));return e}function Pr(e,t,n,r,s,a,i){const[c,o,u,f,l,g]=e;return i===void 0?(e[0]=Math.min(t[0],c),e[1]=Math.max(t[1],o),e[2]=Math.min(t[2],u),e[3]=Math.max(t[3],f),e[4]=Math.min(t[4],l),e[5]=Math.max(t[5],g)):(e[0]=Math.min(t,c),e[1]=Math.max(n,o),e[2]=Math.min(r,u),e[3]=Math.max(s,f),e[4]=Math.min(a,l),e[5]=Math.max(i,g)),e}function Xr(e,t,n,r){const[s,a,i,c,o,u]=e;return e[0]=t,e[1]=t>a?t:a,e[2]=n,e[3]=n>c?n:c,e[4]=r,e[5]=r>u?r:u,s!==t||i!==n||o!==r}function Jr(e,t,n,r){const[s,a,i,c,o,u]=e;return e[0]=t<s?t:s,e[1]=t,e[2]=n<i?n:i,e[3]=n,e[4]=r<o?r:o,e[5]=r,a!==t||c!==n||u!==r}function Qr(e,t){return e[0]-=t,e[1]+=t,e[2]-=t,e[3]+=t,e[4]-=t,e[5]+=t,e}function Ye(e,t,n,r){return tt(e)?(t>=0?(e[0]*=t,e[1]*=t):(e[0]=t*e[1],e[1]=t*e[0]),n>=0?(e[2]*=n,e[3]*=n):(e[2]=n*e[3],e[3]=n*e[2]),r>=0?(e[4]*=r,e[5]*=r):(e[4]=r*e[5],e[5]=r*e[4]),!0):!1}function Pe(e){return[.5*(e[0]+e[1]),.5*(e[2]+e[3]),.5*(e[4]+e[5])]}function Ji(e,t,n,r){if(!tt(e))return!1;const s=Pe(e);return e[0]-=s[0],e[1]-=s[0],e[2]-=s[1],e[3]-=s[1],e[4]-=s[2],e[5]-=s[2],Ye(e,t,n,r),e[0]+=s[0],e[1]+=s[0],e[2]+=s[1],e[3]+=s[1],e[4]+=s[2],e[5]+=s[2],!0}function Tt(e,t){return e[t*2+1]-e[t*2]}function ie(e){return[Tt(e,0),Tt(e,1),Tt(e,2)]}function qr(e){return e.slice(0,2)}function Zr(e){return e.slice(2,4)}function ts(e){return e.slice(4,6)}function es(e){const t=ie(e);return t[0]>t[1]?t[0]>t[2]?t[0]:t[2]:t[1]>t[2]?t[1]:t[2]}function ns(e){if(tt(e)){const t=ie(e);return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}return null}function Xe(e){return[e[0],e[2],e[4]]}function Je(e){return[e[1],e[3],e[5]]}function St(e,t){return e<=0&&t>=0||e>=0&&t<=0}function Qe(e,t){let n=0;for(let r=0;r<2;r++)for(let s=2;s<4;s++)for(let a=4;a<6;a++)t[n++]=[e[r],e[s],e[a]];return t}function rs(e,t,n){return t[0]=e[0],t[1]=e[2],t[2]=e[4],n[0]=e[1],n[1]=e[3],n[2]=e[5],t}function ss(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=Qe(e,[]);for(let s=0;s<r.length;++s)we(r[s],r[s],t);return He(n),We(n,r)}function as(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=.5*(e[1]-e[0]),t[1]=.5*(e[3]-e[2]),t[2]=.5*(e[5]-e[4]),t}function is(e,t,n,r){const s=[].concat(ae),a=e.getData();for(let i=0;i<a.length;i+=3){const c=[a[i],a[i+1],a[i+2]],o=R(c,t);s[0]=Math.min(o,s[0]),s[1]=Math.max(o,s[1]);const u=R(c,n);s[2]=Math.min(u,s[2]),s[3]=Math.max(u,s[3]);const f=R(c,r);s[4]=Math.min(f,s[4]),s[5]=Math.max(f,s[5])}return s}function os(e,t,n,r,s){let a=!0;const i=[];let c=0;const o=[],u=[0,0,0],f=0,l=1,g=2;for(let h=0;h<3;h++)t[h]<e[2*h]?(i[h]=l,u[h]=e[2*h],a=!1):t[h]>e[2*h+1]?(i[h]=f,u[h]=e[2*h+1],a=!1):i[h]=g;if(a)return r[0]=t[0],r[1]=t[1],r[2]=t[2],s[0]=0,1;for(let h=0;h<3;h++)i[h]!==g&&n[h]!==0?o[h]=(u[h]-t[h])/n[h]:o[h]=-1;for(let h=0;h<3;h++)o[c]<o[h]&&(c=h);if(o[c]>1||o[c]<0)return 0;s[0]=o[c];for(let h=0;h<3;h++)if(c!==h){if(r[h]=t[h]+o[c]*n[h],r[h]<e[2*h]||r[h]>e[2*h+1])return 0}else r[h]=u[h];return 1}function cs(e,t,n){const r=[];let s=0,a=1,i=1;for(let c=4;c<=5;++c){r[2]=e[c];for(let o=2;o<=3;++o){r[1]=e[o];for(let u=0;u<=1;++u)if(r[0]=e[u],s=ft.evaluate(n,t,r),i&&(a=s>=0?1:-1,i=0),s===0||a>0&&s<0||a<0&&s>0)return 1}}return 0}function us(e,t){if(!(tt(e)&&tt(t)))return!1;const n=[0,0,0,0,0,0];let r;for(let s=0;s<3;s++)if(r=!1,t[s*2]>=e[s*2]&&t[s*2]<=e[s*2+1]?(r=!0,n[s*2]=t[s*2]):e[s*2]>=t[s*2]&&e[s*2]<=t[s*2+1]&&(r=!0,n[s*2]=e[s*2]),t[s*2+1]>=e[s*2]&&t[s*2+1]<=e[s*2+1]?(r=!0,n[s*2+1]=t[2*s+1]):e[s*2+1]>=t[s*2]&&e[s*2+1]<=t[s*2+1]&&(r=!0,n[s*2+1]=e[s*2+1]),!r)return!1;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],!0}function Wt(e,t){if(!(tt(e)&&tt(t)))return!1;for(let n=0;n<3;n++)if(!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1]))return!1;return!0}function Yt(e,t,n,r){return!(t<e[0]||t>e[1]||n<e[2]||n>e[3]||r<e[4]||r>e[5])}function Qi(e,t){return!(!Wt(e,t)||!Yt(e,...Xe(t))||!Yt(e,...Je(t)))}function fs(e,t,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],s=[0,0,0,0,0,0,0,0];let a=0;for(let l=0;l<2;l++)for(let g=2;g<4;g++)for(let h=4;h<6;h++){const y=[e[l],e[g],e[h]];s[a++]=ft.evaluate(n,t,y)}let i=2;for(;i--&&!(St(s[r[i][0]],s[r[i][4]])&&St(s[r[i][1]],s[r[i][5]])&&St(s[r[i][2]],s[r[i][6]])&&St(s[r[i][3]],s[r[i][7]])););if(i<0)return!1;const c=Math.sign(n[i]),o=Math.abs((e[i*2+1]-e[i*2])*n[i]);let u=c>0?1:0;for(let l=0;l<4;l++){if(o===0)continue;const g=Math.abs(s[r[i][l]])/o;c>0&&g<u&&(u=g),c<0&&g>u&&(u=g)}const f=(1-u)*e[i*2]+u*e[i*2+1];return c>0?e[i*2]=f:e[i*2+1]=f,!0}class qi{constructor(t){this.bounds=t,this.bounds||(this.bounds=new Float64Array(ae))}getBounds(){return this.bounds}equals(t){return Yr(this.bounds,t)}isValid(){return tt(this.bounds)}setBounds(t){return Be(this.bounds,t)}reset(){return He(this.bounds)}addPoint(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Ht(this.bounds,...n)}addPoints(t){return We(this.bounds,t)}addBounds(t,n,r,s,a,i){return Pr(this.bounds,t,n,r,s,a,i)}setMinPoint(t,n,r){return Xr(this.bounds,t,n,r)}setMaxPoint(t,n,r){return Jr(this.bounds,t,n,r)}inflate(t){return Qr(this.bounds,t)}scale(t,n,r){return Ye(this.bounds,t,n,r)}getCenter(){return Pe(this.bounds)}getLength(t){return Tt(this.bounds,t)}getLengths(){return ie(this.bounds)}getMaxLength(){return es(this.bounds)}getDiagonalLength(){return ns(this.bounds)}getMinPoint(){return Xe(this.bounds)}getMaxPoint(){return Je(this.bounds)}getXRange(){return qr(this.bounds)}getYRange(){return Zr(this.bounds)}getZRange(){return ts(this.bounds)}getCorners(t){return Qe(this.bounds,t)}computeCornerPoints(t,n){return rs(this.bounds,t,n)}computeLocalBounds(t,n,r){return is(this.bounds,t,n,r)}transformBounds(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ss(this.bounds,t,n)}computeScale3(t){return as(this.bounds,t)}cutWithPlane(t,n){return fs(this.bounds,t,n)}intersectBox(t,n,r,s){return os(this.bounds,t,n,r,s)}intersectPlane(t,n){return cs(this.bounds,t,n)}intersect(t){return us(this.bounds,t)}intersects(t){return Wt(this.bounds,t)}containsPoint(t,n,r){return Yt(this.bounds,t,n,r)}contains(t){return Wt(this.bounds,t)}}function Zi(e){const t=e&&e.bounds;return new qi(t)}const to={equals:Yr,isValid:tt,setBounds:Be,reset:He,addPoint:Ht,addPoints:We,addBounds:Pr,setMinPoint:Xr,setMaxPoint:Jr,inflate:Qr,scale:Ye,scaleAboutCenter:Ji,getCenter:Pe,getLength:Tt,getLengths:ie,getMaxLength:es,getDiagonalLength:ns,getMinPoint:Xe,getMaxPoint:Je,getXRange:qr,getYRange:Zr,getZRange:ts,getCorners:Qe,computeCornerPoints:rs,computeLocalBounds:is,transformBounds:ss,computeScale3:as,cutWithPlane:fs,intersectBox:os,intersectPlane:cs,intersect:us,intersects:Wt,containsPoint:Yt,contains:Qi,INIT_BOUNDS:ae};var yt={newInstance:Zi,...to};const W={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var ls={StructuredType:W};const{StructuredType:J}=ls;function eo(e){let t=0;for(let n=0;n<3;++n)e[n*2]<e[n*2+1]&&t++;return e[0]>e[1]||e[2]>e[3]||e[4]>e[5]?J.EMPTY:t===3?J.XYZ_GRID:t===2?e[0]===e[1]?J.YZ_PLANE:e[2]===e[3]?J.XZ_PLANE:J.XY_PLANE:t===1?e[0]<e[1]?J.X_LINE:e[2]<e[3]?J.Y_LINE:J.Z_LINE:J.SINGLE_POINT}var no={getDataDescriptionFromExtent:eo,...ls};const{vtkErrorMacro:it}=x;function ro(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return it("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const i=t.extent.some((c,o)=>c!==a[o]);return i&&(t.extent=a.slice(),t.dataDescription=no.getDataDescriptionFromExtent(t.extent),e.modified()),i},e.setDimensions=function(){let n,r,s;if(t.deleted){it("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],s=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],s=arguments.length<=2?void 0:arguments[2];else{it("Bad dimension specification");return}e.setExtent(0,n-1,0,r-1,0,s-1)},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const n=e.getDimensions();let r=1;for(let s=0;s<3;s++){if(n[s]===0)return 0;n[s]>1&&(r*=n[s]-1)}return r},e.getNumberOfPoints=()=>{const n=e.getDimensions();return n[0]*n[1]*n[2]},e.getPoint=n=>{const r=e.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return it("Requesting a point from an empty image."),null;const s=new Float64Array(3);switch(t.dataDescription){case W.EMPTY:return null;case W.SINGLE_POINT:break;case W.X_LINE:s[0]=n;break;case W.Y_LINE:s[1]=n;break;case W.Z_LINE:s[2]=n;break;case W.XY_PLANE:s[0]=n%r[0],s[1]=n/r[0];break;case W.YZ_PLANE:s[1]=n%r[1],s[2]=n/r[1];break;case W.XZ_PLANE:s[0]=n%r[0],s[2]=n/r[0];break;case W.XYZ_GRID:s[0]=n%r[0],s[1]=n/r[0]%r[1],s[2]=n/(r[0]*r[1]);break;default:it("Invalid dataDescription");break}const a=[0,0,0];return e.indexToWorld(s,a),a},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=n=>yt.transformBounds(n,t.indexToWorld),e.getSpatialExtent=()=>yt.inflate([...t.extent],.5),e.computeTransforms=()=>{li(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],fi(t.indexToWorld,t.indexToWorld,t.spacing),ui(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return we(r,n,t.indexToWorld),r},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return we(r,n,t.worldToIndex),r},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return yt.transformBounds(n,t.indexToWorld,r)},e.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return yt.transformBounds(n,t.worldToIndex,r)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>yt.getCenter(e.getBounds()),e.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const s=[0,0,0,0,0,0];e.worldToIndexBounds(n,s);const a=[0,0,0],i=[0,0,0];yt.computeCornerPoints(s,a,i),En(a,a),En(i,i);const c=e.getDimensions();pn(a,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],a),pn(i,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],i);const o=c[0],u=c[0]*c[1],f=e.getPointData().getScalars().getData();let l=-1/0,g=1/0,h=0,y=0,d=0;for(let m=a[2];m<=i[2];m++)for(let p=a[1];p<=i[1];p++){let O=a[0]+p*o+m*u;for(let T=a[0];T<=i[0];T++){if(!r||r([T,p,m],s)){const w=f[O];w>l&&(l=w),w<g&&(g=w),h+=w*w,y+=w,d+=1}++O}}const E=d>0?y/d:0,_=d?Math.abs(h/d-E*E):0,C=Math.sqrt(_);return{minimum:g,maximum:l,average:E,variance:_,sigma:C,count:d}},e.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=[];let a=r;for(let i=0;i<3;++i)s[i]=a,a*=n[i*2+1]-n[i*2]+1;return s},e.computeOffsetIndex=n=>{let[r,s,a]=n;const i=e.getExtent(),c=e.getPointData().getScalars().getNumberOfComponents(),o=e.computeIncrements(i,c);return Math.floor((Math.round(r)-i[0])*o[0]+(Math.round(s)-i[2])*o[1]+(Math.round(a)-i[4])*o[2])},e.getOffsetIndexFromWorld=n=>{const r=e.getExtent(),s=e.worldToIndex(n);for(let a=0;a<3;++a)if(s[a]<r[a*2]||s[a]>r[a*2+1])return it(`GetScalarPointer: Pixel ${s} is not in memory. Current extent = ${r}`),NaN;return e.computeOffsetIndex(s)},e.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const s=e.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=s)return it(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${s}`),NaN;const a=e.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:e.getPointData().getScalars().getComponent(a,r)}}const so={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:W.EMPTY};function gs(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,so,n),$r.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=ci(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),x.get(e,t,["indexToWorld","worldToIndex"]),x.setGetArray(e,t,["origin","spacing"],3),x.setGetArray(e,t,["direction"],9),x.getArray(e,t,["extent"],6),ro(e,t)}const ao=x.newInstance(gs,"vtkImageData");var vt={newInstance:ao,extend:gs};const{vtkErrorMacro:io}=x,oo=[1,-1,1,-1,1,-1];function co(e,t){t.classHierarchy.push("vtkPoints"),e.getNumberOfPoints=e.getNumberOfTuples,e.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;e.getNumberOfPoints()!==n&&(t.size=n*r,t.values=x.newTypedArray(t.dataType,t.size),e.setNumberOfComponents(r),e.modified())},e.setPoint=function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];e.setTuple(n,s)},e.getPoint=e.getTuple,e.findPoint=e.findTuple,e.insertNextPoint=(n,r,s)=>e.insertNextTuple([n,r,s]),e.getBounds=()=>{if(e.getNumberOfComponents()===3){const s=e.getRange(0);t.bounds[0]=s[0],t.bounds[1]=s[1];const a=e.getRange(1);t.bounds[2]=a[0],t.bounds[3]=a[1];const i=e.getRange(2);return t.bounds[4]=i[0],t.bounds[5]=i[1],t.bounds}if(e.getNumberOfComponents()!==2)return io(`getBounds called on an array with components of
        ${e.getNumberOfComponents()}`),oo;const n=e.getRange(0);t.bounds[0]=n[0],t.bounds[1]=n[1];const r=e.getRange(1);return t.bounds[2]=r[0],t.bounds[3]=r[1],t.bounds[4]=0,t.bounds[5]=0,t.bounds},e.computeBounds=e.getBounds,e.setNumberOfComponents(t.numberOfComponents<2?3:t.numberOfComponents)}const uo={empty:!0,numberOfComponents:3,dataType:se.FLOAT,bounds:[1,-1,1,-1,1,-1]};function hs(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,uo,n),q.extend(e,t,n),co(e,t)}const fo=x.newInstance(hs,"vtkPoints");var ve={newInstance:fo,extend:hs};function ys(e){let t=0;return e.filter((n,r)=>r===t?(t+=n+1,!0):!1)}function ds(e){let t=0;for(let n=0;n<e.length;)n+=e[n]+1,t++;return t}const lo={extractCellSizes:ys,getNumberOfCells:ds};function go(e,t){t.classHierarchy.push("vtkCellArray");const n={...e};e.getNumberOfCells=r=>(t.numberOfCells!==void 0&&!r||(t.cellSizes?t.numberOfCells=t.cellSizes.length:t.numberOfCells=ds(e.getData())),t.numberOfCells),e.getCellSizes=r=>(t.cellSizes!==void 0&&!r||(t.cellSizes=ys(e.getData())),t.cellSizes),e.resize=r=>{const s=e.getNumberOfTuples();n.resize(r);const a=e.getNumberOfTuples();a<s&&(a===0?(t.numberOfCells=0,t.cellSizes=[]):(t.numberOfCells=void 0,t.cellSizes=void 0))},e.setData=r=>{n.setData(r,1),t.numberOfCells=void 0,t.cellSizes=void 0},e.getCell=r=>{let s=r;const a=t.values[s++];return t.values.subarray(s,s+a)},e.insertNextCell=r=>{const s=e.getNumberOfCells();return e.insertNextTuples([r.length,...r]),++t.numberOfCells,t.cellSizes!=null&&t.cellSizes.push(r.length),s}}function ho(e){return{empty:!0,numberOfComponents:1,dataType:se.UNSIGNED_INT,...e}}function ms(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};q.extend(e,t,ho(n)),go(e,t)}const yo=x.newInstance(ms,"vtkCellArray");var wn={newInstance:yo,extend:ms,...lo};function mo(e,t){t.classHierarchy.push("vtkCell"),e.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){t.pointsIds=r;let s=t.points.getData();s.length!==3*t.pointsIds.length&&(s=x.newTypedArray(n.getDataType(),3*t.pointsIds.length));const a=n.getData();t.pointsIds.forEach((i,c)=>{let o=3*i,u=3*c;s[u]=a[o],s[++u]=a[++o],s[++u]=a[++o]}),t.points.setData(s)}else{t.points=n,t.pointsIds=new Array(n.getNumberOfPoints());for(let s=n.getNumberOfPoints()-1;s>=0;--s)t.pointsIds[s]=s}},e.getBounds=()=>{const n=t.points.getNumberOfPoints(),r=[];if(n){t.points.getPoint(0,r),t.bounds[0]=r[0],t.bounds[1]=r[0],t.bounds[2]=r[1],t.bounds[3]=r[1],t.bounds[4]=r[2],t.bounds[5]=r[2];for(let s=1;s<n;s++)t.points.getPoint(s,r),t.bounds[0]=r[0]<t.bounds[0]?r[0]:t.bounds[0],t.bounds[1]=r[0]>t.bounds[1]?r[0]:t.bounds[1],t.bounds[2]=r[1]<t.bounds[2]?r[1]:t.bounds[2],t.bounds[3]=r[1]>t.bounds[3]?r[1]:t.bounds[3],t.bounds[4]=r[2]<t.bounds[4]?r[2]:t.bounds[4],t.bounds[5]=r[2]>t.bounds[5]?r[2]:t.bounds[5]}else Qa(t.bounds);return t.bounds},e.getLength2=()=>{e.getBounds();let n=0,r=0;for(let s=0;s<3;s++)r=t.bounds[2*s+1]-t.bounds[2*s],n+=r*r;return n},e.getParametricDistance=n=>{let r,s=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>s&&(s=r);return s},e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.deepCopy=n=>{n.initialize(t.points,t.pointsIds)},e.getCellDimension=()=>{},e.intersectWithLine=(n,r,s,a,i,c,o)=>{},e.evaluatePosition=(n,r,s,a,i,c)=>{x.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const Eo={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Es(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Eo,n),x.obj(e,t),t.points||(t.points=ve.newInstance()),x.get(e,t,["points","pointsIds"]),mo(e,t)}const po=x.newInstance(Es,"vtkCell");var Pt={newInstance:po,extend:Es};function Co(e,t){let n=t;for(t>=e.array.length&&(n+=e.array.length);n>e.array.length;)e.array.push({ncells:0,cells:null});e.array.length=n}function To(e,t){t.classHierarchy.push("vtkCellLinks"),e.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),s=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let i=0;i<s;++i){const{cellPointIds:c}=n.getCellPoints(i);c.forEach(o=>{e.incrementLinkCount(o)})}e.allocateLinks(r),t.maxId=r-1;for(let i=0;i<s;++i){const{cellPointIds:c}=n.getCellPoints(i);c.forEach(o=>{e.insertCellReference(o,a[o]++,i)})}}else{for(let i=0;i<s;i++)Pt.newInstance().getPointsIds().forEach(o=>{e.incrementLinkCount(o)});e.allocateLinks(r),t.maxId=r-1;for(let i=0;i<s;++i)Pt.newInstance().getPointsIds().forEach(o=>{e.insertCellReference(o,a[o]++,i)})}},e.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;t.array=Array(n).fill().map(()=>({ncells:0,cells:null})),t.extend=r,t.maxId=-1},e.initialize=()=>{t.array=null},e.getLink=n=>t.array[n],e.getNcells=n=>t.array[n].ncells,e.getCells=n=>t.array[n].cells,e.insertNextPoint=n=>{t.array.push({ncells:n,cells:Array(n)}),++t.maxId},e.insertNextCellReference=(n,r)=>{t.array[n].cells[t.array[n].ncells++]=r},e.deletePoint=n=>{t.array[n].ncells=0,t.array[n].cells=null},e.removeCellReference=(n,r)=>{t.array[r].cells=t.array[r].cells.filter(s=>s!==n),t.array[r].ncells=t.array[r].cells.length},e.addCellReference=(n,r)=>{t.array[r].cells[t.array[r].ncells++]=n},e.resizeCellList=(n,r)=>{t.array[n].cells.length=r},e.squeeze=()=>{Co(t,t.maxId+1)},e.reset=()=>{t.maxId=-1},e.deepCopy=n=>{t.array=[...n.array],t.extend=n.extend,t.maxId=n.maxId},e.incrementLinkCount=n=>{++t.array[n].ncells},e.allocateLinks=n=>{for(let r=0;r<n;++r)t.array[r].cells=new Array(t.array[r].ncells)},e.insertCellReference=(n,r,s)=>{t.array[n].cells[r]=s}}const Oo={array:null,maxId:0,extend:0};function ps(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Oo,n),x.obj(e,t),To(e,t)}const _o=x.newInstance(ps,"vtkCellLinks");var wo={newInstance:_o,extend:ps};const k={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Le=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function Do(e){return e<Le.length?Le[e]:"UnknownClass"}function So(e){return Le.findIndex(e)}function vo(e){return e<k.VTK_QUADRATIC_EDGE||e===k.VTK_CONVEX_POINT_SET||e===k.VTK_POLYHEDRON}function Lo(e){return e===k.VTK_TRIANGLE_STRIP||e===k.VTK_POLY_LINE||e===k.VTK_POLY_VERTEX}const xo={getClassNameFromTypeId:Do,getTypeIdFromClassName:So,isLinear:vo,hasSubCells:Lo};function Mo(e,t){t.classHierarchy.push("vtkCellTypes"),e.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;t.size=n>0?n:1,t.extend=r>0?r:1,t.maxId=-1,t.typeArray=new Uint8Array(n),t.locationArray=new Uint32Array(n)},e.insertCell=(n,r,s)=>{t.typeArray[n]=r,t.locationArray[n]=s,n>t.maxId&&(t.maxId=n)},e.insertNextCell=(n,r)=>(e.insertCell(++t.maxId,n,r),t.maxId),e.setCellTypes=(n,r,s)=>{t.size=n,t.typeArray=r,t.locationArray=s,t.maxId=n-1},e.getCellLocation=n=>t.locationArray[n],e.deleteCell=n=>{t.typeArray[n]=k.VTK_EMPTY_CELL},e.getNumberOfTypes=()=>t.maxId+1,e.isType=n=>{const r=e.getNumberOfTypes();for(let s=0;s<r;++s)if(n===e.getCellType(s))return!0;return!1},e.insertNextType=n=>e.insertNextCell(n,-1),e.getCellType=n=>t.typeArray[n],e.reset=()=>{t.maxId=-1},e.deepCopy=n=>{e.allocate(n.getSize(),n.getExtend()),t.typeArray.set(n.getTypeArray()),t.locationArray.set(n.getLocationArray()),t.maxId=n.getMaxId()}}const Io={size:0,maxId:-1,extend:1e3};function Cs(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Io,n),x.obj(e,t),x.get(e,t,["size","maxId","extend"]),x.getArray(e,t,["typeArray","locationArray"]),Mo(e,t)}const No=x.newInstance(Cs,"vtkCellTypes");var Ro={newInstance:No,extend:Cs,...xo};const Ao={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var Ts={IntersectionState:Ao};const{IntersectionState:Ut}=Ts;function mt(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const s={t:Number.MIN_VALUE,distance:0},a=[];let i;a[0]=n[0]-t[0],a[1]=n[1]-t[1],a[2]=n[2]-t[2];const c=a[0]*(e[0]-t[0])+a[1]*(e[1]-t[1])+a[2]*(e[2]-t[2]),o=R(a,a);let u=1e-5*c;return o!==0&&(s.t=c/o),u<0&&(u=-u),-u<o&&o<u||o<=0||s.t<0?i=t:s.t>1?i=n:(i=a,a[0]=t[0]+s.t*a[0],a[1]=t[1]+s.t*a[1],a[2]=t[2]+s.t*a[2]),r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2]),s.distance=Q(i,e),s}function Os(e,t,n,r,s,a){const i=[],c=[],o=[];s[0]=0,a[0]=0,rt(t,e,i),rt(r,n,c),rt(n,e,o);const u=[R(i,i),-R(i,c),-R(i,c),R(c,c)],f=[];if(f[0]=R(i,o),f[1]=-R(c,o),Ja(u,f,2)===0){let l=Number.MAX_VALUE;const g=[e,t,n,r],h=[n,n,e,e],y=[r,r,t,t];a[0],a[0],s[0],s[0],s[0],s[0],a[0],a[0];let d;for(let E=0;E<4;E++)d=mt(g[E],h[E],y[E]),d.distance<l&&(l=d.distance);return Ut.ON_LINE}return s[0]=f[0],a[0]=f[1],s[0]>=0&&s[0]<=1&&a[0]>=0&&a[0]<=1?Ut.YES_INTERSECTION:Ut.NO_INTERSECTION}const Vo={distanceToLine:mt,intersection:Os};function ko(e,t){t.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}e.getCellDimension=()=>1,e.intersectWithLine=(r,s,a,i,c)=>{const o={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};c[1]=0,c[2]=0;const u=[],f=[],l=[];t.points.getPoint(0,f),t.points.getPoint(1,l);const g=[],h=[],y=Os(r,s,f,l,g,h);if(o.t=g[0],o.betweenPoints=n(o.t),c[0]=h[0],y===Ut.YES_INTERSECTION){for(let d=0;d<3;d++)i[d]=f[d]+c[0]*(l[d]-f[d]),u[d]=r[d]+o.t*(s[d]-r[d]);if(Q(i,u)<=a*a)return o.intersect=1,o}else{let d;if(o.t<0)return d=mt(r,f,l,i),d.distance<=a*a&&(o.t=0,o.intersect=1,o.betweenPoints=!0),o;if(o.t>1)return d=mt(s,f,l,i),d.distance<=a*a&&(o.t=1,o.intersect=1,o.betweenPoints=!0),o;if(c[0]<0)return c[0]=0,d=mt(f,r,s,i),o.t=d.t,d.distance<=a*a&&(o.intersect=1),o;if(c[0]>1)return c[0]=1,d=mt(l,r,s,i),o.t=d.t,d.distance<=a*a&&(o.intersect=1),o}return o},e.evaluateLocation=(r,s,a)=>{const i=[],c=[];t.points.getPoint(0,i),t.points.getPoint(1,c);for(let o=0;o<3;o++)s[o]=i[o]+r[0]*(c[o]-i[o]);a[0]=1-r[0],a[1]=r[0]},e.evaluateOrientation=(r,s,a)=>t.orientations?($t(s,t.orientations[0],t.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const $o={orientations:null};function _s(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,$o,n),Pt.extend(e,t,n),x.setGet(e,t,["orientations"]),ko(e,t)}const Uo=x.newInstance(_s,"vtkLine");var b={newInstance:Uo,extend:_s,...Vo,...Ts};function Go(e,t){t.classHierarchy.push("vtkPointSet"),t.points?t.points=P(t.points):t.points=ve.newInstance(),e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.getBounds=()=>t.points.getBounds(),e.computeBounds=()=>{e.getBounds()};const n=e.shallowCopy;e.shallowCopy=function(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,s),t.points=ve.newInstance(),t.points.shallowCopy(r.getPoints())}}const Fo={};function ws(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Fo,n),$r.extend(e,t,n),x.setGet(e,t,["points"]),Go(e,t)}const jo=x.newInstance(ws,"vtkPointSet");var zo={newInstance:jo,extend:ws};function qe(e,t,n,r){const s=n[0]-t[0],a=n[1]-t[1],i=n[2]-t[2],c=e[0]-t[0],o=e[1]-t[1],u=e[2]-t[2];r[0]=a*u-i*o,r[1]=i*c-s*u,r[2]=s*o-a*c}function Xt(e,t,n,r){qe(e,t,n,r);const s=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);s!==0&&(r[0]/=s,r[1]/=s,r[2]/=s)}function bo(e,t,n,r,s,a){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,c=!1;const o=[],u=[],f=[],l=[],g=[];Xt(e,t,n,l),Xt(r,s,a,g);const h=-R(l,e),y=-R(g,r),d=[R(g,e)+y,R(g,t)+y,R(g,n)+y];if(d[0]*d[1]>i&&d[0]*d[2]>i)return{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f};const E=[R(l,r)+h,R(l,s)+h,R(l,a)+h];if(E[0]*E[1]>i&&E[0]*E[2]>i)return{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f};if(Math.abs(l[0]-g[0])<1e-9&&Math.abs(l[1]-g[1])<1e-9&&Math.abs(l[2]-g[2])<1e-9&&Math.abs(h-y)<1e-9)return c=!0,{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f};const _=[e,t,n],C=[r,s,a],m=R(l,g),p=(h-y*m)/(m*m-1),O=(y-h*m)/(m*m-1),T=[p*l[0]+O*g[0],p*l[1]+O*g[1],p*l[2]+O*g[2]],w=Sr(l,g,[]);Ya(w);let D=0,L=0;const v=[],S=[];let N=50,I=50;for(let A=0;A<3;A++){const B=A,pt=(A+1)%3,lt=ft.intersectWithLine(_[B],_[pt],r,g);lt.intersection&&lt.t>0-i&&lt.t<1+i&&(lt.t<1+i&&lt.t>1-i&&(N=D),v[D++]=R(lt.x,w)-R(T,w));const gt=ft.intersectWithLine(C[B],C[pt],e,l);gt.intersection&&gt.t>0-i&&gt.t<1+i&&(gt.t<1+i&&gt.t>1-i&&(I=L),S[L++]=R(gt.x,w)-R(T,w))}if(D>2){D--;const A=v[2];v[2]=v[N],v[N]=A}if(L>2){L--;const A=S[2];S[2]=S[I],S[I]=A}if(D!==2||L!==2)return{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f};if(Number.isNaN(v[0])||Number.isNaN(v[1])||Number.isNaN(S[0])||Number.isNaN(S[1]))return{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f};if(v[0]>v[1]){const A=v[1];v[1]=v[0],v[0]=A}if(S[0]>S[1]){const A=S[1];S[1]=S[0],S[0]=A}let M,U;return v[1]<S[0]||S[1]<v[0]?{intersect:!1,coplanar:c,pt1:o,pt2:u,surfaceId:f}:(v[0]<S[0]?v[1]<S[1]?(f[0]=2,f[1]=1,M=S[0],U=v[1]):(f[0]=2,f[1]=2,M=S[0],U=S[1]):v[1]<S[1]?(f[0]=1,f[1]=1,M=v[0],U=v[1]):(f[0]=1,f[1]=2,M=v[0],U=S[1]),mn(T,w,M,o),mn(T,w,U,u),{intersect:!0,coplanar:c,pt1:o,pt2:u,surfaceId:f})}const Ko={computeNormalDirection:qe,computeNormal:Xt,intersectWithTriangle:bo};function Bo(e,t){t.classHierarchy.push("vtkTriangle"),e.getCellDimension=()=>2,e.intersectWithLine=(n,r,s,a,i)=>{const c={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;const o=[],u=s*s,f=[],l=[],g=[];t.points.getPoint(0,f),t.points.getPoint(1,l),t.points.getPoint(2,g);const h=[],y=[];if(Xt(f,l,g,h),h[0]!==0||h[1]!==0||h[2]!==0){const m=ft.intersectWithLine(n,r,f,h);if(c.betweenPoints=m.betweenPoints,c.t=m.t,a[0]=m.x[0],a[1]=m.x[1],a[2]=m.x[2],!m.intersection)return i[0]=0,i[1]=0,c.intersect=0,c;const p=e.evaluatePosition(a,o,i,y);if(p.evaluation>=0)return p.dist2<=u?(c.intersect=1,c):(c.intersect=p.evaluation,c)}const d=Q(f,l),E=Q(l,g),_=Q(g,f);t.line||(t.line=b.newInstance()),d>E&&d>_?(t.line.getPoints().setPoint(0,f),t.line.getPoints().setPoint(1,l)):E>_&&E>d?(t.line.getPoints().setPoint(0,l),t.line.getPoints().setPoint(1,g)):(t.line.getPoints().setPoint(0,g),t.line.getPoints().setPoint(1,f));const C=t.line.intersectWithLine(n,r,s,a,i);if(c.betweenPoints=C.betweenPoints,c.t=C.t,C.intersect){const m=[],p=[],O=[];for(let T=0;T<3;T++)m[T]=f[T]-g[T],p[T]=l[T]-g[T],O[T]=a[T]-g[T];return i[0]=R(O,m)/_,i[1]=R(O,p)/E,c.intersect=1,c}return i[0]=0,i[1]=0,c.intersect=0,c},e.evaluatePosition=(n,r,s,a)=>{const i={subId:0,dist2:0,evaluation:-1};let c,o;const u=[],f=[],l=[],g=[];let h;const y=[],d=[],E=[];let _=0,C=0;const m=[];let p,O,T,w=[];const D=[],L=[],v=[];i.subId=0,s[2]=0,t.points.getPoint(1,u),t.points.getPoint(2,f),t.points.getPoint(0,l),qe(u,f,l,g),ft.generalizedProjectPoint(n,u,g,v);let S=0;for(c=0;c<3;c++)g[c]<0?h=-g[c]:h=g[c],h>S&&(S=h,C=c);for(o=0,c=0;c<3;c++)c!==C&&(m[o++]=c);for(c=0;c<2;c++)y[c]=v[m[c]]-l[m[c]],d[c]=u[m[c]]-l[m[c]],E[c]=f[m[c]]-l[m[c]];if(_=kt(d,E),_===0)return s[0]=0,s[1]=0,i.evaluation=-1,i;if(s[0]=kt(y,E)/_,s[1]=kt(d,y)/_,a[0]=1-(s[0]+s[1]),a[1]=s[0],a[2]=s[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(i.dist2=Q(v,n),r[0]=v[0],r[1]=v[1],r[2]=v[2]),i.evaluation=1;else{let N;if(r){if(a[1]<0&&a[2]<0)for(p=Q(n,l),O=b.distanceToLine(n,u,l,N,D),T=b.distanceToLine(n,l,f,N,L),p<O?(i.dist2=p,w=l):(i.dist2=O,w=D),T<i.dist2&&(i.dist2=T,w=L),c=0;c<3;c++)r[c]=w[c];else if(a[2]<0&&a[0]<0)for(p=Q(n,u),O=b.distanceToLine(n,u,l,N,D),T=b.distanceToLine(n,u,f,N,L),p<O?(i.dist2=p,w=u):(i.dist2=O,w=D),T<i.dist2&&(i.dist2=T,w=L),c=0;c<3;c++)r[c]=w[c];else if(a[1]<0&&a[0]<0)for(p=Q(n,f),O=b.distanceToLine(n,f,l,N,D),T=b.distanceToLine(n,u,f,N,L),p<O?(i.dist2=p,w=f):(i.dist2=O,w=D),T<i.dist2&&(i.dist2=T,w=L),c=0;c<3;c++)r[c]=w[c];else if(a[0]<0){const I=b.distanceToLine(n,u,f,r);i.dist2=I.distance}else if(a[1]<0){const I=b.distanceToLine(n,f,l,r);i.dist2=I.distance}else if(a[2]<0){const I=b.distanceToLine(n,u,l,r);i.dist2=I.distance}}i.evaluation=0}return i},e.evaluateLocation=(n,r,s)=>{const a=[],i=[],c=[];t.points.getPoint(0,a),t.points.getPoint(1,i),t.points.getPoint(2,c);const o=1-n[0]-n[1];for(let u=0;u<3;u++)r[u]=a[u]*o+i[u]*n[0]+c[u]*n[1];s[0]=o,s[1]=n[0],s[2]=n[1]},e.getParametricDistance=n=>{let r,s=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let i=0;i<3;i++)a[i]<0?r=-a[i]:a[i]>1?r=a[i]-1:r=0,r>s&&(s=r);return s}}const Ho={};function Ds(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Ho,n),Pt.extend(e,t,n),Bo(e,t)}const Wo=x.newInstance(Ds,"vtkTriangle");var Yo={newInstance:Wo,extend:Ds,...Ko};const de=["verts","lines","polys","strips"],{vtkWarningMacro:Dn}=x,Po={[k.VTK_LINE]:b,[k.VTK_POLY_LINE]:b,[k.VTK_TRIANGLE]:Yo};function Xo(e,t){t.classHierarchy.push("vtkPolyData");function n(s){return s.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}de.forEach(s=>{e[`getNumberOf${n(s)}`]=()=>t[s].getNumberOfCells(),t[s]?t[s]=P(t[s]):t[s]=wn.newInstance()}),e.getNumberOfCells=()=>de.reduce((s,a)=>s+t[a].getNumberOfCells(),0);const r=e.shallowCopy;e.shallowCopy=function(s){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(s,a),de.forEach(i=>{t[i]=wn.newInstance(),t[i].shallowCopy(s.getReferenceByName(i))})},e.buildCells=()=>{const s=e.getNumberOfVerts(),a=e.getNumberOfLines(),i=e.getNumberOfPolys(),c=e.getNumberOfStrips(),o=s+a+i+c,u=new Uint8Array(o);let f=u;const l=new Uint32Array(o);let g=l;if(s){let h=0;t.verts.getCellSizes().forEach((y,d)=>{g[d]=h,f[d]=y>1?k.VTK_POLY_VERTEX:k.VTK_VERTEX,h+=y+1}),g=g.subarray(s),f=f.subarray(s)}if(a){let h=0;t.lines.getCellSizes().forEach((y,d)=>{g[d]=h,f[d]=y>2?k.VTK_POLY_LINE:k.VTK_LINE,y===1&&Dn("Building VTK_LINE ",d," with only one point, but VTK_LINE needs at least two points. Check the input."),h+=y+1}),g=g.subarray(a),f=f.subarray(a)}if(i){let h=0;t.polys.getCellSizes().forEach((y,d)=>{switch(g[d]=h,y){case 3:f[d]=k.VTK_TRIANGLE;break;case 4:f[d]=k.VTK_QUAD;break;default:f[d]=k.VTK_POLYGON;break}y<3&&Dn("Building VTK_TRIANGLE ",d," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=y+1}),g+=g.subarray(i),f+=f.subarray(i)}if(c){let h=0;f.fill(k.VTK_TRIANGLE_STRIP,0,c),t.strips.getCellSizes().forEach((y,d)=>{g[d]=h,h+=y+1})}t.cells=Ro.newInstance(),t.cells.setCellTypes(o,u,l)},e.buildLinks=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;t.cells===void 0&&e.buildCells(),t.links=wo.newInstance(),s>0?t.links.allocate(s):t.links.allocate(e.getPoints().getNumberOfPoints()),t.links.buildLinks(e)},e.getCellType=s=>t.cells.getCellType(s),e.getCellPoints=s=>{const a=e.getCellType(s);let i=null;switch(a){case k.VTK_VERTEX:case k.VTK_POLY_VERTEX:i=t.verts;break;case k.VTK_LINE:case k.VTK_POLY_LINE:i=t.lines;break;case k.VTK_TRIANGLE:case k.VTK_QUAD:case k.VTK_POLYGON:i=t.polys;break;case k.VTK_TRIANGLE_STRIP:i=t.strips;break;default:return i=null,{type:0,cellPointIds:null}}const c=t.cells.getCellLocation(s),o=i.getCell(c);return{cellType:a,cellPointIds:o}},e.getPointCells=s=>t.links.getCells(s),e.getCellEdgeNeighbors=(s,a,i)=>{const c=t.links.getLink(a),o=t.links.getLink(i);return c.cells.filter(u=>u!==s&&o.cells.indexOf(u)!==-1)},e.getCell=function(s){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=e.getCellPoints(s),c=a||Po[i.cellType].newInstance();return c.initialize(e.getPoints(),i.cellPointIds),c}}const Jo={};function Ss(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,Jo,n),zo.extend(e,t,n),x.get(e,t,["cells","links"]),x.setGet(e,t,["verts","lines","polys","strips"]),Xo(e,t)}const Qo=x.newInstance(Ss,"vtkPolyData");var Ze={newInstance:Qo,extend:Ss};function me(e){const t=e.indexOf(":");return e.substring(t+1)}const qo=1073741824;class Zo{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*qo,this._geometryCacheSize=0,this.setMaxCacheSize=t=>{if(!t||typeof t!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=t},this.isCacheable=t=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,i)=>i.sharedCacheKey?a:a+i.sizeInBytes,0);return n+r>=t},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(t,n=!1)=>{const r=this._imageCache.get(t);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:s}=r;s!=null&&s.cancelFn&&s.cancelFn(),s!=null&&s.decache&&s.decache(),this._imageCache.delete(t)},this._decacheVolume=t=>{const n=this._volumeCache.get(t);if(!n)return;const{volumeLoadObject:r,volume:s}=n;s&&(s.cancelLoading&&s.cancelLoading(),s.imageData&&s.imageData.delete(),r.cancelFn&&r.cancelFn(),s.imageIds&&s.imageIds.forEach(a=>{const i=this._imageCache.get(a);i&&i.sharedCacheKey===t&&(i.sharedCacheKey=void 0)}),this._volumeCache.delete(t))},this.purgeCache=()=>{const t=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=t.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),X(H,z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const t=this._volumeCache.keys();for(;;){const{value:n,done:r}=t.next();if(r)break;this.removeVolumeLoadObject(n),X(H,z.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=t=>{if(t===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(t);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(t,n)=>{if(t===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(t))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:t,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(t,r),n.promise.then(s=>{try{this._putGeometryCommon(t,s,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${t}:`,a),a}}).catch(s=>{throw console.debug(`Error caching geometry ${t}:`,s),this._geometryCache.delete(t),s})},this.getGeometry=t=>{if(t===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(t);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=t=>{if(t===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(t);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:t};X(H,z.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(t)},this._decacheGeometry=t=>{const n=this._geometryCache.get(t);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(t)},this.incrementGeometryCacheSize=t=>{this._geometryCacheSize+=t},this.decrementGeometryCacheSize=t=>{this._geometryCacheSize-=t},this.getImage=(t,n=zt.FAR_REPLICATE)=>{var s;if(t===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(t);if(r&&(r.timeStamp=Date.now(),!(((s=r.image)==null?void 0:s.imageQualityStatus)<n)))return r.image},this.getVolume=(t,n=!1)=>{var s;if(t===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(t);return r?(r.timeStamp=Date.now(),r.volume):n?(s=[...this._volumeCache.values()].find(a=>a.volumeId.includes(t)))==null?void 0:s.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=t=>this.getVolumes().filter(r=>r.referencedVolumeId===t),this.removeImageLoadObject=(t,{force:n=!1}={})=>{if(t===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(t);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(t,n),this.incrementImageCacheSize(-r.sizeInBytes);const s={image:r,imageId:t};X(H,z.IMAGE_CACHE_IMAGE_REMOVED,s)},this.removeVolumeLoadObject=t=>{if(t===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(t);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:t};X(H,z.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(t)},this.incrementImageCacheSize=t=>{this._imageCacheSize+=t},this.decrementImageCacheSize=t=>{this._imageCacheSize-=t},this.getGeometryLoadObject=t=>{if(t===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(t);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(t,n){let r=this.getBytesAvailable();if(r>=t)return r;const s=Array.from(this._imageCache.values()).filter(o=>!o.sharedCacheKey);function a(o,u){return o.timeStamp>u.timeStamp?1:o.timeStamp<u.timeStamp?-1:0}s.sort(a);const i=s.map(o=>o.imageId);let c=i;n&&(c=i.filter(o=>!n.includes(o)));for(const o of c)if(this.removeImageLoadObject(o),X(H,z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:o}),r=this.getBytesAvailable(),r>=t)return r;for(const o of i)if(this.removeImageLoadObject(o),X(H,z.IMAGE_CACHE_IMAGE_REMOVED,{imageId:o}),r=this.getBytesAvailable(),r>=t)return r}_putImageCommon(t,n,r){if(!this._imageCache.has(t)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(z.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const s={image:r};X(H,z.IMAGE_CACHE_IMAGE_ADDED,s),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(t,n){if(t===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(t);if(r!=null&&r.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${t} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const s={...r,loaded:!1,imageId:t,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(t,s),this._imageCache.set(t,s),n.promise.then(a=>{try{this._putImageCommon(t,a,s)}catch(i){throw console.debug(`Error in _putImageCommon for image ${t}:`,i),i}}).catch(a=>{throw console.debug(`Error caching image ${t}:`,a),this._imageCache.delete(t),a})}putImageSync(t,n){if(t===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(t))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:t,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(t,r);try{this._putImageCommon(t,n,r)}catch(s){throw this._imageCache.delete(t),s}}getImageLoadObject(t){if(t===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(t);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(t){const n=this._imageCache.get(t);return n?n.loaded:!1}getVolumeContainingImageId(t){const n=Array.from(this._volumeCache.keys()),r=me(t);for(const s of n){const a=this._volumeCache.get(s);if(!a)return;const{volume:i}=a;if(!i.imageIds.length)return;const c=i.getImageURIIndex(r);if(c>-1)return{volume:i,imageIdIndex:c}}}getCachedImageBasedOnImageURI(t){const n=me(t),s=Array.from(this._imageCache.keys()).find(a=>me(a)===n);if(s)return this._imageCache.get(s)}_putVolumeCommon(t,n,r){var a;if(!this._volumeCache.get(t)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,(a=n.imageIds)==null||a.forEach(i=>{const c=this._imageCache.get(i);c&&(c.sharedCacheKey=t)});const s={volume:r};X(H,z.VOLUME_CACHE_VOLUME_ADDED,s)}putVolumeSync(t,n){if(t===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(t))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:t,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(t,r);try{this._putVolumeCommon(t,n,r)}catch(s){throw this._volumeCache.delete(t),s}}async putVolumeLoadObject(t,n){if(t===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(t))throw new Error(`putVolumeLoadObject: volumeId:${t} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:t,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(t,r),n.promise.then(s=>{try{this._putVolumeCommon(t,s,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${t}:`,a),this._volumeCache.delete(t),a}}).catch(s=>{throw this._volumeCache.delete(t),s})}_putGeometryCommon(t,n,r){if(!this._geometryCache.get(t)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(z.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const s={geometry:r};X(H,z.GEOMETRY_CACHE_GEOMETRY_ADDED,s)}putGeometrySync(t,n){if(t===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(t))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:t,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(t,r);try{this._putGeometryCommon(t,n,r)}catch(s){throw this._geometryCache.delete(t),s}}setPartialImage(t,n){const r=this._imageCache.get(t);if(!r){n&&this._imageCache.set(t,{image:n,imageId:t,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(t){var r;const n=(r=this._imageCache.get(t))==null?void 0:r.image;return n?n.imageQualityStatus||zt.FULL_RESOLUTION:void 0}}const Ct=new Zo;function vs(e,t,n){return Math.abs(e-t)<=n}function tc(e,t,n=1e-5){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!vs(e[r],t[r],n))return!1;return!0}function Sn(e){return typeof e=="number"}function vn(e){return e&&typeof e=="object"&&"length"in e&&typeof e.length=="number"&&e.length>0&&typeof e[0]=="number"}function Ln(e,t,n=1e-5){return typeof e!=typeof t||e===null||t===null?!1:Sn(e)&&Sn(t)?vs(e,t,n):vn(e)&&vn(t)?tc(e,t,n):!1}function Lt(e,t){return e.worldToIndex(t).map(Math.round)}const{vtkErrorMacro:xn}=_r;function ec(e){const t=e.getPolys().getData(),n=e.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<t.length){r.cellSize=t[r.polyIdx];const s=r.polyIdx+1,a=s+r.cellSize;r.polyIdx=a;let i=0;for(let c=s;c<a;++c)r.cell[i++]=t[c]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const s=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let i=0;for(let c=s;c<a;++c)r.cell[i++]=n[c]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function nc(e,t){t.classHierarchy.push("vtkCutter");const n={...e};e.getMTime=()=>{let s=n.getMTime();return t.cutFunction&&(s=Math.max(s,t.cutFunction.getMTime())),s};function r(s,a){const i=s.getPoints(),c=i.getData(),o=i.getNumberOfPoints(),u=[],f=[],l=[];(!t.cutScalars||t.cutScalars.length<o)&&(t.cutScalars=new Float32Array(o));let g=0,h=0;for(;g<c.length;)t.cutScalars[h++]=t.cutFunction.evaluateFunction(c[g++],c[g++],c[g++]);const y=[],d=new Array(3),E=new Array(3),_=[];for(const m=ec(s);!m.done;m.next()){if(m.cellSize<=2)continue;for(let D=0;D<m.cellSize;)_[D]=t.cutScalars[m.cell[D++]];const p=_[0]>0;let O=!0;for(let D=1;D<m.cell.length;D++)if(_[D]>0!==p){O=!1;break}if(O)continue;const T=[];for(let D=0;D<m.cellSize;D++){const L=D+1===m.cellSize?0:D+1,v=_[D]>0;if(_[L]>0===v)continue;let N=D,I=L,M=_[I]-_[N];M<=0&&(N=L,I=D,M*=-1);let U=0;M!==0&&(U=(t.cutValue-_[N])/M);const A=m.cell[N],B=m.cell[I];d[0]=c[A*3],d[1]=c[A*3+1],d[2]=c[A*3+2],E[0]=c[B*3],E[1]=c[B*3+1],E[2]=c[B*3+2];const pt=[d[0]+U*(E[0]-d[0]),d[1]+U*(E[1]-d[1]),d[2]+U*(E[2]-d[2])];T.push({pointEdge1:A,pointEdge2:B,intersectedPoint:pt,newPointID:-1})}for(let D=0;D<T.length;D++){const L=T[D];let v=!1;for(let S=0;S<y.length;S++){const N=y[S],I=L.pointEdge1===N.pointEdge1&&L.pointEdge2===N.pointEdge2,M=L.intersectedPoint[0]===N.intersectedPoint[0]&&L.intersectedPoint[1]===N.intersectedPoint[1]&&L.intersectedPoint[2]===N.intersectedPoint[2];if(I||M){v=!0,T[D].newPointID=y[S].newPointID;break}}v||(u.push(L.intersectedPoint[0]),u.push(L.intersectedPoint[1]),u.push(L.intersectedPoint[2]),T[D].newPointID=u.length/3-1,y.push(T[D]))}const w=T.length;w===2?f.push(w,T[0].newPointID,T[1].newPointID):w>2&&(l.push(w),T.forEach(D=>{l.push(D.newPointID)}))}a.getPoints().setData(qt(i.getDataType(),u),3),f.length!==0&&a.getLines().setData(Uint16Array.from(f)),l.length!==0&&a.getPolys().setData(Uint16Array.from(l))}e.requestData=(s,a)=>{const i=s[0];if(!i){xn("Invalid or missing input");return}if(!t.cutFunction){xn("Missing cut function");return}const c=Ze.newInstance();r(i,c),a[0]=c}}const rc={cutFunction:null,cutScalars:null,cutValue:0};function Ls(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,rc,n),te(e,t),Ae(e,t,1,1),ne(e,t,["cutFunction","cutValue"]),nc(e,t)}const sc=re(Ls,"vtkCutter");var ac={newInstance:sc,extend:Ls};const Mn=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],In=[[0,-1,0],[0,1,0]],ic=[[0,-1,0],[0,1,0],[0,0,-1]],oc=[[0,-1,0],[0,1,0],[0,0,1]],tn=class tn{static copyMap(t,n){for(const[r,s]of n.rows)t.rows.set(r,structuredClone(s))}constructor(t,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(s){s.fill(0);const a=(i,c,o)=>{const{start:u,end:f,value:l}=c;for(let g=u;g<f;g++)s[i+g]=l};this.forEach(a)},this.get=s=>{const a=s%this.jMultiple,i=(s-a)/this.jMultiple,c=this.getRLE(a,i);return(c==null?void 0:c.value)??this.defaultValue},this.getRun=(s,a)=>{const i=s+a*this.height;return this.rows.get(i)},this.set=(s,a)=>{if(a===void 0)return;const i=s%this.width,c=(s-i)/this.width,o=this.rows.get(c);if(!o){this.rows.set(c,[{start:i,end:i+1,value:a}]);return}const u=this.findIndex(o,i),f=o[u],l=o[u-1];if(!f){if(!l||l.value!==a||l.end!==i){o[u]={start:i,end:i+1,value:a};return}l.end++;return}const{start:g,end:h,value:y}=f;if(a===y&&i>=g)return;const d={start:i,end:i+1,value:a},E=i>g,_=E?u+1:u,C=E?f:l;let m=E?o[u+1]:f;if((C==null?void 0:C.value)===a&&(C==null?void 0:C.end)===i){C.end++,(m==null?void 0:m.value)===a&&m.start===i+1?(C.end=m.end,o.splice(u,1)):(m==null?void 0:m.start)===i&&(m.start++,m.start===m.end&&(o.splice(u,1),m=o[u],(m==null?void 0:m.start)===i+1&&m.value===a&&(C.end=m.end,o.splice(u,1))));return}if((m==null?void 0:m.value)===a&&m.start===i+1){m.start--,(C==null?void 0:C.end)>i&&(C.end=i,C.end===C.start&&o.splice(u,1));return}if((m==null?void 0:m.start)===i&&m.end===i+1){m.value=a;const p=o[u+1];(p==null?void 0:p.start)==i+1&&p.value===a&&(o.splice(u+1,1),m.end=p.end);return}i===(m==null?void 0:m.start)&&m.start++,E&&h>i+1?o.splice(_,0,d,{start:i+1,end:C.end,value:C.value}):o.splice(_,0,d),(C==null?void 0:C.end)>i&&(C.end=i)},this.width=t,this.height=n,this.depth=r,this.jMultiple=t,this.kMultiple=this.jMultiple*n}toIJK(t){const n=t%this.jMultiple,r=(t-n)/this.jMultiple%this.height,s=Math.floor(t/this.kMultiple);return[n,r,s]}toIndex([t,n,r]){return t+r*this.kMultiple+n*this.jMultiple}getRLE(t,n,r=0){const s=this.rows.get(n+r*this.height);if(!s)return;const a=this.findIndex(s,t),i=s[a];return t>=(i==null?void 0:i.start)?i:void 0}has(t){const n=t%this.jMultiple,r=(t-n)/this.jMultiple,s=this.getRLE(n,r);return(s==null?void 0:s.value)!==void 0}delete(t){const n=t%this.width,r=(t-n)/this.width,s=this.rows.get(r);if(!s)return;const a=this.findIndex(s,n),i=s[a];if(!i||i.start>n)return;if(i.end===n+1){i.end--,i.start>=i.end&&(s.splice(a,1),s.length||this.rows.delete(r));return}if(i.start===n){i.start++;return}const c={value:i.value,start:n+1,end:i.end};i.end=n,s.splice(a+1,0,c)}findIndex(t,n){for(let r=0;r<t.length;r++){const{end:s}=t[r];if(n<s)return r}return t.length}forEach(t,n){const r=n==null?void 0:n.rowModified;for(const[s,a]of this.rows){const i=r?[...a]:a;for(const c of i)t(s*this.width,c,a)}}forEachRow(t){for(const[n,r]of this.rows)t(n*this.width,r)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(t=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:s,numComps:a}=this;for(let i=0;i<s;i++){const c=this.getRun(i,t);if(c)if(a===1)for(const o of c){const u=i*r,{start:f,end:l,value:g}=o;for(let h=f;h<l;h++)n[u+h]=g}else for(const o of c){const u=i*r*a,{start:f,end:l,value:g}=o;for(let h=f;h<l;h+=a)for(let y=0;y<a;y++)n[u+h+y]=g[y]}}return n}floodFill(t,n,r,s,a){const i=this.getRLE(t,n,r);if(!i)throw new Error(`Initial point ${t},${n},${r} isn't in the RLE`);const c=[[i,n,r]],o=i.value;if(o===s)throw new Error(`source (${o}) and destination (${s}) are identical`);return this.flood(c,o,s,a)}flood(t,n,r,s){let a=0;const{planar:i=!0,diagonals:c=!0,singlePlane:o=!1}=s||{},u={planar:i,diagonals:c,singlePlane:o};for(;t.length;){const f=t.pop(),[l]=f;if(l.value!==n)continue;l.value=r,a+=l.end-l.start;const g=this.findAdjacents(f,u).filter(h=>h&&h[0].value===n);t.push(...g)}return a}fillFrom(t,n){for(let r=n[2][0];r<=n[2][1];r++)for(let s=n[1][0];s<=n[1][1];s++){let a,i;for(let c=n[0][0];c<=n[0][1];c++){const o=t(c,s,r);if(o===void 0){a=void 0;continue}i||(i=[],this.rows.set(s+r*this.height,i)),a&&a.value!==o&&(a=void 0),a||(a={start:c,end:c,value:o},i.push(a)),a.end++}}}findAdjacents(t,{diagonals:n=!0,planar:r=!0,singlePlane:s=!1}){const[a,i,c,o]=t,{start:u,end:f}=a,l=u>0&&this.getRLE(u-1,i,c),g=f<this.width&&this.getRLE(f,i,c),h=n?[u>0?u-1:u,f<this.width?f+1:f]:[u,f],y=[];l&&y.push([l,i,c]),g&&y.push([g,i,c]);for(const d of o||(s?In:Mn)){const[,E,_]=d,C=E+i,m=_+c;if(C<0||C>=this.height||m<0||m>=this.depth)continue;const p=this.getRun(C,m);if(p)for(const O of p){const T=o||s&&In||r&&_>0&&oc||r&&_<0&&ic||Mn;O.end<=h[0]||O.start>=h[1]||y.push([O,C,m,T])}}return y}};tn.getScalarData=function(t=Uint8ClampedArray){const n=new t(this.frameSize);return this.map.updateScalarData(n),n};let ut=tn;class nt{constructor(t={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:s=128}=t,a=n*r;this.growSize=s,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(t){for(let n=0;n<this._length;n++)t(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(t){if(t<0&&(t+=this._length),t<0||t>=this._length)return;const n=this._dimensions*t;return this.data.subarray(n,n+this._dimensions)}getPointArray(t){const n=[];if(t<0&&(t+=this._length),t<0||t>=this._length)return;const r=this._dimensions*t;for(let s=0;s<this._dimensions;s++)n.push(this.data[s+r]);return n}grow(t=1,n=this.growSize){if(this.dimensionLength+t*this._dimensions<=this.data.length)return;const r=this.data.length+n,s=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(s);a.set(this.data),this.data=a,this.array=s}reverse(){const t=Math.floor(this._length/2);for(let n=0;n<t;n++){const r=n*this._dimensions,s=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const i=this.data[r+a];this.data[r+a]=this.data[s+a],this.data[s+a]=i}}}getTypedArray(){return this.data}push(t){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=t[r];this._length++}map(t){const n=[];for(let r=0;r<this._length;r++)n.push(t(this.getPoint(r),r));return n}get points(){return this.map(t=>t)}toXYZ(){const t={x:[],y:[]};this._dimensions>=3&&(t.z=[]);const{x:n,y:r,z:s}=t;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),s&&s.push(a[2])}),t}static fromXYZ({x:t,y:n,z:r}){const s=nt.create3(t.length);let a=0;for(let i=0;i<t.length;i++)s.data[a++]=t[i],s.data[a++]=n[i],s.data[a++]=r?r[i]:0;return s._length=t.length,s}subselect(t=10,n=0){const r=new nt({initialSize:t,dimensions:this._dimensions});for(let s=0;s<t;s++){const a=(n+Math.floor(this.length*s/t))%this.length;r.push(this.getPoint(a))}return r}static create3(t=128,n){t=Math.max(t,(n==null?void 0:n.length)||0);const r=new nt({initialSize:t,dimensions:3});return n&&n.forEach(s=>r.push(s)),r}static create2(t=128){return new nt({initialSize:t,dimensions:2})}}function cc(e){const t=Bt(),n=e.getDimensions(),r=nt.create3(n[0]),s=nt.create3(n[1]),a=nt.create3(n[2]),i=e.getDirection(),c=i.slice(0,3),o=i.slice(3,6),u=i.slice(6,9),f=e.getSpacing(),[l,g,h]=f,y=e.indexToWorld([0,0,0]),d=j(c[0]*l,c[1]*l,c[2]*l),E=j(o[0]*g,o[1]*g,o[2]*g),_=j(u[0]*h,u[1]*h,u[2]*h),C=Bt();for(let T=0;T<n[0];T++)r.push(hi(C,y,he(C,d,T)));for(let T=0;T<n[1];T++)s.push(he(C,E,T));for(let T=0;T<n[2];T++)a.push(he(C,_,T));const m=r.getTypedArray(),p=s.getTypedArray(),O=a.getTypedArray();return(T,w=t)=>{const[D,L,v]=T,S=D*3,N=L*3,I=v*3;return w[0]=m[S]+p[N]+O[I],w[1]=m[S+1]+p[N+1]+O[I+1],w[2]=m[S+2]+p[N+2]+O[I+2],w}}function uc({voxelManager:e,bounds:t,imageData:n,pointInShapeFn:r,callback:s}){const[[a,i],[c,o],[u,f]]=t,l=cc(n),g=[0,0,0],h=[];for(let y=u;y<=f;y++){g[2]=y;for(let d=c;d<=o;d++){g[1]=d;for(let E=a;E<=i;E++){g[0]=E;const _=l(g);if(r(_,g)){const C=e.toIndex(g),m=e.getAtIndex(C);h.push({value:m,index:C,pointIJK:[...g],pointLPS:_.slice()}),s==null||s({value:m,index:C,pointIJK:g,pointLPS:_})}}}}return h}const fc=5*1024;class V{constructor(t,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(r,s,a)=>{const i=this.toIndex([r,s,a]);return this._get(i)},this.setAtIJK=(r,s,a,i)=>{const c=this.toIndex([r,s,a]),o=this._set(c,i);return o!==!1&&(this.modifiedSlices.add(a),V.addBounds(this.boundsIJK,[r,s,a])),o},this.getAtIJKPoint=([r,s,a])=>this.getAtIJK(r,s,a),this.setAtIJKPoint=([r,s,a],i)=>{this.setAtIJK(r,s,a,i)},this.getAtIndex=r=>this._get(r),this.setAtIndex=(r,s)=>{const a=this._set(r,s);if(a!==!1){const i=this.toIJK(r);this.modifiedSlices.add(i[2]),V.addBounds(this.boundsIJK,i)}return a},this.getMiddleSliceData=()=>{const r=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:r,slicePlane:2})},this.forEach=(r,s={})=>{const a=s.boundsIJK||this.getBoundsIJK(),i=s.isInObject||this.isInObject||(()=>!0),c=s.returnPoints||!1,o=s.imageData,u=Math.min(a[0][0],a[0][1]),f=Math.max(a[0][0],a[0][1]),l=Math.min(a[1][0],a[1][1]),g=Math.max(a[1][0],a[1][1]),h=Math.min(a[2][0],a[2][1]),y=Math.max(a[2][0],a[2][1]),d=[];if(o)return uc({voxelManager:this,imageData:s.imageData,bounds:[[u,f],[l,g],[h,y]],pointInShapeFn:i,callback:r});if(this.map){if(this.map instanceof ut)return this.rleForEach(r,s);for(const E of this.map.keys()){const _=this.toIJK(E);if(!i(null,_))continue;const C=this._get(E);c&&d.push({value:C,index:E,pointIJK:_,pointLPS:null}),r({value:C,index:E,pointIJK:_,pointLPS:null})}return d}else{for(let E=h;E<=y;E++){const _=E*this.frameSize;for(let C=l;C<=g;C++){const m=_+C*this.width;for(let p=u,O=m+p;p<=f;p++,O++){const T=this.getAtIndex(O),w=[p,C,E];i(null,w)&&(c&&d.push({value:T,index:O,pointIJK:w,pointLPS:null}),r({value:T,index:O,pointIJK:[p,C,E],pointLPS:null}))}}}return d}},this.getSliceData=({sliceIndex:r,slicePlane:s})=>{const[a,i,c]=this.dimensions,o=a*i,u=r*o;let f;const l=this.getConstructor();function g(y){return typeof y=="function"}if(!g(l))return new Uint8Array(0);let h;switch(s){case 0:f=i*c,h=new l(f);for(let y=0;y<i;y++)for(let d=0;d<c;d++){const E=r+y*a+d*o;this.setSliceDataValue(h,y*c+d,this._get(E))}break;case 1:f=a*c,h=new l(f);for(let y=0;y<a;y++)for(let d=0;d<c;d++){const E=y+r*a+d*o;this.setSliceDataValue(h,y+d*a,this._get(E))}break;case 2:f=a*i,h=new l(f);for(let y=0;y<f;y++)this.setSliceDataValue(h,y,this._get(u+y));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=t,this.width=t[0],this.frameSize=this.width*t[1],this._get=n._get,this._set=n._set,this._id=n._id||"",this._getConstructor=n._getConstructor,this.numberOfComponents=this.numberOfComponents||1,this.scalarData=n.scalarData,this._getScalarData=n._getScalarData,this._updateScalarData=n._updateScalarData}getMinMax(){let t,n;const r=({value:s})=>{const a=Array.isArray(s);if(t===void 0&&(t=a?[...s]:s,n=a?[...s]:s),a)for(let i=0;i<s.length;i++)t[i]=Math.min(t[i],s[i]),n[i]=Math.max(n[i],s[i]);else t=Math.min(t,s),n=Math.max(n,s)};return this.forEach(r,{boundsIJK:this.getDefaultBounds()}),{min:t,max:n}}toIJK(t){return[t%this.width,Math.floor(t%this.frameSize/this.width),Math.floor(t/this.frameSize)]}toIndex(t){return t[0]+t[1]*this.width+t[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(t=>[0,t-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(t,n){const r=(n==null?void 0:n.boundsIJK)||this.getBoundsIJK(),{isWithinObject:s}=n||{},a=this.map;a.defaultValue=void 0;for(let i=r[2][0];i<=r[2][1];i++)for(let c=r[1][0];c<=r[1][1];c++){const o=a.getRun(c,i);if(o)for(const u of o){const{start:f,end:l,value:g}=u,h=this.toIndex([0,c,i]);for(let y=f;y<l;y++){const d={value:g,index:h+y,pointIJK:[y,c,i]};(s==null?void 0:s(d))!==!1&&t(d)}}}}getScalarData(t=!1){var n;if(this.scalarData)return(n=this._updateScalarData)==null||n.call(this,this.scalarData),this.scalarData;if(this._getScalarData){const r=this._getScalarData();return t&&console.log("Not transient, should store value",r),r}throw new Error("No scalar data available")}setScalarData(t){this.scalarData=t}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var t,n;(t=this.map)==null||t.clear(),this.boundsIJK.map(r=>{r[0]=1/0,r[1]=-1/0}),this.modifiedSlices.clear(),(n=this.points)==null||n.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(t,n){t||(t=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),t[0][0]=Math.min(n[0],t[0][0]),t[0][1]=Math.max(n[0],t[0][1]),t[1][0]=Math.min(n[1],t[1][0]),t[1][1]=Math.max(n[1],t[1][1]),t[2][0]=Math.min(n[2],t[2][0]),t[2][1]=Math.max(n[2],t[2][1])}addPoint(t){const n=Array.isArray(t)?t[0]+this.width*t[1]+this.frameSize*t[2]:t;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(t=>this.toIJK(t)):[]}setSliceDataValue(t,n,r){if(Array.isArray(r))for(let s=0;s<r.length;s++)t[n*r.length+s]=this.toNumber(r[s]);else t[n]=this.toNumber(r)}toNumber(t){return typeof t=="number"?t:Array.isArray(t)&&t[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:t,scalarData:n,numberOfComponents:r=3}){const s=new V(t,{_get:a=>(a*=r,[n[a++],n[a++],n[a++]]),_id:"_createRGBScalarVolumeVoxelManager",_set:(a,i)=>{a*=3;const c=!Ln(n[a],i);return n[a++]=i[0],n[a++]=i[1],n[a++]=i[2],c},numberOfComponents:r,scalarData:n});return s.clear=()=>{n.fill(0)},s}static createImageVolumeVoxelManager({dimensions:t,imageIds:n,numberOfComponents:r=1}){const s=t[0]*t[1];function a(f){const l=Math.floor(f/s);if(l<0||l>=t[2])return{};const g=n[l];if(!g)return console.warn(`ImageId not found for sliceIndex: ${l}`),{pixelData:null,pixelIndex:null};const h=Ct.getImage(g);if(!h)return console.warn(`Image not found for imageId: ${g}`),{pixelData:null,pixelIndex:null};const y=h.voxelManager,d=f%s;return{voxelManager:y,pixelIndex:d}}function i(f){const{voxelManager:l,pixelIndex:g}=a(f);return!l||g===null?null:l.getAtIndex(g)}function c(f,l){const{voxelManager:g,pixelIndex:h}=a(f);if(!g||h===null)return!1;const y=g.getAtIndex(h),d=!Ln(l,y);return d&&(g.setAtIndex(h,l),!0)}const o=()=>{const{voxelManager:f}=a(0);return f?f.getConstructor():null},u=new V(t,{_get:i,_set:c,numberOfComponents:r,_getConstructor:o,_id:"createImageVolumeVoxelManager"});return u.getMiddleSliceData=()=>{const f=Math.floor(t[2]/2);return u.getSliceData({sliceIndex:f,slicePlane:2})},u.clear=()=>{for(const f of n)Ct.getImage(f).voxelManager.clear()},u.getRange=()=>{let f=1/0,l=-1/0;for(const g of n){const h=Ct.getImage(g);h&&(h.minPixelValue<f&&(f=h.minPixelValue),h.maxPixelValue>l&&(l=h.maxPixelValue))}return f===1/0&&l===-1/0?[0,0]:[f,l]},u._getScalarDataLength=()=>{const{voxelManager:f}=a(0);return f?f.getScalarDataLength()*t[2]:0},u.getCompleteScalarDataArray=()=>{const f=u._getConstructor();if(!f)return new Uint8Array(0);const l=u.getScalarDataLength(),g=new f(l),h=t[0]*t[1]*r;for(let y=0;y<t[2];y++){const{voxelManager:d}=a(y*h/r);if(d){const E=y*h,_=d.getScalarData();if(r===1)g.set(_,E);else for(let C=0;C<_.length;C+=r)for(let m=0;m<r;m++)g[E+C+m]=_[C+m]}}return g},u.setCompleteScalarDataArray=f=>{const l=t[0]*t[1]*r,g=u._getConstructor();let h=1/0,y=-1/0;for(let d=0;d<t[2];d++){const{voxelManager:E}=a(d*l/r);if(E&&g){const _=d*l,C=_+l,m=new g(l);m.set(f.subarray(_,C)),E.scalarData=m;for(let T=0;T<m.length;T++){const w=m[T];h=Math.min(h,w),y=Math.max(y,w)}const p=n[d],O=Ct.getImage(p);O&&(O.minPixelValue=h,O.maxPixelValue=y)}}for(let d=0;d<t[2];d++)u.modifiedSlices.add(d);u.boundsIJK=[[0,t[0]-1],[0,t[1]-1],[0,t[2]-1]]},u}static createScalarVolumeVoxelManager({dimensions:t,scalarData:n,numberOfComponents:r=1}){if(t.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/t[0]/t[1]/t[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?V._createRGBScalarVolumeVoxelManager({dimensions:t,scalarData:n,numberOfComponents:r}):V._createNumberVolumeVoxelManager({dimensions:t,scalarData:n})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:t,dimensions:n,timePoint:r=0,numberOfComponents:s=1}){if(!s){const c=Ct.getImage(t[0][0]);if(!c)throw new Error("Unable to determine number of components: No image found");if(s=c.getPixelData().length/(n[0]*n[1]),s>4||s<1||s===2)throw new Error(`Number of components ${s} must be 1, 3 or 4`)}const a=t.map(c=>V.createImageVolumeVoxelManager({dimensions:n,imageIds:c,numberOfComponents:s})),i=new V(n,{_get:c=>a[r]._get(c),_set:(c,o)=>a[r]._set(c,o),numberOfComponents:s,_id:"createScalarDynamicVolumeVoxelManager"});return i.getScalarDataLength=()=>a[r].getScalarDataLength(),i.getConstructor=()=>a[r].getConstructor(),i.getRange=()=>a[r].getRange(),i.getMiddleSliceData=()=>a[r].getMiddleSliceData(),i.setTimePoint=c=>{r=c,i._get=o=>a[r]._get(o),i._set=(o,u)=>a[r]._set(o,u)},i.getAtIndexAndTimePoint=(c,o)=>a[o]._get(c),i.getTimePointScalarData=c=>a[c].getCompleteScalarDataArray(),i.getTimePointScalarData=c=>a[c].getCompleteScalarDataArray(),i.getCurrentTimePointScalarData=()=>a[r].getCompleteScalarDataArray(),i}static createImageVoxelManager({width:t,height:n,scalarData:r,numberOfComponents:s=1}){const a=[t,n,1];if(!s&&(s=r.length/t/n,s>4||s<1||s===2))throw new Error(`Number of components ${s} must be 1, 3 or 4`);return s>1?V._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:r,numberOfComponents:s}):V._createNumberVolumeVoxelManager({dimensions:a,scalarData:r})}static _createNumberVolumeVoxelManager({dimensions:t,scalarData:n}){const r=new V(t,{_get:s=>n[s],_set:(s,a)=>{const i=n[s]!==a;return n[s]=a,i},_getConstructor:()=>n.constructor,_id:"_createNumberVolumeVoxelManager"});return r.scalarData=n,r.clear=()=>{r.scalarData.fill(0)},r.getMiddleSliceData=()=>{const s=Math.floor(t[2]/2);return r.getSliceData({sliceIndex:s,slicePlane:2})},r}static createMapVoxelManager({dimension:t}){const n=new Map,r=new V(t,{_get:n.get.bind(n),_set:(s,a)=>n.set(s,a)&&!0,_id:"createMapVoxelManager"});return r.map=n,r}static createHistoryVoxelManager({sourceVoxelManager:t}){const n=new Map,{dimensions:r}=t,s=new V(r,{_get:a=>n.get(a),_set:function(a,i){if(n.has(a))i===n.get(a)&&n.delete(a);else{const c=this.sourceVoxelManager.getAtIndex(a);if(c===i)return!1;n.set(a,c)}this.sourceVoxelManager.setAtIndex(a,i)},_id:"createHistoryVoxelManager"});return s.map=n,s.scalarData=t.scalarData,s.sourceVoxelManager=t,s}static createRLEHistoryVoxelManager(t){const{dimensions:n}=t,r=new ut(n[0],n[1],n[2]),s=new V(n,{_get:a=>r.get(a),_set:function(a,i){const c=r.get(a);if(c===void 0){const o=this.sourceVoxelManager.getAtIndex(a);if(o===i||o===void 0&&i===0||i===null)return!1;r.set(a,o??0)}else(i===c||i===null)&&(r.delete(a),i=c);this.sourceVoxelManager.setAtIndex(a,i)},_getScalarData:ut.getScalarData,_updateScalarData:a=>(r.updateScalarData(a),a),_id:"createRLEHistoryVoxelManager"});return s.map=r,s.sourceVoxelManager=t,s}static createLazyVoxelManager({dimensions:t,planeFactory:n}){const r=new Map,[s,a]=t,i=s*a,c=new V(t,{_get:o=>r.get(Math.floor(o/i))[o%i],_set:(o,u)=>{const f=Math.floor(o/i);let l=r.get(f);return l||(l=n(s,a),r.set(f,l)),l[o%i]=u,!0},_id:"createLazyVoxelManager"});return c.map=r,c}static createRLEVolumeVoxelManager({dimensions:t}){const[n,r,s]=t,a=new ut(n,r,s),i=new V(t,{_get:c=>a.get(c),_set:(c,o)=>(a.set(c,o),!0),_getScalarData:ut.getScalarData,_updateScalarData:c=>(a.updateScalarData(c),c),_id:"createRLEVolumeVoxelManager"});return i.map=a,i.getPixelData=a.getPixelData.bind(a),i}static createRLEImageVoxelManager({dimensions:t}){const[n,r]=t;return V.createRLEVolumeVoxelManager({dimensions:[n,r,1]})}static addInstanceToImage(t){const{width:n,height:r}=t,s=t.voxelManager.getScalarData();if(s.length>=n*r){t.voxelManager=V.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:s});return}t.voxelManager=V.createRLEVolumeVoxelManager({dimensions:[n,r,1]}),t.getPixelData=t.voxelManager.getPixelData,t.sizeInBytes=fc}}function lc(e,t){const n=[...e];return t>=n.length?(Nn(n),n):(Nn(n),n.slice(0,t))}function Nn(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}const Rn={Forward:1,Backward:-1},xt=new Set;function gc(e,t){e.requestData=(n,r)=>{const[s]=n;r[0]||(r[0]=Ze.newInstance());const[a]=r;e.extractContours(s,a),a.modified()},e.traverseLoop=(n,r,s,a,i)=>{let c=s,o=a,u=!1,f=0;for(;!u;){const{cellPointIds:l}=n.getCellPoints(c);if(!l)continue;o=l[0]!==o?l[0]:l[1],f++;const g=r*f;i.push({t:g,ptId:o});const h=n.getPointCells(o);if(h.length!==2||o===a)return o;h.length===2?(c=h[0]!==c?h[0]:h[1],xt.add(c)):u=!0}return o},e.extractContours=(n,r)=>{var c;const s=[];xt.clear();const a=n.getLines();r.getPoints().setData(Float32Array.from(n.getPoints().getData()));for(let o=0;o<a.getNumberOfCells();o++){if(xt.has(o))continue;const{cellPointIds:u}=n.getCellPoints(o);if(!u)continue;xt.add(o);const f=u[0],l=[];l.push({t:0,ptId:f});const g=e.traverseLoop(n,Rn.Forward,o,f,l);f!==g&&(e.traverseLoop(n,Rn.Backward,o,f,l),l.sort((h,y)=>h.t<y.t?-1:1),l.length&&l[0].ptId!==((c=l[l.length-1])==null?void 0:c.ptId)&&l.push({...l[l.length-1]})),l.length&&s.push(l)}const i=r.getLines();i.resize(0),s.forEach(o=>{i.insertNextCell(o.map(u=>u.ptId))})}}const hc={};function xs(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(t,hc,n),x.obj(e,t),x.algo(e,t,1,1),gc(e)}const yc=x.newInstance(xs,"vtkContourLoopExtraction");var dc={newInstance:yc,extend:xs};function mc(e,t,n=!1){var f;let r=1/0,s=n?-1/0:0,a=1/0,i=n?-1/0:0,c=1/0,o=n?-1/0:0;const u=((f=e[0])==null?void 0:f.length)===3;for(let l=0;l<e.length;l++){const g=e[l];r=Math.min(g[0],r),s=Math.max(g[0],s),a=Math.min(g[1],a),i=Math.max(g[1],i),u&&(c=Math.min(g[2]??c,c),o=Math.max(g[2]??o,o))}return n||(r=Math.max(0,r),s=Math.min(1/0,s),a=Math.max(0,a),i=Math.min(1/0,i),u&&(c=Math.max(0,c),o=Math.min(1/0,o))),u?[[r,s],[a,i],[c,o]]:[[r,s],[a,i],null]}function An(e,t){return mc(e,t,!0)}function Ec(e,t){if(e.length!==t.length)throw Error("Both points should have the same dimensionality");const[n,r,s=0]=e,[a,i,c=0]=t,o=a-n,u=i-r,f=c-s;return o*o+u*u+f*f}function pc(e){if(e.length<3)return!1;const t=e.length,n=e[0],r=e[t-1],s=Ec(n,r);return ii(0,s)}function xe(e,t,n={closed:void 0}){if(e.length<3)return!1;const r=e.length;let s=0;const{closed:a,holes:i}=n;if(i!=null&&i.length){for(const u of i)if(xe(u,t))return!1}const c=!(a===void 0?pc(e):a),o=e.length-(c?1:2);for(let u=0;u<=o;u++){const f=e[u],l=u===r-1?0:u+1,g=e[l],h=f[0]>=g[0]?f[0]:g[0],y=f[1]>=g[1]?f[1]:g[1],d=f[1]<=g[1]?f[1]:g[1];if(t[0]<=h&&t[1]>=d&&t[1]<y){let C=f[0]===g[0];if(!C){const m=(t[1]-f[1])*(g[0]-f[0])/(g[1]-f[1])+f[0];C=t[0]<=m}s+=C?1:0}}return!!(s%2)}function Vn(e,t){let n=e;const r=(t==null?void 0:t.numDimensions)||2,s=r===3;if(!Array.isArray(e[0])){const l=e,g=l.length/r;n=new Array(l.length/r);for(let h=0,y=g;h<y;h++)n[h]=[l[h*r],l[h*r+1]],s&&n[h].push(l[h*r+2])}let a=1/0,i=1/0,c=-1/0,o=-1/0,u=1/0,f=-1/0;n=n;for(let l=0,g=n.length;l<g;l++){const[h,y,d]=n[l];a=a<h?a:h,i=i<y?i:y,c=c>h?c:h,o=o>y?o:y,s&&(u=u<d?u:d,f=f>d?f:d)}return s?{minX:a,maxX:c,minY:i,maxY:o,minZ:u,maxZ:f}:{minX:a,maxX:c,minY:i,maxY:o}}const Cc=1e-6;function Mt(e){let t;const n=lc(e,50);for(let i=0;i<3;i++)if(n.every((c,o,u)=>Math.abs(c[i]-u[0][i])<Cc)){t=i;break}if(t===void 0)throw new Error("Cannot find a shared dimension index for polyline, probably oblique plane");const r=[],s=(t+1)%3,a=(t+2)%3;for(let i=0;i<e.length;i++)r.push([e[i][s],e[i][a]]);return{sharedDimensionIndex:t,projectedPolyline:r}}const Tc=(e,t,n,r,s,a,i,c)=>{const o=[j(n,r,s),j(a,r,s),j(n,i,s),j(a,i,s),j(n,r,c),j(a,r,c),j(n,i,c),j(a,i,c)],u=j(t[0],t[1],t[2]),f=j(e[0],e[1],e[2]),l=-_e(u,f);let g=null;for(const h of o){const y=_e(u,h)+l;if(g===null)g=Math.sign(y);else if(Math.sign(y)!==g)return!0}return!1},Oc={polySeg:null,polySegInitializing:!1,polySegInitializingPromise:null,async initializePolySeg(e){var t;if(this.polySegInitializing){await this.polySegInitializingPromise;return}(t=this.polySeg)!=null&&t.instance||(this.polySegInitializing=!0,this.polySegInitializingPromise=new Promise(n=>{this.polySeg=new oe,this.polySeg.initialize({updateProgress:e}).then(()=>{this.polySegInitializing=!1,n()})}),await this.polySegInitializingPromise)},async convertContourToSurface(e,...t){const{polylines:n,numPointsArray:r}=e,[s]=t;return await this.initializePolySeg(s),await this.polySeg.instance.convertContourRoiToSurface(n,r)},async convertLabelmapToSurface(e,...t){const[n]=t;return await this.initializePolySeg(n),this.polySeg.instance.convertLabelmapToSurface(e.scalarData,e.dimensions,e.spacing,e.direction,e.origin,[e.segmentIndex])},async convertContourToVolumeLabelmap(e,...t){const[n]=t;await(await new oe).initialize({updateProgress:n});const{segmentIndices:s,scalarData:a,annotationUIDsInSegmentMap:i,dimensions:c,origin:o,direction:u,spacing:f}=e,l=V.createScalarVolumeVoxelManager({dimensions:c,scalarData:a}),g=vt.newInstance();g.setDimensions(c),g.setOrigin(o),g.setDirection(u),g.setSpacing(f);const h=q.newInstance({name:"Pixels",numberOfComponents:1,values:a});g.getPointData().setScalars(h),g.modified();for(const y of s){const d=i.get(y);for(const E of d){if(!E.polyline)continue;const{polyline:_,holesPolyline:C}=E,m=An(_),[p,O,T]=Lt(g,[m[0][0],m[1][0],m[2][0]]),[w,D,L]=Lt(g,[m[0][1],m[1][1],m[2][1]]),{projectedPolyline:v,sharedDimensionIndex:S}=Mt(_),N=C==null?void 0:C.map(A=>{const{projectedPolyline:B}=Mt(A);return B}),I=(S+1)%3,M=(S+2)%3;V.createScalarVolumeVoxelManager({dimensions:c,scalarData:a}).forEach(({pointIJK:A})=>{l.setAtIJKPoint(A,y)},{imageData:g,isInObject:A=>{const B=[A[I],A[M]];return xe(v,B,{holes:N})},boundsIJK:[[p,w],[O,D],[T,L]]})}}return l.scalarData},async convertContourToStackLabelmap(e,...t){const[n]=t;await(await new oe).initialize({updateProgress:n});const{segmentationsInfo:s,annotationUIDsInSegmentMap:a,segmentIndices:i}=e,c=new Map;s.forEach((o,u)=>{const{dimensions:f,scalarData:l,direction:g,spacing:h,origin:y}=o,d=V.createScalarVolumeVoxelManager({dimensions:f,scalarData:l}),E=vt.newInstance();E.setDimensions(f),E.setOrigin(y),E.setDirection(g),E.setSpacing(h);const _=q.newInstance({name:"Pixels",numberOfComponents:1,values:l});E.getPointData().setScalars(_),E.modified(),c.set(u,{manager:d,imageData:E})});for(const o of i){const u=a.get(o);for(const f of u){if(!f.polyline)continue;const{polyline:l,holesPolyline:g,referencedImageId:h}=f,y=An(l),{manager:d,imageData:E}=c.get(h),[_,C,m]=Lt(E,[y[0][0],y[1][0],y[2][0]]),[p,O,T]=Lt(E,[y[0][1],y[1][1],y[2][1]]),{projectedPolyline:w,sharedDimensionIndex:D}=Mt(l),L=g==null?void 0:g.map(I=>{const{projectedPolyline:M}=Mt(I);return M}),v=(D+1)%3,S=(D+2)%3;V.createImageVoxelManager({width:E.getDimensions()[0],height:E.getDimensions()[1],scalarData:E.getPointData().getScalars().getData()}).forEach(({pointIJK:I})=>{d.setAtIJKPoint(I,o)},{imageData:E,isInObject:I=>{const M=[I[v],I[S]];return xe(w,M,{holes:L})},boundsIJK:[[_,p],[C,O],[m,T]]})}}return s.forEach((o,u)=>{const{manager:f}=c.get(u);o.scalarData=f.scalarData}),s},async convertSurfaceToVolumeLabelmap(e,...t){const[n]=t;return await this.initializePolySeg(n),this.polySeg.instance.convertSurfaceToLabelmap(e.points,e.polys,e.dimensions,e.spacing,e.direction,e.origin)},async convertSurfacesToVolumeLabelmap(e,...t){const[n]=t;await this.initializePolySeg(n);const{segmentsInfo:r}=e,s=Array.from(r.keys()).map(y=>{const{points:d,polys:E}=r.get(y);return{...this.polySeg.instance.convertSurfaceToLabelmap(d,E,e.dimensions,e.spacing,e.direction,e.origin),segmentIndex:y}}),a=await Promise.all(s),i=vt.newInstance();i.setDimensions(e.dimensions),i.setOrigin(e.origin),i.setSpacing(e.spacing),i.setDirection(e.direction);const c=e.dimensions[0]*e.dimensions[1]*e.dimensions[2],o=q.newInstance({name:"Pixels",numberOfComponents:1,values:new Uint8Array(c)});i.getPointData().setScalars(o),i.modified();const{dimensions:u}=e,f=i.getPointData().getScalars().getData(),l=V.createScalarVolumeVoxelManager({dimensions:u,scalarData:f}),g=a.map(y=>{const{data:d,dimensions:E,direction:_,origin:C,spacing:m}=y,p=vt.newInstance();p.setDimensions(E),p.setOrigin(C),p.setSpacing(m),p.setDirection(_);const O=q.newInstance({name:"Pixels",numberOfComponents:1,values:d});p.getPointData().setScalars(O),p.modified();const T=V.createScalarVolumeVoxelManager({dimensions:E,scalarData:d}),w=p.getExtent();return{volume:p,voxelManager:T,extent:w,scalarData:d,segmentIndex:y.segmentIndex}});return V.createScalarVolumeVoxelManager({dimensions:i.getDimensions(),scalarData:i.getPointData().getScalars().getData()}).forEach(({pointIJK:y,pointLPS:d})=>{try{for(const E of g){const{volume:_,extent:C,voxelManager:m,segmentIndex:p}=E,O=_.worldToIndex(d);if(O[0]<C[0]||O[0]>C[1]||O[1]<C[2]||O[1]>C[3]||O[2]<C[4]||O[2]>C[5])continue;const T=O.map(Math.round);if(m.getAtIJK(...T)>0){l.setAtIJKPoint(y,p);break}}}catch{}},{imageData:i}),l.scalarData},getSurfacesAABBs({surfacesInfo:e}){const t=new Map;for(const{points:n,id:r}of e){const s=Vn(n,{numDimensions:3});t.set(r,s)}return t},cutSurfacesIntoPlanes({planesInfo:e,surfacesInfo:t,surfacesAABB:n=new Map},r,s){const a=e.length,i=ac.newInstance(),c=ft.newInstance();i.setCutFunction(c);const o=Ze.newInstance();try{for(const[u,f]of e.entries()){const{sliceIndex:l,planes:g}=f,h=new Map;for(const y of t){const{points:d,polys:E,id:_,segmentIndex:C}=y,m=n.get(_)||Vn(d,{numDimensions:3});n.has(_)||n.set(_,m);const{minX:p,minY:O,minZ:T,maxX:w,maxY:D,maxZ:L}=m,{origin:v,normal:S}=g[0];if(!Tc(v,S,p,O,T,w,D,L))continue;o.getPoints().setData(d,3),o.getPolys().setData(E,3),o.modified(),i.setInputData(o),c.setOrigin(v),c.setNormal(S);try{i.update()}catch(A){console.warn("Error during clipping",A);continue}const N=i.getOutputData(),I=N;I.buildLinks();const M=dc.newInstance();M.setInputData(I);const U=M.getOutputData();N&&h.set(C,{points:U.getPoints().getData(),lines:U.getLines().getData(),numberOfCells:U.getLines().getNumberOfCells(),segmentIndex:C})}r({progress:(u+1)/a}),s({sliceIndex:l,polyDataResults:h})}}catch(u){console.warn("Error during processing",u)}finally{t=null,c.delete()}}};Me(Oc);
